<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="NEAR AI Docs - Quickly build and deploy robust AI agents, models, benchmarks, and more."><meta name=author content="NEAR AI"><link href=https://docs.near.ai/api/ rel=canonical><link href=../assistants/integrate/ rel=prev><link rel=icon href=../assets/images/favicon.ico><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.4"><title>API - NEAR AI</title><link rel=stylesheet href=../assets/stylesheets/main.8608ea7d.min.css><link rel=stylesheet href=../assets/stylesheets/palette.06af60db.min.css><style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1 7.775V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 0 1 0 2.474l-5.026 5.026a1.75 1.75 0 0 1-2.474 0l-6.25-6.25A1.75 1.75 0 0 1 1 7.775m1.5 0c0 .066.026.13.073.177l6.25 6.25a.25.25 0 0 0 .354 0l5.025-5.025a.25.25 0 0 0 0-.354l-6.25-6.25a.25.25 0 0 0-.177-.073H2.75a.25.25 0 0 0-.25.25ZM6 5a1 1 0 1 1 0 2 1 1 0 0 1 0-2"/></svg>');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.5 1.75v11.5c0 .138.112.25.25.25h3.17a.75.75 0 0 1 0 1.5H2.75A1.75 1.75 0 0 1 1 13.25V1.75C1 .784 1.784 0 2.75 0h8.5C12.216 0 13 .784 13 1.75v7.736a.75.75 0 0 1-1.5 0V1.75a.25.25 0 0 0-.25-.25h-8.5a.25.25 0 0 0-.25.25m13.274 9.537zl-4.557 4.45a.75.75 0 0 1-1.055-.008l-1.943-1.95a.75.75 0 0 1 1.062-1.058l1.419 1.425 4.026-3.932a.75.75 0 1 1 1.048 1.074M4.75 4h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5M4 7.75A.75.75 0 0 1 4.75 7h2a.75.75 0 0 1 0 1.5h-2A.75.75 0 0 1 4 7.75"/></svg>');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13M6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75M8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2"/></svg>');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M3.499.75a.75.75 0 0 1 1.5 0v.996C5.9 2.903 6.793 3.65 7.662 4.376l.24.202c-.036-.694.055-1.422.426-2.163C9.1.873 10.794-.045 12.622.26 14.408.558 16 1.94 16 4.25c0 1.278-.954 2.575-2.44 2.734l.146.508.065.22c.203.701.412 1.455.476 2.226.142 1.707-.4 3.03-1.487 3.898C11.714 14.671 10.27 15 8.75 15h-6a.75.75 0 0 1 0-1.5h1.376a4.5 4.5 0 0 1-.563-1.191 3.84 3.84 0 0 1-.05-2.063 4.65 4.65 0 0 1-2.025-.293.75.75 0 0 1 .525-1.406c1.357.507 2.376-.006 2.698-.318l.009-.01a.747.747 0 0 1 1.06 0 .75.75 0 0 1-.012 1.074c-.912.92-.992 1.835-.768 2.586.221.74.745 1.337 1.196 1.621H8.75c1.343 0 2.398-.296 3.074-.836.635-.507 1.036-1.31.928-2.602-.05-.603-.216-1.224-.422-1.93l-.064-.221c-.12-.407-.246-.84-.353-1.29a2.4 2.4 0 0 1-.507-.441 3.1 3.1 0 0 1-.633-1.248.75.75 0 0 1 1.455-.364c.046.185.144.436.31.627.146.168.353.305.712.305.738 0 1.25-.615 1.25-1.25 0-1.47-.95-2.315-2.123-2.51-1.172-.196-2.227.387-2.706 1.345-.46.92-.27 1.774.019 3.062l.042.19.01.05c.348.443.666.949.94 1.553a.75.75 0 1 1-1.365.62c-.553-1.217-1.32-1.94-2.3-2.768L6.7 5.527c-.814-.68-1.75-1.462-2.692-2.619a3.7 3.7 0 0 0-1.023.88c-.406.495-.663 1.036-.722 1.508.116.122.306.21.591.239.388.038.797-.06 1.032-.19a.75.75 0 0 1 .728 1.31c-.515.287-1.23.439-1.906.373-.682-.067-1.473-.38-1.879-1.193L.75 5.677V5.5c0-.984.48-1.94 1.077-2.664.46-.559 1.05-1.055 1.673-1.353z"/></svg>');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.75.75 0 0 1 .018-1.042.75.75 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0"/></svg>');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13M6.92 6.085h.001a.749.749 0 1 1-1.342-.67c.169-.339.436-.701.849-.977C6.845 4.16 7.369 4 8 4a2.76 2.76 0 0 1 1.637.525c.503.377.863.965.863 1.725 0 .448-.115.83-.329 1.15-.205.307-.47.513-.692.662-.109.072-.22.138-.313.195l-.006.004a6 6 0 0 0-.26.16 1 1 0 0 0-.276.245.75.75 0 0 1-1.248-.832c.184-.264.42-.489.692-.661q.154-.1.313-.195l.007-.004c.1-.061.182-.11.258-.161a1 1 0 0 0 .277-.245C8.96 6.514 9 6.427 9 6.25a.61.61 0 0 0-.262-.525A1.27 1.27 0 0 0 8 5.5c-.369 0-.595.09-.74.187a1 1 0 0 0-.34.398M9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0"/></svg>');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0M9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0"/></svg>');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.344 2.343za8 8 0 0 1 11.314 11.314A8.002 8.002 0 0 1 .234 10.089a8 8 0 0 1 2.11-7.746m1.06 10.253a6.5 6.5 0 1 0 9.108-9.275 6.5 6.5 0 0 0-9.108 9.275M6.03 4.97 8 6.94l1.97-1.97a.749.749 0 0 1 1.275.326.75.75 0 0 1-.215.734L9.06 8l1.97 1.97a.749.749 0 0 1-.326 1.275.75.75 0 0 1-.734-.215L8 9.06l-1.97 1.97a.749.749 0 0 1-1.275-.326.75.75 0 0 1 .215-.734L6.94 8 4.97 6.03a.75.75 0 0 1 .018-1.042.75.75 0 0 1 1.042-.018"/></svg>');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M9.504.43a1.516 1.516 0 0 1 2.437 1.713L10.415 5.5h2.123c1.57 0 2.346 1.909 1.22 3.004l-7.34 7.142a1.25 1.25 0 0 1-.871.354h-.302a1.25 1.25 0 0 1-1.157-1.723L5.633 10.5H3.462c-1.57 0-2.346-1.909-1.22-3.004zm1.047 1.074L3.286 8.571A.25.25 0 0 0 3.462 9H6.75a.75.75 0 0 1 .694 1.034l-1.713 4.188 6.982-6.793A.25.25 0 0 0 12.538 7H9.25a.75.75 0 0 1-.683-1.06l2.008-4.418.003-.006-.004-.009-.006-.006-.008-.001q-.005 0-.009.004"/></svg>');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4.72.22a.75.75 0 0 1 1.06 0l1 .999a3.5 3.5 0 0 1 2.441 0l.999-1a.748.748 0 0 1 1.265.332.75.75 0 0 1-.205.729l-.775.776c.616.63.995 1.493.995 2.444v.327q0 .15-.025.292c.408.14.764.392 1.029.722l1.968-.787a.75.75 0 0 1 .556 1.392L13 7.258V9h2.25a.75.75 0 0 1 0 1.5H13v.5q-.002.615-.141 1.186l2.17.868a.75.75 0 0 1-.557 1.392l-2.184-.873A5 5 0 0 1 8 16a5 5 0 0 1-4.288-2.427l-2.183.873a.75.75 0 0 1-.558-1.392l2.17-.868A5 5 0 0 1 3 11v-.5H.75a.75.75 0 0 1 0-1.5H3V7.258L.971 6.446a.75.75 0 0 1 .558-1.392l1.967.787c.265-.33.62-.583 1.03-.722a1.7 1.7 0 0 1-.026-.292V4.5c0-.951.38-1.814.995-2.444L4.72 1.28a.75.75 0 0 1 0-1.06m.53 6.28a.75.75 0 0 0-.75.75V11a3.5 3.5 0 1 0 7 0V7.25a.75.75 0 0 0-.75-.75ZM6.173 5h3.654A.17.17 0 0 0 10 4.827V4.5a2 2 0 1 0-4 0v.327c0 .096.077.173.173.173"/></svg>');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M5 5.782V2.5h-.25a.75.75 0 0 1 0-1.5h6.5a.75.75 0 0 1 0 1.5H11v3.282l3.666 5.76C15.619 13.04 14.543 15 12.767 15H3.233c-1.776 0-2.852-1.96-1.899-3.458Zm-2.4 6.565a.75.75 0 0 0 .633 1.153h9.534a.75.75 0 0 0 .633-1.153L12.225 10.5h-8.45ZM9.5 2.5h-3V6c0 .143-.04.283-.117.403L4.73 9h6.54L9.617 6.403A.75.75 0 0 1 9.5 6Z"/></svg>');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1.75 2.5h10.5a.75.75 0 0 1 0 1.5H1.75a.75.75 0 0 1 0-1.5m4 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5m0 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5M2.5 7.75v6a.75.75 0 0 1-1.5 0v-6a.75.75 0 0 1 1.5 0"/></svg>');}</style><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../assets/_mkdocstrings.css><link rel=stylesheet href=https://unpkg.com/katex@0/dist/katex.min.css><link rel=stylesheet href=../docs.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><meta property=og:type content=website><meta property=og:title content="API - NEAR AI"><meta property=og:description content="NEAR AI Docs - Quickly build and deploy robust AI agents, models, benchmarks, and more."><meta property=og:image content=https://docs.near.ai/assets/images/social/api.png><meta property=og:image:type content=image/png><meta property=og:image:width content=1200><meta property=og:image:height content=630><meta content=https://docs.near.ai/api/ property=og:url><meta name=twitter:card content=summary_large_image><meta name=twitter:title content="API - NEAR AI"><meta name=twitter:description content="NEAR AI Docs - Quickly build and deploy robust AI agents, models, benchmarks, and more."><meta name=twitter:image content=https://docs.near.ai/assets/images/social/api.png></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=black data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#api-reference class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="NEAR AI" class="md-header__button md-logo" aria-label="NEAR AI" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> NEAR AI </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> API </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=black data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=black data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/nearai/nearai/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> nearai </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../agents/quickstart/ class=md-tabs__link> Agents </a> </li> <li class=md-tabs__item> <a href=../models/fine_tuning/ class=md-tabs__link> Models </a> </li> <li class=md-tabs__item> <a href=../assistants/overview/ class=md-tabs__link> Assistants </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=./ class=md-tabs__link> API </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="NEAR AI" class="md-nav__button md-logo" aria-label="NEAR AI" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> NEAR AI </label> <div class=md-nav__source> <a href=https://github.com/nearai/nearai/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> nearai </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=.. class=md-nav__link> <span class=md-ellipsis> Home </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../agents/quickstart/ class=md-nav__link> <span class=md-ellipsis> Agents </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../models/fine_tuning/ class=md-nav__link> <span class=md-ellipsis> Models </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../assistants/overview/ class=md-nav__link> <span class=md-ellipsis> Assistants </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> API </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> API </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#nearai class=md-nav__link> <span class=md-ellipsis> nearai </span> </a> <nav class=md-nav aria-label=nearai> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.EntryLocation class=md-nav__link> <span class=md-ellipsis> EntryLocation </span> </a> <nav class=md-nav aria-label=EntryLocation> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.EntryLocation.from_dict class=md-nav__link> <span class=md-ellipsis> from_dict </span> </a> </li> <li class=md-nav__item> <a href=#nearai.EntryLocation.from_json class=md-nav__link> <span class=md-ellipsis> from_json </span> </a> </li> <li class=md-nav__item> <a href=#nearai.EntryLocation.to_dict class=md-nav__link> <span class=md-ellipsis> to_dict </span> </a> </li> <li class=md-nav__item> <a href=#nearai.EntryLocation.to_json class=md-nav__link> <span class=md-ellipsis> to_json </span> </a> </li> <li class=md-nav__item> <a href=#nearai.EntryLocation.to_str class=md-nav__link> <span class=md-ellipsis> to_str </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.parse_location class=md-nav__link> <span class=md-ellipsis> parse_location </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents class=md-nav__link> <span class=md-ellipsis> agents </span> </a> <nav class=md-nav aria-label=agents> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.agents.agent class=md-nav__link> <span class=md-ellipsis> agent </span> </a> <nav class=md-nav aria-label=agent> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.agents.agent.Agent class=md-nav__link> <span class=md-ellipsis> Agent </span> </a> <nav class=md-nav aria-label=Agent> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.agents.agent.Agent.get_full_name class=md-nav__link> <span class=md-ellipsis> get_full_name </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.agent.Agent.load_agent class=md-nav__link> <span class=md-ellipsis> load_agent </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.agent.Agent.load_agents class=md-nav__link> <span class=md-ellipsis> load_agents </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.agent.Agent.run class=md-nav__link> <span class=md-ellipsis> run </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.agent.Agent.run_python_code class=md-nav__link> <span class=md-ellipsis> run_python_code </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.agent.Agent.run_ts_agent class=md-nav__link> <span class=md-ellipsis> run_ts_agent </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.agent.Agent.set_agent_metadata class=md-nav__link> <span class=md-ellipsis> set_agent_metadata </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.agent.Agent.write_agent_files_to_temp class=md-nav__link> <span class=md-ellipsis> write_agent_files_to_temp </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.agents.environment class=md-nav__link> <span class=md-ellipsis> environment </span> </a> <nav class=md-nav aria-label=environment> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment class=md-nav__link> <span class=md-ellipsis> Environment </span> </a> <nav class=md-nav aria-label=Environment> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.__init__ class=md-nav__link> <span class=md-ellipsis> __init__ </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.add_agent_log class=md-nav__link> <span class=md-ellipsis> add_agent_log </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.add_agent_start_system_log class=md-nav__link> <span class=md-ellipsis> add_agent_start_system_log </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.add_message class=md-nav__link> <span class=md-ellipsis> add_message </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.add_system_log class=md-nav__link> <span class=md-ellipsis> add_system_log </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.call_agent class=md-nav__link> <span class=md-ellipsis> call_agent </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.clear_temp_agent_files class=md-nav__link> <span class=md-ellipsis> clear_temp_agent_files </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.completion class=md-nav__link> <span class=md-ellipsis> completion </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.completion_and_get_tools_calls class=md-nav__link> <span class=md-ellipsis> completion_and_get_tools_calls </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.completion_and_run_tools class=md-nav__link> <span class=md-ellipsis> completion_and_run_tools </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.completions class=md-nav__link> <span class=md-ellipsis> completions </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.completions_and_run_tools class=md-nav__link> <span class=md-ellipsis> completions_and_run_tools </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.create_snapshot class=md-nav__link> <span class=md-ellipsis> create_snapshot </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.environment_run_info class=md-nav__link> <span class=md-ellipsis> environment_run_info </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.exec_command class=md-nav__link> <span class=md-ellipsis> exec_command </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.generate_folder_hash_id class=md-nav__link> <span class=md-ellipsis> generate_folder_hash_id </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.get_agent_temp_path class=md-nav__link> <span class=md-ellipsis> get_agent_temp_path </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.get_agents class=md-nav__link> <span class=md-ellipsis> get_agents </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.get_inference_parameters class=md-nav__link> <span class=md-ellipsis> get_inference_parameters </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.get_last_message class=md-nav__link> <span class=md-ellipsis> get_last_message </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.get_primary_agent class=md-nav__link> <span class=md-ellipsis> get_primary_agent </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.get_primary_agent_temp_dir class=md-nav__link> <span class=md-ellipsis> get_primary_agent_temp_dir </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.get_system_path class=md-nav__link> <span class=md-ellipsis> get_system_path </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.get_tool_registry class=md-nav__link> <span class=md-ellipsis> get_tool_registry </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.list_files class=md-nav__link> <span class=md-ellipsis> list_files </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.list_messages class=md-nav__link> <span class=md-ellipsis> list_messages </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.list_terminal_commands class=md-nav__link> <span class=md-ellipsis> list_terminal_commands </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.load_snapshot class=md-nav__link> <span class=md-ellipsis> load_snapshot </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.read_file class=md-nav__link> <span class=md-ellipsis> read_file </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.run class=md-nav__link> <span class=md-ellipsis> run </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.set_next_actor class=md-nav__link> <span class=md-ellipsis> set_next_actor </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.signed_completion class=md-nav__link> <span class=md-ellipsis> signed_completion </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.verify_message class=md-nav__link> <span class=md-ellipsis> verify_message </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.verify_signed_message class=md-nav__link> <span class=md-ellipsis> verify_signed_message </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.agents.tool_json_helper class=md-nav__link> <span class=md-ellipsis> tool_json_helper </span> </a> <nav class=md-nav aria-label=tool_json_helper> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.agents.tool_json_helper.parse_json_args class=md-nav__link> <span class=md-ellipsis> parse_json_args </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.tool_json_helper.parse_json_args_based_on_signature class=md-nav__link> <span class=md-ellipsis> parse_json_args_based_on_signature </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.agents.tool_registry class=md-nav__link> <span class=md-ellipsis> tool_registry </span> </a> <nav class=md-nav aria-label=tool_registry> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.agents.tool_registry.ToolRegistry class=md-nav__link> <span class=md-ellipsis> ToolRegistry </span> </a> <nav class=md-nav aria-label=ToolRegistry> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.agents.tool_registry.ToolRegistry.call_tool class=md-nav__link> <span class=md-ellipsis> call_tool </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.tool_registry.ToolRegistry.get_all_tools class=md-nav__link> <span class=md-ellipsis> get_all_tools </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.tool_registry.ToolRegistry.get_tool class=md-nav__link> <span class=md-ellipsis> get_tool </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.tool_registry.ToolRegistry.get_tool_definition class=md-nav__link> <span class=md-ellipsis> get_tool_definition </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.tool_registry.ToolRegistry.register_tool class=md-nav__link> <span class=md-ellipsis> register_tool </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.cli class=md-nav__link> <span class=md-ellipsis> cli </span> </a> <nav class=md-nav aria-label=cli> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.cli.AgentCli class=md-nav__link> <span class=md-ellipsis> AgentCli </span> </a> <nav class=md-nav aria-label=AgentCli> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.cli.AgentCli._create_new_agent class=md-nav__link> <span class=md-ellipsis> _create_new_agent </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.AgentCli._fork_agent class=md-nav__link> <span class=md-ellipsis> _fork_agent </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.AgentCli._task class=md-nav__link> <span class=md-ellipsis> _task </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.AgentCli.create class=md-nav__link> <span class=md-ellipsis> create </span> </a> <nav class=md-nav aria-label=create> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.cli.AgentCli.create--examples class=md-nav__link> <span class=md-ellipsis> Examples </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.cli.AgentCli.dev class=md-nav__link> <span class=md-ellipsis> dev </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.AgentCli.inspect class=md-nav__link> <span class=md-ellipsis> inspect </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.AgentCli.interactive class=md-nav__link> <span class=md-ellipsis> interactive </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.AgentCli.task class=md-nav__link> <span class=md-ellipsis> task </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.cli.BenchmarkCli class=md-nav__link> <span class=md-ellipsis> BenchmarkCli </span> </a> <nav class=md-nav aria-label=BenchmarkCli> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.cli.BenchmarkCli.__init__ class=md-nav__link> <span class=md-ellipsis> __init__ </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.BenchmarkCli.list class=md-nav__link> <span class=md-ellipsis> list </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.BenchmarkCli.run class=md-nav__link> <span class=md-ellipsis> run </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.cli.CLI class=md-nav__link> <span class=md-ellipsis> CLI </span> </a> <nav class=md-nav aria-label=CLI> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.cli.CLI.location class=md-nav__link> <span class=md-ellipsis> location </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.CLI.submit class=md-nav__link> <span class=md-ellipsis> submit </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.CLI.task class=md-nav__link> <span class=md-ellipsis> task </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.CLI.version class=md-nav__link> <span class=md-ellipsis> version </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.cli.ConfigCli class=md-nav__link> <span class=md-ellipsis> ConfigCli </span> </a> <nav class=md-nav aria-label=ConfigCli> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.cli.ConfigCli.get class=md-nav__link> <span class=md-ellipsis> get </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.ConfigCli.set class=md-nav__link> <span class=md-ellipsis> set </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.cli.EvaluationCli class=md-nav__link> <span class=md-ellipsis> EvaluationCli </span> </a> <nav class=md-nav aria-label=EvaluationCli> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.cli.EvaluationCli.read_solutions class=md-nav__link> <span class=md-ellipsis> read_solutions </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.EvaluationCli.table class=md-nav__link> <span class=md-ellipsis> table </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.cli.HubCLI class=md-nav__link> <span class=md-ellipsis> HubCLI </span> </a> <nav class=md-nav aria-label=HubCLI> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.cli.HubCLI.chat class=md-nav__link> <span class=md-ellipsis> chat </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.cli.LoginCLI class=md-nav__link> <span class=md-ellipsis> LoginCLI </span> </a> <nav class=md-nav aria-label=LoginCLI> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.cli.LoginCLI.__call__ class=md-nav__link> <span class=md-ellipsis> __call__ </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.LoginCLI.save class=md-nav__link> <span class=md-ellipsis> save </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.LoginCLI.status class=md-nav__link> <span class=md-ellipsis> status </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.cli.LogoutCLI class=md-nav__link> <span class=md-ellipsis> LogoutCLI </span> </a> <nav class=md-nav aria-label=LogoutCLI> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.cli.LogoutCLI.__call__ class=md-nav__link> <span class=md-ellipsis> __call__ </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.cli.PermissionCli class=md-nav__link> <span class=md-ellipsis> PermissionCli </span> </a> <nav class=md-nav aria-label=PermissionCli> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.cli.PermissionCli.grant class=md-nav__link> <span class=md-ellipsis> grant </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.PermissionCli.revoke class=md-nav__link> <span class=md-ellipsis> revoke </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.cli.RegistryCli class=md-nav__link> <span class=md-ellipsis> RegistryCli </span> </a> <nav class=md-nav aria-label=RegistryCli> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.cli.RegistryCli.download class=md-nav__link> <span class=md-ellipsis> download </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.RegistryCli.info class=md-nav__link> <span class=md-ellipsis> info </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.RegistryCli.list class=md-nav__link> <span class=md-ellipsis> list </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.RegistryCli.metadata_template class=md-nav__link> <span class=md-ellipsis> metadata_template </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.RegistryCli.update class=md-nav__link> <span class=md-ellipsis> update </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.RegistryCli.upload class=md-nav__link> <span class=md-ellipsis> upload </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.RegistryCli.upload_unregistered_common_provider_models class=md-nav__link> <span class=md-ellipsis> upload_unregistered_common_provider_models </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.cli.assert_user_auth class=md-nav__link> <span class=md-ellipsis> assert_user_auth </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.check_update class=md-nav__link> <span class=md-ellipsis> check_update </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.cli_helpers class=md-nav__link> <span class=md-ellipsis> cli_helpers </span> </a> <nav class=md-nav aria-label=cli_helpers> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.cli_helpers.display_agents_in_columns class=md-nav__link> <span class=md-ellipsis> display_agents_in_columns </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.config class=md-nav__link> <span class=md-ellipsis> config </span> </a> <nav class=md-nav aria-label=config> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.config.Config class=md-nav__link> <span class=md-ellipsis> Config </span> </a> <nav class=md-nav aria-label=Config> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.config.Config.get class=md-nav__link> <span class=md-ellipsis> get </span> </a> </li> <li class=md-nav__item> <a href=#nearai.config.Config.update_with class=md-nav__link> <span class=md-ellipsis> update_with </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.config.NearAiHubConfig class=md-nav__link> <span class=md-ellipsis> NearAiHubConfig </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.dataset class=md-nav__link> <span class=md-ellipsis> dataset </span> </a> <nav class=md-nav aria-label=dataset> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.dataset.get_dataset class=md-nav__link> <span class=md-ellipsis> get_dataset </span> </a> </li> <li class=md-nav__item> <a href=#nearai.dataset.load_dataset class=md-nav__link> <span class=md-ellipsis> load_dataset </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.delegation class=md-nav__link> <span class=md-ellipsis> delegation </span> </a> <nav class=md-nav aria-label=delegation> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.delegation.OnBehalfOf class=md-nav__link> <span class=md-ellipsis> OnBehalfOf </span> </a> <nav class=md-nav aria-label=OnBehalfOf> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.delegation.OnBehalfOf.__enter__ class=md-nav__link> <span class=md-ellipsis> __enter__ </span> </a> </li> <li class=md-nav__item> <a href=#nearai.delegation.OnBehalfOf.__exit__ class=md-nav__link> <span class=md-ellipsis> __exit__ </span> </a> </li> <li class=md-nav__item> <a href=#nearai.delegation.OnBehalfOf.__init__ class=md-nav__link> <span class=md-ellipsis> __init__ </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.delegation.check_on_behalf_of class=md-nav__link> <span class=md-ellipsis> check_on_behalf_of </span> </a> </li> <li class=md-nav__item> <a href=#nearai.delegation.revoke_delegation class=md-nav__link> <span class=md-ellipsis> revoke_delegation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.evaluation class=md-nav__link> <span class=md-ellipsis> evaluation </span> </a> <nav class=md-nav aria-label=evaluation> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.evaluation._print_metrics_tables class=md-nav__link> <span class=md-ellipsis> _print_metrics_tables </span> </a> </li> <li class=md-nav__item> <a href=#nearai.evaluation._shorten_metric_name class=md-nav__link> <span class=md-ellipsis> _shorten_metric_name </span> </a> </li> <li class=md-nav__item> <a href=#nearai.evaluation.load_benchmark_entry_info class=md-nav__link> <span class=md-ellipsis> load_benchmark_entry_info </span> </a> </li> <li class=md-nav__item> <a href=#nearai.evaluation.print_evaluation_table class=md-nav__link> <span class=md-ellipsis> print_evaluation_table </span> </a> </li> <li class=md-nav__item> <a href=#nearai.evaluation.record_evaluation_metrics class=md-nav__link> <span class=md-ellipsis> record_evaluation_metrics </span> </a> </li> <li class=md-nav__item> <a href=#nearai.evaluation.record_single_score_evaluation class=md-nav__link> <span class=md-ellipsis> record_single_score_evaluation </span> </a> </li> <li class=md-nav__item> <a href=#nearai.evaluation.upload_evaluation class=md-nav__link> <span class=md-ellipsis> upload_evaluation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.finetune class=md-nav__link> <span class=md-ellipsis> finetune </span> </a> <nav class=md-nav aria-label=finetune> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.finetune.FinetuneCli class=md-nav__link> <span class=md-ellipsis> FinetuneCli </span> </a> <nav class=md-nav aria-label=FinetuneCli> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.finetune.FinetuneCli.start class=md-nav__link> <span class=md-ellipsis> start </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.finetune.parse_line class=md-nav__link> <span class=md-ellipsis> parse_line </span> </a> </li> <li class=md-nav__item> <a href=#nearai.finetune.text_completion class=md-nav__link> <span class=md-ellipsis> text_completion </span> </a> <nav class=md-nav aria-label=text_completion> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.finetune.text_completion.TextCompletionDataset class=md-nav__link> <span class=md-ellipsis> TextCompletionDataset </span> </a> </li> <li class=md-nav__item> <a href=#nearai.finetune.text_completion.truncate class=md-nav__link> <span class=md-ellipsis> truncate </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.hub class=md-nav__link> <span class=md-ellipsis> hub </span> </a> <nav class=md-nav aria-label=hub> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.hub.Hub class=md-nav__link> <span class=md-ellipsis> Hub </span> </a> <nav class=md-nav aria-label=Hub> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.hub.Hub.__init__ class=md-nav__link> <span class=md-ellipsis> __init__ </span> </a> </li> <li class=md-nav__item> <a href=#nearai.hub.Hub.chat class=md-nav__link> <span class=md-ellipsis> chat </span> </a> </li> <li class=md-nav__item> <a href=#nearai.hub.Hub.parse_hub_chat_params class=md-nav__link> <span class=md-ellipsis> parse_hub_chat_params </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.lib class=md-nav__link> <span class=md-ellipsis> lib </span> </a> <nav class=md-nav aria-label=lib> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.lib.parse_location class=md-nav__link> <span class=md-ellipsis> parse_location </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.login class=md-nav__link> <span class=md-ellipsis> login </span> </a> <nav class=md-nav aria-label=login> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.login.AuthHandler class=md-nav__link> <span class=md-ellipsis> AuthHandler </span> </a> <nav class=md-nav aria-label=AuthHandler> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.login.AuthHandler.do_GET class=md-nav__link> <span class=md-ellipsis> do_GET </span> </a> </li> <li class=md-nav__item> <a href=#nearai.login.AuthHandler.log_message class=md-nav__link> <span class=md-ellipsis> log_message </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.login.find_open_port class=md-nav__link> <span class=md-ellipsis> find_open_port </span> </a> </li> <li class=md-nav__item> <a href=#nearai.login.generate_and_save_signature class=md-nav__link> <span class=md-ellipsis> generate_and_save_signature </span> </a> </li> <li class=md-nav__item> <a href=#nearai.login.generate_callback_url class=md-nav__link> <span class=md-ellipsis> generate_callback_url </span> </a> </li> <li class=md-nav__item> <a href=#nearai.login.generate_nonce class=md-nav__link> <span class=md-ellipsis> generate_nonce </span> </a> </li> <li class=md-nav__item> <a href=#nearai.login.login_with_file_credentials class=md-nav__link> <span class=md-ellipsis> login_with_file_credentials </span> </a> </li> <li class=md-nav__item> <a href=#nearai.login.login_with_near_auth class=md-nav__link> <span class=md-ellipsis> login_with_near_auth </span> </a> </li> <li class=md-nav__item> <a href=#nearai.login.print_login_status class=md-nav__link> <span class=md-ellipsis> print_login_status </span> </a> </li> <li class=md-nav__item> <a href=#nearai.login.print_url_message class=md-nav__link> <span class=md-ellipsis> print_url_message </span> </a> </li> <li class=md-nav__item> <a href=#nearai.login.update_auth_config class=md-nav__link> <span class=md-ellipsis> update_auth_config </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.model class=md-nav__link> <span class=md-ellipsis> model </span> </a> <nav class=md-nav aria-label=model> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.model.get_model class=md-nav__link> <span class=md-ellipsis> get_model </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.registry class=md-nav__link> <span class=md-ellipsis> registry </span> </a> <nav class=md-nav aria-label=registry> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.registry.Registry class=md-nav__link> <span class=md-ellipsis> Registry </span> </a> <nav class=md-nav aria-label=Registry> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.registry.Registry.__init__ class=md-nav__link> <span class=md-ellipsis> __init__ </span> </a> </li> <li class=md-nav__item> <a href=#nearai.registry.Registry.dict_models class=md-nav__link> <span class=md-ellipsis> dict_models </span> </a> </li> <li class=md-nav__item> <a href=#nearai.registry.Registry.download class=md-nav__link> <span class=md-ellipsis> download </span> </a> </li> <li class=md-nav__item> <a href=#nearai.registry.Registry.download_file class=md-nav__link> <span class=md-ellipsis> download_file </span> </a> </li> <li class=md-nav__item> <a href=#nearai.registry.Registry.info class=md-nav__link> <span class=md-ellipsis> info </span> </a> </li> <li class=md-nav__item> <a href=#nearai.registry.Registry.list class=md-nav__link> <span class=md-ellipsis> list </span> </a> </li> <li class=md-nav__item> <a href=#nearai.registry.Registry.list_all_visible class=md-nav__link> <span class=md-ellipsis> list_all_visible </span> </a> </li> <li class=md-nav__item> <a href=#nearai.registry.Registry.list_files class=md-nav__link> <span class=md-ellipsis> list_files </span> </a> </li> <li class=md-nav__item> <a href=#nearai.registry.Registry.update class=md-nav__link> <span class=md-ellipsis> update </span> </a> </li> <li class=md-nav__item> <a href=#nearai.registry.Registry.upload class=md-nav__link> <span class=md-ellipsis> upload </span> </a> </li> <li class=md-nav__item> <a href=#nearai.registry.Registry.upload_file class=md-nav__link> <span class=md-ellipsis> upload_file </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.registry.get_namespace class=md-nav__link> <span class=md-ellipsis> get_namespace </span> </a> </li> <li class=md-nav__item> <a href=#nearai.registry.get_registry_folder class=md-nav__link> <span class=md-ellipsis> get_registry_folder </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.shared class=md-nav__link> <span class=md-ellipsis> shared </span> </a> <nav class=md-nav aria-label=shared> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.shared.auth_data class=md-nav__link> <span class=md-ellipsis> auth_data </span> </a> <nav class=md-nav aria-label=auth_data> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.shared.auth_data.AuthData class=md-nav__link> <span class=md-ellipsis> AuthData </span> </a> <nav class=md-nav aria-label=AuthData> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.shared.auth_data.AuthData.namespace class=md-nav__link> <span class=md-ellipsis> namespace </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.auth_data.AuthData.generate_bearer_token class=md-nav__link> <span class=md-ellipsis> generate_bearer_token </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.shared.cache class=md-nav__link> <span class=md-ellipsis> cache </span> </a> <nav class=md-nav aria-label=cache> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.shared.cache.mem_cache_with_timeout class=md-nav__link> <span class=md-ellipsis> mem_cache_with_timeout </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.shared.client_config class=md-nav__link> <span class=md-ellipsis> client_config </span> </a> <nav class=md-nav aria-label=client_config> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.shared.client_config.ClientConfig class=md-nav__link> <span class=md-ellipsis> ClientConfig </span> </a> <nav class=md-nav aria-label=ClientConfig> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.shared.client_config.ClientConfig.get_hub_client class=md-nav__link> <span class=md-ellipsis> get_hub_client </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client class=md-nav__link> <span class=md-ellipsis> inference_client </span> </a> <nav class=md-nav aria-label=inference_client> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient class=md-nav__link> <span class=md-ellipsis> InferenceClient </span> </a> <nav class=md-nav aria-label=InferenceClient> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.add_file_to_vector_store class=md-nav__link> <span class=md-ellipsis> add_file_to_vector_store </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.add_user_memory class=md-nav__link> <span class=md-ellipsis> add_user_memory </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.completions class=md-nav__link> <span class=md-ellipsis> completions </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.create_subthread class=md-nav__link> <span class=md-ellipsis> create_subthread </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.create_thread class=md-nav__link> <span class=md-ellipsis> create_thread </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.create_vector_store class=md-nav__link> <span class=md-ellipsis> create_vector_store </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.create_vector_store_from_source class=md-nav__link> <span class=md-ellipsis> create_vector_store_from_source </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.find_agents class=md-nav__link> <span class=md-ellipsis> find_agents </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.generate_auth_for_current_agent class=md-nav__link> <span class=md-ellipsis> generate_auth_for_current_agent </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.generate_image class=md-nav__link> <span class=md-ellipsis> generate_image </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.get_agent_data class=md-nav__link> <span class=md-ellipsis> get_agent_data </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.get_agent_data_by_key class=md-nav__link> <span class=md-ellipsis> get_agent_data_by_key </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.get_agent_public_key class=md-nav__link> <span class=md-ellipsis> get_agent_public_key </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.get_thread class=md-nav__link> <span class=md-ellipsis> get_thread </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.get_vector_store class=md-nav__link> <span class=md-ellipsis> get_vector_store </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.get_vector_store_files class=md-nav__link> <span class=md-ellipsis> get_vector_store_files </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.query_user_memory class=md-nav__link> <span class=md-ellipsis> query_user_memory </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.query_vector_store class=md-nav__link> <span class=md-ellipsis> query_vector_store </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.remove_file class=md-nav__link> <span class=md-ellipsis> remove_file </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.run_agent class=md-nav__link> <span class=md-ellipsis> run_agent </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.save_agent_data class=md-nav__link> <span class=md-ellipsis> save_agent_data </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.schedule_run class=md-nav__link> <span class=md-ellipsis> schedule_run </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.set_provider_models class=md-nav__link> <span class=md-ellipsis> set_provider_models </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.threads_create_and_run_poll class=md-nav__link> <span class=md-ellipsis> threads_create_and_run_poll </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.threads_fork class=md-nav__link> <span class=md-ellipsis> threads_fork </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.threads_list_messages class=md-nav__link> <span class=md-ellipsis> threads_list_messages </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.threads_messages_create class=md-nav__link> <span class=md-ellipsis> threads_messages_create </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.threads_runs_create class=md-nav__link> <span class=md-ellipsis> threads_runs_create </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.upload_file class=md-nav__link> <span class=md-ellipsis> upload_file </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.shared.models class=md-nav__link> <span class=md-ellipsis> models </span> </a> <nav class=md-nav aria-label=models> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.shared.models.AutoFileChunkingStrategyParam class=md-nav__link> <span class=md-ellipsis> AutoFileChunkingStrategyParam </span> </a> <nav class=md-nav aria-label=AutoFileChunkingStrategyParam> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.shared.models.AutoFileChunkingStrategyParam.type class=md-nav__link> <span class=md-ellipsis> type </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.shared.models.ChunkingStrategy class=md-nav__link> <span class=md-ellipsis> ChunkingStrategy </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.models.CreateVectorStoreRequest class=md-nav__link> <span class=md-ellipsis> CreateVectorStoreRequest </span> </a> <nav class=md-nav aria-label=CreateVectorStoreRequest> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.shared.models.CreateVectorStoreRequest.chunking_strategy class=md-nav__link> <span class=md-ellipsis> chunking_strategy </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.models.CreateVectorStoreRequest.expires_after class=md-nav__link> <span class=md-ellipsis> expires_after </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.models.CreateVectorStoreRequest.file_ids class=md-nav__link> <span class=md-ellipsis> file_ids </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.models.CreateVectorStoreRequest.metadata class=md-nav__link> <span class=md-ellipsis> metadata </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.models.CreateVectorStoreRequest.name class=md-nav__link> <span class=md-ellipsis> name </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.shared.models.ExpiresAfter class=md-nav__link> <span class=md-ellipsis> ExpiresAfter </span> </a> <nav class=md-nav aria-label=ExpiresAfter> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.shared.models.ExpiresAfter.anchor class=md-nav__link> <span class=md-ellipsis> anchor </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.models.ExpiresAfter.days class=md-nav__link> <span class=md-ellipsis> days </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.shared.models.StaticFileChunkingStrategyParam class=md-nav__link> <span class=md-ellipsis> StaticFileChunkingStrategyParam </span> </a> <nav class=md-nav aria-label=StaticFileChunkingStrategyParam> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.shared.models.StaticFileChunkingStrategyParam.chunk_overlap_tokens class=md-nav__link> <span class=md-ellipsis> chunk_overlap_tokens </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.models.StaticFileChunkingStrategyParam.max_chunk_size_tokens class=md-nav__link> <span class=md-ellipsis> max_chunk_size_tokens </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.shared.models.VectorStoreFileCreate class=md-nav__link> <span class=md-ellipsis> VectorStoreFileCreate </span> </a> <nav class=md-nav aria-label=VectorStoreFileCreate> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.shared.models.VectorStoreFileCreate.file_id class=md-nav__link> <span class=md-ellipsis> file_id </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.shared.naming class=md-nav__link> <span class=md-ellipsis> naming </span> </a> <nav class=md-nav aria-label=naming> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.shared.naming.NamespacedName class=md-nav__link> <span class=md-ellipsis> NamespacedName </span> </a> <nav class=md-nav aria-label=NamespacedName> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.shared.naming.NamespacedName.canonical class=md-nav__link> <span class=md-ellipsis> canonical </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.shared.naming.create_registry_name class=md-nav__link> <span class=md-ellipsis> create_registry_name </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.naming.get_canonical_name class=md-nav__link> <span class=md-ellipsis> get_canonical_name </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.shared.near class=md-nav__link> <span class=md-ellipsis> near </span> </a> <nav class=md-nav aria-label=near> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.shared.near.sign class=md-nav__link> <span class=md-ellipsis> sign </span> </a> <nav class=md-nav aria-label=sign> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.shared.near.sign.SignatureVerificationResult class=md-nav__link> <span class=md-ellipsis> SignatureVerificationResult </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.near.sign.convert_nonce class=md-nav__link> <span class=md-ellipsis> convert_nonce </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.near.sign.create_inference_signature class=md-nav__link> <span class=md-ellipsis> create_inference_signature </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.near.sign.create_signature class=md-nav__link> <span class=md-ellipsis> create_signature </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.near.sign.validate_completion_signature class=md-nav__link> <span class=md-ellipsis> validate_completion_signature </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.near.sign.validate_nonce class=md-nav__link> <span class=md-ellipsis> validate_nonce </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.near.sign.validate_signature class=md-nav__link> <span class=md-ellipsis> validate_signature </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.near.sign.verify_access_key_owner class=md-nav__link> <span class=md-ellipsis> verify_access_key_owner </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.near.sign.verify_signed_message class=md-nav__link> <span class=md-ellipsis> verify_signed_message </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.shared.provider_models class=md-nav__link> <span class=md-ellipsis> provider_models </span> </a> <nav class=md-nav aria-label=provider_models> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.shared.provider_models.ProviderModels class=md-nav__link> <span class=md-ellipsis> ProviderModels </span> </a> <nav class=md-nav aria-label=ProviderModels> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.shared.provider_models.ProviderModels.provider_models class=md-nav__link> <span class=md-ellipsis> provider_models </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.provider_models.ProviderModels.available_provider_matches class=md-nav__link> <span class=md-ellipsis> available_provider_matches </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.provider_models.ProviderModels.get_unregistered_common_provider_models class=md-nav__link> <span class=md-ellipsis> get_unregistered_common_provider_models </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.provider_models.ProviderModels.match_provider_model class=md-nav__link> <span class=md-ellipsis> match_provider_model </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.shared.provider_models.get_provider_model class=md-nav__link> <span class=md-ellipsis> get_provider_model </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.provider_models.get_provider_namespaced_model class=md-nav__link> <span class=md-ellipsis> get_provider_namespaced_model </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.solvers class=md-nav__link> <span class=md-ellipsis> solvers </span> </a> <nav class=md-nav aria-label=solvers> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.solvers.DDOTSV0Solver class=md-nav__link> <span class=md-ellipsis> DDOTSV0Solver </span> </a> </li> <li class=md-nav__item> <a href=#nearai.solvers.GSM8KSolverStrategy class=md-nav__link> <span class=md-ellipsis> GSM8KSolverStrategy </span> </a> </li> <li class=md-nav__item> <a href=#nearai.solvers.HellaswagSolverStrategy class=md-nav__link> <span class=md-ellipsis> HellaswagSolverStrategy </span> </a> </li> <li class=md-nav__item> <a href=#nearai.solvers.LeanSolverStrategy class=md-nav__link> <span class=md-ellipsis> LeanSolverStrategy </span> </a> </li> <li class=md-nav__item> <a href=#nearai.solvers.LiveBenchSolverStrategy class=md-nav__link> <span class=md-ellipsis> LiveBenchSolverStrategy </span> </a> </li> <li class=md-nav__item> <a href=#nearai.solvers.MBPPSolverStrategy class=md-nav__link> <span class=md-ellipsis> MBPPSolverStrategy </span> </a> </li> <li class=md-nav__item> <a href=#nearai.solvers.MMLUSolverStrategy class=md-nav__link> <span class=md-ellipsis> MMLUSolverStrategy </span> </a> </li> <li class=md-nav__item> <a href=#nearai.solvers.SolverStrategy class=md-nav__link> <span class=md-ellipsis> SolverStrategy </span> </a> <nav class=md-nav aria-label=SolverStrategy> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.solvers.SolverStrategy.name class=md-nav__link> <span class=md-ellipsis> name </span> </a> </li> <li class=md-nav__item> <a href=#nearai.solvers.SolverStrategy.agent_name class=md-nav__link> <span class=md-ellipsis> agent_name </span> </a> </li> <li class=md-nav__item> <a href=#nearai.solvers.SolverStrategy.agent_version class=md-nav__link> <span class=md-ellipsis> agent_version </span> </a> </li> <li class=md-nav__item> <a href=#nearai.solvers.SolverStrategy.compatible_datasets class=md-nav__link> <span class=md-ellipsis> compatible_datasets </span> </a> </li> <li class=md-nav__item> <a href=#nearai.solvers.SolverStrategy.evaluated_entry_namespace class=md-nav__link> <span class=md-ellipsis> evaluated_entry_namespace </span> </a> </li> <li class=md-nav__item> <a href=#nearai.solvers.SolverStrategy.evaluation_name class=md-nav__link> <span class=md-ellipsis> evaluation_name </span> </a> </li> <li class=md-nav__item> <a href=#nearai.solvers.SolverStrategy.get_custom_tasks class=md-nav__link> <span class=md-ellipsis> get_custom_tasks </span> </a> </li> <li class=md-nav__item> <a href=#nearai.solvers.SolverStrategy.get_evaluation_metrics class=md-nav__link> <span class=md-ellipsis> get_evaluation_metrics </span> </a> </li> <li class=md-nav__item> <a href=#nearai.solvers.SolverStrategy.model_provider class=md-nav__link> <span class=md-ellipsis> model_provider </span> </a> </li> <li class=md-nav__item> <a href=#nearai.solvers.SolverStrategy.solve class=md-nav__link> <span class=md-ellipsis> solve </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.solvers.SolverStrategyMeta class=md-nav__link> <span class=md-ellipsis> SolverStrategyMeta </span> </a> </li> <li class=md-nav__item> <a href=#nearai.solvers.ddot_v0_solver class=md-nav__link> <span class=md-ellipsis> ddot_v0_solver </span> </a> <nav class=md-nav aria-label=ddot_v0_solver> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.solvers.ddot_v0_solver.DDOTSEnvironment class=md-nav__link> <span class=md-ellipsis> DDOTSEnvironment </span> </a> <nav class=md-nav aria-label=DDOTSEnvironment> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.solvers.ddot_v0_solver.DDOTSEnvironment.submit_python class=md-nav__link> <span class=md-ellipsis> submit_python </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.solvers.ddot_v0_solver.DDOTSV0Solver class=md-nav__link> <span class=md-ellipsis> DDOTSV0Solver </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.solvers.gsm8k_solver class=md-nav__link> <span class=md-ellipsis> gsm8k_solver </span> </a> <nav class=md-nav aria-label=gsm8k_solver> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.solvers.gsm8k_solver.GSM8KSolverStrategy class=md-nav__link> <span class=md-ellipsis> GSM8KSolverStrategy </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.solvers.hellaswag_solver class=md-nav__link> <span class=md-ellipsis> hellaswag_solver </span> </a> <nav class=md-nav aria-label=hellaswag_solver> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.solvers.hellaswag_solver.HellaswagSolverStrategy class=md-nav__link> <span class=md-ellipsis> HellaswagSolverStrategy </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.solvers.lean_solver class=md-nav__link> <span class=md-ellipsis> lean_solver </span> </a> <nav class=md-nav aria-label=lean_solver> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.solvers.lean_solver.LeanSolverStrategy class=md-nav__link> <span class=md-ellipsis> LeanSolverStrategy </span> </a> </li> <li class=md-nav__item> <a href=#nearai.solvers.lean_solver.load_theorem class=md-nav__link> <span class=md-ellipsis> load_theorem </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.solvers.livebench_solver class=md-nav__link> <span class=md-ellipsis> livebench_solver </span> </a> <nav class=md-nav aria-label=livebench_solver> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.solvers.livebench_solver.LiveBenchSolverStrategy class=md-nav__link> <span class=md-ellipsis> LiveBenchSolverStrategy </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.solvers.mbpp_solver class=md-nav__link> <span class=md-ellipsis> mbpp_solver </span> </a> <nav class=md-nav aria-label=mbpp_solver> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.solvers.mbpp_solver.MBPPSolverStrategy class=md-nav__link> <span class=md-ellipsis> MBPPSolverStrategy </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.solvers.mmlu_solver class=md-nav__link> <span class=md-ellipsis> mmlu_solver </span> </a> <nav class=md-nav aria-label=mmlu_solver> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.solvers.mmlu_solver.MMLUSolverStrategy class=md-nav__link> <span class=md-ellipsis> MMLUSolverStrategy </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.tests class=md-nav__link> <span class=md-ellipsis> tests </span> </a> <nav class=md-nav aria-label=tests> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.tests.test_provider_models class=md-nav__link> <span class=md-ellipsis> test_provider_models </span> </a> <nav class=md-nav aria-label=test_provider_models> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.tests.test_provider_models.TestMatchProviderModel class=md-nav__link> <span class=md-ellipsis> TestMatchProviderModel </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#nearai class=md-nav__link> <span class=md-ellipsis> nearai </span> </a> <nav class=md-nav aria-label=nearai> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.EntryLocation class=md-nav__link> <span class=md-ellipsis> EntryLocation </span> </a> <nav class=md-nav aria-label=EntryLocation> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.EntryLocation.from_dict class=md-nav__link> <span class=md-ellipsis> from_dict </span> </a> </li> <li class=md-nav__item> <a href=#nearai.EntryLocation.from_json class=md-nav__link> <span class=md-ellipsis> from_json </span> </a> </li> <li class=md-nav__item> <a href=#nearai.EntryLocation.to_dict class=md-nav__link> <span class=md-ellipsis> to_dict </span> </a> </li> <li class=md-nav__item> <a href=#nearai.EntryLocation.to_json class=md-nav__link> <span class=md-ellipsis> to_json </span> </a> </li> <li class=md-nav__item> <a href=#nearai.EntryLocation.to_str class=md-nav__link> <span class=md-ellipsis> to_str </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.parse_location class=md-nav__link> <span class=md-ellipsis> parse_location </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents class=md-nav__link> <span class=md-ellipsis> agents </span> </a> <nav class=md-nav aria-label=agents> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.agents.agent class=md-nav__link> <span class=md-ellipsis> agent </span> </a> <nav class=md-nav aria-label=agent> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.agents.agent.Agent class=md-nav__link> <span class=md-ellipsis> Agent </span> </a> <nav class=md-nav aria-label=Agent> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.agents.agent.Agent.get_full_name class=md-nav__link> <span class=md-ellipsis> get_full_name </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.agent.Agent.load_agent class=md-nav__link> <span class=md-ellipsis> load_agent </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.agent.Agent.load_agents class=md-nav__link> <span class=md-ellipsis> load_agents </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.agent.Agent.run class=md-nav__link> <span class=md-ellipsis> run </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.agent.Agent.run_python_code class=md-nav__link> <span class=md-ellipsis> run_python_code </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.agent.Agent.run_ts_agent class=md-nav__link> <span class=md-ellipsis> run_ts_agent </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.agent.Agent.set_agent_metadata class=md-nav__link> <span class=md-ellipsis> set_agent_metadata </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.agent.Agent.write_agent_files_to_temp class=md-nav__link> <span class=md-ellipsis> write_agent_files_to_temp </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.agents.environment class=md-nav__link> <span class=md-ellipsis> environment </span> </a> <nav class=md-nav aria-label=environment> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment class=md-nav__link> <span class=md-ellipsis> Environment </span> </a> <nav class=md-nav aria-label=Environment> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.__init__ class=md-nav__link> <span class=md-ellipsis> __init__ </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.add_agent_log class=md-nav__link> <span class=md-ellipsis> add_agent_log </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.add_agent_start_system_log class=md-nav__link> <span class=md-ellipsis> add_agent_start_system_log </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.add_message class=md-nav__link> <span class=md-ellipsis> add_message </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.add_system_log class=md-nav__link> <span class=md-ellipsis> add_system_log </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.call_agent class=md-nav__link> <span class=md-ellipsis> call_agent </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.clear_temp_agent_files class=md-nav__link> <span class=md-ellipsis> clear_temp_agent_files </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.completion class=md-nav__link> <span class=md-ellipsis> completion </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.completion_and_get_tools_calls class=md-nav__link> <span class=md-ellipsis> completion_and_get_tools_calls </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.completion_and_run_tools class=md-nav__link> <span class=md-ellipsis> completion_and_run_tools </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.completions class=md-nav__link> <span class=md-ellipsis> completions </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.completions_and_run_tools class=md-nav__link> <span class=md-ellipsis> completions_and_run_tools </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.create_snapshot class=md-nav__link> <span class=md-ellipsis> create_snapshot </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.environment_run_info class=md-nav__link> <span class=md-ellipsis> environment_run_info </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.exec_command class=md-nav__link> <span class=md-ellipsis> exec_command </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.generate_folder_hash_id class=md-nav__link> <span class=md-ellipsis> generate_folder_hash_id </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.get_agent_temp_path class=md-nav__link> <span class=md-ellipsis> get_agent_temp_path </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.get_agents class=md-nav__link> <span class=md-ellipsis> get_agents </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.get_inference_parameters class=md-nav__link> <span class=md-ellipsis> get_inference_parameters </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.get_last_message class=md-nav__link> <span class=md-ellipsis> get_last_message </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.get_primary_agent class=md-nav__link> <span class=md-ellipsis> get_primary_agent </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.get_primary_agent_temp_dir class=md-nav__link> <span class=md-ellipsis> get_primary_agent_temp_dir </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.get_system_path class=md-nav__link> <span class=md-ellipsis> get_system_path </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.get_tool_registry class=md-nav__link> <span class=md-ellipsis> get_tool_registry </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.list_files class=md-nav__link> <span class=md-ellipsis> list_files </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.list_messages class=md-nav__link> <span class=md-ellipsis> list_messages </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.list_terminal_commands class=md-nav__link> <span class=md-ellipsis> list_terminal_commands </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.load_snapshot class=md-nav__link> <span class=md-ellipsis> load_snapshot </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.read_file class=md-nav__link> <span class=md-ellipsis> read_file </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.run class=md-nav__link> <span class=md-ellipsis> run </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.set_next_actor class=md-nav__link> <span class=md-ellipsis> set_next_actor </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.signed_completion class=md-nav__link> <span class=md-ellipsis> signed_completion </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.verify_message class=md-nav__link> <span class=md-ellipsis> verify_message </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.environment.Environment.verify_signed_message class=md-nav__link> <span class=md-ellipsis> verify_signed_message </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.agents.tool_json_helper class=md-nav__link> <span class=md-ellipsis> tool_json_helper </span> </a> <nav class=md-nav aria-label=tool_json_helper> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.agents.tool_json_helper.parse_json_args class=md-nav__link> <span class=md-ellipsis> parse_json_args </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.tool_json_helper.parse_json_args_based_on_signature class=md-nav__link> <span class=md-ellipsis> parse_json_args_based_on_signature </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.agents.tool_registry class=md-nav__link> <span class=md-ellipsis> tool_registry </span> </a> <nav class=md-nav aria-label=tool_registry> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.agents.tool_registry.ToolRegistry class=md-nav__link> <span class=md-ellipsis> ToolRegistry </span> </a> <nav class=md-nav aria-label=ToolRegistry> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.agents.tool_registry.ToolRegistry.call_tool class=md-nav__link> <span class=md-ellipsis> call_tool </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.tool_registry.ToolRegistry.get_all_tools class=md-nav__link> <span class=md-ellipsis> get_all_tools </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.tool_registry.ToolRegistry.get_tool class=md-nav__link> <span class=md-ellipsis> get_tool </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.tool_registry.ToolRegistry.get_tool_definition class=md-nav__link> <span class=md-ellipsis> get_tool_definition </span> </a> </li> <li class=md-nav__item> <a href=#nearai.agents.tool_registry.ToolRegistry.register_tool class=md-nav__link> <span class=md-ellipsis> register_tool </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.cli class=md-nav__link> <span class=md-ellipsis> cli </span> </a> <nav class=md-nav aria-label=cli> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.cli.AgentCli class=md-nav__link> <span class=md-ellipsis> AgentCli </span> </a> <nav class=md-nav aria-label=AgentCli> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.cli.AgentCli._create_new_agent class=md-nav__link> <span class=md-ellipsis> _create_new_agent </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.AgentCli._fork_agent class=md-nav__link> <span class=md-ellipsis> _fork_agent </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.AgentCli._task class=md-nav__link> <span class=md-ellipsis> _task </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.AgentCli.create class=md-nav__link> <span class=md-ellipsis> create </span> </a> <nav class=md-nav aria-label=create> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.cli.AgentCli.create--examples class=md-nav__link> <span class=md-ellipsis> Examples </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.cli.AgentCli.dev class=md-nav__link> <span class=md-ellipsis> dev </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.AgentCli.inspect class=md-nav__link> <span class=md-ellipsis> inspect </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.AgentCli.interactive class=md-nav__link> <span class=md-ellipsis> interactive </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.AgentCli.task class=md-nav__link> <span class=md-ellipsis> task </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.cli.BenchmarkCli class=md-nav__link> <span class=md-ellipsis> BenchmarkCli </span> </a> <nav class=md-nav aria-label=BenchmarkCli> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.cli.BenchmarkCli.__init__ class=md-nav__link> <span class=md-ellipsis> __init__ </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.BenchmarkCli.list class=md-nav__link> <span class=md-ellipsis> list </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.BenchmarkCli.run class=md-nav__link> <span class=md-ellipsis> run </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.cli.CLI class=md-nav__link> <span class=md-ellipsis> CLI </span> </a> <nav class=md-nav aria-label=CLI> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.cli.CLI.location class=md-nav__link> <span class=md-ellipsis> location </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.CLI.submit class=md-nav__link> <span class=md-ellipsis> submit </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.CLI.task class=md-nav__link> <span class=md-ellipsis> task </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.CLI.version class=md-nav__link> <span class=md-ellipsis> version </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.cli.ConfigCli class=md-nav__link> <span class=md-ellipsis> ConfigCli </span> </a> <nav class=md-nav aria-label=ConfigCli> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.cli.ConfigCli.get class=md-nav__link> <span class=md-ellipsis> get </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.ConfigCli.set class=md-nav__link> <span class=md-ellipsis> set </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.cli.EvaluationCli class=md-nav__link> <span class=md-ellipsis> EvaluationCli </span> </a> <nav class=md-nav aria-label=EvaluationCli> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.cli.EvaluationCli.read_solutions class=md-nav__link> <span class=md-ellipsis> read_solutions </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.EvaluationCli.table class=md-nav__link> <span class=md-ellipsis> table </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.cli.HubCLI class=md-nav__link> <span class=md-ellipsis> HubCLI </span> </a> <nav class=md-nav aria-label=HubCLI> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.cli.HubCLI.chat class=md-nav__link> <span class=md-ellipsis> chat </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.cli.LoginCLI class=md-nav__link> <span class=md-ellipsis> LoginCLI </span> </a> <nav class=md-nav aria-label=LoginCLI> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.cli.LoginCLI.__call__ class=md-nav__link> <span class=md-ellipsis> __call__ </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.LoginCLI.save class=md-nav__link> <span class=md-ellipsis> save </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.LoginCLI.status class=md-nav__link> <span class=md-ellipsis> status </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.cli.LogoutCLI class=md-nav__link> <span class=md-ellipsis> LogoutCLI </span> </a> <nav class=md-nav aria-label=LogoutCLI> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.cli.LogoutCLI.__call__ class=md-nav__link> <span class=md-ellipsis> __call__ </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.cli.PermissionCli class=md-nav__link> <span class=md-ellipsis> PermissionCli </span> </a> <nav class=md-nav aria-label=PermissionCli> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.cli.PermissionCli.grant class=md-nav__link> <span class=md-ellipsis> grant </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.PermissionCli.revoke class=md-nav__link> <span class=md-ellipsis> revoke </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.cli.RegistryCli class=md-nav__link> <span class=md-ellipsis> RegistryCli </span> </a> <nav class=md-nav aria-label=RegistryCli> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.cli.RegistryCli.download class=md-nav__link> <span class=md-ellipsis> download </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.RegistryCli.info class=md-nav__link> <span class=md-ellipsis> info </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.RegistryCli.list class=md-nav__link> <span class=md-ellipsis> list </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.RegistryCli.metadata_template class=md-nav__link> <span class=md-ellipsis> metadata_template </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.RegistryCli.update class=md-nav__link> <span class=md-ellipsis> update </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.RegistryCli.upload class=md-nav__link> <span class=md-ellipsis> upload </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.RegistryCli.upload_unregistered_common_provider_models class=md-nav__link> <span class=md-ellipsis> upload_unregistered_common_provider_models </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.cli.assert_user_auth class=md-nav__link> <span class=md-ellipsis> assert_user_auth </span> </a> </li> <li class=md-nav__item> <a href=#nearai.cli.check_update class=md-nav__link> <span class=md-ellipsis> check_update </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.cli_helpers class=md-nav__link> <span class=md-ellipsis> cli_helpers </span> </a> <nav class=md-nav aria-label=cli_helpers> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.cli_helpers.display_agents_in_columns class=md-nav__link> <span class=md-ellipsis> display_agents_in_columns </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.config class=md-nav__link> <span class=md-ellipsis> config </span> </a> <nav class=md-nav aria-label=config> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.config.Config class=md-nav__link> <span class=md-ellipsis> Config </span> </a> <nav class=md-nav aria-label=Config> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.config.Config.get class=md-nav__link> <span class=md-ellipsis> get </span> </a> </li> <li class=md-nav__item> <a href=#nearai.config.Config.update_with class=md-nav__link> <span class=md-ellipsis> update_with </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.config.NearAiHubConfig class=md-nav__link> <span class=md-ellipsis> NearAiHubConfig </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.dataset class=md-nav__link> <span class=md-ellipsis> dataset </span> </a> <nav class=md-nav aria-label=dataset> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.dataset.get_dataset class=md-nav__link> <span class=md-ellipsis> get_dataset </span> </a> </li> <li class=md-nav__item> <a href=#nearai.dataset.load_dataset class=md-nav__link> <span class=md-ellipsis> load_dataset </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.delegation class=md-nav__link> <span class=md-ellipsis> delegation </span> </a> <nav class=md-nav aria-label=delegation> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.delegation.OnBehalfOf class=md-nav__link> <span class=md-ellipsis> OnBehalfOf </span> </a> <nav class=md-nav aria-label=OnBehalfOf> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.delegation.OnBehalfOf.__enter__ class=md-nav__link> <span class=md-ellipsis> __enter__ </span> </a> </li> <li class=md-nav__item> <a href=#nearai.delegation.OnBehalfOf.__exit__ class=md-nav__link> <span class=md-ellipsis> __exit__ </span> </a> </li> <li class=md-nav__item> <a href=#nearai.delegation.OnBehalfOf.__init__ class=md-nav__link> <span class=md-ellipsis> __init__ </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.delegation.check_on_behalf_of class=md-nav__link> <span class=md-ellipsis> check_on_behalf_of </span> </a> </li> <li class=md-nav__item> <a href=#nearai.delegation.revoke_delegation class=md-nav__link> <span class=md-ellipsis> revoke_delegation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.evaluation class=md-nav__link> <span class=md-ellipsis> evaluation </span> </a> <nav class=md-nav aria-label=evaluation> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.evaluation._print_metrics_tables class=md-nav__link> <span class=md-ellipsis> _print_metrics_tables </span> </a> </li> <li class=md-nav__item> <a href=#nearai.evaluation._shorten_metric_name class=md-nav__link> <span class=md-ellipsis> _shorten_metric_name </span> </a> </li> <li class=md-nav__item> <a href=#nearai.evaluation.load_benchmark_entry_info class=md-nav__link> <span class=md-ellipsis> load_benchmark_entry_info </span> </a> </li> <li class=md-nav__item> <a href=#nearai.evaluation.print_evaluation_table class=md-nav__link> <span class=md-ellipsis> print_evaluation_table </span> </a> </li> <li class=md-nav__item> <a href=#nearai.evaluation.record_evaluation_metrics class=md-nav__link> <span class=md-ellipsis> record_evaluation_metrics </span> </a> </li> <li class=md-nav__item> <a href=#nearai.evaluation.record_single_score_evaluation class=md-nav__link> <span class=md-ellipsis> record_single_score_evaluation </span> </a> </li> <li class=md-nav__item> <a href=#nearai.evaluation.upload_evaluation class=md-nav__link> <span class=md-ellipsis> upload_evaluation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.finetune class=md-nav__link> <span class=md-ellipsis> finetune </span> </a> <nav class=md-nav aria-label=finetune> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.finetune.FinetuneCli class=md-nav__link> <span class=md-ellipsis> FinetuneCli </span> </a> <nav class=md-nav aria-label=FinetuneCli> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.finetune.FinetuneCli.start class=md-nav__link> <span class=md-ellipsis> start </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.finetune.parse_line class=md-nav__link> <span class=md-ellipsis> parse_line </span> </a> </li> <li class=md-nav__item> <a href=#nearai.finetune.text_completion class=md-nav__link> <span class=md-ellipsis> text_completion </span> </a> <nav class=md-nav aria-label=text_completion> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.finetune.text_completion.TextCompletionDataset class=md-nav__link> <span class=md-ellipsis> TextCompletionDataset </span> </a> </li> <li class=md-nav__item> <a href=#nearai.finetune.text_completion.truncate class=md-nav__link> <span class=md-ellipsis> truncate </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.hub class=md-nav__link> <span class=md-ellipsis> hub </span> </a> <nav class=md-nav aria-label=hub> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.hub.Hub class=md-nav__link> <span class=md-ellipsis> Hub </span> </a> <nav class=md-nav aria-label=Hub> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.hub.Hub.__init__ class=md-nav__link> <span class=md-ellipsis> __init__ </span> </a> </li> <li class=md-nav__item> <a href=#nearai.hub.Hub.chat class=md-nav__link> <span class=md-ellipsis> chat </span> </a> </li> <li class=md-nav__item> <a href=#nearai.hub.Hub.parse_hub_chat_params class=md-nav__link> <span class=md-ellipsis> parse_hub_chat_params </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.lib class=md-nav__link> <span class=md-ellipsis> lib </span> </a> <nav class=md-nav aria-label=lib> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.lib.parse_location class=md-nav__link> <span class=md-ellipsis> parse_location </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.login class=md-nav__link> <span class=md-ellipsis> login </span> </a> <nav class=md-nav aria-label=login> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.login.AuthHandler class=md-nav__link> <span class=md-ellipsis> AuthHandler </span> </a> <nav class=md-nav aria-label=AuthHandler> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.login.AuthHandler.do_GET class=md-nav__link> <span class=md-ellipsis> do_GET </span> </a> </li> <li class=md-nav__item> <a href=#nearai.login.AuthHandler.log_message class=md-nav__link> <span class=md-ellipsis> log_message </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.login.find_open_port class=md-nav__link> <span class=md-ellipsis> find_open_port </span> </a> </li> <li class=md-nav__item> <a href=#nearai.login.generate_and_save_signature class=md-nav__link> <span class=md-ellipsis> generate_and_save_signature </span> </a> </li> <li class=md-nav__item> <a href=#nearai.login.generate_callback_url class=md-nav__link> <span class=md-ellipsis> generate_callback_url </span> </a> </li> <li class=md-nav__item> <a href=#nearai.login.generate_nonce class=md-nav__link> <span class=md-ellipsis> generate_nonce </span> </a> </li> <li class=md-nav__item> <a href=#nearai.login.login_with_file_credentials class=md-nav__link> <span class=md-ellipsis> login_with_file_credentials </span> </a> </li> <li class=md-nav__item> <a href=#nearai.login.login_with_near_auth class=md-nav__link> <span class=md-ellipsis> login_with_near_auth </span> </a> </li> <li class=md-nav__item> <a href=#nearai.login.print_login_status class=md-nav__link> <span class=md-ellipsis> print_login_status </span> </a> </li> <li class=md-nav__item> <a href=#nearai.login.print_url_message class=md-nav__link> <span class=md-ellipsis> print_url_message </span> </a> </li> <li class=md-nav__item> <a href=#nearai.login.update_auth_config class=md-nav__link> <span class=md-ellipsis> update_auth_config </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.model class=md-nav__link> <span class=md-ellipsis> model </span> </a> <nav class=md-nav aria-label=model> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.model.get_model class=md-nav__link> <span class=md-ellipsis> get_model </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.registry class=md-nav__link> <span class=md-ellipsis> registry </span> </a> <nav class=md-nav aria-label=registry> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.registry.Registry class=md-nav__link> <span class=md-ellipsis> Registry </span> </a> <nav class=md-nav aria-label=Registry> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.registry.Registry.__init__ class=md-nav__link> <span class=md-ellipsis> __init__ </span> </a> </li> <li class=md-nav__item> <a href=#nearai.registry.Registry.dict_models class=md-nav__link> <span class=md-ellipsis> dict_models </span> </a> </li> <li class=md-nav__item> <a href=#nearai.registry.Registry.download class=md-nav__link> <span class=md-ellipsis> download </span> </a> </li> <li class=md-nav__item> <a href=#nearai.registry.Registry.download_file class=md-nav__link> <span class=md-ellipsis> download_file </span> </a> </li> <li class=md-nav__item> <a href=#nearai.registry.Registry.info class=md-nav__link> <span class=md-ellipsis> info </span> </a> </li> <li class=md-nav__item> <a href=#nearai.registry.Registry.list class=md-nav__link> <span class=md-ellipsis> list </span> </a> </li> <li class=md-nav__item> <a href=#nearai.registry.Registry.list_all_visible class=md-nav__link> <span class=md-ellipsis> list_all_visible </span> </a> </li> <li class=md-nav__item> <a href=#nearai.registry.Registry.list_files class=md-nav__link> <span class=md-ellipsis> list_files </span> </a> </li> <li class=md-nav__item> <a href=#nearai.registry.Registry.update class=md-nav__link> <span class=md-ellipsis> update </span> </a> </li> <li class=md-nav__item> <a href=#nearai.registry.Registry.upload class=md-nav__link> <span class=md-ellipsis> upload </span> </a> </li> <li class=md-nav__item> <a href=#nearai.registry.Registry.upload_file class=md-nav__link> <span class=md-ellipsis> upload_file </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.registry.get_namespace class=md-nav__link> <span class=md-ellipsis> get_namespace </span> </a> </li> <li class=md-nav__item> <a href=#nearai.registry.get_registry_folder class=md-nav__link> <span class=md-ellipsis> get_registry_folder </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.shared class=md-nav__link> <span class=md-ellipsis> shared </span> </a> <nav class=md-nav aria-label=shared> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.shared.auth_data class=md-nav__link> <span class=md-ellipsis> auth_data </span> </a> <nav class=md-nav aria-label=auth_data> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.shared.auth_data.AuthData class=md-nav__link> <span class=md-ellipsis> AuthData </span> </a> <nav class=md-nav aria-label=AuthData> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.shared.auth_data.AuthData.namespace class=md-nav__link> <span class=md-ellipsis> namespace </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.auth_data.AuthData.generate_bearer_token class=md-nav__link> <span class=md-ellipsis> generate_bearer_token </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.shared.cache class=md-nav__link> <span class=md-ellipsis> cache </span> </a> <nav class=md-nav aria-label=cache> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.shared.cache.mem_cache_with_timeout class=md-nav__link> <span class=md-ellipsis> mem_cache_with_timeout </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.shared.client_config class=md-nav__link> <span class=md-ellipsis> client_config </span> </a> <nav class=md-nav aria-label=client_config> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.shared.client_config.ClientConfig class=md-nav__link> <span class=md-ellipsis> ClientConfig </span> </a> <nav class=md-nav aria-label=ClientConfig> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.shared.client_config.ClientConfig.get_hub_client class=md-nav__link> <span class=md-ellipsis> get_hub_client </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client class=md-nav__link> <span class=md-ellipsis> inference_client </span> </a> <nav class=md-nav aria-label=inference_client> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient class=md-nav__link> <span class=md-ellipsis> InferenceClient </span> </a> <nav class=md-nav aria-label=InferenceClient> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.add_file_to_vector_store class=md-nav__link> <span class=md-ellipsis> add_file_to_vector_store </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.add_user_memory class=md-nav__link> <span class=md-ellipsis> add_user_memory </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.completions class=md-nav__link> <span class=md-ellipsis> completions </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.create_subthread class=md-nav__link> <span class=md-ellipsis> create_subthread </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.create_thread class=md-nav__link> <span class=md-ellipsis> create_thread </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.create_vector_store class=md-nav__link> <span class=md-ellipsis> create_vector_store </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.create_vector_store_from_source class=md-nav__link> <span class=md-ellipsis> create_vector_store_from_source </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.find_agents class=md-nav__link> <span class=md-ellipsis> find_agents </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.generate_auth_for_current_agent class=md-nav__link> <span class=md-ellipsis> generate_auth_for_current_agent </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.generate_image class=md-nav__link> <span class=md-ellipsis> generate_image </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.get_agent_data class=md-nav__link> <span class=md-ellipsis> get_agent_data </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.get_agent_data_by_key class=md-nav__link> <span class=md-ellipsis> get_agent_data_by_key </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.get_agent_public_key class=md-nav__link> <span class=md-ellipsis> get_agent_public_key </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.get_thread class=md-nav__link> <span class=md-ellipsis> get_thread </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.get_vector_store class=md-nav__link> <span class=md-ellipsis> get_vector_store </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.get_vector_store_files class=md-nav__link> <span class=md-ellipsis> get_vector_store_files </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.query_user_memory class=md-nav__link> <span class=md-ellipsis> query_user_memory </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.query_vector_store class=md-nav__link> <span class=md-ellipsis> query_vector_store </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.remove_file class=md-nav__link> <span class=md-ellipsis> remove_file </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.run_agent class=md-nav__link> <span class=md-ellipsis> run_agent </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.save_agent_data class=md-nav__link> <span class=md-ellipsis> save_agent_data </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.schedule_run class=md-nav__link> <span class=md-ellipsis> schedule_run </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.set_provider_models class=md-nav__link> <span class=md-ellipsis> set_provider_models </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.threads_create_and_run_poll class=md-nav__link> <span class=md-ellipsis> threads_create_and_run_poll </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.threads_fork class=md-nav__link> <span class=md-ellipsis> threads_fork </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.threads_list_messages class=md-nav__link> <span class=md-ellipsis> threads_list_messages </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.threads_messages_create class=md-nav__link> <span class=md-ellipsis> threads_messages_create </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.threads_runs_create class=md-nav__link> <span class=md-ellipsis> threads_runs_create </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.inference_client.InferenceClient.upload_file class=md-nav__link> <span class=md-ellipsis> upload_file </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.shared.models class=md-nav__link> <span class=md-ellipsis> models </span> </a> <nav class=md-nav aria-label=models> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.shared.models.AutoFileChunkingStrategyParam class=md-nav__link> <span class=md-ellipsis> AutoFileChunkingStrategyParam </span> </a> <nav class=md-nav aria-label=AutoFileChunkingStrategyParam> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.shared.models.AutoFileChunkingStrategyParam.type class=md-nav__link> <span class=md-ellipsis> type </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.shared.models.ChunkingStrategy class=md-nav__link> <span class=md-ellipsis> ChunkingStrategy </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.models.CreateVectorStoreRequest class=md-nav__link> <span class=md-ellipsis> CreateVectorStoreRequest </span> </a> <nav class=md-nav aria-label=CreateVectorStoreRequest> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.shared.models.CreateVectorStoreRequest.chunking_strategy class=md-nav__link> <span class=md-ellipsis> chunking_strategy </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.models.CreateVectorStoreRequest.expires_after class=md-nav__link> <span class=md-ellipsis> expires_after </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.models.CreateVectorStoreRequest.file_ids class=md-nav__link> <span class=md-ellipsis> file_ids </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.models.CreateVectorStoreRequest.metadata class=md-nav__link> <span class=md-ellipsis> metadata </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.models.CreateVectorStoreRequest.name class=md-nav__link> <span class=md-ellipsis> name </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.shared.models.ExpiresAfter class=md-nav__link> <span class=md-ellipsis> ExpiresAfter </span> </a> <nav class=md-nav aria-label=ExpiresAfter> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.shared.models.ExpiresAfter.anchor class=md-nav__link> <span class=md-ellipsis> anchor </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.models.ExpiresAfter.days class=md-nav__link> <span class=md-ellipsis> days </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.shared.models.StaticFileChunkingStrategyParam class=md-nav__link> <span class=md-ellipsis> StaticFileChunkingStrategyParam </span> </a> <nav class=md-nav aria-label=StaticFileChunkingStrategyParam> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.shared.models.StaticFileChunkingStrategyParam.chunk_overlap_tokens class=md-nav__link> <span class=md-ellipsis> chunk_overlap_tokens </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.models.StaticFileChunkingStrategyParam.max_chunk_size_tokens class=md-nav__link> <span class=md-ellipsis> max_chunk_size_tokens </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.shared.models.VectorStoreFileCreate class=md-nav__link> <span class=md-ellipsis> VectorStoreFileCreate </span> </a> <nav class=md-nav aria-label=VectorStoreFileCreate> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.shared.models.VectorStoreFileCreate.file_id class=md-nav__link> <span class=md-ellipsis> file_id </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.shared.naming class=md-nav__link> <span class=md-ellipsis> naming </span> </a> <nav class=md-nav aria-label=naming> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.shared.naming.NamespacedName class=md-nav__link> <span class=md-ellipsis> NamespacedName </span> </a> <nav class=md-nav aria-label=NamespacedName> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.shared.naming.NamespacedName.canonical class=md-nav__link> <span class=md-ellipsis> canonical </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.shared.naming.create_registry_name class=md-nav__link> <span class=md-ellipsis> create_registry_name </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.naming.get_canonical_name class=md-nav__link> <span class=md-ellipsis> get_canonical_name </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.shared.near class=md-nav__link> <span class=md-ellipsis> near </span> </a> <nav class=md-nav aria-label=near> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.shared.near.sign class=md-nav__link> <span class=md-ellipsis> sign </span> </a> <nav class=md-nav aria-label=sign> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.shared.near.sign.SignatureVerificationResult class=md-nav__link> <span class=md-ellipsis> SignatureVerificationResult </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.near.sign.convert_nonce class=md-nav__link> <span class=md-ellipsis> convert_nonce </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.near.sign.create_inference_signature class=md-nav__link> <span class=md-ellipsis> create_inference_signature </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.near.sign.create_signature class=md-nav__link> <span class=md-ellipsis> create_signature </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.near.sign.validate_completion_signature class=md-nav__link> <span class=md-ellipsis> validate_completion_signature </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.near.sign.validate_nonce class=md-nav__link> <span class=md-ellipsis> validate_nonce </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.near.sign.validate_signature class=md-nav__link> <span class=md-ellipsis> validate_signature </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.near.sign.verify_access_key_owner class=md-nav__link> <span class=md-ellipsis> verify_access_key_owner </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.near.sign.verify_signed_message class=md-nav__link> <span class=md-ellipsis> verify_signed_message </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.shared.provider_models class=md-nav__link> <span class=md-ellipsis> provider_models </span> </a> <nav class=md-nav aria-label=provider_models> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.shared.provider_models.ProviderModels class=md-nav__link> <span class=md-ellipsis> ProviderModels </span> </a> <nav class=md-nav aria-label=ProviderModels> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.shared.provider_models.ProviderModels.provider_models class=md-nav__link> <span class=md-ellipsis> provider_models </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.provider_models.ProviderModels.available_provider_matches class=md-nav__link> <span class=md-ellipsis> available_provider_matches </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.provider_models.ProviderModels.get_unregistered_common_provider_models class=md-nav__link> <span class=md-ellipsis> get_unregistered_common_provider_models </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.provider_models.ProviderModels.match_provider_model class=md-nav__link> <span class=md-ellipsis> match_provider_model </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.shared.provider_models.get_provider_model class=md-nav__link> <span class=md-ellipsis> get_provider_model </span> </a> </li> <li class=md-nav__item> <a href=#nearai.shared.provider_models.get_provider_namespaced_model class=md-nav__link> <span class=md-ellipsis> get_provider_namespaced_model </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.solvers class=md-nav__link> <span class=md-ellipsis> solvers </span> </a> <nav class=md-nav aria-label=solvers> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.solvers.DDOTSV0Solver class=md-nav__link> <span class=md-ellipsis> DDOTSV0Solver </span> </a> </li> <li class=md-nav__item> <a href=#nearai.solvers.GSM8KSolverStrategy class=md-nav__link> <span class=md-ellipsis> GSM8KSolverStrategy </span> </a> </li> <li class=md-nav__item> <a href=#nearai.solvers.HellaswagSolverStrategy class=md-nav__link> <span class=md-ellipsis> HellaswagSolverStrategy </span> </a> </li> <li class=md-nav__item> <a href=#nearai.solvers.LeanSolverStrategy class=md-nav__link> <span class=md-ellipsis> LeanSolverStrategy </span> </a> </li> <li class=md-nav__item> <a href=#nearai.solvers.LiveBenchSolverStrategy class=md-nav__link> <span class=md-ellipsis> LiveBenchSolverStrategy </span> </a> </li> <li class=md-nav__item> <a href=#nearai.solvers.MBPPSolverStrategy class=md-nav__link> <span class=md-ellipsis> MBPPSolverStrategy </span> </a> </li> <li class=md-nav__item> <a href=#nearai.solvers.MMLUSolverStrategy class=md-nav__link> <span class=md-ellipsis> MMLUSolverStrategy </span> </a> </li> <li class=md-nav__item> <a href=#nearai.solvers.SolverStrategy class=md-nav__link> <span class=md-ellipsis> SolverStrategy </span> </a> <nav class=md-nav aria-label=SolverStrategy> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.solvers.SolverStrategy.name class=md-nav__link> <span class=md-ellipsis> name </span> </a> </li> <li class=md-nav__item> <a href=#nearai.solvers.SolverStrategy.agent_name class=md-nav__link> <span class=md-ellipsis> agent_name </span> </a> </li> <li class=md-nav__item> <a href=#nearai.solvers.SolverStrategy.agent_version class=md-nav__link> <span class=md-ellipsis> agent_version </span> </a> </li> <li class=md-nav__item> <a href=#nearai.solvers.SolverStrategy.compatible_datasets class=md-nav__link> <span class=md-ellipsis> compatible_datasets </span> </a> </li> <li class=md-nav__item> <a href=#nearai.solvers.SolverStrategy.evaluated_entry_namespace class=md-nav__link> <span class=md-ellipsis> evaluated_entry_namespace </span> </a> </li> <li class=md-nav__item> <a href=#nearai.solvers.SolverStrategy.evaluation_name class=md-nav__link> <span class=md-ellipsis> evaluation_name </span> </a> </li> <li class=md-nav__item> <a href=#nearai.solvers.SolverStrategy.get_custom_tasks class=md-nav__link> <span class=md-ellipsis> get_custom_tasks </span> </a> </li> <li class=md-nav__item> <a href=#nearai.solvers.SolverStrategy.get_evaluation_metrics class=md-nav__link> <span class=md-ellipsis> get_evaluation_metrics </span> </a> </li> <li class=md-nav__item> <a href=#nearai.solvers.SolverStrategy.model_provider class=md-nav__link> <span class=md-ellipsis> model_provider </span> </a> </li> <li class=md-nav__item> <a href=#nearai.solvers.SolverStrategy.solve class=md-nav__link> <span class=md-ellipsis> solve </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.solvers.SolverStrategyMeta class=md-nav__link> <span class=md-ellipsis> SolverStrategyMeta </span> </a> </li> <li class=md-nav__item> <a href=#nearai.solvers.ddot_v0_solver class=md-nav__link> <span class=md-ellipsis> ddot_v0_solver </span> </a> <nav class=md-nav aria-label=ddot_v0_solver> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.solvers.ddot_v0_solver.DDOTSEnvironment class=md-nav__link> <span class=md-ellipsis> DDOTSEnvironment </span> </a> <nav class=md-nav aria-label=DDOTSEnvironment> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.solvers.ddot_v0_solver.DDOTSEnvironment.submit_python class=md-nav__link> <span class=md-ellipsis> submit_python </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.solvers.ddot_v0_solver.DDOTSV0Solver class=md-nav__link> <span class=md-ellipsis> DDOTSV0Solver </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.solvers.gsm8k_solver class=md-nav__link> <span class=md-ellipsis> gsm8k_solver </span> </a> <nav class=md-nav aria-label=gsm8k_solver> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.solvers.gsm8k_solver.GSM8KSolverStrategy class=md-nav__link> <span class=md-ellipsis> GSM8KSolverStrategy </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.solvers.hellaswag_solver class=md-nav__link> <span class=md-ellipsis> hellaswag_solver </span> </a> <nav class=md-nav aria-label=hellaswag_solver> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.solvers.hellaswag_solver.HellaswagSolverStrategy class=md-nav__link> <span class=md-ellipsis> HellaswagSolverStrategy </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.solvers.lean_solver class=md-nav__link> <span class=md-ellipsis> lean_solver </span> </a> <nav class=md-nav aria-label=lean_solver> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.solvers.lean_solver.LeanSolverStrategy class=md-nav__link> <span class=md-ellipsis> LeanSolverStrategy </span> </a> </li> <li class=md-nav__item> <a href=#nearai.solvers.lean_solver.load_theorem class=md-nav__link> <span class=md-ellipsis> load_theorem </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.solvers.livebench_solver class=md-nav__link> <span class=md-ellipsis> livebench_solver </span> </a> <nav class=md-nav aria-label=livebench_solver> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.solvers.livebench_solver.LiveBenchSolverStrategy class=md-nav__link> <span class=md-ellipsis> LiveBenchSolverStrategy </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.solvers.mbpp_solver class=md-nav__link> <span class=md-ellipsis> mbpp_solver </span> </a> <nav class=md-nav aria-label=mbpp_solver> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.solvers.mbpp_solver.MBPPSolverStrategy class=md-nav__link> <span class=md-ellipsis> MBPPSolverStrategy </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.solvers.mmlu_solver class=md-nav__link> <span class=md-ellipsis> mmlu_solver </span> </a> <nav class=md-nav aria-label=mmlu_solver> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.solvers.mmlu_solver.MMLUSolverStrategy class=md-nav__link> <span class=md-ellipsis> MMLUSolverStrategy </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#nearai.tests class=md-nav__link> <span class=md-ellipsis> tests </span> </a> <nav class=md-nav aria-label=tests> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.tests.test_provider_models class=md-nav__link> <span class=md-ellipsis> test_provider_models </span> </a> <nav class=md-nav aria-label=test_provider_models> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nearai.tests.test_provider_models.TestMatchProviderModel class=md-nav__link> <span class=md-ellipsis> TestMatchProviderModel </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/nearai/nearai/edit/main/docs/api.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75z"/></svg> </a> <a href=https://github.com/nearai/nearai/raw/main/docs/api.md title="View source of this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0 8a5 5 0 0 1-5-5 5 5 0 0 1 5-5 5 5 0 0 1 5 5 5 5 0 0 1-5 5m0-12.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5"/></svg> </a> <h1 id=api-reference>API Reference<a class=headerlink href=#api-reference title="Permanent link">&para;</a></h1> <div class="doc doc-object doc-module"> <h2 id=nearai class="doc doc-heading"> <span class="doc doc-object-name doc-module-name">nearai</span> <a href=#nearai class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents first"> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h3 id=nearai.EntryLocation class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">EntryLocation</span> <a href=#nearai.EntryLocation class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=pydantic.BaseModel>BaseModel</span></code></p> <p>EntryLocation</p> <details class=quote> <summary>Source code in <code>nearai/openapi_client/models/entry_location.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-25>25</a></span>
<span class=normal><a href=#__codelineno-0-26>26</a></span>
<span class=normal><a href=#__codelineno-0-27>27</a></span>
<span class=normal><a href=#__codelineno-0-28>28</a></span>
<span class=normal><a href=#__codelineno-0-29>29</a></span>
<span class=normal><a href=#__codelineno-0-30>30</a></span>
<span class=normal><a href=#__codelineno-0-31>31</a></span>
<span class=normal><a href=#__codelineno-0-32>32</a></span>
<span class=normal><a href=#__codelineno-0-33>33</a></span>
<span class=normal><a href=#__codelineno-0-34>34</a></span>
<span class=normal><a href=#__codelineno-0-35>35</a></span>
<span class=normal><a href=#__codelineno-0-36>36</a></span>
<span class=normal><a href=#__codelineno-0-37>37</a></span>
<span class=normal><a href=#__codelineno-0-38>38</a></span>
<span class=normal><a href=#__codelineno-0-39>39</a></span>
<span class=normal><a href=#__codelineno-0-40>40</a></span>
<span class=normal><a href=#__codelineno-0-41>41</a></span>
<span class=normal><a href=#__codelineno-0-42>42</a></span>
<span class=normal><a href=#__codelineno-0-43>43</a></span>
<span class=normal><a href=#__codelineno-0-44>44</a></span>
<span class=normal><a href=#__codelineno-0-45>45</a></span>
<span class=normal><a href=#__codelineno-0-46>46</a></span>
<span class=normal><a href=#__codelineno-0-47>47</a></span>
<span class=normal><a href=#__codelineno-0-48>48</a></span>
<span class=normal><a href=#__codelineno-0-49>49</a></span>
<span class=normal><a href=#__codelineno-0-50>50</a></span>
<span class=normal><a href=#__codelineno-0-51>51</a></span>
<span class=normal><a href=#__codelineno-0-52>52</a></span>
<span class=normal><a href=#__codelineno-0-53>53</a></span>
<span class=normal><a href=#__codelineno-0-54>54</a></span>
<span class=normal><a href=#__codelineno-0-55>55</a></span>
<span class=normal><a href=#__codelineno-0-56>56</a></span>
<span class=normal><a href=#__codelineno-0-57>57</a></span>
<span class=normal><a href=#__codelineno-0-58>58</a></span>
<span class=normal><a href=#__codelineno-0-59>59</a></span>
<span class=normal><a href=#__codelineno-0-60>60</a></span>
<span class=normal><a href=#__codelineno-0-61>61</a></span>
<span class=normal><a href=#__codelineno-0-62>62</a></span>
<span class=normal><a href=#__codelineno-0-63>63</a></span>
<span class=normal><a href=#__codelineno-0-64>64</a></span>
<span class=normal><a href=#__codelineno-0-65>65</a></span>
<span class=normal><a href=#__codelineno-0-66>66</a></span>
<span class=normal><a href=#__codelineno-0-67>67</a></span>
<span class=normal><a href=#__codelineno-0-68>68</a></span>
<span class=normal><a href=#__codelineno-0-69>69</a></span>
<span class=normal><a href=#__codelineno-0-70>70</a></span>
<span class=normal><a href=#__codelineno-0-71>71</a></span>
<span class=normal><a href=#__codelineno-0-72>72</a></span>
<span class=normal><a href=#__codelineno-0-73>73</a></span>
<span class=normal><a href=#__codelineno-0-74>74</a></span>
<span class=normal><a href=#__codelineno-0-75>75</a></span>
<span class=normal><a href=#__codelineno-0-76>76</a></span>
<span class=normal><a href=#__codelineno-0-77>77</a></span>
<span class=normal><a href=#__codelineno-0-78>78</a></span>
<span class=normal><a href=#__codelineno-0-79>79</a></span>
<span class=normal><a href=#__codelineno-0-80>80</a></span>
<span class=normal><a href=#__codelineno-0-81>81</a></span>
<span class=normal><a href=#__codelineno-0-82>82</a></span>
<span class=normal><a href=#__codelineno-0-83>83</a></span>
<span class=normal><a href=#__codelineno-0-84>84</a></span>
<span class=normal><a href=#__codelineno-0-85>85</a></span>
<span class=normal><a href=#__codelineno-0-86>86</a></span>
<span class=normal><a href=#__codelineno-0-87>87</a></span>
<span class=normal><a href=#__codelineno-0-88>88</a></span>
<span class=normal><a href=#__codelineno-0-89>89</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-25><a id=__codelineno-0-25 name=__codelineno-0-25></a><span class=k>class</span><span class=w> </span><span class=nc>EntryLocation</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span><span id=__span-0-26><a id=__codelineno-0-26 name=__codelineno-0-26></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
</span><span id=__span-0-27><a id=__codelineno-0-27 name=__codelineno-0-27></a><span class=sd>    EntryLocation</span>
</span><span id=__span-0-28><a id=__codelineno-0-28 name=__codelineno-0-28></a><span class=sd>    &quot;&quot;&quot;</span> <span class=c1># noqa: E501</span>
</span><span id=__span-0-29><a id=__codelineno-0-29 name=__codelineno-0-29></a>    <span class=n>namespace</span><span class=p>:</span> <span class=n>StrictStr</span>
</span><span id=__span-0-30><a id=__codelineno-0-30 name=__codelineno-0-30></a>    <span class=n>name</span><span class=p>:</span> <span class=n>StrictStr</span>
</span><span id=__span-0-31><a id=__codelineno-0-31 name=__codelineno-0-31></a>    <span class=n>version</span><span class=p>:</span> <span class=n>StrictStr</span>
</span><span id=__span-0-32><a id=__codelineno-0-32 name=__codelineno-0-32></a>    <span class=n>__properties</span><span class=p>:</span> <span class=n>ClassVar</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]]</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;namespace&quot;</span><span class=p>,</span> <span class=s2>&quot;name&quot;</span><span class=p>,</span> <span class=s2>&quot;version&quot;</span><span class=p>]</span>
</span><span id=__span-0-33><a id=__codelineno-0-33 name=__codelineno-0-33></a>
</span><span id=__span-0-34><a id=__codelineno-0-34 name=__codelineno-0-34></a>    <span class=n>model_config</span> <span class=o>=</span> <span class=n>ConfigDict</span><span class=p>(</span>
</span><span id=__span-0-35><a id=__codelineno-0-35 name=__codelineno-0-35></a>        <span class=n>populate_by_name</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-36><a id=__codelineno-0-36 name=__codelineno-0-36></a>        <span class=n>validate_assignment</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-37><a id=__codelineno-0-37 name=__codelineno-0-37></a>        <span class=n>protected_namespaces</span><span class=o>=</span><span class=p>(),</span>
</span><span id=__span-0-38><a id=__codelineno-0-38 name=__codelineno-0-38></a>    <span class=p>)</span>
</span><span id=__span-0-39><a id=__codelineno-0-39 name=__codelineno-0-39></a>
</span><span id=__span-0-40><a id=__codelineno-0-40 name=__codelineno-0-40></a>
</span><span id=__span-0-41><a id=__codelineno-0-41 name=__codelineno-0-41></a>    <span class=k>def</span><span class=w> </span><span class=nf>to_str</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-0-42><a id=__codelineno-0-42 name=__codelineno-0-42></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns the string representation of the model using alias&quot;&quot;&quot;</span>
</span><span id=__span-0-43><a id=__codelineno-0-43 name=__codelineno-0-43></a>        <span class=k>return</span> <span class=n>pprint</span><span class=o>.</span><span class=n>pformat</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>model_dump</span><span class=p>(</span><span class=n>by_alias</span><span class=o>=</span><span class=kc>True</span><span class=p>))</span>
</span><span id=__span-0-44><a id=__codelineno-0-44 name=__codelineno-0-44></a>
</span><span id=__span-0-45><a id=__codelineno-0-45 name=__codelineno-0-45></a>    <span class=k>def</span><span class=w> </span><span class=nf>to_json</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-0-46><a id=__codelineno-0-46 name=__codelineno-0-46></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns the JSON representation of the model using alias&quot;&quot;&quot;</span>
</span><span id=__span-0-47><a id=__codelineno-0-47 name=__codelineno-0-47></a>        <span class=c1># TODO: pydantic v2: use .model_dump_json(by_alias=True, exclude_unset=True) instead</span>
</span><span id=__span-0-48><a id=__codelineno-0-48 name=__codelineno-0-48></a>        <span class=k>return</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>to_dict</span><span class=p>())</span>
</span><span id=__span-0-49><a id=__codelineno-0-49 name=__codelineno-0-49></a>
</span><span id=__span-0-50><a id=__codelineno-0-50 name=__codelineno-0-50></a>    <span class=nd>@classmethod</span>
</span><span id=__span-0-51><a id=__codelineno-0-51 name=__codelineno-0-51></a>    <span class=k>def</span><span class=w> </span><span class=nf>from_json</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>json_str</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Self</span><span class=p>]:</span>
</span><span id=__span-0-52><a id=__codelineno-0-52 name=__codelineno-0-52></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Create an instance of EntryLocation from a JSON string&quot;&quot;&quot;</span>
</span><span id=__span-0-53><a id=__codelineno-0-53 name=__codelineno-0-53></a>        <span class=k>return</span> <span class=bp>cls</span><span class=o>.</span><span class=n>from_dict</span><span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>json_str</span><span class=p>))</span>
</span><span id=__span-0-54><a id=__codelineno-0-54 name=__codelineno-0-54></a>
</span><span id=__span-0-55><a id=__codelineno-0-55 name=__codelineno-0-55></a>    <span class=k>def</span><span class=w> </span><span class=nf>to_dict</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span><span id=__span-0-56><a id=__codelineno-0-56 name=__codelineno-0-56></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Return the dictionary representation of the model using alias.</span>
</span><span id=__span-0-57><a id=__codelineno-0-57 name=__codelineno-0-57></a>
</span><span id=__span-0-58><a id=__codelineno-0-58 name=__codelineno-0-58></a><span class=sd>        This has the following differences from calling pydantic&#39;s</span>
</span><span id=__span-0-59><a id=__codelineno-0-59 name=__codelineno-0-59></a><span class=sd>        `self.model_dump(by_alias=True)`:</span>
</span><span id=__span-0-60><a id=__codelineno-0-60 name=__codelineno-0-60></a>
</span><span id=__span-0-61><a id=__codelineno-0-61 name=__codelineno-0-61></a><span class=sd>        * `None` is only added to the output dict for nullable fields that</span>
</span><span id=__span-0-62><a id=__codelineno-0-62 name=__codelineno-0-62></a><span class=sd>          were set at model initialization. Other fields with value `None`</span>
</span><span id=__span-0-63><a id=__codelineno-0-63 name=__codelineno-0-63></a><span class=sd>          are ignored.</span>
</span><span id=__span-0-64><a id=__codelineno-0-64 name=__codelineno-0-64></a><span class=sd>        &quot;&quot;&quot;</span>
</span><span id=__span-0-65><a id=__codelineno-0-65 name=__codelineno-0-65></a>        <span class=n>excluded_fields</span><span class=p>:</span> <span class=n>Set</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=nb>set</span><span class=p>([</span>
</span><span id=__span-0-66><a id=__codelineno-0-66 name=__codelineno-0-66></a>        <span class=p>])</span>
</span><span id=__span-0-67><a id=__codelineno-0-67 name=__codelineno-0-67></a>
</span><span id=__span-0-68><a id=__codelineno-0-68 name=__codelineno-0-68></a>        <span class=n>_dict</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>model_dump</span><span class=p>(</span>
</span><span id=__span-0-69><a id=__codelineno-0-69 name=__codelineno-0-69></a>            <span class=n>by_alias</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-70><a id=__codelineno-0-70 name=__codelineno-0-70></a>            <span class=n>exclude</span><span class=o>=</span><span class=n>excluded_fields</span><span class=p>,</span>
</span><span id=__span-0-71><a id=__codelineno-0-71 name=__codelineno-0-71></a>            <span class=n>exclude_none</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-72><a id=__codelineno-0-72 name=__codelineno-0-72></a>        <span class=p>)</span>
</span><span id=__span-0-73><a id=__codelineno-0-73 name=__codelineno-0-73></a>        <span class=k>return</span> <span class=n>_dict</span>
</span><span id=__span-0-74><a id=__codelineno-0-74 name=__codelineno-0-74></a>
</span><span id=__span-0-75><a id=__codelineno-0-75 name=__codelineno-0-75></a>    <span class=nd>@classmethod</span>
</span><span id=__span-0-76><a id=__codelineno-0-76 name=__codelineno-0-76></a>    <span class=k>def</span><span class=w> </span><span class=nf>from_dict</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>obj</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]])</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Self</span><span class=p>]:</span>
</span><span id=__span-0-77><a id=__codelineno-0-77 name=__codelineno-0-77></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Create an instance of EntryLocation from a dict&quot;&quot;&quot;</span>
</span><span id=__span-0-78><a id=__codelineno-0-78 name=__codelineno-0-78></a>        <span class=k>if</span> <span class=n>obj</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-79><a id=__codelineno-0-79 name=__codelineno-0-79></a>            <span class=k>return</span> <span class=kc>None</span>
</span><span id=__span-0-80><a id=__codelineno-0-80 name=__codelineno-0-80></a>
</span><span id=__span-0-81><a id=__codelineno-0-81 name=__codelineno-0-81></a>        <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>obj</span><span class=p>,</span> <span class=nb>dict</span><span class=p>):</span>
</span><span id=__span-0-82><a id=__codelineno-0-82 name=__codelineno-0-82></a>            <span class=k>return</span> <span class=bp>cls</span><span class=o>.</span><span class=n>model_validate</span><span class=p>(</span><span class=n>obj</span><span class=p>)</span>
</span><span id=__span-0-83><a id=__codelineno-0-83 name=__codelineno-0-83></a>
</span><span id=__span-0-84><a id=__codelineno-0-84 name=__codelineno-0-84></a>        <span class=n>_obj</span> <span class=o>=</span> <span class=bp>cls</span><span class=o>.</span><span class=n>model_validate</span><span class=p>({</span>
</span><span id=__span-0-85><a id=__codelineno-0-85 name=__codelineno-0-85></a>            <span class=s2>&quot;namespace&quot;</span><span class=p>:</span> <span class=n>obj</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;namespace&quot;</span><span class=p>),</span>
</span><span id=__span-0-86><a id=__codelineno-0-86 name=__codelineno-0-86></a>            <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=n>obj</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;name&quot;</span><span class=p>),</span>
</span><span id=__span-0-87><a id=__codelineno-0-87 name=__codelineno-0-87></a>            <span class=s2>&quot;version&quot;</span><span class=p>:</span> <span class=n>obj</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;version&quot;</span><span class=p>)</span>
</span><span id=__span-0-88><a id=__codelineno-0-88 name=__codelineno-0-88></a>        <span class=p>})</span>
</span><span id=__span-0-89><a id=__codelineno-0-89 name=__codelineno-0-89></a>        <span class=k>return</span> <span class=n>_obj</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h4 id=nearai.EntryLocation.from_dict class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">from_dict</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small> </span> <a href=#nearai.EntryLocation.from_dict class=headerlink title="Permanent link">&para;</a></h4> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>from_dict</span><span class=p>(</span><span class=n>obj</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n><span title=typing.Dict>Dict</span></span><span class=p>[</span><span class=n>str</span><span class=p>,</span> <span class=n><span title=typing.Any>Any</span></span><span class=p>]])</span> <span class=o>-&gt;</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n><span title=typing_extensions.Self>Self</span></span><span class=p>]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Create an instance of EntryLocation from a dict</p> <details class=quote> <summary>Source code in <code>nearai/openapi_client/models/entry_location.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-75>75</a></span>
<span class=normal><a href=#__codelineno-0-76>76</a></span>
<span class=normal><a href=#__codelineno-0-77>77</a></span>
<span class=normal><a href=#__codelineno-0-78>78</a></span>
<span class=normal><a href=#__codelineno-0-79>79</a></span>
<span class=normal><a href=#__codelineno-0-80>80</a></span>
<span class=normal><a href=#__codelineno-0-81>81</a></span>
<span class=normal><a href=#__codelineno-0-82>82</a></span>
<span class=normal><a href=#__codelineno-0-83>83</a></span>
<span class=normal><a href=#__codelineno-0-84>84</a></span>
<span class=normal><a href=#__codelineno-0-85>85</a></span>
<span class=normal><a href=#__codelineno-0-86>86</a></span>
<span class=normal><a href=#__codelineno-0-87>87</a></span>
<span class=normal><a href=#__codelineno-0-88>88</a></span>
<span class=normal><a href=#__codelineno-0-89>89</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-75><a id=__codelineno-0-75 name=__codelineno-0-75></a><span class=nd>@classmethod</span>
</span><span id=__span-0-76><a id=__codelineno-0-76 name=__codelineno-0-76></a><span class=k>def</span><span class=w> </span><span class=nf>from_dict</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>obj</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]])</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Self</span><span class=p>]:</span>
</span><span id=__span-0-77><a id=__codelineno-0-77 name=__codelineno-0-77></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Create an instance of EntryLocation from a dict&quot;&quot;&quot;</span>
</span><span id=__span-0-78><a id=__codelineno-0-78 name=__codelineno-0-78></a>    <span class=k>if</span> <span class=n>obj</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-79><a id=__codelineno-0-79 name=__codelineno-0-79></a>        <span class=k>return</span> <span class=kc>None</span>
</span><span id=__span-0-80><a id=__codelineno-0-80 name=__codelineno-0-80></a>
</span><span id=__span-0-81><a id=__codelineno-0-81 name=__codelineno-0-81></a>    <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>obj</span><span class=p>,</span> <span class=nb>dict</span><span class=p>):</span>
</span><span id=__span-0-82><a id=__codelineno-0-82 name=__codelineno-0-82></a>        <span class=k>return</span> <span class=bp>cls</span><span class=o>.</span><span class=n>model_validate</span><span class=p>(</span><span class=n>obj</span><span class=p>)</span>
</span><span id=__span-0-83><a id=__codelineno-0-83 name=__codelineno-0-83></a>
</span><span id=__span-0-84><a id=__codelineno-0-84 name=__codelineno-0-84></a>    <span class=n>_obj</span> <span class=o>=</span> <span class=bp>cls</span><span class=o>.</span><span class=n>model_validate</span><span class=p>({</span>
</span><span id=__span-0-85><a id=__codelineno-0-85 name=__codelineno-0-85></a>        <span class=s2>&quot;namespace&quot;</span><span class=p>:</span> <span class=n>obj</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;namespace&quot;</span><span class=p>),</span>
</span><span id=__span-0-86><a id=__codelineno-0-86 name=__codelineno-0-86></a>        <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=n>obj</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;name&quot;</span><span class=p>),</span>
</span><span id=__span-0-87><a id=__codelineno-0-87 name=__codelineno-0-87></a>        <span class=s2>&quot;version&quot;</span><span class=p>:</span> <span class=n>obj</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;version&quot;</span><span class=p>)</span>
</span><span id=__span-0-88><a id=__codelineno-0-88 name=__codelineno-0-88></a>    <span class=p>})</span>
</span><span id=__span-0-89><a id=__codelineno-0-89 name=__codelineno-0-89></a>    <span class=k>return</span> <span class=n>_obj</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=nearai.EntryLocation.from_json class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">from_json</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small> </span> <a href=#nearai.EntryLocation.from_json class=headerlink title="Permanent link">&para;</a></h4> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>from_json</span><span class=p>(</span><span class=n>json_str</span><span class=p>:</span> <span class=n>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n><span title=typing_extensions.Self>Self</span></span><span class=p>]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Create an instance of EntryLocation from a JSON string</p> <details class=quote> <summary>Source code in <code>nearai/openapi_client/models/entry_location.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-50>50</a></span>
<span class=normal><a href=#__codelineno-0-51>51</a></span>
<span class=normal><a href=#__codelineno-0-52>52</a></span>
<span class=normal><a href=#__codelineno-0-53>53</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-50><a id=__codelineno-0-50 name=__codelineno-0-50></a><span class=nd>@classmethod</span>
</span><span id=__span-0-51><a id=__codelineno-0-51 name=__codelineno-0-51></a><span class=k>def</span><span class=w> </span><span class=nf>from_json</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>json_str</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Self</span><span class=p>]:</span>
</span><span id=__span-0-52><a id=__codelineno-0-52 name=__codelineno-0-52></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Create an instance of EntryLocation from a JSON string&quot;&quot;&quot;</span>
</span><span id=__span-0-53><a id=__codelineno-0-53 name=__codelineno-0-53></a>    <span class=k>return</span> <span class=bp>cls</span><span class=o>.</span><span class=n>from_dict</span><span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>json_str</span><span class=p>))</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=nearai.EntryLocation.to_dict class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">to_dict</span> <a href=#nearai.EntryLocation.to_dict class=headerlink title="Permanent link">&para;</a></h4> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>to_dict</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n><span title=typing.Dict>Dict</span></span><span class=p>[</span><span class=n>str</span><span class=p>,</span> <span class=n><span title=typing.Any>Any</span></span><span class=p>]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Return the dictionary representation of the model using alias.</p> <p>This has the following differences from calling pydantic's <code>self.model_dump(by_alias=True)</code>:</p> <ul> <li><code>None</code> is only added to the output dict for nullable fields that were set at model initialization. Other fields with value <code>None</code> are ignored.</li> </ul> <details class=quote> <summary>Source code in <code>nearai/openapi_client/models/entry_location.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-55>55</a></span>
<span class=normal><a href=#__codelineno-0-56>56</a></span>
<span class=normal><a href=#__codelineno-0-57>57</a></span>
<span class=normal><a href=#__codelineno-0-58>58</a></span>
<span class=normal><a href=#__codelineno-0-59>59</a></span>
<span class=normal><a href=#__codelineno-0-60>60</a></span>
<span class=normal><a href=#__codelineno-0-61>61</a></span>
<span class=normal><a href=#__codelineno-0-62>62</a></span>
<span class=normal><a href=#__codelineno-0-63>63</a></span>
<span class=normal><a href=#__codelineno-0-64>64</a></span>
<span class=normal><a href=#__codelineno-0-65>65</a></span>
<span class=normal><a href=#__codelineno-0-66>66</a></span>
<span class=normal><a href=#__codelineno-0-67>67</a></span>
<span class=normal><a href=#__codelineno-0-68>68</a></span>
<span class=normal><a href=#__codelineno-0-69>69</a></span>
<span class=normal><a href=#__codelineno-0-70>70</a></span>
<span class=normal><a href=#__codelineno-0-71>71</a></span>
<span class=normal><a href=#__codelineno-0-72>72</a></span>
<span class=normal><a href=#__codelineno-0-73>73</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-55><a id=__codelineno-0-55 name=__codelineno-0-55></a><span class=k>def</span><span class=w> </span><span class=nf>to_dict</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span><span id=__span-0-56><a id=__codelineno-0-56 name=__codelineno-0-56></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Return the dictionary representation of the model using alias.</span>
</span><span id=__span-0-57><a id=__codelineno-0-57 name=__codelineno-0-57></a>
</span><span id=__span-0-58><a id=__codelineno-0-58 name=__codelineno-0-58></a><span class=sd>    This has the following differences from calling pydantic&#39;s</span>
</span><span id=__span-0-59><a id=__codelineno-0-59 name=__codelineno-0-59></a><span class=sd>    `self.model_dump(by_alias=True)`:</span>
</span><span id=__span-0-60><a id=__codelineno-0-60 name=__codelineno-0-60></a>
</span><span id=__span-0-61><a id=__codelineno-0-61 name=__codelineno-0-61></a><span class=sd>    * `None` is only added to the output dict for nullable fields that</span>
</span><span id=__span-0-62><a id=__codelineno-0-62 name=__codelineno-0-62></a><span class=sd>      were set at model initialization. Other fields with value `None`</span>
</span><span id=__span-0-63><a id=__codelineno-0-63 name=__codelineno-0-63></a><span class=sd>      are ignored.</span>
</span><span id=__span-0-64><a id=__codelineno-0-64 name=__codelineno-0-64></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-65><a id=__codelineno-0-65 name=__codelineno-0-65></a>    <span class=n>excluded_fields</span><span class=p>:</span> <span class=n>Set</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=nb>set</span><span class=p>([</span>
</span><span id=__span-0-66><a id=__codelineno-0-66 name=__codelineno-0-66></a>    <span class=p>])</span>
</span><span id=__span-0-67><a id=__codelineno-0-67 name=__codelineno-0-67></a>
</span><span id=__span-0-68><a id=__codelineno-0-68 name=__codelineno-0-68></a>    <span class=n>_dict</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>model_dump</span><span class=p>(</span>
</span><span id=__span-0-69><a id=__codelineno-0-69 name=__codelineno-0-69></a>        <span class=n>by_alias</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-70><a id=__codelineno-0-70 name=__codelineno-0-70></a>        <span class=n>exclude</span><span class=o>=</span><span class=n>excluded_fields</span><span class=p>,</span>
</span><span id=__span-0-71><a id=__codelineno-0-71 name=__codelineno-0-71></a>        <span class=n>exclude_none</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-72><a id=__codelineno-0-72 name=__codelineno-0-72></a>    <span class=p>)</span>
</span><span id=__span-0-73><a id=__codelineno-0-73 name=__codelineno-0-73></a>    <span class=k>return</span> <span class=n>_dict</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=nearai.EntryLocation.to_json class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">to_json</span> <a href=#nearai.EntryLocation.to_json class=headerlink title="Permanent link">&para;</a></h4> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>to_json</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n>str</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Returns the JSON representation of the model using alias</p> <details class=quote> <summary>Source code in <code>nearai/openapi_client/models/entry_location.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-45>45</a></span>
<span class=normal><a href=#__codelineno-0-46>46</a></span>
<span class=normal><a href=#__codelineno-0-47>47</a></span>
<span class=normal><a href=#__codelineno-0-48>48</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-45><a id=__codelineno-0-45 name=__codelineno-0-45></a><span class=k>def</span><span class=w> </span><span class=nf>to_json</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-0-46><a id=__codelineno-0-46 name=__codelineno-0-46></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns the JSON representation of the model using alias&quot;&quot;&quot;</span>
</span><span id=__span-0-47><a id=__codelineno-0-47 name=__codelineno-0-47></a>    <span class=c1># TODO: pydantic v2: use .model_dump_json(by_alias=True, exclude_unset=True) instead</span>
</span><span id=__span-0-48><a id=__codelineno-0-48 name=__codelineno-0-48></a>    <span class=k>return</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>to_dict</span><span class=p>())</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=nearai.EntryLocation.to_str class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">to_str</span> <a href=#nearai.EntryLocation.to_str class=headerlink title="Permanent link">&para;</a></h4> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>to_str</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n>str</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Returns the string representation of the model using alias</p> <details class=quote> <summary>Source code in <code>nearai/openapi_client/models/entry_location.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-41>41</a></span>
<span class=normal><a href=#__codelineno-0-42>42</a></span>
<span class=normal><a href=#__codelineno-0-43>43</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-41><a id=__codelineno-0-41 name=__codelineno-0-41></a><span class=k>def</span><span class=w> </span><span class=nf>to_str</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-0-42><a id=__codelineno-0-42 name=__codelineno-0-42></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns the string representation of the model using alias&quot;&quot;&quot;</span>
</span><span id=__span-0-43><a id=__codelineno-0-43 name=__codelineno-0-43></a>    <span class=k>return</span> <span class=n>pprint</span><span class=o>.</span><span class=n>pformat</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>model_dump</span><span class=p>(</span><span class=n>by_alias</span><span class=o>=</span><span class=kc>True</span><span class=p>))</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-function"> <h3 id=nearai.parse_location class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">parse_location</span> <a href=#nearai.parse_location class=headerlink title="Permanent link">&para;</a></h3> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>parse_location</span><span class=p>(</span><span class=n>entry_location</span><span class=p>:</span> <span class=n>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><a class="autorefs autorefs-internal" title=nearai.openapi_client.models.entry_location.EntryLocation href=#nearai.EntryLocation>EntryLocation</a></span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Create a EntryLocation from a string in the format namespace/name/version.</p> <details class=quote> <summary>Source code in <code>nearai/lib.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-13>13</a></span>
<span class=normal><a href=#__codelineno-0-14>14</a></span>
<span class=normal><a href=#__codelineno-0-15>15</a></span>
<span class=normal><a href=#__codelineno-0-16>16</a></span>
<span class=normal><a href=#__codelineno-0-17>17</a></span>
<span class=normal><a href=#__codelineno-0-18>18</a></span>
<span class=normal><a href=#__codelineno-0-19>19</a></span>
<span class=normal><a href=#__codelineno-0-20>20</a></span>
<span class=normal><a href=#__codelineno-0-21>21</a></span>
<span class=normal><a href=#__codelineno-0-22>22</a></span>
<span class=normal><a href=#__codelineno-0-23>23</a></span>
<span class=normal><a href=#__codelineno-0-24>24</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13></a><span class=k>def</span><span class=w> </span><span class=nf>parse_location</span><span class=p>(</span><span class=n>entry_location</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>EntryLocation</span><span class=p>:</span>
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Create a EntryLocation from a string in the format namespace/name/version.&quot;&quot;&quot;</span>
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15></a>    <span class=n>match</span> <span class=o>=</span> <span class=n>entry_location_pattern</span><span class=o>.</span><span class=n>match</span><span class=p>(</span><span class=n>entry_location</span><span class=p>)</span>
</span><span id=__span-0-16><a id=__codelineno-0-16 name=__codelineno-0-16></a>
</span><span id=__span-0-17><a id=__codelineno-0-17 name=__codelineno-0-17></a>    <span class=k>if</span> <span class=n>match</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-18><a id=__codelineno-0-18 name=__codelineno-0-18></a>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Invalid entry format: </span><span class=si>{</span><span class=n>entry_location</span><span class=si>}</span><span class=s2>. Should have the format &lt;namespace&gt;/&lt;name&gt;/&lt;version&gt;&quot;</span><span class=p>)</span>
</span><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19></a>
</span><span id=__span-0-20><a id=__codelineno-0-20 name=__codelineno-0-20></a>    <span class=k>return</span> <span class=n>EntryLocation</span><span class=p>(</span>
</span><span id=__span-0-21><a id=__codelineno-0-21 name=__codelineno-0-21></a>        <span class=n>namespace</span><span class=o>=</span><span class=n>match</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=s2>&quot;namespace&quot;</span><span class=p>),</span>
</span><span id=__span-0-22><a id=__codelineno-0-22 name=__codelineno-0-22></a>        <span class=n>name</span><span class=o>=</span><span class=n>match</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=s2>&quot;name&quot;</span><span class=p>),</span>
</span><span id=__span-0-23><a id=__codelineno-0-23 name=__codelineno-0-23></a>        <span class=n>version</span><span class=o>=</span><span class=n>match</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=s2>&quot;version&quot;</span><span class=p>),</span>
</span><span id=__span-0-24><a id=__codelineno-0-24 name=__codelineno-0-24></a>    <span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-module"> <h3 id=nearai.agents class="doc doc-heading"> <span class="doc doc-object-name doc-module-name">agents</span> <a href=#nearai.agents class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <div class="doc doc-children"> <div class="doc doc-object doc-module"> <h4 id=nearai.agents.agent class="doc doc-heading"> <span class="doc doc-object-name doc-module-name">agent</span> <a href=#nearai.agents.agent class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h5 id=nearai.agents.agent.Agent class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">Agent</span> <a href=#nearai.agents.agent.Agent class=headerlink title="Permanent link">&para;</a></h5> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code>object</code></p> <details class=quote> <summary>Source code in <code>nearai/agents/agent.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-26> 26</a></span>
<span class=normal><a href=#__codelineno-0-27> 27</a></span>
<span class=normal><a href=#__codelineno-0-28> 28</a></span>
<span class=normal><a href=#__codelineno-0-29> 29</a></span>
<span class=normal><a href=#__codelineno-0-30> 30</a></span>
<span class=normal><a href=#__codelineno-0-31> 31</a></span>
<span class=normal><a href=#__codelineno-0-32> 32</a></span>
<span class=normal><a href=#__codelineno-0-33> 33</a></span>
<span class=normal><a href=#__codelineno-0-34> 34</a></span>
<span class=normal><a href=#__codelineno-0-35> 35</a></span>
<span class=normal><a href=#__codelineno-0-36> 36</a></span>
<span class=normal><a href=#__codelineno-0-37> 37</a></span>
<span class=normal><a href=#__codelineno-0-38> 38</a></span>
<span class=normal><a href=#__codelineno-0-39> 39</a></span>
<span class=normal><a href=#__codelineno-0-40> 40</a></span>
<span class=normal><a href=#__codelineno-0-41> 41</a></span>
<span class=normal><a href=#__codelineno-0-42> 42</a></span>
<span class=normal><a href=#__codelineno-0-43> 43</a></span>
<span class=normal><a href=#__codelineno-0-44> 44</a></span>
<span class=normal><a href=#__codelineno-0-45> 45</a></span>
<span class=normal><a href=#__codelineno-0-46> 46</a></span>
<span class=normal><a href=#__codelineno-0-47> 47</a></span>
<span class=normal><a href=#__codelineno-0-48> 48</a></span>
<span class=normal><a href=#__codelineno-0-49> 49</a></span>
<span class=normal><a href=#__codelineno-0-50> 50</a></span>
<span class=normal><a href=#__codelineno-0-51> 51</a></span>
<span class=normal><a href=#__codelineno-0-52> 52</a></span>
<span class=normal><a href=#__codelineno-0-53> 53</a></span>
<span class=normal><a href=#__codelineno-0-54> 54</a></span>
<span class=normal><a href=#__codelineno-0-55> 55</a></span>
<span class=normal><a href=#__codelineno-0-56> 56</a></span>
<span class=normal><a href=#__codelineno-0-57> 57</a></span>
<span class=normal><a href=#__codelineno-0-58> 58</a></span>
<span class=normal><a href=#__codelineno-0-59> 59</a></span>
<span class=normal><a href=#__codelineno-0-60> 60</a></span>
<span class=normal><a href=#__codelineno-0-61> 61</a></span>
<span class=normal><a href=#__codelineno-0-62> 62</a></span>
<span class=normal><a href=#__codelineno-0-63> 63</a></span>
<span class=normal><a href=#__codelineno-0-64> 64</a></span>
<span class=normal><a href=#__codelineno-0-65> 65</a></span>
<span class=normal><a href=#__codelineno-0-66> 66</a></span>
<span class=normal><a href=#__codelineno-0-67> 67</a></span>
<span class=normal><a href=#__codelineno-0-68> 68</a></span>
<span class=normal><a href=#__codelineno-0-69> 69</a></span>
<span class=normal><a href=#__codelineno-0-70> 70</a></span>
<span class=normal><a href=#__codelineno-0-71> 71</a></span>
<span class=normal><a href=#__codelineno-0-72> 72</a></span>
<span class=normal><a href=#__codelineno-0-73> 73</a></span>
<span class=normal><a href=#__codelineno-0-74> 74</a></span>
<span class=normal><a href=#__codelineno-0-75> 75</a></span>
<span class=normal><a href=#__codelineno-0-76> 76</a></span>
<span class=normal><a href=#__codelineno-0-77> 77</a></span>
<span class=normal><a href=#__codelineno-0-78> 78</a></span>
<span class=normal><a href=#__codelineno-0-79> 79</a></span>
<span class=normal><a href=#__codelineno-0-80> 80</a></span>
<span class=normal><a href=#__codelineno-0-81> 81</a></span>
<span class=normal><a href=#__codelineno-0-82> 82</a></span>
<span class=normal><a href=#__codelineno-0-83> 83</a></span>
<span class=normal><a href=#__codelineno-0-84> 84</a></span>
<span class=normal><a href=#__codelineno-0-85> 85</a></span>
<span class=normal><a href=#__codelineno-0-86> 86</a></span>
<span class=normal><a href=#__codelineno-0-87> 87</a></span>
<span class=normal><a href=#__codelineno-0-88> 88</a></span>
<span class=normal><a href=#__codelineno-0-89> 89</a></span>
<span class=normal><a href=#__codelineno-0-90> 90</a></span>
<span class=normal><a href=#__codelineno-0-91> 91</a></span>
<span class=normal><a href=#__codelineno-0-92> 92</a></span>
<span class=normal><a href=#__codelineno-0-93> 93</a></span>
<span class=normal><a href=#__codelineno-0-94> 94</a></span>
<span class=normal><a href=#__codelineno-0-95> 95</a></span>
<span class=normal><a href=#__codelineno-0-96> 96</a></span>
<span class=normal><a href=#__codelineno-0-97> 97</a></span>
<span class=normal><a href=#__codelineno-0-98> 98</a></span>
<span class=normal><a href=#__codelineno-0-99> 99</a></span>
<span class=normal><a href=#__codelineno-0-100>100</a></span>
<span class=normal><a href=#__codelineno-0-101>101</a></span>
<span class=normal><a href=#__codelineno-0-102>102</a></span>
<span class=normal><a href=#__codelineno-0-103>103</a></span>
<span class=normal><a href=#__codelineno-0-104>104</a></span>
<span class=normal><a href=#__codelineno-0-105>105</a></span>
<span class=normal><a href=#__codelineno-0-106>106</a></span>
<span class=normal><a href=#__codelineno-0-107>107</a></span>
<span class=normal><a href=#__codelineno-0-108>108</a></span>
<span class=normal><a href=#__codelineno-0-109>109</a></span>
<span class=normal><a href=#__codelineno-0-110>110</a></span>
<span class=normal><a href=#__codelineno-0-111>111</a></span>
<span class=normal><a href=#__codelineno-0-112>112</a></span>
<span class=normal><a href=#__codelineno-0-113>113</a></span>
<span class=normal><a href=#__codelineno-0-114>114</a></span>
<span class=normal><a href=#__codelineno-0-115>115</a></span>
<span class=normal><a href=#__codelineno-0-116>116</a></span>
<span class=normal><a href=#__codelineno-0-117>117</a></span>
<span class=normal><a href=#__codelineno-0-118>118</a></span>
<span class=normal><a href=#__codelineno-0-119>119</a></span>
<span class=normal><a href=#__codelineno-0-120>120</a></span>
<span class=normal><a href=#__codelineno-0-121>121</a></span>
<span class=normal><a href=#__codelineno-0-122>122</a></span>
<span class=normal><a href=#__codelineno-0-123>123</a></span>
<span class=normal><a href=#__codelineno-0-124>124</a></span>
<span class=normal><a href=#__codelineno-0-125>125</a></span>
<span class=normal><a href=#__codelineno-0-126>126</a></span>
<span class=normal><a href=#__codelineno-0-127>127</a></span>
<span class=normal><a href=#__codelineno-0-128>128</a></span>
<span class=normal><a href=#__codelineno-0-129>129</a></span>
<span class=normal><a href=#__codelineno-0-130>130</a></span>
<span class=normal><a href=#__codelineno-0-131>131</a></span>
<span class=normal><a href=#__codelineno-0-132>132</a></span>
<span class=normal><a href=#__codelineno-0-133>133</a></span>
<span class=normal><a href=#__codelineno-0-134>134</a></span>
<span class=normal><a href=#__codelineno-0-135>135</a></span>
<span class=normal><a href=#__codelineno-0-136>136</a></span>
<span class=normal><a href=#__codelineno-0-137>137</a></span>
<span class=normal><a href=#__codelineno-0-138>138</a></span>
<span class=normal><a href=#__codelineno-0-139>139</a></span>
<span class=normal><a href=#__codelineno-0-140>140</a></span>
<span class=normal><a href=#__codelineno-0-141>141</a></span>
<span class=normal><a href=#__codelineno-0-142>142</a></span>
<span class=normal><a href=#__codelineno-0-143>143</a></span>
<span class=normal><a href=#__codelineno-0-144>144</a></span>
<span class=normal><a href=#__codelineno-0-145>145</a></span>
<span class=normal><a href=#__codelineno-0-146>146</a></span>
<span class=normal><a href=#__codelineno-0-147>147</a></span>
<span class=normal><a href=#__codelineno-0-148>148</a></span>
<span class=normal><a href=#__codelineno-0-149>149</a></span>
<span class=normal><a href=#__codelineno-0-150>150</a></span>
<span class=normal><a href=#__codelineno-0-151>151</a></span>
<span class=normal><a href=#__codelineno-0-152>152</a></span>
<span class=normal><a href=#__codelineno-0-153>153</a></span>
<span class=normal><a href=#__codelineno-0-154>154</a></span>
<span class=normal><a href=#__codelineno-0-155>155</a></span>
<span class=normal><a href=#__codelineno-0-156>156</a></span>
<span class=normal><a href=#__codelineno-0-157>157</a></span>
<span class=normal><a href=#__codelineno-0-158>158</a></span>
<span class=normal><a href=#__codelineno-0-159>159</a></span>
<span class=normal><a href=#__codelineno-0-160>160</a></span>
<span class=normal><a href=#__codelineno-0-161>161</a></span>
<span class=normal><a href=#__codelineno-0-162>162</a></span>
<span class=normal><a href=#__codelineno-0-163>163</a></span>
<span class=normal><a href=#__codelineno-0-164>164</a></span>
<span class=normal><a href=#__codelineno-0-165>165</a></span>
<span class=normal><a href=#__codelineno-0-166>166</a></span>
<span class=normal><a href=#__codelineno-0-167>167</a></span>
<span class=normal><a href=#__codelineno-0-168>168</a></span>
<span class=normal><a href=#__codelineno-0-169>169</a></span>
<span class=normal><a href=#__codelineno-0-170>170</a></span>
<span class=normal><a href=#__codelineno-0-171>171</a></span>
<span class=normal><a href=#__codelineno-0-172>172</a></span>
<span class=normal><a href=#__codelineno-0-173>173</a></span>
<span class=normal><a href=#__codelineno-0-174>174</a></span>
<span class=normal><a href=#__codelineno-0-175>175</a></span>
<span class=normal><a href=#__codelineno-0-176>176</a></span>
<span class=normal><a href=#__codelineno-0-177>177</a></span>
<span class=normal><a href=#__codelineno-0-178>178</a></span>
<span class=normal><a href=#__codelineno-0-179>179</a></span>
<span class=normal><a href=#__codelineno-0-180>180</a></span>
<span class=normal><a href=#__codelineno-0-181>181</a></span>
<span class=normal><a href=#__codelineno-0-182>182</a></span>
<span class=normal><a href=#__codelineno-0-183>183</a></span>
<span class=normal><a href=#__codelineno-0-184>184</a></span>
<span class=normal><a href=#__codelineno-0-185>185</a></span>
<span class=normal><a href=#__codelineno-0-186>186</a></span>
<span class=normal><a href=#__codelineno-0-187>187</a></span>
<span class=normal><a href=#__codelineno-0-188>188</a></span>
<span class=normal><a href=#__codelineno-0-189>189</a></span>
<span class=normal><a href=#__codelineno-0-190>190</a></span>
<span class=normal><a href=#__codelineno-0-191>191</a></span>
<span class=normal><a href=#__codelineno-0-192>192</a></span>
<span class=normal><a href=#__codelineno-0-193>193</a></span>
<span class=normal><a href=#__codelineno-0-194>194</a></span>
<span class=normal><a href=#__codelineno-0-195>195</a></span>
<span class=normal><a href=#__codelineno-0-196>196</a></span>
<span class=normal><a href=#__codelineno-0-197>197</a></span>
<span class=normal><a href=#__codelineno-0-198>198</a></span>
<span class=normal><a href=#__codelineno-0-199>199</a></span>
<span class=normal><a href=#__codelineno-0-200>200</a></span>
<span class=normal><a href=#__codelineno-0-201>201</a></span>
<span class=normal><a href=#__codelineno-0-202>202</a></span>
<span class=normal><a href=#__codelineno-0-203>203</a></span>
<span class=normal><a href=#__codelineno-0-204>204</a></span>
<span class=normal><a href=#__codelineno-0-205>205</a></span>
<span class=normal><a href=#__codelineno-0-206>206</a></span>
<span class=normal><a href=#__codelineno-0-207>207</a></span>
<span class=normal><a href=#__codelineno-0-208>208</a></span>
<span class=normal><a href=#__codelineno-0-209>209</a></span>
<span class=normal><a href=#__codelineno-0-210>210</a></span>
<span class=normal><a href=#__codelineno-0-211>211</a></span>
<span class=normal><a href=#__codelineno-0-212>212</a></span>
<span class=normal><a href=#__codelineno-0-213>213</a></span>
<span class=normal><a href=#__codelineno-0-214>214</a></span>
<span class=normal><a href=#__codelineno-0-215>215</a></span>
<span class=normal><a href=#__codelineno-0-216>216</a></span>
<span class=normal><a href=#__codelineno-0-217>217</a></span>
<span class=normal><a href=#__codelineno-0-218>218</a></span>
<span class=normal><a href=#__codelineno-0-219>219</a></span>
<span class=normal><a href=#__codelineno-0-220>220</a></span>
<span class=normal><a href=#__codelineno-0-221>221</a></span>
<span class=normal><a href=#__codelineno-0-222>222</a></span>
<span class=normal><a href=#__codelineno-0-223>223</a></span>
<span class=normal><a href=#__codelineno-0-224>224</a></span>
<span class=normal><a href=#__codelineno-0-225>225</a></span>
<span class=normal><a href=#__codelineno-0-226>226</a></span>
<span class=normal><a href=#__codelineno-0-227>227</a></span>
<span class=normal><a href=#__codelineno-0-228>228</a></span>
<span class=normal><a href=#__codelineno-0-229>229</a></span>
<span class=normal><a href=#__codelineno-0-230>230</a></span>
<span class=normal><a href=#__codelineno-0-231>231</a></span>
<span class=normal><a href=#__codelineno-0-232>232</a></span>
<span class=normal><a href=#__codelineno-0-233>233</a></span>
<span class=normal><a href=#__codelineno-0-234>234</a></span>
<span class=normal><a href=#__codelineno-0-235>235</a></span>
<span class=normal><a href=#__codelineno-0-236>236</a></span>
<span class=normal><a href=#__codelineno-0-237>237</a></span>
<span class=normal><a href=#__codelineno-0-238>238</a></span>
<span class=normal><a href=#__codelineno-0-239>239</a></span>
<span class=normal><a href=#__codelineno-0-240>240</a></span>
<span class=normal><a href=#__codelineno-0-241>241</a></span>
<span class=normal><a href=#__codelineno-0-242>242</a></span>
<span class=normal><a href=#__codelineno-0-243>243</a></span>
<span class=normal><a href=#__codelineno-0-244>244</a></span>
<span class=normal><a href=#__codelineno-0-245>245</a></span>
<span class=normal><a href=#__codelineno-0-246>246</a></span>
<span class=normal><a href=#__codelineno-0-247>247</a></span>
<span class=normal><a href=#__codelineno-0-248>248</a></span>
<span class=normal><a href=#__codelineno-0-249>249</a></span>
<span class=normal><a href=#__codelineno-0-250>250</a></span>
<span class=normal><a href=#__codelineno-0-251>251</a></span>
<span class=normal><a href=#__codelineno-0-252>252</a></span>
<span class=normal><a href=#__codelineno-0-253>253</a></span>
<span class=normal><a href=#__codelineno-0-254>254</a></span>
<span class=normal><a href=#__codelineno-0-255>255</a></span>
<span class=normal><a href=#__codelineno-0-256>256</a></span>
<span class=normal><a href=#__codelineno-0-257>257</a></span>
<span class=normal><a href=#__codelineno-0-258>258</a></span>
<span class=normal><a href=#__codelineno-0-259>259</a></span>
<span class=normal><a href=#__codelineno-0-260>260</a></span>
<span class=normal><a href=#__codelineno-0-261>261</a></span>
<span class=normal><a href=#__codelineno-0-262>262</a></span>
<span class=normal><a href=#__codelineno-0-263>263</a></span>
<span class=normal><a href=#__codelineno-0-264>264</a></span>
<span class=normal><a href=#__codelineno-0-265>265</a></span>
<span class=normal><a href=#__codelineno-0-266>266</a></span>
<span class=normal><a href=#__codelineno-0-267>267</a></span>
<span class=normal><a href=#__codelineno-0-268>268</a></span>
<span class=normal><a href=#__codelineno-0-269>269</a></span>
<span class=normal><a href=#__codelineno-0-270>270</a></span>
<span class=normal><a href=#__codelineno-0-271>271</a></span>
<span class=normal><a href=#__codelineno-0-272>272</a></span>
<span class=normal><a href=#__codelineno-0-273>273</a></span>
<span class=normal><a href=#__codelineno-0-274>274</a></span>
<span class=normal><a href=#__codelineno-0-275>275</a></span>
<span class=normal><a href=#__codelineno-0-276>276</a></span>
<span class=normal><a href=#__codelineno-0-277>277</a></span>
<span class=normal><a href=#__codelineno-0-278>278</a></span>
<span class=normal><a href=#__codelineno-0-279>279</a></span>
<span class=normal><a href=#__codelineno-0-280>280</a></span>
<span class=normal><a href=#__codelineno-0-281>281</a></span>
<span class=normal><a href=#__codelineno-0-282>282</a></span>
<span class=normal><a href=#__codelineno-0-283>283</a></span>
<span class=normal><a href=#__codelineno-0-284>284</a></span>
<span class=normal><a href=#__codelineno-0-285>285</a></span>
<span class=normal><a href=#__codelineno-0-286>286</a></span>
<span class=normal><a href=#__codelineno-0-287>287</a></span>
<span class=normal><a href=#__codelineno-0-288>288</a></span>
<span class=normal><a href=#__codelineno-0-289>289</a></span>
<span class=normal><a href=#__codelineno-0-290>290</a></span>
<span class=normal><a href=#__codelineno-0-291>291</a></span>
<span class=normal><a href=#__codelineno-0-292>292</a></span>
<span class=normal><a href=#__codelineno-0-293>293</a></span>
<span class=normal><a href=#__codelineno-0-294>294</a></span>
<span class=normal><a href=#__codelineno-0-295>295</a></span>
<span class=normal><a href=#__codelineno-0-296>296</a></span>
<span class=normal><a href=#__codelineno-0-297>297</a></span>
<span class=normal><a href=#__codelineno-0-298>298</a></span>
<span class=normal><a href=#__codelineno-0-299>299</a></span>
<span class=normal><a href=#__codelineno-0-300>300</a></span>
<span class=normal><a href=#__codelineno-0-301>301</a></span>
<span class=normal><a href=#__codelineno-0-302>302</a></span>
<span class=normal><a href=#__codelineno-0-303>303</a></span>
<span class=normal><a href=#__codelineno-0-304>304</a></span>
<span class=normal><a href=#__codelineno-0-305>305</a></span>
<span class=normal><a href=#__codelineno-0-306>306</a></span>
<span class=normal><a href=#__codelineno-0-307>307</a></span>
<span class=normal><a href=#__codelineno-0-308>308</a></span>
<span class=normal><a href=#__codelineno-0-309>309</a></span>
<span class=normal><a href=#__codelineno-0-310>310</a></span>
<span class=normal><a href=#__codelineno-0-311>311</a></span>
<span class=normal><a href=#__codelineno-0-312>312</a></span>
<span class=normal><a href=#__codelineno-0-313>313</a></span>
<span class=normal><a href=#__codelineno-0-314>314</a></span>
<span class=normal><a href=#__codelineno-0-315>315</a></span>
<span class=normal><a href=#__codelineno-0-316>316</a></span>
<span class=normal><a href=#__codelineno-0-317>317</a></span>
<span class=normal><a href=#__codelineno-0-318>318</a></span>
<span class=normal><a href=#__codelineno-0-319>319</a></span>
<span class=normal><a href=#__codelineno-0-320>320</a></span>
<span class=normal><a href=#__codelineno-0-321>321</a></span>
<span class=normal><a href=#__codelineno-0-322>322</a></span>
<span class=normal><a href=#__codelineno-0-323>323</a></span>
<span class=normal><a href=#__codelineno-0-324>324</a></span>
<span class=normal><a href=#__codelineno-0-325>325</a></span>
<span class=normal><a href=#__codelineno-0-326>326</a></span>
<span class=normal><a href=#__codelineno-0-327>327</a></span>
<span class=normal><a href=#__codelineno-0-328>328</a></span>
<span class=normal><a href=#__codelineno-0-329>329</a></span>
<span class=normal><a href=#__codelineno-0-330>330</a></span>
<span class=normal><a href=#__codelineno-0-331>331</a></span>
<span class=normal><a href=#__codelineno-0-332>332</a></span>
<span class=normal><a href=#__codelineno-0-333>333</a></span>
<span class=normal><a href=#__codelineno-0-334>334</a></span>
<span class=normal><a href=#__codelineno-0-335>335</a></span>
<span class=normal><a href=#__codelineno-0-336>336</a></span>
<span class=normal><a href=#__codelineno-0-337>337</a></span>
<span class=normal><a href=#__codelineno-0-338>338</a></span>
<span class=normal><a href=#__codelineno-0-339>339</a></span>
<span class=normal><a href=#__codelineno-0-340>340</a></span>
<span class=normal><a href=#__codelineno-0-341>341</a></span>
<span class=normal><a href=#__codelineno-0-342>342</a></span>
<span class=normal><a href=#__codelineno-0-343>343</a></span>
<span class=normal><a href=#__codelineno-0-344>344</a></span>
<span class=normal><a href=#__codelineno-0-345>345</a></span>
<span class=normal><a href=#__codelineno-0-346>346</a></span>
<span class=normal><a href=#__codelineno-0-347>347</a></span>
<span class=normal><a href=#__codelineno-0-348>348</a></span>
<span class=normal><a href=#__codelineno-0-349>349</a></span>
<span class=normal><a href=#__codelineno-0-350>350</a></span>
<span class=normal><a href=#__codelineno-0-351>351</a></span>
<span class=normal><a href=#__codelineno-0-352>352</a></span>
<span class=normal><a href=#__codelineno-0-353>353</a></span>
<span class=normal><a href=#__codelineno-0-354>354</a></span>
<span class=normal><a href=#__codelineno-0-355>355</a></span>
<span class=normal><a href=#__codelineno-0-356>356</a></span>
<span class=normal><a href=#__codelineno-0-357>357</a></span>
<span class=normal><a href=#__codelineno-0-358>358</a></span>
<span class=normal><a href=#__codelineno-0-359>359</a></span>
<span class=normal><a href=#__codelineno-0-360>360</a></span>
<span class=normal><a href=#__codelineno-0-361>361</a></span>
<span class=normal><a href=#__codelineno-0-362>362</a></span>
<span class=normal><a href=#__codelineno-0-363>363</a></span>
<span class=normal><a href=#__codelineno-0-364>364</a></span>
<span class=normal><a href=#__codelineno-0-365>365</a></span>
<span class=normal><a href=#__codelineno-0-366>366</a></span>
<span class=normal><a href=#__codelineno-0-367>367</a></span>
<span class=normal><a href=#__codelineno-0-368>368</a></span>
<span class=normal><a href=#__codelineno-0-369>369</a></span>
<span class=normal><a href=#__codelineno-0-370>370</a></span>
<span class=normal><a href=#__codelineno-0-371>371</a></span>
<span class=normal><a href=#__codelineno-0-372>372</a></span>
<span class=normal><a href=#__codelineno-0-373>373</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-26><a id=__codelineno-0-26 name=__codelineno-0-26></a><span class=k>class</span><span class=w> </span><span class=nc>Agent</span><span class=p>(</span><span class=nb>object</span><span class=p>):</span>
</span><span id=__span-0-27><a id=__codelineno-0-27 name=__codelineno-0-27></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span>  <span class=c1># noqa: D107</span>
</span><span id=__span-0-28><a id=__codelineno-0-28 name=__codelineno-0-28></a>        <span class=bp>self</span><span class=p>,</span> <span class=n>identifier</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>agent_files</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>List</span><span class=p>,</span> <span class=n>Path</span><span class=p>],</span> <span class=n>metadata</span><span class=p>:</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>change_to_temp_dir</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span>
</span><span id=__span-0-29><a id=__codelineno-0-29 name=__codelineno-0-29></a>    <span class=p>):</span>  <span class=c1># noqa: D107</span>
</span><span id=__span-0-30><a id=__codelineno-0-30 name=__codelineno-0-30></a>        <span class=bp>self</span><span class=o>.</span><span class=n>code</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>CodeType</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-31><a id=__codelineno-0-31 name=__codelineno-0-31></a>        <span class=bp>self</span><span class=o>.</span><span class=n>file_cache</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>bytes</span><span class=p>]]</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-0-32><a id=__codelineno-0-32 name=__codelineno-0-32></a>        <span class=bp>self</span><span class=o>.</span><span class=n>identifier</span> <span class=o>=</span> <span class=n>identifier</span>
</span><span id=__span-0-33><a id=__codelineno-0-33 name=__codelineno-0-33></a>        <span class=n>name_parts</span> <span class=o>=</span> <span class=n>identifier</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;/&quot;</span><span class=p>)</span>
</span><span id=__span-0-34><a id=__codelineno-0-34 name=__codelineno-0-34></a>        <span class=bp>self</span><span class=o>.</span><span class=n>namespace</span> <span class=o>=</span> <span class=n>name_parts</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span><span id=__span-0-35><a id=__codelineno-0-35 name=__codelineno-0-35></a>        <span class=bp>self</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=n>name_parts</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span><span id=__span-0-36><a id=__codelineno-0-36 name=__codelineno-0-36></a>        <span class=bp>self</span><span class=o>.</span><span class=n>version</span> <span class=o>=</span> <span class=n>name_parts</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span>
</span><span id=__span-0-37><a id=__codelineno-0-37 name=__codelineno-0-37></a>
</span><span id=__span-0-38><a id=__codelineno-0-38 name=__codelineno-0-38></a>        <span class=bp>self</span><span class=o>.</span><span class=n>metadata</span> <span class=o>=</span> <span class=n>metadata</span>
</span><span id=__span-0-39><a id=__codelineno-0-39 name=__codelineno-0-39></a>        <span class=bp>self</span><span class=o>.</span><span class=n>env_vars</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-0-40><a id=__codelineno-0-40 name=__codelineno-0-40></a>
</span><span id=__span-0-41><a id=__codelineno-0-41 name=__codelineno-0-41></a>        <span class=bp>self</span><span class=o>.</span><span class=n>model</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-42><a id=__codelineno-0-42 name=__codelineno-0-42></a>        <span class=bp>self</span><span class=o>.</span><span class=n>model_provider</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-43><a id=__codelineno-0-43 name=__codelineno-0-43></a>        <span class=bp>self</span><span class=o>.</span><span class=n>model_temperature</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>float</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-44><a id=__codelineno-0-44 name=__codelineno-0-44></a>        <span class=bp>self</span><span class=o>.</span><span class=n>model_max_tokens</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-45><a id=__codelineno-0-45 name=__codelineno-0-45></a>        <span class=bp>self</span><span class=o>.</span><span class=n>max_iterations</span> <span class=o>=</span> <span class=mi>1</span>
</span><span id=__span-0-46><a id=__codelineno-0-46 name=__codelineno-0-46></a>        <span class=bp>self</span><span class=o>.</span><span class=n>welcome_title</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-47><a id=__codelineno-0-47 name=__codelineno-0-47></a>        <span class=bp>self</span><span class=o>.</span><span class=n>welcome_description</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-48><a id=__codelineno-0-48 name=__codelineno-0-48></a>
</span><span id=__span-0-49><a id=__codelineno-0-49 name=__codelineno-0-49></a>        <span class=bp>self</span><span class=o>.</span><span class=n>set_agent_metadata</span><span class=p>(</span><span class=n>metadata</span><span class=p>)</span>
</span><span id=__span-0-50><a id=__codelineno-0-50 name=__codelineno-0-50></a>        <span class=bp>self</span><span class=o>.</span><span class=n>agent_files</span> <span class=o>=</span> <span class=n>agent_files</span>
</span><span id=__span-0-51><a id=__codelineno-0-51 name=__codelineno-0-51></a>        <span class=bp>self</span><span class=o>.</span><span class=n>original_cwd</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getcwd</span><span class=p>()</span>
</span><span id=__span-0-52><a id=__codelineno-0-52 name=__codelineno-0-52></a>
</span><span id=__span-0-53><a id=__codelineno-0-53 name=__codelineno-0-53></a>        <span class=bp>self</span><span class=o>.</span><span class=n>temp_dir</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>write_agent_files_to_temp</span><span class=p>(</span><span class=n>agent_files</span><span class=p>)</span>
</span><span id=__span-0-54><a id=__codelineno-0-54 name=__codelineno-0-54></a>        <span class=bp>self</span><span class=o>.</span><span class=n>ts_runner_dir</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-55><a id=__codelineno-0-55 name=__codelineno-0-55></a>        <span class=bp>self</span><span class=o>.</span><span class=n>change_to_temp_dir</span> <span class=o>=</span> <span class=n>change_to_temp_dir</span>
</span><span id=__span-0-56><a id=__codelineno-0-56 name=__codelineno-0-56></a>        <span class=bp>self</span><span class=o>.</span><span class=n>agent_filename</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-57><a id=__codelineno-0-57 name=__codelineno-0-57></a>        <span class=bp>self</span><span class=o>.</span><span class=n>agent_language</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-58><a id=__codelineno-0-58 name=__codelineno-0-58></a>
</span><span id=__span-0-59><a id=__codelineno-0-59 name=__codelineno-0-59></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_full_name</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-0-60><a id=__codelineno-0-60 name=__codelineno-0-60></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns full agent name.&quot;&quot;&quot;</span>
</span><span id=__span-0-61><a id=__codelineno-0-61 name=__codelineno-0-61></a>        <span class=k>return</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>namespace</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>version</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-62><a id=__codelineno-0-62 name=__codelineno-0-62></a>
</span><span id=__span-0-63><a id=__codelineno-0-63 name=__codelineno-0-63></a>    <span class=nd>@staticmethod</span>
</span><span id=__span-0-64><a id=__codelineno-0-64 name=__codelineno-0-64></a>    <span class=k>def</span><span class=w> </span><span class=nf>write_agent_files_to_temp</span><span class=p>(</span><span class=n>agent_files</span><span class=p>):</span>
</span><span id=__span-0-65><a id=__codelineno-0-65 name=__codelineno-0-65></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Write agent files to a temporary directory.&quot;&quot;&quot;</span>
</span><span id=__span-0-66><a id=__codelineno-0-66 name=__codelineno-0-66></a>        <span class=n>unique_id</span> <span class=o>=</span> <span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()</span><span class=o>.</span><span class=n>hex</span>
</span><span id=__span-0-67><a id=__codelineno-0-67 name=__codelineno-0-67></a>        <span class=n>temp_dir</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>tempfile</span><span class=o>.</span><span class=n>gettempdir</span><span class=p>(),</span> <span class=sa>f</span><span class=s2>&quot;agent_</span><span class=si>{</span><span class=n>unique_id</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-68><a id=__codelineno-0-68 name=__codelineno-0-68></a>
</span><span id=__span-0-69><a id=__codelineno-0-69 name=__codelineno-0-69></a>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>agent_files</span><span class=p>,</span> <span class=n>List</span><span class=p>):</span>
</span><span id=__span-0-70><a id=__codelineno-0-70 name=__codelineno-0-70></a>            <span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=n>temp_dir</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-71><a id=__codelineno-0-71 name=__codelineno-0-71></a>
</span><span id=__span-0-72><a id=__codelineno-0-72 name=__codelineno-0-72></a>            <span class=k>for</span> <span class=n>file_obj</span> <span class=ow>in</span> <span class=n>agent_files</span><span class=p>:</span>
</span><span id=__span-0-73><a id=__codelineno-0-73 name=__codelineno-0-73></a>                <span class=n>file_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>temp_dir</span><span class=p>,</span> <span class=n>file_obj</span><span class=p>[</span><span class=s2>&quot;filename&quot;</span><span class=p>])</span>
</span><span id=__span-0-74><a id=__codelineno-0-74 name=__codelineno-0-74></a>
</span><span id=__span-0-75><a id=__codelineno-0-75 name=__codelineno-0-75></a>                <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-76><a id=__codelineno-0-76 name=__codelineno-0-76></a>                    <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=n>file_path</span><span class=p>)):</span>
</span><span id=__span-0-77><a id=__codelineno-0-77 name=__codelineno-0-77></a>                        <span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=n>file_path</span><span class=p>))</span>
</span><span id=__span-0-78><a id=__codelineno-0-78 name=__codelineno-0-78></a>
</span><span id=__span-0-79><a id=__codelineno-0-79 name=__codelineno-0-79></a>                    <span class=n>content</span> <span class=o>=</span> <span class=n>file_obj</span><span class=p>[</span><span class=s2>&quot;content&quot;</span><span class=p>]</span>
</span><span id=__span-0-80><a id=__codelineno-0-80 name=__codelineno-0-80></a>
</span><span id=__span-0-81><a id=__codelineno-0-81 name=__codelineno-0-81></a>                    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>content</span><span class=p>,</span> <span class=nb>dict</span><span class=p>)</span> <span class=ow>or</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>content</span><span class=p>,</span> <span class=nb>list</span><span class=p>):</span>
</span><span id=__span-0-82><a id=__codelineno-0-82 name=__codelineno-0-82></a>                        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-83><a id=__codelineno-0-83 name=__codelineno-0-83></a>                            <span class=n>content</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>
</span><span id=__span-0-84><a id=__codelineno-0-84 name=__codelineno-0-84></a>                        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-85><a id=__codelineno-0-85 name=__codelineno-0-85></a>                            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error converting content to json: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-86><a id=__codelineno-0-86 name=__codelineno-0-86></a>                        <span class=n>content</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>
</span><span id=__span-0-87><a id=__codelineno-0-87 name=__codelineno-0-87></a>
</span><span id=__span-0-88><a id=__codelineno-0-88 name=__codelineno-0-88></a>                    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>content</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-89><a id=__codelineno-0-89 name=__codelineno-0-89></a>                        <span class=n>content</span> <span class=o>=</span> <span class=n>content</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s2>&quot;utf-8&quot;</span><span class=p>)</span>
</span><span id=__span-0-90><a id=__codelineno-0-90 name=__codelineno-0-90></a>
</span><span id=__span-0-91><a id=__codelineno-0-91 name=__codelineno-0-91></a>                    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=s2>&quot;wb&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-92><a id=__codelineno-0-92 name=__codelineno-0-92></a>                        <span class=k>with</span> <span class=n>io</span><span class=o>.</span><span class=n>BytesIO</span><span class=p>(</span><span class=n>content</span><span class=p>)</span> <span class=k>as</span> <span class=n>byte_stream</span><span class=p>:</span>
</span><span id=__span-0-93><a id=__codelineno-0-93 name=__codelineno-0-93></a>                            <span class=n>shutil</span><span class=o>.</span><span class=n>copyfileobj</span><span class=p>(</span><span class=n>byte_stream</span><span class=p>,</span> <span class=n>f</span><span class=p>)</span>
</span><span id=__span-0-94><a id=__codelineno-0-94 name=__codelineno-0-94></a>                <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-95><a id=__codelineno-0-95 name=__codelineno-0-95></a>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error writing file </span><span class=si>{</span><span class=n>file_path</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-96><a id=__codelineno-0-96 name=__codelineno-0-96></a>                    <span class=k>raise</span> <span class=n>e</span>
</span><span id=__span-0-97><a id=__codelineno-0-97 name=__codelineno-0-97></a>
</span><span id=__span-0-98><a id=__codelineno-0-98 name=__codelineno-0-98></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-99><a id=__codelineno-0-99 name=__codelineno-0-99></a>            <span class=c1># if agent files is a PosixPath, it is a path to the agent directory</span>
</span><span id=__span-0-100><a id=__codelineno-0-100 name=__codelineno-0-100></a>            <span class=c1># Copy all agent files including subfolders</span>
</span><span id=__span-0-101><a id=__codelineno-0-101 name=__codelineno-0-101></a>            <span class=n>shutil</span><span class=o>.</span><span class=n>copytree</span><span class=p>(</span><span class=n>agent_files</span><span class=p>,</span> <span class=n>temp_dir</span><span class=p>,</span> <span class=n>dirs_exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-102><a id=__codelineno-0-102 name=__codelineno-0-102></a>
</span><span id=__span-0-103><a id=__codelineno-0-103 name=__codelineno-0-103></a>        <span class=k>return</span> <span class=n>temp_dir</span>
</span><span id=__span-0-104><a id=__codelineno-0-104 name=__codelineno-0-104></a>
</span><span id=__span-0-105><a id=__codelineno-0-105 name=__codelineno-0-105></a>    <span class=k>def</span><span class=w> </span><span class=nf>set_agent_metadata</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>metadata</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-106><a id=__codelineno-0-106 name=__codelineno-0-106></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Set agent details from metadata.&quot;&quot;&quot;</span>
</span><span id=__span-0-107><a id=__codelineno-0-107 name=__codelineno-0-107></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-108><a id=__codelineno-0-108 name=__codelineno-0-108></a>            <span class=bp>self</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=n>metadata</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]</span>
</span><span id=__span-0-109><a id=__codelineno-0-109 name=__codelineno-0-109></a>            <span class=bp>self</span><span class=o>.</span><span class=n>version</span> <span class=o>=</span> <span class=n>metadata</span><span class=p>[</span><span class=s2>&quot;version&quot;</span><span class=p>]</span>
</span><span id=__span-0-110><a id=__codelineno-0-110 name=__codelineno-0-110></a>        <span class=k>except</span> <span class=ne>KeyError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-111><a id=__codelineno-0-111 name=__codelineno-0-111></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Missing key in metadata: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span> <span class=kn>from</span><span class=w> </span><span class=kc>None</span>
</span><span id=__span-0-112><a id=__codelineno-0-112 name=__codelineno-0-112></a>
</span><span id=__span-0-113><a id=__codelineno-0-113 name=__codelineno-0-113></a>        <span class=n>details</span> <span class=o>=</span> <span class=n>metadata</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;details&quot;</span><span class=p>,</span> <span class=p>{})</span>
</span><span id=__span-0-114><a id=__codelineno-0-114 name=__codelineno-0-114></a>        <span class=n>agent</span> <span class=o>=</span> <span class=n>details</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;agent&quot;</span><span class=p>,</span> <span class=p>{})</span>
</span><span id=__span-0-115><a id=__codelineno-0-115 name=__codelineno-0-115></a>        <span class=n>welcome</span> <span class=o>=</span> <span class=n>agent</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;welcome&quot;</span><span class=p>,</span> <span class=p>{})</span>
</span><span id=__span-0-116><a id=__codelineno-0-116 name=__codelineno-0-116></a>
</span><span id=__span-0-117><a id=__codelineno-0-117 name=__codelineno-0-117></a>        <span class=bp>self</span><span class=o>.</span><span class=n>env_vars</span> <span class=o>=</span> <span class=n>details</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;env_vars&quot;</span><span class=p>,</span> <span class=p>{})</span>
</span><span id=__span-0-118><a id=__codelineno-0-118 name=__codelineno-0-118></a>        <span class=bp>self</span><span class=o>.</span><span class=n>welcome_title</span> <span class=o>=</span> <span class=n>welcome</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;title&quot;</span><span class=p>)</span>
</span><span id=__span-0-119><a id=__codelineno-0-119 name=__codelineno-0-119></a>        <span class=bp>self</span><span class=o>.</span><span class=n>welcome_description</span> <span class=o>=</span> <span class=n>welcome</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;description&quot;</span><span class=p>)</span>
</span><span id=__span-0-120><a id=__codelineno-0-120 name=__codelineno-0-120></a>
</span><span id=__span-0-121><a id=__codelineno-0-121 name=__codelineno-0-121></a>        <span class=k>if</span> <span class=n>agent_metadata</span> <span class=o>:=</span> <span class=n>details</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;agent&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>):</span>
</span><span id=__span-0-122><a id=__codelineno-0-122 name=__codelineno-0-122></a>            <span class=k>if</span> <span class=n>defaults</span> <span class=o>:=</span> <span class=n>agent_metadata</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;defaults&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>):</span>
</span><span id=__span-0-123><a id=__codelineno-0-123 name=__codelineno-0-123></a>                <span class=bp>self</span><span class=o>.</span><span class=n>model</span> <span class=o>=</span> <span class=n>defaults</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;model&quot;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>model</span><span class=p>)</span>
</span><span id=__span-0-124><a id=__codelineno-0-124 name=__codelineno-0-124></a>                <span class=bp>self</span><span class=o>.</span><span class=n>model_provider</span> <span class=o>=</span> <span class=n>defaults</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;model_provider&quot;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>model_provider</span><span class=p>)</span>
</span><span id=__span-0-125><a id=__codelineno-0-125 name=__codelineno-0-125></a>                <span class=bp>self</span><span class=o>.</span><span class=n>model_temperature</span> <span class=o>=</span> <span class=n>defaults</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;model_temperature&quot;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>model_temperature</span><span class=p>)</span>
</span><span id=__span-0-126><a id=__codelineno-0-126 name=__codelineno-0-126></a>                <span class=bp>self</span><span class=o>.</span><span class=n>model_max_tokens</span> <span class=o>=</span> <span class=n>defaults</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;model_max_tokens&quot;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>model_max_tokens</span><span class=p>)</span>
</span><span id=__span-0-127><a id=__codelineno-0-127 name=__codelineno-0-127></a>                <span class=bp>self</span><span class=o>.</span><span class=n>max_iterations</span> <span class=o>=</span> <span class=n>defaults</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;max_iterations&quot;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>max_iterations</span><span class=p>)</span>
</span><span id=__span-0-128><a id=__codelineno-0-128 name=__codelineno-0-128></a>
</span><span id=__span-0-129><a id=__codelineno-0-129 name=__codelineno-0-129></a>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>version</span> <span class=ow>or</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=p>:</span>
</span><span id=__span-0-130><a id=__codelineno-0-130 name=__codelineno-0-130></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Both &#39;version&#39; and &#39;name&#39; must be non-empty in metadata.&quot;</span><span class=p>)</span>
</span><span id=__span-0-131><a id=__codelineno-0-131 name=__codelineno-0-131></a>
</span><span id=__span-0-132><a id=__codelineno-0-132 name=__codelineno-0-132></a>    <span class=k>def</span><span class=w> </span><span class=nf>run_python_code</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>agent_namespace</span><span class=p>,</span> <span class=n>agent_runner_user</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>],</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]]:</span>
</span><span id=__span-0-133><a id=__codelineno-0-133 name=__codelineno-0-133></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Launch python agent.&quot;&quot;&quot;</span>
</span><span id=__span-0-134><a id=__codelineno-0-134 name=__codelineno-0-134></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-135><a id=__codelineno-0-135 name=__codelineno-0-135></a>            <span class=c1># switch to user env.agent_runner_user</span>
</span><span id=__span-0-136><a id=__codelineno-0-136 name=__codelineno-0-136></a>            <span class=k>if</span> <span class=n>agent_runner_user</span><span class=p>:</span>
</span><span id=__span-0-137><a id=__codelineno-0-137 name=__codelineno-0-137></a>                <span class=n>user_info</span> <span class=o>=</span> <span class=n>pwd</span><span class=o>.</span><span class=n>getpwnam</span><span class=p>(</span><span class=n>agent_runner_user</span><span class=p>)</span>
</span><span id=__span-0-138><a id=__codelineno-0-138 name=__codelineno-0-138></a>                <span class=n>os</span><span class=o>.</span><span class=n>setgid</span><span class=p>(</span><span class=n>user_info</span><span class=o>.</span><span class=n>pw_gid</span><span class=p>)</span>
</span><span id=__span-0-139><a id=__codelineno-0-139 name=__codelineno-0-139></a>                <span class=n>os</span><span class=o>.</span><span class=n>setuid</span><span class=p>(</span><span class=n>user_info</span><span class=o>.</span><span class=n>pw_uid</span><span class=p>)</span>
</span><span id=__span-0-140><a id=__codelineno-0-140 name=__codelineno-0-140></a>
</span><span id=__span-0-141><a id=__codelineno-0-141 name=__codelineno-0-141></a>            <span class=c1># Run the code</span>
</span><span id=__span-0-142><a id=__codelineno-0-142 name=__codelineno-0-142></a>            <span class=c1># NOTE: runpy.run_path does not work in a multithreaded environment when running benchmark.</span>
</span><span id=__span-0-143><a id=__codelineno-0-143 name=__codelineno-0-143></a>            <span class=c1>#       The performance of runpy.run_path may also change depending on a system, e.g. it may</span>
</span><span id=__span-0-144><a id=__codelineno-0-144 name=__codelineno-0-144></a>            <span class=c1>#       work on Linux but not work on Mac.</span>
</span><span id=__span-0-145><a id=__codelineno-0-145 name=__codelineno-0-145></a>            <span class=c1>#       `compile` and `exec` have been tested to work properly in a multithreaded environment.</span>
</span><span id=__span-0-146><a id=__codelineno-0-146 name=__codelineno-0-146></a>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>code</span><span class=p>:</span>
</span><span id=__span-0-147><a id=__codelineno-0-147 name=__codelineno-0-147></a>                <span class=n>exec</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>code</span><span class=p>,</span> <span class=n>agent_namespace</span><span class=p>)</span>
</span><span id=__span-0-148><a id=__codelineno-0-148 name=__codelineno-0-148></a>
</span><span id=__span-0-149><a id=__codelineno-0-149 name=__codelineno-0-149></a>            <span class=c1># If no errors occur, return None</span>
</span><span id=__span-0-150><a id=__codelineno-0-150 name=__codelineno-0-150></a>            <span class=k>return</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span>
</span><span id=__span-0-151><a id=__codelineno-0-151 name=__codelineno-0-151></a>
</span><span id=__span-0-152><a id=__codelineno-0-152 name=__codelineno-0-152></a>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-153><a id=__codelineno-0-153 name=__codelineno-0-153></a>            <span class=c1># Return error message and full traceback as strings</span>
</span><span id=__span-0-154><a id=__codelineno-0-154 name=__codelineno-0-154></a>            <span class=k>return</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>),</span> <span class=n>traceback</span><span class=o>.</span><span class=n>format_exc</span><span class=p>()</span>
</span><span id=__span-0-155><a id=__codelineno-0-155 name=__codelineno-0-155></a>
</span><span id=__span-0-156><a id=__codelineno-0-156 name=__codelineno-0-156></a>    <span class=k>def</span><span class=w> </span><span class=nf>run_ts_agent</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>agent_filename</span><span class=p>,</span> <span class=n>env_vars</span><span class=p>,</span> <span class=n>json_params</span><span class=p>):</span>
</span><span id=__span-0-157><a id=__codelineno-0-157 name=__codelineno-0-157></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Launch typescript agent.&quot;&quot;&quot;</span>
</span><span id=__span-0-158><a id=__codelineno-0-158 name=__codelineno-0-158></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Running typescript agent </span><span class=si>{</span><span class=n>agent_filename</span><span class=si>}</span><span class=s2> from </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>ts_runner_dir</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-159><a id=__codelineno-0-159 name=__codelineno-0-159></a>
</span><span id=__span-0-160><a id=__codelineno-0-160 name=__codelineno-0-160></a>        <span class=c1># Configure npm to use tmp directories</span>
</span><span id=__span-0-161><a id=__codelineno-0-161 name=__codelineno-0-161></a>        <span class=n>env</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
</span><span id=__span-0-162><a id=__codelineno-0-162 name=__codelineno-0-162></a>        <span class=n>env</span><span class=o>.</span><span class=n>update</span><span class=p>(</span>
</span><span id=__span-0-163><a id=__codelineno-0-163 name=__codelineno-0-163></a>            <span class=p>{</span>
</span><span id=__span-0-164><a id=__codelineno-0-164 name=__codelineno-0-164></a>                <span class=s2>&quot;NPM_CONFIG_CACHE&quot;</span><span class=p>:</span> <span class=s2>&quot;/tmp/npm_cache&quot;</span><span class=p>,</span>
</span><span id=__span-0-165><a id=__codelineno-0-165 name=__codelineno-0-165></a>                <span class=s2>&quot;NPM_CONFIG_PREFIX&quot;</span><span class=p>:</span> <span class=s2>&quot;/tmp/npm_prefix&quot;</span><span class=p>,</span>
</span><span id=__span-0-166><a id=__codelineno-0-166 name=__codelineno-0-166></a>                <span class=s2>&quot;HOME&quot;</span><span class=p>:</span> <span class=s2>&quot;/tmp&quot;</span><span class=p>,</span>  <span class=c1># Redirect npm home</span>
</span><span id=__span-0-167><a id=__codelineno-0-167 name=__codelineno-0-167></a>                <span class=s2>&quot;NPM_CONFIG_LOGLEVEL&quot;</span><span class=p>:</span> <span class=s2>&quot;error&quot;</span><span class=p>,</span>  <span class=c1># Suppress warnings, show only errors</span>
</span><span id=__span-0-168><a id=__codelineno-0-168 name=__codelineno-0-168></a>            <span class=p>}</span>
</span><span id=__span-0-169><a id=__codelineno-0-169 name=__codelineno-0-169></a>        <span class=p>)</span>
</span><span id=__span-0-170><a id=__codelineno-0-170 name=__codelineno-0-170></a>
</span><span id=__span-0-171><a id=__codelineno-0-171 name=__codelineno-0-171></a>        <span class=c1># Ensure directory structure exists</span>
</span><span id=__span-0-172><a id=__codelineno-0-172 name=__codelineno-0-172></a>        <span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=s2>&quot;/tmp/npm_cache&quot;</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-173><a id=__codelineno-0-173 name=__codelineno-0-173></a>        <span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=s2>&quot;/tmp/npm_prefix&quot;</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-174><a id=__codelineno-0-174 name=__codelineno-0-174></a>
</span><span id=__span-0-175><a id=__codelineno-0-175 name=__codelineno-0-175></a>        <span class=c1># read file /tmp/build-info.txt if exists</span>
</span><span id=__span-0-176><a id=__codelineno-0-176 name=__codelineno-0-176></a>        <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=s2>&quot;/var/task/build-info.txt&quot;</span><span class=p>):</span>
</span><span id=__span-0-177><a id=__codelineno-0-177 name=__codelineno-0-177></a>            <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&quot;/var/task/build-info.txt&quot;</span><span class=p>,</span> <span class=s2>&quot;r&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>file</span><span class=p>:</span>
</span><span id=__span-0-178><a id=__codelineno-0-178 name=__codelineno-0-178></a>                <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;BUILD ID: &quot;</span><span class=p>,</span> <span class=n>file</span><span class=o>.</span><span class=n>read</span><span class=p>())</span>
</span><span id=__span-0-179><a id=__codelineno-0-179 name=__codelineno-0-179></a>
</span><span id=__span-0-180><a id=__codelineno-0-180 name=__codelineno-0-180></a>        <span class=k>if</span> <span class=n>env_vars</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;DEBUG&quot;</span><span class=p>):</span>
</span><span id=__span-0-181><a id=__codelineno-0-181 name=__codelineno-0-181></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Directory structure:&quot;</span><span class=p>,</span> <span class=n>os</span><span class=o>.</span><span class=n>listdir</span><span class=p>(</span><span class=s2>&quot;/tmp/ts_runner&quot;</span><span class=p>))</span>
</span><span id=__span-0-182><a id=__codelineno-0-182 name=__codelineno-0-182></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Check package.json:&quot;</span><span class=p>,</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>ts_runner_dir</span><span class=p>,</span> <span class=s2>&quot;package.json&quot;</span><span class=p>)))</span>
</span><span id=__span-0-183><a id=__codelineno-0-183 name=__codelineno-0-183></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Symlink exists:&quot;</span><span class=p>,</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=s2>&quot;/tmp/ts_runner/node_modules/.bin/tsc&quot;</span><span class=p>))</span>
</span><span id=__span-0-184><a id=__codelineno-0-184 name=__codelineno-0-184></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Build files exist:&quot;</span><span class=p>,</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=s2>&quot;/tmp/ts_runner/build/sdk/main.js&quot;</span><span class=p>))</span>
</span><span id=__span-0-185><a id=__codelineno-0-185 name=__codelineno-0-185></a>
</span><span id=__span-0-186><a id=__codelineno-0-186 name=__codelineno-0-186></a>        <span class=c1># Launching a subprocess to run an npm script with specific configurations</span>
</span><span id=__span-0-187><a id=__codelineno-0-187 name=__codelineno-0-187></a>        <span class=n>ts_process</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>Popen</span><span class=p>(</span>
</span><span id=__span-0-188><a id=__codelineno-0-188 name=__codelineno-0-188></a>            <span class=p>[</span>
</span><span id=__span-0-189><a id=__codelineno-0-189 name=__codelineno-0-189></a>                <span class=s2>&quot;npm&quot;</span><span class=p>,</span>  <span class=c1># Command to run Node Package Manager</span>
</span><span id=__span-0-190><a id=__codelineno-0-190 name=__codelineno-0-190></a>                <span class=s2>&quot;--loglevel=error&quot;</span><span class=p>,</span>  <span class=c1># Suppress npm warnings and info logs, only show errors</span>
</span><span id=__span-0-191><a id=__codelineno-0-191 name=__codelineno-0-191></a>                <span class=s2>&quot;--prefix&quot;</span><span class=p>,</span>
</span><span id=__span-0-192><a id=__codelineno-0-192 name=__codelineno-0-192></a>                <span class=bp>self</span><span class=o>.</span><span class=n>ts_runner_dir</span><span class=p>,</span>  <span class=c1># Specifies the directory where npm should look for package.json</span>
</span><span id=__span-0-193><a id=__codelineno-0-193 name=__codelineno-0-193></a>                <span class=s2>&quot;run&quot;</span><span class=p>,</span>
</span><span id=__span-0-194><a id=__codelineno-0-194 name=__codelineno-0-194></a>                <span class=s2>&quot;start&quot;</span><span class=p>,</span>  <span class=c1># Runs the &quot;start&quot; script defined in package.json, this launches the agent</span>
</span><span id=__span-0-195><a id=__codelineno-0-195 name=__codelineno-0-195></a>                <span class=s2>&quot;agents/agent.ts&quot;</span><span class=p>,</span>
</span><span id=__span-0-196><a id=__codelineno-0-196 name=__codelineno-0-196></a>                <span class=n>json_params</span><span class=p>,</span>  <span class=c1># Arguments passed to the &quot;start&quot; script to configure the agent</span>
</span><span id=__span-0-197><a id=__codelineno-0-197 name=__codelineno-0-197></a>            <span class=p>],</span>
</span><span id=__span-0-198><a id=__codelineno-0-198 name=__codelineno-0-198></a>            <span class=n>stdout</span><span class=o>=</span><span class=n>subprocess</span><span class=o>.</span><span class=n>PIPE</span><span class=p>,</span>  <span class=c1># Captures standard output from the process</span>
</span><span id=__span-0-199><a id=__codelineno-0-199 name=__codelineno-0-199></a>            <span class=n>stderr</span><span class=o>=</span><span class=n>subprocess</span><span class=o>.</span><span class=n>PIPE</span><span class=p>,</span>  <span class=c1># Captures standard error</span>
</span><span id=__span-0-200><a id=__codelineno-0-200 name=__codelineno-0-200></a>            <span class=n>cwd</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>ts_runner_dir</span><span class=p>,</span>  <span class=c1># Sets the current working directory for the process</span>
</span><span id=__span-0-201><a id=__codelineno-0-201 name=__codelineno-0-201></a>            <span class=n>env</span><span class=o>=</span><span class=n>env_vars</span><span class=p>,</span>  <span class=c1># Provides custom environment variables to the subprocess</span>
</span><span id=__span-0-202><a id=__codelineno-0-202 name=__codelineno-0-202></a>        <span class=p>)</span>
</span><span id=__span-0-203><a id=__codelineno-0-203 name=__codelineno-0-203></a>
</span><span id=__span-0-204><a id=__codelineno-0-204 name=__codelineno-0-204></a>        <span class=n>stdout</span><span class=p>,</span> <span class=n>stderr</span> <span class=o>=</span> <span class=n>ts_process</span><span class=o>.</span><span class=n>communicate</span><span class=p>()</span>
</span><span id=__span-0-205><a id=__codelineno-0-205 name=__codelineno-0-205></a>
</span><span id=__span-0-206><a id=__codelineno-0-206 name=__codelineno-0-206></a>        <span class=n>stdout</span> <span class=o>=</span> <span class=n>stdout</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span><span id=__span-0-207><a id=__codelineno-0-207 name=__codelineno-0-207></a>        <span class=k>if</span> <span class=n>stdout</span> <span class=ow>and</span> <span class=n>env_vars</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;DEBUG&quot;</span><span class=p>):</span>
</span><span id=__span-0-208><a id=__codelineno-0-208 name=__codelineno-0-208></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;TS AGENT STDOUT: </span><span class=si>{</span><span class=n>stdout</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-209><a id=__codelineno-0-209 name=__codelineno-0-209></a>
</span><span id=__span-0-210><a id=__codelineno-0-210 name=__codelineno-0-210></a>        <span class=n>stderr</span> <span class=o>=</span> <span class=n>stderr</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span><span id=__span-0-211><a id=__codelineno-0-211 name=__codelineno-0-211></a>        <span class=k>if</span> <span class=n>stderr</span><span class=p>:</span>
</span><span id=__span-0-212><a id=__codelineno-0-212 name=__codelineno-0-212></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;TS AGENT STDERR: </span><span class=si>{</span><span class=n>stderr</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-213><a id=__codelineno-0-213 name=__codelineno-0-213></a>
</span><span id=__span-0-214><a id=__codelineno-0-214 name=__codelineno-0-214></a>    <span class=k>def</span><span class=w> </span><span class=nf>run</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>env</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span> <span class=n>task</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>],</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]]:</span>
</span><span id=__span-0-215><a id=__codelineno-0-215 name=__codelineno-0-215></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Run the agent code. Returns error message and traceback message.&quot;&quot;&quot;</span>
</span><span id=__span-0-216><a id=__codelineno-0-216 name=__codelineno-0-216></a>        <span class=c1># combine agent.env_vars and env.env_vars</span>
</span><span id=__span-0-217><a id=__codelineno-0-217 name=__codelineno-0-217></a>        <span class=n>total_env_vars</span> <span class=o>=</span> <span class=p>{</span><span class=o>**</span><span class=bp>self</span><span class=o>.</span><span class=n>env_vars</span><span class=p>,</span> <span class=o>**</span><span class=n>env</span><span class=o>.</span><span class=n>env_vars</span><span class=p>}</span>
</span><span id=__span-0-218><a id=__codelineno-0-218 name=__codelineno-0-218></a>
</span><span id=__span-0-219><a id=__codelineno-0-219 name=__codelineno-0-219></a>        <span class=c1># save os env vars</span>
</span><span id=__span-0-220><a id=__codelineno-0-220 name=__codelineno-0-220></a>        <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>total_env_vars</span><span class=p>)</span>
</span><span id=__span-0-221><a id=__codelineno-0-221 name=__codelineno-0-221></a>        <span class=c1># save env.env_vars</span>
</span><span id=__span-0-222><a id=__codelineno-0-222 name=__codelineno-0-222></a>        <span class=n>env</span><span class=o>.</span><span class=n>env_vars</span> <span class=o>=</span> <span class=n>total_env_vars</span>
</span><span id=__span-0-223><a id=__codelineno-0-223 name=__codelineno-0-223></a>
</span><span id=__span-0-224><a id=__codelineno-0-224 name=__codelineno-0-224></a>        <span class=n>agent_ts_files_to_transpile</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-0-225><a id=__codelineno-0-225 name=__codelineno-0-225></a>
</span><span id=__span-0-226><a id=__codelineno-0-226 name=__codelineno-0-226></a>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>agent_filename</span> <span class=ow>or</span> <span class=kc>True</span><span class=p>:</span>
</span><span id=__span-0-227><a id=__codelineno-0-227 name=__codelineno-0-227></a>            <span class=c1># if agent has &quot;agent.py&quot; file, we use python runner</span>
</span><span id=__span-0-228><a id=__codelineno-0-228 name=__codelineno-0-228></a>            <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>temp_dir</span><span class=p>,</span> <span class=n>AGENT_FILENAME_PY</span><span class=p>)):</span>
</span><span id=__span-0-229><a id=__codelineno-0-229 name=__codelineno-0-229></a>                <span class=bp>self</span><span class=o>.</span><span class=n>agent_filename</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>temp_dir</span><span class=p>,</span> <span class=n>AGENT_FILENAME_PY</span><span class=p>)</span>
</span><span id=__span-0-230><a id=__codelineno-0-230 name=__codelineno-0-230></a>                <span class=bp>self</span><span class=o>.</span><span class=n>agent_language</span> <span class=o>=</span> <span class=s2>&quot;py&quot;</span>
</span><span id=__span-0-231><a id=__codelineno-0-231 name=__codelineno-0-231></a>                <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>agent_filename</span><span class=p>,</span> <span class=s2>&quot;r&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>agent_file</span><span class=p>:</span>
</span><span id=__span-0-232><a id=__codelineno-0-232 name=__codelineno-0-232></a>                    <span class=bp>self</span><span class=o>.</span><span class=n>code</span> <span class=o>=</span> <span class=nb>compile</span><span class=p>(</span><span class=n>agent_file</span><span class=o>.</span><span class=n>read</span><span class=p>(),</span> <span class=bp>self</span><span class=o>.</span><span class=n>agent_filename</span><span class=p>,</span> <span class=s2>&quot;exec&quot;</span><span class=p>)</span>
</span><span id=__span-0-233><a id=__codelineno-0-233 name=__codelineno-0-233></a>            <span class=c1># else, if agent has &quot;agent.ts&quot; file, we use typescript runner</span>
</span><span id=__span-0-234><a id=__codelineno-0-234 name=__codelineno-0-234></a>            <span class=k>elif</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>temp_dir</span><span class=p>,</span> <span class=n>AGENT_FILENAME_TS</span><span class=p>)):</span>
</span><span id=__span-0-235><a id=__codelineno-0-235 name=__codelineno-0-235></a>                <span class=bp>self</span><span class=o>.</span><span class=n>agent_filename</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>temp_dir</span><span class=p>,</span> <span class=n>AGENT_FILENAME_TS</span><span class=p>)</span>
</span><span id=__span-0-236><a id=__codelineno-0-236 name=__codelineno-0-236></a>                <span class=bp>self</span><span class=o>.</span><span class=n>agent_language</span> <span class=o>=</span> <span class=s2>&quot;ts&quot;</span>
</span><span id=__span-0-237><a id=__codelineno-0-237 name=__codelineno-0-237></a>
</span><span id=__span-0-238><a id=__codelineno-0-238 name=__codelineno-0-238></a>                <span class=c1># copy files from nearai/ts_runner_sdk to self.temp_dir</span>
</span><span id=__span-0-239><a id=__codelineno-0-239 name=__codelineno-0-239></a>                <span class=n>ts_runner_sdk_dir</span> <span class=o>=</span> <span class=s2>&quot;/tmp/ts_runner&quot;</span>
</span><span id=__span-0-240><a id=__codelineno-0-240 name=__codelineno-0-240></a>                <span class=n>ts_runner_agent_dir</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>ts_runner_sdk_dir</span><span class=p>,</span> <span class=s2>&quot;agents&quot;</span><span class=p>)</span>
</span><span id=__span-0-241><a id=__codelineno-0-241 name=__codelineno-0-241></a>
</span><span id=__span-0-242><a id=__codelineno-0-242 name=__codelineno-0-242></a>                <span class=n>ts_runner_actual_path</span> <span class=o>=</span> <span class=s2>&quot;/var/task/ts_runner&quot;</span>
</span><span id=__span-0-243><a id=__codelineno-0-243 name=__codelineno-0-243></a>
</span><span id=__span-0-244><a id=__codelineno-0-244 name=__codelineno-0-244></a>                <span class=n>shutil</span><span class=o>.</span><span class=n>copytree</span><span class=p>(</span><span class=n>ts_runner_actual_path</span><span class=p>,</span> <span class=n>ts_runner_sdk_dir</span><span class=p>,</span> <span class=n>symlinks</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>dirs_exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-245><a id=__codelineno-0-245 name=__codelineno-0-245></a>
</span><span id=__span-0-246><a id=__codelineno-0-246 name=__codelineno-0-246></a>                <span class=c1># make ts agents dir if not exists</span>
</span><span id=__span-0-247><a id=__codelineno-0-247 name=__codelineno-0-247></a>                <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>ts_runner_agent_dir</span><span class=p>):</span>
</span><span id=__span-0-248><a id=__codelineno-0-248 name=__codelineno-0-248></a>                    <span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=n>ts_runner_agent_dir</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-249><a id=__codelineno-0-249 name=__codelineno-0-249></a>
</span><span id=__span-0-250><a id=__codelineno-0-250 name=__codelineno-0-250></a>                <span class=c1># copy agents files</span>
</span><span id=__span-0-251><a id=__codelineno-0-251 name=__codelineno-0-251></a>                <span class=n>shutil</span><span class=o>.</span><span class=n>copy</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>temp_dir</span><span class=p>,</span> <span class=n>AGENT_FILENAME_TS</span><span class=p>),</span> <span class=n>ts_runner_agent_dir</span><span class=p>)</span>
</span><span id=__span-0-252><a id=__codelineno-0-252 name=__codelineno-0-252></a>
</span><span id=__span-0-253><a id=__codelineno-0-253 name=__codelineno-0-253></a>                <span class=bp>self</span><span class=o>.</span><span class=n>ts_runner_dir</span> <span class=o>=</span> <span class=n>ts_runner_sdk_dir</span>
</span><span id=__span-0-254><a id=__codelineno-0-254 name=__codelineno-0-254></a>            <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-255><a id=__codelineno-0-255 name=__codelineno-0-255></a>                <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Agent run error: </span><span class=si>{</span><span class=n>AGENT_FILENAME_PY</span><span class=si>}</span><span class=s2> or </span><span class=si>{</span><span class=n>AGENT_FILENAME_TS</span><span class=si>}</span><span class=s2> does not exist&quot;</span><span class=p>)</span>
</span><span id=__span-0-256><a id=__codelineno-0-256 name=__codelineno-0-256></a>
</span><span id=__span-0-257><a id=__codelineno-0-257 name=__codelineno-0-257></a>            <span class=c1># cache all agent files in file_cache</span>
</span><span id=__span-0-258><a id=__codelineno-0-258 name=__codelineno-0-258></a>            <span class=k>for</span> <span class=n>root</span><span class=p>,</span> <span class=n>_</span><span class=p>,</span> <span class=n>files</span> <span class=ow>in</span> <span class=n>os</span><span class=o>.</span><span class=n>walk</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>temp_dir</span><span class=p>):</span>
</span><span id=__span-0-259><a id=__codelineno-0-259 name=__codelineno-0-259></a>                <span class=k>for</span> <span class=n>file</span> <span class=ow>in</span> <span class=n>files</span><span class=p>:</span>
</span><span id=__span-0-260><a id=__codelineno-0-260 name=__codelineno-0-260></a>                    <span class=n>file_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>root</span><span class=p>,</span> <span class=n>file</span><span class=p>)</span>
</span><span id=__span-0-261><a id=__codelineno-0-261 name=__codelineno-0-261></a>
</span><span id=__span-0-262><a id=__codelineno-0-262 name=__codelineno-0-262></a>                    <span class=c1># get file extension for agent_filename</span>
</span><span id=__span-0-263><a id=__codelineno-0-263 name=__codelineno-0-263></a>                    <span class=k>if</span> <span class=n>file_path</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=s2>&quot;.ts&quot;</span><span class=p>):</span>
</span><span id=__span-0-264><a id=__codelineno-0-264 name=__codelineno-0-264></a>                        <span class=n>agent_ts_files_to_transpile</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
</span><span id=__span-0-265><a id=__codelineno-0-265 name=__codelineno-0-265></a>
</span><span id=__span-0-266><a id=__codelineno-0-266 name=__codelineno-0-266></a>                    <span class=n>relative_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>relpath</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>temp_dir</span><span class=p>)</span>
</span><span id=__span-0-267><a id=__codelineno-0-267 name=__codelineno-0-267></a>                    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-268><a id=__codelineno-0-268 name=__codelineno-0-268></a>                        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=s2>&quot;rb&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-269><a id=__codelineno-0-269 name=__codelineno-0-269></a>                            <span class=n>content</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span><span id=__span-0-270><a id=__codelineno-0-270 name=__codelineno-0-270></a>                            <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-271><a id=__codelineno-0-271 name=__codelineno-0-271></a>                                <span class=c1># Try to decode as text</span>
</span><span id=__span-0-272><a id=__codelineno-0-272 name=__codelineno-0-272></a>                                <span class=bp>self</span><span class=o>.</span><span class=n>file_cache</span><span class=p>[</span><span class=n>relative_path</span><span class=p>]</span> <span class=o>=</span> <span class=n>content</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s2>&quot;utf-8&quot;</span><span class=p>)</span>
</span><span id=__span-0-273><a id=__codelineno-0-273 name=__codelineno-0-273></a>                            <span class=k>except</span> <span class=ne>UnicodeDecodeError</span><span class=p>:</span>
</span><span id=__span-0-274><a id=__codelineno-0-274 name=__codelineno-0-274></a>                                <span class=c1># If decoding fails, store as binary</span>
</span><span id=__span-0-275><a id=__codelineno-0-275 name=__codelineno-0-275></a>                                <span class=bp>self</span><span class=o>.</span><span class=n>file_cache</span><span class=p>[</span><span class=n>relative_path</span><span class=p>]</span> <span class=o>=</span> <span class=n>content</span>
</span><span id=__span-0-276><a id=__codelineno-0-276 name=__codelineno-0-276></a>
</span><span id=__span-0-277><a id=__codelineno-0-277 name=__codelineno-0-277></a>                    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-278><a id=__codelineno-0-278 name=__codelineno-0-278></a>                        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error with cache creation </span><span class=si>{</span><span class=n>file_path</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-279><a id=__codelineno-0-279 name=__codelineno-0-279></a>
</span><span id=__span-0-280><a id=__codelineno-0-280 name=__codelineno-0-280></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-281><a id=__codelineno-0-281 name=__codelineno-0-281></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Using cached agent code&quot;</span><span class=p>)</span>
</span><span id=__span-0-282><a id=__codelineno-0-282 name=__codelineno-0-282></a>
</span><span id=__span-0-283><a id=__codelineno-0-283 name=__codelineno-0-283></a>        <span class=n>namespace</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-284><a id=__codelineno-0-284 name=__codelineno-0-284></a>            <span class=s2>&quot;env&quot;</span><span class=p>:</span> <span class=n>env</span><span class=p>,</span>
</span><span id=__span-0-285><a id=__codelineno-0-285 name=__codelineno-0-285></a>            <span class=s2>&quot;agent&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-286><a id=__codelineno-0-286 name=__codelineno-0-286></a>            <span class=s2>&quot;task&quot;</span><span class=p>:</span> <span class=n>task</span><span class=p>,</span>
</span><span id=__span-0-287><a id=__codelineno-0-287 name=__codelineno-0-287></a>            <span class=s2>&quot;__name__&quot;</span><span class=p>:</span> <span class=s2>&quot;__main__&quot;</span><span class=p>,</span>
</span><span id=__span-0-288><a id=__codelineno-0-288 name=__codelineno-0-288></a>            <span class=s2>&quot;__file__&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>agent_filename</span><span class=p>,</span>
</span><span id=__span-0-289><a id=__codelineno-0-289 name=__codelineno-0-289></a>        <span class=p>}</span>
</span><span id=__span-0-290><a id=__codelineno-0-290 name=__codelineno-0-290></a>
</span><span id=__span-0-291><a id=__codelineno-0-291 name=__codelineno-0-291></a>        <span class=n>user_auth</span> <span class=o>=</span> <span class=n>env</span><span class=o>.</span><span class=n>user_auth</span>
</span><span id=__span-0-292><a id=__codelineno-0-292 name=__codelineno-0-292></a>
</span><span id=__span-0-293><a id=__codelineno-0-293 name=__codelineno-0-293></a>        <span class=c1># clear user_auth we saved before</span>
</span><span id=__span-0-294><a id=__codelineno-0-294 name=__codelineno-0-294></a>        <span class=n>env</span><span class=o>.</span><span class=n>user_auth</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-295><a id=__codelineno-0-295 name=__codelineno-0-295></a>
</span><span id=__span-0-296><a id=__codelineno-0-296 name=__codelineno-0-296></a>        <span class=n>error_message</span><span class=p>,</span> <span class=n>traceback_message</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span>
</span><span id=__span-0-297><a id=__codelineno-0-297 name=__codelineno-0-297></a>
</span><span id=__span-0-298><a id=__codelineno-0-298 name=__codelineno-0-298></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-299><a id=__codelineno-0-299 name=__codelineno-0-299></a>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>change_to_temp_dir</span><span class=p>:</span>
</span><span id=__span-0-300><a id=__codelineno-0-300 name=__codelineno-0-300></a>                <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>temp_dir</span><span class=p>):</span>
</span><span id=__span-0-301><a id=__codelineno-0-301 name=__codelineno-0-301></a>                    <span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>temp_dir</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-302><a id=__codelineno-0-302 name=__codelineno-0-302></a>                <span class=n>os</span><span class=o>.</span><span class=n>chdir</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>temp_dir</span><span class=p>)</span>
</span><span id=__span-0-303><a id=__codelineno-0-303 name=__codelineno-0-303></a>            <span class=n>sys</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>temp_dir</span><span class=p>)</span>
</span><span id=__span-0-304><a id=__codelineno-0-304 name=__codelineno-0-304></a>
</span><span id=__span-0-305><a id=__codelineno-0-305 name=__codelineno-0-305></a>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>agent_language</span> <span class=o>==</span> <span class=s2>&quot;ts&quot;</span><span class=p>:</span>
</span><span id=__span-0-306><a id=__codelineno-0-306 name=__codelineno-0-306></a>                <span class=n>agent_json_params</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span>
</span><span id=__span-0-307><a id=__codelineno-0-307 name=__codelineno-0-307></a>                    <span class=p>{</span>
</span><span id=__span-0-308><a id=__codelineno-0-308 name=__codelineno-0-308></a>                        <span class=s2>&quot;thread_id&quot;</span><span class=p>:</span> <span class=n>env</span><span class=o>.</span><span class=n>_thread_id</span><span class=p>,</span>
</span><span id=__span-0-309><a id=__codelineno-0-309 name=__codelineno-0-309></a>                        <span class=s2>&quot;user_auth&quot;</span><span class=p>:</span> <span class=n>user_auth</span><span class=p>,</span>
</span><span id=__span-0-310><a id=__codelineno-0-310 name=__codelineno-0-310></a>                        <span class=s2>&quot;base_url&quot;</span><span class=p>:</span> <span class=n>env</span><span class=o>.</span><span class=n>base_url</span><span class=p>,</span>
</span><span id=__span-0-311><a id=__codelineno-0-311 name=__codelineno-0-311></a>                        <span class=s2>&quot;env_vars&quot;</span><span class=p>:</span> <span class=n>env</span><span class=o>.</span><span class=n>env_vars</span><span class=p>,</span>
</span><span id=__span-0-312><a id=__codelineno-0-312 name=__codelineno-0-312></a>                        <span class=s2>&quot;agent_ts_files_to_transpile&quot;</span><span class=p>:</span> <span class=n>agent_ts_files_to_transpile</span><span class=p>,</span>
</span><span id=__span-0-313><a id=__codelineno-0-313 name=__codelineno-0-313></a>                    <span class=p>}</span>
</span><span id=__span-0-314><a id=__codelineno-0-314 name=__codelineno-0-314></a>                <span class=p>)</span>
</span><span id=__span-0-315><a id=__codelineno-0-315 name=__codelineno-0-315></a>
</span><span id=__span-0-316><a id=__codelineno-0-316 name=__codelineno-0-316></a>                <span class=n>process</span> <span class=o>=</span> <span class=n>multiprocessing</span><span class=o>.</span><span class=n>Process</span><span class=p>(</span>
</span><span id=__span-0-317><a id=__codelineno-0-317 name=__codelineno-0-317></a>                    <span class=n>target</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>run_ts_agent</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>agent_filename</span><span class=p>,</span> <span class=n>env</span><span class=o>.</span><span class=n>env_vars</span><span class=p>,</span> <span class=n>agent_json_params</span><span class=p>]</span>
</span><span id=__span-0-318><a id=__codelineno-0-318 name=__codelineno-0-318></a>                <span class=p>)</span>
</span><span id=__span-0-319><a id=__codelineno-0-319 name=__codelineno-0-319></a>                <span class=n>process</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span><span id=__span-0-320><a id=__codelineno-0-320 name=__codelineno-0-320></a>                <span class=n>process</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span><span id=__span-0-321><a id=__codelineno-0-321 name=__codelineno-0-321></a>            <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-322><a id=__codelineno-0-322 name=__codelineno-0-322></a>                <span class=k>if</span> <span class=n>env</span><span class=o>.</span><span class=n>agent_runner_user</span><span class=p>:</span>
</span><span id=__span-0-323><a id=__codelineno-0-323 name=__codelineno-0-323></a>                    <span class=n>process</span> <span class=o>=</span> <span class=n>multiprocessing</span><span class=o>.</span><span class=n>Process</span><span class=p>(</span>
</span><span id=__span-0-324><a id=__codelineno-0-324 name=__codelineno-0-324></a>                        <span class=n>target</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>run_python_code</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>[</span><span class=n>namespace</span><span class=p>,</span> <span class=n>env</span><span class=o>.</span><span class=n>agent_runner_user</span><span class=p>]</span>
</span><span id=__span-0-325><a id=__codelineno-0-325 name=__codelineno-0-325></a>                    <span class=p>)</span>
</span><span id=__span-0-326><a id=__codelineno-0-326 name=__codelineno-0-326></a>                    <span class=n>process</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span><span id=__span-0-327><a id=__codelineno-0-327 name=__codelineno-0-327></a>                    <span class=n>process</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span><span id=__span-0-328><a id=__codelineno-0-328 name=__codelineno-0-328></a>                <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-329><a id=__codelineno-0-329 name=__codelineno-0-329></a>                    <span class=n>error_message</span><span class=p>,</span> <span class=n>traceback_message</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>run_python_code</span><span class=p>(</span><span class=n>namespace</span><span class=p>,</span> <span class=n>env</span><span class=o>.</span><span class=n>agent_runner_user</span><span class=p>)</span>
</span><span id=__span-0-330><a id=__codelineno-0-330 name=__codelineno-0-330></a>        <span class=k>finally</span><span class=p>:</span>
</span><span id=__span-0-331><a id=__codelineno-0-331 name=__codelineno-0-331></a>            <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>temp_dir</span><span class=p>):</span>
</span><span id=__span-0-332><a id=__codelineno-0-332 name=__codelineno-0-332></a>                <span class=n>sys</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>temp_dir</span><span class=p>)</span>
</span><span id=__span-0-333><a id=__codelineno-0-333 name=__codelineno-0-333></a>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>change_to_temp_dir</span><span class=p>:</span>
</span><span id=__span-0-334><a id=__codelineno-0-334 name=__codelineno-0-334></a>                <span class=n>os</span><span class=o>.</span><span class=n>chdir</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>original_cwd</span><span class=p>)</span>
</span><span id=__span-0-335><a id=__codelineno-0-335 name=__codelineno-0-335></a>
</span><span id=__span-0-336><a id=__codelineno-0-336 name=__codelineno-0-336></a>        <span class=k>return</span> <span class=n>error_message</span><span class=p>,</span> <span class=n>traceback_message</span>
</span><span id=__span-0-337><a id=__codelineno-0-337 name=__codelineno-0-337></a>
</span><span id=__span-0-338><a id=__codelineno-0-338 name=__codelineno-0-338></a>    <span class=nd>@staticmethod</span>
</span><span id=__span-0-339><a id=__codelineno-0-339 name=__codelineno-0-339></a>    <span class=k>def</span><span class=w> </span><span class=nf>load_agents</span><span class=p>(</span><span class=n>agents</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>config</span><span class=p>:</span> <span class=n>ClientConfig</span><span class=p>,</span> <span class=n>local</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>):</span>
</span><span id=__span-0-340><a id=__codelineno-0-340 name=__codelineno-0-340></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Loads agents from the registry.&quot;&quot;&quot;</span>
</span><span id=__span-0-341><a id=__codelineno-0-341 name=__codelineno-0-341></a>        <span class=k>return</span> <span class=p>[</span><span class=n>Agent</span><span class=o>.</span><span class=n>load_agent</span><span class=p>(</span><span class=n>agent</span><span class=p>,</span> <span class=n>config</span><span class=p>,</span> <span class=n>local</span><span class=p>)</span> <span class=k>for</span> <span class=n>agent</span> <span class=ow>in</span> <span class=n>agents</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;,&quot;</span><span class=p>)]</span>
</span><span id=__span-0-342><a id=__codelineno-0-342 name=__codelineno-0-342></a>
</span><span id=__span-0-343><a id=__codelineno-0-343 name=__codelineno-0-343></a>    <span class=nd>@staticmethod</span>
</span><span id=__span-0-344><a id=__codelineno-0-344 name=__codelineno-0-344></a>    <span class=k>def</span><span class=w> </span><span class=nf>load_agent</span><span class=p>(</span>
</span><span id=__span-0-345><a id=__codelineno-0-345 name=__codelineno-0-345></a>        <span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-346><a id=__codelineno-0-346 name=__codelineno-0-346></a>        <span class=n>config</span><span class=p>:</span> <span class=n>ClientConfig</span><span class=p>,</span>
</span><span id=__span-0-347><a id=__codelineno-0-347 name=__codelineno-0-347></a>        <span class=n>local</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-348><a id=__codelineno-0-348 name=__codelineno-0-348></a>    <span class=p>):</span>
</span><span id=__span-0-349><a id=__codelineno-0-349 name=__codelineno-0-349></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Loads a single agent from the registry.&quot;&quot;&quot;</span>
</span><span id=__span-0-350><a id=__codelineno-0-350 name=__codelineno-0-350></a>        <span class=kn>from</span><span class=w> </span><span class=nn>nearai.registry</span><span class=w> </span><span class=kn>import</span> <span class=n>get_registry_folder</span><span class=p>,</span> <span class=n>registry</span>
</span><span id=__span-0-351><a id=__codelineno-0-351 name=__codelineno-0-351></a>
</span><span id=__span-0-352><a id=__codelineno-0-352 name=__codelineno-0-352></a>        <span class=n>identifier</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-353><a id=__codelineno-0-353 name=__codelineno-0-353></a>        <span class=k>if</span> <span class=n>local</span><span class=p>:</span>
</span><span id=__span-0-354><a id=__codelineno-0-354 name=__codelineno-0-354></a>            <span class=n>agent_files_path</span> <span class=o>=</span> <span class=n>get_registry_folder</span><span class=p>()</span> <span class=o>/</span> <span class=n>name</span>
</span><span id=__span-0-355><a id=__codelineno-0-355 name=__codelineno-0-355></a>            <span class=k>if</span> <span class=n>config</span><span class=o>.</span><span class=n>auth</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-356><a id=__codelineno-0-356 name=__codelineno-0-356></a>                <span class=n>namespace</span> <span class=o>=</span> <span class=s2>&quot;not-logged-in&quot;</span>
</span><span id=__span-0-357><a id=__codelineno-0-357 name=__codelineno-0-357></a>            <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-358><a id=__codelineno-0-358 name=__codelineno-0-358></a>                <span class=n>namespace</span> <span class=o>=</span> <span class=n>config</span><span class=o>.</span><span class=n>auth</span><span class=o>.</span><span class=n>account_id</span>
</span><span id=__span-0-359><a id=__codelineno-0-359 name=__codelineno-0-359></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-360><a id=__codelineno-0-360 name=__codelineno-0-360></a>            <span class=n>agent_files_path</span> <span class=o>=</span> <span class=n>registry</span><span class=o>.</span><span class=n>download</span><span class=p>(</span><span class=n>name</span><span class=p>)</span>
</span><span id=__span-0-361><a id=__codelineno-0-361 name=__codelineno-0-361></a>            <span class=n>identifier</span> <span class=o>=</span> <span class=n>name</span>
</span><span id=__span-0-362><a id=__codelineno-0-362 name=__codelineno-0-362></a>        <span class=k>assert</span> <span class=n>agent_files_path</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&quot;Agent </span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2> not found.&quot;</span>
</span><span id=__span-0-363><a id=__codelineno-0-363 name=__codelineno-0-363></a>
</span><span id=__span-0-364><a id=__codelineno-0-364 name=__codelineno-0-364></a>        <span class=n>metadata_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>agent_files_path</span><span class=p>,</span> <span class=s2>&quot;metadata.json&quot;</span><span class=p>)</span>
</span><span id=__span-0-365><a id=__codelineno-0-365 name=__codelineno-0-365></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>metadata_path</span><span class=p>):</span>
</span><span id=__span-0-366><a id=__codelineno-0-366 name=__codelineno-0-366></a>            <span class=k>raise</span> <span class=ne>FileNotFoundError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Metadata file not found: </span><span class=si>{</span><span class=n>metadata_path</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-367><a id=__codelineno-0-367 name=__codelineno-0-367></a>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>metadata_path</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-368><a id=__codelineno-0-368 name=__codelineno-0-368></a>            <span class=n>metadata</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>f</span><span class=p>)</span>
</span><span id=__span-0-369><a id=__codelineno-0-369 name=__codelineno-0-369></a>
</span><span id=__span-0-370><a id=__codelineno-0-370 name=__codelineno-0-370></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>identifier</span><span class=p>:</span>
</span><span id=__span-0-371><a id=__codelineno-0-371 name=__codelineno-0-371></a>            <span class=n>identifier</span> <span class=o>=</span> <span class=s2>&quot;/&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=n>namespace</span><span class=p>,</span> <span class=n>metadata</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>],</span> <span class=n>metadata</span><span class=p>[</span><span class=s2>&quot;version&quot;</span><span class=p>]])</span>
</span><span id=__span-0-372><a id=__codelineno-0-372 name=__codelineno-0-372></a>
</span><span id=__span-0-373><a id=__codelineno-0-373 name=__codelineno-0-373></a>        <span class=k>return</span> <span class=n>Agent</span><span class=p>(</span><span class=n>identifier</span><span class=p>,</span> <span class=n>agent_files_path</span><span class=p>,</span> <span class=n>metadata</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.agent.Agent.get_full_name class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_full_name</span> <a href=#nearai.agents.agent.Agent.get_full_name class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>get_full_name</span><span class=p>()</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Returns full agent name.</p> <details class=quote> <summary>Source code in <code>nearai/agents/agent.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-59>59</a></span>
<span class=normal><a href=#__codelineno-0-60>60</a></span>
<span class=normal><a href=#__codelineno-0-61>61</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-59><a id=__codelineno-0-59 name=__codelineno-0-59></a><span class=k>def</span><span class=w> </span><span class=nf>get_full_name</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-0-60><a id=__codelineno-0-60 name=__codelineno-0-60></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns full agent name.&quot;&quot;&quot;</span>
</span><span id=__span-0-61><a id=__codelineno-0-61 name=__codelineno-0-61></a>    <span class=k>return</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>namespace</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>version</span><span class=si>}</span><span class=s2>&quot;</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.agent.Agent.load_agent class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">load_agent</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small> </span> <a href=#nearai.agents.agent.Agent.load_agent class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>load_agent</span><span class=p>(</span><span class=n>name</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>config</span><span class=p>:</span> <span class=n><a class="autorefs autorefs-internal" title=nearai.shared.client_config.ClientConfig href=#nearai.shared.client_config.ClientConfig>ClientConfig</a></span><span class=p>,</span> <span class=n>local</span><span class=p>:</span> <span class=n>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Loads a single agent from the registry.</p> <details class=quote> <summary>Source code in <code>nearai/agents/agent.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-343>343</a></span>
<span class=normal><a href=#__codelineno-0-344>344</a></span>
<span class=normal><a href=#__codelineno-0-345>345</a></span>
<span class=normal><a href=#__codelineno-0-346>346</a></span>
<span class=normal><a href=#__codelineno-0-347>347</a></span>
<span class=normal><a href=#__codelineno-0-348>348</a></span>
<span class=normal><a href=#__codelineno-0-349>349</a></span>
<span class=normal><a href=#__codelineno-0-350>350</a></span>
<span class=normal><a href=#__codelineno-0-351>351</a></span>
<span class=normal><a href=#__codelineno-0-352>352</a></span>
<span class=normal><a href=#__codelineno-0-353>353</a></span>
<span class=normal><a href=#__codelineno-0-354>354</a></span>
<span class=normal><a href=#__codelineno-0-355>355</a></span>
<span class=normal><a href=#__codelineno-0-356>356</a></span>
<span class=normal><a href=#__codelineno-0-357>357</a></span>
<span class=normal><a href=#__codelineno-0-358>358</a></span>
<span class=normal><a href=#__codelineno-0-359>359</a></span>
<span class=normal><a href=#__codelineno-0-360>360</a></span>
<span class=normal><a href=#__codelineno-0-361>361</a></span>
<span class=normal><a href=#__codelineno-0-362>362</a></span>
<span class=normal><a href=#__codelineno-0-363>363</a></span>
<span class=normal><a href=#__codelineno-0-364>364</a></span>
<span class=normal><a href=#__codelineno-0-365>365</a></span>
<span class=normal><a href=#__codelineno-0-366>366</a></span>
<span class=normal><a href=#__codelineno-0-367>367</a></span>
<span class=normal><a href=#__codelineno-0-368>368</a></span>
<span class=normal><a href=#__codelineno-0-369>369</a></span>
<span class=normal><a href=#__codelineno-0-370>370</a></span>
<span class=normal><a href=#__codelineno-0-371>371</a></span>
<span class=normal><a href=#__codelineno-0-372>372</a></span>
<span class=normal><a href=#__codelineno-0-373>373</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-343><a id=__codelineno-0-343 name=__codelineno-0-343></a><span class=nd>@staticmethod</span>
</span><span id=__span-0-344><a id=__codelineno-0-344 name=__codelineno-0-344></a><span class=k>def</span><span class=w> </span><span class=nf>load_agent</span><span class=p>(</span>
</span><span id=__span-0-345><a id=__codelineno-0-345 name=__codelineno-0-345></a>    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-346><a id=__codelineno-0-346 name=__codelineno-0-346></a>    <span class=n>config</span><span class=p>:</span> <span class=n>ClientConfig</span><span class=p>,</span>
</span><span id=__span-0-347><a id=__codelineno-0-347 name=__codelineno-0-347></a>    <span class=n>local</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-348><a id=__codelineno-0-348 name=__codelineno-0-348></a><span class=p>):</span>
</span><span id=__span-0-349><a id=__codelineno-0-349 name=__codelineno-0-349></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Loads a single agent from the registry.&quot;&quot;&quot;</span>
</span><span id=__span-0-350><a id=__codelineno-0-350 name=__codelineno-0-350></a>    <span class=kn>from</span><span class=w> </span><span class=nn>nearai.registry</span><span class=w> </span><span class=kn>import</span> <span class=n>get_registry_folder</span><span class=p>,</span> <span class=n>registry</span>
</span><span id=__span-0-351><a id=__codelineno-0-351 name=__codelineno-0-351></a>
</span><span id=__span-0-352><a id=__codelineno-0-352 name=__codelineno-0-352></a>    <span class=n>identifier</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-353><a id=__codelineno-0-353 name=__codelineno-0-353></a>    <span class=k>if</span> <span class=n>local</span><span class=p>:</span>
</span><span id=__span-0-354><a id=__codelineno-0-354 name=__codelineno-0-354></a>        <span class=n>agent_files_path</span> <span class=o>=</span> <span class=n>get_registry_folder</span><span class=p>()</span> <span class=o>/</span> <span class=n>name</span>
</span><span id=__span-0-355><a id=__codelineno-0-355 name=__codelineno-0-355></a>        <span class=k>if</span> <span class=n>config</span><span class=o>.</span><span class=n>auth</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-356><a id=__codelineno-0-356 name=__codelineno-0-356></a>            <span class=n>namespace</span> <span class=o>=</span> <span class=s2>&quot;not-logged-in&quot;</span>
</span><span id=__span-0-357><a id=__codelineno-0-357 name=__codelineno-0-357></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-358><a id=__codelineno-0-358 name=__codelineno-0-358></a>            <span class=n>namespace</span> <span class=o>=</span> <span class=n>config</span><span class=o>.</span><span class=n>auth</span><span class=o>.</span><span class=n>account_id</span>
</span><span id=__span-0-359><a id=__codelineno-0-359 name=__codelineno-0-359></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-360><a id=__codelineno-0-360 name=__codelineno-0-360></a>        <span class=n>agent_files_path</span> <span class=o>=</span> <span class=n>registry</span><span class=o>.</span><span class=n>download</span><span class=p>(</span><span class=n>name</span><span class=p>)</span>
</span><span id=__span-0-361><a id=__codelineno-0-361 name=__codelineno-0-361></a>        <span class=n>identifier</span> <span class=o>=</span> <span class=n>name</span>
</span><span id=__span-0-362><a id=__codelineno-0-362 name=__codelineno-0-362></a>    <span class=k>assert</span> <span class=n>agent_files_path</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&quot;Agent </span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2> not found.&quot;</span>
</span><span id=__span-0-363><a id=__codelineno-0-363 name=__codelineno-0-363></a>
</span><span id=__span-0-364><a id=__codelineno-0-364 name=__codelineno-0-364></a>    <span class=n>metadata_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>agent_files_path</span><span class=p>,</span> <span class=s2>&quot;metadata.json&quot;</span><span class=p>)</span>
</span><span id=__span-0-365><a id=__codelineno-0-365 name=__codelineno-0-365></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>metadata_path</span><span class=p>):</span>
</span><span id=__span-0-366><a id=__codelineno-0-366 name=__codelineno-0-366></a>        <span class=k>raise</span> <span class=ne>FileNotFoundError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Metadata file not found: </span><span class=si>{</span><span class=n>metadata_path</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-367><a id=__codelineno-0-367 name=__codelineno-0-367></a>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>metadata_path</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-368><a id=__codelineno-0-368 name=__codelineno-0-368></a>        <span class=n>metadata</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>f</span><span class=p>)</span>
</span><span id=__span-0-369><a id=__codelineno-0-369 name=__codelineno-0-369></a>
</span><span id=__span-0-370><a id=__codelineno-0-370 name=__codelineno-0-370></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>identifier</span><span class=p>:</span>
</span><span id=__span-0-371><a id=__codelineno-0-371 name=__codelineno-0-371></a>        <span class=n>identifier</span> <span class=o>=</span> <span class=s2>&quot;/&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=n>namespace</span><span class=p>,</span> <span class=n>metadata</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>],</span> <span class=n>metadata</span><span class=p>[</span><span class=s2>&quot;version&quot;</span><span class=p>]])</span>
</span><span id=__span-0-372><a id=__codelineno-0-372 name=__codelineno-0-372></a>
</span><span id=__span-0-373><a id=__codelineno-0-373 name=__codelineno-0-373></a>    <span class=k>return</span> <span class=n>Agent</span><span class=p>(</span><span class=n>identifier</span><span class=p>,</span> <span class=n>agent_files_path</span><span class=p>,</span> <span class=n>metadata</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.agent.Agent.load_agents class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">load_agents</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small> </span> <a href=#nearai.agents.agent.Agent.load_agents class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>load_agents</span><span class=p>(</span><span class=n>agents</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>config</span><span class=p>:</span> <span class=n><a class="autorefs autorefs-internal" title=nearai.shared.client_config.ClientConfig href=#nearai.shared.client_config.ClientConfig>ClientConfig</a></span><span class=p>,</span> <span class=n>local</span><span class=p>:</span> <span class=n>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Loads agents from the registry.</p> <details class=quote> <summary>Source code in <code>nearai/agents/agent.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-338>338</a></span>
<span class=normal><a href=#__codelineno-0-339>339</a></span>
<span class=normal><a href=#__codelineno-0-340>340</a></span>
<span class=normal><a href=#__codelineno-0-341>341</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-338><a id=__codelineno-0-338 name=__codelineno-0-338></a><span class=nd>@staticmethod</span>
</span><span id=__span-0-339><a id=__codelineno-0-339 name=__codelineno-0-339></a><span class=k>def</span><span class=w> </span><span class=nf>load_agents</span><span class=p>(</span><span class=n>agents</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>config</span><span class=p>:</span> <span class=n>ClientConfig</span><span class=p>,</span> <span class=n>local</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>):</span>
</span><span id=__span-0-340><a id=__codelineno-0-340 name=__codelineno-0-340></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Loads agents from the registry.&quot;&quot;&quot;</span>
</span><span id=__span-0-341><a id=__codelineno-0-341 name=__codelineno-0-341></a>    <span class=k>return</span> <span class=p>[</span><span class=n>Agent</span><span class=o>.</span><span class=n>load_agent</span><span class=p>(</span><span class=n>agent</span><span class=p>,</span> <span class=n>config</span><span class=p>,</span> <span class=n>local</span><span class=p>)</span> <span class=k>for</span> <span class=n>agent</span> <span class=ow>in</span> <span class=n>agents</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;,&quot;</span><span class=p>)]</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.agent.Agent.run class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">run</span> <a href=#nearai.agents.agent.Agent.run class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>run</span><span class=p>(</span><span class=n>env</span><span class=p>:</span> <span class=n><span title=typing.Any>Any</span></span><span class=p>,</span> <span class=n>task</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=typing.Tuple>Tuple</span></span><span class=p>[</span><span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>str</span><span class=p>],</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>str</span><span class=p>]]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Run the agent code. Returns error message and traceback message.</p> <details class=quote> <summary>Source code in <code>nearai/agents/agent.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-214>214</a></span>
<span class=normal><a href=#__codelineno-0-215>215</a></span>
<span class=normal><a href=#__codelineno-0-216>216</a></span>
<span class=normal><a href=#__codelineno-0-217>217</a></span>
<span class=normal><a href=#__codelineno-0-218>218</a></span>
<span class=normal><a href=#__codelineno-0-219>219</a></span>
<span class=normal><a href=#__codelineno-0-220>220</a></span>
<span class=normal><a href=#__codelineno-0-221>221</a></span>
<span class=normal><a href=#__codelineno-0-222>222</a></span>
<span class=normal><a href=#__codelineno-0-223>223</a></span>
<span class=normal><a href=#__codelineno-0-224>224</a></span>
<span class=normal><a href=#__codelineno-0-225>225</a></span>
<span class=normal><a href=#__codelineno-0-226>226</a></span>
<span class=normal><a href=#__codelineno-0-227>227</a></span>
<span class=normal><a href=#__codelineno-0-228>228</a></span>
<span class=normal><a href=#__codelineno-0-229>229</a></span>
<span class=normal><a href=#__codelineno-0-230>230</a></span>
<span class=normal><a href=#__codelineno-0-231>231</a></span>
<span class=normal><a href=#__codelineno-0-232>232</a></span>
<span class=normal><a href=#__codelineno-0-233>233</a></span>
<span class=normal><a href=#__codelineno-0-234>234</a></span>
<span class=normal><a href=#__codelineno-0-235>235</a></span>
<span class=normal><a href=#__codelineno-0-236>236</a></span>
<span class=normal><a href=#__codelineno-0-237>237</a></span>
<span class=normal><a href=#__codelineno-0-238>238</a></span>
<span class=normal><a href=#__codelineno-0-239>239</a></span>
<span class=normal><a href=#__codelineno-0-240>240</a></span>
<span class=normal><a href=#__codelineno-0-241>241</a></span>
<span class=normal><a href=#__codelineno-0-242>242</a></span>
<span class=normal><a href=#__codelineno-0-243>243</a></span>
<span class=normal><a href=#__codelineno-0-244>244</a></span>
<span class=normal><a href=#__codelineno-0-245>245</a></span>
<span class=normal><a href=#__codelineno-0-246>246</a></span>
<span class=normal><a href=#__codelineno-0-247>247</a></span>
<span class=normal><a href=#__codelineno-0-248>248</a></span>
<span class=normal><a href=#__codelineno-0-249>249</a></span>
<span class=normal><a href=#__codelineno-0-250>250</a></span>
<span class=normal><a href=#__codelineno-0-251>251</a></span>
<span class=normal><a href=#__codelineno-0-252>252</a></span>
<span class=normal><a href=#__codelineno-0-253>253</a></span>
<span class=normal><a href=#__codelineno-0-254>254</a></span>
<span class=normal><a href=#__codelineno-0-255>255</a></span>
<span class=normal><a href=#__codelineno-0-256>256</a></span>
<span class=normal><a href=#__codelineno-0-257>257</a></span>
<span class=normal><a href=#__codelineno-0-258>258</a></span>
<span class=normal><a href=#__codelineno-0-259>259</a></span>
<span class=normal><a href=#__codelineno-0-260>260</a></span>
<span class=normal><a href=#__codelineno-0-261>261</a></span>
<span class=normal><a href=#__codelineno-0-262>262</a></span>
<span class=normal><a href=#__codelineno-0-263>263</a></span>
<span class=normal><a href=#__codelineno-0-264>264</a></span>
<span class=normal><a href=#__codelineno-0-265>265</a></span>
<span class=normal><a href=#__codelineno-0-266>266</a></span>
<span class=normal><a href=#__codelineno-0-267>267</a></span>
<span class=normal><a href=#__codelineno-0-268>268</a></span>
<span class=normal><a href=#__codelineno-0-269>269</a></span>
<span class=normal><a href=#__codelineno-0-270>270</a></span>
<span class=normal><a href=#__codelineno-0-271>271</a></span>
<span class=normal><a href=#__codelineno-0-272>272</a></span>
<span class=normal><a href=#__codelineno-0-273>273</a></span>
<span class=normal><a href=#__codelineno-0-274>274</a></span>
<span class=normal><a href=#__codelineno-0-275>275</a></span>
<span class=normal><a href=#__codelineno-0-276>276</a></span>
<span class=normal><a href=#__codelineno-0-277>277</a></span>
<span class=normal><a href=#__codelineno-0-278>278</a></span>
<span class=normal><a href=#__codelineno-0-279>279</a></span>
<span class=normal><a href=#__codelineno-0-280>280</a></span>
<span class=normal><a href=#__codelineno-0-281>281</a></span>
<span class=normal><a href=#__codelineno-0-282>282</a></span>
<span class=normal><a href=#__codelineno-0-283>283</a></span>
<span class=normal><a href=#__codelineno-0-284>284</a></span>
<span class=normal><a href=#__codelineno-0-285>285</a></span>
<span class=normal><a href=#__codelineno-0-286>286</a></span>
<span class=normal><a href=#__codelineno-0-287>287</a></span>
<span class=normal><a href=#__codelineno-0-288>288</a></span>
<span class=normal><a href=#__codelineno-0-289>289</a></span>
<span class=normal><a href=#__codelineno-0-290>290</a></span>
<span class=normal><a href=#__codelineno-0-291>291</a></span>
<span class=normal><a href=#__codelineno-0-292>292</a></span>
<span class=normal><a href=#__codelineno-0-293>293</a></span>
<span class=normal><a href=#__codelineno-0-294>294</a></span>
<span class=normal><a href=#__codelineno-0-295>295</a></span>
<span class=normal><a href=#__codelineno-0-296>296</a></span>
<span class=normal><a href=#__codelineno-0-297>297</a></span>
<span class=normal><a href=#__codelineno-0-298>298</a></span>
<span class=normal><a href=#__codelineno-0-299>299</a></span>
<span class=normal><a href=#__codelineno-0-300>300</a></span>
<span class=normal><a href=#__codelineno-0-301>301</a></span>
<span class=normal><a href=#__codelineno-0-302>302</a></span>
<span class=normal><a href=#__codelineno-0-303>303</a></span>
<span class=normal><a href=#__codelineno-0-304>304</a></span>
<span class=normal><a href=#__codelineno-0-305>305</a></span>
<span class=normal><a href=#__codelineno-0-306>306</a></span>
<span class=normal><a href=#__codelineno-0-307>307</a></span>
<span class=normal><a href=#__codelineno-0-308>308</a></span>
<span class=normal><a href=#__codelineno-0-309>309</a></span>
<span class=normal><a href=#__codelineno-0-310>310</a></span>
<span class=normal><a href=#__codelineno-0-311>311</a></span>
<span class=normal><a href=#__codelineno-0-312>312</a></span>
<span class=normal><a href=#__codelineno-0-313>313</a></span>
<span class=normal><a href=#__codelineno-0-314>314</a></span>
<span class=normal><a href=#__codelineno-0-315>315</a></span>
<span class=normal><a href=#__codelineno-0-316>316</a></span>
<span class=normal><a href=#__codelineno-0-317>317</a></span>
<span class=normal><a href=#__codelineno-0-318>318</a></span>
<span class=normal><a href=#__codelineno-0-319>319</a></span>
<span class=normal><a href=#__codelineno-0-320>320</a></span>
<span class=normal><a href=#__codelineno-0-321>321</a></span>
<span class=normal><a href=#__codelineno-0-322>322</a></span>
<span class=normal><a href=#__codelineno-0-323>323</a></span>
<span class=normal><a href=#__codelineno-0-324>324</a></span>
<span class=normal><a href=#__codelineno-0-325>325</a></span>
<span class=normal><a href=#__codelineno-0-326>326</a></span>
<span class=normal><a href=#__codelineno-0-327>327</a></span>
<span class=normal><a href=#__codelineno-0-328>328</a></span>
<span class=normal><a href=#__codelineno-0-329>329</a></span>
<span class=normal><a href=#__codelineno-0-330>330</a></span>
<span class=normal><a href=#__codelineno-0-331>331</a></span>
<span class=normal><a href=#__codelineno-0-332>332</a></span>
<span class=normal><a href=#__codelineno-0-333>333</a></span>
<span class=normal><a href=#__codelineno-0-334>334</a></span>
<span class=normal><a href=#__codelineno-0-335>335</a></span>
<span class=normal><a href=#__codelineno-0-336>336</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-214><a id=__codelineno-0-214 name=__codelineno-0-214></a><span class=k>def</span><span class=w> </span><span class=nf>run</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>env</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span> <span class=n>task</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>],</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]]:</span>
</span><span id=__span-0-215><a id=__codelineno-0-215 name=__codelineno-0-215></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Run the agent code. Returns error message and traceback message.&quot;&quot;&quot;</span>
</span><span id=__span-0-216><a id=__codelineno-0-216 name=__codelineno-0-216></a>    <span class=c1># combine agent.env_vars and env.env_vars</span>
</span><span id=__span-0-217><a id=__codelineno-0-217 name=__codelineno-0-217></a>    <span class=n>total_env_vars</span> <span class=o>=</span> <span class=p>{</span><span class=o>**</span><span class=bp>self</span><span class=o>.</span><span class=n>env_vars</span><span class=p>,</span> <span class=o>**</span><span class=n>env</span><span class=o>.</span><span class=n>env_vars</span><span class=p>}</span>
</span><span id=__span-0-218><a id=__codelineno-0-218 name=__codelineno-0-218></a>
</span><span id=__span-0-219><a id=__codelineno-0-219 name=__codelineno-0-219></a>    <span class=c1># save os env vars</span>
</span><span id=__span-0-220><a id=__codelineno-0-220 name=__codelineno-0-220></a>    <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>total_env_vars</span><span class=p>)</span>
</span><span id=__span-0-221><a id=__codelineno-0-221 name=__codelineno-0-221></a>    <span class=c1># save env.env_vars</span>
</span><span id=__span-0-222><a id=__codelineno-0-222 name=__codelineno-0-222></a>    <span class=n>env</span><span class=o>.</span><span class=n>env_vars</span> <span class=o>=</span> <span class=n>total_env_vars</span>
</span><span id=__span-0-223><a id=__codelineno-0-223 name=__codelineno-0-223></a>
</span><span id=__span-0-224><a id=__codelineno-0-224 name=__codelineno-0-224></a>    <span class=n>agent_ts_files_to_transpile</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-0-225><a id=__codelineno-0-225 name=__codelineno-0-225></a>
</span><span id=__span-0-226><a id=__codelineno-0-226 name=__codelineno-0-226></a>    <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>agent_filename</span> <span class=ow>or</span> <span class=kc>True</span><span class=p>:</span>
</span><span id=__span-0-227><a id=__codelineno-0-227 name=__codelineno-0-227></a>        <span class=c1># if agent has &quot;agent.py&quot; file, we use python runner</span>
</span><span id=__span-0-228><a id=__codelineno-0-228 name=__codelineno-0-228></a>        <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>temp_dir</span><span class=p>,</span> <span class=n>AGENT_FILENAME_PY</span><span class=p>)):</span>
</span><span id=__span-0-229><a id=__codelineno-0-229 name=__codelineno-0-229></a>            <span class=bp>self</span><span class=o>.</span><span class=n>agent_filename</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>temp_dir</span><span class=p>,</span> <span class=n>AGENT_FILENAME_PY</span><span class=p>)</span>
</span><span id=__span-0-230><a id=__codelineno-0-230 name=__codelineno-0-230></a>            <span class=bp>self</span><span class=o>.</span><span class=n>agent_language</span> <span class=o>=</span> <span class=s2>&quot;py&quot;</span>
</span><span id=__span-0-231><a id=__codelineno-0-231 name=__codelineno-0-231></a>            <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>agent_filename</span><span class=p>,</span> <span class=s2>&quot;r&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>agent_file</span><span class=p>:</span>
</span><span id=__span-0-232><a id=__codelineno-0-232 name=__codelineno-0-232></a>                <span class=bp>self</span><span class=o>.</span><span class=n>code</span> <span class=o>=</span> <span class=nb>compile</span><span class=p>(</span><span class=n>agent_file</span><span class=o>.</span><span class=n>read</span><span class=p>(),</span> <span class=bp>self</span><span class=o>.</span><span class=n>agent_filename</span><span class=p>,</span> <span class=s2>&quot;exec&quot;</span><span class=p>)</span>
</span><span id=__span-0-233><a id=__codelineno-0-233 name=__codelineno-0-233></a>        <span class=c1># else, if agent has &quot;agent.ts&quot; file, we use typescript runner</span>
</span><span id=__span-0-234><a id=__codelineno-0-234 name=__codelineno-0-234></a>        <span class=k>elif</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>temp_dir</span><span class=p>,</span> <span class=n>AGENT_FILENAME_TS</span><span class=p>)):</span>
</span><span id=__span-0-235><a id=__codelineno-0-235 name=__codelineno-0-235></a>            <span class=bp>self</span><span class=o>.</span><span class=n>agent_filename</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>temp_dir</span><span class=p>,</span> <span class=n>AGENT_FILENAME_TS</span><span class=p>)</span>
</span><span id=__span-0-236><a id=__codelineno-0-236 name=__codelineno-0-236></a>            <span class=bp>self</span><span class=o>.</span><span class=n>agent_language</span> <span class=o>=</span> <span class=s2>&quot;ts&quot;</span>
</span><span id=__span-0-237><a id=__codelineno-0-237 name=__codelineno-0-237></a>
</span><span id=__span-0-238><a id=__codelineno-0-238 name=__codelineno-0-238></a>            <span class=c1># copy files from nearai/ts_runner_sdk to self.temp_dir</span>
</span><span id=__span-0-239><a id=__codelineno-0-239 name=__codelineno-0-239></a>            <span class=n>ts_runner_sdk_dir</span> <span class=o>=</span> <span class=s2>&quot;/tmp/ts_runner&quot;</span>
</span><span id=__span-0-240><a id=__codelineno-0-240 name=__codelineno-0-240></a>            <span class=n>ts_runner_agent_dir</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>ts_runner_sdk_dir</span><span class=p>,</span> <span class=s2>&quot;agents&quot;</span><span class=p>)</span>
</span><span id=__span-0-241><a id=__codelineno-0-241 name=__codelineno-0-241></a>
</span><span id=__span-0-242><a id=__codelineno-0-242 name=__codelineno-0-242></a>            <span class=n>ts_runner_actual_path</span> <span class=o>=</span> <span class=s2>&quot;/var/task/ts_runner&quot;</span>
</span><span id=__span-0-243><a id=__codelineno-0-243 name=__codelineno-0-243></a>
</span><span id=__span-0-244><a id=__codelineno-0-244 name=__codelineno-0-244></a>            <span class=n>shutil</span><span class=o>.</span><span class=n>copytree</span><span class=p>(</span><span class=n>ts_runner_actual_path</span><span class=p>,</span> <span class=n>ts_runner_sdk_dir</span><span class=p>,</span> <span class=n>symlinks</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>dirs_exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-245><a id=__codelineno-0-245 name=__codelineno-0-245></a>
</span><span id=__span-0-246><a id=__codelineno-0-246 name=__codelineno-0-246></a>            <span class=c1># make ts agents dir if not exists</span>
</span><span id=__span-0-247><a id=__codelineno-0-247 name=__codelineno-0-247></a>            <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>ts_runner_agent_dir</span><span class=p>):</span>
</span><span id=__span-0-248><a id=__codelineno-0-248 name=__codelineno-0-248></a>                <span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=n>ts_runner_agent_dir</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-249><a id=__codelineno-0-249 name=__codelineno-0-249></a>
</span><span id=__span-0-250><a id=__codelineno-0-250 name=__codelineno-0-250></a>            <span class=c1># copy agents files</span>
</span><span id=__span-0-251><a id=__codelineno-0-251 name=__codelineno-0-251></a>            <span class=n>shutil</span><span class=o>.</span><span class=n>copy</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>temp_dir</span><span class=p>,</span> <span class=n>AGENT_FILENAME_TS</span><span class=p>),</span> <span class=n>ts_runner_agent_dir</span><span class=p>)</span>
</span><span id=__span-0-252><a id=__codelineno-0-252 name=__codelineno-0-252></a>
</span><span id=__span-0-253><a id=__codelineno-0-253 name=__codelineno-0-253></a>            <span class=bp>self</span><span class=o>.</span><span class=n>ts_runner_dir</span> <span class=o>=</span> <span class=n>ts_runner_sdk_dir</span>
</span><span id=__span-0-254><a id=__codelineno-0-254 name=__codelineno-0-254></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-255><a id=__codelineno-0-255 name=__codelineno-0-255></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Agent run error: </span><span class=si>{</span><span class=n>AGENT_FILENAME_PY</span><span class=si>}</span><span class=s2> or </span><span class=si>{</span><span class=n>AGENT_FILENAME_TS</span><span class=si>}</span><span class=s2> does not exist&quot;</span><span class=p>)</span>
</span><span id=__span-0-256><a id=__codelineno-0-256 name=__codelineno-0-256></a>
</span><span id=__span-0-257><a id=__codelineno-0-257 name=__codelineno-0-257></a>        <span class=c1># cache all agent files in file_cache</span>
</span><span id=__span-0-258><a id=__codelineno-0-258 name=__codelineno-0-258></a>        <span class=k>for</span> <span class=n>root</span><span class=p>,</span> <span class=n>_</span><span class=p>,</span> <span class=n>files</span> <span class=ow>in</span> <span class=n>os</span><span class=o>.</span><span class=n>walk</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>temp_dir</span><span class=p>):</span>
</span><span id=__span-0-259><a id=__codelineno-0-259 name=__codelineno-0-259></a>            <span class=k>for</span> <span class=n>file</span> <span class=ow>in</span> <span class=n>files</span><span class=p>:</span>
</span><span id=__span-0-260><a id=__codelineno-0-260 name=__codelineno-0-260></a>                <span class=n>file_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>root</span><span class=p>,</span> <span class=n>file</span><span class=p>)</span>
</span><span id=__span-0-261><a id=__codelineno-0-261 name=__codelineno-0-261></a>
</span><span id=__span-0-262><a id=__codelineno-0-262 name=__codelineno-0-262></a>                <span class=c1># get file extension for agent_filename</span>
</span><span id=__span-0-263><a id=__codelineno-0-263 name=__codelineno-0-263></a>                <span class=k>if</span> <span class=n>file_path</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=s2>&quot;.ts&quot;</span><span class=p>):</span>
</span><span id=__span-0-264><a id=__codelineno-0-264 name=__codelineno-0-264></a>                    <span class=n>agent_ts_files_to_transpile</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
</span><span id=__span-0-265><a id=__codelineno-0-265 name=__codelineno-0-265></a>
</span><span id=__span-0-266><a id=__codelineno-0-266 name=__codelineno-0-266></a>                <span class=n>relative_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>relpath</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>temp_dir</span><span class=p>)</span>
</span><span id=__span-0-267><a id=__codelineno-0-267 name=__codelineno-0-267></a>                <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-268><a id=__codelineno-0-268 name=__codelineno-0-268></a>                    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=s2>&quot;rb&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-269><a id=__codelineno-0-269 name=__codelineno-0-269></a>                        <span class=n>content</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span><span id=__span-0-270><a id=__codelineno-0-270 name=__codelineno-0-270></a>                        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-271><a id=__codelineno-0-271 name=__codelineno-0-271></a>                            <span class=c1># Try to decode as text</span>
</span><span id=__span-0-272><a id=__codelineno-0-272 name=__codelineno-0-272></a>                            <span class=bp>self</span><span class=o>.</span><span class=n>file_cache</span><span class=p>[</span><span class=n>relative_path</span><span class=p>]</span> <span class=o>=</span> <span class=n>content</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s2>&quot;utf-8&quot;</span><span class=p>)</span>
</span><span id=__span-0-273><a id=__codelineno-0-273 name=__codelineno-0-273></a>                        <span class=k>except</span> <span class=ne>UnicodeDecodeError</span><span class=p>:</span>
</span><span id=__span-0-274><a id=__codelineno-0-274 name=__codelineno-0-274></a>                            <span class=c1># If decoding fails, store as binary</span>
</span><span id=__span-0-275><a id=__codelineno-0-275 name=__codelineno-0-275></a>                            <span class=bp>self</span><span class=o>.</span><span class=n>file_cache</span><span class=p>[</span><span class=n>relative_path</span><span class=p>]</span> <span class=o>=</span> <span class=n>content</span>
</span><span id=__span-0-276><a id=__codelineno-0-276 name=__codelineno-0-276></a>
</span><span id=__span-0-277><a id=__codelineno-0-277 name=__codelineno-0-277></a>                <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-278><a id=__codelineno-0-278 name=__codelineno-0-278></a>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error with cache creation </span><span class=si>{</span><span class=n>file_path</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-279><a id=__codelineno-0-279 name=__codelineno-0-279></a>
</span><span id=__span-0-280><a id=__codelineno-0-280 name=__codelineno-0-280></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-281><a id=__codelineno-0-281 name=__codelineno-0-281></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Using cached agent code&quot;</span><span class=p>)</span>
</span><span id=__span-0-282><a id=__codelineno-0-282 name=__codelineno-0-282></a>
</span><span id=__span-0-283><a id=__codelineno-0-283 name=__codelineno-0-283></a>    <span class=n>namespace</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-284><a id=__codelineno-0-284 name=__codelineno-0-284></a>        <span class=s2>&quot;env&quot;</span><span class=p>:</span> <span class=n>env</span><span class=p>,</span>
</span><span id=__span-0-285><a id=__codelineno-0-285 name=__codelineno-0-285></a>        <span class=s2>&quot;agent&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-286><a id=__codelineno-0-286 name=__codelineno-0-286></a>        <span class=s2>&quot;task&quot;</span><span class=p>:</span> <span class=n>task</span><span class=p>,</span>
</span><span id=__span-0-287><a id=__codelineno-0-287 name=__codelineno-0-287></a>        <span class=s2>&quot;__name__&quot;</span><span class=p>:</span> <span class=s2>&quot;__main__&quot;</span><span class=p>,</span>
</span><span id=__span-0-288><a id=__codelineno-0-288 name=__codelineno-0-288></a>        <span class=s2>&quot;__file__&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>agent_filename</span><span class=p>,</span>
</span><span id=__span-0-289><a id=__codelineno-0-289 name=__codelineno-0-289></a>    <span class=p>}</span>
</span><span id=__span-0-290><a id=__codelineno-0-290 name=__codelineno-0-290></a>
</span><span id=__span-0-291><a id=__codelineno-0-291 name=__codelineno-0-291></a>    <span class=n>user_auth</span> <span class=o>=</span> <span class=n>env</span><span class=o>.</span><span class=n>user_auth</span>
</span><span id=__span-0-292><a id=__codelineno-0-292 name=__codelineno-0-292></a>
</span><span id=__span-0-293><a id=__codelineno-0-293 name=__codelineno-0-293></a>    <span class=c1># clear user_auth we saved before</span>
</span><span id=__span-0-294><a id=__codelineno-0-294 name=__codelineno-0-294></a>    <span class=n>env</span><span class=o>.</span><span class=n>user_auth</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-295><a id=__codelineno-0-295 name=__codelineno-0-295></a>
</span><span id=__span-0-296><a id=__codelineno-0-296 name=__codelineno-0-296></a>    <span class=n>error_message</span><span class=p>,</span> <span class=n>traceback_message</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span>
</span><span id=__span-0-297><a id=__codelineno-0-297 name=__codelineno-0-297></a>
</span><span id=__span-0-298><a id=__codelineno-0-298 name=__codelineno-0-298></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-299><a id=__codelineno-0-299 name=__codelineno-0-299></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>change_to_temp_dir</span><span class=p>:</span>
</span><span id=__span-0-300><a id=__codelineno-0-300 name=__codelineno-0-300></a>            <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>temp_dir</span><span class=p>):</span>
</span><span id=__span-0-301><a id=__codelineno-0-301 name=__codelineno-0-301></a>                <span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>temp_dir</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-302><a id=__codelineno-0-302 name=__codelineno-0-302></a>            <span class=n>os</span><span class=o>.</span><span class=n>chdir</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>temp_dir</span><span class=p>)</span>
</span><span id=__span-0-303><a id=__codelineno-0-303 name=__codelineno-0-303></a>        <span class=n>sys</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>temp_dir</span><span class=p>)</span>
</span><span id=__span-0-304><a id=__codelineno-0-304 name=__codelineno-0-304></a>
</span><span id=__span-0-305><a id=__codelineno-0-305 name=__codelineno-0-305></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>agent_language</span> <span class=o>==</span> <span class=s2>&quot;ts&quot;</span><span class=p>:</span>
</span><span id=__span-0-306><a id=__codelineno-0-306 name=__codelineno-0-306></a>            <span class=n>agent_json_params</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span>
</span><span id=__span-0-307><a id=__codelineno-0-307 name=__codelineno-0-307></a>                <span class=p>{</span>
</span><span id=__span-0-308><a id=__codelineno-0-308 name=__codelineno-0-308></a>                    <span class=s2>&quot;thread_id&quot;</span><span class=p>:</span> <span class=n>env</span><span class=o>.</span><span class=n>_thread_id</span><span class=p>,</span>
</span><span id=__span-0-309><a id=__codelineno-0-309 name=__codelineno-0-309></a>                    <span class=s2>&quot;user_auth&quot;</span><span class=p>:</span> <span class=n>user_auth</span><span class=p>,</span>
</span><span id=__span-0-310><a id=__codelineno-0-310 name=__codelineno-0-310></a>                    <span class=s2>&quot;base_url&quot;</span><span class=p>:</span> <span class=n>env</span><span class=o>.</span><span class=n>base_url</span><span class=p>,</span>
</span><span id=__span-0-311><a id=__codelineno-0-311 name=__codelineno-0-311></a>                    <span class=s2>&quot;env_vars&quot;</span><span class=p>:</span> <span class=n>env</span><span class=o>.</span><span class=n>env_vars</span><span class=p>,</span>
</span><span id=__span-0-312><a id=__codelineno-0-312 name=__codelineno-0-312></a>                    <span class=s2>&quot;agent_ts_files_to_transpile&quot;</span><span class=p>:</span> <span class=n>agent_ts_files_to_transpile</span><span class=p>,</span>
</span><span id=__span-0-313><a id=__codelineno-0-313 name=__codelineno-0-313></a>                <span class=p>}</span>
</span><span id=__span-0-314><a id=__codelineno-0-314 name=__codelineno-0-314></a>            <span class=p>)</span>
</span><span id=__span-0-315><a id=__codelineno-0-315 name=__codelineno-0-315></a>
</span><span id=__span-0-316><a id=__codelineno-0-316 name=__codelineno-0-316></a>            <span class=n>process</span> <span class=o>=</span> <span class=n>multiprocessing</span><span class=o>.</span><span class=n>Process</span><span class=p>(</span>
</span><span id=__span-0-317><a id=__codelineno-0-317 name=__codelineno-0-317></a>                <span class=n>target</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>run_ts_agent</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>agent_filename</span><span class=p>,</span> <span class=n>env</span><span class=o>.</span><span class=n>env_vars</span><span class=p>,</span> <span class=n>agent_json_params</span><span class=p>]</span>
</span><span id=__span-0-318><a id=__codelineno-0-318 name=__codelineno-0-318></a>            <span class=p>)</span>
</span><span id=__span-0-319><a id=__codelineno-0-319 name=__codelineno-0-319></a>            <span class=n>process</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span><span id=__span-0-320><a id=__codelineno-0-320 name=__codelineno-0-320></a>            <span class=n>process</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span><span id=__span-0-321><a id=__codelineno-0-321 name=__codelineno-0-321></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-322><a id=__codelineno-0-322 name=__codelineno-0-322></a>            <span class=k>if</span> <span class=n>env</span><span class=o>.</span><span class=n>agent_runner_user</span><span class=p>:</span>
</span><span id=__span-0-323><a id=__codelineno-0-323 name=__codelineno-0-323></a>                <span class=n>process</span> <span class=o>=</span> <span class=n>multiprocessing</span><span class=o>.</span><span class=n>Process</span><span class=p>(</span>
</span><span id=__span-0-324><a id=__codelineno-0-324 name=__codelineno-0-324></a>                    <span class=n>target</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>run_python_code</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>[</span><span class=n>namespace</span><span class=p>,</span> <span class=n>env</span><span class=o>.</span><span class=n>agent_runner_user</span><span class=p>]</span>
</span><span id=__span-0-325><a id=__codelineno-0-325 name=__codelineno-0-325></a>                <span class=p>)</span>
</span><span id=__span-0-326><a id=__codelineno-0-326 name=__codelineno-0-326></a>                <span class=n>process</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span><span id=__span-0-327><a id=__codelineno-0-327 name=__codelineno-0-327></a>                <span class=n>process</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span><span id=__span-0-328><a id=__codelineno-0-328 name=__codelineno-0-328></a>            <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-329><a id=__codelineno-0-329 name=__codelineno-0-329></a>                <span class=n>error_message</span><span class=p>,</span> <span class=n>traceback_message</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>run_python_code</span><span class=p>(</span><span class=n>namespace</span><span class=p>,</span> <span class=n>env</span><span class=o>.</span><span class=n>agent_runner_user</span><span class=p>)</span>
</span><span id=__span-0-330><a id=__codelineno-0-330 name=__codelineno-0-330></a>    <span class=k>finally</span><span class=p>:</span>
</span><span id=__span-0-331><a id=__codelineno-0-331 name=__codelineno-0-331></a>        <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>temp_dir</span><span class=p>):</span>
</span><span id=__span-0-332><a id=__codelineno-0-332 name=__codelineno-0-332></a>            <span class=n>sys</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>temp_dir</span><span class=p>)</span>
</span><span id=__span-0-333><a id=__codelineno-0-333 name=__codelineno-0-333></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>change_to_temp_dir</span><span class=p>:</span>
</span><span id=__span-0-334><a id=__codelineno-0-334 name=__codelineno-0-334></a>            <span class=n>os</span><span class=o>.</span><span class=n>chdir</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>original_cwd</span><span class=p>)</span>
</span><span id=__span-0-335><a id=__codelineno-0-335 name=__codelineno-0-335></a>
</span><span id=__span-0-336><a id=__codelineno-0-336 name=__codelineno-0-336></a>    <span class=k>return</span> <span class=n>error_message</span><span class=p>,</span> <span class=n>traceback_message</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.agent.Agent.run_python_code class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">run_python_code</span> <a href=#nearai.agents.agent.Agent.run_python_code class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>run_python_code</span><span class=p>(</span><span class=n>agent_namespace</span><span class=p>,</span> <span class=n>agent_runner_user</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=typing.Tuple>Tuple</span></span><span class=p>[</span><span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>str</span><span class=p>],</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>str</span><span class=p>]]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Launch python agent.</p> <details class=quote> <summary>Source code in <code>nearai/agents/agent.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-132>132</a></span>
<span class=normal><a href=#__codelineno-0-133>133</a></span>
<span class=normal><a href=#__codelineno-0-134>134</a></span>
<span class=normal><a href=#__codelineno-0-135>135</a></span>
<span class=normal><a href=#__codelineno-0-136>136</a></span>
<span class=normal><a href=#__codelineno-0-137>137</a></span>
<span class=normal><a href=#__codelineno-0-138>138</a></span>
<span class=normal><a href=#__codelineno-0-139>139</a></span>
<span class=normal><a href=#__codelineno-0-140>140</a></span>
<span class=normal><a href=#__codelineno-0-141>141</a></span>
<span class=normal><a href=#__codelineno-0-142>142</a></span>
<span class=normal><a href=#__codelineno-0-143>143</a></span>
<span class=normal><a href=#__codelineno-0-144>144</a></span>
<span class=normal><a href=#__codelineno-0-145>145</a></span>
<span class=normal><a href=#__codelineno-0-146>146</a></span>
<span class=normal><a href=#__codelineno-0-147>147</a></span>
<span class=normal><a href=#__codelineno-0-148>148</a></span>
<span class=normal><a href=#__codelineno-0-149>149</a></span>
<span class=normal><a href=#__codelineno-0-150>150</a></span>
<span class=normal><a href=#__codelineno-0-151>151</a></span>
<span class=normal><a href=#__codelineno-0-152>152</a></span>
<span class=normal><a href=#__codelineno-0-153>153</a></span>
<span class=normal><a href=#__codelineno-0-154>154</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-132><a id=__codelineno-0-132 name=__codelineno-0-132></a><span class=k>def</span><span class=w> </span><span class=nf>run_python_code</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>agent_namespace</span><span class=p>,</span> <span class=n>agent_runner_user</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>],</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]]:</span>
</span><span id=__span-0-133><a id=__codelineno-0-133 name=__codelineno-0-133></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Launch python agent.&quot;&quot;&quot;</span>
</span><span id=__span-0-134><a id=__codelineno-0-134 name=__codelineno-0-134></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-135><a id=__codelineno-0-135 name=__codelineno-0-135></a>        <span class=c1># switch to user env.agent_runner_user</span>
</span><span id=__span-0-136><a id=__codelineno-0-136 name=__codelineno-0-136></a>        <span class=k>if</span> <span class=n>agent_runner_user</span><span class=p>:</span>
</span><span id=__span-0-137><a id=__codelineno-0-137 name=__codelineno-0-137></a>            <span class=n>user_info</span> <span class=o>=</span> <span class=n>pwd</span><span class=o>.</span><span class=n>getpwnam</span><span class=p>(</span><span class=n>agent_runner_user</span><span class=p>)</span>
</span><span id=__span-0-138><a id=__codelineno-0-138 name=__codelineno-0-138></a>            <span class=n>os</span><span class=o>.</span><span class=n>setgid</span><span class=p>(</span><span class=n>user_info</span><span class=o>.</span><span class=n>pw_gid</span><span class=p>)</span>
</span><span id=__span-0-139><a id=__codelineno-0-139 name=__codelineno-0-139></a>            <span class=n>os</span><span class=o>.</span><span class=n>setuid</span><span class=p>(</span><span class=n>user_info</span><span class=o>.</span><span class=n>pw_uid</span><span class=p>)</span>
</span><span id=__span-0-140><a id=__codelineno-0-140 name=__codelineno-0-140></a>
</span><span id=__span-0-141><a id=__codelineno-0-141 name=__codelineno-0-141></a>        <span class=c1># Run the code</span>
</span><span id=__span-0-142><a id=__codelineno-0-142 name=__codelineno-0-142></a>        <span class=c1># NOTE: runpy.run_path does not work in a multithreaded environment when running benchmark.</span>
</span><span id=__span-0-143><a id=__codelineno-0-143 name=__codelineno-0-143></a>        <span class=c1>#       The performance of runpy.run_path may also change depending on a system, e.g. it may</span>
</span><span id=__span-0-144><a id=__codelineno-0-144 name=__codelineno-0-144></a>        <span class=c1>#       work on Linux but not work on Mac.</span>
</span><span id=__span-0-145><a id=__codelineno-0-145 name=__codelineno-0-145></a>        <span class=c1>#       `compile` and `exec` have been tested to work properly in a multithreaded environment.</span>
</span><span id=__span-0-146><a id=__codelineno-0-146 name=__codelineno-0-146></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>code</span><span class=p>:</span>
</span><span id=__span-0-147><a id=__codelineno-0-147 name=__codelineno-0-147></a>            <span class=n>exec</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>code</span><span class=p>,</span> <span class=n>agent_namespace</span><span class=p>)</span>
</span><span id=__span-0-148><a id=__codelineno-0-148 name=__codelineno-0-148></a>
</span><span id=__span-0-149><a id=__codelineno-0-149 name=__codelineno-0-149></a>        <span class=c1># If no errors occur, return None</span>
</span><span id=__span-0-150><a id=__codelineno-0-150 name=__codelineno-0-150></a>        <span class=k>return</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span>
</span><span id=__span-0-151><a id=__codelineno-0-151 name=__codelineno-0-151></a>
</span><span id=__span-0-152><a id=__codelineno-0-152 name=__codelineno-0-152></a>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-153><a id=__codelineno-0-153 name=__codelineno-0-153></a>        <span class=c1># Return error message and full traceback as strings</span>
</span><span id=__span-0-154><a id=__codelineno-0-154 name=__codelineno-0-154></a>        <span class=k>return</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>),</span> <span class=n>traceback</span><span class=o>.</span><span class=n>format_exc</span><span class=p>()</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.agent.Agent.run_ts_agent class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">run_ts_agent</span> <a href=#nearai.agents.agent.Agent.run_ts_agent class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>run_ts_agent</span><span class=p>(</span><span class=n>agent_filename</span><span class=p>,</span> <span class=n>env_vars</span><span class=p>,</span> <span class=n>json_params</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Launch typescript agent.</p> <details class=quote> <summary>Source code in <code>nearai/agents/agent.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-156>156</a></span>
<span class=normal><a href=#__codelineno-0-157>157</a></span>
<span class=normal><a href=#__codelineno-0-158>158</a></span>
<span class=normal><a href=#__codelineno-0-159>159</a></span>
<span class=normal><a href=#__codelineno-0-160>160</a></span>
<span class=normal><a href=#__codelineno-0-161>161</a></span>
<span class=normal><a href=#__codelineno-0-162>162</a></span>
<span class=normal><a href=#__codelineno-0-163>163</a></span>
<span class=normal><a href=#__codelineno-0-164>164</a></span>
<span class=normal><a href=#__codelineno-0-165>165</a></span>
<span class=normal><a href=#__codelineno-0-166>166</a></span>
<span class=normal><a href=#__codelineno-0-167>167</a></span>
<span class=normal><a href=#__codelineno-0-168>168</a></span>
<span class=normal><a href=#__codelineno-0-169>169</a></span>
<span class=normal><a href=#__codelineno-0-170>170</a></span>
<span class=normal><a href=#__codelineno-0-171>171</a></span>
<span class=normal><a href=#__codelineno-0-172>172</a></span>
<span class=normal><a href=#__codelineno-0-173>173</a></span>
<span class=normal><a href=#__codelineno-0-174>174</a></span>
<span class=normal><a href=#__codelineno-0-175>175</a></span>
<span class=normal><a href=#__codelineno-0-176>176</a></span>
<span class=normal><a href=#__codelineno-0-177>177</a></span>
<span class=normal><a href=#__codelineno-0-178>178</a></span>
<span class=normal><a href=#__codelineno-0-179>179</a></span>
<span class=normal><a href=#__codelineno-0-180>180</a></span>
<span class=normal><a href=#__codelineno-0-181>181</a></span>
<span class=normal><a href=#__codelineno-0-182>182</a></span>
<span class=normal><a href=#__codelineno-0-183>183</a></span>
<span class=normal><a href=#__codelineno-0-184>184</a></span>
<span class=normal><a href=#__codelineno-0-185>185</a></span>
<span class=normal><a href=#__codelineno-0-186>186</a></span>
<span class=normal><a href=#__codelineno-0-187>187</a></span>
<span class=normal><a href=#__codelineno-0-188>188</a></span>
<span class=normal><a href=#__codelineno-0-189>189</a></span>
<span class=normal><a href=#__codelineno-0-190>190</a></span>
<span class=normal><a href=#__codelineno-0-191>191</a></span>
<span class=normal><a href=#__codelineno-0-192>192</a></span>
<span class=normal><a href=#__codelineno-0-193>193</a></span>
<span class=normal><a href=#__codelineno-0-194>194</a></span>
<span class=normal><a href=#__codelineno-0-195>195</a></span>
<span class=normal><a href=#__codelineno-0-196>196</a></span>
<span class=normal><a href=#__codelineno-0-197>197</a></span>
<span class=normal><a href=#__codelineno-0-198>198</a></span>
<span class=normal><a href=#__codelineno-0-199>199</a></span>
<span class=normal><a href=#__codelineno-0-200>200</a></span>
<span class=normal><a href=#__codelineno-0-201>201</a></span>
<span class=normal><a href=#__codelineno-0-202>202</a></span>
<span class=normal><a href=#__codelineno-0-203>203</a></span>
<span class=normal><a href=#__codelineno-0-204>204</a></span>
<span class=normal><a href=#__codelineno-0-205>205</a></span>
<span class=normal><a href=#__codelineno-0-206>206</a></span>
<span class=normal><a href=#__codelineno-0-207>207</a></span>
<span class=normal><a href=#__codelineno-0-208>208</a></span>
<span class=normal><a href=#__codelineno-0-209>209</a></span>
<span class=normal><a href=#__codelineno-0-210>210</a></span>
<span class=normal><a href=#__codelineno-0-211>211</a></span>
<span class=normal><a href=#__codelineno-0-212>212</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-156><a id=__codelineno-0-156 name=__codelineno-0-156></a><span class=k>def</span><span class=w> </span><span class=nf>run_ts_agent</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>agent_filename</span><span class=p>,</span> <span class=n>env_vars</span><span class=p>,</span> <span class=n>json_params</span><span class=p>):</span>
</span><span id=__span-0-157><a id=__codelineno-0-157 name=__codelineno-0-157></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Launch typescript agent.&quot;&quot;&quot;</span>
</span><span id=__span-0-158><a id=__codelineno-0-158 name=__codelineno-0-158></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Running typescript agent </span><span class=si>{</span><span class=n>agent_filename</span><span class=si>}</span><span class=s2> from </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>ts_runner_dir</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-159><a id=__codelineno-0-159 name=__codelineno-0-159></a>
</span><span id=__span-0-160><a id=__codelineno-0-160 name=__codelineno-0-160></a>    <span class=c1># Configure npm to use tmp directories</span>
</span><span id=__span-0-161><a id=__codelineno-0-161 name=__codelineno-0-161></a>    <span class=n>env</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
</span><span id=__span-0-162><a id=__codelineno-0-162 name=__codelineno-0-162></a>    <span class=n>env</span><span class=o>.</span><span class=n>update</span><span class=p>(</span>
</span><span id=__span-0-163><a id=__codelineno-0-163 name=__codelineno-0-163></a>        <span class=p>{</span>
</span><span id=__span-0-164><a id=__codelineno-0-164 name=__codelineno-0-164></a>            <span class=s2>&quot;NPM_CONFIG_CACHE&quot;</span><span class=p>:</span> <span class=s2>&quot;/tmp/npm_cache&quot;</span><span class=p>,</span>
</span><span id=__span-0-165><a id=__codelineno-0-165 name=__codelineno-0-165></a>            <span class=s2>&quot;NPM_CONFIG_PREFIX&quot;</span><span class=p>:</span> <span class=s2>&quot;/tmp/npm_prefix&quot;</span><span class=p>,</span>
</span><span id=__span-0-166><a id=__codelineno-0-166 name=__codelineno-0-166></a>            <span class=s2>&quot;HOME&quot;</span><span class=p>:</span> <span class=s2>&quot;/tmp&quot;</span><span class=p>,</span>  <span class=c1># Redirect npm home</span>
</span><span id=__span-0-167><a id=__codelineno-0-167 name=__codelineno-0-167></a>            <span class=s2>&quot;NPM_CONFIG_LOGLEVEL&quot;</span><span class=p>:</span> <span class=s2>&quot;error&quot;</span><span class=p>,</span>  <span class=c1># Suppress warnings, show only errors</span>
</span><span id=__span-0-168><a id=__codelineno-0-168 name=__codelineno-0-168></a>        <span class=p>}</span>
</span><span id=__span-0-169><a id=__codelineno-0-169 name=__codelineno-0-169></a>    <span class=p>)</span>
</span><span id=__span-0-170><a id=__codelineno-0-170 name=__codelineno-0-170></a>
</span><span id=__span-0-171><a id=__codelineno-0-171 name=__codelineno-0-171></a>    <span class=c1># Ensure directory structure exists</span>
</span><span id=__span-0-172><a id=__codelineno-0-172 name=__codelineno-0-172></a>    <span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=s2>&quot;/tmp/npm_cache&quot;</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-173><a id=__codelineno-0-173 name=__codelineno-0-173></a>    <span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=s2>&quot;/tmp/npm_prefix&quot;</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-174><a id=__codelineno-0-174 name=__codelineno-0-174></a>
</span><span id=__span-0-175><a id=__codelineno-0-175 name=__codelineno-0-175></a>    <span class=c1># read file /tmp/build-info.txt if exists</span>
</span><span id=__span-0-176><a id=__codelineno-0-176 name=__codelineno-0-176></a>    <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=s2>&quot;/var/task/build-info.txt&quot;</span><span class=p>):</span>
</span><span id=__span-0-177><a id=__codelineno-0-177 name=__codelineno-0-177></a>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&quot;/var/task/build-info.txt&quot;</span><span class=p>,</span> <span class=s2>&quot;r&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>file</span><span class=p>:</span>
</span><span id=__span-0-178><a id=__codelineno-0-178 name=__codelineno-0-178></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;BUILD ID: &quot;</span><span class=p>,</span> <span class=n>file</span><span class=o>.</span><span class=n>read</span><span class=p>())</span>
</span><span id=__span-0-179><a id=__codelineno-0-179 name=__codelineno-0-179></a>
</span><span id=__span-0-180><a id=__codelineno-0-180 name=__codelineno-0-180></a>    <span class=k>if</span> <span class=n>env_vars</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;DEBUG&quot;</span><span class=p>):</span>
</span><span id=__span-0-181><a id=__codelineno-0-181 name=__codelineno-0-181></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Directory structure:&quot;</span><span class=p>,</span> <span class=n>os</span><span class=o>.</span><span class=n>listdir</span><span class=p>(</span><span class=s2>&quot;/tmp/ts_runner&quot;</span><span class=p>))</span>
</span><span id=__span-0-182><a id=__codelineno-0-182 name=__codelineno-0-182></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Check package.json:&quot;</span><span class=p>,</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>ts_runner_dir</span><span class=p>,</span> <span class=s2>&quot;package.json&quot;</span><span class=p>)))</span>
</span><span id=__span-0-183><a id=__codelineno-0-183 name=__codelineno-0-183></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Symlink exists:&quot;</span><span class=p>,</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=s2>&quot;/tmp/ts_runner/node_modules/.bin/tsc&quot;</span><span class=p>))</span>
</span><span id=__span-0-184><a id=__codelineno-0-184 name=__codelineno-0-184></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Build files exist:&quot;</span><span class=p>,</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=s2>&quot;/tmp/ts_runner/build/sdk/main.js&quot;</span><span class=p>))</span>
</span><span id=__span-0-185><a id=__codelineno-0-185 name=__codelineno-0-185></a>
</span><span id=__span-0-186><a id=__codelineno-0-186 name=__codelineno-0-186></a>    <span class=c1># Launching a subprocess to run an npm script with specific configurations</span>
</span><span id=__span-0-187><a id=__codelineno-0-187 name=__codelineno-0-187></a>    <span class=n>ts_process</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>Popen</span><span class=p>(</span>
</span><span id=__span-0-188><a id=__codelineno-0-188 name=__codelineno-0-188></a>        <span class=p>[</span>
</span><span id=__span-0-189><a id=__codelineno-0-189 name=__codelineno-0-189></a>            <span class=s2>&quot;npm&quot;</span><span class=p>,</span>  <span class=c1># Command to run Node Package Manager</span>
</span><span id=__span-0-190><a id=__codelineno-0-190 name=__codelineno-0-190></a>            <span class=s2>&quot;--loglevel=error&quot;</span><span class=p>,</span>  <span class=c1># Suppress npm warnings and info logs, only show errors</span>
</span><span id=__span-0-191><a id=__codelineno-0-191 name=__codelineno-0-191></a>            <span class=s2>&quot;--prefix&quot;</span><span class=p>,</span>
</span><span id=__span-0-192><a id=__codelineno-0-192 name=__codelineno-0-192></a>            <span class=bp>self</span><span class=o>.</span><span class=n>ts_runner_dir</span><span class=p>,</span>  <span class=c1># Specifies the directory where npm should look for package.json</span>
</span><span id=__span-0-193><a id=__codelineno-0-193 name=__codelineno-0-193></a>            <span class=s2>&quot;run&quot;</span><span class=p>,</span>
</span><span id=__span-0-194><a id=__codelineno-0-194 name=__codelineno-0-194></a>            <span class=s2>&quot;start&quot;</span><span class=p>,</span>  <span class=c1># Runs the &quot;start&quot; script defined in package.json, this launches the agent</span>
</span><span id=__span-0-195><a id=__codelineno-0-195 name=__codelineno-0-195></a>            <span class=s2>&quot;agents/agent.ts&quot;</span><span class=p>,</span>
</span><span id=__span-0-196><a id=__codelineno-0-196 name=__codelineno-0-196></a>            <span class=n>json_params</span><span class=p>,</span>  <span class=c1># Arguments passed to the &quot;start&quot; script to configure the agent</span>
</span><span id=__span-0-197><a id=__codelineno-0-197 name=__codelineno-0-197></a>        <span class=p>],</span>
</span><span id=__span-0-198><a id=__codelineno-0-198 name=__codelineno-0-198></a>        <span class=n>stdout</span><span class=o>=</span><span class=n>subprocess</span><span class=o>.</span><span class=n>PIPE</span><span class=p>,</span>  <span class=c1># Captures standard output from the process</span>
</span><span id=__span-0-199><a id=__codelineno-0-199 name=__codelineno-0-199></a>        <span class=n>stderr</span><span class=o>=</span><span class=n>subprocess</span><span class=o>.</span><span class=n>PIPE</span><span class=p>,</span>  <span class=c1># Captures standard error</span>
</span><span id=__span-0-200><a id=__codelineno-0-200 name=__codelineno-0-200></a>        <span class=n>cwd</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>ts_runner_dir</span><span class=p>,</span>  <span class=c1># Sets the current working directory for the process</span>
</span><span id=__span-0-201><a id=__codelineno-0-201 name=__codelineno-0-201></a>        <span class=n>env</span><span class=o>=</span><span class=n>env_vars</span><span class=p>,</span>  <span class=c1># Provides custom environment variables to the subprocess</span>
</span><span id=__span-0-202><a id=__codelineno-0-202 name=__codelineno-0-202></a>    <span class=p>)</span>
</span><span id=__span-0-203><a id=__codelineno-0-203 name=__codelineno-0-203></a>
</span><span id=__span-0-204><a id=__codelineno-0-204 name=__codelineno-0-204></a>    <span class=n>stdout</span><span class=p>,</span> <span class=n>stderr</span> <span class=o>=</span> <span class=n>ts_process</span><span class=o>.</span><span class=n>communicate</span><span class=p>()</span>
</span><span id=__span-0-205><a id=__codelineno-0-205 name=__codelineno-0-205></a>
</span><span id=__span-0-206><a id=__codelineno-0-206 name=__codelineno-0-206></a>    <span class=n>stdout</span> <span class=o>=</span> <span class=n>stdout</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span><span id=__span-0-207><a id=__codelineno-0-207 name=__codelineno-0-207></a>    <span class=k>if</span> <span class=n>stdout</span> <span class=ow>and</span> <span class=n>env_vars</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;DEBUG&quot;</span><span class=p>):</span>
</span><span id=__span-0-208><a id=__codelineno-0-208 name=__codelineno-0-208></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;TS AGENT STDOUT: </span><span class=si>{</span><span class=n>stdout</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-209><a id=__codelineno-0-209 name=__codelineno-0-209></a>
</span><span id=__span-0-210><a id=__codelineno-0-210 name=__codelineno-0-210></a>    <span class=n>stderr</span> <span class=o>=</span> <span class=n>stderr</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span><span id=__span-0-211><a id=__codelineno-0-211 name=__codelineno-0-211></a>    <span class=k>if</span> <span class=n>stderr</span><span class=p>:</span>
</span><span id=__span-0-212><a id=__codelineno-0-212 name=__codelineno-0-212></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;TS AGENT STDERR: </span><span class=si>{</span><span class=n>stderr</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.agent.Agent.set_agent_metadata class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">set_agent_metadata</span> <a href=#nearai.agents.agent.Agent.set_agent_metadata class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>set_agent_metadata</span><span class=p>(</span><span class=n>metadata</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Set agent details from metadata.</p> <details class=quote> <summary>Source code in <code>nearai/agents/agent.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-105>105</a></span>
<span class=normal><a href=#__codelineno-0-106>106</a></span>
<span class=normal><a href=#__codelineno-0-107>107</a></span>
<span class=normal><a href=#__codelineno-0-108>108</a></span>
<span class=normal><a href=#__codelineno-0-109>109</a></span>
<span class=normal><a href=#__codelineno-0-110>110</a></span>
<span class=normal><a href=#__codelineno-0-111>111</a></span>
<span class=normal><a href=#__codelineno-0-112>112</a></span>
<span class=normal><a href=#__codelineno-0-113>113</a></span>
<span class=normal><a href=#__codelineno-0-114>114</a></span>
<span class=normal><a href=#__codelineno-0-115>115</a></span>
<span class=normal><a href=#__codelineno-0-116>116</a></span>
<span class=normal><a href=#__codelineno-0-117>117</a></span>
<span class=normal><a href=#__codelineno-0-118>118</a></span>
<span class=normal><a href=#__codelineno-0-119>119</a></span>
<span class=normal><a href=#__codelineno-0-120>120</a></span>
<span class=normal><a href=#__codelineno-0-121>121</a></span>
<span class=normal><a href=#__codelineno-0-122>122</a></span>
<span class=normal><a href=#__codelineno-0-123>123</a></span>
<span class=normal><a href=#__codelineno-0-124>124</a></span>
<span class=normal><a href=#__codelineno-0-125>125</a></span>
<span class=normal><a href=#__codelineno-0-126>126</a></span>
<span class=normal><a href=#__codelineno-0-127>127</a></span>
<span class=normal><a href=#__codelineno-0-128>128</a></span>
<span class=normal><a href=#__codelineno-0-129>129</a></span>
<span class=normal><a href=#__codelineno-0-130>130</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-105><a id=__codelineno-0-105 name=__codelineno-0-105></a><span class=k>def</span><span class=w> </span><span class=nf>set_agent_metadata</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>metadata</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-106><a id=__codelineno-0-106 name=__codelineno-0-106></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Set agent details from metadata.&quot;&quot;&quot;</span>
</span><span id=__span-0-107><a id=__codelineno-0-107 name=__codelineno-0-107></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-108><a id=__codelineno-0-108 name=__codelineno-0-108></a>        <span class=bp>self</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=n>metadata</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]</span>
</span><span id=__span-0-109><a id=__codelineno-0-109 name=__codelineno-0-109></a>        <span class=bp>self</span><span class=o>.</span><span class=n>version</span> <span class=o>=</span> <span class=n>metadata</span><span class=p>[</span><span class=s2>&quot;version&quot;</span><span class=p>]</span>
</span><span id=__span-0-110><a id=__codelineno-0-110 name=__codelineno-0-110></a>    <span class=k>except</span> <span class=ne>KeyError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-111><a id=__codelineno-0-111 name=__codelineno-0-111></a>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Missing key in metadata: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span> <span class=kn>from</span><span class=w> </span><span class=kc>None</span>
</span><span id=__span-0-112><a id=__codelineno-0-112 name=__codelineno-0-112></a>
</span><span id=__span-0-113><a id=__codelineno-0-113 name=__codelineno-0-113></a>    <span class=n>details</span> <span class=o>=</span> <span class=n>metadata</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;details&quot;</span><span class=p>,</span> <span class=p>{})</span>
</span><span id=__span-0-114><a id=__codelineno-0-114 name=__codelineno-0-114></a>    <span class=n>agent</span> <span class=o>=</span> <span class=n>details</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;agent&quot;</span><span class=p>,</span> <span class=p>{})</span>
</span><span id=__span-0-115><a id=__codelineno-0-115 name=__codelineno-0-115></a>    <span class=n>welcome</span> <span class=o>=</span> <span class=n>agent</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;welcome&quot;</span><span class=p>,</span> <span class=p>{})</span>
</span><span id=__span-0-116><a id=__codelineno-0-116 name=__codelineno-0-116></a>
</span><span id=__span-0-117><a id=__codelineno-0-117 name=__codelineno-0-117></a>    <span class=bp>self</span><span class=o>.</span><span class=n>env_vars</span> <span class=o>=</span> <span class=n>details</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;env_vars&quot;</span><span class=p>,</span> <span class=p>{})</span>
</span><span id=__span-0-118><a id=__codelineno-0-118 name=__codelineno-0-118></a>    <span class=bp>self</span><span class=o>.</span><span class=n>welcome_title</span> <span class=o>=</span> <span class=n>welcome</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;title&quot;</span><span class=p>)</span>
</span><span id=__span-0-119><a id=__codelineno-0-119 name=__codelineno-0-119></a>    <span class=bp>self</span><span class=o>.</span><span class=n>welcome_description</span> <span class=o>=</span> <span class=n>welcome</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;description&quot;</span><span class=p>)</span>
</span><span id=__span-0-120><a id=__codelineno-0-120 name=__codelineno-0-120></a>
</span><span id=__span-0-121><a id=__codelineno-0-121 name=__codelineno-0-121></a>    <span class=k>if</span> <span class=n>agent_metadata</span> <span class=o>:=</span> <span class=n>details</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;agent&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>):</span>
</span><span id=__span-0-122><a id=__codelineno-0-122 name=__codelineno-0-122></a>        <span class=k>if</span> <span class=n>defaults</span> <span class=o>:=</span> <span class=n>agent_metadata</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;defaults&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>):</span>
</span><span id=__span-0-123><a id=__codelineno-0-123 name=__codelineno-0-123></a>            <span class=bp>self</span><span class=o>.</span><span class=n>model</span> <span class=o>=</span> <span class=n>defaults</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;model&quot;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>model</span><span class=p>)</span>
</span><span id=__span-0-124><a id=__codelineno-0-124 name=__codelineno-0-124></a>            <span class=bp>self</span><span class=o>.</span><span class=n>model_provider</span> <span class=o>=</span> <span class=n>defaults</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;model_provider&quot;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>model_provider</span><span class=p>)</span>
</span><span id=__span-0-125><a id=__codelineno-0-125 name=__codelineno-0-125></a>            <span class=bp>self</span><span class=o>.</span><span class=n>model_temperature</span> <span class=o>=</span> <span class=n>defaults</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;model_temperature&quot;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>model_temperature</span><span class=p>)</span>
</span><span id=__span-0-126><a id=__codelineno-0-126 name=__codelineno-0-126></a>            <span class=bp>self</span><span class=o>.</span><span class=n>model_max_tokens</span> <span class=o>=</span> <span class=n>defaults</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;model_max_tokens&quot;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>model_max_tokens</span><span class=p>)</span>
</span><span id=__span-0-127><a id=__codelineno-0-127 name=__codelineno-0-127></a>            <span class=bp>self</span><span class=o>.</span><span class=n>max_iterations</span> <span class=o>=</span> <span class=n>defaults</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;max_iterations&quot;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>max_iterations</span><span class=p>)</span>
</span><span id=__span-0-128><a id=__codelineno-0-128 name=__codelineno-0-128></a>
</span><span id=__span-0-129><a id=__codelineno-0-129 name=__codelineno-0-129></a>    <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>version</span> <span class=ow>or</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=p>:</span>
</span><span id=__span-0-130><a id=__codelineno-0-130 name=__codelineno-0-130></a>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Both &#39;version&#39; and &#39;name&#39; must be non-empty in metadata.&quot;</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.agent.Agent.write_agent_files_to_temp class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">write_agent_files_to_temp</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small> </span> <a href=#nearai.agents.agent.Agent.write_agent_files_to_temp class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>write_agent_files_to_temp</span><span class=p>(</span><span class=n>agent_files</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Write agent files to a temporary directory.</p> <details class=quote> <summary>Source code in <code>nearai/agents/agent.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-63> 63</a></span>
<span class=normal><a href=#__codelineno-0-64> 64</a></span>
<span class=normal><a href=#__codelineno-0-65> 65</a></span>
<span class=normal><a href=#__codelineno-0-66> 66</a></span>
<span class=normal><a href=#__codelineno-0-67> 67</a></span>
<span class=normal><a href=#__codelineno-0-68> 68</a></span>
<span class=normal><a href=#__codelineno-0-69> 69</a></span>
<span class=normal><a href=#__codelineno-0-70> 70</a></span>
<span class=normal><a href=#__codelineno-0-71> 71</a></span>
<span class=normal><a href=#__codelineno-0-72> 72</a></span>
<span class=normal><a href=#__codelineno-0-73> 73</a></span>
<span class=normal><a href=#__codelineno-0-74> 74</a></span>
<span class=normal><a href=#__codelineno-0-75> 75</a></span>
<span class=normal><a href=#__codelineno-0-76> 76</a></span>
<span class=normal><a href=#__codelineno-0-77> 77</a></span>
<span class=normal><a href=#__codelineno-0-78> 78</a></span>
<span class=normal><a href=#__codelineno-0-79> 79</a></span>
<span class=normal><a href=#__codelineno-0-80> 80</a></span>
<span class=normal><a href=#__codelineno-0-81> 81</a></span>
<span class=normal><a href=#__codelineno-0-82> 82</a></span>
<span class=normal><a href=#__codelineno-0-83> 83</a></span>
<span class=normal><a href=#__codelineno-0-84> 84</a></span>
<span class=normal><a href=#__codelineno-0-85> 85</a></span>
<span class=normal><a href=#__codelineno-0-86> 86</a></span>
<span class=normal><a href=#__codelineno-0-87> 87</a></span>
<span class=normal><a href=#__codelineno-0-88> 88</a></span>
<span class=normal><a href=#__codelineno-0-89> 89</a></span>
<span class=normal><a href=#__codelineno-0-90> 90</a></span>
<span class=normal><a href=#__codelineno-0-91> 91</a></span>
<span class=normal><a href=#__codelineno-0-92> 92</a></span>
<span class=normal><a href=#__codelineno-0-93> 93</a></span>
<span class=normal><a href=#__codelineno-0-94> 94</a></span>
<span class=normal><a href=#__codelineno-0-95> 95</a></span>
<span class=normal><a href=#__codelineno-0-96> 96</a></span>
<span class=normal><a href=#__codelineno-0-97> 97</a></span>
<span class=normal><a href=#__codelineno-0-98> 98</a></span>
<span class=normal><a href=#__codelineno-0-99> 99</a></span>
<span class=normal><a href=#__codelineno-0-100>100</a></span>
<span class=normal><a href=#__codelineno-0-101>101</a></span>
<span class=normal><a href=#__codelineno-0-102>102</a></span>
<span class=normal><a href=#__codelineno-0-103>103</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-63><a id=__codelineno-0-63 name=__codelineno-0-63></a><span class=nd>@staticmethod</span>
</span><span id=__span-0-64><a id=__codelineno-0-64 name=__codelineno-0-64></a><span class=k>def</span><span class=w> </span><span class=nf>write_agent_files_to_temp</span><span class=p>(</span><span class=n>agent_files</span><span class=p>):</span>
</span><span id=__span-0-65><a id=__codelineno-0-65 name=__codelineno-0-65></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Write agent files to a temporary directory.&quot;&quot;&quot;</span>
</span><span id=__span-0-66><a id=__codelineno-0-66 name=__codelineno-0-66></a>    <span class=n>unique_id</span> <span class=o>=</span> <span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()</span><span class=o>.</span><span class=n>hex</span>
</span><span id=__span-0-67><a id=__codelineno-0-67 name=__codelineno-0-67></a>    <span class=n>temp_dir</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>tempfile</span><span class=o>.</span><span class=n>gettempdir</span><span class=p>(),</span> <span class=sa>f</span><span class=s2>&quot;agent_</span><span class=si>{</span><span class=n>unique_id</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-68><a id=__codelineno-0-68 name=__codelineno-0-68></a>
</span><span id=__span-0-69><a id=__codelineno-0-69 name=__codelineno-0-69></a>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>agent_files</span><span class=p>,</span> <span class=n>List</span><span class=p>):</span>
</span><span id=__span-0-70><a id=__codelineno-0-70 name=__codelineno-0-70></a>        <span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=n>temp_dir</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-71><a id=__codelineno-0-71 name=__codelineno-0-71></a>
</span><span id=__span-0-72><a id=__codelineno-0-72 name=__codelineno-0-72></a>        <span class=k>for</span> <span class=n>file_obj</span> <span class=ow>in</span> <span class=n>agent_files</span><span class=p>:</span>
</span><span id=__span-0-73><a id=__codelineno-0-73 name=__codelineno-0-73></a>            <span class=n>file_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>temp_dir</span><span class=p>,</span> <span class=n>file_obj</span><span class=p>[</span><span class=s2>&quot;filename&quot;</span><span class=p>])</span>
</span><span id=__span-0-74><a id=__codelineno-0-74 name=__codelineno-0-74></a>
</span><span id=__span-0-75><a id=__codelineno-0-75 name=__codelineno-0-75></a>            <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-76><a id=__codelineno-0-76 name=__codelineno-0-76></a>                <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=n>file_path</span><span class=p>)):</span>
</span><span id=__span-0-77><a id=__codelineno-0-77 name=__codelineno-0-77></a>                    <span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=n>file_path</span><span class=p>))</span>
</span><span id=__span-0-78><a id=__codelineno-0-78 name=__codelineno-0-78></a>
</span><span id=__span-0-79><a id=__codelineno-0-79 name=__codelineno-0-79></a>                <span class=n>content</span> <span class=o>=</span> <span class=n>file_obj</span><span class=p>[</span><span class=s2>&quot;content&quot;</span><span class=p>]</span>
</span><span id=__span-0-80><a id=__codelineno-0-80 name=__codelineno-0-80></a>
</span><span id=__span-0-81><a id=__codelineno-0-81 name=__codelineno-0-81></a>                <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>content</span><span class=p>,</span> <span class=nb>dict</span><span class=p>)</span> <span class=ow>or</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>content</span><span class=p>,</span> <span class=nb>list</span><span class=p>):</span>
</span><span id=__span-0-82><a id=__codelineno-0-82 name=__codelineno-0-82></a>                    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-83><a id=__codelineno-0-83 name=__codelineno-0-83></a>                        <span class=n>content</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>
</span><span id=__span-0-84><a id=__codelineno-0-84 name=__codelineno-0-84></a>                    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-85><a id=__codelineno-0-85 name=__codelineno-0-85></a>                        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error converting content to json: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-86><a id=__codelineno-0-86 name=__codelineno-0-86></a>                    <span class=n>content</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>
</span><span id=__span-0-87><a id=__codelineno-0-87 name=__codelineno-0-87></a>
</span><span id=__span-0-88><a id=__codelineno-0-88 name=__codelineno-0-88></a>                <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>content</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-89><a id=__codelineno-0-89 name=__codelineno-0-89></a>                    <span class=n>content</span> <span class=o>=</span> <span class=n>content</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s2>&quot;utf-8&quot;</span><span class=p>)</span>
</span><span id=__span-0-90><a id=__codelineno-0-90 name=__codelineno-0-90></a>
</span><span id=__span-0-91><a id=__codelineno-0-91 name=__codelineno-0-91></a>                <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=s2>&quot;wb&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-92><a id=__codelineno-0-92 name=__codelineno-0-92></a>                    <span class=k>with</span> <span class=n>io</span><span class=o>.</span><span class=n>BytesIO</span><span class=p>(</span><span class=n>content</span><span class=p>)</span> <span class=k>as</span> <span class=n>byte_stream</span><span class=p>:</span>
</span><span id=__span-0-93><a id=__codelineno-0-93 name=__codelineno-0-93></a>                        <span class=n>shutil</span><span class=o>.</span><span class=n>copyfileobj</span><span class=p>(</span><span class=n>byte_stream</span><span class=p>,</span> <span class=n>f</span><span class=p>)</span>
</span><span id=__span-0-94><a id=__codelineno-0-94 name=__codelineno-0-94></a>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-95><a id=__codelineno-0-95 name=__codelineno-0-95></a>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error writing file </span><span class=si>{</span><span class=n>file_path</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-96><a id=__codelineno-0-96 name=__codelineno-0-96></a>                <span class=k>raise</span> <span class=n>e</span>
</span><span id=__span-0-97><a id=__codelineno-0-97 name=__codelineno-0-97></a>
</span><span id=__span-0-98><a id=__codelineno-0-98 name=__codelineno-0-98></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-99><a id=__codelineno-0-99 name=__codelineno-0-99></a>        <span class=c1># if agent files is a PosixPath, it is a path to the agent directory</span>
</span><span id=__span-0-100><a id=__codelineno-0-100 name=__codelineno-0-100></a>        <span class=c1># Copy all agent files including subfolders</span>
</span><span id=__span-0-101><a id=__codelineno-0-101 name=__codelineno-0-101></a>        <span class=n>shutil</span><span class=o>.</span><span class=n>copytree</span><span class=p>(</span><span class=n>agent_files</span><span class=p>,</span> <span class=n>temp_dir</span><span class=p>,</span> <span class=n>dirs_exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-102><a id=__codelineno-0-102 name=__codelineno-0-102></a>
</span><span id=__span-0-103><a id=__codelineno-0-103 name=__codelineno-0-103></a>    <span class=k>return</span> <span class=n>temp_dir</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> </div> </div> </div> <div class="doc doc-object doc-module"> <h4 id=nearai.agents.environment class="doc doc-heading"> <span class="doc doc-object-name doc-module-name">environment</span> <a href=#nearai.agents.environment class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h5 id=nearai.agents.environment.Environment class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">Environment</span> <a href=#nearai.agents.environment.Environment class=headerlink title="Permanent link">&para;</a></h5> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code>object</code></p> <details class=quote> <summary>Source code in <code>nearai/agents/environment.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-99>  99</a></span>
<span class=normal><a href=#__codelineno-0-100> 100</a></span>
<span class=normal><a href=#__codelineno-0-101> 101</a></span>
<span class=normal><a href=#__codelineno-0-102> 102</a></span>
<span class=normal><a href=#__codelineno-0-103> 103</a></span>
<span class=normal><a href=#__codelineno-0-104> 104</a></span>
<span class=normal><a href=#__codelineno-0-105> 105</a></span>
<span class=normal><a href=#__codelineno-0-106> 106</a></span>
<span class=normal><a href=#__codelineno-0-107> 107</a></span>
<span class=normal><a href=#__codelineno-0-108> 108</a></span>
<span class=normal><a href=#__codelineno-0-109> 109</a></span>
<span class=normal><a href=#__codelineno-0-110> 110</a></span>
<span class=normal><a href=#__codelineno-0-111> 111</a></span>
<span class=normal><a href=#__codelineno-0-112> 112</a></span>
<span class=normal><a href=#__codelineno-0-113> 113</a></span>
<span class=normal><a href=#__codelineno-0-114> 114</a></span>
<span class=normal><a href=#__codelineno-0-115> 115</a></span>
<span class=normal><a href=#__codelineno-0-116> 116</a></span>
<span class=normal><a href=#__codelineno-0-117> 117</a></span>
<span class=normal><a href=#__codelineno-0-118> 118</a></span>
<span class=normal><a href=#__codelineno-0-119> 119</a></span>
<span class=normal><a href=#__codelineno-0-120> 120</a></span>
<span class=normal><a href=#__codelineno-0-121> 121</a></span>
<span class=normal><a href=#__codelineno-0-122> 122</a></span>
<span class=normal><a href=#__codelineno-0-123> 123</a></span>
<span class=normal><a href=#__codelineno-0-124> 124</a></span>
<span class=normal><a href=#__codelineno-0-125> 125</a></span>
<span class=normal><a href=#__codelineno-0-126> 126</a></span>
<span class=normal><a href=#__codelineno-0-127> 127</a></span>
<span class=normal><a href=#__codelineno-0-128> 128</a></span>
<span class=normal><a href=#__codelineno-0-129> 129</a></span>
<span class=normal><a href=#__codelineno-0-130> 130</a></span>
<span class=normal><a href=#__codelineno-0-131> 131</a></span>
<span class=normal><a href=#__codelineno-0-132> 132</a></span>
<span class=normal><a href=#__codelineno-0-133> 133</a></span>
<span class=normal><a href=#__codelineno-0-134> 134</a></span>
<span class=normal><a href=#__codelineno-0-135> 135</a></span>
<span class=normal><a href=#__codelineno-0-136> 136</a></span>
<span class=normal><a href=#__codelineno-0-137> 137</a></span>
<span class=normal><a href=#__codelineno-0-138> 138</a></span>
<span class=normal><a href=#__codelineno-0-139> 139</a></span>
<span class=normal><a href=#__codelineno-0-140> 140</a></span>
<span class=normal><a href=#__codelineno-0-141> 141</a></span>
<span class=normal><a href=#__codelineno-0-142> 142</a></span>
<span class=normal><a href=#__codelineno-0-143> 143</a></span>
<span class=normal><a href=#__codelineno-0-144> 144</a></span>
<span class=normal><a href=#__codelineno-0-145> 145</a></span>
<span class=normal><a href=#__codelineno-0-146> 146</a></span>
<span class=normal><a href=#__codelineno-0-147> 147</a></span>
<span class=normal><a href=#__codelineno-0-148> 148</a></span>
<span class=normal><a href=#__codelineno-0-149> 149</a></span>
<span class=normal><a href=#__codelineno-0-150> 150</a></span>
<span class=normal><a href=#__codelineno-0-151> 151</a></span>
<span class=normal><a href=#__codelineno-0-152> 152</a></span>
<span class=normal><a href=#__codelineno-0-153> 153</a></span>
<span class=normal><a href=#__codelineno-0-154> 154</a></span>
<span class=normal><a href=#__codelineno-0-155> 155</a></span>
<span class=normal><a href=#__codelineno-0-156> 156</a></span>
<span class=normal><a href=#__codelineno-0-157> 157</a></span>
<span class=normal><a href=#__codelineno-0-158> 158</a></span>
<span class=normal><a href=#__codelineno-0-159> 159</a></span>
<span class=normal><a href=#__codelineno-0-160> 160</a></span>
<span class=normal><a href=#__codelineno-0-161> 161</a></span>
<span class=normal><a href=#__codelineno-0-162> 162</a></span>
<span class=normal><a href=#__codelineno-0-163> 163</a></span>
<span class=normal><a href=#__codelineno-0-164> 164</a></span>
<span class=normal><a href=#__codelineno-0-165> 165</a></span>
<span class=normal><a href=#__codelineno-0-166> 166</a></span>
<span class=normal><a href=#__codelineno-0-167> 167</a></span>
<span class=normal><a href=#__codelineno-0-168> 168</a></span>
<span class=normal><a href=#__codelineno-0-169> 169</a></span>
<span class=normal><a href=#__codelineno-0-170> 170</a></span>
<span class=normal><a href=#__codelineno-0-171> 171</a></span>
<span class=normal><a href=#__codelineno-0-172> 172</a></span>
<span class=normal><a href=#__codelineno-0-173> 173</a></span>
<span class=normal><a href=#__codelineno-0-174> 174</a></span>
<span class=normal><a href=#__codelineno-0-175> 175</a></span>
<span class=normal><a href=#__codelineno-0-176> 176</a></span>
<span class=normal><a href=#__codelineno-0-177> 177</a></span>
<span class=normal><a href=#__codelineno-0-178> 178</a></span>
<span class=normal><a href=#__codelineno-0-179> 179</a></span>
<span class=normal><a href=#__codelineno-0-180> 180</a></span>
<span class=normal><a href=#__codelineno-0-181> 181</a></span>
<span class=normal><a href=#__codelineno-0-182> 182</a></span>
<span class=normal><a href=#__codelineno-0-183> 183</a></span>
<span class=normal><a href=#__codelineno-0-184> 184</a></span>
<span class=normal><a href=#__codelineno-0-185> 185</a></span>
<span class=normal><a href=#__codelineno-0-186> 186</a></span>
<span class=normal><a href=#__codelineno-0-187> 187</a></span>
<span class=normal><a href=#__codelineno-0-188> 188</a></span>
<span class=normal><a href=#__codelineno-0-189> 189</a></span>
<span class=normal><a href=#__codelineno-0-190> 190</a></span>
<span class=normal><a href=#__codelineno-0-191> 191</a></span>
<span class=normal><a href=#__codelineno-0-192> 192</a></span>
<span class=normal><a href=#__codelineno-0-193> 193</a></span>
<span class=normal><a href=#__codelineno-0-194> 194</a></span>
<span class=normal><a href=#__codelineno-0-195> 195</a></span>
<span class=normal><a href=#__codelineno-0-196> 196</a></span>
<span class=normal><a href=#__codelineno-0-197> 197</a></span>
<span class=normal><a href=#__codelineno-0-198> 198</a></span>
<span class=normal><a href=#__codelineno-0-199> 199</a></span>
<span class=normal><a href=#__codelineno-0-200> 200</a></span>
<span class=normal><a href=#__codelineno-0-201> 201</a></span>
<span class=normal><a href=#__codelineno-0-202> 202</a></span>
<span class=normal><a href=#__codelineno-0-203> 203</a></span>
<span class=normal><a href=#__codelineno-0-204> 204</a></span>
<span class=normal><a href=#__codelineno-0-205> 205</a></span>
<span class=normal><a href=#__codelineno-0-206> 206</a></span>
<span class=normal><a href=#__codelineno-0-207> 207</a></span>
<span class=normal><a href=#__codelineno-0-208> 208</a></span>
<span class=normal><a href=#__codelineno-0-209> 209</a></span>
<span class=normal><a href=#__codelineno-0-210> 210</a></span>
<span class=normal><a href=#__codelineno-0-211> 211</a></span>
<span class=normal><a href=#__codelineno-0-212> 212</a></span>
<span class=normal><a href=#__codelineno-0-213> 213</a></span>
<span class=normal><a href=#__codelineno-0-214> 214</a></span>
<span class=normal><a href=#__codelineno-0-215> 215</a></span>
<span class=normal><a href=#__codelineno-0-216> 216</a></span>
<span class=normal><a href=#__codelineno-0-217> 217</a></span>
<span class=normal><a href=#__codelineno-0-218> 218</a></span>
<span class=normal><a href=#__codelineno-0-219> 219</a></span>
<span class=normal><a href=#__codelineno-0-220> 220</a></span>
<span class=normal><a href=#__codelineno-0-221> 221</a></span>
<span class=normal><a href=#__codelineno-0-222> 222</a></span>
<span class=normal><a href=#__codelineno-0-223> 223</a></span>
<span class=normal><a href=#__codelineno-0-224> 224</a></span>
<span class=normal><a href=#__codelineno-0-225> 225</a></span>
<span class=normal><a href=#__codelineno-0-226> 226</a></span>
<span class=normal><a href=#__codelineno-0-227> 227</a></span>
<span class=normal><a href=#__codelineno-0-228> 228</a></span>
<span class=normal><a href=#__codelineno-0-229> 229</a></span>
<span class=normal><a href=#__codelineno-0-230> 230</a></span>
<span class=normal><a href=#__codelineno-0-231> 231</a></span>
<span class=normal><a href=#__codelineno-0-232> 232</a></span>
<span class=normal><a href=#__codelineno-0-233> 233</a></span>
<span class=normal><a href=#__codelineno-0-234> 234</a></span>
<span class=normal><a href=#__codelineno-0-235> 235</a></span>
<span class=normal><a href=#__codelineno-0-236> 236</a></span>
<span class=normal><a href=#__codelineno-0-237> 237</a></span>
<span class=normal><a href=#__codelineno-0-238> 238</a></span>
<span class=normal><a href=#__codelineno-0-239> 239</a></span>
<span class=normal><a href=#__codelineno-0-240> 240</a></span>
<span class=normal><a href=#__codelineno-0-241> 241</a></span>
<span class=normal><a href=#__codelineno-0-242> 242</a></span>
<span class=normal><a href=#__codelineno-0-243> 243</a></span>
<span class=normal><a href=#__codelineno-0-244> 244</a></span>
<span class=normal><a href=#__codelineno-0-245> 245</a></span>
<span class=normal><a href=#__codelineno-0-246> 246</a></span>
<span class=normal><a href=#__codelineno-0-247> 247</a></span>
<span class=normal><a href=#__codelineno-0-248> 248</a></span>
<span class=normal><a href=#__codelineno-0-249> 249</a></span>
<span class=normal><a href=#__codelineno-0-250> 250</a></span>
<span class=normal><a href=#__codelineno-0-251> 251</a></span>
<span class=normal><a href=#__codelineno-0-252> 252</a></span>
<span class=normal><a href=#__codelineno-0-253> 253</a></span>
<span class=normal><a href=#__codelineno-0-254> 254</a></span>
<span class=normal><a href=#__codelineno-0-255> 255</a></span>
<span class=normal><a href=#__codelineno-0-256> 256</a></span>
<span class=normal><a href=#__codelineno-0-257> 257</a></span>
<span class=normal><a href=#__codelineno-0-258> 258</a></span>
<span class=normal><a href=#__codelineno-0-259> 259</a></span>
<span class=normal><a href=#__codelineno-0-260> 260</a></span>
<span class=normal><a href=#__codelineno-0-261> 261</a></span>
<span class=normal><a href=#__codelineno-0-262> 262</a></span>
<span class=normal><a href=#__codelineno-0-263> 263</a></span>
<span class=normal><a href=#__codelineno-0-264> 264</a></span>
<span class=normal><a href=#__codelineno-0-265> 265</a></span>
<span class=normal><a href=#__codelineno-0-266> 266</a></span>
<span class=normal><a href=#__codelineno-0-267> 267</a></span>
<span class=normal><a href=#__codelineno-0-268> 268</a></span>
<span class=normal><a href=#__codelineno-0-269> 269</a></span>
<span class=normal><a href=#__codelineno-0-270> 270</a></span>
<span class=normal><a href=#__codelineno-0-271> 271</a></span>
<span class=normal><a href=#__codelineno-0-272> 272</a></span>
<span class=normal><a href=#__codelineno-0-273> 273</a></span>
<span class=normal><a href=#__codelineno-0-274> 274</a></span>
<span class=normal><a href=#__codelineno-0-275> 275</a></span>
<span class=normal><a href=#__codelineno-0-276> 276</a></span>
<span class=normal><a href=#__codelineno-0-277> 277</a></span>
<span class=normal><a href=#__codelineno-0-278> 278</a></span>
<span class=normal><a href=#__codelineno-0-279> 279</a></span>
<span class=normal><a href=#__codelineno-0-280> 280</a></span>
<span class=normal><a href=#__codelineno-0-281> 281</a></span>
<span class=normal><a href=#__codelineno-0-282> 282</a></span>
<span class=normal><a href=#__codelineno-0-283> 283</a></span>
<span class=normal><a href=#__codelineno-0-284> 284</a></span>
<span class=normal><a href=#__codelineno-0-285> 285</a></span>
<span class=normal><a href=#__codelineno-0-286> 286</a></span>
<span class=normal><a href=#__codelineno-0-287> 287</a></span>
<span class=normal><a href=#__codelineno-0-288> 288</a></span>
<span class=normal><a href=#__codelineno-0-289> 289</a></span>
<span class=normal><a href=#__codelineno-0-290> 290</a></span>
<span class=normal><a href=#__codelineno-0-291> 291</a></span>
<span class=normal><a href=#__codelineno-0-292> 292</a></span>
<span class=normal><a href=#__codelineno-0-293> 293</a></span>
<span class=normal><a href=#__codelineno-0-294> 294</a></span>
<span class=normal><a href=#__codelineno-0-295> 295</a></span>
<span class=normal><a href=#__codelineno-0-296> 296</a></span>
<span class=normal><a href=#__codelineno-0-297> 297</a></span>
<span class=normal><a href=#__codelineno-0-298> 298</a></span>
<span class=normal><a href=#__codelineno-0-299> 299</a></span>
<span class=normal><a href=#__codelineno-0-300> 300</a></span>
<span class=normal><a href=#__codelineno-0-301> 301</a></span>
<span class=normal><a href=#__codelineno-0-302> 302</a></span>
<span class=normal><a href=#__codelineno-0-303> 303</a></span>
<span class=normal><a href=#__codelineno-0-304> 304</a></span>
<span class=normal><a href=#__codelineno-0-305> 305</a></span>
<span class=normal><a href=#__codelineno-0-306> 306</a></span>
<span class=normal><a href=#__codelineno-0-307> 307</a></span>
<span class=normal><a href=#__codelineno-0-308> 308</a></span>
<span class=normal><a href=#__codelineno-0-309> 309</a></span>
<span class=normal><a href=#__codelineno-0-310> 310</a></span>
<span class=normal><a href=#__codelineno-0-311> 311</a></span>
<span class=normal><a href=#__codelineno-0-312> 312</a></span>
<span class=normal><a href=#__codelineno-0-313> 313</a></span>
<span class=normal><a href=#__codelineno-0-314> 314</a></span>
<span class=normal><a href=#__codelineno-0-315> 315</a></span>
<span class=normal><a href=#__codelineno-0-316> 316</a></span>
<span class=normal><a href=#__codelineno-0-317> 317</a></span>
<span class=normal><a href=#__codelineno-0-318> 318</a></span>
<span class=normal><a href=#__codelineno-0-319> 319</a></span>
<span class=normal><a href=#__codelineno-0-320> 320</a></span>
<span class=normal><a href=#__codelineno-0-321> 321</a></span>
<span class=normal><a href=#__codelineno-0-322> 322</a></span>
<span class=normal><a href=#__codelineno-0-323> 323</a></span>
<span class=normal><a href=#__codelineno-0-324> 324</a></span>
<span class=normal><a href=#__codelineno-0-325> 325</a></span>
<span class=normal><a href=#__codelineno-0-326> 326</a></span>
<span class=normal><a href=#__codelineno-0-327> 327</a></span>
<span class=normal><a href=#__codelineno-0-328> 328</a></span>
<span class=normal><a href=#__codelineno-0-329> 329</a></span>
<span class=normal><a href=#__codelineno-0-330> 330</a></span>
<span class=normal><a href=#__codelineno-0-331> 331</a></span>
<span class=normal><a href=#__codelineno-0-332> 332</a></span>
<span class=normal><a href=#__codelineno-0-333> 333</a></span>
<span class=normal><a href=#__codelineno-0-334> 334</a></span>
<span class=normal><a href=#__codelineno-0-335> 335</a></span>
<span class=normal><a href=#__codelineno-0-336> 336</a></span>
<span class=normal><a href=#__codelineno-0-337> 337</a></span>
<span class=normal><a href=#__codelineno-0-338> 338</a></span>
<span class=normal><a href=#__codelineno-0-339> 339</a></span>
<span class=normal><a href=#__codelineno-0-340> 340</a></span>
<span class=normal><a href=#__codelineno-0-341> 341</a></span>
<span class=normal><a href=#__codelineno-0-342> 342</a></span>
<span class=normal><a href=#__codelineno-0-343> 343</a></span>
<span class=normal><a href=#__codelineno-0-344> 344</a></span>
<span class=normal><a href=#__codelineno-0-345> 345</a></span>
<span class=normal><a href=#__codelineno-0-346> 346</a></span>
<span class=normal><a href=#__codelineno-0-347> 347</a></span>
<span class=normal><a href=#__codelineno-0-348> 348</a></span>
<span class=normal><a href=#__codelineno-0-349> 349</a></span>
<span class=normal><a href=#__codelineno-0-350> 350</a></span>
<span class=normal><a href=#__codelineno-0-351> 351</a></span>
<span class=normal><a href=#__codelineno-0-352> 352</a></span>
<span class=normal><a href=#__codelineno-0-353> 353</a></span>
<span class=normal><a href=#__codelineno-0-354> 354</a></span>
<span class=normal><a href=#__codelineno-0-355> 355</a></span>
<span class=normal><a href=#__codelineno-0-356> 356</a></span>
<span class=normal><a href=#__codelineno-0-357> 357</a></span>
<span class=normal><a href=#__codelineno-0-358> 358</a></span>
<span class=normal><a href=#__codelineno-0-359> 359</a></span>
<span class=normal><a href=#__codelineno-0-360> 360</a></span>
<span class=normal><a href=#__codelineno-0-361> 361</a></span>
<span class=normal><a href=#__codelineno-0-362> 362</a></span>
<span class=normal><a href=#__codelineno-0-363> 363</a></span>
<span class=normal><a href=#__codelineno-0-364> 364</a></span>
<span class=normal><a href=#__codelineno-0-365> 365</a></span>
<span class=normal><a href=#__codelineno-0-366> 366</a></span>
<span class=normal><a href=#__codelineno-0-367> 367</a></span>
<span class=normal><a href=#__codelineno-0-368> 368</a></span>
<span class=normal><a href=#__codelineno-0-369> 369</a></span>
<span class=normal><a href=#__codelineno-0-370> 370</a></span>
<span class=normal><a href=#__codelineno-0-371> 371</a></span>
<span class=normal><a href=#__codelineno-0-372> 372</a></span>
<span class=normal><a href=#__codelineno-0-373> 373</a></span>
<span class=normal><a href=#__codelineno-0-374> 374</a></span>
<span class=normal><a href=#__codelineno-0-375> 375</a></span>
<span class=normal><a href=#__codelineno-0-376> 376</a></span>
<span class=normal><a href=#__codelineno-0-377> 377</a></span>
<span class=normal><a href=#__codelineno-0-378> 378</a></span>
<span class=normal><a href=#__codelineno-0-379> 379</a></span>
<span class=normal><a href=#__codelineno-0-380> 380</a></span>
<span class=normal><a href=#__codelineno-0-381> 381</a></span>
<span class=normal><a href=#__codelineno-0-382> 382</a></span>
<span class=normal><a href=#__codelineno-0-383> 383</a></span>
<span class=normal><a href=#__codelineno-0-384> 384</a></span>
<span class=normal><a href=#__codelineno-0-385> 385</a></span>
<span class=normal><a href=#__codelineno-0-386> 386</a></span>
<span class=normal><a href=#__codelineno-0-387> 387</a></span>
<span class=normal><a href=#__codelineno-0-388> 388</a></span>
<span class=normal><a href=#__codelineno-0-389> 389</a></span>
<span class=normal><a href=#__codelineno-0-390> 390</a></span>
<span class=normal><a href=#__codelineno-0-391> 391</a></span>
<span class=normal><a href=#__codelineno-0-392> 392</a></span>
<span class=normal><a href=#__codelineno-0-393> 393</a></span>
<span class=normal><a href=#__codelineno-0-394> 394</a></span>
<span class=normal><a href=#__codelineno-0-395> 395</a></span>
<span class=normal><a href=#__codelineno-0-396> 396</a></span>
<span class=normal><a href=#__codelineno-0-397> 397</a></span>
<span class=normal><a href=#__codelineno-0-398> 398</a></span>
<span class=normal><a href=#__codelineno-0-399> 399</a></span>
<span class=normal><a href=#__codelineno-0-400> 400</a></span>
<span class=normal><a href=#__codelineno-0-401> 401</a></span>
<span class=normal><a href=#__codelineno-0-402> 402</a></span>
<span class=normal><a href=#__codelineno-0-403> 403</a></span>
<span class=normal><a href=#__codelineno-0-404> 404</a></span>
<span class=normal><a href=#__codelineno-0-405> 405</a></span>
<span class=normal><a href=#__codelineno-0-406> 406</a></span>
<span class=normal><a href=#__codelineno-0-407> 407</a></span>
<span class=normal><a href=#__codelineno-0-408> 408</a></span>
<span class=normal><a href=#__codelineno-0-409> 409</a></span>
<span class=normal><a href=#__codelineno-0-410> 410</a></span>
<span class=normal><a href=#__codelineno-0-411> 411</a></span>
<span class=normal><a href=#__codelineno-0-412> 412</a></span>
<span class=normal><a href=#__codelineno-0-413> 413</a></span>
<span class=normal><a href=#__codelineno-0-414> 414</a></span>
<span class=normal><a href=#__codelineno-0-415> 415</a></span>
<span class=normal><a href=#__codelineno-0-416> 416</a></span>
<span class=normal><a href=#__codelineno-0-417> 417</a></span>
<span class=normal><a href=#__codelineno-0-418> 418</a></span>
<span class=normal><a href=#__codelineno-0-419> 419</a></span>
<span class=normal><a href=#__codelineno-0-420> 420</a></span>
<span class=normal><a href=#__codelineno-0-421> 421</a></span>
<span class=normal><a href=#__codelineno-0-422> 422</a></span>
<span class=normal><a href=#__codelineno-0-423> 423</a></span>
<span class=normal><a href=#__codelineno-0-424> 424</a></span>
<span class=normal><a href=#__codelineno-0-425> 425</a></span>
<span class=normal><a href=#__codelineno-0-426> 426</a></span>
<span class=normal><a href=#__codelineno-0-427> 427</a></span>
<span class=normal><a href=#__codelineno-0-428> 428</a></span>
<span class=normal><a href=#__codelineno-0-429> 429</a></span>
<span class=normal><a href=#__codelineno-0-430> 430</a></span>
<span class=normal><a href=#__codelineno-0-431> 431</a></span>
<span class=normal><a href=#__codelineno-0-432> 432</a></span>
<span class=normal><a href=#__codelineno-0-433> 433</a></span>
<span class=normal><a href=#__codelineno-0-434> 434</a></span>
<span class=normal><a href=#__codelineno-0-435> 435</a></span>
<span class=normal><a href=#__codelineno-0-436> 436</a></span>
<span class=normal><a href=#__codelineno-0-437> 437</a></span>
<span class=normal><a href=#__codelineno-0-438> 438</a></span>
<span class=normal><a href=#__codelineno-0-439> 439</a></span>
<span class=normal><a href=#__codelineno-0-440> 440</a></span>
<span class=normal><a href=#__codelineno-0-441> 441</a></span>
<span class=normal><a href=#__codelineno-0-442> 442</a></span>
<span class=normal><a href=#__codelineno-0-443> 443</a></span>
<span class=normal><a href=#__codelineno-0-444> 444</a></span>
<span class=normal><a href=#__codelineno-0-445> 445</a></span>
<span class=normal><a href=#__codelineno-0-446> 446</a></span>
<span class=normal><a href=#__codelineno-0-447> 447</a></span>
<span class=normal><a href=#__codelineno-0-448> 448</a></span>
<span class=normal><a href=#__codelineno-0-449> 449</a></span>
<span class=normal><a href=#__codelineno-0-450> 450</a></span>
<span class=normal><a href=#__codelineno-0-451> 451</a></span>
<span class=normal><a href=#__codelineno-0-452> 452</a></span>
<span class=normal><a href=#__codelineno-0-453> 453</a></span>
<span class=normal><a href=#__codelineno-0-454> 454</a></span>
<span class=normal><a href=#__codelineno-0-455> 455</a></span>
<span class=normal><a href=#__codelineno-0-456> 456</a></span>
<span class=normal><a href=#__codelineno-0-457> 457</a></span>
<span class=normal><a href=#__codelineno-0-458> 458</a></span>
<span class=normal><a href=#__codelineno-0-459> 459</a></span>
<span class=normal><a href=#__codelineno-0-460> 460</a></span>
<span class=normal><a href=#__codelineno-0-461> 461</a></span>
<span class=normal><a href=#__codelineno-0-462> 462</a></span>
<span class=normal><a href=#__codelineno-0-463> 463</a></span>
<span class=normal><a href=#__codelineno-0-464> 464</a></span>
<span class=normal><a href=#__codelineno-0-465> 465</a></span>
<span class=normal><a href=#__codelineno-0-466> 466</a></span>
<span class=normal><a href=#__codelineno-0-467> 467</a></span>
<span class=normal><a href=#__codelineno-0-468> 468</a></span>
<span class=normal><a href=#__codelineno-0-469> 469</a></span>
<span class=normal><a href=#__codelineno-0-470> 470</a></span>
<span class=normal><a href=#__codelineno-0-471> 471</a></span>
<span class=normal><a href=#__codelineno-0-472> 472</a></span>
<span class=normal><a href=#__codelineno-0-473> 473</a></span>
<span class=normal><a href=#__codelineno-0-474> 474</a></span>
<span class=normal><a href=#__codelineno-0-475> 475</a></span>
<span class=normal><a href=#__codelineno-0-476> 476</a></span>
<span class=normal><a href=#__codelineno-0-477> 477</a></span>
<span class=normal><a href=#__codelineno-0-478> 478</a></span>
<span class=normal><a href=#__codelineno-0-479> 479</a></span>
<span class=normal><a href=#__codelineno-0-480> 480</a></span>
<span class=normal><a href=#__codelineno-0-481> 481</a></span>
<span class=normal><a href=#__codelineno-0-482> 482</a></span>
<span class=normal><a href=#__codelineno-0-483> 483</a></span>
<span class=normal><a href=#__codelineno-0-484> 484</a></span>
<span class=normal><a href=#__codelineno-0-485> 485</a></span>
<span class=normal><a href=#__codelineno-0-486> 486</a></span>
<span class=normal><a href=#__codelineno-0-487> 487</a></span>
<span class=normal><a href=#__codelineno-0-488> 488</a></span>
<span class=normal><a href=#__codelineno-0-489> 489</a></span>
<span class=normal><a href=#__codelineno-0-490> 490</a></span>
<span class=normal><a href=#__codelineno-0-491> 491</a></span>
<span class=normal><a href=#__codelineno-0-492> 492</a></span>
<span class=normal><a href=#__codelineno-0-493> 493</a></span>
<span class=normal><a href=#__codelineno-0-494> 494</a></span>
<span class=normal><a href=#__codelineno-0-495> 495</a></span>
<span class=normal><a href=#__codelineno-0-496> 496</a></span>
<span class=normal><a href=#__codelineno-0-497> 497</a></span>
<span class=normal><a href=#__codelineno-0-498> 498</a></span>
<span class=normal><a href=#__codelineno-0-499> 499</a></span>
<span class=normal><a href=#__codelineno-0-500> 500</a></span>
<span class=normal><a href=#__codelineno-0-501> 501</a></span>
<span class=normal><a href=#__codelineno-0-502> 502</a></span>
<span class=normal><a href=#__codelineno-0-503> 503</a></span>
<span class=normal><a href=#__codelineno-0-504> 504</a></span>
<span class=normal><a href=#__codelineno-0-505> 505</a></span>
<span class=normal><a href=#__codelineno-0-506> 506</a></span>
<span class=normal><a href=#__codelineno-0-507> 507</a></span>
<span class=normal><a href=#__codelineno-0-508> 508</a></span>
<span class=normal><a href=#__codelineno-0-509> 509</a></span>
<span class=normal><a href=#__codelineno-0-510> 510</a></span>
<span class=normal><a href=#__codelineno-0-511> 511</a></span>
<span class=normal><a href=#__codelineno-0-512> 512</a></span>
<span class=normal><a href=#__codelineno-0-513> 513</a></span>
<span class=normal><a href=#__codelineno-0-514> 514</a></span>
<span class=normal><a href=#__codelineno-0-515> 515</a></span>
<span class=normal><a href=#__codelineno-0-516> 516</a></span>
<span class=normal><a href=#__codelineno-0-517> 517</a></span>
<span class=normal><a href=#__codelineno-0-518> 518</a></span>
<span class=normal><a href=#__codelineno-0-519> 519</a></span>
<span class=normal><a href=#__codelineno-0-520> 520</a></span>
<span class=normal><a href=#__codelineno-0-521> 521</a></span>
<span class=normal><a href=#__codelineno-0-522> 522</a></span>
<span class=normal><a href=#__codelineno-0-523> 523</a></span>
<span class=normal><a href=#__codelineno-0-524> 524</a></span>
<span class=normal><a href=#__codelineno-0-525> 525</a></span>
<span class=normal><a href=#__codelineno-0-526> 526</a></span>
<span class=normal><a href=#__codelineno-0-527> 527</a></span>
<span class=normal><a href=#__codelineno-0-528> 528</a></span>
<span class=normal><a href=#__codelineno-0-529> 529</a></span>
<span class=normal><a href=#__codelineno-0-530> 530</a></span>
<span class=normal><a href=#__codelineno-0-531> 531</a></span>
<span class=normal><a href=#__codelineno-0-532> 532</a></span>
<span class=normal><a href=#__codelineno-0-533> 533</a></span>
<span class=normal><a href=#__codelineno-0-534> 534</a></span>
<span class=normal><a href=#__codelineno-0-535> 535</a></span>
<span class=normal><a href=#__codelineno-0-536> 536</a></span>
<span class=normal><a href=#__codelineno-0-537> 537</a></span>
<span class=normal><a href=#__codelineno-0-538> 538</a></span>
<span class=normal><a href=#__codelineno-0-539> 539</a></span>
<span class=normal><a href=#__codelineno-0-540> 540</a></span>
<span class=normal><a href=#__codelineno-0-541> 541</a></span>
<span class=normal><a href=#__codelineno-0-542> 542</a></span>
<span class=normal><a href=#__codelineno-0-543> 543</a></span>
<span class=normal><a href=#__codelineno-0-544> 544</a></span>
<span class=normal><a href=#__codelineno-0-545> 545</a></span>
<span class=normal><a href=#__codelineno-0-546> 546</a></span>
<span class=normal><a href=#__codelineno-0-547> 547</a></span>
<span class=normal><a href=#__codelineno-0-548> 548</a></span>
<span class=normal><a href=#__codelineno-0-549> 549</a></span>
<span class=normal><a href=#__codelineno-0-550> 550</a></span>
<span class=normal><a href=#__codelineno-0-551> 551</a></span>
<span class=normal><a href=#__codelineno-0-552> 552</a></span>
<span class=normal><a href=#__codelineno-0-553> 553</a></span>
<span class=normal><a href=#__codelineno-0-554> 554</a></span>
<span class=normal><a href=#__codelineno-0-555> 555</a></span>
<span class=normal><a href=#__codelineno-0-556> 556</a></span>
<span class=normal><a href=#__codelineno-0-557> 557</a></span>
<span class=normal><a href=#__codelineno-0-558> 558</a></span>
<span class=normal><a href=#__codelineno-0-559> 559</a></span>
<span class=normal><a href=#__codelineno-0-560> 560</a></span>
<span class=normal><a href=#__codelineno-0-561> 561</a></span>
<span class=normal><a href=#__codelineno-0-562> 562</a></span>
<span class=normal><a href=#__codelineno-0-563> 563</a></span>
<span class=normal><a href=#__codelineno-0-564> 564</a></span>
<span class=normal><a href=#__codelineno-0-565> 565</a></span>
<span class=normal><a href=#__codelineno-0-566> 566</a></span>
<span class=normal><a href=#__codelineno-0-567> 567</a></span>
<span class=normal><a href=#__codelineno-0-568> 568</a></span>
<span class=normal><a href=#__codelineno-0-569> 569</a></span>
<span class=normal><a href=#__codelineno-0-570> 570</a></span>
<span class=normal><a href=#__codelineno-0-571> 571</a></span>
<span class=normal><a href=#__codelineno-0-572> 572</a></span>
<span class=normal><a href=#__codelineno-0-573> 573</a></span>
<span class=normal><a href=#__codelineno-0-574> 574</a></span>
<span class=normal><a href=#__codelineno-0-575> 575</a></span>
<span class=normal><a href=#__codelineno-0-576> 576</a></span>
<span class=normal><a href=#__codelineno-0-577> 577</a></span>
<span class=normal><a href=#__codelineno-0-578> 578</a></span>
<span class=normal><a href=#__codelineno-0-579> 579</a></span>
<span class=normal><a href=#__codelineno-0-580> 580</a></span>
<span class=normal><a href=#__codelineno-0-581> 581</a></span>
<span class=normal><a href=#__codelineno-0-582> 582</a></span>
<span class=normal><a href=#__codelineno-0-583> 583</a></span>
<span class=normal><a href=#__codelineno-0-584> 584</a></span>
<span class=normal><a href=#__codelineno-0-585> 585</a></span>
<span class=normal><a href=#__codelineno-0-586> 586</a></span>
<span class=normal><a href=#__codelineno-0-587> 587</a></span>
<span class=normal><a href=#__codelineno-0-588> 588</a></span>
<span class=normal><a href=#__codelineno-0-589> 589</a></span>
<span class=normal><a href=#__codelineno-0-590> 590</a></span>
<span class=normal><a href=#__codelineno-0-591> 591</a></span>
<span class=normal><a href=#__codelineno-0-592> 592</a></span>
<span class=normal><a href=#__codelineno-0-593> 593</a></span>
<span class=normal><a href=#__codelineno-0-594> 594</a></span>
<span class=normal><a href=#__codelineno-0-595> 595</a></span>
<span class=normal><a href=#__codelineno-0-596> 596</a></span>
<span class=normal><a href=#__codelineno-0-597> 597</a></span>
<span class=normal><a href=#__codelineno-0-598> 598</a></span>
<span class=normal><a href=#__codelineno-0-599> 599</a></span>
<span class=normal><a href=#__codelineno-0-600> 600</a></span>
<span class=normal><a href=#__codelineno-0-601> 601</a></span>
<span class=normal><a href=#__codelineno-0-602> 602</a></span>
<span class=normal><a href=#__codelineno-0-603> 603</a></span>
<span class=normal><a href=#__codelineno-0-604> 604</a></span>
<span class=normal><a href=#__codelineno-0-605> 605</a></span>
<span class=normal><a href=#__codelineno-0-606> 606</a></span>
<span class=normal><a href=#__codelineno-0-607> 607</a></span>
<span class=normal><a href=#__codelineno-0-608> 608</a></span>
<span class=normal><a href=#__codelineno-0-609> 609</a></span>
<span class=normal><a href=#__codelineno-0-610> 610</a></span>
<span class=normal><a href=#__codelineno-0-611> 611</a></span>
<span class=normal><a href=#__codelineno-0-612> 612</a></span>
<span class=normal><a href=#__codelineno-0-613> 613</a></span>
<span class=normal><a href=#__codelineno-0-614> 614</a></span>
<span class=normal><a href=#__codelineno-0-615> 615</a></span>
<span class=normal><a href=#__codelineno-0-616> 616</a></span>
<span class=normal><a href=#__codelineno-0-617> 617</a></span>
<span class=normal><a href=#__codelineno-0-618> 618</a></span>
<span class=normal><a href=#__codelineno-0-619> 619</a></span>
<span class=normal><a href=#__codelineno-0-620> 620</a></span>
<span class=normal><a href=#__codelineno-0-621> 621</a></span>
<span class=normal><a href=#__codelineno-0-622> 622</a></span>
<span class=normal><a href=#__codelineno-0-623> 623</a></span>
<span class=normal><a href=#__codelineno-0-624> 624</a></span>
<span class=normal><a href=#__codelineno-0-625> 625</a></span>
<span class=normal><a href=#__codelineno-0-626> 626</a></span>
<span class=normal><a href=#__codelineno-0-627> 627</a></span>
<span class=normal><a href=#__codelineno-0-628> 628</a></span>
<span class=normal><a href=#__codelineno-0-629> 629</a></span>
<span class=normal><a href=#__codelineno-0-630> 630</a></span>
<span class=normal><a href=#__codelineno-0-631> 631</a></span>
<span class=normal><a href=#__codelineno-0-632> 632</a></span>
<span class=normal><a href=#__codelineno-0-633> 633</a></span>
<span class=normal><a href=#__codelineno-0-634> 634</a></span>
<span class=normal><a href=#__codelineno-0-635> 635</a></span>
<span class=normal><a href=#__codelineno-0-636> 636</a></span>
<span class=normal><a href=#__codelineno-0-637> 637</a></span>
<span class=normal><a href=#__codelineno-0-638> 638</a></span>
<span class=normal><a href=#__codelineno-0-639> 639</a></span>
<span class=normal><a href=#__codelineno-0-640> 640</a></span>
<span class=normal><a href=#__codelineno-0-641> 641</a></span>
<span class=normal><a href=#__codelineno-0-642> 642</a></span>
<span class=normal><a href=#__codelineno-0-643> 643</a></span>
<span class=normal><a href=#__codelineno-0-644> 644</a></span>
<span class=normal><a href=#__codelineno-0-645> 645</a></span>
<span class=normal><a href=#__codelineno-0-646> 646</a></span>
<span class=normal><a href=#__codelineno-0-647> 647</a></span>
<span class=normal><a href=#__codelineno-0-648> 648</a></span>
<span class=normal><a href=#__codelineno-0-649> 649</a></span>
<span class=normal><a href=#__codelineno-0-650> 650</a></span>
<span class=normal><a href=#__codelineno-0-651> 651</a></span>
<span class=normal><a href=#__codelineno-0-652> 652</a></span>
<span class=normal><a href=#__codelineno-0-653> 653</a></span>
<span class=normal><a href=#__codelineno-0-654> 654</a></span>
<span class=normal><a href=#__codelineno-0-655> 655</a></span>
<span class=normal><a href=#__codelineno-0-656> 656</a></span>
<span class=normal><a href=#__codelineno-0-657> 657</a></span>
<span class=normal><a href=#__codelineno-0-658> 658</a></span>
<span class=normal><a href=#__codelineno-0-659> 659</a></span>
<span class=normal><a href=#__codelineno-0-660> 660</a></span>
<span class=normal><a href=#__codelineno-0-661> 661</a></span>
<span class=normal><a href=#__codelineno-0-662> 662</a></span>
<span class=normal><a href=#__codelineno-0-663> 663</a></span>
<span class=normal><a href=#__codelineno-0-664> 664</a></span>
<span class=normal><a href=#__codelineno-0-665> 665</a></span>
<span class=normal><a href=#__codelineno-0-666> 666</a></span>
<span class=normal><a href=#__codelineno-0-667> 667</a></span>
<span class=normal><a href=#__codelineno-0-668> 668</a></span>
<span class=normal><a href=#__codelineno-0-669> 669</a></span>
<span class=normal><a href=#__codelineno-0-670> 670</a></span>
<span class=normal><a href=#__codelineno-0-671> 671</a></span>
<span class=normal><a href=#__codelineno-0-672> 672</a></span>
<span class=normal><a href=#__codelineno-0-673> 673</a></span>
<span class=normal><a href=#__codelineno-0-674> 674</a></span>
<span class=normal><a href=#__codelineno-0-675> 675</a></span>
<span class=normal><a href=#__codelineno-0-676> 676</a></span>
<span class=normal><a href=#__codelineno-0-677> 677</a></span>
<span class=normal><a href=#__codelineno-0-678> 678</a></span>
<span class=normal><a href=#__codelineno-0-679> 679</a></span>
<span class=normal><a href=#__codelineno-0-680> 680</a></span>
<span class=normal><a href=#__codelineno-0-681> 681</a></span>
<span class=normal><a href=#__codelineno-0-682> 682</a></span>
<span class=normal><a href=#__codelineno-0-683> 683</a></span>
<span class=normal><a href=#__codelineno-0-684> 684</a></span>
<span class=normal><a href=#__codelineno-0-685> 685</a></span>
<span class=normal><a href=#__codelineno-0-686> 686</a></span>
<span class=normal><a href=#__codelineno-0-687> 687</a></span>
<span class=normal><a href=#__codelineno-0-688> 688</a></span>
<span class=normal><a href=#__codelineno-0-689> 689</a></span>
<span class=normal><a href=#__codelineno-0-690> 690</a></span>
<span class=normal><a href=#__codelineno-0-691> 691</a></span>
<span class=normal><a href=#__codelineno-0-692> 692</a></span>
<span class=normal><a href=#__codelineno-0-693> 693</a></span>
<span class=normal><a href=#__codelineno-0-694> 694</a></span>
<span class=normal><a href=#__codelineno-0-695> 695</a></span>
<span class=normal><a href=#__codelineno-0-696> 696</a></span>
<span class=normal><a href=#__codelineno-0-697> 697</a></span>
<span class=normal><a href=#__codelineno-0-698> 698</a></span>
<span class=normal><a href=#__codelineno-0-699> 699</a></span>
<span class=normal><a href=#__codelineno-0-700> 700</a></span>
<span class=normal><a href=#__codelineno-0-701> 701</a></span>
<span class=normal><a href=#__codelineno-0-702> 702</a></span>
<span class=normal><a href=#__codelineno-0-703> 703</a></span>
<span class=normal><a href=#__codelineno-0-704> 704</a></span>
<span class=normal><a href=#__codelineno-0-705> 705</a></span>
<span class=normal><a href=#__codelineno-0-706> 706</a></span>
<span class=normal><a href=#__codelineno-0-707> 707</a></span>
<span class=normal><a href=#__codelineno-0-708> 708</a></span>
<span class=normal><a href=#__codelineno-0-709> 709</a></span>
<span class=normal><a href=#__codelineno-0-710> 710</a></span>
<span class=normal><a href=#__codelineno-0-711> 711</a></span>
<span class=normal><a href=#__codelineno-0-712> 712</a></span>
<span class=normal><a href=#__codelineno-0-713> 713</a></span>
<span class=normal><a href=#__codelineno-0-714> 714</a></span>
<span class=normal><a href=#__codelineno-0-715> 715</a></span>
<span class=normal><a href=#__codelineno-0-716> 716</a></span>
<span class=normal><a href=#__codelineno-0-717> 717</a></span>
<span class=normal><a href=#__codelineno-0-718> 718</a></span>
<span class=normal><a href=#__codelineno-0-719> 719</a></span>
<span class=normal><a href=#__codelineno-0-720> 720</a></span>
<span class=normal><a href=#__codelineno-0-721> 721</a></span>
<span class=normal><a href=#__codelineno-0-722> 722</a></span>
<span class=normal><a href=#__codelineno-0-723> 723</a></span>
<span class=normal><a href=#__codelineno-0-724> 724</a></span>
<span class=normal><a href=#__codelineno-0-725> 725</a></span>
<span class=normal><a href=#__codelineno-0-726> 726</a></span>
<span class=normal><a href=#__codelineno-0-727> 727</a></span>
<span class=normal><a href=#__codelineno-0-728> 728</a></span>
<span class=normal><a href=#__codelineno-0-729> 729</a></span>
<span class=normal><a href=#__codelineno-0-730> 730</a></span>
<span class=normal><a href=#__codelineno-0-731> 731</a></span>
<span class=normal><a href=#__codelineno-0-732> 732</a></span>
<span class=normal><a href=#__codelineno-0-733> 733</a></span>
<span class=normal><a href=#__codelineno-0-734> 734</a></span>
<span class=normal><a href=#__codelineno-0-735> 735</a></span>
<span class=normal><a href=#__codelineno-0-736> 736</a></span>
<span class=normal><a href=#__codelineno-0-737> 737</a></span>
<span class=normal><a href=#__codelineno-0-738> 738</a></span>
<span class=normal><a href=#__codelineno-0-739> 739</a></span>
<span class=normal><a href=#__codelineno-0-740> 740</a></span>
<span class=normal><a href=#__codelineno-0-741> 741</a></span>
<span class=normal><a href=#__codelineno-0-742> 742</a></span>
<span class=normal><a href=#__codelineno-0-743> 743</a></span>
<span class=normal><a href=#__codelineno-0-744> 744</a></span>
<span class=normal><a href=#__codelineno-0-745> 745</a></span>
<span class=normal><a href=#__codelineno-0-746> 746</a></span>
<span class=normal><a href=#__codelineno-0-747> 747</a></span>
<span class=normal><a href=#__codelineno-0-748> 748</a></span>
<span class=normal><a href=#__codelineno-0-749> 749</a></span>
<span class=normal><a href=#__codelineno-0-750> 750</a></span>
<span class=normal><a href=#__codelineno-0-751> 751</a></span>
<span class=normal><a href=#__codelineno-0-752> 752</a></span>
<span class=normal><a href=#__codelineno-0-753> 753</a></span>
<span class=normal><a href=#__codelineno-0-754> 754</a></span>
<span class=normal><a href=#__codelineno-0-755> 755</a></span>
<span class=normal><a href=#__codelineno-0-756> 756</a></span>
<span class=normal><a href=#__codelineno-0-757> 757</a></span>
<span class=normal><a href=#__codelineno-0-758> 758</a></span>
<span class=normal><a href=#__codelineno-0-759> 759</a></span>
<span class=normal><a href=#__codelineno-0-760> 760</a></span>
<span class=normal><a href=#__codelineno-0-761> 761</a></span>
<span class=normal><a href=#__codelineno-0-762> 762</a></span>
<span class=normal><a href=#__codelineno-0-763> 763</a></span>
<span class=normal><a href=#__codelineno-0-764> 764</a></span>
<span class=normal><a href=#__codelineno-0-765> 765</a></span>
<span class=normal><a href=#__codelineno-0-766> 766</a></span>
<span class=normal><a href=#__codelineno-0-767> 767</a></span>
<span class=normal><a href=#__codelineno-0-768> 768</a></span>
<span class=normal><a href=#__codelineno-0-769> 769</a></span>
<span class=normal><a href=#__codelineno-0-770> 770</a></span>
<span class=normal><a href=#__codelineno-0-771> 771</a></span>
<span class=normal><a href=#__codelineno-0-772> 772</a></span>
<span class=normal><a href=#__codelineno-0-773> 773</a></span>
<span class=normal><a href=#__codelineno-0-774> 774</a></span>
<span class=normal><a href=#__codelineno-0-775> 775</a></span>
<span class=normal><a href=#__codelineno-0-776> 776</a></span>
<span class=normal><a href=#__codelineno-0-777> 777</a></span>
<span class=normal><a href=#__codelineno-0-778> 778</a></span>
<span class=normal><a href=#__codelineno-0-779> 779</a></span>
<span class=normal><a href=#__codelineno-0-780> 780</a></span>
<span class=normal><a href=#__codelineno-0-781> 781</a></span>
<span class=normal><a href=#__codelineno-0-782> 782</a></span>
<span class=normal><a href=#__codelineno-0-783> 783</a></span>
<span class=normal><a href=#__codelineno-0-784> 784</a></span>
<span class=normal><a href=#__codelineno-0-785> 785</a></span>
<span class=normal><a href=#__codelineno-0-786> 786</a></span>
<span class=normal><a href=#__codelineno-0-787> 787</a></span>
<span class=normal><a href=#__codelineno-0-788> 788</a></span>
<span class=normal><a href=#__codelineno-0-789> 789</a></span>
<span class=normal><a href=#__codelineno-0-790> 790</a></span>
<span class=normal><a href=#__codelineno-0-791> 791</a></span>
<span class=normal><a href=#__codelineno-0-792> 792</a></span>
<span class=normal><a href=#__codelineno-0-793> 793</a></span>
<span class=normal><a href=#__codelineno-0-794> 794</a></span>
<span class=normal><a href=#__codelineno-0-795> 795</a></span>
<span class=normal><a href=#__codelineno-0-796> 796</a></span>
<span class=normal><a href=#__codelineno-0-797> 797</a></span>
<span class=normal><a href=#__codelineno-0-798> 798</a></span>
<span class=normal><a href=#__codelineno-0-799> 799</a></span>
<span class=normal><a href=#__codelineno-0-800> 800</a></span>
<span class=normal><a href=#__codelineno-0-801> 801</a></span>
<span class=normal><a href=#__codelineno-0-802> 802</a></span>
<span class=normal><a href=#__codelineno-0-803> 803</a></span>
<span class=normal><a href=#__codelineno-0-804> 804</a></span>
<span class=normal><a href=#__codelineno-0-805> 805</a></span>
<span class=normal><a href=#__codelineno-0-806> 806</a></span>
<span class=normal><a href=#__codelineno-0-807> 807</a></span>
<span class=normal><a href=#__codelineno-0-808> 808</a></span>
<span class=normal><a href=#__codelineno-0-809> 809</a></span>
<span class=normal><a href=#__codelineno-0-810> 810</a></span>
<span class=normal><a href=#__codelineno-0-811> 811</a></span>
<span class=normal><a href=#__codelineno-0-812> 812</a></span>
<span class=normal><a href=#__codelineno-0-813> 813</a></span>
<span class=normal><a href=#__codelineno-0-814> 814</a></span>
<span class=normal><a href=#__codelineno-0-815> 815</a></span>
<span class=normal><a href=#__codelineno-0-816> 816</a></span>
<span class=normal><a href=#__codelineno-0-817> 817</a></span>
<span class=normal><a href=#__codelineno-0-818> 818</a></span>
<span class=normal><a href=#__codelineno-0-819> 819</a></span>
<span class=normal><a href=#__codelineno-0-820> 820</a></span>
<span class=normal><a href=#__codelineno-0-821> 821</a></span>
<span class=normal><a href=#__codelineno-0-822> 822</a></span>
<span class=normal><a href=#__codelineno-0-823> 823</a></span>
<span class=normal><a href=#__codelineno-0-824> 824</a></span>
<span class=normal><a href=#__codelineno-0-825> 825</a></span>
<span class=normal><a href=#__codelineno-0-826> 826</a></span>
<span class=normal><a href=#__codelineno-0-827> 827</a></span>
<span class=normal><a href=#__codelineno-0-828> 828</a></span>
<span class=normal><a href=#__codelineno-0-829> 829</a></span>
<span class=normal><a href=#__codelineno-0-830> 830</a></span>
<span class=normal><a href=#__codelineno-0-831> 831</a></span>
<span class=normal><a href=#__codelineno-0-832> 832</a></span>
<span class=normal><a href=#__codelineno-0-833> 833</a></span>
<span class=normal><a href=#__codelineno-0-834> 834</a></span>
<span class=normal><a href=#__codelineno-0-835> 835</a></span>
<span class=normal><a href=#__codelineno-0-836> 836</a></span>
<span class=normal><a href=#__codelineno-0-837> 837</a></span>
<span class=normal><a href=#__codelineno-0-838> 838</a></span>
<span class=normal><a href=#__codelineno-0-839> 839</a></span>
<span class=normal><a href=#__codelineno-0-840> 840</a></span>
<span class=normal><a href=#__codelineno-0-841> 841</a></span>
<span class=normal><a href=#__codelineno-0-842> 842</a></span>
<span class=normal><a href=#__codelineno-0-843> 843</a></span>
<span class=normal><a href=#__codelineno-0-844> 844</a></span>
<span class=normal><a href=#__codelineno-0-845> 845</a></span>
<span class=normal><a href=#__codelineno-0-846> 846</a></span>
<span class=normal><a href=#__codelineno-0-847> 847</a></span>
<span class=normal><a href=#__codelineno-0-848> 848</a></span>
<span class=normal><a href=#__codelineno-0-849> 849</a></span>
<span class=normal><a href=#__codelineno-0-850> 850</a></span>
<span class=normal><a href=#__codelineno-0-851> 851</a></span>
<span class=normal><a href=#__codelineno-0-852> 852</a></span>
<span class=normal><a href=#__codelineno-0-853> 853</a></span>
<span class=normal><a href=#__codelineno-0-854> 854</a></span>
<span class=normal><a href=#__codelineno-0-855> 855</a></span>
<span class=normal><a href=#__codelineno-0-856> 856</a></span>
<span class=normal><a href=#__codelineno-0-857> 857</a></span>
<span class=normal><a href=#__codelineno-0-858> 858</a></span>
<span class=normal><a href=#__codelineno-0-859> 859</a></span>
<span class=normal><a href=#__codelineno-0-860> 860</a></span>
<span class=normal><a href=#__codelineno-0-861> 861</a></span>
<span class=normal><a href=#__codelineno-0-862> 862</a></span>
<span class=normal><a href=#__codelineno-0-863> 863</a></span>
<span class=normal><a href=#__codelineno-0-864> 864</a></span>
<span class=normal><a href=#__codelineno-0-865> 865</a></span>
<span class=normal><a href=#__codelineno-0-866> 866</a></span>
<span class=normal><a href=#__codelineno-0-867> 867</a></span>
<span class=normal><a href=#__codelineno-0-868> 868</a></span>
<span class=normal><a href=#__codelineno-0-869> 869</a></span>
<span class=normal><a href=#__codelineno-0-870> 870</a></span>
<span class=normal><a href=#__codelineno-0-871> 871</a></span>
<span class=normal><a href=#__codelineno-0-872> 872</a></span>
<span class=normal><a href=#__codelineno-0-873> 873</a></span>
<span class=normal><a href=#__codelineno-0-874> 874</a></span>
<span class=normal><a href=#__codelineno-0-875> 875</a></span>
<span class=normal><a href=#__codelineno-0-876> 876</a></span>
<span class=normal><a href=#__codelineno-0-877> 877</a></span>
<span class=normal><a href=#__codelineno-0-878> 878</a></span>
<span class=normal><a href=#__codelineno-0-879> 879</a></span>
<span class=normal><a href=#__codelineno-0-880> 880</a></span>
<span class=normal><a href=#__codelineno-0-881> 881</a></span>
<span class=normal><a href=#__codelineno-0-882> 882</a></span>
<span class=normal><a href=#__codelineno-0-883> 883</a></span>
<span class=normal><a href=#__codelineno-0-884> 884</a></span>
<span class=normal><a href=#__codelineno-0-885> 885</a></span>
<span class=normal><a href=#__codelineno-0-886> 886</a></span>
<span class=normal><a href=#__codelineno-0-887> 887</a></span>
<span class=normal><a href=#__codelineno-0-888> 888</a></span>
<span class=normal><a href=#__codelineno-0-889> 889</a></span>
<span class=normal><a href=#__codelineno-0-890> 890</a></span>
<span class=normal><a href=#__codelineno-0-891> 891</a></span>
<span class=normal><a href=#__codelineno-0-892> 892</a></span>
<span class=normal><a href=#__codelineno-0-893> 893</a></span>
<span class=normal><a href=#__codelineno-0-894> 894</a></span>
<span class=normal><a href=#__codelineno-0-895> 895</a></span>
<span class=normal><a href=#__codelineno-0-896> 896</a></span>
<span class=normal><a href=#__codelineno-0-897> 897</a></span>
<span class=normal><a href=#__codelineno-0-898> 898</a></span>
<span class=normal><a href=#__codelineno-0-899> 899</a></span>
<span class=normal><a href=#__codelineno-0-900> 900</a></span>
<span class=normal><a href=#__codelineno-0-901> 901</a></span>
<span class=normal><a href=#__codelineno-0-902> 902</a></span>
<span class=normal><a href=#__codelineno-0-903> 903</a></span>
<span class=normal><a href=#__codelineno-0-904> 904</a></span>
<span class=normal><a href=#__codelineno-0-905> 905</a></span>
<span class=normal><a href=#__codelineno-0-906> 906</a></span>
<span class=normal><a href=#__codelineno-0-907> 907</a></span>
<span class=normal><a href=#__codelineno-0-908> 908</a></span>
<span class=normal><a href=#__codelineno-0-909> 909</a></span>
<span class=normal><a href=#__codelineno-0-910> 910</a></span>
<span class=normal><a href=#__codelineno-0-911> 911</a></span>
<span class=normal><a href=#__codelineno-0-912> 912</a></span>
<span class=normal><a href=#__codelineno-0-913> 913</a></span>
<span class=normal><a href=#__codelineno-0-914> 914</a></span>
<span class=normal><a href=#__codelineno-0-915> 915</a></span>
<span class=normal><a href=#__codelineno-0-916> 916</a></span>
<span class=normal><a href=#__codelineno-0-917> 917</a></span>
<span class=normal><a href=#__codelineno-0-918> 918</a></span>
<span class=normal><a href=#__codelineno-0-919> 919</a></span>
<span class=normal><a href=#__codelineno-0-920> 920</a></span>
<span class=normal><a href=#__codelineno-0-921> 921</a></span>
<span class=normal><a href=#__codelineno-0-922> 922</a></span>
<span class=normal><a href=#__codelineno-0-923> 923</a></span>
<span class=normal><a href=#__codelineno-0-924> 924</a></span>
<span class=normal><a href=#__codelineno-0-925> 925</a></span>
<span class=normal><a href=#__codelineno-0-926> 926</a></span>
<span class=normal><a href=#__codelineno-0-927> 927</a></span>
<span class=normal><a href=#__codelineno-0-928> 928</a></span>
<span class=normal><a href=#__codelineno-0-929> 929</a></span>
<span class=normal><a href=#__codelineno-0-930> 930</a></span>
<span class=normal><a href=#__codelineno-0-931> 931</a></span>
<span class=normal><a href=#__codelineno-0-932> 932</a></span>
<span class=normal><a href=#__codelineno-0-933> 933</a></span>
<span class=normal><a href=#__codelineno-0-934> 934</a></span>
<span class=normal><a href=#__codelineno-0-935> 935</a></span>
<span class=normal><a href=#__codelineno-0-936> 936</a></span>
<span class=normal><a href=#__codelineno-0-937> 937</a></span>
<span class=normal><a href=#__codelineno-0-938> 938</a></span>
<span class=normal><a href=#__codelineno-0-939> 939</a></span>
<span class=normal><a href=#__codelineno-0-940> 940</a></span>
<span class=normal><a href=#__codelineno-0-941> 941</a></span>
<span class=normal><a href=#__codelineno-0-942> 942</a></span>
<span class=normal><a href=#__codelineno-0-943> 943</a></span>
<span class=normal><a href=#__codelineno-0-944> 944</a></span>
<span class=normal><a href=#__codelineno-0-945> 945</a></span>
<span class=normal><a href=#__codelineno-0-946> 946</a></span>
<span class=normal><a href=#__codelineno-0-947> 947</a></span>
<span class=normal><a href=#__codelineno-0-948> 948</a></span>
<span class=normal><a href=#__codelineno-0-949> 949</a></span>
<span class=normal><a href=#__codelineno-0-950> 950</a></span>
<span class=normal><a href=#__codelineno-0-951> 951</a></span>
<span class=normal><a href=#__codelineno-0-952> 952</a></span>
<span class=normal><a href=#__codelineno-0-953> 953</a></span>
<span class=normal><a href=#__codelineno-0-954> 954</a></span>
<span class=normal><a href=#__codelineno-0-955> 955</a></span>
<span class=normal><a href=#__codelineno-0-956> 956</a></span>
<span class=normal><a href=#__codelineno-0-957> 957</a></span>
<span class=normal><a href=#__codelineno-0-958> 958</a></span>
<span class=normal><a href=#__codelineno-0-959> 959</a></span>
<span class=normal><a href=#__codelineno-0-960> 960</a></span>
<span class=normal><a href=#__codelineno-0-961> 961</a></span>
<span class=normal><a href=#__codelineno-0-962> 962</a></span>
<span class=normal><a href=#__codelineno-0-963> 963</a></span>
<span class=normal><a href=#__codelineno-0-964> 964</a></span>
<span class=normal><a href=#__codelineno-0-965> 965</a></span>
<span class=normal><a href=#__codelineno-0-966> 966</a></span>
<span class=normal><a href=#__codelineno-0-967> 967</a></span>
<span class=normal><a href=#__codelineno-0-968> 968</a></span>
<span class=normal><a href=#__codelineno-0-969> 969</a></span>
<span class=normal><a href=#__codelineno-0-970> 970</a></span>
<span class=normal><a href=#__codelineno-0-971> 971</a></span>
<span class=normal><a href=#__codelineno-0-972> 972</a></span>
<span class=normal><a href=#__codelineno-0-973> 973</a></span>
<span class=normal><a href=#__codelineno-0-974> 974</a></span>
<span class=normal><a href=#__codelineno-0-975> 975</a></span>
<span class=normal><a href=#__codelineno-0-976> 976</a></span>
<span class=normal><a href=#__codelineno-0-977> 977</a></span>
<span class=normal><a href=#__codelineno-0-978> 978</a></span>
<span class=normal><a href=#__codelineno-0-979> 979</a></span>
<span class=normal><a href=#__codelineno-0-980> 980</a></span>
<span class=normal><a href=#__codelineno-0-981> 981</a></span>
<span class=normal><a href=#__codelineno-0-982> 982</a></span>
<span class=normal><a href=#__codelineno-0-983> 983</a></span>
<span class=normal><a href=#__codelineno-0-984> 984</a></span>
<span class=normal><a href=#__codelineno-0-985> 985</a></span>
<span class=normal><a href=#__codelineno-0-986> 986</a></span>
<span class=normal><a href=#__codelineno-0-987> 987</a></span>
<span class=normal><a href=#__codelineno-0-988> 988</a></span>
<span class=normal><a href=#__codelineno-0-989> 989</a></span>
<span class=normal><a href=#__codelineno-0-990> 990</a></span>
<span class=normal><a href=#__codelineno-0-991> 991</a></span>
<span class=normal><a href=#__codelineno-0-992> 992</a></span>
<span class=normal><a href=#__codelineno-0-993> 993</a></span>
<span class=normal><a href=#__codelineno-0-994> 994</a></span>
<span class=normal><a href=#__codelineno-0-995> 995</a></span>
<span class=normal><a href=#__codelineno-0-996> 996</a></span>
<span class=normal><a href=#__codelineno-0-997> 997</a></span>
<span class=normal><a href=#__codelineno-0-998> 998</a></span>
<span class=normal><a href=#__codelineno-0-999> 999</a></span>
<span class=normal><a href=#__codelineno-0-1000>1000</a></span>
<span class=normal><a href=#__codelineno-0-1001>1001</a></span>
<span class=normal><a href=#__codelineno-0-1002>1002</a></span>
<span class=normal><a href=#__codelineno-0-1003>1003</a></span>
<span class=normal><a href=#__codelineno-0-1004>1004</a></span>
<span class=normal><a href=#__codelineno-0-1005>1005</a></span>
<span class=normal><a href=#__codelineno-0-1006>1006</a></span>
<span class=normal><a href=#__codelineno-0-1007>1007</a></span>
<span class=normal><a href=#__codelineno-0-1008>1008</a></span>
<span class=normal><a href=#__codelineno-0-1009>1009</a></span>
<span class=normal><a href=#__codelineno-0-1010>1010</a></span>
<span class=normal><a href=#__codelineno-0-1011>1011</a></span>
<span class=normal><a href=#__codelineno-0-1012>1012</a></span>
<span class=normal><a href=#__codelineno-0-1013>1013</a></span>
<span class=normal><a href=#__codelineno-0-1014>1014</a></span>
<span class=normal><a href=#__codelineno-0-1015>1015</a></span>
<span class=normal><a href=#__codelineno-0-1016>1016</a></span>
<span class=normal><a href=#__codelineno-0-1017>1017</a></span>
<span class=normal><a href=#__codelineno-0-1018>1018</a></span>
<span class=normal><a href=#__codelineno-0-1019>1019</a></span>
<span class=normal><a href=#__codelineno-0-1020>1020</a></span>
<span class=normal><a href=#__codelineno-0-1021>1021</a></span>
<span class=normal><a href=#__codelineno-0-1022>1022</a></span>
<span class=normal><a href=#__codelineno-0-1023>1023</a></span>
<span class=normal><a href=#__codelineno-0-1024>1024</a></span>
<span class=normal><a href=#__codelineno-0-1025>1025</a></span>
<span class=normal><a href=#__codelineno-0-1026>1026</a></span>
<span class=normal><a href=#__codelineno-0-1027>1027</a></span>
<span class=normal><a href=#__codelineno-0-1028>1028</a></span>
<span class=normal><a href=#__codelineno-0-1029>1029</a></span>
<span class=normal><a href=#__codelineno-0-1030>1030</a></span>
<span class=normal><a href=#__codelineno-0-1031>1031</a></span>
<span class=normal><a href=#__codelineno-0-1032>1032</a></span>
<span class=normal><a href=#__codelineno-0-1033>1033</a></span>
<span class=normal><a href=#__codelineno-0-1034>1034</a></span>
<span class=normal><a href=#__codelineno-0-1035>1035</a></span>
<span class=normal><a href=#__codelineno-0-1036>1036</a></span>
<span class=normal><a href=#__codelineno-0-1037>1037</a></span>
<span class=normal><a href=#__codelineno-0-1038>1038</a></span>
<span class=normal><a href=#__codelineno-0-1039>1039</a></span>
<span class=normal><a href=#__codelineno-0-1040>1040</a></span>
<span class=normal><a href=#__codelineno-0-1041>1041</a></span>
<span class=normal><a href=#__codelineno-0-1042>1042</a></span>
<span class=normal><a href=#__codelineno-0-1043>1043</a></span>
<span class=normal><a href=#__codelineno-0-1044>1044</a></span>
<span class=normal><a href=#__codelineno-0-1045>1045</a></span>
<span class=normal><a href=#__codelineno-0-1046>1046</a></span>
<span class=normal><a href=#__codelineno-0-1047>1047</a></span>
<span class=normal><a href=#__codelineno-0-1048>1048</a></span>
<span class=normal><a href=#__codelineno-0-1049>1049</a></span>
<span class=normal><a href=#__codelineno-0-1050>1050</a></span>
<span class=normal><a href=#__codelineno-0-1051>1051</a></span>
<span class=normal><a href=#__codelineno-0-1052>1052</a></span>
<span class=normal><a href=#__codelineno-0-1053>1053</a></span>
<span class=normal><a href=#__codelineno-0-1054>1054</a></span>
<span class=normal><a href=#__codelineno-0-1055>1055</a></span>
<span class=normal><a href=#__codelineno-0-1056>1056</a></span>
<span class=normal><a href=#__codelineno-0-1057>1057</a></span>
<span class=normal><a href=#__codelineno-0-1058>1058</a></span>
<span class=normal><a href=#__codelineno-0-1059>1059</a></span>
<span class=normal><a href=#__codelineno-0-1060>1060</a></span>
<span class=normal><a href=#__codelineno-0-1061>1061</a></span>
<span class=normal><a href=#__codelineno-0-1062>1062</a></span>
<span class=normal><a href=#__codelineno-0-1063>1063</a></span>
<span class=normal><a href=#__codelineno-0-1064>1064</a></span>
<span class=normal><a href=#__codelineno-0-1065>1065</a></span>
<span class=normal><a href=#__codelineno-0-1066>1066</a></span>
<span class=normal><a href=#__codelineno-0-1067>1067</a></span>
<span class=normal><a href=#__codelineno-0-1068>1068</a></span>
<span class=normal><a href=#__codelineno-0-1069>1069</a></span>
<span class=normal><a href=#__codelineno-0-1070>1070</a></span>
<span class=normal><a href=#__codelineno-0-1071>1071</a></span>
<span class=normal><a href=#__codelineno-0-1072>1072</a></span>
<span class=normal><a href=#__codelineno-0-1073>1073</a></span>
<span class=normal><a href=#__codelineno-0-1074>1074</a></span>
<span class=normal><a href=#__codelineno-0-1075>1075</a></span>
<span class=normal><a href=#__codelineno-0-1076>1076</a></span>
<span class=normal><a href=#__codelineno-0-1077>1077</a></span>
<span class=normal><a href=#__codelineno-0-1078>1078</a></span>
<span class=normal><a href=#__codelineno-0-1079>1079</a></span>
<span class=normal><a href=#__codelineno-0-1080>1080</a></span>
<span class=normal><a href=#__codelineno-0-1081>1081</a></span>
<span class=normal><a href=#__codelineno-0-1082>1082</a></span>
<span class=normal><a href=#__codelineno-0-1083>1083</a></span>
<span class=normal><a href=#__codelineno-0-1084>1084</a></span>
<span class=normal><a href=#__codelineno-0-1085>1085</a></span>
<span class=normal><a href=#__codelineno-0-1086>1086</a></span>
<span class=normal><a href=#__codelineno-0-1087>1087</a></span>
<span class=normal><a href=#__codelineno-0-1088>1088</a></span>
<span class=normal><a href=#__codelineno-0-1089>1089</a></span>
<span class=normal><a href=#__codelineno-0-1090>1090</a></span>
<span class=normal><a href=#__codelineno-0-1091>1091</a></span>
<span class=normal><a href=#__codelineno-0-1092>1092</a></span>
<span class=normal><a href=#__codelineno-0-1093>1093</a></span>
<span class=normal><a href=#__codelineno-0-1094>1094</a></span>
<span class=normal><a href=#__codelineno-0-1095>1095</a></span>
<span class=normal><a href=#__codelineno-0-1096>1096</a></span>
<span class=normal><a href=#__codelineno-0-1097>1097</a></span>
<span class=normal><a href=#__codelineno-0-1098>1098</a></span>
<span class=normal><a href=#__codelineno-0-1099>1099</a></span>
<span class=normal><a href=#__codelineno-0-1100>1100</a></span>
<span class=normal><a href=#__codelineno-0-1101>1101</a></span>
<span class=normal><a href=#__codelineno-0-1102>1102</a></span>
<span class=normal><a href=#__codelineno-0-1103>1103</a></span>
<span class=normal><a href=#__codelineno-0-1104>1104</a></span>
<span class=normal><a href=#__codelineno-0-1105>1105</a></span>
<span class=normal><a href=#__codelineno-0-1106>1106</a></span>
<span class=normal><a href=#__codelineno-0-1107>1107</a></span>
<span class=normal><a href=#__codelineno-0-1108>1108</a></span>
<span class=normal><a href=#__codelineno-0-1109>1109</a></span>
<span class=normal><a href=#__codelineno-0-1110>1110</a></span>
<span class=normal><a href=#__codelineno-0-1111>1111</a></span>
<span class=normal><a href=#__codelineno-0-1112>1112</a></span>
<span class=normal><a href=#__codelineno-0-1113>1113</a></span>
<span class=normal><a href=#__codelineno-0-1114>1114</a></span>
<span class=normal><a href=#__codelineno-0-1115>1115</a></span>
<span class=normal><a href=#__codelineno-0-1116>1116</a></span>
<span class=normal><a href=#__codelineno-0-1117>1117</a></span>
<span class=normal><a href=#__codelineno-0-1118>1118</a></span>
<span class=normal><a href=#__codelineno-0-1119>1119</a></span>
<span class=normal><a href=#__codelineno-0-1120>1120</a></span>
<span class=normal><a href=#__codelineno-0-1121>1121</a></span>
<span class=normal><a href=#__codelineno-0-1122>1122</a></span>
<span class=normal><a href=#__codelineno-0-1123>1123</a></span>
<span class=normal><a href=#__codelineno-0-1124>1124</a></span>
<span class=normal><a href=#__codelineno-0-1125>1125</a></span>
<span class=normal><a href=#__codelineno-0-1126>1126</a></span>
<span class=normal><a href=#__codelineno-0-1127>1127</a></span>
<span class=normal><a href=#__codelineno-0-1128>1128</a></span>
<span class=normal><a href=#__codelineno-0-1129>1129</a></span>
<span class=normal><a href=#__codelineno-0-1130>1130</a></span>
<span class=normal><a href=#__codelineno-0-1131>1131</a></span>
<span class=normal><a href=#__codelineno-0-1132>1132</a></span>
<span class=normal><a href=#__codelineno-0-1133>1133</a></span>
<span class=normal><a href=#__codelineno-0-1134>1134</a></span>
<span class=normal><a href=#__codelineno-0-1135>1135</a></span>
<span class=normal><a href=#__codelineno-0-1136>1136</a></span>
<span class=normal><a href=#__codelineno-0-1137>1137</a></span>
<span class=normal><a href=#__codelineno-0-1138>1138</a></span>
<span class=normal><a href=#__codelineno-0-1139>1139</a></span>
<span class=normal><a href=#__codelineno-0-1140>1140</a></span>
<span class=normal><a href=#__codelineno-0-1141>1141</a></span>
<span class=normal><a href=#__codelineno-0-1142>1142</a></span>
<span class=normal><a href=#__codelineno-0-1143>1143</a></span>
<span class=normal><a href=#__codelineno-0-1144>1144</a></span>
<span class=normal><a href=#__codelineno-0-1145>1145</a></span>
<span class=normal><a href=#__codelineno-0-1146>1146</a></span>
<span class=normal><a href=#__codelineno-0-1147>1147</a></span>
<span class=normal><a href=#__codelineno-0-1148>1148</a></span>
<span class=normal><a href=#__codelineno-0-1149>1149</a></span>
<span class=normal><a href=#__codelineno-0-1150>1150</a></span>
<span class=normal><a href=#__codelineno-0-1151>1151</a></span>
<span class=normal><a href=#__codelineno-0-1152>1152</a></span>
<span class=normal><a href=#__codelineno-0-1153>1153</a></span>
<span class=normal><a href=#__codelineno-0-1154>1154</a></span>
<span class=normal><a href=#__codelineno-0-1155>1155</a></span>
<span class=normal><a href=#__codelineno-0-1156>1156</a></span>
<span class=normal><a href=#__codelineno-0-1157>1157</a></span>
<span class=normal><a href=#__codelineno-0-1158>1158</a></span>
<span class=normal><a href=#__codelineno-0-1159>1159</a></span>
<span class=normal><a href=#__codelineno-0-1160>1160</a></span>
<span class=normal><a href=#__codelineno-0-1161>1161</a></span>
<span class=normal><a href=#__codelineno-0-1162>1162</a></span>
<span class=normal><a href=#__codelineno-0-1163>1163</a></span>
<span class=normal><a href=#__codelineno-0-1164>1164</a></span>
<span class=normal><a href=#__codelineno-0-1165>1165</a></span>
<span class=normal><a href=#__codelineno-0-1166>1166</a></span>
<span class=normal><a href=#__codelineno-0-1167>1167</a></span>
<span class=normal><a href=#__codelineno-0-1168>1168</a></span>
<span class=normal><a href=#__codelineno-0-1169>1169</a></span>
<span class=normal><a href=#__codelineno-0-1170>1170</a></span>
<span class=normal><a href=#__codelineno-0-1171>1171</a></span>
<span class=normal><a href=#__codelineno-0-1172>1172</a></span>
<span class=normal><a href=#__codelineno-0-1173>1173</a></span>
<span class=normal><a href=#__codelineno-0-1174>1174</a></span>
<span class=normal><a href=#__codelineno-0-1175>1175</a></span>
<span class=normal><a href=#__codelineno-0-1176>1176</a></span>
<span class=normal><a href=#__codelineno-0-1177>1177</a></span>
<span class=normal><a href=#__codelineno-0-1178>1178</a></span>
<span class=normal><a href=#__codelineno-0-1179>1179</a></span>
<span class=normal><a href=#__codelineno-0-1180>1180</a></span>
<span class=normal><a href=#__codelineno-0-1181>1181</a></span>
<span class=normal><a href=#__codelineno-0-1182>1182</a></span>
<span class=normal><a href=#__codelineno-0-1183>1183</a></span>
<span class=normal><a href=#__codelineno-0-1184>1184</a></span>
<span class=normal><a href=#__codelineno-0-1185>1185</a></span>
<span class=normal><a href=#__codelineno-0-1186>1186</a></span>
<span class=normal><a href=#__codelineno-0-1187>1187</a></span>
<span class=normal><a href=#__codelineno-0-1188>1188</a></span>
<span class=normal><a href=#__codelineno-0-1189>1189</a></span>
<span class=normal><a href=#__codelineno-0-1190>1190</a></span>
<span class=normal><a href=#__codelineno-0-1191>1191</a></span>
<span class=normal><a href=#__codelineno-0-1192>1192</a></span>
<span class=normal><a href=#__codelineno-0-1193>1193</a></span>
<span class=normal><a href=#__codelineno-0-1194>1194</a></span>
<span class=normal><a href=#__codelineno-0-1195>1195</a></span>
<span class=normal><a href=#__codelineno-0-1196>1196</a></span>
<span class=normal><a href=#__codelineno-0-1197>1197</a></span>
<span class=normal><a href=#__codelineno-0-1198>1198</a></span>
<span class=normal><a href=#__codelineno-0-1199>1199</a></span>
<span class=normal><a href=#__codelineno-0-1200>1200</a></span>
<span class=normal><a href=#__codelineno-0-1201>1201</a></span>
<span class=normal><a href=#__codelineno-0-1202>1202</a></span>
<span class=normal><a href=#__codelineno-0-1203>1203</a></span>
<span class=normal><a href=#__codelineno-0-1204>1204</a></span>
<span class=normal><a href=#__codelineno-0-1205>1205</a></span>
<span class=normal><a href=#__codelineno-0-1206>1206</a></span>
<span class=normal><a href=#__codelineno-0-1207>1207</a></span>
<span class=normal><a href=#__codelineno-0-1208>1208</a></span>
<span class=normal><a href=#__codelineno-0-1209>1209</a></span>
<span class=normal><a href=#__codelineno-0-1210>1210</a></span>
<span class=normal><a href=#__codelineno-0-1211>1211</a></span>
<span class=normal><a href=#__codelineno-0-1212>1212</a></span>
<span class=normal><a href=#__codelineno-0-1213>1213</a></span>
<span class=normal><a href=#__codelineno-0-1214>1214</a></span>
<span class=normal><a href=#__codelineno-0-1215>1215</a></span>
<span class=normal><a href=#__codelineno-0-1216>1216</a></span>
<span class=normal><a href=#__codelineno-0-1217>1217</a></span>
<span class=normal><a href=#__codelineno-0-1218>1218</a></span>
<span class=normal><a href=#__codelineno-0-1219>1219</a></span>
<span class=normal><a href=#__codelineno-0-1220>1220</a></span>
<span class=normal><a href=#__codelineno-0-1221>1221</a></span>
<span class=normal><a href=#__codelineno-0-1222>1222</a></span>
<span class=normal><a href=#__codelineno-0-1223>1223</a></span>
<span class=normal><a href=#__codelineno-0-1224>1224</a></span>
<span class=normal><a href=#__codelineno-0-1225>1225</a></span>
<span class=normal><a href=#__codelineno-0-1226>1226</a></span>
<span class=normal><a href=#__codelineno-0-1227>1227</a></span>
<span class=normal><a href=#__codelineno-0-1228>1228</a></span>
<span class=normal><a href=#__codelineno-0-1229>1229</a></span>
<span class=normal><a href=#__codelineno-0-1230>1230</a></span>
<span class=normal><a href=#__codelineno-0-1231>1231</a></span>
<span class=normal><a href=#__codelineno-0-1232>1232</a></span>
<span class=normal><a href=#__codelineno-0-1233>1233</a></span>
<span class=normal><a href=#__codelineno-0-1234>1234</a></span>
<span class=normal><a href=#__codelineno-0-1235>1235</a></span>
<span class=normal><a href=#__codelineno-0-1236>1236</a></span>
<span class=normal><a href=#__codelineno-0-1237>1237</a></span>
<span class=normal><a href=#__codelineno-0-1238>1238</a></span>
<span class=normal><a href=#__codelineno-0-1239>1239</a></span>
<span class=normal><a href=#__codelineno-0-1240>1240</a></span>
<span class=normal><a href=#__codelineno-0-1241>1241</a></span>
<span class=normal><a href=#__codelineno-0-1242>1242</a></span>
<span class=normal><a href=#__codelineno-0-1243>1243</a></span>
<span class=normal><a href=#__codelineno-0-1244>1244</a></span>
<span class=normal><a href=#__codelineno-0-1245>1245</a></span>
<span class=normal><a href=#__codelineno-0-1246>1246</a></span>
<span class=normal><a href=#__codelineno-0-1247>1247</a></span>
<span class=normal><a href=#__codelineno-0-1248>1248</a></span>
<span class=normal><a href=#__codelineno-0-1249>1249</a></span>
<span class=normal><a href=#__codelineno-0-1250>1250</a></span>
<span class=normal><a href=#__codelineno-0-1251>1251</a></span>
<span class=normal><a href=#__codelineno-0-1252>1252</a></span>
<span class=normal><a href=#__codelineno-0-1253>1253</a></span>
<span class=normal><a href=#__codelineno-0-1254>1254</a></span>
<span class=normal><a href=#__codelineno-0-1255>1255</a></span>
<span class=normal><a href=#__codelineno-0-1256>1256</a></span>
<span class=normal><a href=#__codelineno-0-1257>1257</a></span>
<span class=normal><a href=#__codelineno-0-1258>1258</a></span>
<span class=normal><a href=#__codelineno-0-1259>1259</a></span>
<span class=normal><a href=#__codelineno-0-1260>1260</a></span>
<span class=normal><a href=#__codelineno-0-1261>1261</a></span>
<span class=normal><a href=#__codelineno-0-1262>1262</a></span>
<span class=normal><a href=#__codelineno-0-1263>1263</a></span>
<span class=normal><a href=#__codelineno-0-1264>1264</a></span>
<span class=normal><a href=#__codelineno-0-1265>1265</a></span>
<span class=normal><a href=#__codelineno-0-1266>1266</a></span>
<span class=normal><a href=#__codelineno-0-1267>1267</a></span>
<span class=normal><a href=#__codelineno-0-1268>1268</a></span>
<span class=normal><a href=#__codelineno-0-1269>1269</a></span>
<span class=normal><a href=#__codelineno-0-1270>1270</a></span>
<span class=normal><a href=#__codelineno-0-1271>1271</a></span>
<span class=normal><a href=#__codelineno-0-1272>1272</a></span>
<span class=normal><a href=#__codelineno-0-1273>1273</a></span>
<span class=normal><a href=#__codelineno-0-1274>1274</a></span>
<span class=normal><a href=#__codelineno-0-1275>1275</a></span>
<span class=normal><a href=#__codelineno-0-1276>1276</a></span>
<span class=normal><a href=#__codelineno-0-1277>1277</a></span>
<span class=normal><a href=#__codelineno-0-1278>1278</a></span>
<span class=normal><a href=#__codelineno-0-1279>1279</a></span>
<span class=normal><a href=#__codelineno-0-1280>1280</a></span>
<span class=normal><a href=#__codelineno-0-1281>1281</a></span>
<span class=normal><a href=#__codelineno-0-1282>1282</a></span>
<span class=normal><a href=#__codelineno-0-1283>1283</a></span>
<span class=normal><a href=#__codelineno-0-1284>1284</a></span>
<span class=normal><a href=#__codelineno-0-1285>1285</a></span>
<span class=normal><a href=#__codelineno-0-1286>1286</a></span>
<span class=normal><a href=#__codelineno-0-1287>1287</a></span>
<span class=normal><a href=#__codelineno-0-1288>1288</a></span>
<span class=normal><a href=#__codelineno-0-1289>1289</a></span>
<span class=normal><a href=#__codelineno-0-1290>1290</a></span>
<span class=normal><a href=#__codelineno-0-1291>1291</a></span>
<span class=normal><a href=#__codelineno-0-1292>1292</a></span>
<span class=normal><a href=#__codelineno-0-1293>1293</a></span>
<span class=normal><a href=#__codelineno-0-1294>1294</a></span>
<span class=normal><a href=#__codelineno-0-1295>1295</a></span>
<span class=normal><a href=#__codelineno-0-1296>1296</a></span>
<span class=normal><a href=#__codelineno-0-1297>1297</a></span>
<span class=normal><a href=#__codelineno-0-1298>1298</a></span>
<span class=normal><a href=#__codelineno-0-1299>1299</a></span>
<span class=normal><a href=#__codelineno-0-1300>1300</a></span>
<span class=normal><a href=#__codelineno-0-1301>1301</a></span>
<span class=normal><a href=#__codelineno-0-1302>1302</a></span>
<span class=normal><a href=#__codelineno-0-1303>1303</a></span>
<span class=normal><a href=#__codelineno-0-1304>1304</a></span>
<span class=normal><a href=#__codelineno-0-1305>1305</a></span>
<span class=normal><a href=#__codelineno-0-1306>1306</a></span>
<span class=normal><a href=#__codelineno-0-1307>1307</a></span>
<span class=normal><a href=#__codelineno-0-1308>1308</a></span>
<span class=normal><a href=#__codelineno-0-1309>1309</a></span>
<span class=normal><a href=#__codelineno-0-1310>1310</a></span>
<span class=normal><a href=#__codelineno-0-1311>1311</a></span>
<span class=normal><a href=#__codelineno-0-1312>1312</a></span>
<span class=normal><a href=#__codelineno-0-1313>1313</a></span>
<span class=normal><a href=#__codelineno-0-1314>1314</a></span>
<span class=normal><a href=#__codelineno-0-1315>1315</a></span>
<span class=normal><a href=#__codelineno-0-1316>1316</a></span>
<span class=normal><a href=#__codelineno-0-1317>1317</a></span>
<span class=normal><a href=#__codelineno-0-1318>1318</a></span>
<span class=normal><a href=#__codelineno-0-1319>1319</a></span>
<span class=normal><a href=#__codelineno-0-1320>1320</a></span>
<span class=normal><a href=#__codelineno-0-1321>1321</a></span>
<span class=normal><a href=#__codelineno-0-1322>1322</a></span>
<span class=normal><a href=#__codelineno-0-1323>1323</a></span>
<span class=normal><a href=#__codelineno-0-1324>1324</a></span>
<span class=normal><a href=#__codelineno-0-1325>1325</a></span>
<span class=normal><a href=#__codelineno-0-1326>1326</a></span>
<span class=normal><a href=#__codelineno-0-1327>1327</a></span>
<span class=normal><a href=#__codelineno-0-1328>1328</a></span>
<span class=normal><a href=#__codelineno-0-1329>1329</a></span>
<span class=normal><a href=#__codelineno-0-1330>1330</a></span>
<span class=normal><a href=#__codelineno-0-1331>1331</a></span>
<span class=normal><a href=#__codelineno-0-1332>1332</a></span>
<span class=normal><a href=#__codelineno-0-1333>1333</a></span>
<span class=normal><a href=#__codelineno-0-1334>1334</a></span>
<span class=normal><a href=#__codelineno-0-1335>1335</a></span>
<span class=normal><a href=#__codelineno-0-1336>1336</a></span>
<span class=normal><a href=#__codelineno-0-1337>1337</a></span>
<span class=normal><a href=#__codelineno-0-1338>1338</a></span>
<span class=normal><a href=#__codelineno-0-1339>1339</a></span>
<span class=normal><a href=#__codelineno-0-1340>1340</a></span>
<span class=normal><a href=#__codelineno-0-1341>1341</a></span>
<span class=normal><a href=#__codelineno-0-1342>1342</a></span>
<span class=normal><a href=#__codelineno-0-1343>1343</a></span>
<span class=normal><a href=#__codelineno-0-1344>1344</a></span>
<span class=normal><a href=#__codelineno-0-1345>1345</a></span>
<span class=normal><a href=#__codelineno-0-1346>1346</a></span>
<span class=normal><a href=#__codelineno-0-1347>1347</a></span>
<span class=normal><a href=#__codelineno-0-1348>1348</a></span>
<span class=normal><a href=#__codelineno-0-1349>1349</a></span>
<span class=normal><a href=#__codelineno-0-1350>1350</a></span>
<span class=normal><a href=#__codelineno-0-1351>1351</a></span>
<span class=normal><a href=#__codelineno-0-1352>1352</a></span>
<span class=normal><a href=#__codelineno-0-1353>1353</a></span>
<span class=normal><a href=#__codelineno-0-1354>1354</a></span>
<span class=normal><a href=#__codelineno-0-1355>1355</a></span>
<span class=normal><a href=#__codelineno-0-1356>1356</a></span>
<span class=normal><a href=#__codelineno-0-1357>1357</a></span>
<span class=normal><a href=#__codelineno-0-1358>1358</a></span>
<span class=normal><a href=#__codelineno-0-1359>1359</a></span>
<span class=normal><a href=#__codelineno-0-1360>1360</a></span>
<span class=normal><a href=#__codelineno-0-1361>1361</a></span>
<span class=normal><a href=#__codelineno-0-1362>1362</a></span>
<span class=normal><a href=#__codelineno-0-1363>1363</a></span>
<span class=normal><a href=#__codelineno-0-1364>1364</a></span>
<span class=normal><a href=#__codelineno-0-1365>1365</a></span>
<span class=normal><a href=#__codelineno-0-1366>1366</a></span>
<span class=normal><a href=#__codelineno-0-1367>1367</a></span>
<span class=normal><a href=#__codelineno-0-1368>1368</a></span>
<span class=normal><a href=#__codelineno-0-1369>1369</a></span>
<span class=normal><a href=#__codelineno-0-1370>1370</a></span>
<span class=normal><a href=#__codelineno-0-1371>1371</a></span>
<span class=normal><a href=#__codelineno-0-1372>1372</a></span>
<span class=normal><a href=#__codelineno-0-1373>1373</a></span>
<span class=normal><a href=#__codelineno-0-1374>1374</a></span>
<span class=normal><a href=#__codelineno-0-1375>1375</a></span>
<span class=normal><a href=#__codelineno-0-1376>1376</a></span>
<span class=normal><a href=#__codelineno-0-1377>1377</a></span>
<span class=normal><a href=#__codelineno-0-1378>1378</a></span>
<span class=normal><a href=#__codelineno-0-1379>1379</a></span>
<span class=normal><a href=#__codelineno-0-1380>1380</a></span>
<span class=normal><a href=#__codelineno-0-1381>1381</a></span>
<span class=normal><a href=#__codelineno-0-1382>1382</a></span>
<span class=normal><a href=#__codelineno-0-1383>1383</a></span>
<span class=normal><a href=#__codelineno-0-1384>1384</a></span>
<span class=normal><a href=#__codelineno-0-1385>1385</a></span>
<span class=normal><a href=#__codelineno-0-1386>1386</a></span>
<span class=normal><a href=#__codelineno-0-1387>1387</a></span>
<span class=normal><a href=#__codelineno-0-1388>1388</a></span>
<span class=normal><a href=#__codelineno-0-1389>1389</a></span>
<span class=normal><a href=#__codelineno-0-1390>1390</a></span>
<span class=normal><a href=#__codelineno-0-1391>1391</a></span>
<span class=normal><a href=#__codelineno-0-1392>1392</a></span>
<span class=normal><a href=#__codelineno-0-1393>1393</a></span>
<span class=normal><a href=#__codelineno-0-1394>1394</a></span>
<span class=normal><a href=#__codelineno-0-1395>1395</a></span>
<span class=normal><a href=#__codelineno-0-1396>1396</a></span>
<span class=normal><a href=#__codelineno-0-1397>1397</a></span>
<span class=normal><a href=#__codelineno-0-1398>1398</a></span>
<span class=normal><a href=#__codelineno-0-1399>1399</a></span>
<span class=normal><a href=#__codelineno-0-1400>1400</a></span>
<span class=normal><a href=#__codelineno-0-1401>1401</a></span>
<span class=normal><a href=#__codelineno-0-1402>1402</a></span>
<span class=normal><a href=#__codelineno-0-1403>1403</a></span>
<span class=normal><a href=#__codelineno-0-1404>1404</a></span>
<span class=normal><a href=#__codelineno-0-1405>1405</a></span>
<span class=normal><a href=#__codelineno-0-1406>1406</a></span>
<span class=normal><a href=#__codelineno-0-1407>1407</a></span>
<span class=normal><a href=#__codelineno-0-1408>1408</a></span>
<span class=normal><a href=#__codelineno-0-1409>1409</a></span>
<span class=normal><a href=#__codelineno-0-1410>1410</a></span>
<span class=normal><a href=#__codelineno-0-1411>1411</a></span>
<span class=normal><a href=#__codelineno-0-1412>1412</a></span>
<span class=normal><a href=#__codelineno-0-1413>1413</a></span>
<span class=normal><a href=#__codelineno-0-1414>1414</a></span>
<span class=normal><a href=#__codelineno-0-1415>1415</a></span>
<span class=normal><a href=#__codelineno-0-1416>1416</a></span>
<span class=normal><a href=#__codelineno-0-1417>1417</a></span>
<span class=normal><a href=#__codelineno-0-1418>1418</a></span>
<span class=normal><a href=#__codelineno-0-1419>1419</a></span>
<span class=normal><a href=#__codelineno-0-1420>1420</a></span>
<span class=normal><a href=#__codelineno-0-1421>1421</a></span>
<span class=normal><a href=#__codelineno-0-1422>1422</a></span>
<span class=normal><a href=#__codelineno-0-1423>1423</a></span>
<span class=normal><a href=#__codelineno-0-1424>1424</a></span>
<span class=normal><a href=#__codelineno-0-1425>1425</a></span>
<span class=normal><a href=#__codelineno-0-1426>1426</a></span>
<span class=normal><a href=#__codelineno-0-1427>1427</a></span>
<span class=normal><a href=#__codelineno-0-1428>1428</a></span>
<span class=normal><a href=#__codelineno-0-1429>1429</a></span>
<span class=normal><a href=#__codelineno-0-1430>1430</a></span>
<span class=normal><a href=#__codelineno-0-1431>1431</a></span>
<span class=normal><a href=#__codelineno-0-1432>1432</a></span>
<span class=normal><a href=#__codelineno-0-1433>1433</a></span>
<span class=normal><a href=#__codelineno-0-1434>1434</a></span>
<span class=normal><a href=#__codelineno-0-1435>1435</a></span>
<span class=normal><a href=#__codelineno-0-1436>1436</a></span>
<span class=normal><a href=#__codelineno-0-1437>1437</a></span>
<span class=normal><a href=#__codelineno-0-1438>1438</a></span>
<span class=normal><a href=#__codelineno-0-1439>1439</a></span>
<span class=normal><a href=#__codelineno-0-1440>1440</a></span>
<span class=normal><a href=#__codelineno-0-1441>1441</a></span>
<span class=normal><a href=#__codelineno-0-1442>1442</a></span>
<span class=normal><a href=#__codelineno-0-1443>1443</a></span>
<span class=normal><a href=#__codelineno-0-1444>1444</a></span>
<span class=normal><a href=#__codelineno-0-1445>1445</a></span>
<span class=normal><a href=#__codelineno-0-1446>1446</a></span>
<span class=normal><a href=#__codelineno-0-1447>1447</a></span>
<span class=normal><a href=#__codelineno-0-1448>1448</a></span>
<span class=normal><a href=#__codelineno-0-1449>1449</a></span>
<span class=normal><a href=#__codelineno-0-1450>1450</a></span>
<span class=normal><a href=#__codelineno-0-1451>1451</a></span>
<span class=normal><a href=#__codelineno-0-1452>1452</a></span>
<span class=normal><a href=#__codelineno-0-1453>1453</a></span>
<span class=normal><a href=#__codelineno-0-1454>1454</a></span>
<span class=normal><a href=#__codelineno-0-1455>1455</a></span>
<span class=normal><a href=#__codelineno-0-1456>1456</a></span>
<span class=normal><a href=#__codelineno-0-1457>1457</a></span>
<span class=normal><a href=#__codelineno-0-1458>1458</a></span>
<span class=normal><a href=#__codelineno-0-1459>1459</a></span>
<span class=normal><a href=#__codelineno-0-1460>1460</a></span>
<span class=normal><a href=#__codelineno-0-1461>1461</a></span>
<span class=normal><a href=#__codelineno-0-1462>1462</a></span>
<span class=normal><a href=#__codelineno-0-1463>1463</a></span>
<span class=normal><a href=#__codelineno-0-1464>1464</a></span>
<span class=normal><a href=#__codelineno-0-1465>1465</a></span>
<span class=normal><a href=#__codelineno-0-1466>1466</a></span>
<span class=normal><a href=#__codelineno-0-1467>1467</a></span>
<span class=normal><a href=#__codelineno-0-1468>1468</a></span>
<span class=normal><a href=#__codelineno-0-1469>1469</a></span>
<span class=normal><a href=#__codelineno-0-1470>1470</a></span>
<span class=normal><a href=#__codelineno-0-1471>1471</a></span>
<span class=normal><a href=#__codelineno-0-1472>1472</a></span>
<span class=normal><a href=#__codelineno-0-1473>1473</a></span>
<span class=normal><a href=#__codelineno-0-1474>1474</a></span>
<span class=normal><a href=#__codelineno-0-1475>1475</a></span>
<span class=normal><a href=#__codelineno-0-1476>1476</a></span>
<span class=normal><a href=#__codelineno-0-1477>1477</a></span>
<span class=normal><a href=#__codelineno-0-1478>1478</a></span>
<span class=normal><a href=#__codelineno-0-1479>1479</a></span>
<span class=normal><a href=#__codelineno-0-1480>1480</a></span>
<span class=normal><a href=#__codelineno-0-1481>1481</a></span>
<span class=normal><a href=#__codelineno-0-1482>1482</a></span>
<span class=normal><a href=#__codelineno-0-1483>1483</a></span>
<span class=normal><a href=#__codelineno-0-1484>1484</a></span>
<span class=normal><a href=#__codelineno-0-1485>1485</a></span>
<span class=normal><a href=#__codelineno-0-1486>1486</a></span>
<span class=normal><a href=#__codelineno-0-1487>1487</a></span>
<span class=normal><a href=#__codelineno-0-1488>1488</a></span>
<span class=normal><a href=#__codelineno-0-1489>1489</a></span>
<span class=normal><a href=#__codelineno-0-1490>1490</a></span>
<span class=normal><a href=#__codelineno-0-1491>1491</a></span>
<span class=normal><a href=#__codelineno-0-1492>1492</a></span>
<span class=normal><a href=#__codelineno-0-1493>1493</a></span>
<span class=normal><a href=#__codelineno-0-1494>1494</a></span>
<span class=normal><a href=#__codelineno-0-1495>1495</a></span>
<span class=normal><a href=#__codelineno-0-1496>1496</a></span>
<span class=normal><a href=#__codelineno-0-1497>1497</a></span>
<span class=normal><a href=#__codelineno-0-1498>1498</a></span>
<span class=normal><a href=#__codelineno-0-1499>1499</a></span>
<span class=normal><a href=#__codelineno-0-1500>1500</a></span>
<span class=normal><a href=#__codelineno-0-1501>1501</a></span>
<span class=normal><a href=#__codelineno-0-1502>1502</a></span>
<span class=normal><a href=#__codelineno-0-1503>1503</a></span>
<span class=normal><a href=#__codelineno-0-1504>1504</a></span>
<span class=normal><a href=#__codelineno-0-1505>1505</a></span>
<span class=normal><a href=#__codelineno-0-1506>1506</a></span>
<span class=normal><a href=#__codelineno-0-1507>1507</a></span>
<span class=normal><a href=#__codelineno-0-1508>1508</a></span>
<span class=normal><a href=#__codelineno-0-1509>1509</a></span>
<span class=normal><a href=#__codelineno-0-1510>1510</a></span>
<span class=normal><a href=#__codelineno-0-1511>1511</a></span>
<span class=normal><a href=#__codelineno-0-1512>1512</a></span>
<span class=normal><a href=#__codelineno-0-1513>1513</a></span>
<span class=normal><a href=#__codelineno-0-1514>1514</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-99><a id=__codelineno-0-99 name=__codelineno-0-99></a><span class=k>class</span><span class=w> </span><span class=nc>Environment</span><span class=p>(</span><span class=nb>object</span><span class=p>):</span>
</span><span id=__span-0-100><a id=__codelineno-0-100 name=__codelineno-0-100></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span>  <span class=c1># noqa: D107</span>
</span><span id=__span-0-101><a id=__codelineno-0-101 name=__codelineno-0-101></a>        <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-102><a id=__codelineno-0-102 name=__codelineno-0-102></a>        <span class=n>path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-103><a id=__codelineno-0-103 name=__codelineno-0-103></a>        <span class=n>agents</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Agent</span><span class=p>],</span>
</span><span id=__span-0-104><a id=__codelineno-0-104 name=__codelineno-0-104></a>        <span class=n>client</span><span class=p>:</span> <span class=n>InferenceClient</span><span class=p>,</span>
</span><span id=__span-0-105><a id=__codelineno-0-105 name=__codelineno-0-105></a>        <span class=n>hub_client</span><span class=p>:</span> <span class=n>OpenAI</span><span class=p>,</span>
</span><span id=__span-0-106><a id=__codelineno-0-106 name=__codelineno-0-106></a>        <span class=n>thread_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-107><a id=__codelineno-0-107 name=__codelineno-0-107></a>        <span class=n>run_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-108><a id=__codelineno-0-108 name=__codelineno-0-108></a>        <span class=n>create_files</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-109><a id=__codelineno-0-109 name=__codelineno-0-109></a>        <span class=n>env_vars</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-110><a id=__codelineno-0-110 name=__codelineno-0-110></a>        <span class=n>tool_resources</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-111><a id=__codelineno-0-111 name=__codelineno-0-111></a>        <span class=n>print_system_log</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-112><a id=__codelineno-0-112 name=__codelineno-0-112></a>        <span class=n>agent_runner_user</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-113><a id=__codelineno-0-113 name=__codelineno-0-113></a>        <span class=n>fastnear_api_key</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-114><a id=__codelineno-0-114 name=__codelineno-0-114></a>        <span class=n>approvals</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-115><a id=__codelineno-0-115 name=__codelineno-0-115></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-116><a id=__codelineno-0-116 name=__codelineno-0-116></a>        <span class=c1># Warning: never expose `client` or `_hub_client` to agent&#39;s environment</span>
</span><span id=__span-0-117><a id=__codelineno-0-117 name=__codelineno-0-117></a>
</span><span id=__span-0-118><a id=__codelineno-0-118 name=__codelineno-0-118></a>        <span class=bp>self</span><span class=o>.</span><span class=n>base_url</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>base_url</span>
</span><span id=__span-0-119><a id=__codelineno-0-119 name=__codelineno-0-119></a>
</span><span id=__span-0-120><a id=__codelineno-0-120 name=__codelineno-0-120></a>        <span class=c1># user_auth is used to authenticate the user in the ts_runner. It will be removed after that in</span>
</span><span id=__span-0-121><a id=__codelineno-0-121 name=__codelineno-0-121></a>        <span class=c1># `nearai/agents/agent.py`</span>
</span><span id=__span-0-122><a id=__codelineno-0-122 name=__codelineno-0-122></a>        <span class=bp>self</span><span class=o>.</span><span class=n>user_auth</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>_auth</span>
</span><span id=__span-0-123><a id=__codelineno-0-123 name=__codelineno-0-123></a>
</span><span id=__span-0-124><a id=__codelineno-0-124 name=__codelineno-0-124></a>        <span class=c1># Placeholder for solver</span>
</span><span id=__span-0-125><a id=__codelineno-0-125 name=__codelineno-0-125></a>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>InferenceClient</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-126><a id=__codelineno-0-126 name=__codelineno-0-126></a>
</span><span id=__span-0-127><a id=__codelineno-0-127 name=__codelineno-0-127></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_path</span> <span class=o>=</span> <span class=n>path</span>
</span><span id=__span-0-128><a id=__codelineno-0-128 name=__codelineno-0-128></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_agents</span> <span class=o>=</span> <span class=n>agents</span>
</span><span id=__span-0-129><a id=__codelineno-0-129 name=__codelineno-0-129></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_done</span> <span class=o>=</span> <span class=kc>False</span>
</span><span id=__span-0-130><a id=__codelineno-0-130 name=__codelineno-0-130></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_pending_ext_agent</span> <span class=o>=</span> <span class=kc>False</span>
</span><span id=__span-0-131><a id=__codelineno-0-131 name=__codelineno-0-131></a>        <span class=bp>self</span><span class=o>.</span><span class=n>env_vars</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=n>env_vars</span> <span class=k>if</span> <span class=n>env_vars</span> <span class=k>else</span> <span class=p>{}</span>
</span><span id=__span-0-132><a id=__codelineno-0-132 name=__codelineno-0-132></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_last_used_model</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-133><a id=__codelineno-0-133 name=__codelineno-0-133></a>        <span class=bp>self</span><span class=o>.</span><span class=n>tool_resources</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=n>tool_resources</span> <span class=k>if</span> <span class=n>tool_resources</span> <span class=k>else</span> <span class=p>{}</span>
</span><span id=__span-0-134><a id=__codelineno-0-134 name=__codelineno-0-134></a>        <span class=bp>self</span><span class=o>.</span><span class=n>print_system_log</span> <span class=o>=</span> <span class=n>print_system_log</span>
</span><span id=__span-0-135><a id=__codelineno-0-135 name=__codelineno-0-135></a>        <span class=bp>self</span><span class=o>.</span><span class=n>agent_runner_user</span> <span class=o>=</span> <span class=n>agent_runner_user</span>
</span><span id=__span-0-136><a id=__codelineno-0-136 name=__codelineno-0-136></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_approvals</span> <span class=o>=</span> <span class=n>approvals</span> <span class=k>if</span> <span class=n>approvals</span> <span class=k>else</span> <span class=n>default_approvals</span>
</span><span id=__span-0-137><a id=__codelineno-0-137 name=__codelineno-0-137></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_thread_id</span> <span class=o>=</span> <span class=n>thread_id</span>
</span><span id=__span-0-138><a id=__codelineno-0-138 name=__codelineno-0-138></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_run_id</span> <span class=o>=</span> <span class=n>run_id</span>
</span><span id=__span-0-139><a id=__codelineno-0-139 name=__codelineno-0-139></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_debug_mode</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=nb>any</span><span class=p>(</span>
</span><span id=__span-0-140><a id=__codelineno-0-140 name=__codelineno-0-140></a>            <span class=nb>str</span><span class=p>(</span><span class=n>value</span><span class=p>)</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=ow>in</span> <span class=p>(</span><span class=s2>&quot;true&quot;</span><span class=p>,</span> <span class=s2>&quot;1&quot;</span><span class=p>,</span> <span class=s2>&quot;yes&quot;</span><span class=p>,</span> <span class=s2>&quot;on&quot;</span><span class=p>)</span>
</span><span id=__span-0-141><a id=__codelineno-0-141 name=__codelineno-0-141></a>            <span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>env_vars</span><span class=o>.</span><span class=n>items</span><span class=p>()</span>
</span><span id=__span-0-142><a id=__codelineno-0-142 name=__codelineno-0-142></a>            <span class=k>if</span> <span class=n>key</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=o>==</span> <span class=s2>&quot;debug&quot;</span>
</span><span id=__span-0-143><a id=__codelineno-0-143 name=__codelineno-0-143></a>        <span class=p>)</span>
</span><span id=__span-0-144><a id=__codelineno-0-144 name=__codelineno-0-144></a>        <span class=c1># Expose the NEAR account_id of a user that signs this request to run an agent.</span>
</span><span id=__span-0-145><a id=__codelineno-0-145 name=__codelineno-0-145></a>        <span class=bp>self</span><span class=o>.</span><span class=n>signer_account_id</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>auth</span><span class=o>.</span><span class=n>account_id</span> <span class=k>if</span> <span class=n>client</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>auth</span> <span class=k>else</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-146><a id=__codelineno-0-146 name=__codelineno-0-146></a>
</span><span id=__span-0-147><a id=__codelineno-0-147 name=__codelineno-0-147></a>        <span class=k>if</span> <span class=n>fastnear_api_key</span><span class=p>:</span>
</span><span id=__span-0-148><a id=__codelineno-0-148 name=__codelineno-0-148></a>            <span class=n>default_mainnet_rpc</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;https://rpc.mainnet.fastnear.com?apiKey=</span><span class=si>{</span><span class=n>fastnear_api_key</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-149><a id=__codelineno-0-149 name=__codelineno-0-149></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-150><a id=__codelineno-0-150 name=__codelineno-0-150></a>            <span class=n>default_mainnet_rpc</span> <span class=o>=</span> <span class=s2>&quot;https://rpc.mainnet.near.org&quot;</span>
</span><span id=__span-0-151><a id=__codelineno-0-151 name=__codelineno-0-151></a>
</span><span id=__span-0-152><a id=__codelineno-0-152 name=__codelineno-0-152></a>        <span class=k>class</span><span class=w> </span><span class=nc>NearAccount</span><span class=p>(</span><span class=n>Account</span><span class=p>):</span>
</span><span id=__span-0-153><a id=__codelineno-0-153 name=__codelineno-0-153></a>            <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>view</span><span class=p>(</span>
</span><span id=__span-0-154><a id=__codelineno-0-154 name=__codelineno-0-154></a>                <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-155><a id=__codelineno-0-155 name=__codelineno-0-155></a>                <span class=n>contract_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-156><a id=__codelineno-0-156 name=__codelineno-0-156></a>                <span class=n>method_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-157><a id=__codelineno-0-157 name=__codelineno-0-157></a>                <span class=n>args</span><span class=p>:</span> <span class=nb>dict</span><span class=p>,</span>
</span><span id=__span-0-158><a id=__codelineno-0-158 name=__codelineno-0-158></a>                <span class=n>block_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-159><a id=__codelineno-0-159 name=__codelineno-0-159></a>                <span class=n>threshold</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-160><a id=__codelineno-0-160 name=__codelineno-0-160></a>                <span class=n>max_retries</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>3</span><span class=p>,</span>
</span><span id=__span-0-161><a id=__codelineno-0-161 name=__codelineno-0-161></a>            <span class=p>):</span>
</span><span id=__span-0-162><a id=__codelineno-0-162 name=__codelineno-0-162></a><span class=w>                </span><span class=sd>&quot;&quot;&quot;Wrapper for the view method of the Account class, adding multiple retry attempts.</span>
</span><span id=__span-0-163><a id=__codelineno-0-163 name=__codelineno-0-163></a>
</span><span id=__span-0-164><a id=__codelineno-0-164 name=__codelineno-0-164></a><span class=sd>                Parameters</span>
</span><span id=__span-0-165><a id=__codelineno-0-165 name=__codelineno-0-165></a><span class=sd>                ----------</span>
</span><span id=__span-0-166><a id=__codelineno-0-166 name=__codelineno-0-166></a><span class=sd>                contract_id : str</span>
</span><span id=__span-0-167><a id=__codelineno-0-167 name=__codelineno-0-167></a><span class=sd>                    The ID of the contract to call.</span>
</span><span id=__span-0-168><a id=__codelineno-0-168 name=__codelineno-0-168></a><span class=sd>                method_name : str</span>
</span><span id=__span-0-169><a id=__codelineno-0-169 name=__codelineno-0-169></a><span class=sd>                    The name of the method to invoke on the contract.</span>
</span><span id=__span-0-170><a id=__codelineno-0-170 name=__codelineno-0-170></a><span class=sd>                args : dict</span>
</span><span id=__span-0-171><a id=__codelineno-0-171 name=__codelineno-0-171></a><span class=sd>                    The arguments to pass to the contract method.</span>
</span><span id=__span-0-172><a id=__codelineno-0-172 name=__codelineno-0-172></a><span class=sd>                block_id : Optional[int]</span>
</span><span id=__span-0-173><a id=__codelineno-0-173 name=__codelineno-0-173></a><span class=sd>                    The block ID to query at.</span>
</span><span id=__span-0-174><a id=__codelineno-0-174 name=__codelineno-0-174></a><span class=sd>                threshold : Optional[int]</span>
</span><span id=__span-0-175><a id=__codelineno-0-175 name=__codelineno-0-175></a><span class=sd>                    The threshold for the view function.</span>
</span><span id=__span-0-176><a id=__codelineno-0-176 name=__codelineno-0-176></a><span class=sd>                max_retries : int</span>
</span><span id=__span-0-177><a id=__codelineno-0-177 name=__codelineno-0-177></a><span class=sd>                    The maximum number of retry attempts.</span>
</span><span id=__span-0-178><a id=__codelineno-0-178 name=__codelineno-0-178></a>
</span><span id=__span-0-179><a id=__codelineno-0-179 name=__codelineno-0-179></a><span class=sd>                Returns</span>
</span><span id=__span-0-180><a id=__codelineno-0-180 name=__codelineno-0-180></a><span class=sd>                -------</span>
</span><span id=__span-0-181><a id=__codelineno-0-181 name=__codelineno-0-181></a><span class=sd>                The result of the contract method call.</span>
</span><span id=__span-0-182><a id=__codelineno-0-182 name=__codelineno-0-182></a>
</span><span id=__span-0-183><a id=__codelineno-0-183 name=__codelineno-0-183></a><span class=sd>                Raises</span>
</span><span id=__span-0-184><a id=__codelineno-0-184 name=__codelineno-0-184></a><span class=sd>                ------</span>
</span><span id=__span-0-185><a id=__codelineno-0-185 name=__codelineno-0-185></a><span class=sd>                Exception</span>
</span><span id=__span-0-186><a id=__codelineno-0-186 name=__codelineno-0-186></a><span class=sd>                    If all retry attempts fail, the exception is propagated.</span>
</span><span id=__span-0-187><a id=__codelineno-0-187 name=__codelineno-0-187></a>
</span><span id=__span-0-188><a id=__codelineno-0-188 name=__codelineno-0-188></a><span class=sd>                &quot;&quot;&quot;</span>
</span><span id=__span-0-189><a id=__codelineno-0-189 name=__codelineno-0-189></a>                <span class=n>acc</span> <span class=o>=</span> <span class=n>Account</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>account_id</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>private_key</span><span class=p>,</span> <span class=n>default_mainnet_rpc</span><span class=p>)</span>
</span><span id=__span-0-190><a id=__codelineno-0-190 name=__codelineno-0-190></a>                <span class=k>await</span> <span class=n>acc</span><span class=o>.</span><span class=n>startup</span><span class=p>()</span>
</span><span id=__span-0-191><a id=__codelineno-0-191 name=__codelineno-0-191></a>                <span class=n>max_retries</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=n>max_retries</span><span class=p>,</span> <span class=mi>10</span><span class=p>)</span>
</span><span id=__span-0-192><a id=__codelineno-0-192 name=__codelineno-0-192></a>
</span><span id=__span-0-193><a id=__codelineno-0-193 name=__codelineno-0-193></a>                <span class=k>for</span> <span class=n>attempt</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>max_retries</span> <span class=o>+</span> <span class=mi>1</span><span class=p>):</span>
</span><span id=__span-0-194><a id=__codelineno-0-194 name=__codelineno-0-194></a>                    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-195><a id=__codelineno-0-195 name=__codelineno-0-195></a>                        <span class=c1># Attempt to read the contract view method</span>
</span><span id=__span-0-196><a id=__codelineno-0-196 name=__codelineno-0-196></a>                        <span class=k>return</span> <span class=k>await</span> <span class=n>acc</span><span class=o>.</span><span class=n>view_function</span><span class=p>(</span><span class=n>contract_id</span><span class=p>,</span> <span class=n>method_name</span><span class=p>,</span> <span class=n>args</span><span class=p>,</span> <span class=n>block_id</span><span class=p>,</span> <span class=n>threshold</span><span class=p>)</span>
</span><span id=__span-0-197><a id=__codelineno-0-197 name=__codelineno-0-197></a>                    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-198><a id=__codelineno-0-198 name=__codelineno-0-198></a>                        <span class=c1># Log the error message for the current attempt</span>
</span><span id=__span-0-199><a id=__codelineno-0-199 name=__codelineno-0-199></a>                        <span class=nb>print</span><span class=p>(</span>
</span><span id=__span-0-200><a id=__codelineno-0-200 name=__codelineno-0-200></a>                            <span class=sa>f</span><span class=s2>&quot;Attempt </span><span class=si>{</span><span class=n>attempt</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>max_retries</span><span class=si>}</span><span class=s2> to view method &#39;</span><span class=si>{</span><span class=n>method_name</span><span class=si>}</span><span class=s2>&#39; on contract &quot;</span>
</span><span id=__span-0-201><a id=__codelineno-0-201 name=__codelineno-0-201></a>                            <span class=sa>f</span><span class=s2>&quot;&#39;</span><span class=si>{</span><span class=n>contract_id</span><span class=si>}</span><span class=s2>&#39; failed with error: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-202><a id=__codelineno-0-202 name=__codelineno-0-202></a>                        <span class=p>)</span>
</span><span id=__span-0-203><a id=__codelineno-0-203 name=__codelineno-0-203></a>
</span><span id=__span-0-204><a id=__codelineno-0-204 name=__codelineno-0-204></a>                        <span class=c1># If it&#39;s the last attempt, re-raise the exception</span>
</span><span id=__span-0-205><a id=__codelineno-0-205 name=__codelineno-0-205></a>                        <span class=k>if</span> <span class=n>attempt</span> <span class=o>==</span> <span class=n>max_retries</span><span class=p>:</span>
</span><span id=__span-0-206><a id=__codelineno-0-206 name=__codelineno-0-206></a>                            <span class=k>raise</span>
</span><span id=__span-0-207><a id=__codelineno-0-207 name=__codelineno-0-207></a>
</span><span id=__span-0-208><a id=__codelineno-0-208 name=__codelineno-0-208></a>            <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>call</span><span class=p>(</span>
</span><span id=__span-0-209><a id=__codelineno-0-209 name=__codelineno-0-209></a>                <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-210><a id=__codelineno-0-210 name=__codelineno-0-210></a>                <span class=n>contract_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-211><a id=__codelineno-0-211 name=__codelineno-0-211></a>                <span class=n>method_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-212><a id=__codelineno-0-212 name=__codelineno-0-212></a>                <span class=n>args</span><span class=p>:</span> <span class=nb>dict</span><span class=p>,</span>
</span><span id=__span-0-213><a id=__codelineno-0-213 name=__codelineno-0-213></a>                <span class=n>gas</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>DEFAULT_ATTACHED_GAS</span><span class=p>,</span>
</span><span id=__span-0-214><a id=__codelineno-0-214 name=__codelineno-0-214></a>                <span class=n>amount</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span>
</span><span id=__span-0-215><a id=__codelineno-0-215 name=__codelineno-0-215></a>                <span class=n>nowait</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-216><a id=__codelineno-0-216 name=__codelineno-0-216></a>                <span class=n>included</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-217><a id=__codelineno-0-217 name=__codelineno-0-217></a>                <span class=n>max_retries</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>1</span><span class=p>,</span>
</span><span id=__span-0-218><a id=__codelineno-0-218 name=__codelineno-0-218></a>            <span class=p>):</span>
</span><span id=__span-0-219><a id=__codelineno-0-219 name=__codelineno-0-219></a><span class=w>                </span><span class=sd>&quot;&quot;&quot;Wrapper for the call method of the Account class, adding multiple retry attempts.</span>
</span><span id=__span-0-220><a id=__codelineno-0-220 name=__codelineno-0-220></a>
</span><span id=__span-0-221><a id=__codelineno-0-221 name=__codelineno-0-221></a><span class=sd>                Parameters</span>
</span><span id=__span-0-222><a id=__codelineno-0-222 name=__codelineno-0-222></a><span class=sd>                ----------</span>
</span><span id=__span-0-223><a id=__codelineno-0-223 name=__codelineno-0-223></a><span class=sd>                contract_id : str</span>
</span><span id=__span-0-224><a id=__codelineno-0-224 name=__codelineno-0-224></a><span class=sd>                    The ID of the contract to call.</span>
</span><span id=__span-0-225><a id=__codelineno-0-225 name=__codelineno-0-225></a><span class=sd>                method_name : str</span>
</span><span id=__span-0-226><a id=__codelineno-0-226 name=__codelineno-0-226></a><span class=sd>                    The name of the method to invoke on the contract.</span>
</span><span id=__span-0-227><a id=__codelineno-0-227 name=__codelineno-0-227></a><span class=sd>                args : dict</span>
</span><span id=__span-0-228><a id=__codelineno-0-228 name=__codelineno-0-228></a><span class=sd>                    The arguments to pass to the contract method.</span>
</span><span id=__span-0-229><a id=__codelineno-0-229 name=__codelineno-0-229></a><span class=sd>                gas : int</span>
</span><span id=__span-0-230><a id=__codelineno-0-230 name=__codelineno-0-230></a><span class=sd>                    The amount of gas to attach to the call.</span>
</span><span id=__span-0-231><a id=__codelineno-0-231 name=__codelineno-0-231></a><span class=sd>                amount : int</span>
</span><span id=__span-0-232><a id=__codelineno-0-232 name=__codelineno-0-232></a><span class=sd>                    The amount of tokens to attach to the call.</span>
</span><span id=__span-0-233><a id=__codelineno-0-233 name=__codelineno-0-233></a><span class=sd>                nowait : bool</span>
</span><span id=__span-0-234><a id=__codelineno-0-234 name=__codelineno-0-234></a><span class=sd>                    If True, do not wait for the transaction to be confirmed.</span>
</span><span id=__span-0-235><a id=__codelineno-0-235 name=__codelineno-0-235></a><span class=sd>                included : bool</span>
</span><span id=__span-0-236><a id=__codelineno-0-236 name=__codelineno-0-236></a><span class=sd>                    If True, include the transaction in the block.</span>
</span><span id=__span-0-237><a id=__codelineno-0-237 name=__codelineno-0-237></a><span class=sd>                max_retries : int</span>
</span><span id=__span-0-238><a id=__codelineno-0-238 name=__codelineno-0-238></a><span class=sd>                    The maximum number of retry attempts.</span>
</span><span id=__span-0-239><a id=__codelineno-0-239 name=__codelineno-0-239></a>
</span><span id=__span-0-240><a id=__codelineno-0-240 name=__codelineno-0-240></a><span class=sd>                Returns</span>
</span><span id=__span-0-241><a id=__codelineno-0-241 name=__codelineno-0-241></a><span class=sd>                -------</span>
</span><span id=__span-0-242><a id=__codelineno-0-242 name=__codelineno-0-242></a><span class=sd>                The result of the contract method call.</span>
</span><span id=__span-0-243><a id=__codelineno-0-243 name=__codelineno-0-243></a>
</span><span id=__span-0-244><a id=__codelineno-0-244 name=__codelineno-0-244></a><span class=sd>                Raises</span>
</span><span id=__span-0-245><a id=__codelineno-0-245 name=__codelineno-0-245></a><span class=sd>                ------</span>
</span><span id=__span-0-246><a id=__codelineno-0-246 name=__codelineno-0-246></a><span class=sd>                Exception</span>
</span><span id=__span-0-247><a id=__codelineno-0-247 name=__codelineno-0-247></a><span class=sd>                    If all retry attempts fail, the exception is propagated.</span>
</span><span id=__span-0-248><a id=__codelineno-0-248 name=__codelineno-0-248></a>
</span><span id=__span-0-249><a id=__codelineno-0-249 name=__codelineno-0-249></a><span class=sd>                &quot;&quot;&quot;</span>
</span><span id=__span-0-250><a id=__codelineno-0-250 name=__codelineno-0-250></a>                <span class=n>acc</span> <span class=o>=</span> <span class=n>Account</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>account_id</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>private_key</span><span class=p>,</span> <span class=n>default_mainnet_rpc</span><span class=p>)</span>
</span><span id=__span-0-251><a id=__codelineno-0-251 name=__codelineno-0-251></a>                <span class=k>await</span> <span class=n>acc</span><span class=o>.</span><span class=n>startup</span><span class=p>()</span>
</span><span id=__span-0-252><a id=__codelineno-0-252 name=__codelineno-0-252></a>                <span class=n>max_retries</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=n>max_retries</span><span class=p>,</span> <span class=mi>10</span><span class=p>)</span>
</span><span id=__span-0-253><a id=__codelineno-0-253 name=__codelineno-0-253></a>
</span><span id=__span-0-254><a id=__codelineno-0-254 name=__codelineno-0-254></a>                <span class=k>for</span> <span class=n>attempt</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>max_retries</span> <span class=o>+</span> <span class=mi>1</span><span class=p>):</span>
</span><span id=__span-0-255><a id=__codelineno-0-255 name=__codelineno-0-255></a>                    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-256><a id=__codelineno-0-256 name=__codelineno-0-256></a>                        <span class=c1># Attempt to call the contract method</span>
</span><span id=__span-0-257><a id=__codelineno-0-257 name=__codelineno-0-257></a>                        <span class=k>return</span> <span class=k>await</span> <span class=n>acc</span><span class=o>.</span><span class=n>function_call</span><span class=p>(</span><span class=n>contract_id</span><span class=p>,</span> <span class=n>method_name</span><span class=p>,</span> <span class=n>args</span><span class=p>,</span> <span class=n>gas</span><span class=p>,</span> <span class=n>amount</span><span class=p>,</span> <span class=n>nowait</span><span class=p>,</span> <span class=n>included</span><span class=p>)</span>
</span><span id=__span-0-258><a id=__codelineno-0-258 name=__codelineno-0-258></a>                    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-259><a id=__codelineno-0-259 name=__codelineno-0-259></a>                        <span class=c1># Log the error message for the current attempt</span>
</span><span id=__span-0-260><a id=__codelineno-0-260 name=__codelineno-0-260></a>                        <span class=nb>print</span><span class=p>(</span>
</span><span id=__span-0-261><a id=__codelineno-0-261 name=__codelineno-0-261></a>                            <span class=sa>f</span><span class=s2>&quot;Attempt </span><span class=si>{</span><span class=n>attempt</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>max_retries</span><span class=si>}</span><span class=s2> to call method &#39;</span><span class=si>{</span><span class=n>method_name</span><span class=si>}</span><span class=s2>&#39; on contract &quot;</span>
</span><span id=__span-0-262><a id=__codelineno-0-262 name=__codelineno-0-262></a>                            <span class=sa>f</span><span class=s2>&quot;&#39;</span><span class=si>{</span><span class=n>contract_id</span><span class=si>}</span><span class=s2>&#39; failed with error: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-263><a id=__codelineno-0-263 name=__codelineno-0-263></a>                        <span class=p>)</span>
</span><span id=__span-0-264><a id=__codelineno-0-264 name=__codelineno-0-264></a>
</span><span id=__span-0-265><a id=__codelineno-0-265 name=__codelineno-0-265></a>                        <span class=c1># If it&#39;s the last attempt, re-raise the exception</span>
</span><span id=__span-0-266><a id=__codelineno-0-266 name=__codelineno-0-266></a>                        <span class=k>if</span> <span class=n>attempt</span> <span class=o>==</span> <span class=n>max_retries</span><span class=p>:</span>
</span><span id=__span-0-267><a id=__codelineno-0-267 name=__codelineno-0-267></a>                            <span class=k>raise</span>
</span><span id=__span-0-268><a id=__codelineno-0-268 name=__codelineno-0-268></a>
</span><span id=__span-0-269><a id=__codelineno-0-269 name=__codelineno-0-269></a>            <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>get_balance</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>account_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span>
</span><span id=__span-0-270><a id=__codelineno-0-270 name=__codelineno-0-270></a><span class=w>                </span><span class=sd>&quot;&quot;&quot;Retrieves the balance of the specified NEAR account.</span>
</span><span id=__span-0-271><a id=__codelineno-0-271 name=__codelineno-0-271></a>
</span><span id=__span-0-272><a id=__codelineno-0-272 name=__codelineno-0-272></a><span class=sd>                Parameters</span>
</span><span id=__span-0-273><a id=__codelineno-0-273 name=__codelineno-0-273></a><span class=sd>                ----------</span>
</span><span id=__span-0-274><a id=__codelineno-0-274 name=__codelineno-0-274></a><span class=sd>                account_id : Optional[str]</span>
</span><span id=__span-0-275><a id=__codelineno-0-275 name=__codelineno-0-275></a><span class=sd>                    The ID of the account to retrieve the balance for. If not provided, the balance of the current</span>
</span><span id=__span-0-276><a id=__codelineno-0-276 name=__codelineno-0-276></a><span class=sd>                    account is retrieved.</span>
</span><span id=__span-0-277><a id=__codelineno-0-277 name=__codelineno-0-277></a>
</span><span id=__span-0-278><a id=__codelineno-0-278 name=__codelineno-0-278></a><span class=sd>                Returns</span>
</span><span id=__span-0-279><a id=__codelineno-0-279 name=__codelineno-0-279></a><span class=sd>                -------</span>
</span><span id=__span-0-280><a id=__codelineno-0-280 name=__codelineno-0-280></a><span class=sd>                int</span>
</span><span id=__span-0-281><a id=__codelineno-0-281 name=__codelineno-0-281></a><span class=sd>                    The balance of the specified account in yoctoNEAR.</span>
</span><span id=__span-0-282><a id=__codelineno-0-282 name=__codelineno-0-282></a>
</span><span id=__span-0-283><a id=__codelineno-0-283 name=__codelineno-0-283></a><span class=sd>                Raises</span>
</span><span id=__span-0-284><a id=__codelineno-0-284 name=__codelineno-0-284></a><span class=sd>                ------</span>
</span><span id=__span-0-285><a id=__codelineno-0-285 name=__codelineno-0-285></a><span class=sd>                Exception</span>
</span><span id=__span-0-286><a id=__codelineno-0-286 name=__codelineno-0-286></a><span class=sd>                    If there is an error retrieving the balance.</span>
</span><span id=__span-0-287><a id=__codelineno-0-287 name=__codelineno-0-287></a>
</span><span id=__span-0-288><a id=__codelineno-0-288 name=__codelineno-0-288></a><span class=sd>                &quot;&quot;&quot;</span>
</span><span id=__span-0-289><a id=__codelineno-0-289 name=__codelineno-0-289></a>                <span class=n>acc</span> <span class=o>=</span> <span class=n>Account</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>account_id</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>private_key</span><span class=p>,</span> <span class=n>default_mainnet_rpc</span><span class=p>)</span>
</span><span id=__span-0-290><a id=__codelineno-0-290 name=__codelineno-0-290></a>                <span class=k>await</span> <span class=n>acc</span><span class=o>.</span><span class=n>startup</span><span class=p>()</span>
</span><span id=__span-0-291><a id=__codelineno-0-291 name=__codelineno-0-291></a>                <span class=k>return</span> <span class=k>await</span> <span class=n>acc</span><span class=o>.</span><span class=n>get_balance</span><span class=p>(</span><span class=n>account_id</span><span class=p>)</span>
</span><span id=__span-0-292><a id=__codelineno-0-292 name=__codelineno-0-292></a>
</span><span id=__span-0-293><a id=__codelineno-0-293 name=__codelineno-0-293></a>            <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span>
</span><span id=__span-0-294><a id=__codelineno-0-294 name=__codelineno-0-294></a>                <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-295><a id=__codelineno-0-295 name=__codelineno-0-295></a>                <span class=n>account_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-296><a id=__codelineno-0-296 name=__codelineno-0-296></a>                <span class=n>private_key</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Union</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>bytes</span><span class=p>]],</span> <span class=nb>str</span><span class=p>,</span> <span class=nb>bytes</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-297><a id=__codelineno-0-297 name=__codelineno-0-297></a>                <span class=n>rpc_addr</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-298><a id=__codelineno-0-298 name=__codelineno-0-298></a>            <span class=p>):</span>
</span><span id=__span-0-299><a id=__codelineno-0-299 name=__codelineno-0-299></a>                <span class=bp>self</span><span class=o>.</span><span class=n>account_id</span> <span class=o>=</span> <span class=n>account_id</span>
</span><span id=__span-0-300><a id=__codelineno-0-300 name=__codelineno-0-300></a>                <span class=bp>self</span><span class=o>.</span><span class=n>private_key</span> <span class=o>=</span> <span class=n>private_key</span>
</span><span id=__span-0-301><a id=__codelineno-0-301 name=__codelineno-0-301></a>                <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>account_id</span><span class=p>,</span> <span class=n>private_key</span><span class=p>,</span> <span class=n>rpc_addr</span><span class=p>)</span>
</span><span id=__span-0-302><a id=__codelineno-0-302 name=__codelineno-0-302></a>
</span><span id=__span-0-303><a id=__codelineno-0-303 name=__codelineno-0-303></a>        <span class=bp>self</span><span class=o>.</span><span class=n>set_near</span> <span class=o>=</span> <span class=n>NearAccount</span>
</span><span id=__span-0-304><a id=__codelineno-0-304 name=__codelineno-0-304></a>
</span><span id=__span-0-305><a id=__codelineno-0-305 name=__codelineno-0-305></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_tools</span> <span class=o>=</span> <span class=n>ToolRegistry</span><span class=p>()</span>
</span><span id=__span-0-306><a id=__codelineno-0-306 name=__codelineno-0-306></a>
</span><span id=__span-0-307><a id=__codelineno-0-307 name=__codelineno-0-307></a>        <span class=k>if</span> <span class=n>create_files</span><span class=p>:</span>
</span><span id=__span-0-308><a id=__codelineno-0-308 name=__codelineno-0-308></a>            <span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_path</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-309><a id=__codelineno-0-309 name=__codelineno-0-309></a>            <span class=nb>open</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_path</span><span class=p>,</span> <span class=n>CHAT_FILENAME</span><span class=p>),</span> <span class=s2>&quot;a&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span><span id=__span-0-310><a id=__codelineno-0-310 name=__codelineno-0-310></a>        <span class=n>os</span><span class=o>.</span><span class=n>chdir</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_path</span><span class=p>)</span>
</span><span id=__span-0-311><a id=__codelineno-0-311 name=__codelineno-0-311></a>
</span><span id=__span-0-312><a id=__codelineno-0-312 name=__codelineno-0-312></a>        <span class=c1># Protected client methods</span>
</span><span id=__span-0-313><a id=__codelineno-0-313 name=__codelineno-0-313></a>        <span class=k>def</span><span class=w> </span><span class=nf>query_vector_store</span><span class=p>(</span><span class=n>vector_store_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>query</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>full_files</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>):</span>
</span><span id=__span-0-314><a id=__codelineno-0-314 name=__codelineno-0-314></a><span class=w>            </span><span class=sd>&quot;&quot;&quot;Queries a vector store.</span>
</span><span id=__span-0-315><a id=__codelineno-0-315 name=__codelineno-0-315></a>
</span><span id=__span-0-316><a id=__codelineno-0-316 name=__codelineno-0-316></a><span class=sd>            vector_store_id: The id of the vector store to query.</span>
</span><span id=__span-0-317><a id=__codelineno-0-317 name=__codelineno-0-317></a><span class=sd>            query: The query to search for.</span>
</span><span id=__span-0-318><a id=__codelineno-0-318 name=__codelineno-0-318></a><span class=sd>            &quot;&quot;&quot;</span>
</span><span id=__span-0-319><a id=__codelineno-0-319 name=__codelineno-0-319></a>            <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>query_vector_store</span><span class=p>(</span><span class=n>vector_store_id</span><span class=p>,</span> <span class=n>query</span><span class=p>,</span> <span class=n>full_files</span><span class=p>)</span>
</span><span id=__span-0-320><a id=__codelineno-0-320 name=__codelineno-0-320></a>
</span><span id=__span-0-321><a id=__codelineno-0-321 name=__codelineno-0-321></a>        <span class=bp>self</span><span class=o>.</span><span class=n>query_vector_store</span> <span class=o>=</span> <span class=n>query_vector_store</span>
</span><span id=__span-0-322><a id=__codelineno-0-322 name=__codelineno-0-322></a>
</span><span id=__span-0-323><a id=__codelineno-0-323 name=__codelineno-0-323></a>        <span class=k>def</span><span class=w> </span><span class=nf>upload_file</span><span class=p>(</span>
</span><span id=__span-0-324><a id=__codelineno-0-324 name=__codelineno-0-324></a>            <span class=n>file_content</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-325><a id=__codelineno-0-325 name=__codelineno-0-325></a>            <span class=n>purpose</span><span class=p>:</span> <span class=n>Literal</span><span class=p>[</span><span class=s2>&quot;assistants&quot;</span><span class=p>,</span> <span class=s2>&quot;batch&quot;</span><span class=p>,</span> <span class=s2>&quot;fine-tune&quot;</span><span class=p>,</span> <span class=s2>&quot;vision&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;assistants&quot;</span><span class=p>,</span>
</span><span id=__span-0-326><a id=__codelineno-0-326 name=__codelineno-0-326></a>            <span class=n>encoding</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;utf-8&quot;</span><span class=p>,</span>
</span><span id=__span-0-327><a id=__codelineno-0-327 name=__codelineno-0-327></a>            <span class=n>file_name</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;file.txt&quot;</span><span class=p>,</span>
</span><span id=__span-0-328><a id=__codelineno-0-328 name=__codelineno-0-328></a>            <span class=n>file_type</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;text/plain&quot;</span><span class=p>,</span>
</span><span id=__span-0-329><a id=__codelineno-0-329 name=__codelineno-0-329></a>        <span class=p>):</span>
</span><span id=__span-0-330><a id=__codelineno-0-330 name=__codelineno-0-330></a><span class=w>            </span><span class=sd>&quot;&quot;&quot;Uploads a file to the registry.&quot;&quot;&quot;</span>
</span><span id=__span-0-331><a id=__codelineno-0-331 name=__codelineno-0-331></a>            <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>upload_file</span><span class=p>(</span>
</span><span id=__span-0-332><a id=__codelineno-0-332 name=__codelineno-0-332></a>                <span class=n>file_content</span><span class=p>,</span> <span class=n>purpose</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=n>encoding</span><span class=p>,</span> <span class=n>file_name</span><span class=o>=</span><span class=n>file_name</span><span class=p>,</span> <span class=n>file_type</span><span class=o>=</span><span class=n>file_type</span>
</span><span id=__span-0-333><a id=__codelineno-0-333 name=__codelineno-0-333></a>            <span class=p>)</span>
</span><span id=__span-0-334><a id=__codelineno-0-334 name=__codelineno-0-334></a>
</span><span id=__span-0-335><a id=__codelineno-0-335 name=__codelineno-0-335></a>        <span class=bp>self</span><span class=o>.</span><span class=n>upload_file</span> <span class=o>=</span> <span class=n>upload_file</span>
</span><span id=__span-0-336><a id=__codelineno-0-336 name=__codelineno-0-336></a>
</span><span id=__span-0-337><a id=__codelineno-0-337 name=__codelineno-0-337></a>        <span class=k>def</span><span class=w> </span><span class=nf>remove_file</span><span class=p>(</span><span class=n>file_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-338><a id=__codelineno-0-338 name=__codelineno-0-338></a><span class=w>            </span><span class=sd>&quot;&quot;&quot;Removes a file from the registry.&quot;&quot;&quot;</span>
</span><span id=__span-0-339><a id=__codelineno-0-339 name=__codelineno-0-339></a>            <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>remove_file</span><span class=p>(</span><span class=n>file_id</span><span class=p>)</span>
</span><span id=__span-0-340><a id=__codelineno-0-340 name=__codelineno-0-340></a>
</span><span id=__span-0-341><a id=__codelineno-0-341 name=__codelineno-0-341></a>        <span class=bp>self</span><span class=o>.</span><span class=n>remove_file</span> <span class=o>=</span> <span class=n>remove_file</span>
</span><span id=__span-0-342><a id=__codelineno-0-342 name=__codelineno-0-342></a>
</span><span id=__span-0-343><a id=__codelineno-0-343 name=__codelineno-0-343></a>        <span class=k>def</span><span class=w> </span><span class=nf>create_vector_store_from_source</span><span class=p>(</span>
</span><span id=__span-0-344><a id=__codelineno-0-344 name=__codelineno-0-344></a>            <span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-345><a id=__codelineno-0-345 name=__codelineno-0-345></a>            <span class=n>source</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>GitHubSource</span><span class=p>,</span> <span class=n>GitLabSource</span><span class=p>],</span>
</span><span id=__span-0-346><a id=__codelineno-0-346 name=__codelineno-0-346></a>            <span class=n>source_auth</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-347><a id=__codelineno-0-347 name=__codelineno-0-347></a>            <span class=n>chunking_strategy</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>ChunkingStrategy</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-348><a id=__codelineno-0-348 name=__codelineno-0-348></a>            <span class=n>expires_after</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>ExpiresAfter</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-349><a id=__codelineno-0-349 name=__codelineno-0-349></a>            <span class=n>metadata</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-350><a id=__codelineno-0-350 name=__codelineno-0-350></a>        <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>VectorStore</span><span class=p>:</span>
</span><span id=__span-0-351><a id=__codelineno-0-351 name=__codelineno-0-351></a><span class=w>            </span><span class=sd>&quot;&quot;&quot;Creates a vector store from the given source.</span>
</span><span id=__span-0-352><a id=__codelineno-0-352 name=__codelineno-0-352></a>
</span><span id=__span-0-353><a id=__codelineno-0-353 name=__codelineno-0-353></a><span class=sd>            Args:</span>
</span><span id=__span-0-354><a id=__codelineno-0-354 name=__codelineno-0-354></a><span class=sd>            ----</span>
</span><span id=__span-0-355><a id=__codelineno-0-355 name=__codelineno-0-355></a><span class=sd>                name: The name of the vector store.</span>
</span><span id=__span-0-356><a id=__codelineno-0-356 name=__codelineno-0-356></a><span class=sd>                source: The source from which to create the vector store.</span>
</span><span id=__span-0-357><a id=__codelineno-0-357 name=__codelineno-0-357></a><span class=sd>                source_auth: The source authentication token.</span>
</span><span id=__span-0-358><a id=__codelineno-0-358 name=__codelineno-0-358></a><span class=sd>                chunking_strategy: The chunking strategy to use.</span>
</span><span id=__span-0-359><a id=__codelineno-0-359 name=__codelineno-0-359></a><span class=sd>                expires_after: The expiration policy.</span>
</span><span id=__span-0-360><a id=__codelineno-0-360 name=__codelineno-0-360></a><span class=sd>                metadata: Additional metadata.</span>
</span><span id=__span-0-361><a id=__codelineno-0-361 name=__codelineno-0-361></a>
</span><span id=__span-0-362><a id=__codelineno-0-362 name=__codelineno-0-362></a><span class=sd>            Returns:</span>
</span><span id=__span-0-363><a id=__codelineno-0-363 name=__codelineno-0-363></a><span class=sd>            -------</span>
</span><span id=__span-0-364><a id=__codelineno-0-364 name=__codelineno-0-364></a><span class=sd>                VectorStore: The created vector store.</span>
</span><span id=__span-0-365><a id=__codelineno-0-365 name=__codelineno-0-365></a>
</span><span id=__span-0-366><a id=__codelineno-0-366 name=__codelineno-0-366></a><span class=sd>            &quot;&quot;&quot;</span>
</span><span id=__span-0-367><a id=__codelineno-0-367 name=__codelineno-0-367></a>            <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>create_vector_store_from_source</span><span class=p>(</span>
</span><span id=__span-0-368><a id=__codelineno-0-368 name=__codelineno-0-368></a>                <span class=n>name</span><span class=o>=</span><span class=n>name</span><span class=p>,</span>
</span><span id=__span-0-369><a id=__codelineno-0-369 name=__codelineno-0-369></a>                <span class=n>source</span><span class=o>=</span><span class=n>source</span><span class=p>,</span>
</span><span id=__span-0-370><a id=__codelineno-0-370 name=__codelineno-0-370></a>                <span class=n>source_auth</span><span class=o>=</span><span class=n>source_auth</span><span class=p>,</span>
</span><span id=__span-0-371><a id=__codelineno-0-371 name=__codelineno-0-371></a>                <span class=n>chunking_strategy</span><span class=o>=</span><span class=n>chunking_strategy</span><span class=p>,</span>
</span><span id=__span-0-372><a id=__codelineno-0-372 name=__codelineno-0-372></a>                <span class=n>expires_after</span><span class=o>=</span><span class=n>expires_after</span><span class=p>,</span>
</span><span id=__span-0-373><a id=__codelineno-0-373 name=__codelineno-0-373></a>                <span class=n>metadata</span><span class=o>=</span><span class=n>metadata</span><span class=p>,</span>
</span><span id=__span-0-374><a id=__codelineno-0-374 name=__codelineno-0-374></a>            <span class=p>)</span>
</span><span id=__span-0-375><a id=__codelineno-0-375 name=__codelineno-0-375></a>
</span><span id=__span-0-376><a id=__codelineno-0-376 name=__codelineno-0-376></a>        <span class=bp>self</span><span class=o>.</span><span class=n>create_vector_store_from_source</span> <span class=o>=</span> <span class=n>create_vector_store_from_source</span>
</span><span id=__span-0-377><a id=__codelineno-0-377 name=__codelineno-0-377></a>
</span><span id=__span-0-378><a id=__codelineno-0-378 name=__codelineno-0-378></a>        <span class=k>def</span><span class=w> </span><span class=nf>add_file_to_vector_store</span><span class=p>(</span><span class=n>vector_store_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>file_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-379><a id=__codelineno-0-379 name=__codelineno-0-379></a><span class=w>            </span><span class=sd>&quot;&quot;&quot;Adds a file to the vector store.&quot;&quot;&quot;</span>
</span><span id=__span-0-380><a id=__codelineno-0-380 name=__codelineno-0-380></a>            <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>add_file_to_vector_store</span><span class=p>(</span><span class=n>vector_store_id</span><span class=p>,</span> <span class=n>file_id</span><span class=p>)</span>
</span><span id=__span-0-381><a id=__codelineno-0-381 name=__codelineno-0-381></a>
</span><span id=__span-0-382><a id=__codelineno-0-382 name=__codelineno-0-382></a>        <span class=bp>self</span><span class=o>.</span><span class=n>add_file_to_vector_store</span> <span class=o>=</span> <span class=n>add_file_to_vector_store</span>
</span><span id=__span-0-383><a id=__codelineno-0-383 name=__codelineno-0-383></a>
</span><span id=__span-0-384><a id=__codelineno-0-384 name=__codelineno-0-384></a>        <span class=c1># positional arguments are not allowed because arguments list will be updated</span>
</span><span id=__span-0-385><a id=__codelineno-0-385 name=__codelineno-0-385></a>        <span class=k>def</span><span class=w> </span><span class=nf>find_agents</span><span class=p>(</span><span class=o>*</span><span class=p>,</span> <span class=n>owner_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>with_capabilities</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>bool</span><span class=p>]</span> <span class=o>=</span> <span class=kc>False</span><span class=p>):</span>
</span><span id=__span-0-386><a id=__codelineno-0-386 name=__codelineno-0-386></a><span class=w>            </span><span class=sd>&quot;&quot;&quot;Find agents based on various parameters.&quot;&quot;&quot;</span>
</span><span id=__span-0-387><a id=__codelineno-0-387 name=__codelineno-0-387></a>            <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>find_agents</span><span class=p>(</span><span class=n>owner_id</span><span class=p>,</span> <span class=n>with_capabilities</span><span class=p>)</span>
</span><span id=__span-0-388><a id=__codelineno-0-388 name=__codelineno-0-388></a>
</span><span id=__span-0-389><a id=__codelineno-0-389 name=__codelineno-0-389></a>        <span class=bp>self</span><span class=o>.</span><span class=n>find_agents</span> <span class=o>=</span> <span class=n>find_agents</span>
</span><span id=__span-0-390><a id=__codelineno-0-390 name=__codelineno-0-390></a>
</span><span id=__span-0-391><a id=__codelineno-0-391 name=__codelineno-0-391></a>        <span class=k>def</span><span class=w> </span><span class=nf>create_vector_store</span><span class=p>(</span>
</span><span id=__span-0-392><a id=__codelineno-0-392 name=__codelineno-0-392></a>            <span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-393><a id=__codelineno-0-393 name=__codelineno-0-393></a>            <span class=n>file_ids</span><span class=p>:</span> <span class=nb>list</span><span class=p>,</span>
</span><span id=__span-0-394><a id=__codelineno-0-394 name=__codelineno-0-394></a>            <span class=n>expires_after</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>ExpiresAfter</span><span class=p>,</span> <span class=n>NotGiven</span><span class=p>]</span> <span class=o>=</span> <span class=n>NOT_GIVEN</span><span class=p>,</span>
</span><span id=__span-0-395><a id=__codelineno-0-395 name=__codelineno-0-395></a>            <span class=n>chunking_strategy</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span>
</span><span id=__span-0-396><a id=__codelineno-0-396 name=__codelineno-0-396></a>                <span class=n>AutoFileChunkingStrategyParam</span><span class=p>,</span> <span class=n>StaticFileChunkingStrategyObjectParam</span><span class=p>,</span> <span class=n>NotGiven</span>
</span><span id=__span-0-397><a id=__codelineno-0-397 name=__codelineno-0-397></a>            <span class=p>]</span> <span class=o>=</span> <span class=n>NOT_GIVEN</span><span class=p>,</span>
</span><span id=__span-0-398><a id=__codelineno-0-398 name=__codelineno-0-398></a>            <span class=n>metadata</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-399><a id=__codelineno-0-399 name=__codelineno-0-399></a>        <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>VectorStore</span><span class=p>:</span>
</span><span id=__span-0-400><a id=__codelineno-0-400 name=__codelineno-0-400></a><span class=w>            </span><span class=sd>&quot;&quot;&quot;Creates a vector store.</span>
</span><span id=__span-0-401><a id=__codelineno-0-401 name=__codelineno-0-401></a>
</span><span id=__span-0-402><a id=__codelineno-0-402 name=__codelineno-0-402></a><span class=sd>            Args:</span>
</span><span id=__span-0-403><a id=__codelineno-0-403 name=__codelineno-0-403></a><span class=sd>            ----</span>
</span><span id=__span-0-404><a id=__codelineno-0-404 name=__codelineno-0-404></a><span class=sd>                name: The name of the vector store.</span>
</span><span id=__span-0-405><a id=__codelineno-0-405 name=__codelineno-0-405></a><span class=sd>                file_ids: List of file ids to create the vector store.</span>
</span><span id=__span-0-406><a id=__codelineno-0-406 name=__codelineno-0-406></a><span class=sd>                chunking_strategy: The chunking strategy to use.</span>
</span><span id=__span-0-407><a id=__codelineno-0-407 name=__codelineno-0-407></a><span class=sd>                expires_after: The expiration policy.</span>
</span><span id=__span-0-408><a id=__codelineno-0-408 name=__codelineno-0-408></a><span class=sd>                metadata: Additional metadata.</span>
</span><span id=__span-0-409><a id=__codelineno-0-409 name=__codelineno-0-409></a>
</span><span id=__span-0-410><a id=__codelineno-0-410 name=__codelineno-0-410></a><span class=sd>            Returns:</span>
</span><span id=__span-0-411><a id=__codelineno-0-411 name=__codelineno-0-411></a><span class=sd>            -------</span>
</span><span id=__span-0-412><a id=__codelineno-0-412 name=__codelineno-0-412></a><span class=sd>                VectorStore: The created vector store.</span>
</span><span id=__span-0-413><a id=__codelineno-0-413 name=__codelineno-0-413></a>
</span><span id=__span-0-414><a id=__codelineno-0-414 name=__codelineno-0-414></a><span class=sd>            &quot;&quot;&quot;</span>
</span><span id=__span-0-415><a id=__codelineno-0-415 name=__codelineno-0-415></a>            <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>create_vector_store</span><span class=p>(</span>
</span><span id=__span-0-416><a id=__codelineno-0-416 name=__codelineno-0-416></a>                <span class=n>name</span><span class=o>=</span><span class=n>name</span><span class=p>,</span>
</span><span id=__span-0-417><a id=__codelineno-0-417 name=__codelineno-0-417></a>                <span class=n>file_ids</span><span class=o>=</span><span class=n>file_ids</span><span class=p>,</span>
</span><span id=__span-0-418><a id=__codelineno-0-418 name=__codelineno-0-418></a>                <span class=n>chunking_strategy</span><span class=o>=</span><span class=n>chunking_strategy</span><span class=p>,</span>
</span><span id=__span-0-419><a id=__codelineno-0-419 name=__codelineno-0-419></a>                <span class=n>expires_after</span><span class=o>=</span><span class=n>expires_after</span><span class=p>,</span>
</span><span id=__span-0-420><a id=__codelineno-0-420 name=__codelineno-0-420></a>                <span class=n>metadata</span><span class=o>=</span><span class=n>metadata</span><span class=p>,</span>
</span><span id=__span-0-421><a id=__codelineno-0-421 name=__codelineno-0-421></a>            <span class=p>)</span>
</span><span id=__span-0-422><a id=__codelineno-0-422 name=__codelineno-0-422></a>
</span><span id=__span-0-423><a id=__codelineno-0-423 name=__codelineno-0-423></a>        <span class=bp>self</span><span class=o>.</span><span class=n>create_vector_store</span> <span class=o>=</span> <span class=n>create_vector_store</span>
</span><span id=__span-0-424><a id=__codelineno-0-424 name=__codelineno-0-424></a>
</span><span id=__span-0-425><a id=__codelineno-0-425 name=__codelineno-0-425></a>        <span class=k>def</span><span class=w> </span><span class=nf>get_vector_store</span><span class=p>(</span><span class=n>vector_store_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>VectorStore</span><span class=p>:</span>
</span><span id=__span-0-426><a id=__codelineno-0-426 name=__codelineno-0-426></a><span class=w>            </span><span class=sd>&quot;&quot;&quot;Gets a vector store by id.&quot;&quot;&quot;</span>
</span><span id=__span-0-427><a id=__codelineno-0-427 name=__codelineno-0-427></a>            <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>get_vector_store</span><span class=p>(</span><span class=n>vector_store_id</span><span class=p>)</span>
</span><span id=__span-0-428><a id=__codelineno-0-428 name=__codelineno-0-428></a>
</span><span id=__span-0-429><a id=__codelineno-0-429 name=__codelineno-0-429></a>        <span class=bp>self</span><span class=o>.</span><span class=n>get_vector_store</span> <span class=o>=</span> <span class=n>get_vector_store</span>
</span><span id=__span-0-430><a id=__codelineno-0-430 name=__codelineno-0-430></a>
</span><span id=__span-0-431><a id=__codelineno-0-431 name=__codelineno-0-431></a>        <span class=k>def</span><span class=w> </span><span class=nf>get_vector_store_files</span><span class=p>(</span><span class=n>vector_store_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=n>VectorStoreFile</span><span class=p>]]:</span>
</span><span id=__span-0-432><a id=__codelineno-0-432 name=__codelineno-0-432></a><span class=w>            </span><span class=sd>&quot;&quot;&quot;Gets a list of vector store files.&quot;&quot;&quot;</span>
</span><span id=__span-0-433><a id=__codelineno-0-433 name=__codelineno-0-433></a>            <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>get_vector_store_files</span><span class=p>(</span><span class=n>vector_store_id</span><span class=p>)</span>
</span><span id=__span-0-434><a id=__codelineno-0-434 name=__codelineno-0-434></a>
</span><span id=__span-0-435><a id=__codelineno-0-435 name=__codelineno-0-435></a>        <span class=bp>self</span><span class=o>.</span><span class=n>get_vector_store_files</span> <span class=o>=</span> <span class=n>get_vector_store_files</span>
</span><span id=__span-0-436><a id=__codelineno-0-436 name=__codelineno-0-436></a>
</span><span id=__span-0-437><a id=__codelineno-0-437 name=__codelineno-0-437></a>        <span class=c1># Save cache of requested models for inference to avoid extra server calls</span>
</span><span id=__span-0-438><a id=__codelineno-0-438 name=__codelineno-0-438></a>        <span class=bp>self</span><span class=o>.</span><span class=n>cached_models_for_inference</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-0-439><a id=__codelineno-0-439 name=__codelineno-0-439></a>
</span><span id=__span-0-440><a id=__codelineno-0-440 name=__codelineno-0-440></a>        <span class=k>def</span><span class=w> </span><span class=nf>get_model_for_inference</span><span class=p>(</span><span class=n>model</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-0-441><a id=__codelineno-0-441 name=__codelineno-0-441></a><span class=w>            </span><span class=sd>&quot;&quot;&quot;Returns &#39;provider::model_full_path&#39;.&quot;&quot;&quot;</span>
</span><span id=__span-0-442><a id=__codelineno-0-442 name=__codelineno-0-442></a>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>cached_models_for_inference</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-443><a id=__codelineno-0-443 name=__codelineno-0-443></a>                <span class=n>provider</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_primary_agent</span><span class=p>()</span><span class=o>.</span><span class=n>model_provider</span> <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_agents</span> <span class=k>else</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-444><a id=__codelineno-0-444 name=__codelineno-0-444></a>                <span class=k>if</span> <span class=n>model</span> <span class=o>==</span> <span class=s2>&quot;&quot;</span><span class=p>:</span>
</span><span id=__span-0-445><a id=__codelineno-0-445 name=__codelineno-0-445></a>                    <span class=n>model</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_primary_agent</span><span class=p>()</span><span class=o>.</span><span class=n>model</span> <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_agents</span> <span class=k>else</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-446><a id=__codelineno-0-446 name=__codelineno-0-446></a>                <span class=k>if</span> <span class=n>model</span> <span class=o>==</span> <span class=s2>&quot;&quot;</span><span class=p>:</span>
</span><span id=__span-0-447><a id=__codelineno-0-447 name=__codelineno-0-447></a>                    <span class=k>return</span> <span class=n>DEFAULT_PROVIDER_MODEL</span>
</span><span id=__span-0-448><a id=__codelineno-0-448 name=__codelineno-0-448></a>
</span><span id=__span-0-449><a id=__codelineno-0-449 name=__codelineno-0-449></a>                <span class=n>_</span><span class=p>,</span> <span class=n>model_for_inference</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>provider_models</span><span class=o>.</span><span class=n>match_provider_model</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>provider</span><span class=p>)</span>
</span><span id=__span-0-450><a id=__codelineno-0-450 name=__codelineno-0-450></a>
</span><span id=__span-0-451><a id=__codelineno-0-451 name=__codelineno-0-451></a>                <span class=bp>self</span><span class=o>.</span><span class=n>cached_models_for_inference</span><span class=p>[</span><span class=n>model</span><span class=p>]</span> <span class=o>=</span> <span class=n>model_for_inference</span>
</span><span id=__span-0-452><a id=__codelineno-0-452 name=__codelineno-0-452></a>
</span><span id=__span-0-453><a id=__codelineno-0-453 name=__codelineno-0-453></a>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>cached_models_for_inference</span><span class=p>[</span><span class=n>model</span><span class=p>]</span>
</span><span id=__span-0-454><a id=__codelineno-0-454 name=__codelineno-0-454></a>
</span><span id=__span-0-455><a id=__codelineno-0-455 name=__codelineno-0-455></a>        <span class=bp>self</span><span class=o>.</span><span class=n>get_model_for_inference</span> <span class=o>=</span> <span class=n>get_model_for_inference</span>
</span><span id=__span-0-456><a id=__codelineno-0-456 name=__codelineno-0-456></a>
</span><span id=__span-0-457><a id=__codelineno-0-457 name=__codelineno-0-457></a>        <span class=k>def</span><span class=w> </span><span class=nf>_run_inference_completions</span><span class=p>(</span>
</span><span id=__span-0-458><a id=__codelineno-0-458 name=__codelineno-0-458></a>            <span class=n>messages</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Iterable</span><span class=p>[</span><span class=n>ChatCompletionMessageParam</span><span class=p>],</span> <span class=nb>str</span><span class=p>],</span>
</span><span id=__span-0-459><a id=__codelineno-0-459 name=__codelineno-0-459></a>            <span class=n>model</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Iterable</span><span class=p>[</span><span class=n>ChatCompletionMessageParam</span><span class=p>],</span> <span class=nb>str</span><span class=p>],</span>
</span><span id=__span-0-460><a id=__codelineno-0-460 name=__codelineno-0-460></a>            <span class=n>stream</span><span class=p>:</span> <span class=nb>bool</span><span class=p>,</span>
</span><span id=__span-0-461><a id=__codelineno-0-461 name=__codelineno-0-461></a>            <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span>
</span><span id=__span-0-462><a id=__codelineno-0-462 name=__codelineno-0-462></a>        <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span><span class=n>ModelResponse</span><span class=p>,</span> <span class=n>CustomStreamWrapper</span><span class=p>]:</span>
</span><span id=__span-0-463><a id=__codelineno-0-463 name=__codelineno-0-463></a><span class=w>            </span><span class=sd>&quot;&quot;&quot;Run inference completions for given parameters.&quot;&quot;&quot;</span>
</span><span id=__span-0-464><a id=__codelineno-0-464 name=__codelineno-0-464></a>            <span class=n>params</span><span class=p>,</span> <span class=n>kwargs</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_inference_parameters</span><span class=p>(</span><span class=n>messages</span><span class=p>,</span> <span class=n>model</span><span class=p>,</span> <span class=n>stream</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span><span id=__span-0-465><a id=__codelineno-0-465 name=__codelineno-0-465></a>
</span><span id=__span-0-466><a id=__codelineno-0-466 name=__codelineno-0-466></a>            <span class=n>completions</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>completions</span><span class=p>(</span>
</span><span id=__span-0-467><a id=__codelineno-0-467 name=__codelineno-0-467></a>                <span class=n>params</span><span class=o>.</span><span class=n>model</span><span class=p>,</span> <span class=n>params</span><span class=o>.</span><span class=n>messages</span><span class=p>,</span> <span class=n>params</span><span class=o>.</span><span class=n>stream</span><span class=p>,</span> <span class=n>params</span><span class=o>.</span><span class=n>temperature</span><span class=p>,</span> <span class=n>params</span><span class=o>.</span><span class=n>max_tokens</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span>
</span><span id=__span-0-468><a id=__codelineno-0-468 name=__codelineno-0-468></a>            <span class=p>)</span>
</span><span id=__span-0-469><a id=__codelineno-0-469 name=__codelineno-0-469></a>
</span><span id=__span-0-470><a id=__codelineno-0-470 name=__codelineno-0-470></a>            <span class=k>return</span> <span class=n>completions</span>
</span><span id=__span-0-471><a id=__codelineno-0-471 name=__codelineno-0-471></a>
</span><span id=__span-0-472><a id=__codelineno-0-472 name=__codelineno-0-472></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_run_inference_completions</span> <span class=o>=</span> <span class=n>_run_inference_completions</span>
</span><span id=__span-0-473><a id=__codelineno-0-473 name=__codelineno-0-473></a>
</span><span id=__span-0-474><a id=__codelineno-0-474 name=__codelineno-0-474></a>        <span class=k>def</span><span class=w> </span><span class=nf>get_agent_public_key</span><span class=p>():</span>
</span><span id=__span-0-475><a id=__codelineno-0-475 name=__codelineno-0-475></a><span class=w>            </span><span class=sd>&quot;&quot;&quot;Returns public key of the agent.&quot;&quot;&quot;</span>
</span><span id=__span-0-476><a id=__codelineno-0-476 name=__codelineno-0-476></a>            <span class=n>agent_name</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_primary_agent</span><span class=p>()</span><span class=o>.</span><span class=n>get_full_name</span><span class=p>()</span>
</span><span id=__span-0-477><a id=__codelineno-0-477 name=__codelineno-0-477></a>
</span><span id=__span-0-478><a id=__codelineno-0-478 name=__codelineno-0-478></a>            <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>get_agent_public_key</span><span class=p>(</span><span class=n>agent_name</span><span class=p>)</span>
</span><span id=__span-0-479><a id=__codelineno-0-479 name=__codelineno-0-479></a>
</span><span id=__span-0-480><a id=__codelineno-0-480 name=__codelineno-0-480></a>        <span class=bp>self</span><span class=o>.</span><span class=n>get_agent_public_key</span> <span class=o>=</span> <span class=n>get_agent_public_key</span>
</span><span id=__span-0-481><a id=__codelineno-0-481 name=__codelineno-0-481></a>
</span><span id=__span-0-482><a id=__codelineno-0-482 name=__codelineno-0-482></a>        <span class=k>def</span><span class=w> </span><span class=nf>run_agent</span><span class=p>(</span>
</span><span id=__span-0-483><a id=__codelineno-0-483 name=__codelineno-0-483></a>            <span class=n>agent_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-484><a id=__codelineno-0-484 name=__codelineno-0-484></a>            <span class=n>query</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-485><a id=__codelineno-0-485 name=__codelineno-0-485></a>            <span class=n>thread_mode</span><span class=p>:</span> <span class=n>ThreadMode</span> <span class=o>=</span> <span class=n>ThreadMode</span><span class=o>.</span><span class=n>FORK</span><span class=p>,</span>
</span><span id=__span-0-486><a id=__codelineno-0-486 name=__codelineno-0-486></a>            <span class=n>run_mode</span><span class=p>:</span> <span class=n>RunMode</span> <span class=o>=</span> <span class=n>RunMode</span><span class=o>.</span><span class=n>SIMPLE</span><span class=p>,</span>
</span><span id=__span-0-487><a id=__codelineno-0-487 name=__codelineno-0-487></a>        <span class=p>):</span>
</span><span id=__span-0-488><a id=__codelineno-0-488 name=__codelineno-0-488></a><span class=w>            </span><span class=sd>&quot;&quot;&quot;Runs a child agent on the thread.&quot;&quot;&quot;</span>
</span><span id=__span-0-489><a id=__codelineno-0-489 name=__codelineno-0-489></a>            <span class=n>child_thread_id</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_thread_id</span>
</span><span id=__span-0-490><a id=__codelineno-0-490 name=__codelineno-0-490></a>
</span><span id=__span-0-491><a id=__codelineno-0-491 name=__codelineno-0-491></a>            <span class=k>if</span> <span class=n>thread_mode</span> <span class=o>==</span> <span class=n>ThreadMode</span><span class=o>.</span><span class=n>SAME</span><span class=p>:</span>
</span><span id=__span-0-492><a id=__codelineno-0-492 name=__codelineno-0-492></a>                <span class=k>pass</span>
</span><span id=__span-0-493><a id=__codelineno-0-493 name=__codelineno-0-493></a>            <span class=k>elif</span> <span class=n>thread_mode</span> <span class=o>==</span> <span class=n>ThreadMode</span><span class=o>.</span><span class=n>FORK</span><span class=p>:</span>
</span><span id=__span-0-494><a id=__codelineno-0-494 name=__codelineno-0-494></a>                <span class=n>child_thread_id</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>threads_fork</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_thread_id</span><span class=p>)</span><span class=o>.</span><span class=n>id</span>
</span><span id=__span-0-495><a id=__codelineno-0-495 name=__codelineno-0-495></a>                <span class=bp>self</span><span class=o>.</span><span class=n>add_system_log</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Forked thread </span><span class=si>{</span><span class=n>child_thread_id</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>logging</span><span class=o>.</span><span class=n>INFO</span><span class=p>)</span>
</span><span id=__span-0-496><a id=__codelineno-0-496 name=__codelineno-0-496></a>            <span class=k>elif</span> <span class=n>thread_mode</span> <span class=o>==</span> <span class=n>ThreadMode</span><span class=o>.</span><span class=n>CHILD</span><span class=p>:</span>
</span><span id=__span-0-497><a id=__codelineno-0-497 name=__codelineno-0-497></a>                <span class=n>child_thread_id</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>create_subthread</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_thread_id</span><span class=p>)</span><span class=o>.</span><span class=n>id</span>
</span><span id=__span-0-498><a id=__codelineno-0-498 name=__codelineno-0-498></a>                <span class=bp>self</span><span class=o>.</span><span class=n>add_system_log</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Created subthread </span><span class=si>{</span><span class=n>child_thread_id</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>logging</span><span class=o>.</span><span class=n>INFO</span><span class=p>)</span>
</span><span id=__span-0-499><a id=__codelineno-0-499 name=__codelineno-0-499></a>
</span><span id=__span-0-500><a id=__codelineno-0-500 name=__codelineno-0-500></a>            <span class=k>if</span> <span class=n>query</span><span class=p>:</span>
</span><span id=__span-0-501><a id=__codelineno-0-501 name=__codelineno-0-501></a>                <span class=n>client</span><span class=o>.</span><span class=n>threads_messages_create</span><span class=p>(</span><span class=n>thread_id</span><span class=o>=</span><span class=n>child_thread_id</span><span class=p>,</span> <span class=n>content</span><span class=o>=</span><span class=n>query</span><span class=p>,</span> <span class=n>role</span><span class=o>=</span><span class=s2>&quot;user&quot;</span><span class=p>)</span>
</span><span id=__span-0-502><a id=__codelineno-0-502 name=__codelineno-0-502></a>
</span><span id=__span-0-503><a id=__codelineno-0-503 name=__codelineno-0-503></a>            <span class=bp>self</span><span class=o>.</span><span class=n>add_system_log</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Running agent </span><span class=si>{</span><span class=n>agent_id</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>logging</span><span class=o>.</span><span class=n>INFO</span><span class=p>)</span>
</span><span id=__span-0-504><a id=__codelineno-0-504 name=__codelineno-0-504></a>            <span class=n>client</span><span class=o>.</span><span class=n>run_agent</span><span class=p>(</span>
</span><span id=__span-0-505><a id=__codelineno-0-505 name=__codelineno-0-505></a>                <span class=n>parent_run_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_run_id</span><span class=p>,</span>
</span><span id=__span-0-506><a id=__codelineno-0-506 name=__codelineno-0-506></a>                <span class=n>run_on_thread_id</span><span class=o>=</span><span class=n>child_thread_id</span><span class=p>,</span>
</span><span id=__span-0-507><a id=__codelineno-0-507 name=__codelineno-0-507></a>                <span class=n>assistant_id</span><span class=o>=</span><span class=n>agent_id</span><span class=p>,</span>
</span><span id=__span-0-508><a id=__codelineno-0-508 name=__codelineno-0-508></a>                <span class=n>run_mode</span><span class=o>=</span><span class=n>run_mode</span><span class=p>,</span>
</span><span id=__span-0-509><a id=__codelineno-0-509 name=__codelineno-0-509></a>            <span class=p>)</span>
</span><span id=__span-0-510><a id=__codelineno-0-510 name=__codelineno-0-510></a>            <span class=bp>self</span><span class=o>.</span><span class=n>_pending_ext_agent</span> <span class=o>=</span> <span class=kc>True</span>
</span><span id=__span-0-511><a id=__codelineno-0-511 name=__codelineno-0-511></a>
</span><span id=__span-0-512><a id=__codelineno-0-512 name=__codelineno-0-512></a>            <span class=k>return</span> <span class=n>child_thread_id</span>
</span><span id=__span-0-513><a id=__codelineno-0-513 name=__codelineno-0-513></a>
</span><span id=__span-0-514><a id=__codelineno-0-514 name=__codelineno-0-514></a>        <span class=bp>self</span><span class=o>.</span><span class=n>run_agent</span> <span class=o>=</span> <span class=n>run_agent</span>
</span><span id=__span-0-515><a id=__codelineno-0-515 name=__codelineno-0-515></a>
</span><span id=__span-0-516><a id=__codelineno-0-516 name=__codelineno-0-516></a>        <span class=k>def</span><span class=w> </span><span class=nf>schedule_run</span><span class=p>(</span>
</span><span id=__span-0-517><a id=__codelineno-0-517 name=__codelineno-0-517></a>            <span class=n>agent</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-518><a id=__codelineno-0-518 name=__codelineno-0-518></a>            <span class=n>input_message</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-519><a id=__codelineno-0-519 name=__codelineno-0-519></a>            <span class=n>run_at</span><span class=p>:</span> <span class=n>datetime</span><span class=p>,</span>
</span><span id=__span-0-520><a id=__codelineno-0-520 name=__codelineno-0-520></a>            <span class=n>run_params</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-521><a id=__codelineno-0-521 name=__codelineno-0-521></a>            <span class=n>thread_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-522><a id=__codelineno-0-522 name=__codelineno-0-522></a>        <span class=p>):</span>
</span><span id=__span-0-523><a id=__codelineno-0-523 name=__codelineno-0-523></a><span class=w>            </span><span class=sd>&quot;&quot;&quot;Schedules a run.&quot;&quot;&quot;</span>
</span><span id=__span-0-524><a id=__codelineno-0-524 name=__codelineno-0-524></a>            <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>schedule_run</span><span class=p>(</span><span class=n>agent</span><span class=p>,</span> <span class=n>input_message</span><span class=p>,</span> <span class=n>thread_id</span><span class=p>,</span> <span class=n>run_params</span><span class=p>,</span> <span class=n>run_at</span><span class=p>)</span>
</span><span id=__span-0-525><a id=__codelineno-0-525 name=__codelineno-0-525></a>
</span><span id=__span-0-526><a id=__codelineno-0-526 name=__codelineno-0-526></a>        <span class=bp>self</span><span class=o>.</span><span class=n>schedule_run</span> <span class=o>=</span> <span class=n>schedule_run</span>
</span><span id=__span-0-527><a id=__codelineno-0-527 name=__codelineno-0-527></a>
</span><span id=__span-0-528><a id=__codelineno-0-528 name=__codelineno-0-528></a>        <span class=c1># TODO(https://github.com/nearai/nearai/issues/549): Allow only a subset of agents to access/update user memory.</span>
</span><span id=__span-0-529><a id=__codelineno-0-529 name=__codelineno-0-529></a>        <span class=k>def</span><span class=w> </span><span class=nf>add_user_memory</span><span class=p>(</span><span class=n>memory</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-530><a id=__codelineno-0-530 name=__codelineno-0-530></a><span class=w>            </span><span class=sd>&quot;&quot;&quot;Add user memory.&quot;&quot;&quot;</span>
</span><span id=__span-0-531><a id=__codelineno-0-531 name=__codelineno-0-531></a>            <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>add_user_memory</span><span class=p>(</span><span class=n>memory</span><span class=p>)</span>
</span><span id=__span-0-532><a id=__codelineno-0-532 name=__codelineno-0-532></a>
</span><span id=__span-0-533><a id=__codelineno-0-533 name=__codelineno-0-533></a>        <span class=bp>self</span><span class=o>.</span><span class=n>add_user_memory</span> <span class=o>=</span> <span class=n>add_user_memory</span>
</span><span id=__span-0-534><a id=__codelineno-0-534 name=__codelineno-0-534></a>
</span><span id=__span-0-535><a id=__codelineno-0-535 name=__codelineno-0-535></a>        <span class=k>def</span><span class=w> </span><span class=nf>query_user_memory</span><span class=p>(</span><span class=n>query</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-536><a id=__codelineno-0-536 name=__codelineno-0-536></a><span class=w>            </span><span class=sd>&quot;&quot;&quot;Query user memory.&quot;&quot;&quot;</span>
</span><span id=__span-0-537><a id=__codelineno-0-537 name=__codelineno-0-537></a>            <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>query_user_memory</span><span class=p>(</span><span class=n>query</span><span class=p>)</span>
</span><span id=__span-0-538><a id=__codelineno-0-538 name=__codelineno-0-538></a>
</span><span id=__span-0-539><a id=__codelineno-0-539 name=__codelineno-0-539></a>        <span class=bp>self</span><span class=o>.</span><span class=n>query_user_memory</span> <span class=o>=</span> <span class=n>query_user_memory</span>
</span><span id=__span-0-540><a id=__codelineno-0-540 name=__codelineno-0-540></a>
</span><span id=__span-0-541><a id=__codelineno-0-541 name=__codelineno-0-541></a>        <span class=k>def</span><span class=w> </span><span class=nf>generate_image</span><span class=p>(</span><span class=n>prompt</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-542><a id=__codelineno-0-542 name=__codelineno-0-542></a><span class=w>            </span><span class=sd>&quot;&quot;&quot;Generate an image.&quot;&quot;&quot;</span>
</span><span id=__span-0-543><a id=__codelineno-0-543 name=__codelineno-0-543></a>            <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>generate_image</span><span class=p>(</span><span class=n>prompt</span><span class=p>)</span>
</span><span id=__span-0-544><a id=__codelineno-0-544 name=__codelineno-0-544></a>
</span><span id=__span-0-545><a id=__codelineno-0-545 name=__codelineno-0-545></a>        <span class=bp>self</span><span class=o>.</span><span class=n>generate_image</span> <span class=o>=</span> <span class=n>generate_image</span>
</span><span id=__span-0-546><a id=__codelineno-0-546 name=__codelineno-0-546></a>
</span><span id=__span-0-547><a id=__codelineno-0-547 name=__codelineno-0-547></a>        <span class=k>def</span><span class=w> </span><span class=nf>save_agent_data</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]):</span>
</span><span id=__span-0-548><a id=__codelineno-0-548 name=__codelineno-0-548></a><span class=w>            </span><span class=sd>&quot;&quot;&quot;Save agent data.&quot;&quot;&quot;</span>
</span><span id=__span-0-549><a id=__codelineno-0-549 name=__codelineno-0-549></a>            <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>save_agent_data</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>data</span><span class=p>)</span>
</span><span id=__span-0-550><a id=__codelineno-0-550 name=__codelineno-0-550></a>
</span><span id=__span-0-551><a id=__codelineno-0-551 name=__codelineno-0-551></a>        <span class=bp>self</span><span class=o>.</span><span class=n>save_agent_data</span> <span class=o>=</span> <span class=n>save_agent_data</span>
</span><span id=__span-0-552><a id=__codelineno-0-552 name=__codelineno-0-552></a>
</span><span id=__span-0-553><a id=__codelineno-0-553 name=__codelineno-0-553></a>        <span class=k>def</span><span class=w> </span><span class=nf>get_agent_data</span><span class=p>():</span>
</span><span id=__span-0-554><a id=__codelineno-0-554 name=__codelineno-0-554></a><span class=w>            </span><span class=sd>&quot;&quot;&quot;Get agent data.&quot;&quot;&quot;</span>
</span><span id=__span-0-555><a id=__codelineno-0-555 name=__codelineno-0-555></a>            <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>get_agent_data</span><span class=p>()</span>
</span><span id=__span-0-556><a id=__codelineno-0-556 name=__codelineno-0-556></a>
</span><span id=__span-0-557><a id=__codelineno-0-557 name=__codelineno-0-557></a>        <span class=bp>self</span><span class=o>.</span><span class=n>get_agent_data</span> <span class=o>=</span> <span class=n>get_agent_data</span>
</span><span id=__span-0-558><a id=__codelineno-0-558 name=__codelineno-0-558></a>
</span><span id=__span-0-559><a id=__codelineno-0-559 name=__codelineno-0-559></a>        <span class=k>def</span><span class=w> </span><span class=nf>get_agent_data_by_key</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span><span id=__span-0-560><a id=__codelineno-0-560 name=__codelineno-0-560></a><span class=w>            </span><span class=sd>&quot;&quot;&quot;Get agent data by key.&quot;&quot;&quot;</span>
</span><span id=__span-0-561><a id=__codelineno-0-561 name=__codelineno-0-561></a>            <span class=n>namespace</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_primary_agent</span><span class=p>()</span><span class=o>.</span><span class=n>namespace</span>
</span><span id=__span-0-562><a id=__codelineno-0-562 name=__codelineno-0-562></a>            <span class=n>name</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_primary_agent</span><span class=p>()</span><span class=o>.</span><span class=n>name</span>
</span><span id=__span-0-563><a id=__codelineno-0-563 name=__codelineno-0-563></a>            <span class=n>result</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>get_agent_data_by_key</span><span class=p>(</span><span class=n>key</span><span class=p>)</span>
</span><span id=__span-0-564><a id=__codelineno-0-564 name=__codelineno-0-564></a>            <span class=k>return</span> <span class=p>(</span>
</span><span id=__span-0-565><a id=__codelineno-0-565 name=__codelineno-0-565></a>                <span class=n>result</span>
</span><span id=__span-0-566><a id=__codelineno-0-566 name=__codelineno-0-566></a>                <span class=k>if</span> <span class=n>result</span>
</span><span id=__span-0-567><a id=__codelineno-0-567 name=__codelineno-0-567></a>                <span class=k>else</span> <span class=p>{</span>
</span><span id=__span-0-568><a id=__codelineno-0-568 name=__codelineno-0-568></a>                    <span class=s2>&quot;value&quot;</span><span class=p>:</span> <span class=n>default</span><span class=p>,</span>
</span><span id=__span-0-569><a id=__codelineno-0-569 name=__codelineno-0-569></a>                    <span class=s2>&quot;namespace&quot;</span><span class=p>:</span> <span class=n>namespace</span><span class=p>,</span>
</span><span id=__span-0-570><a id=__codelineno-0-570 name=__codelineno-0-570></a>                    <span class=s2>&quot;key&quot;</span><span class=p>:</span> <span class=n>key</span><span class=p>,</span>
</span><span id=__span-0-571><a id=__codelineno-0-571 name=__codelineno-0-571></a>                    <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=n>name</span><span class=p>,</span>
</span><span id=__span-0-572><a id=__codelineno-0-572 name=__codelineno-0-572></a>                    <span class=s2>&quot;updated_at&quot;</span><span class=p>:</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-573><a id=__codelineno-0-573 name=__codelineno-0-573></a>                    <span class=s2>&quot;created_at&quot;</span><span class=p>:</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-574><a id=__codelineno-0-574 name=__codelineno-0-574></a>                <span class=p>}</span>
</span><span id=__span-0-575><a id=__codelineno-0-575 name=__codelineno-0-575></a>            <span class=p>)</span>
</span><span id=__span-0-576><a id=__codelineno-0-576 name=__codelineno-0-576></a>
</span><span id=__span-0-577><a id=__codelineno-0-577 name=__codelineno-0-577></a>        <span class=bp>self</span><span class=o>.</span><span class=n>get_agent_data_by_key</span> <span class=o>=</span> <span class=n>get_agent_data_by_key</span>
</span><span id=__span-0-578><a id=__codelineno-0-578 name=__codelineno-0-578></a>
</span><span id=__span-0-579><a id=__codelineno-0-579 name=__codelineno-0-579></a>        <span class=c1># HubClient methods</span>
</span><span id=__span-0-580><a id=__codelineno-0-580 name=__codelineno-0-580></a>        <span class=k>def</span><span class=w> </span><span class=nf>add_reply</span><span class=p>(</span>
</span><span id=__span-0-581><a id=__codelineno-0-581 name=__codelineno-0-581></a>            <span class=n>message</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-582><a id=__codelineno-0-582 name=__codelineno-0-582></a>            <span class=n>attachments</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Iterable</span><span class=p>[</span><span class=n>Attachment</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-583><a id=__codelineno-0-583 name=__codelineno-0-583></a>            <span class=n>message_type</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-584><a id=__codelineno-0-584 name=__codelineno-0-584></a>            <span class=n>thread_id</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_thread_id</span><span class=p>,</span>
</span><span id=__span-0-585><a id=__codelineno-0-585 name=__codelineno-0-585></a>        <span class=p>):</span>
</span><span id=__span-0-586><a id=__codelineno-0-586 name=__codelineno-0-586></a><span class=w>            </span><span class=sd>&quot;&quot;&quot;Assistant adds a message to the environment.&quot;&quot;&quot;</span>
</span><span id=__span-0-587><a id=__codelineno-0-587 name=__codelineno-0-587></a>            <span class=c1># NOTE: message from `user` are not stored in the memory</span>
</span><span id=__span-0-588><a id=__codelineno-0-588 name=__codelineno-0-588></a>
</span><span id=__span-0-589><a id=__codelineno-0-589 name=__codelineno-0-589></a>            <span class=k>return</span> <span class=n>hub_client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>messages</span><span class=o>.</span><span class=n>create</span><span class=p>(</span>
</span><span id=__span-0-590><a id=__codelineno-0-590 name=__codelineno-0-590></a>                <span class=n>thread_id</span><span class=o>=</span><span class=n>thread_id</span><span class=p>,</span>
</span><span id=__span-0-591><a id=__codelineno-0-591 name=__codelineno-0-591></a>                <span class=n>role</span><span class=o>=</span><span class=s2>&quot;assistant&quot;</span><span class=p>,</span>
</span><span id=__span-0-592><a id=__codelineno-0-592 name=__codelineno-0-592></a>                <span class=n>content</span><span class=o>=</span><span class=n>message</span><span class=p>,</span>
</span><span id=__span-0-593><a id=__codelineno-0-593 name=__codelineno-0-593></a>                <span class=n>extra_body</span><span class=o>=</span><span class=p>{</span>
</span><span id=__span-0-594><a id=__codelineno-0-594 name=__codelineno-0-594></a>                    <span class=s2>&quot;assistant_id&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_primary_agent</span><span class=p>()</span><span class=o>.</span><span class=n>identifier</span><span class=p>,</span>
</span><span id=__span-0-595><a id=__codelineno-0-595 name=__codelineno-0-595></a>                    <span class=s2>&quot;run_id&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_run_id</span><span class=p>,</span>
</span><span id=__span-0-596><a id=__codelineno-0-596 name=__codelineno-0-596></a>                <span class=p>},</span>
</span><span id=__span-0-597><a id=__codelineno-0-597 name=__codelineno-0-597></a>                <span class=n>attachments</span><span class=o>=</span><span class=n>attachments</span><span class=p>,</span>
</span><span id=__span-0-598><a id=__codelineno-0-598 name=__codelineno-0-598></a>                <span class=n>metadata</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;message_type&quot;</span><span class=p>:</span> <span class=n>message_type</span><span class=p>}</span> <span class=k>if</span> <span class=n>message_type</span> <span class=k>else</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-599><a id=__codelineno-0-599 name=__codelineno-0-599></a>            <span class=p>)</span>
</span><span id=__span-0-600><a id=__codelineno-0-600 name=__codelineno-0-600></a>
</span><span id=__span-0-601><a id=__codelineno-0-601 name=__codelineno-0-601></a>        <span class=bp>self</span><span class=o>.</span><span class=n>add_reply</span> <span class=o>=</span> <span class=n>add_reply</span>
</span><span id=__span-0-602><a id=__codelineno-0-602 name=__codelineno-0-602></a>
</span><span id=__span-0-603><a id=__codelineno-0-603 name=__codelineno-0-603></a>        <span class=k>def</span><span class=w> </span><span class=nf>get_thread</span><span class=p>(</span><span class=n>thread_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_thread_id</span><span class=p>):</span>
</span><span id=__span-0-604><a id=__codelineno-0-604 name=__codelineno-0-604></a><span class=w>            </span><span class=sd>&quot;&quot;&quot;Returns the current Thread object or the requested Thread.&quot;&quot;&quot;</span>
</span><span id=__span-0-605><a id=__codelineno-0-605 name=__codelineno-0-605></a>            <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>get_thread</span><span class=p>(</span><span class=n>thread_id</span><span class=p>)</span>
</span><span id=__span-0-606><a id=__codelineno-0-606 name=__codelineno-0-606></a>
</span><span id=__span-0-607><a id=__codelineno-0-607 name=__codelineno-0-607></a>        <span class=bp>self</span><span class=o>.</span><span class=n>get_thread</span> <span class=o>=</span> <span class=n>get_thread</span>
</span><span id=__span-0-608><a id=__codelineno-0-608 name=__codelineno-0-608></a>
</span><span id=__span-0-609><a id=__codelineno-0-609 name=__codelineno-0-609></a>        <span class=k>def</span><span class=w> </span><span class=nf>_add_message</span><span class=p>(</span>
</span><span id=__span-0-610><a id=__codelineno-0-610 name=__codelineno-0-610></a>            <span class=n>role</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-611><a id=__codelineno-0-611 name=__codelineno-0-611></a>            <span class=n>message</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-612><a id=__codelineno-0-612 name=__codelineno-0-612></a>            <span class=n>attachments</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Iterable</span><span class=p>[</span><span class=n>Attachment</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-613><a id=__codelineno-0-613 name=__codelineno-0-613></a>            <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span>
</span><span id=__span-0-614><a id=__codelineno-0-614 name=__codelineno-0-614></a>        <span class=p>):</span>
</span><span id=__span-0-615><a id=__codelineno-0-615 name=__codelineno-0-615></a>            <span class=k>return</span> <span class=n>hub_client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>messages</span><span class=o>.</span><span class=n>create</span><span class=p>(</span>
</span><span id=__span-0-616><a id=__codelineno-0-616 name=__codelineno-0-616></a>                <span class=n>thread_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_thread_id</span><span class=p>,</span>
</span><span id=__span-0-617><a id=__codelineno-0-617 name=__codelineno-0-617></a>                <span class=n>role</span><span class=o>=</span><span class=n>role</span><span class=p>,</span>  <span class=c1># type: ignore</span>
</span><span id=__span-0-618><a id=__codelineno-0-618 name=__codelineno-0-618></a>                <span class=n>content</span><span class=o>=</span><span class=n>message</span><span class=p>,</span>
</span><span id=__span-0-619><a id=__codelineno-0-619 name=__codelineno-0-619></a>                <span class=n>extra_body</span><span class=o>=</span><span class=p>{</span>
</span><span id=__span-0-620><a id=__codelineno-0-620 name=__codelineno-0-620></a>                    <span class=s2>&quot;assistant_id&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_primary_agent</span><span class=p>()</span><span class=o>.</span><span class=n>identifier</span><span class=p>,</span>
</span><span id=__span-0-621><a id=__codelineno-0-621 name=__codelineno-0-621></a>                    <span class=s2>&quot;run_id&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_run_id</span><span class=p>,</span>
</span><span id=__span-0-622><a id=__codelineno-0-622 name=__codelineno-0-622></a>                <span class=p>},</span>
</span><span id=__span-0-623><a id=__codelineno-0-623 name=__codelineno-0-623></a>                <span class=n>metadata</span><span class=o>=</span><span class=n>kwargs</span><span class=p>,</span>
</span><span id=__span-0-624><a id=__codelineno-0-624 name=__codelineno-0-624></a>                <span class=n>attachments</span><span class=o>=</span><span class=n>attachments</span><span class=p>,</span>
</span><span id=__span-0-625><a id=__codelineno-0-625 name=__codelineno-0-625></a>            <span class=p>)</span>
</span><span id=__span-0-626><a id=__codelineno-0-626 name=__codelineno-0-626></a>
</span><span id=__span-0-627><a id=__codelineno-0-627 name=__codelineno-0-627></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_add_message</span> <span class=o>=</span> <span class=n>_add_message</span>
</span><span id=__span-0-628><a id=__codelineno-0-628 name=__codelineno-0-628></a>
</span><span id=__span-0-629><a id=__codelineno-0-629 name=__codelineno-0-629></a>        <span class=k>def</span><span class=w> </span><span class=nf>_list_messages</span><span class=p>(</span>
</span><span id=__span-0-630><a id=__codelineno-0-630 name=__codelineno-0-630></a>            <span class=n>limit</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=n>NotGiven</span><span class=p>]</span> <span class=o>=</span> <span class=n>NOT_GIVEN</span><span class=p>,</span>
</span><span id=__span-0-631><a id=__codelineno-0-631 name=__codelineno-0-631></a>            <span class=n>order</span><span class=p>:</span> <span class=n>Literal</span><span class=p>[</span><span class=s2>&quot;asc&quot;</span><span class=p>,</span> <span class=s2>&quot;desc&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;asc&quot;</span><span class=p>,</span>
</span><span id=__span-0-632><a id=__codelineno-0-632 name=__codelineno-0-632></a>            <span class=n>thread_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-633><a id=__codelineno-0-633 name=__codelineno-0-633></a>        <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Message</span><span class=p>]:</span>
</span><span id=__span-0-634><a id=__codelineno-0-634 name=__codelineno-0-634></a><span class=w>            </span><span class=sd>&quot;&quot;&quot;Returns messages from the environment.&quot;&quot;&quot;</span>
</span><span id=__span-0-635><a id=__codelineno-0-635 name=__codelineno-0-635></a>            <span class=n>messages</span> <span class=o>=</span> <span class=n>hub_client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>messages</span><span class=o>.</span><span class=n>list</span><span class=p>(</span>
</span><span id=__span-0-636><a id=__codelineno-0-636 name=__codelineno-0-636></a>                <span class=n>thread_id</span><span class=o>=</span><span class=n>thread_id</span> <span class=ow>or</span> <span class=bp>self</span><span class=o>.</span><span class=n>_thread_id</span><span class=p>,</span> <span class=n>limit</span><span class=o>=</span><span class=n>limit</span><span class=p>,</span> <span class=n>order</span><span class=o>=</span><span class=n>order</span>
</span><span id=__span-0-637><a id=__codelineno-0-637 name=__codelineno-0-637></a>            <span class=p>)</span>
</span><span id=__span-0-638><a id=__codelineno-0-638 name=__codelineno-0-638></a>            <span class=bp>self</span><span class=o>.</span><span class=n>add_system_log</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Retrieved </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>messages</span><span class=o>.</span><span class=n>data</span><span class=p>)</span><span class=si>}</span><span class=s2> messages from NEAR AI Hub&quot;</span><span class=p>)</span>
</span><span id=__span-0-639><a id=__codelineno-0-639 name=__codelineno-0-639></a>            <span class=k>return</span> <span class=n>messages</span><span class=o>.</span><span class=n>data</span>
</span><span id=__span-0-640><a id=__codelineno-0-640 name=__codelineno-0-640></a>
</span><span id=__span-0-641><a id=__codelineno-0-641 name=__codelineno-0-641></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_list_messages</span> <span class=o>=</span> <span class=n>_list_messages</span>
</span><span id=__span-0-642><a id=__codelineno-0-642 name=__codelineno-0-642></a>
</span><span id=__span-0-643><a id=__codelineno-0-643 name=__codelineno-0-643></a>        <span class=k>def</span><span class=w> </span><span class=nf>list_files_from_thread</span><span class=p>(</span>
</span><span id=__span-0-644><a id=__codelineno-0-644 name=__codelineno-0-644></a>            <span class=n>order</span><span class=p>:</span> <span class=n>Literal</span><span class=p>[</span><span class=s2>&quot;asc&quot;</span><span class=p>,</span> <span class=s2>&quot;desc&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;asc&quot;</span><span class=p>,</span> <span class=n>thread_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-645><a id=__codelineno-0-645 name=__codelineno-0-645></a>        <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>FileObject</span><span class=p>]:</span>
</span><span id=__span-0-646><a id=__codelineno-0-646 name=__codelineno-0-646></a><span class=w>            </span><span class=sd>&quot;&quot;&quot;Lists files in the thread.&quot;&quot;&quot;</span>
</span><span id=__span-0-647><a id=__codelineno-0-647 name=__codelineno-0-647></a>            <span class=n>messages</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_list_messages</span><span class=p>(</span><span class=n>order</span><span class=o>=</span><span class=n>order</span><span class=p>)</span>
</span><span id=__span-0-648><a id=__codelineno-0-648 name=__codelineno-0-648></a>            <span class=c1># Extract attachments from messages</span>
</span><span id=__span-0-649><a id=__codelineno-0-649 name=__codelineno-0-649></a>            <span class=n>attachments</span> <span class=o>=</span> <span class=p>[</span><span class=n>a</span> <span class=k>for</span> <span class=n>m</span> <span class=ow>in</span> <span class=n>messages</span> <span class=k>if</span> <span class=n>m</span><span class=o>.</span><span class=n>attachments</span> <span class=k>for</span> <span class=n>a</span> <span class=ow>in</span> <span class=n>m</span><span class=o>.</span><span class=n>attachments</span><span class=p>]</span>
</span><span id=__span-0-650><a id=__codelineno-0-650 name=__codelineno-0-650></a>            <span class=c1># Extract files from attachments</span>
</span><span id=__span-0-651><a id=__codelineno-0-651 name=__codelineno-0-651></a>            <span class=n>file_ids</span> <span class=o>=</span> <span class=p>[</span><span class=n>a</span><span class=o>.</span><span class=n>file_id</span> <span class=k>for</span> <span class=n>a</span> <span class=ow>in</span> <span class=n>attachments</span><span class=p>]</span>
</span><span id=__span-0-652><a id=__codelineno-0-652 name=__codelineno-0-652></a>            <span class=n>files</span> <span class=o>=</span> <span class=p>[</span><span class=n>hub_client</span><span class=o>.</span><span class=n>files</span><span class=o>.</span><span class=n>retrieve</span><span class=p>(</span><span class=n>f</span><span class=p>)</span> <span class=k>for</span> <span class=n>f</span> <span class=ow>in</span> <span class=n>file_ids</span> <span class=k>if</span> <span class=n>f</span><span class=p>]</span>
</span><span id=__span-0-653><a id=__codelineno-0-653 name=__codelineno-0-653></a>            <span class=k>return</span> <span class=n>files</span>
</span><span id=__span-0-654><a id=__codelineno-0-654 name=__codelineno-0-654></a>
</span><span id=__span-0-655><a id=__codelineno-0-655 name=__codelineno-0-655></a>        <span class=bp>self</span><span class=o>.</span><span class=n>list_files_from_thread</span> <span class=o>=</span> <span class=n>list_files_from_thread</span>
</span><span id=__span-0-656><a id=__codelineno-0-656 name=__codelineno-0-656></a>
</span><span id=__span-0-657><a id=__codelineno-0-657 name=__codelineno-0-657></a>        <span class=k>def</span><span class=w> </span><span class=nf>read_file_by_id</span><span class=p>(</span><span class=n>file_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-658><a id=__codelineno-0-658 name=__codelineno-0-658></a><span class=w>            </span><span class=sd>&quot;&quot;&quot;Read a file from the thread.&quot;&quot;&quot;</span>
</span><span id=__span-0-659><a id=__codelineno-0-659 name=__codelineno-0-659></a>            <span class=n>content</span> <span class=o>=</span> <span class=n>hub_client</span><span class=o>.</span><span class=n>files</span><span class=o>.</span><span class=n>content</span><span class=p>(</span><span class=n>file_id</span><span class=p>)</span><span class=o>.</span><span class=n>content</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s2>&quot;utf-8&quot;</span><span class=p>)</span>
</span><span id=__span-0-660><a id=__codelineno-0-660 name=__codelineno-0-660></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;file content returned by api&quot;</span><span class=p>,</span> <span class=n>content</span><span class=p>)</span>
</span><span id=__span-0-661><a id=__codelineno-0-661 name=__codelineno-0-661></a>            <span class=k>return</span> <span class=n>content</span>
</span><span id=__span-0-662><a id=__codelineno-0-662 name=__codelineno-0-662></a>
</span><span id=__span-0-663><a id=__codelineno-0-663 name=__codelineno-0-663></a>        <span class=bp>self</span><span class=o>.</span><span class=n>read_file_by_id</span> <span class=o>=</span> <span class=n>read_file_by_id</span>
</span><span id=__span-0-664><a id=__codelineno-0-664 name=__codelineno-0-664></a>
</span><span id=__span-0-665><a id=__codelineno-0-665 name=__codelineno-0-665></a>        <span class=k>def</span><span class=w> </span><span class=nf>write_file</span><span class=p>(</span>
</span><span id=__span-0-666><a id=__codelineno-0-666 name=__codelineno-0-666></a>            <span class=n>filename</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-667><a id=__codelineno-0-667 name=__codelineno-0-667></a>            <span class=n>content</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>bytes</span><span class=p>],</span>
</span><span id=__span-0-668><a id=__codelineno-0-668 name=__codelineno-0-668></a>            <span class=n>encoding</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;utf-8&quot;</span><span class=p>,</span>
</span><span id=__span-0-669><a id=__codelineno-0-669 name=__codelineno-0-669></a>            <span class=n>filetype</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;text/plain&quot;</span><span class=p>,</span>
</span><span id=__span-0-670><a id=__codelineno-0-670 name=__codelineno-0-670></a>            <span class=n>write_to_disk</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-671><a id=__codelineno-0-671 name=__codelineno-0-671></a>        <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>FileObject</span><span class=p>:</span>
</span><span id=__span-0-672><a id=__codelineno-0-672 name=__codelineno-0-672></a><span class=w>            </span><span class=sd>&quot;&quot;&quot;Writes a file to the environment.</span>
</span><span id=__span-0-673><a id=__codelineno-0-673 name=__codelineno-0-673></a>
</span><span id=__span-0-674><a id=__codelineno-0-674 name=__codelineno-0-674></a><span class=sd>            filename: The name of the file to write to</span>
</span><span id=__span-0-675><a id=__codelineno-0-675 name=__codelineno-0-675></a><span class=sd>            content: The content to write to the file</span>
</span><span id=__span-0-676><a id=__codelineno-0-676 name=__codelineno-0-676></a><span class=sd>            encoding: The encoding to use when writing the file (default is utf-8)</span>
</span><span id=__span-0-677><a id=__codelineno-0-677 name=__codelineno-0-677></a><span class=sd>            filetype: The MIME type of the file (default is text/plain)</span>
</span><span id=__span-0-678><a id=__codelineno-0-678 name=__codelineno-0-678></a><span class=sd>            write_to_disk: If True, write locally to disk (default is True)</span>
</span><span id=__span-0-679><a id=__codelineno-0-679 name=__codelineno-0-679></a><span class=sd>            &quot;&quot;&quot;</span>
</span><span id=__span-0-680><a id=__codelineno-0-680 name=__codelineno-0-680></a>            <span class=k>if</span> <span class=n>write_to_disk</span><span class=p>:</span>
</span><span id=__span-0-681><a id=__codelineno-0-681 name=__codelineno-0-681></a>                <span class=c1># Write locally</span>
</span><span id=__span-0-682><a id=__codelineno-0-682 name=__codelineno-0-682></a>                <span class=n>path</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>get_primary_agent_temp_dir</span><span class=p>())</span> <span class=o>/</span> <span class=n>filename</span>
</span><span id=__span-0-683><a id=__codelineno-0-683 name=__codelineno-0-683></a>                <span class=n>path</span><span class=o>.</span><span class=n>parent</span><span class=o>.</span><span class=n>mkdir</span><span class=p>(</span><span class=n>parents</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-684><a id=__codelineno-0-684 name=__codelineno-0-684></a>                <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>content</span><span class=p>,</span> <span class=nb>bytes</span><span class=p>):</span>
</span><span id=__span-0-685><a id=__codelineno-0-685 name=__codelineno-0-685></a>                    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=s2>&quot;wb&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-686><a id=__codelineno-0-686 name=__codelineno-0-686></a>                        <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>
</span><span id=__span-0-687><a id=__codelineno-0-687 name=__codelineno-0-687></a>                <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-688><a id=__codelineno-0-688 name=__codelineno-0-688></a>                    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=s2>&quot;w&quot;</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=n>encoding</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-689><a id=__codelineno-0-689 name=__codelineno-0-689></a>                        <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>
</span><span id=__span-0-690><a id=__codelineno-0-690 name=__codelineno-0-690></a>
</span><span id=__span-0-691><a id=__codelineno-0-691 name=__codelineno-0-691></a>            <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>content</span><span class=p>,</span> <span class=nb>bytes</span><span class=p>):</span>
</span><span id=__span-0-692><a id=__codelineno-0-692 name=__codelineno-0-692></a>                <span class=n>file_data</span> <span class=o>=</span> <span class=n>content</span>
</span><span id=__span-0-693><a id=__codelineno-0-693 name=__codelineno-0-693></a>            <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-694><a id=__codelineno-0-694 name=__codelineno-0-694></a>                <span class=n>file_data</span> <span class=o>=</span> <span class=n>io</span><span class=o>.</span><span class=n>BytesIO</span><span class=p>(</span><span class=n>content</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=n>encoding</span><span class=p>))</span>  <span class=c1># type:ignore</span>
</span><span id=__span-0-695><a id=__codelineno-0-695 name=__codelineno-0-695></a>
</span><span id=__span-0-696><a id=__codelineno-0-696 name=__codelineno-0-696></a>            <span class=c1># Upload to Hub</span>
</span><span id=__span-0-697><a id=__codelineno-0-697 name=__codelineno-0-697></a>            <span class=n>file</span> <span class=o>=</span> <span class=n>hub_client</span><span class=o>.</span><span class=n>files</span><span class=o>.</span><span class=n>create</span><span class=p>(</span><span class=n>file</span><span class=o>=</span><span class=p>(</span><span class=n>filename</span><span class=p>,</span> <span class=n>file_data</span><span class=p>,</span> <span class=n>filetype</span><span class=p>),</span> <span class=n>purpose</span><span class=o>=</span><span class=s2>&quot;assistants&quot;</span><span class=p>)</span>
</span><span id=__span-0-698><a id=__codelineno-0-698 name=__codelineno-0-698></a>            <span class=n>res</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>add_reply</span><span class=p>(</span>
</span><span id=__span-0-699><a id=__codelineno-0-699 name=__codelineno-0-699></a>                <span class=n>message</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;Successfully wrote </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>content</span><span class=p>)</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=n>content</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=mi>0</span><span class=si>}</span><span class=s2> characters to </span><span class=si>{</span><span class=n>filename</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-0-700><a id=__codelineno-0-700 name=__codelineno-0-700></a>                <span class=n>attachments</span><span class=o>=</span><span class=p>[{</span><span class=s2>&quot;file_id&quot;</span><span class=p>:</span> <span class=n>file</span><span class=o>.</span><span class=n>id</span><span class=p>,</span> <span class=s2>&quot;tools&quot;</span><span class=p>:</span> <span class=p>[{</span><span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;file_search&quot;</span><span class=p>}]}],</span>
</span><span id=__span-0-701><a id=__codelineno-0-701 name=__codelineno-0-701></a>                <span class=n>message_type</span><span class=o>=</span><span class=s2>&quot;system:file_write&quot;</span><span class=p>,</span>
</span><span id=__span-0-702><a id=__codelineno-0-702 name=__codelineno-0-702></a>            <span class=p>)</span>
</span><span id=__span-0-703><a id=__codelineno-0-703 name=__codelineno-0-703></a>            <span class=bp>self</span><span class=o>.</span><span class=n>add_system_log</span><span class=p>(</span>
</span><span id=__span-0-704><a id=__codelineno-0-704 name=__codelineno-0-704></a>                <span class=sa>f</span><span class=s2>&quot;Uploaded file </span><span class=si>{</span><span class=n>filename</span><span class=si>}</span><span class=s2> with </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>content</span><span class=p>)</span><span class=si>}</span><span class=s2> characters, id: </span><span class=si>{</span><span class=n>file</span><span class=o>.</span><span class=n>id</span><span class=si>}</span><span class=s2>. Added in thread as: </span><span class=si>{</span><span class=n>res</span><span class=o>.</span><span class=n>id</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-705><a id=__codelineno-0-705 name=__codelineno-0-705></a>            <span class=p>)</span>
</span><span id=__span-0-706><a id=__codelineno-0-706 name=__codelineno-0-706></a>            <span class=k>return</span> <span class=n>file</span>
</span><span id=__span-0-707><a id=__codelineno-0-707 name=__codelineno-0-707></a>
</span><span id=__span-0-708><a id=__codelineno-0-708 name=__codelineno-0-708></a>        <span class=bp>self</span><span class=o>.</span><span class=n>write_file</span> <span class=o>=</span> <span class=n>write_file</span>
</span><span id=__span-0-709><a id=__codelineno-0-709 name=__codelineno-0-709></a>
</span><span id=__span-0-710><a id=__codelineno-0-710 name=__codelineno-0-710></a>        <span class=k>def</span><span class=w> </span><span class=nf>mark_done</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n>Run</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-711><a id=__codelineno-0-711 name=__codelineno-0-711></a>            <span class=bp>self</span><span class=o>.</span><span class=n>_done</span> <span class=o>=</span> <span class=kc>True</span>
</span><span id=__span-0-712><a id=__codelineno-0-712 name=__codelineno-0-712></a>            <span class=n>res</span> <span class=o>=</span> <span class=n>hub_client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>runs</span><span class=o>.</span><span class=n>update</span><span class=p>(</span>
</span><span id=__span-0-713><a id=__codelineno-0-713 name=__codelineno-0-713></a>                <span class=n>thread_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_thread_id</span><span class=p>,</span>
</span><span id=__span-0-714><a id=__codelineno-0-714 name=__codelineno-0-714></a>                <span class=n>run_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_run_id</span><span class=p>,</span>
</span><span id=__span-0-715><a id=__codelineno-0-715 name=__codelineno-0-715></a>                <span class=n>extra_body</span><span class=o>=</span><span class=p>{</span>
</span><span id=__span-0-716><a id=__codelineno-0-716 name=__codelineno-0-716></a>                    <span class=s2>&quot;status&quot;</span><span class=p>:</span> <span class=s2>&quot;completed&quot;</span><span class=p>,</span>
</span><span id=__span-0-717><a id=__codelineno-0-717 name=__codelineno-0-717></a>                    <span class=s2>&quot;completed_at&quot;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>(),</span>
</span><span id=__span-0-718><a id=__codelineno-0-718 name=__codelineno-0-718></a>                <span class=p>},</span>
</span><span id=__span-0-719><a id=__codelineno-0-719 name=__codelineno-0-719></a>            <span class=p>)</span>
</span><span id=__span-0-720><a id=__codelineno-0-720 name=__codelineno-0-720></a>            <span class=k>return</span> <span class=n>res</span>
</span><span id=__span-0-721><a id=__codelineno-0-721 name=__codelineno-0-721></a>
</span><span id=__span-0-722><a id=__codelineno-0-722 name=__codelineno-0-722></a>        <span class=bp>self</span><span class=o>.</span><span class=n>mark_done</span> <span class=o>=</span> <span class=n>mark_done</span>
</span><span id=__span-0-723><a id=__codelineno-0-723 name=__codelineno-0-723></a>
</span><span id=__span-0-724><a id=__codelineno-0-724 name=__codelineno-0-724></a>        <span class=k>def</span><span class=w> </span><span class=nf>mark_failed</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n>Run</span><span class=p>:</span>
</span><span id=__span-0-725><a id=__codelineno-0-725 name=__codelineno-0-725></a><span class=w>            </span><span class=sd>&quot;&quot;&quot;Marks the environment run as failed.&quot;&quot;&quot;</span>
</span><span id=__span-0-726><a id=__codelineno-0-726 name=__codelineno-0-726></a>            <span class=bp>self</span><span class=o>.</span><span class=n>_done</span> <span class=o>=</span> <span class=kc>True</span>
</span><span id=__span-0-727><a id=__codelineno-0-727 name=__codelineno-0-727></a>            <span class=bp>self</span><span class=o>.</span><span class=n>add_system_log</span><span class=p>(</span><span class=s2>&quot;Environment run failed&quot;</span><span class=p>,</span> <span class=n>logging</span><span class=o>.</span><span class=n>ERROR</span><span class=p>)</span>
</span><span id=__span-0-728><a id=__codelineno-0-728 name=__codelineno-0-728></a>            <span class=n>res</span> <span class=o>=</span> <span class=n>hub_client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>runs</span><span class=o>.</span><span class=n>update</span><span class=p>(</span>
</span><span id=__span-0-729><a id=__codelineno-0-729 name=__codelineno-0-729></a>                <span class=n>thread_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_thread_id</span><span class=p>,</span>
</span><span id=__span-0-730><a id=__codelineno-0-730 name=__codelineno-0-730></a>                <span class=n>run_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_run_id</span><span class=p>,</span>
</span><span id=__span-0-731><a id=__codelineno-0-731 name=__codelineno-0-731></a>                <span class=n>extra_body</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;status&quot;</span><span class=p>:</span> <span class=s2>&quot;failed&quot;</span><span class=p>,</span> <span class=s2>&quot;failed_at&quot;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()},</span>
</span><span id=__span-0-732><a id=__codelineno-0-732 name=__codelineno-0-732></a>            <span class=p>)</span>
</span><span id=__span-0-733><a id=__codelineno-0-733 name=__codelineno-0-733></a>            <span class=k>return</span> <span class=n>res</span>
</span><span id=__span-0-734><a id=__codelineno-0-734 name=__codelineno-0-734></a>
</span><span id=__span-0-735><a id=__codelineno-0-735 name=__codelineno-0-735></a>        <span class=bp>self</span><span class=o>.</span><span class=n>mark_failed</span> <span class=o>=</span> <span class=n>mark_failed</span>
</span><span id=__span-0-736><a id=__codelineno-0-736 name=__codelineno-0-736></a>
</span><span id=__span-0-737><a id=__codelineno-0-737 name=__codelineno-0-737></a>        <span class=k>def</span><span class=w> </span><span class=nf>request_user_input</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n>Run</span><span class=p>:</span>
</span><span id=__span-0-738><a id=__codelineno-0-738 name=__codelineno-0-738></a><span class=w>            </span><span class=sd>&quot;&quot;&quot;Must be called to request input from the user.&quot;&quot;&quot;</span>
</span><span id=__span-0-739><a id=__codelineno-0-739 name=__codelineno-0-739></a>            <span class=k>return</span> <span class=n>hub_client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>runs</span><span class=o>.</span><span class=n>update</span><span class=p>(</span>
</span><span id=__span-0-740><a id=__codelineno-0-740 name=__codelineno-0-740></a>                <span class=n>thread_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_thread_id</span><span class=p>,</span>
</span><span id=__span-0-741><a id=__codelineno-0-741 name=__codelineno-0-741></a>                <span class=n>run_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_run_id</span><span class=p>,</span>
</span><span id=__span-0-742><a id=__codelineno-0-742 name=__codelineno-0-742></a>                <span class=n>extra_body</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;status&quot;</span><span class=p>:</span> <span class=s2>&quot;requires_action&quot;</span><span class=p>,</span> <span class=s2>&quot;required_action&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;user_input&quot;</span><span class=p>}},</span>
</span><span id=__span-0-743><a id=__codelineno-0-743 name=__codelineno-0-743></a>            <span class=p>)</span>
</span><span id=__span-0-744><a id=__codelineno-0-744 name=__codelineno-0-744></a>
</span><span id=__span-0-745><a id=__codelineno-0-745 name=__codelineno-0-745></a>        <span class=bp>self</span><span class=o>.</span><span class=n>request_user_input</span> <span class=o>=</span> <span class=n>request_user_input</span>
</span><span id=__span-0-746><a id=__codelineno-0-746 name=__codelineno-0-746></a>
</span><span id=__span-0-747><a id=__codelineno-0-747 name=__codelineno-0-747></a>        <span class=k>def</span><span class=w> </span><span class=nf>request_agent_input</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n>Run</span><span class=p>:</span>
</span><span id=__span-0-748><a id=__codelineno-0-748 name=__codelineno-0-748></a><span class=w>            </span><span class=sd>&quot;&quot;&quot;Mark the run as ready for input from another agent.&quot;&quot;&quot;</span>
</span><span id=__span-0-749><a id=__codelineno-0-749 name=__codelineno-0-749></a>            <span class=k>return</span> <span class=n>hub_client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>runs</span><span class=o>.</span><span class=n>update</span><span class=p>(</span>
</span><span id=__span-0-750><a id=__codelineno-0-750 name=__codelineno-0-750></a>                <span class=n>thread_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_thread_id</span><span class=p>,</span>
</span><span id=__span-0-751><a id=__codelineno-0-751 name=__codelineno-0-751></a>                <span class=n>run_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_run_id</span><span class=p>,</span>
</span><span id=__span-0-752><a id=__codelineno-0-752 name=__codelineno-0-752></a>                <span class=n>extra_body</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;status&quot;</span><span class=p>:</span> <span class=s2>&quot;requires_action&quot;</span><span class=p>,</span> <span class=s2>&quot;required_action&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;agent_input&quot;</span><span class=p>}},</span>
</span><span id=__span-0-753><a id=__codelineno-0-753 name=__codelineno-0-753></a>            <span class=p>)</span>
</span><span id=__span-0-754><a id=__codelineno-0-754 name=__codelineno-0-754></a>
</span><span id=__span-0-755><a id=__codelineno-0-755 name=__codelineno-0-755></a>        <span class=bp>self</span><span class=o>.</span><span class=n>request_agent_input</span> <span class=o>=</span> <span class=n>request_agent_input</span>
</span><span id=__span-0-756><a id=__codelineno-0-756 name=__codelineno-0-756></a>
</span><span id=__span-0-757><a id=__codelineno-0-757 name=__codelineno-0-757></a>        <span class=c1># Must be placed after method definitions</span>
</span><span id=__span-0-758><a id=__codelineno-0-758 name=__codelineno-0-758></a>        <span class=bp>self</span><span class=o>.</span><span class=n>register_standard_tools</span><span class=p>()</span>
</span><span id=__span-0-759><a id=__codelineno-0-759 name=__codelineno-0-759></a>
</span><span id=__span-0-760><a id=__codelineno-0-760 name=__codelineno-0-760></a>    <span class=c1># end of protected client methods</span>
</span><span id=__span-0-761><a id=__codelineno-0-761 name=__codelineno-0-761></a>
</span><span id=__span-0-762><a id=__codelineno-0-762 name=__codelineno-0-762></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_tool_registry</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>new</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>ToolRegistry</span><span class=p>:</span>
</span><span id=__span-0-763><a id=__codelineno-0-763 name=__codelineno-0-763></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns the tool registry, a dictionary of tools that can be called by the agent.&quot;&quot;&quot;</span>
</span><span id=__span-0-764><a id=__codelineno-0-764 name=__codelineno-0-764></a>        <span class=k>if</span> <span class=n>new</span><span class=p>:</span>
</span><span id=__span-0-765><a id=__codelineno-0-765 name=__codelineno-0-765></a>            <span class=bp>self</span><span class=o>.</span><span class=n>_tools</span> <span class=o>=</span> <span class=n>ToolRegistry</span><span class=p>()</span>
</span><span id=__span-0-766><a id=__codelineno-0-766 name=__codelineno-0-766></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_tools</span>
</span><span id=__span-0-767><a id=__codelineno-0-767 name=__codelineno-0-767></a>
</span><span id=__span-0-768><a id=__codelineno-0-768 name=__codelineno-0-768></a>    <span class=k>def</span><span class=w> </span><span class=nf>register_standard_tools</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-769><a id=__codelineno-0-769 name=__codelineno-0-769></a>        <span class=n>reg</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_tool_registry</span><span class=p>()</span>
</span><span id=__span-0-770><a id=__codelineno-0-770 name=__codelineno-0-770></a>        <span class=n>reg</span><span class=o>.</span><span class=n>register_tool</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>exec_command</span><span class=p>)</span>
</span><span id=__span-0-771><a id=__codelineno-0-771 name=__codelineno-0-771></a>        <span class=n>reg</span><span class=o>.</span><span class=n>register_tool</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>read_file</span><span class=p>)</span>
</span><span id=__span-0-772><a id=__codelineno-0-772 name=__codelineno-0-772></a>        <span class=n>reg</span><span class=o>.</span><span class=n>register_tool</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>write_file</span><span class=p>)</span>
</span><span id=__span-0-773><a id=__codelineno-0-773 name=__codelineno-0-773></a>        <span class=n>reg</span><span class=o>.</span><span class=n>register_tool</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>request_user_input</span><span class=p>)</span>
</span><span id=__span-0-774><a id=__codelineno-0-774 name=__codelineno-0-774></a>        <span class=n>reg</span><span class=o>.</span><span class=n>register_tool</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>list_files</span><span class=p>)</span>
</span><span id=__span-0-775><a id=__codelineno-0-775 name=__codelineno-0-775></a>        <span class=n>reg</span><span class=o>.</span><span class=n>register_tool</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>query_vector_store</span><span class=p>)</span>
</span><span id=__span-0-776><a id=__codelineno-0-776 name=__codelineno-0-776></a>
</span><span id=__span-0-777><a id=__codelineno-0-777 name=__codelineno-0-777></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_last_message</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>role</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;user&quot;</span><span class=p>):</span>
</span><span id=__span-0-778><a id=__codelineno-0-778 name=__codelineno-0-778></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Reads last message from the given role and returns it.&quot;&quot;&quot;</span>
</span><span id=__span-0-779><a id=__codelineno-0-779 name=__codelineno-0-779></a>        <span class=k>for</span> <span class=n>message</span> <span class=ow>in</span> <span class=nb>reversed</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>list_messages</span><span class=p>()):</span>
</span><span id=__span-0-780><a id=__codelineno-0-780 name=__codelineno-0-780></a>            <span class=k>if</span> <span class=n>message</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;role&quot;</span><span class=p>)</span> <span class=o>==</span> <span class=n>role</span><span class=p>:</span>
</span><span id=__span-0-781><a id=__codelineno-0-781 name=__codelineno-0-781></a>                <span class=k>return</span> <span class=n>message</span>
</span><span id=__span-0-782><a id=__codelineno-0-782 name=__codelineno-0-782></a>
</span><span id=__span-0-783><a id=__codelineno-0-783 name=__codelineno-0-783></a>        <span class=k>return</span> <span class=kc>None</span>
</span><span id=__span-0-784><a id=__codelineno-0-784 name=__codelineno-0-784></a>
</span><span id=__span-0-785><a id=__codelineno-0-785 name=__codelineno-0-785></a>    <span class=k>def</span><span class=w> </span><span class=nf>add_message</span><span class=p>(</span>
</span><span id=__span-0-786><a id=__codelineno-0-786 name=__codelineno-0-786></a>        <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-787><a id=__codelineno-0-787 name=__codelineno-0-787></a>        <span class=n>role</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-788><a id=__codelineno-0-788 name=__codelineno-0-788></a>        <span class=n>message</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-789><a id=__codelineno-0-789 name=__codelineno-0-789></a>        <span class=n>attachments</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Iterable</span><span class=p>[</span><span class=n>Attachment</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-790><a id=__codelineno-0-790 name=__codelineno-0-790></a>        <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span>
</span><span id=__span-0-791><a id=__codelineno-0-791 name=__codelineno-0-791></a>    <span class=p>):</span>
</span><span id=__span-0-792><a id=__codelineno-0-792 name=__codelineno-0-792></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Deprecated. Please use `add_reply` instead. Assistant adds a message to the environment.&quot;&quot;&quot;</span>
</span><span id=__span-0-793><a id=__codelineno-0-793 name=__codelineno-0-793></a>        <span class=c1># Prevent agent to save messages on behalf of `user` to avoid adding false memory</span>
</span><span id=__span-0-794><a id=__codelineno-0-794 name=__codelineno-0-794></a>        <span class=n>role</span> <span class=o>=</span> <span class=s2>&quot;assistant&quot;</span>
</span><span id=__span-0-795><a id=__codelineno-0-795 name=__codelineno-0-795></a>
</span><span id=__span-0-796><a id=__codelineno-0-796 name=__codelineno-0-796></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_add_message</span><span class=p>(</span><span class=n>role</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=n>attachments</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span><span id=__span-0-797><a id=__codelineno-0-797 name=__codelineno-0-797></a>
</span><span id=__span-0-798><a id=__codelineno-0-798 name=__codelineno-0-798></a>    <span class=k>def</span><span class=w> </span><span class=nf>add_system_log</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>log</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>level</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>INFO</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-799><a id=__codelineno-0-799 name=__codelineno-0-799></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Add system log with timestamp and log level.&quot;&quot;&quot;</span>
</span><span id=__span-0-800><a id=__codelineno-0-800 name=__codelineno-0-800></a>        <span class=n>logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=s2>&quot;system_logger&quot;</span><span class=p>)</span>
</span><span id=__span-0-801><a id=__codelineno-0-801 name=__codelineno-0-801></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>logger</span><span class=o>.</span><span class=n>handlers</span><span class=p>:</span>
</span><span id=__span-0-802><a id=__codelineno-0-802 name=__codelineno-0-802></a>            <span class=c1># Configure the logger if it hasn&#39;t been set up yet</span>
</span><span id=__span-0-803><a id=__codelineno-0-803 name=__codelineno-0-803></a>            <span class=n>logger</span><span class=o>.</span><span class=n>setLevel</span><span class=p>(</span><span class=n>logging</span><span class=o>.</span><span class=n>DEBUG</span><span class=p>)</span>
</span><span id=__span-0-804><a id=__codelineno-0-804 name=__codelineno-0-804></a>            <span class=n>file_handler</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>FileHandler</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_path</span><span class=p>,</span> <span class=n>SYSTEM_LOG_FILENAME</span><span class=p>))</span>
</span><span id=__span-0-805><a id=__codelineno-0-805 name=__codelineno-0-805></a>            <span class=n>formatter</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>Formatter</span><span class=p>(</span><span class=s2>&quot;</span><span class=si>%(asctime)s</span><span class=s2> - </span><span class=si>%(levelname)s</span><span class=s2> - </span><span class=si>%(message)s</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>datefmt</span><span class=o>=</span><span class=s2>&quot;%Y-%m-</span><span class=si>%d</span><span class=s2> %H:%M:%S&quot;</span><span class=p>)</span>
</span><span id=__span-0-806><a id=__codelineno-0-806 name=__codelineno-0-806></a>            <span class=n>file_handler</span><span class=o>.</span><span class=n>setFormatter</span><span class=p>(</span><span class=n>formatter</span><span class=p>)</span>
</span><span id=__span-0-807><a id=__codelineno-0-807 name=__codelineno-0-807></a>            <span class=n>logger</span><span class=o>.</span><span class=n>addHandler</span><span class=p>(</span><span class=n>file_handler</span><span class=p>)</span>
</span><span id=__span-0-808><a id=__codelineno-0-808 name=__codelineno-0-808></a>
</span><span id=__span-0-809><a id=__codelineno-0-809 name=__codelineno-0-809></a>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>print_system_log</span><span class=p>:</span>
</span><span id=__span-0-810><a id=__codelineno-0-810 name=__codelineno-0-810></a>                <span class=n>console_handler</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>StreamHandler</span><span class=p>()</span>
</span><span id=__span-0-811><a id=__codelineno-0-811 name=__codelineno-0-811></a>                <span class=n>console_handler</span><span class=o>.</span><span class=n>setFormatter</span><span class=p>(</span><span class=n>formatter</span><span class=p>)</span>
</span><span id=__span-0-812><a id=__codelineno-0-812 name=__codelineno-0-812></a>                <span class=n>logger</span><span class=o>.</span><span class=n>addHandler</span><span class=p>(</span><span class=n>console_handler</span><span class=p>)</span>
</span><span id=__span-0-813><a id=__codelineno-0-813 name=__codelineno-0-813></a>
</span><span id=__span-0-814><a id=__codelineno-0-814 name=__codelineno-0-814></a>            <span class=c1># Add Thread log handler</span>
</span><span id=__span-0-815><a id=__codelineno-0-815 name=__codelineno-0-815></a>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_debug_mode</span><span class=p>:</span>
</span><span id=__span-0-816><a id=__codelineno-0-816 name=__codelineno-0-816></a>                <span class=n>custom_handler</span> <span class=o>=</span> <span class=n>CustomLogHandler</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>add_reply</span><span class=p>,</span> <span class=s2>&quot;system&quot;</span><span class=p>)</span>
</span><span id=__span-0-817><a id=__codelineno-0-817 name=__codelineno-0-817></a>                <span class=n>custom_handler</span><span class=o>.</span><span class=n>setFormatter</span><span class=p>(</span><span class=n>formatter</span><span class=p>)</span>
</span><span id=__span-0-818><a id=__codelineno-0-818 name=__codelineno-0-818></a>                <span class=n>logger</span><span class=o>.</span><span class=n>addHandler</span><span class=p>(</span><span class=n>custom_handler</span><span class=p>)</span>
</span><span id=__span-0-819><a id=__codelineno-0-819 name=__codelineno-0-819></a>
</span><span id=__span-0-820><a id=__codelineno-0-820 name=__codelineno-0-820></a>        <span class=c1># Log the message</span>
</span><span id=__span-0-821><a id=__codelineno-0-821 name=__codelineno-0-821></a>        <span class=n>logger</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=n>level</span><span class=p>,</span> <span class=n>log</span><span class=p>)</span>
</span><span id=__span-0-822><a id=__codelineno-0-822 name=__codelineno-0-822></a>        <span class=c1># Force the handler to write to disk</span>
</span><span id=__span-0-823><a id=__codelineno-0-823 name=__codelineno-0-823></a>        <span class=k>for</span> <span class=n>handler</span> <span class=ow>in</span> <span class=n>logger</span><span class=o>.</span><span class=n>handlers</span><span class=p>:</span>
</span><span id=__span-0-824><a id=__codelineno-0-824 name=__codelineno-0-824></a>            <span class=n>handler</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span><span id=__span-0-825><a id=__codelineno-0-825 name=__codelineno-0-825></a>
</span><span id=__span-0-826><a id=__codelineno-0-826 name=__codelineno-0-826></a>    <span class=k>def</span><span class=w> </span><span class=nf>add_agent_log</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>log</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>level</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>INFO</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-827><a id=__codelineno-0-827 name=__codelineno-0-827></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Add agent log with timestamp and log level.&quot;&quot;&quot;</span>
</span><span id=__span-0-828><a id=__codelineno-0-828 name=__codelineno-0-828></a>        <span class=n>logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=s2>&quot;agent_logger&quot;</span><span class=p>)</span>
</span><span id=__span-0-829><a id=__codelineno-0-829 name=__codelineno-0-829></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>logger</span><span class=o>.</span><span class=n>handlers</span><span class=p>:</span>
</span><span id=__span-0-830><a id=__codelineno-0-830 name=__codelineno-0-830></a>            <span class=c1># Configure the logger if it hasn&#39;t been set up yet</span>
</span><span id=__span-0-831><a id=__codelineno-0-831 name=__codelineno-0-831></a>            <span class=n>logger</span><span class=o>.</span><span class=n>setLevel</span><span class=p>(</span><span class=n>logging</span><span class=o>.</span><span class=n>DEBUG</span><span class=p>)</span>
</span><span id=__span-0-832><a id=__codelineno-0-832 name=__codelineno-0-832></a>            <span class=n>file_handler</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>FileHandler</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_path</span><span class=p>,</span> <span class=n>AGENT_LOG_FILENAME</span><span class=p>))</span>
</span><span id=__span-0-833><a id=__codelineno-0-833 name=__codelineno-0-833></a>            <span class=n>formatter</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>Formatter</span><span class=p>(</span><span class=s2>&quot;</span><span class=si>%(asctime)s</span><span class=s2> - </span><span class=si>%(levelname)s</span><span class=s2> - </span><span class=si>%(message)s</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>datefmt</span><span class=o>=</span><span class=s2>&quot;%Y-%m-</span><span class=si>%d</span><span class=s2> %H:%M:%S&quot;</span><span class=p>)</span>
</span><span id=__span-0-834><a id=__codelineno-0-834 name=__codelineno-0-834></a>            <span class=n>file_handler</span><span class=o>.</span><span class=n>setFormatter</span><span class=p>(</span><span class=n>formatter</span><span class=p>)</span>
</span><span id=__span-0-835><a id=__codelineno-0-835 name=__codelineno-0-835></a>            <span class=n>logger</span><span class=o>.</span><span class=n>addHandler</span><span class=p>(</span><span class=n>file_handler</span><span class=p>)</span>
</span><span id=__span-0-836><a id=__codelineno-0-836 name=__codelineno-0-836></a>
</span><span id=__span-0-837><a id=__codelineno-0-837 name=__codelineno-0-837></a>            <span class=c1># Add Thread log handler</span>
</span><span id=__span-0-838><a id=__codelineno-0-838 name=__codelineno-0-838></a>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_debug_mode</span><span class=p>:</span>
</span><span id=__span-0-839><a id=__codelineno-0-839 name=__codelineno-0-839></a>                <span class=n>custom_handler</span> <span class=o>=</span> <span class=n>CustomLogHandler</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>add_reply</span><span class=p>,</span> <span class=s2>&quot;agent&quot;</span><span class=p>)</span>
</span><span id=__span-0-840><a id=__codelineno-0-840 name=__codelineno-0-840></a>                <span class=n>custom_handler</span><span class=o>.</span><span class=n>setFormatter</span><span class=p>(</span><span class=n>formatter</span><span class=p>)</span>
</span><span id=__span-0-841><a id=__codelineno-0-841 name=__codelineno-0-841></a>                <span class=n>logger</span><span class=o>.</span><span class=n>addHandler</span><span class=p>(</span><span class=n>custom_handler</span><span class=p>)</span>
</span><span id=__span-0-842><a id=__codelineno-0-842 name=__codelineno-0-842></a>
</span><span id=__span-0-843><a id=__codelineno-0-843 name=__codelineno-0-843></a>        <span class=c1># Log the message</span>
</span><span id=__span-0-844><a id=__codelineno-0-844 name=__codelineno-0-844></a>        <span class=n>logger</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=n>level</span><span class=p>,</span> <span class=n>log</span><span class=p>)</span>
</span><span id=__span-0-845><a id=__codelineno-0-845 name=__codelineno-0-845></a>        <span class=c1># Force the handler to write to disk</span>
</span><span id=__span-0-846><a id=__codelineno-0-846 name=__codelineno-0-846></a>        <span class=k>for</span> <span class=n>handler</span> <span class=ow>in</span> <span class=n>logger</span><span class=o>.</span><span class=n>handlers</span><span class=p>:</span>
</span><span id=__span-0-847><a id=__codelineno-0-847 name=__codelineno-0-847></a>            <span class=n>handler</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span><span id=__span-0-848><a id=__codelineno-0-848 name=__codelineno-0-848></a>
</span><span id=__span-0-849><a id=__codelineno-0-849 name=__codelineno-0-849></a>    <span class=k>def</span><span class=w> </span><span class=nf>add_agent_start_system_log</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>agent_idx</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-850><a id=__codelineno-0-850 name=__codelineno-0-850></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Adds agent start system log.&quot;&quot;&quot;</span>
</span><span id=__span-0-851><a id=__codelineno-0-851 name=__codelineno-0-851></a>        <span class=n>agent</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_agents</span><span class=p>[</span><span class=n>agent_idx</span><span class=p>]</span>
</span><span id=__span-0-852><a id=__codelineno-0-852 name=__codelineno-0-852></a>        <span class=n>message</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;Running agent </span><span class=si>{</span><span class=n>agent</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-853><a id=__codelineno-0-853 name=__codelineno-0-853></a>        <span class=k>if</span> <span class=n>agent</span><span class=o>.</span><span class=n>model</span> <span class=o>!=</span> <span class=s2>&quot;&quot;</span><span class=p>:</span>
</span><span id=__span-0-854><a id=__codelineno-0-854 name=__codelineno-0-854></a>            <span class=n>model</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_model_for_inference</span><span class=p>(</span><span class=n>agent</span><span class=o>.</span><span class=n>model</span><span class=p>)</span>
</span><span id=__span-0-855><a id=__codelineno-0-855 name=__codelineno-0-855></a>            <span class=bp>self</span><span class=o>.</span><span class=n>_last_used_model</span> <span class=o>=</span> <span class=n>model</span>
</span><span id=__span-0-856><a id=__codelineno-0-856 name=__codelineno-0-856></a>            <span class=n>message</span> <span class=o>+=</span> <span class=sa>f</span><span class=s2>&quot; that will connect to </span><span class=si>{</span><span class=n>model</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-857><a id=__codelineno-0-857 name=__codelineno-0-857></a>            <span class=k>if</span> <span class=n>agent</span><span class=o>.</span><span class=n>model_temperature</span><span class=p>:</span>
</span><span id=__span-0-858><a id=__codelineno-0-858 name=__codelineno-0-858></a>                <span class=n>message</span> <span class=o>+=</span> <span class=sa>f</span><span class=s2>&quot;, temperature=</span><span class=si>{</span><span class=n>agent</span><span class=o>.</span><span class=n>model_temperature</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-859><a id=__codelineno-0-859 name=__codelineno-0-859></a>            <span class=k>if</span> <span class=n>agent</span><span class=o>.</span><span class=n>model_max_tokens</span><span class=p>:</span>
</span><span id=__span-0-860><a id=__codelineno-0-860 name=__codelineno-0-860></a>                <span class=n>message</span> <span class=o>+=</span> <span class=sa>f</span><span class=s2>&quot;, max_tokens=</span><span class=si>{</span><span class=n>agent</span><span class=o>.</span><span class=n>model_max_tokens</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-861><a id=__codelineno-0-861 name=__codelineno-0-861></a>        <span class=bp>self</span><span class=o>.</span><span class=n>add_system_log</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span><span id=__span-0-862><a id=__codelineno-0-862 name=__codelineno-0-862></a>
</span><span id=__span-0-863><a id=__codelineno-0-863 name=__codelineno-0-863></a>    <span class=k>def</span><span class=w> </span><span class=nf>list_terminal_commands</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>filename</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>TERMINAL_FILENAME</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Any</span><span class=p>]:</span>
</span><span id=__span-0-864><a id=__codelineno-0-864 name=__codelineno-0-864></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns the terminal commands from the terminal file.&quot;&quot;&quot;</span>
</span><span id=__span-0-865><a id=__codelineno-0-865 name=__codelineno-0-865></a>        <span class=n>path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_path</span><span class=p>,</span> <span class=n>filename</span><span class=p>)</span>
</span><span id=__span-0-866><a id=__codelineno-0-866 name=__codelineno-0-866></a>
</span><span id=__span-0-867><a id=__codelineno-0-867 name=__codelineno-0-867></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>path</span><span class=p>):</span>
</span><span id=__span-0-868><a id=__codelineno-0-868 name=__codelineno-0-868></a>            <span class=k>return</span> <span class=p>[]</span>
</span><span id=__span-0-869><a id=__codelineno-0-869 name=__codelineno-0-869></a>
</span><span id=__span-0-870><a id=__codelineno-0-870 name=__codelineno-0-870></a>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=s2>&quot;r&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-871><a id=__codelineno-0-871 name=__codelineno-0-871></a>            <span class=k>return</span> <span class=p>[</span><span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>message</span><span class=p>)</span> <span class=k>for</span> <span class=n>message</span> <span class=ow>in</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=n>DELIMITER</span><span class=p>)</span> <span class=k>if</span> <span class=n>message</span><span class=p>]</span>
</span><span id=__span-0-872><a id=__codelineno-0-872 name=__codelineno-0-872></a>
</span><span id=__span-0-873><a id=__codelineno-0-873 name=__codelineno-0-873></a>    <span class=k>def</span><span class=w> </span><span class=nf>list_messages</span><span class=p>(</span>
</span><span id=__span-0-874><a id=__codelineno-0-874 name=__codelineno-0-874></a>        <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-875><a id=__codelineno-0-875 name=__codelineno-0-875></a>        <span class=n>thread_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-876><a id=__codelineno-0-876 name=__codelineno-0-876></a>        <span class=n>limit</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=n>NotGiven</span><span class=p>]</span> <span class=o>=</span> <span class=mi>200</span><span class=p>,</span>  <span class=c1># api defaults to 20</span>
</span><span id=__span-0-877><a id=__codelineno-0-877 name=__codelineno-0-877></a>        <span class=n>order</span><span class=p>:</span> <span class=n>Literal</span><span class=p>[</span><span class=s2>&quot;asc&quot;</span><span class=p>,</span> <span class=s2>&quot;desc&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;asc&quot;</span><span class=p>,</span>
</span><span id=__span-0-878><a id=__codelineno-0-878 name=__codelineno-0-878></a>    <span class=p>):</span>
</span><span id=__span-0-879><a id=__codelineno-0-879 name=__codelineno-0-879></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Backwards compatibility for chat_completions messages.&quot;&quot;&quot;</span>
</span><span id=__span-0-880><a id=__codelineno-0-880 name=__codelineno-0-880></a>        <span class=n>messages</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_list_messages</span><span class=p>(</span><span class=n>thread_id</span><span class=o>=</span><span class=n>thread_id</span><span class=p>,</span> <span class=n>limit</span><span class=o>=</span><span class=n>limit</span><span class=p>,</span> <span class=n>order</span><span class=o>=</span><span class=n>order</span><span class=p>)</span>
</span><span id=__span-0-881><a id=__codelineno-0-881 name=__codelineno-0-881></a>
</span><span id=__span-0-882><a id=__codelineno-0-882 name=__codelineno-0-882></a>        <span class=c1># Filter out system and agent log messages when running in debug mode. Agent behavior shouldn&#39;t change based on logs.  # noqa: E501</span>
</span><span id=__span-0-883><a id=__codelineno-0-883 name=__codelineno-0-883></a>        <span class=n>messages</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-0-884><a id=__codelineno-0-884 name=__codelineno-0-884></a>            <span class=n>m</span>
</span><span id=__span-0-885><a id=__codelineno-0-885 name=__codelineno-0-885></a>            <span class=k>for</span> <span class=n>m</span> <span class=ow>in</span> <span class=n>messages</span>
</span><span id=__span-0-886><a id=__codelineno-0-886 name=__codelineno-0-886></a>            <span class=k>if</span> <span class=ow>not</span> <span class=p>(</span>
</span><span id=__span-0-887><a id=__codelineno-0-887 name=__codelineno-0-887></a>                <span class=n>m</span><span class=o>.</span><span class=n>metadata</span>
</span><span id=__span-0-888><a id=__codelineno-0-888 name=__codelineno-0-888></a>                <span class=ow>and</span> <span class=nb>any</span><span class=p>(</span><span class=n>m</span><span class=o>.</span><span class=n>metadata</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;message_type&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=n>prefix</span><span class=p>)</span> <span class=k>for</span> <span class=n>prefix</span> <span class=ow>in</span> <span class=p>[</span><span class=s2>&quot;system:&quot;</span><span class=p>,</span> <span class=s2>&quot;agent:&quot;</span><span class=p>])</span>
</span><span id=__span-0-889><a id=__codelineno-0-889 name=__codelineno-0-889></a>            <span class=p>)</span>
</span><span id=__span-0-890><a id=__codelineno-0-890 name=__codelineno-0-890></a>        <span class=p>]</span>
</span><span id=__span-0-891><a id=__codelineno-0-891 name=__codelineno-0-891></a>
</span><span id=__span-0-892><a id=__codelineno-0-892 name=__codelineno-0-892></a>        <span class=n>legacy_messages</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-0-893><a id=__codelineno-0-893 name=__codelineno-0-893></a>            <span class=p>{</span>
</span><span id=__span-0-894><a id=__codelineno-0-894 name=__codelineno-0-894></a>                <span class=s2>&quot;id&quot;</span><span class=p>:</span> <span class=n>m</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span><span id=__span-0-895><a id=__codelineno-0-895 name=__codelineno-0-895></a>                <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=n>c</span><span class=o>.</span><span class=n>text</span><span class=o>.</span><span class=n>value</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>m</span><span class=o>.</span><span class=n>content</span><span class=p>]),</span>  <span class=c1># type: ignore</span>
</span><span id=__span-0-896><a id=__codelineno-0-896 name=__codelineno-0-896></a>                <span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=n>m</span><span class=o>.</span><span class=n>role</span><span class=p>,</span>
</span><span id=__span-0-897><a id=__codelineno-0-897 name=__codelineno-0-897></a>            <span class=p>}</span>
</span><span id=__span-0-898><a id=__codelineno-0-898 name=__codelineno-0-898></a>            <span class=k>for</span> <span class=n>m</span> <span class=ow>in</span> <span class=n>messages</span>
</span><span id=__span-0-899><a id=__codelineno-0-899 name=__codelineno-0-899></a>        <span class=p>]</span>
</span><span id=__span-0-900><a id=__codelineno-0-900 name=__codelineno-0-900></a>        <span class=k>return</span> <span class=n>legacy_messages</span>
</span><span id=__span-0-901><a id=__codelineno-0-901 name=__codelineno-0-901></a>
</span><span id=__span-0-902><a id=__codelineno-0-902 name=__codelineno-0-902></a>    <span class=k>def</span><span class=w> </span><span class=nf>verify_message</span><span class=p>(</span>
</span><span id=__span-0-903><a id=__codelineno-0-903 name=__codelineno-0-903></a>        <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-904><a id=__codelineno-0-904 name=__codelineno-0-904></a>        <span class=n>account_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-905><a id=__codelineno-0-905 name=__codelineno-0-905></a>        <span class=n>public_key</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-906><a id=__codelineno-0-906 name=__codelineno-0-906></a>        <span class=n>signature</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-907><a id=__codelineno-0-907 name=__codelineno-0-907></a>        <span class=n>message</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-908><a id=__codelineno-0-908 name=__codelineno-0-908></a>        <span class=n>nonce</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-909><a id=__codelineno-0-909 name=__codelineno-0-909></a>        <span class=n>callback_url</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-910><a id=__codelineno-0-910 name=__codelineno-0-910></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>near</span><span class=o>.</span><span class=n>SignatureVerificationResult</span><span class=p>:</span>
</span><span id=__span-0-911><a id=__codelineno-0-911 name=__codelineno-0-911></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Verifies that the user message is signed with NEAR Account.&quot;&quot;&quot;</span>
</span><span id=__span-0-912><a id=__codelineno-0-912 name=__codelineno-0-912></a>        <span class=k>return</span> <span class=n>near</span><span class=o>.</span><span class=n>verify_signed_message</span><span class=p>(</span>
</span><span id=__span-0-913><a id=__codelineno-0-913 name=__codelineno-0-913></a>            <span class=n>account_id</span><span class=p>,</span>
</span><span id=__span-0-914><a id=__codelineno-0-914 name=__codelineno-0-914></a>            <span class=n>public_key</span><span class=p>,</span>
</span><span id=__span-0-915><a id=__codelineno-0-915 name=__codelineno-0-915></a>            <span class=n>signature</span><span class=p>,</span>
</span><span id=__span-0-916><a id=__codelineno-0-916 name=__codelineno-0-916></a>            <span class=n>message</span><span class=p>,</span>
</span><span id=__span-0-917><a id=__codelineno-0-917 name=__codelineno-0-917></a>            <span class=n>nonce</span><span class=p>,</span>
</span><span id=__span-0-918><a id=__codelineno-0-918 name=__codelineno-0-918></a>            <span class=bp>self</span><span class=o>.</span><span class=n>get_primary_agent</span><span class=p>()</span><span class=o>.</span><span class=n>name</span><span class=p>,</span>
</span><span id=__span-0-919><a id=__codelineno-0-919 name=__codelineno-0-919></a>            <span class=n>callback_url</span><span class=p>,</span>
</span><span id=__span-0-920><a id=__codelineno-0-920 name=__codelineno-0-920></a>        <span class=p>)</span>
</span><span id=__span-0-921><a id=__codelineno-0-921 name=__codelineno-0-921></a>
</span><span id=__span-0-922><a id=__codelineno-0-922 name=__codelineno-0-922></a>    <span class=k>def</span><span class=w> </span><span class=nf>list_files</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>order</span><span class=p>:</span> <span class=n>Literal</span><span class=p>[</span><span class=s2>&quot;asc&quot;</span><span class=p>,</span> <span class=s2>&quot;desc&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;asc&quot;</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
</span><span id=__span-0-923><a id=__codelineno-0-923 name=__codelineno-0-923></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Lists files in the environment.&quot;&quot;&quot;</span>
</span><span id=__span-0-924><a id=__codelineno-0-924 name=__codelineno-0-924></a>        <span class=k>return</span> <span class=n>os</span><span class=o>.</span><span class=n>listdir</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>get_primary_agent_temp_dir</span><span class=p>(),</span> <span class=n>path</span><span class=p>))</span>
</span><span id=__span-0-925><a id=__codelineno-0-925 name=__codelineno-0-925></a>
</span><span id=__span-0-926><a id=__codelineno-0-926 name=__codelineno-0-926></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_system_path</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Path</span><span class=p>:</span>
</span><span id=__span-0-927><a id=__codelineno-0-927 name=__codelineno-0-927></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns the system path where chat.txt &amp; system_log are stored.&quot;&quot;&quot;</span>
</span><span id=__span-0-928><a id=__codelineno-0-928 name=__codelineno-0-928></a>        <span class=k>return</span> <span class=n>Path</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_path</span><span class=p>)</span>
</span><span id=__span-0-929><a id=__codelineno-0-929 name=__codelineno-0-929></a>
</span><span id=__span-0-930><a id=__codelineno-0-930 name=__codelineno-0-930></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_agent_temp_path</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Path</span><span class=p>:</span>
</span><span id=__span-0-931><a id=__codelineno-0-931 name=__codelineno-0-931></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns temp dir for primary agent where execution happens.&quot;&quot;&quot;</span>
</span><span id=__span-0-932><a id=__codelineno-0-932 name=__codelineno-0-932></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_primary_agent_temp_dir</span><span class=p>()</span>
</span><span id=__span-0-933><a id=__codelineno-0-933 name=__codelineno-0-933></a>
</span><span id=__span-0-934><a id=__codelineno-0-934 name=__codelineno-0-934></a>    <span class=k>def</span><span class=w> </span><span class=nf>read_file</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>filename</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Union</span><span class=p>[</span><span class=nb>bytes</span><span class=p>,</span> <span class=nb>str</span><span class=p>]]:</span>
</span><span id=__span-0-935><a id=__codelineno-0-935 name=__codelineno-0-935></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Reads a file from the environment or thread.&quot;&quot;&quot;</span>
</span><span id=__span-0-936><a id=__codelineno-0-936 name=__codelineno-0-936></a>        <span class=n>file_content</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Union</span><span class=p>[</span><span class=nb>bytes</span><span class=p>,</span> <span class=nb>str</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-937><a id=__codelineno-0-937 name=__codelineno-0-937></a>        <span class=c1># First try to read from local filesystem</span>
</span><span id=__span-0-938><a id=__codelineno-0-938 name=__codelineno-0-938></a>        <span class=n>local_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>get_primary_agent_temp_dir</span><span class=p>(),</span> <span class=n>filename</span><span class=p>)</span>
</span><span id=__span-0-939><a id=__codelineno-0-939 name=__codelineno-0-939></a>        <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>local_path</span><span class=p>):</span>
</span><span id=__span-0-940><a id=__codelineno-0-940 name=__codelineno-0-940></a>            <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-941><a id=__codelineno-0-941 name=__codelineno-0-941></a>                <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>local_path</span><span class=p>,</span> <span class=s2>&quot;rb&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>local_path_file</span><span class=p>:</span>
</span><span id=__span-0-942><a id=__codelineno-0-942 name=__codelineno-0-942></a>                    <span class=n>local_file_content</span> <span class=o>=</span> <span class=n>local_path_file</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span><span id=__span-0-943><a id=__codelineno-0-943 name=__codelineno-0-943></a>                    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-944><a id=__codelineno-0-944 name=__codelineno-0-944></a>                        <span class=c1># Try to decode as text</span>
</span><span id=__span-0-945><a id=__codelineno-0-945 name=__codelineno-0-945></a>                        <span class=n>file_content</span> <span class=o>=</span> <span class=n>local_file_content</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s2>&quot;utf-8&quot;</span><span class=p>)</span>
</span><span id=__span-0-946><a id=__codelineno-0-946 name=__codelineno-0-946></a>                    <span class=k>except</span> <span class=ne>UnicodeDecodeError</span><span class=p>:</span>
</span><span id=__span-0-947><a id=__codelineno-0-947 name=__codelineno-0-947></a>                        <span class=c1># If decoding fails, store as binary</span>
</span><span id=__span-0-948><a id=__codelineno-0-948 name=__codelineno-0-948></a>                        <span class=n>file_content</span> <span class=o>=</span> <span class=n>local_file_content</span>
</span><span id=__span-0-949><a id=__codelineno-0-949 name=__codelineno-0-949></a>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-950><a id=__codelineno-0-950 name=__codelineno-0-950></a>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error with read_file: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-951><a id=__codelineno-0-951 name=__codelineno-0-951></a>
</span><span id=__span-0-952><a id=__codelineno-0-952 name=__codelineno-0-952></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>file_content</span><span class=p>:</span>
</span><span id=__span-0-953><a id=__codelineno-0-953 name=__codelineno-0-953></a>            <span class=c1># Next check files written out by the agent.</span>
</span><span id=__span-0-954><a id=__codelineno-0-954 name=__codelineno-0-954></a>            <span class=c1># Agent output files take precedence over files packaged with the agent</span>
</span><span id=__span-0-955><a id=__codelineno-0-955 name=__codelineno-0-955></a>            <span class=n>thread_files</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>list_files_from_thread</span><span class=p>(</span><span class=n>order</span><span class=o>=</span><span class=s2>&quot;desc&quot;</span><span class=p>)</span>
</span><span id=__span-0-956><a id=__codelineno-0-956 name=__codelineno-0-956></a>
</span><span id=__span-0-957><a id=__codelineno-0-957 name=__codelineno-0-957></a>            <span class=c1># Then try to read from thread, starting from the most recent</span>
</span><span id=__span-0-958><a id=__codelineno-0-958 name=__codelineno-0-958></a>            <span class=k>for</span> <span class=n>f</span> <span class=ow>in</span> <span class=n>thread_files</span><span class=p>:</span>
</span><span id=__span-0-959><a id=__codelineno-0-959 name=__codelineno-0-959></a>                <span class=k>if</span> <span class=n>f</span><span class=o>.</span><span class=n>filename</span> <span class=o>==</span> <span class=n>filename</span><span class=p>:</span>
</span><span id=__span-0-960><a id=__codelineno-0-960 name=__codelineno-0-960></a>                    <span class=n>file_content</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>read_file_by_id</span><span class=p>(</span><span class=n>f</span><span class=o>.</span><span class=n>id</span><span class=p>)</span>
</span><span id=__span-0-961><a id=__codelineno-0-961 name=__codelineno-0-961></a>                    <span class=k>break</span>
</span><span id=__span-0-962><a id=__codelineno-0-962 name=__codelineno-0-962></a>
</span><span id=__span-0-963><a id=__codelineno-0-963 name=__codelineno-0-963></a>            <span class=k>if</span> <span class=ow>not</span> <span class=n>file_content</span><span class=p>:</span>
</span><span id=__span-0-964><a id=__codelineno-0-964 name=__codelineno-0-964></a>                <span class=c1># Next check agent file cache</span>
</span><span id=__span-0-965><a id=__codelineno-0-965 name=__codelineno-0-965></a>                <span class=c1># Agent output files &amp; thread files take precedence over cached files</span>
</span><span id=__span-0-966><a id=__codelineno-0-966 name=__codelineno-0-966></a>                <span class=n>file_cache</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_primary_agent</span><span class=p>()</span><span class=o>.</span><span class=n>file_cache</span>
</span><span id=__span-0-967><a id=__codelineno-0-967 name=__codelineno-0-967></a>                <span class=k>if</span> <span class=n>file_cache</span><span class=p>:</span>
</span><span id=__span-0-968><a id=__codelineno-0-968 name=__codelineno-0-968></a>                    <span class=n>file_content</span> <span class=o>=</span> <span class=n>file_cache</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>filename</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
</span><span id=__span-0-969><a id=__codelineno-0-969 name=__codelineno-0-969></a>
</span><span id=__span-0-970><a id=__codelineno-0-970 name=__codelineno-0-970></a>            <span class=c1># Write the file content from the thread or cache to the local filesystem</span>
</span><span id=__span-0-971><a id=__codelineno-0-971 name=__codelineno-0-971></a>            <span class=c1># This allows exec_command to operate on the file</span>
</span><span id=__span-0-972><a id=__codelineno-0-972 name=__codelineno-0-972></a>            <span class=k>if</span> <span class=n>file_content</span><span class=p>:</span>
</span><span id=__span-0-973><a id=__codelineno-0-973 name=__codelineno-0-973></a>                <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=n>local_path</span><span class=p>)):</span>
</span><span id=__span-0-974><a id=__codelineno-0-974 name=__codelineno-0-974></a>                    <span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=n>local_path</span><span class=p>))</span>
</span><span id=__span-0-975><a id=__codelineno-0-975 name=__codelineno-0-975></a>
</span><span id=__span-0-976><a id=__codelineno-0-976 name=__codelineno-0-976></a>                <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>local_path</span><span class=p>,</span> <span class=s2>&quot;wb&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>local_file</span><span class=p>:</span>
</span><span id=__span-0-977><a id=__codelineno-0-977 name=__codelineno-0-977></a>                    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>file_content</span><span class=p>,</span> <span class=nb>bytes</span><span class=p>):</span>
</span><span id=__span-0-978><a id=__codelineno-0-978 name=__codelineno-0-978></a>                        <span class=n>local_file</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>file_content</span><span class=p>)</span>
</span><span id=__span-0-979><a id=__codelineno-0-979 name=__codelineno-0-979></a>                    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-980><a id=__codelineno-0-980 name=__codelineno-0-980></a>                        <span class=n>local_file</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>file_content</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s2>&quot;utf-8&quot;</span><span class=p>))</span>
</span><span id=__span-0-981><a id=__codelineno-0-981 name=__codelineno-0-981></a>
</span><span id=__span-0-982><a id=__codelineno-0-982 name=__codelineno-0-982></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>file_content</span><span class=p>:</span>
</span><span id=__span-0-983><a id=__codelineno-0-983 name=__codelineno-0-983></a>            <span class=bp>self</span><span class=o>.</span><span class=n>add_system_log</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Warn: File </span><span class=si>{</span><span class=n>filename</span><span class=si>}</span><span class=s2> not found during read_file operation&quot;</span><span class=p>)</span>
</span><span id=__span-0-984><a id=__codelineno-0-984 name=__codelineno-0-984></a>
</span><span id=__span-0-985><a id=__codelineno-0-985 name=__codelineno-0-985></a>        <span class=k>return</span> <span class=n>file_content</span>
</span><span id=__span-0-986><a id=__codelineno-0-986 name=__codelineno-0-986></a>
</span><span id=__span-0-987><a id=__codelineno-0-987 name=__codelineno-0-987></a>    <span class=k>def</span><span class=w> </span><span class=nf>exec_command</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>command</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>int</span><span class=p>]]:</span>
</span><span id=__span-0-988><a id=__codelineno-0-988 name=__codelineno-0-988></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Executes a command in the environment and logs the output.</span>
</span><span id=__span-0-989><a id=__codelineno-0-989 name=__codelineno-0-989></a>
</span><span id=__span-0-990><a id=__codelineno-0-990 name=__codelineno-0-990></a><span class=sd>        The environment does not allow running interactive programs.</span>
</span><span id=__span-0-991><a id=__codelineno-0-991 name=__codelineno-0-991></a><span class=sd>        It will run a program for 1 second then will interrupt it if it is still running</span>
</span><span id=__span-0-992><a id=__codelineno-0-992 name=__codelineno-0-992></a><span class=sd>        or if it is waiting for user input.</span>
</span><span id=__span-0-993><a id=__codelineno-0-993 name=__codelineno-0-993></a><span class=sd>        command: The command to execute, like &#39;ls -l&#39; or &#39;python3 tests.py&#39;</span>
</span><span id=__span-0-994><a id=__codelineno-0-994 name=__codelineno-0-994></a><span class=sd>        &quot;&quot;&quot;</span>
</span><span id=__span-0-995><a id=__codelineno-0-995 name=__codelineno-0-995></a>        <span class=n>approval_function</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_approvals</span><span class=p>[</span><span class=s2>&quot;confirm_execution&quot;</span><span class=p>]</span> <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_approvals</span> <span class=k>else</span> <span class=kc>None</span>
</span><span id=__span-0-996><a id=__codelineno-0-996 name=__codelineno-0-996></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>approval_function</span><span class=p>:</span>
</span><span id=__span-0-997><a id=__codelineno-0-997 name=__codelineno-0-997></a>            <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-0-998><a id=__codelineno-0-998 name=__codelineno-0-998></a>                <span class=s2>&quot;stderr&quot;</span><span class=p>:</span> <span class=s2>&quot;Agent runner misconfiguration. No command execution approval function found.&quot;</span><span class=p>,</span>
</span><span id=__span-0-999><a id=__codelineno-0-999 name=__codelineno-0-999></a>            <span class=p>}</span>
</span><span id=__span-0-1000><a id=__codelineno-0-1000 name=__codelineno-0-1000></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>approval_function</span><span class=p>(</span><span class=n>command</span><span class=p>):</span>
</span><span id=__span-0-1001><a id=__codelineno-0-1001 name=__codelineno-0-1001></a>            <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-0-1002><a id=__codelineno-0-1002 name=__codelineno-0-1002></a>                <span class=s2>&quot;command&quot;</span><span class=p>:</span> <span class=n>command</span><span class=p>,</span>
</span><span id=__span-0-1003><a id=__codelineno-0-1003 name=__codelineno-0-1003></a>                <span class=s2>&quot;returncode&quot;</span><span class=p>:</span> <span class=mi>999</span><span class=p>,</span>
</span><span id=__span-0-1004><a id=__codelineno-0-1004 name=__codelineno-0-1004></a>                <span class=s2>&quot;stdout&quot;</span><span class=p>:</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-1005><a id=__codelineno-0-1005 name=__codelineno-0-1005></a>                <span class=s2>&quot;stderr&quot;</span><span class=p>:</span> <span class=s2>&quot;Command execution was not approved.&quot;</span><span class=p>,</span>
</span><span id=__span-0-1006><a id=__codelineno-0-1006 name=__codelineno-0-1006></a>            <span class=p>}</span>
</span><span id=__span-0-1007><a id=__codelineno-0-1007 name=__codelineno-0-1007></a>
</span><span id=__span-0-1008><a id=__codelineno-0-1008 name=__codelineno-0-1008></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-1009><a id=__codelineno-0-1009 name=__codelineno-0-1009></a>            <span class=n>process</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>Popen</span><span class=p>(</span>
</span><span id=__span-0-1010><a id=__codelineno-0-1010 name=__codelineno-0-1010></a>                <span class=n>shlex</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=n>command</span><span class=p>),</span>
</span><span id=__span-0-1011><a id=__codelineno-0-1011 name=__codelineno-0-1011></a>                <span class=n>stdout</span><span class=o>=</span><span class=n>subprocess</span><span class=o>.</span><span class=n>PIPE</span><span class=p>,</span>
</span><span id=__span-0-1012><a id=__codelineno-0-1012 name=__codelineno-0-1012></a>                <span class=n>stderr</span><span class=o>=</span><span class=n>subprocess</span><span class=o>.</span><span class=n>PIPE</span><span class=p>,</span>
</span><span id=__span-0-1013><a id=__codelineno-0-1013 name=__codelineno-0-1013></a>                <span class=n>bufsize</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
</span><span id=__span-0-1014><a id=__codelineno-0-1014 name=__codelineno-0-1014></a>                <span class=n>universal_newlines</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-1015><a id=__codelineno-0-1015 name=__codelineno-0-1015></a>                <span class=n>cwd</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_path</span><span class=p>,</span>
</span><span id=__span-0-1016><a id=__codelineno-0-1016 name=__codelineno-0-1016></a>            <span class=p>)</span>
</span><span id=__span-0-1017><a id=__codelineno-0-1017 name=__codelineno-0-1017></a>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-1018><a id=__codelineno-0-1018 name=__codelineno-0-1018></a>            <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-0-1019><a id=__codelineno-0-1019 name=__codelineno-0-1019></a>                <span class=s2>&quot;command&quot;</span><span class=p>:</span> <span class=n>command</span><span class=p>,</span>
</span><span id=__span-0-1020><a id=__codelineno-0-1020 name=__codelineno-0-1020></a>                <span class=s2>&quot;returncode&quot;</span><span class=p>:</span> <span class=mi>999</span><span class=p>,</span>
</span><span id=__span-0-1021><a id=__codelineno-0-1021 name=__codelineno-0-1021></a>                <span class=s2>&quot;stdout&quot;</span><span class=p>:</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-1022><a id=__codelineno-0-1022 name=__codelineno-0-1022></a>                <span class=s2>&quot;stderr&quot;</span><span class=p>:</span> <span class=s2>&quot;Failed to execute: &quot;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>),</span>
</span><span id=__span-0-1023><a id=__codelineno-0-1023 name=__codelineno-0-1023></a>            <span class=p>}</span>
</span><span id=__span-0-1024><a id=__codelineno-0-1024 name=__codelineno-0-1024></a>
</span><span id=__span-0-1025><a id=__codelineno-0-1025 name=__codelineno-0-1025></a>        <span class=n>msg</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-1026><a id=__codelineno-0-1026 name=__codelineno-0-1026></a>
</span><span id=__span-0-1027><a id=__codelineno-0-1027 name=__codelineno-0-1027></a>        <span class=k>def</span><span class=w> </span><span class=nf>kill_process_tree</span><span class=p>(</span><span class=n>p</span><span class=p>:</span> <span class=n>Any</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-1028><a id=__codelineno-0-1028 name=__codelineno-0-1028></a>            <span class=k>nonlocal</span> <span class=n>msg</span>
</span><span id=__span-0-1029><a id=__codelineno-0-1029 name=__codelineno-0-1029></a>            <span class=n>msg</span> <span class=o>=</span> <span class=s2>&quot;Killing process due to timeout&quot;</span>
</span><span id=__span-0-1030><a id=__codelineno-0-1030 name=__codelineno-0-1030></a>
</span><span id=__span-0-1031><a id=__codelineno-0-1031 name=__codelineno-0-1031></a>            <span class=n>process</span> <span class=o>=</span> <span class=n>psutil</span><span class=o>.</span><span class=n>Process</span><span class=p>(</span><span class=n>p</span><span class=o>.</span><span class=n>pid</span><span class=p>)</span>
</span><span id=__span-0-1032><a id=__codelineno-0-1032 name=__codelineno-0-1032></a>            <span class=k>for</span> <span class=n>proc</span> <span class=ow>in</span> <span class=n>process</span><span class=o>.</span><span class=n>children</span><span class=p>(</span><span class=n>recursive</span><span class=o>=</span><span class=kc>True</span><span class=p>):</span>
</span><span id=__span-0-1033><a id=__codelineno-0-1033 name=__codelineno-0-1033></a>                <span class=n>proc</span><span class=o>.</span><span class=n>kill</span><span class=p>()</span>
</span><span id=__span-0-1034><a id=__codelineno-0-1034 name=__codelineno-0-1034></a>            <span class=n>process</span><span class=o>.</span><span class=n>kill</span><span class=p>()</span>
</span><span id=__span-0-1035><a id=__codelineno-0-1035 name=__codelineno-0-1035></a>
</span><span id=__span-0-1036><a id=__codelineno-0-1036 name=__codelineno-0-1036></a>        <span class=n>timer</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Timer</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=n>kill_process_tree</span><span class=p>,</span> <span class=p>(</span><span class=n>process</span><span class=p>,))</span>
</span><span id=__span-0-1037><a id=__codelineno-0-1037 name=__codelineno-0-1037></a>        <span class=n>timer</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span><span id=__span-0-1038><a id=__codelineno-0-1038 name=__codelineno-0-1038></a>        <span class=n>process</span><span class=o>.</span><span class=n>wait</span><span class=p>()</span>
</span><span id=__span-0-1039><a id=__codelineno-0-1039 name=__codelineno-0-1039></a>        <span class=n>timer</span><span class=o>.</span><span class=n>cancel</span><span class=p>()</span>
</span><span id=__span-0-1040><a id=__codelineno-0-1040 name=__codelineno-0-1040></a>
</span><span id=__span-0-1041><a id=__codelineno-0-1041 name=__codelineno-0-1041></a>        <span class=n>result</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-1042><a id=__codelineno-0-1042 name=__codelineno-0-1042></a>            <span class=s2>&quot;command&quot;</span><span class=p>:</span> <span class=n>command</span><span class=p>,</span>
</span><span id=__span-0-1043><a id=__codelineno-0-1043 name=__codelineno-0-1043></a>            <span class=s2>&quot;stdout&quot;</span><span class=p>:</span> <span class=n>process</span><span class=o>.</span><span class=n>stdout</span><span class=o>.</span><span class=n>read</span><span class=p>()</span> <span class=k>if</span> <span class=n>process</span><span class=o>.</span><span class=n>stdout</span> <span class=ow>and</span> <span class=nb>hasattr</span><span class=p>(</span><span class=n>process</span><span class=o>.</span><span class=n>stdout</span><span class=p>,</span> <span class=s2>&quot;read&quot;</span><span class=p>)</span> <span class=k>else</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-1044><a id=__codelineno-0-1044 name=__codelineno-0-1044></a>            <span class=s2>&quot;stderr&quot;</span><span class=p>:</span> <span class=n>process</span><span class=o>.</span><span class=n>stderr</span><span class=o>.</span><span class=n>read</span><span class=p>()</span> <span class=k>if</span> <span class=n>process</span><span class=o>.</span><span class=n>stderr</span> <span class=ow>and</span> <span class=nb>hasattr</span><span class=p>(</span><span class=n>process</span><span class=o>.</span><span class=n>stderr</span><span class=p>,</span> <span class=s2>&quot;read&quot;</span><span class=p>)</span> <span class=k>else</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-1045><a id=__codelineno-0-1045 name=__codelineno-0-1045></a>            <span class=s2>&quot;returncode&quot;</span><span class=p>:</span> <span class=n>process</span><span class=o>.</span><span class=n>returncode</span><span class=p>,</span>
</span><span id=__span-0-1046><a id=__codelineno-0-1046 name=__codelineno-0-1046></a>            <span class=s2>&quot;msg&quot;</span><span class=p>:</span> <span class=n>msg</span><span class=p>,</span>
</span><span id=__span-0-1047><a id=__codelineno-0-1047 name=__codelineno-0-1047></a>        <span class=p>}</span>
</span><span id=__span-0-1048><a id=__codelineno-0-1048 name=__codelineno-0-1048></a>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_path</span><span class=p>,</span> <span class=n>TERMINAL_FILENAME</span><span class=p>),</span> <span class=s2>&quot;a&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-1049><a id=__codelineno-0-1049 name=__codelineno-0-1049></a>            <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>result</span><span class=p>)</span> <span class=o>+</span> <span class=n>DELIMITER</span><span class=p>)</span>
</span><span id=__span-0-1050><a id=__codelineno-0-1050 name=__codelineno-0-1050></a>        <span class=k>return</span> <span class=n>result</span>
</span><span id=__span-0-1051><a id=__codelineno-0-1051 name=__codelineno-0-1051></a>
</span><span id=__span-0-1052><a id=__codelineno-0-1052 name=__codelineno-0-1052></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_inference_parameters</span><span class=p>(</span>
</span><span id=__span-0-1053><a id=__codelineno-0-1053 name=__codelineno-0-1053></a>        <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-1054><a id=__codelineno-0-1054 name=__codelineno-0-1054></a>        <span class=n>messages</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Iterable</span><span class=p>[</span><span class=n>ChatCompletionMessageParam</span><span class=p>],</span> <span class=nb>str</span><span class=p>],</span>
</span><span id=__span-0-1055><a id=__codelineno-0-1055 name=__codelineno-0-1055></a>        <span class=n>model</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Iterable</span><span class=p>[</span><span class=n>ChatCompletionMessageParam</span><span class=p>],</span> <span class=nb>str</span><span class=p>],</span>
</span><span id=__span-0-1056><a id=__codelineno-0-1056 name=__codelineno-0-1056></a>        <span class=n>stream</span><span class=p>:</span> <span class=nb>bool</span><span class=p>,</span>
</span><span id=__span-0-1057><a id=__codelineno-0-1057 name=__codelineno-0-1057></a>        <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span>
</span><span id=__span-0-1058><a id=__codelineno-0-1058 name=__codelineno-0-1058></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=n>InferenceParameters</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span><span id=__span-0-1059><a id=__codelineno-0-1059 name=__codelineno-0-1059></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Run inference parameters to run completions.&quot;&quot;&quot;</span>
</span><span id=__span-0-1060><a id=__codelineno-0-1060 name=__codelineno-0-1060></a>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>messages</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-1061><a id=__codelineno-0-1061 name=__codelineno-0-1061></a>            <span class=bp>self</span><span class=o>.</span><span class=n>add_system_log</span><span class=p>(</span>
</span><span id=__span-0-1062><a id=__codelineno-0-1062 name=__codelineno-0-1062></a>                <span class=s2>&quot;Deprecated completions call. Pass `messages` as a first parameter.&quot;</span><span class=p>,</span>
</span><span id=__span-0-1063><a id=__codelineno-0-1063 name=__codelineno-0-1063></a>                <span class=n>logging</span><span class=o>.</span><span class=n>WARNING</span><span class=p>,</span>
</span><span id=__span-0-1064><a id=__codelineno-0-1064 name=__codelineno-0-1064></a>            <span class=p>)</span>
</span><span id=__span-0-1065><a id=__codelineno-0-1065 name=__codelineno-0-1065></a>            <span class=n>messages_or_model</span> <span class=o>=</span> <span class=n>messages</span>
</span><span id=__span-0-1066><a id=__codelineno-0-1066 name=__codelineno-0-1066></a>            <span class=n>model_or_messages</span> <span class=o>=</span> <span class=n>model</span>
</span><span id=__span-0-1067><a id=__codelineno-0-1067 name=__codelineno-0-1067></a>            <span class=n>model</span> <span class=o>=</span> <span class=n>cast</span><span class=p>(</span><span class=nb>str</span><span class=p>,</span> <span class=n>messages_or_model</span><span class=p>)</span>
</span><span id=__span-0-1068><a id=__codelineno-0-1068 name=__codelineno-0-1068></a>            <span class=n>messages</span> <span class=o>=</span> <span class=n>cast</span><span class=p>(</span><span class=n>Iterable</span><span class=p>[</span><span class=n>ChatCompletionMessageParam</span><span class=p>],</span> <span class=n>model_or_messages</span><span class=p>)</span>
</span><span id=__span-0-1069><a id=__codelineno-0-1069 name=__codelineno-0-1069></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-1070><a id=__codelineno-0-1070 name=__codelineno-0-1070></a>            <span class=n>model</span> <span class=o>=</span> <span class=n>cast</span><span class=p>(</span><span class=nb>str</span><span class=p>,</span> <span class=n>model</span><span class=p>)</span>
</span><span id=__span-0-1071><a id=__codelineno-0-1071 name=__codelineno-0-1071></a>            <span class=n>messages</span> <span class=o>=</span> <span class=n>cast</span><span class=p>(</span><span class=n>Iterable</span><span class=p>[</span><span class=n>ChatCompletionMessageParam</span><span class=p>],</span> <span class=n>messages</span><span class=p>)</span>
</span><span id=__span-0-1072><a id=__codelineno-0-1072 name=__codelineno-0-1072></a>        <span class=n>model</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_model_for_inference</span><span class=p>(</span><span class=n>model</span><span class=p>)</span>
</span><span id=__span-0-1073><a id=__codelineno-0-1073 name=__codelineno-0-1073></a>        <span class=k>if</span> <span class=n>model</span> <span class=o>!=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_last_used_model</span><span class=p>:</span>
</span><span id=__span-0-1074><a id=__codelineno-0-1074 name=__codelineno-0-1074></a>            <span class=bp>self</span><span class=o>.</span><span class=n>_last_used_model</span> <span class=o>=</span> <span class=n>model</span>
</span><span id=__span-0-1075><a id=__codelineno-0-1075 name=__codelineno-0-1075></a>            <span class=bp>self</span><span class=o>.</span><span class=n>add_system_log</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Connecting to </span><span class=si>{</span><span class=n>model</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-1076><a id=__codelineno-0-1076 name=__codelineno-0-1076></a>
</span><span id=__span-0-1077><a id=__codelineno-0-1077 name=__codelineno-0-1077></a>        <span class=n>temperature</span> <span class=o>=</span> <span class=n>kwargs</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;temperature&quot;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_primary_agent</span><span class=p>()</span><span class=o>.</span><span class=n>model_temperature</span> <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_agents</span> <span class=k>else</span> <span class=kc>None</span><span class=p>)</span>
</span><span id=__span-0-1078><a id=__codelineno-0-1078 name=__codelineno-0-1078></a>        <span class=n>max_tokens</span> <span class=o>=</span> <span class=n>kwargs</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;max_tokens&quot;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_primary_agent</span><span class=p>()</span><span class=o>.</span><span class=n>model_max_tokens</span> <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_agents</span> <span class=k>else</span> <span class=kc>None</span><span class=p>)</span>
</span><span id=__span-0-1079><a id=__codelineno-0-1079 name=__codelineno-0-1079></a>
</span><span id=__span-0-1080><a id=__codelineno-0-1080 name=__codelineno-0-1080></a>        <span class=n>params</span> <span class=o>=</span> <span class=n>InferenceParameters</span><span class=p>(</span>
</span><span id=__span-0-1081><a id=__codelineno-0-1081 name=__codelineno-0-1081></a>            <span class=n>model</span><span class=o>=</span><span class=n>model</span><span class=p>,</span>
</span><span id=__span-0-1082><a id=__codelineno-0-1082 name=__codelineno-0-1082></a>            <span class=n>messages</span><span class=o>=</span><span class=n>messages</span><span class=p>,</span>
</span><span id=__span-0-1083><a id=__codelineno-0-1083 name=__codelineno-0-1083></a>            <span class=n>stream</span><span class=o>=</span><span class=n>stream</span><span class=p>,</span>
</span><span id=__span-0-1084><a id=__codelineno-0-1084 name=__codelineno-0-1084></a>            <span class=n>temperature</span><span class=o>=</span><span class=n>temperature</span><span class=p>,</span>
</span><span id=__span-0-1085><a id=__codelineno-0-1085 name=__codelineno-0-1085></a>            <span class=n>max_tokens</span><span class=o>=</span><span class=n>max_tokens</span><span class=p>,</span>
</span><span id=__span-0-1086><a id=__codelineno-0-1086 name=__codelineno-0-1086></a>        <span class=p>)</span>
</span><span id=__span-0-1087><a id=__codelineno-0-1087 name=__codelineno-0-1087></a>
</span><span id=__span-0-1088><a id=__codelineno-0-1088 name=__codelineno-0-1088></a>        <span class=k>return</span> <span class=n>params</span><span class=p>,</span> <span class=n>kwargs</span>
</span><span id=__span-0-1089><a id=__codelineno-0-1089 name=__codelineno-0-1089></a>
</span><span id=__span-0-1090><a id=__codelineno-0-1090 name=__codelineno-0-1090></a>    <span class=c1># TODO(286): `messages` may be model and `model` may be messages temporarily to support deprecated API.</span>
</span><span id=__span-0-1091><a id=__codelineno-0-1091 name=__codelineno-0-1091></a>    <span class=k>def</span><span class=w> </span><span class=nf>completions</span><span class=p>(</span>
</span><span id=__span-0-1092><a id=__codelineno-0-1092 name=__codelineno-0-1092></a>        <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-1093><a id=__codelineno-0-1093 name=__codelineno-0-1093></a>        <span class=n>messages</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Iterable</span><span class=p>[</span><span class=n>ChatCompletionMessageParam</span><span class=p>],</span> <span class=nb>str</span><span class=p>],</span>
</span><span id=__span-0-1094><a id=__codelineno-0-1094 name=__codelineno-0-1094></a>        <span class=n>model</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Iterable</span><span class=p>[</span><span class=n>ChatCompletionMessageParam</span><span class=p>],</span> <span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-1095><a id=__codelineno-0-1095 name=__codelineno-0-1095></a>        <span class=n>stream</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-1096><a id=__codelineno-0-1096 name=__codelineno-0-1096></a>        <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span>
</span><span id=__span-0-1097><a id=__codelineno-0-1097 name=__codelineno-0-1097></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span><span class=n>ModelResponse</span><span class=p>,</span> <span class=n>CustomStreamWrapper</span><span class=p>]:</span>
</span><span id=__span-0-1098><a id=__codelineno-0-1098 name=__codelineno-0-1098></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns all completions for given messages using the given model.&quot;&quot;&quot;</span>
</span><span id=__span-0-1099><a id=__codelineno-0-1099 name=__codelineno-0-1099></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_run_inference_completions</span><span class=p>(</span><span class=n>messages</span><span class=p>,</span> <span class=n>model</span><span class=p>,</span> <span class=n>stream</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span><span id=__span-0-1100><a id=__codelineno-0-1100 name=__codelineno-0-1100></a>
</span><span id=__span-0-1101><a id=__codelineno-0-1101 name=__codelineno-0-1101></a>    <span class=k>def</span><span class=w> </span><span class=nf>verify_signed_message</span><span class=p>(</span>
</span><span id=__span-0-1102><a id=__codelineno-0-1102 name=__codelineno-0-1102></a>        <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-1103><a id=__codelineno-0-1103 name=__codelineno-0-1103></a>        <span class=n>completion</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-1104><a id=__codelineno-0-1104 name=__codelineno-0-1104></a>        <span class=n>messages</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Iterable</span><span class=p>[</span><span class=n>ChatCompletionMessageParam</span><span class=p>],</span> <span class=nb>str</span><span class=p>],</span>
</span><span id=__span-0-1105><a id=__codelineno-0-1105 name=__codelineno-0-1105></a>        <span class=n>public_key</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=kc>None</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-1106><a id=__codelineno-0-1106 name=__codelineno-0-1106></a>        <span class=n>signature</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=kc>None</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-1107><a id=__codelineno-0-1107 name=__codelineno-0-1107></a>        <span class=n>model</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Iterable</span><span class=p>[</span><span class=n>ChatCompletionMessageParam</span><span class=p>],</span> <span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-1108><a id=__codelineno-0-1108 name=__codelineno-0-1108></a>        <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span>
</span><span id=__span-0-1109><a id=__codelineno-0-1109 name=__codelineno-0-1109></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span><span id=__span-0-1110><a id=__codelineno-0-1110 name=__codelineno-0-1110></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Verifies a signed message.&quot;&quot;&quot;</span>
</span><span id=__span-0-1111><a id=__codelineno-0-1111 name=__codelineno-0-1111></a>        <span class=k>if</span> <span class=n>public_key</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>or</span> <span class=n>signature</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-1112><a id=__codelineno-0-1112 name=__codelineno-0-1112></a>            <span class=k>return</span> <span class=kc>False</span>
</span><span id=__span-0-1113><a id=__codelineno-0-1113 name=__codelineno-0-1113></a>
</span><span id=__span-0-1114><a id=__codelineno-0-1114 name=__codelineno-0-1114></a>        <span class=n>params</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_inference_parameters</span><span class=p>(</span><span class=n>messages</span><span class=p>,</span> <span class=n>model</span><span class=p>,</span> <span class=kc>False</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span><span id=__span-0-1115><a id=__codelineno-0-1115 name=__codelineno-0-1115></a>
</span><span id=__span-0-1116><a id=__codelineno-0-1116 name=__codelineno-0-1116></a>        <span class=n>messages_without_ids</span> <span class=o>=</span> <span class=p>[{</span><span class=n>k</span><span class=p>:</span> <span class=n>v</span> <span class=k>for</span> <span class=n>k</span><span class=p>,</span> <span class=n>v</span> <span class=ow>in</span> <span class=n>item</span><span class=o>.</span><span class=n>items</span><span class=p>()</span> <span class=k>if</span> <span class=n>k</span> <span class=o>!=</span> <span class=s2>&quot;id&quot;</span><span class=p>}</span> <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>params</span><span class=o>.</span><span class=n>messages</span><span class=p>]</span>
</span><span id=__span-0-1117><a id=__codelineno-0-1117 name=__codelineno-0-1117></a>        <span class=n>ordered_messages_without_ids</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-0-1118><a id=__codelineno-0-1118 name=__codelineno-0-1118></a>            <span class=p>{</span><span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>item</span><span class=p>[</span><span class=s2>&quot;role&quot;</span><span class=p>]),</span> <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>item</span><span class=p>[</span><span class=s2>&quot;content&quot;</span><span class=p>])}</span> <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>messages_without_ids</span>
</span><span id=__span-0-1119><a id=__codelineno-0-1119 name=__codelineno-0-1119></a>        <span class=p>]</span>
</span><span id=__span-0-1120><a id=__codelineno-0-1120 name=__codelineno-0-1120></a>
</span><span id=__span-0-1121><a id=__codelineno-0-1121 name=__codelineno-0-1121></a>        <span class=k>return</span> <span class=n>validate_completion_signature</span><span class=p>(</span>
</span><span id=__span-0-1122><a id=__codelineno-0-1122 name=__codelineno-0-1122></a>            <span class=n>public_key</span><span class=p>,</span>
</span><span id=__span-0-1123><a id=__codelineno-0-1123 name=__codelineno-0-1123></a>            <span class=n>signature</span><span class=p>,</span>
</span><span id=__span-0-1124><a id=__codelineno-0-1124 name=__codelineno-0-1124></a>            <span class=n>CompletionSignaturePayload</span><span class=p>(</span>
</span><span id=__span-0-1125><a id=__codelineno-0-1125 name=__codelineno-0-1125></a>                <span class=n>agent_name</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>get_primary_agent</span><span class=p>()</span><span class=o>.</span><span class=n>get_full_name</span><span class=p>(),</span>
</span><span id=__span-0-1126><a id=__codelineno-0-1126 name=__codelineno-0-1126></a>                <span class=n>completion</span><span class=o>=</span><span class=n>completion</span><span class=p>,</span>
</span><span id=__span-0-1127><a id=__codelineno-0-1127 name=__codelineno-0-1127></a>                <span class=n>model</span><span class=o>=</span><span class=n>params</span><span class=o>.</span><span class=n>model</span><span class=p>,</span>
</span><span id=__span-0-1128><a id=__codelineno-0-1128 name=__codelineno-0-1128></a>                <span class=n>messages</span><span class=o>=</span><span class=n>ordered_messages_without_ids</span><span class=p>,</span>
</span><span id=__span-0-1129><a id=__codelineno-0-1129 name=__codelineno-0-1129></a>                <span class=n>temperature</span><span class=o>=</span><span class=n>params</span><span class=o>.</span><span class=n>temperature</span><span class=p>,</span>
</span><span id=__span-0-1130><a id=__codelineno-0-1130 name=__codelineno-0-1130></a>                <span class=n>max_tokens</span><span class=o>=</span><span class=n>params</span><span class=o>.</span><span class=n>max_tokens</span><span class=p>,</span>
</span><span id=__span-0-1131><a id=__codelineno-0-1131 name=__codelineno-0-1131></a>            <span class=p>),</span>
</span><span id=__span-0-1132><a id=__codelineno-0-1132 name=__codelineno-0-1132></a>        <span class=p>)</span>
</span><span id=__span-0-1133><a id=__codelineno-0-1133 name=__codelineno-0-1133></a>
</span><span id=__span-0-1134><a id=__codelineno-0-1134 name=__codelineno-0-1134></a>    <span class=k>def</span><span class=w> </span><span class=nf>completions_and_run_tools</span><span class=p>(</span>
</span><span id=__span-0-1135><a id=__codelineno-0-1135 name=__codelineno-0-1135></a>        <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-1136><a id=__codelineno-0-1136 name=__codelineno-0-1136></a>        <span class=n>messages</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>ChatCompletionMessageParam</span><span class=p>],</span>
</span><span id=__span-0-1137><a id=__codelineno-0-1137 name=__codelineno-0-1137></a>        <span class=n>model</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-1138><a id=__codelineno-0-1138 name=__codelineno-0-1138></a>        <span class=n>tools</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-1139><a id=__codelineno-0-1139 name=__codelineno-0-1139></a>        <span class=n>add_responses_to_messages</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-1140><a id=__codelineno-0-1140 name=__codelineno-0-1140></a>        <span class=n>agent_role_name</span><span class=o>=</span><span class=s2>&quot;assistant&quot;</span><span class=p>,</span>
</span><span id=__span-0-1141><a id=__codelineno-0-1141 name=__codelineno-0-1141></a>        <span class=n>tool_role_name</span><span class=o>=</span><span class=s2>&quot;tool&quot;</span><span class=p>,</span>
</span><span id=__span-0-1142><a id=__codelineno-0-1142 name=__codelineno-0-1142></a>        <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span>
</span><span id=__span-0-1143><a id=__codelineno-0-1143 name=__codelineno-0-1143></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>ModelResponse</span><span class=p>:</span>
</span><span id=__span-0-1144><a id=__codelineno-0-1144 name=__codelineno-0-1144></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns all completions for given messages using the given model and runs tools.&quot;&quot;&quot;</span>
</span><span id=__span-0-1145><a id=__codelineno-0-1145 name=__codelineno-0-1145></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_use_llama_tool_syntax</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>tools</span><span class=p>):</span>
</span><span id=__span-0-1146><a id=__codelineno-0-1146 name=__codelineno-0-1146></a>            <span class=n>tool_prompt</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_llama_tool_prompt</span><span class=p>(</span><span class=n>tools</span><span class=p>)</span>
</span><span id=__span-0-1147><a id=__codelineno-0-1147 name=__codelineno-0-1147></a>            <span class=n>messages</span><span class=o>.</span><span class=n>append</span><span class=p>({</span><span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;system&quot;</span><span class=p>,</span> <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>tool_prompt</span><span class=p>})</span>
</span><span id=__span-0-1148><a id=__codelineno-0-1148 name=__codelineno-0-1148></a>        <span class=n>raw_response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_run_inference_completions</span><span class=p>(</span><span class=n>messages</span><span class=p>,</span> <span class=n>model</span><span class=p>,</span> <span class=n>stream</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>tools</span><span class=o>=</span><span class=n>tools</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span><span id=__span-0-1149><a id=__codelineno-0-1149 name=__codelineno-0-1149></a>        <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>raw_response</span><span class=p>,</span> <span class=n>ModelResponse</span><span class=p>),</span> <span class=s2>&quot;Expected ModelResponse&quot;</span>
</span><span id=__span-0-1150><a id=__codelineno-0-1150 name=__codelineno-0-1150></a>        <span class=n>response</span><span class=p>:</span> <span class=n>ModelResponse</span> <span class=o>=</span> <span class=n>raw_response</span>
</span><span id=__span-0-1151><a id=__codelineno-0-1151 name=__codelineno-0-1151></a>        <span class=k>assert</span> <span class=nb>all</span><span class=p>(</span><span class=nb>map</span><span class=p>(</span><span class=k>lambda</span> <span class=n>choice</span><span class=p>:</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>choice</span><span class=p>,</span> <span class=n>Choices</span><span class=p>),</span> <span class=n>response</span><span class=o>.</span><span class=n>choices</span><span class=p>)),</span> <span class=s2>&quot;Expected Choices&quot;</span>
</span><span id=__span-0-1152><a id=__codelineno-0-1152 name=__codelineno-0-1152></a>        <span class=n>choices</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Choices</span><span class=p>]</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>choices</span>  <span class=c1># type: ignore</span>
</span><span id=__span-0-1153><a id=__codelineno-0-1153 name=__codelineno-0-1153></a>        <span class=n>response_message</span> <span class=o>=</span> <span class=n>choices</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>message</span>
</span><span id=__span-0-1154><a id=__codelineno-0-1154 name=__codelineno-0-1154></a>
</span><span id=__span-0-1155><a id=__codelineno-0-1155 name=__codelineno-0-1155></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_handle_tool_calls</span><span class=p>(</span><span class=n>response_message</span><span class=p>,</span> <span class=n>add_responses_to_messages</span><span class=p>,</span> <span class=n>agent_role_name</span><span class=p>,</span> <span class=n>tool_role_name</span><span class=p>)</span>
</span><span id=__span-0-1156><a id=__codelineno-0-1156 name=__codelineno-0-1156></a>
</span><span id=__span-0-1157><a id=__codelineno-0-1157 name=__codelineno-0-1157></a>        <span class=k>return</span> <span class=n>response</span>
</span><span id=__span-0-1158><a id=__codelineno-0-1158 name=__codelineno-0-1158></a>
</span><span id=__span-0-1159><a id=__codelineno-0-1159 name=__codelineno-0-1159></a>    <span class=k>def</span><span class=w> </span><span class=nf>_handle_tool_calls</span><span class=p>(</span>
</span><span id=__span-0-1160><a id=__codelineno-0-1160 name=__codelineno-0-1160></a>        <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-1161><a id=__codelineno-0-1161 name=__codelineno-0-1161></a>        <span class=n>response_message</span><span class=p>,</span>
</span><span id=__span-0-1162><a id=__codelineno-0-1162 name=__codelineno-0-1162></a>        <span class=n>add_responses_to_messages</span><span class=p>,</span>
</span><span id=__span-0-1163><a id=__codelineno-0-1163 name=__codelineno-0-1163></a>        <span class=n>agent_role_name</span><span class=p>,</span>
</span><span id=__span-0-1164><a id=__codelineno-0-1164 name=__codelineno-0-1164></a>        <span class=n>tool_role_name</span><span class=p>,</span>
</span><span id=__span-0-1165><a id=__codelineno-0-1165 name=__codelineno-0-1165></a>    <span class=p>):</span>
</span><span id=__span-0-1166><a id=__codelineno-0-1166 name=__codelineno-0-1166></a>        <span class=p>(</span><span class=n>message_without_tool_call</span><span class=p>,</span> <span class=n>tool_calls</span><span class=p>)</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_parse_tool_call</span><span class=p>(</span><span class=n>response_message</span><span class=p>)</span>
</span><span id=__span-0-1167><a id=__codelineno-0-1167 name=__codelineno-0-1167></a>        <span class=k>if</span> <span class=n>add_responses_to_messages</span> <span class=ow>and</span> <span class=n>response_message</span><span class=o>.</span><span class=n>content</span><span class=p>:</span>
</span><span id=__span-0-1168><a id=__codelineno-0-1168 name=__codelineno-0-1168></a>            <span class=bp>self</span><span class=o>.</span><span class=n>add_message</span><span class=p>(</span><span class=n>agent_role_name</span><span class=p>,</span> <span class=n>message_without_tool_call</span><span class=p>)</span>
</span><span id=__span-0-1169><a id=__codelineno-0-1169 name=__codelineno-0-1169></a>        <span class=k>if</span> <span class=n>tool_calls</span><span class=p>:</span>
</span><span id=__span-0-1170><a id=__codelineno-0-1170 name=__codelineno-0-1170></a>            <span class=k>for</span> <span class=n>tool_call</span> <span class=ow>in</span> <span class=n>tool_calls</span><span class=p>:</span>
</span><span id=__span-0-1171><a id=__codelineno-0-1171 name=__codelineno-0-1171></a>                <span class=n>function_name</span> <span class=o>=</span> <span class=n>tool_call</span><span class=o>.</span><span class=n>function</span><span class=o>.</span><span class=n>name</span>
</span><span id=__span-0-1172><a id=__codelineno-0-1172 name=__codelineno-0-1172></a>                <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-1173><a id=__codelineno-0-1173 name=__codelineno-0-1173></a>                    <span class=k>assert</span> <span class=n>function_name</span><span class=p>,</span> <span class=s2>&quot;Tool call must have a function name&quot;</span>
</span><span id=__span-0-1174><a id=__codelineno-0-1174 name=__codelineno-0-1174></a>                    <span class=n>function_signature</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_tool_registry</span><span class=p>()</span><span class=o>.</span><span class=n>get_tool_definition</span><span class=p>(</span><span class=n>function_name</span><span class=p>)</span>
</span><span id=__span-0-1175><a id=__codelineno-0-1175 name=__codelineno-0-1175></a>                    <span class=k>assert</span> <span class=n>function_signature</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&quot;Tool </span><span class=si>{</span><span class=n>function_name</span><span class=si>}</span><span class=s2> not found&quot;</span>
</span><span id=__span-0-1176><a id=__codelineno-0-1176 name=__codelineno-0-1176></a>                    <span class=n>args</span> <span class=o>=</span> <span class=n>tool_call</span><span class=o>.</span><span class=n>function</span><span class=o>.</span><span class=n>arguments</span>
</span><span id=__span-0-1177><a id=__codelineno-0-1177 name=__codelineno-0-1177></a>                    <span class=n>function_args</span> <span class=o>=</span> <span class=n>tool_json_helper</span><span class=o>.</span><span class=n>parse_json_args</span><span class=p>(</span><span class=n>function_signature</span><span class=p>,</span> <span class=n>args</span><span class=p>)</span>
</span><span id=__span-0-1178><a id=__codelineno-0-1178 name=__codelineno-0-1178></a>                    <span class=bp>self</span><span class=o>.</span><span class=n>add_system_log</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Calling tool </span><span class=si>{</span><span class=n>function_name</span><span class=si>}</span><span class=s2> with args </span><span class=si>{</span><span class=n>function_args</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-1179><a id=__codelineno-0-1179 name=__codelineno-0-1179></a>                    <span class=n>function_response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_tools</span><span class=o>.</span><span class=n>call_tool</span><span class=p>(</span><span class=n>function_name</span><span class=p>,</span> <span class=o>**</span><span class=n>function_args</span> <span class=k>if</span> <span class=n>function_args</span> <span class=k>else</span> <span class=p>{})</span>
</span><span id=__span-0-1180><a id=__codelineno-0-1180 name=__codelineno-0-1180></a>
</span><span id=__span-0-1181><a id=__codelineno-0-1181 name=__codelineno-0-1181></a>                    <span class=k>if</span> <span class=n>function_response</span><span class=p>:</span>
</span><span id=__span-0-1182><a id=__codelineno-0-1182 name=__codelineno-0-1182></a>                        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-1183><a id=__codelineno-0-1183 name=__codelineno-0-1183></a>                            <span class=n>function_response_json</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>function_response</span><span class=p>)</span> <span class=k>if</span> <span class=n>function_response</span> <span class=k>else</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-1184><a id=__codelineno-0-1184 name=__codelineno-0-1184></a>                            <span class=k>if</span> <span class=n>add_responses_to_messages</span><span class=p>:</span>
</span><span id=__span-0-1185><a id=__codelineno-0-1185 name=__codelineno-0-1185></a>                                <span class=bp>self</span><span class=o>.</span><span class=n>add_message</span><span class=p>(</span>
</span><span id=__span-0-1186><a id=__codelineno-0-1186 name=__codelineno-0-1186></a>                                    <span class=n>tool_role_name</span><span class=p>,</span>
</span><span id=__span-0-1187><a id=__codelineno-0-1187 name=__codelineno-0-1187></a>                                    <span class=n>function_response_json</span><span class=p>,</span>
</span><span id=__span-0-1188><a id=__codelineno-0-1188 name=__codelineno-0-1188></a>                                    <span class=n>tool_call_id</span><span class=o>=</span><span class=n>tool_call</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span><span id=__span-0-1189><a id=__codelineno-0-1189 name=__codelineno-0-1189></a>                                    <span class=n>name</span><span class=o>=</span><span class=n>function_name</span><span class=p>,</span>
</span><span id=__span-0-1190><a id=__codelineno-0-1190 name=__codelineno-0-1190></a>                                <span class=p>)</span>
</span><span id=__span-0-1191><a id=__codelineno-0-1191 name=__codelineno-0-1191></a>                        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-1192><a id=__codelineno-0-1192 name=__codelineno-0-1192></a>                            <span class=c1># some tool responses may not be serializable</span>
</span><span id=__span-0-1193><a id=__codelineno-0-1193 name=__codelineno-0-1193></a>                            <span class=n>error_message</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;Unable to add tool output as a message </span><span class=si>{</span><span class=n>function_name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-1194><a id=__codelineno-0-1194 name=__codelineno-0-1194></a>                            <span class=bp>self</span><span class=o>.</span><span class=n>add_system_log</span><span class=p>(</span><span class=n>error_message</span><span class=p>,</span> <span class=n>level</span><span class=o>=</span><span class=n>logging</span><span class=o>.</span><span class=n>INFO</span><span class=p>)</span>
</span><span id=__span-0-1195><a id=__codelineno-0-1195 name=__codelineno-0-1195></a>                <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-1196><a id=__codelineno-0-1196 name=__codelineno-0-1196></a>                    <span class=n>error_message</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;Error calling tool </span><span class=si>{</span><span class=n>function_name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-1197><a id=__codelineno-0-1197 name=__codelineno-0-1197></a>                    <span class=bp>self</span><span class=o>.</span><span class=n>add_system_log</span><span class=p>(</span><span class=n>error_message</span><span class=p>,</span> <span class=n>level</span><span class=o>=</span><span class=n>logging</span><span class=o>.</span><span class=n>ERROR</span><span class=p>)</span>
</span><span id=__span-0-1198><a id=__codelineno-0-1198 name=__codelineno-0-1198></a>                    <span class=k>if</span> <span class=n>add_responses_to_messages</span><span class=p>:</span>
</span><span id=__span-0-1199><a id=__codelineno-0-1199 name=__codelineno-0-1199></a>                        <span class=bp>self</span><span class=o>.</span><span class=n>add_message</span><span class=p>(</span>
</span><span id=__span-0-1200><a id=__codelineno-0-1200 name=__codelineno-0-1200></a>                            <span class=n>tool_role_name</span><span class=p>,</span>
</span><span id=__span-0-1201><a id=__codelineno-0-1201 name=__codelineno-0-1201></a>                            <span class=n>error_message</span><span class=p>,</span>
</span><span id=__span-0-1202><a id=__codelineno-0-1202 name=__codelineno-0-1202></a>                            <span class=n>tool_call_id</span><span class=o>=</span><span class=n>tool_call</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span><span id=__span-0-1203><a id=__codelineno-0-1203 name=__codelineno-0-1203></a>                            <span class=n>name</span><span class=o>=</span><span class=n>function_name</span><span class=p>,</span>
</span><span id=__span-0-1204><a id=__codelineno-0-1204 name=__codelineno-0-1204></a>                        <span class=p>)</span>
</span><span id=__span-0-1205><a id=__codelineno-0-1205 name=__codelineno-0-1205></a>
</span><span id=__span-0-1206><a id=__codelineno-0-1206 name=__codelineno-0-1206></a>    <span class=nd>@staticmethod</span>
</span><span id=__span-0-1207><a id=__codelineno-0-1207 name=__codelineno-0-1207></a>    <span class=k>def</span><span class=w> </span><span class=nf>_parse_tool_call</span><span class=p>(</span>
</span><span id=__span-0-1208><a id=__codelineno-0-1208 name=__codelineno-0-1208></a>        <span class=n>response_message</span><span class=p>,</span>
</span><span id=__span-0-1209><a id=__codelineno-0-1209 name=__codelineno-0-1209></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>],</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=n>ChatCompletionMessageToolCall</span><span class=p>]]]:</span>
</span><span id=__span-0-1210><a id=__codelineno-0-1210 name=__codelineno-0-1210></a>        <span class=k>if</span> <span class=nb>hasattr</span><span class=p>(</span><span class=n>response_message</span><span class=p>,</span> <span class=s2>&quot;tool_calls&quot;</span><span class=p>)</span> <span class=ow>and</span> <span class=n>response_message</span><span class=o>.</span><span class=n>tool_calls</span><span class=p>:</span>
</span><span id=__span-0-1211><a id=__codelineno-0-1211 name=__codelineno-0-1211></a>            <span class=k>return</span> <span class=n>response_message</span><span class=o>.</span><span class=n>content</span><span class=p>,</span> <span class=n>response_message</span><span class=o>.</span><span class=n>tool_calls</span>
</span><span id=__span-0-1212><a id=__codelineno-0-1212 name=__codelineno-0-1212></a>        <span class=k>if</span> <span class=s2>&quot;content&quot;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>response_message</span> <span class=ow>or</span> <span class=n>response_message</span><span class=o>.</span><span class=n>content</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-1213><a id=__codelineno-0-1213 name=__codelineno-0-1213></a>            <span class=k>return</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span>
</span><span id=__span-0-1214><a id=__codelineno-0-1214 name=__codelineno-0-1214></a>        <span class=n>content</span> <span class=o>=</span> <span class=n>response_message</span><span class=o>.</span><span class=n>content</span>
</span><span id=__span-0-1215><a id=__codelineno-0-1215 name=__codelineno-0-1215></a>        <span class=n>llama_matches</span> <span class=o>=</span> <span class=n>LLAMA_TOOL_FORMAT_PATTERN</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>
</span><span id=__span-0-1216><a id=__codelineno-0-1216 name=__codelineno-0-1216></a>        <span class=k>if</span> <span class=n>llama_matches</span><span class=p>:</span>
</span><span id=__span-0-1217><a id=__codelineno-0-1217 name=__codelineno-0-1217></a>            <span class=n>text</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-1218><a id=__codelineno-0-1218 name=__codelineno-0-1218></a>            <span class=n>tool_calls</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-0-1219><a id=__codelineno-0-1219 name=__codelineno-0-1219></a>            <span class=k>for</span> <span class=n>llama_match</span> <span class=ow>in</span> <span class=n>llama_matches</span><span class=p>:</span>
</span><span id=__span-0-1220><a id=__codelineno-0-1220 name=__codelineno-0-1220></a>                <span class=n>before_call_text</span><span class=p>,</span> <span class=n>function_name</span><span class=p>,</span> <span class=n>args</span><span class=p>,</span> <span class=n>end_tag</span><span class=p>,</span> <span class=n>after_call_text</span> <span class=o>=</span> <span class=n>llama_match</span>
</span><span id=__span-0-1221><a id=__codelineno-0-1221 name=__codelineno-0-1221></a>                <span class=n>function</span> <span class=o>=</span> <span class=n>Function</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=n>function_name</span><span class=p>,</span> <span class=n>arguments</span><span class=o>=</span><span class=n>args</span><span class=p>)</span>
</span><span id=__span-0-1222><a id=__codelineno-0-1222 name=__codelineno-0-1222></a>                <span class=n>tool_call</span> <span class=o>=</span> <span class=n>ChatCompletionMessageToolCall</span><span class=p>(</span><span class=nb>id</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()),</span> <span class=n>function</span><span class=o>=</span><span class=n>function</span><span class=p>)</span>
</span><span id=__span-0-1223><a id=__codelineno-0-1223 name=__codelineno-0-1223></a>                <span class=n>text</span> <span class=o>+=</span> <span class=n>before_call_text</span> <span class=o>+</span> <span class=n>after_call_text</span>
</span><span id=__span-0-1224><a id=__codelineno-0-1224 name=__codelineno-0-1224></a>                <span class=n>tool_calls</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>tool_call</span><span class=p>)</span>
</span><span id=__span-0-1225><a id=__codelineno-0-1225 name=__codelineno-0-1225></a>            <span class=k>return</span> <span class=n>text</span><span class=p>,</span> <span class=n>tool_calls</span>
</span><span id=__span-0-1226><a id=__codelineno-0-1226 name=__codelineno-0-1226></a>
</span><span id=__span-0-1227><a id=__codelineno-0-1227 name=__codelineno-0-1227></a>        <span class=n>llama_matches</span> <span class=o>=</span> <span class=n>LLAMA_TOOL_FORMAT_PATTERN2</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>
</span><span id=__span-0-1228><a id=__codelineno-0-1228 name=__codelineno-0-1228></a>        <span class=k>if</span> <span class=n>llama_matches</span><span class=p>:</span>
</span><span id=__span-0-1229><a id=__codelineno-0-1229 name=__codelineno-0-1229></a>            <span class=n>text</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-1230><a id=__codelineno-0-1230 name=__codelineno-0-1230></a>            <span class=n>tool_calls</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-0-1231><a id=__codelineno-0-1231 name=__codelineno-0-1231></a>            <span class=k>for</span> <span class=n>llama_match</span> <span class=ow>in</span> <span class=n>llama_matches</span><span class=p>:</span>
</span><span id=__span-0-1232><a id=__codelineno-0-1232 name=__codelineno-0-1232></a>                <span class=n>before_call_text</span><span class=p>,</span> <span class=n>function_name_and_args</span><span class=p>,</span> <span class=n>after_call_text</span> <span class=o>=</span> <span class=n>llama_match</span>
</span><span id=__span-0-1233><a id=__codelineno-0-1233 name=__codelineno-0-1233></a>                <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-1234><a id=__codelineno-0-1234 name=__codelineno-0-1234></a>                    <span class=n>parsed_function_name_and_args</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>function_name_and_args</span><span class=p>)</span>
</span><span id=__span-0-1235><a id=__codelineno-0-1235 name=__codelineno-0-1235></a>                    <span class=n>function_name</span> <span class=o>=</span> <span class=n>parsed_function_name_and_args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;name&quot;</span><span class=p>)</span>
</span><span id=__span-0-1236><a id=__codelineno-0-1236 name=__codelineno-0-1236></a>                    <span class=n>args</span> <span class=o>=</span> <span class=n>parsed_function_name_and_args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;arguments&quot;</span><span class=p>)</span>
</span><span id=__span-0-1237><a id=__codelineno-0-1237 name=__codelineno-0-1237></a>                    <span class=n>function</span> <span class=o>=</span> <span class=n>Function</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=n>function_name</span><span class=p>,</span> <span class=n>arguments</span><span class=o>=</span><span class=n>args</span><span class=p>)</span>
</span><span id=__span-0-1238><a id=__codelineno-0-1238 name=__codelineno-0-1238></a>                    <span class=n>tool_call</span> <span class=o>=</span> <span class=n>ChatCompletionMessageToolCall</span><span class=p>(</span><span class=nb>id</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()),</span> <span class=n>function</span><span class=o>=</span><span class=n>function</span><span class=p>)</span>
</span><span id=__span-0-1239><a id=__codelineno-0-1239 name=__codelineno-0-1239></a>                    <span class=n>text</span> <span class=o>+=</span> <span class=n>before_call_text</span> <span class=o>+</span> <span class=n>after_call_text</span>
</span><span id=__span-0-1240><a id=__codelineno-0-1240 name=__codelineno-0-1240></a>                    <span class=n>tool_calls</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>tool_call</span><span class=p>)</span>
</span><span id=__span-0-1241><a id=__codelineno-0-1241 name=__codelineno-0-1241></a>                <span class=k>except</span> <span class=n>json</span><span class=o>.</span><span class=n>JSONDecodeError</span><span class=p>:</span>
</span><span id=__span-0-1242><a id=__codelineno-0-1242 name=__codelineno-0-1242></a>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error parsing tool_call function name and args: </span><span class=si>{</span><span class=n>function_name_and_args</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-1243><a id=__codelineno-0-1243 name=__codelineno-0-1243></a>                    <span class=k>continue</span>
</span><span id=__span-0-1244><a id=__codelineno-0-1244 name=__codelineno-0-1244></a>            <span class=k>return</span> <span class=n>text</span><span class=p>,</span> <span class=n>tool_calls</span>
</span><span id=__span-0-1245><a id=__codelineno-0-1245 name=__codelineno-0-1245></a>
</span><span id=__span-0-1246><a id=__codelineno-0-1246 name=__codelineno-0-1246></a>        <span class=k>return</span> <span class=n>content</span><span class=p>,</span> <span class=kc>None</span>
</span><span id=__span-0-1247><a id=__codelineno-0-1247 name=__codelineno-0-1247></a>
</span><span id=__span-0-1248><a id=__codelineno-0-1248 name=__codelineno-0-1248></a>    <span class=nd>@staticmethod</span>
</span><span id=__span-0-1249><a id=__codelineno-0-1249 name=__codelineno-0-1249></a>    <span class=k>def</span><span class=w> </span><span class=nf>_use_llama_tool_syntax</span><span class=p>(</span><span class=n>model</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>tools</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span><span id=__span-0-1250><a id=__codelineno-0-1250 name=__codelineno-0-1250></a>        <span class=k>return</span> <span class=n>tools</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=ow>and</span> <span class=s2>&quot;llama&quot;</span> <span class=ow>in</span> <span class=n>model</span>
</span><span id=__span-0-1251><a id=__codelineno-0-1251 name=__codelineno-0-1251></a>
</span><span id=__span-0-1252><a id=__codelineno-0-1252 name=__codelineno-0-1252></a>    <span class=nd>@staticmethod</span>
</span><span id=__span-0-1253><a id=__codelineno-0-1253 name=__codelineno-0-1253></a>    <span class=k>def</span><span class=w> </span><span class=nf>_llama_tool_prompt</span><span class=p>(</span><span class=n>tools</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-0-1254><a id=__codelineno-0-1254 name=__codelineno-0-1254></a>        <span class=k>return</span> <span class=p>(</span>
</span><span id=__span-0-1255><a id=__codelineno-0-1255 name=__codelineno-0-1255></a><span class=w>            </span><span class=sd>&quot;&quot;&quot;Answer the user&#39;s question by making use of the following functions if needed.</span>
</span><span id=__span-0-1256><a id=__codelineno-0-1256 name=__codelineno-0-1256></a><span class=sd>            If none of the function can be used, please say so.</span>
</span><span id=__span-0-1257><a id=__codelineno-0-1257 name=__codelineno-0-1257></a><span class=sd>            Here is a list of functions in JSON format:&quot;&quot;&quot;</span>
</span><span id=__span-0-1258><a id=__codelineno-0-1258 name=__codelineno-0-1258></a>            <span class=o>+</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>tools</span><span class=p>)</span>
</span><span id=__span-0-1259><a id=__codelineno-0-1259 name=__codelineno-0-1259></a>            <span class=o>+</span> <span class=s2>&quot;&quot;&quot;Think very carefully before calling functions.</span>
</span><span id=__span-0-1260><a id=__codelineno-0-1260 name=__codelineno-0-1260></a><span class=s2>            If you choose to call a function ONLY reply in the following format with no prefix or suffix:</span>
</span><span id=__span-0-1261><a id=__codelineno-0-1261 name=__codelineno-0-1261></a>
</span><span id=__span-0-1262><a id=__codelineno-0-1262 name=__codelineno-0-1262></a><span class=s2>            &lt;function=example_function_name&gt;{&quot;example_name&quot;: &quot;example_value&quot;}&lt;/function&gt;</span>
</span><span id=__span-0-1263><a id=__codelineno-0-1263 name=__codelineno-0-1263></a>
</span><span id=__span-0-1264><a id=__codelineno-0-1264 name=__codelineno-0-1264></a><span class=s2>            Reminder:</span>
</span><span id=__span-0-1265><a id=__codelineno-0-1265 name=__codelineno-0-1265></a><span class=s2>            - Function calls MUST follow the specified format, start with &lt;function= and end with &lt;/function&gt;</span>
</span><span id=__span-0-1266><a id=__codelineno-0-1266 name=__codelineno-0-1266></a><span class=s2>            - Function arguments MUST be in JSON format using double quotes</span>
</span><span id=__span-0-1267><a id=__codelineno-0-1267 name=__codelineno-0-1267></a><span class=s2>            - Required parameters MUST be specified</span>
</span><span id=__span-0-1268><a id=__codelineno-0-1268 name=__codelineno-0-1268></a><span class=s2>            - Multiple functions can be called in one message as long as they are on separate lines.</span>
</span><span id=__span-0-1269><a id=__codelineno-0-1269 name=__codelineno-0-1269></a><span class=s2>            - Put the entire function call reply on one line</span>
</span><span id=__span-0-1270><a id=__codelineno-0-1270 name=__codelineno-0-1270></a><span class=s2>        &quot;&quot;&quot;</span>
</span><span id=__span-0-1271><a id=__codelineno-0-1271 name=__codelineno-0-1271></a>        <span class=p>)</span>
</span><span id=__span-0-1272><a id=__codelineno-0-1272 name=__codelineno-0-1272></a>
</span><span id=__span-0-1273><a id=__codelineno-0-1273 name=__codelineno-0-1273></a>    <span class=c1># TODO(286): `messages` may be model and `model` may be messages temporarily to support deprecated API.</span>
</span><span id=__span-0-1274><a id=__codelineno-0-1274 name=__codelineno-0-1274></a>    <span class=k>def</span><span class=w> </span><span class=nf>completion</span><span class=p>(</span>
</span><span id=__span-0-1275><a id=__codelineno-0-1275 name=__codelineno-0-1275></a>        <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-1276><a id=__codelineno-0-1276 name=__codelineno-0-1276></a>        <span class=n>messages</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Iterable</span><span class=p>[</span><span class=n>ChatCompletionMessageParam</span><span class=p>],</span> <span class=nb>str</span><span class=p>],</span>
</span><span id=__span-0-1277><a id=__codelineno-0-1277 name=__codelineno-0-1277></a>        <span class=n>model</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Iterable</span><span class=p>[</span><span class=n>ChatCompletionMessageParam</span><span class=p>],</span> <span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-1278><a id=__codelineno-0-1278 name=__codelineno-0-1278></a>        <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span>
</span><span id=__span-0-1279><a id=__codelineno-0-1279 name=__codelineno-0-1279></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-0-1280><a id=__codelineno-0-1280 name=__codelineno-0-1280></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns a completion for the given messages using the given model.&quot;&quot;&quot;</span>
</span><span id=__span-0-1281><a id=__codelineno-0-1281 name=__codelineno-0-1281></a>        <span class=n>raw_response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>completions</span><span class=p>(</span><span class=n>messages</span><span class=p>,</span> <span class=n>model</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span><span id=__span-0-1282><a id=__codelineno-0-1282 name=__codelineno-0-1282></a>        <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>raw_response</span><span class=p>,</span> <span class=n>ModelResponse</span><span class=p>),</span> <span class=s2>&quot;Expected ModelResponse&quot;</span>
</span><span id=__span-0-1283><a id=__codelineno-0-1283 name=__codelineno-0-1283></a>        <span class=n>response</span><span class=p>:</span> <span class=n>ModelResponse</span> <span class=o>=</span> <span class=n>raw_response</span>
</span><span id=__span-0-1284><a id=__codelineno-0-1284 name=__codelineno-0-1284></a>        <span class=k>assert</span> <span class=nb>all</span><span class=p>(</span><span class=nb>map</span><span class=p>(</span><span class=k>lambda</span> <span class=n>choice</span><span class=p>:</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>choice</span><span class=p>,</span> <span class=n>Choices</span><span class=p>),</span> <span class=n>response</span><span class=o>.</span><span class=n>choices</span><span class=p>)),</span> <span class=s2>&quot;Expected Choices&quot;</span>
</span><span id=__span-0-1285><a id=__codelineno-0-1285 name=__codelineno-0-1285></a>        <span class=n>choices</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Choices</span><span class=p>]</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>choices</span>  <span class=c1># type: ignore</span>
</span><span id=__span-0-1286><a id=__codelineno-0-1286 name=__codelineno-0-1286></a>        <span class=n>response_message</span> <span class=o>=</span> <span class=n>choices</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>message</span><span class=o>.</span><span class=n>content</span>
</span><span id=__span-0-1287><a id=__codelineno-0-1287 name=__codelineno-0-1287></a>        <span class=k>assert</span> <span class=n>response_message</span><span class=p>,</span> <span class=s2>&quot;No completions returned&quot;</span>
</span><span id=__span-0-1288><a id=__codelineno-0-1288 name=__codelineno-0-1288></a>        <span class=k>return</span> <span class=n>response_message</span>
</span><span id=__span-0-1289><a id=__codelineno-0-1289 name=__codelineno-0-1289></a>
</span><span id=__span-0-1290><a id=__codelineno-0-1290 name=__codelineno-0-1290></a>    <span class=k>def</span><span class=w> </span><span class=nf>signed_completion</span><span class=p>(</span>
</span><span id=__span-0-1291><a id=__codelineno-0-1291 name=__codelineno-0-1291></a>        <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-1292><a id=__codelineno-0-1292 name=__codelineno-0-1292></a>        <span class=n>messages</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Iterable</span><span class=p>[</span><span class=n>ChatCompletionMessageParam</span><span class=p>],</span> <span class=nb>str</span><span class=p>],</span>
</span><span id=__span-0-1293><a id=__codelineno-0-1293 name=__codelineno-0-1293></a>        <span class=n>model</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Iterable</span><span class=p>[</span><span class=n>ChatCompletionMessageParam</span><span class=p>],</span> <span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-1294><a id=__codelineno-0-1294 name=__codelineno-0-1294></a>        <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span>
</span><span id=__span-0-1295><a id=__codelineno-0-1295 name=__codelineno-0-1295></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]:</span>
</span><span id=__span-0-1296><a id=__codelineno-0-1296 name=__codelineno-0-1296></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns a completion for the given messages using the given model with the agent signature.&quot;&quot;&quot;</span>
</span><span id=__span-0-1297><a id=__codelineno-0-1297 name=__codelineno-0-1297></a>        <span class=c1># TODO Return signed completions for non-latest versions only?</span>
</span><span id=__span-0-1298><a id=__codelineno-0-1298 name=__codelineno-0-1298></a>        <span class=n>agent_name</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_primary_agent</span><span class=p>()</span><span class=o>.</span><span class=n>get_full_name</span><span class=p>()</span>
</span><span id=__span-0-1299><a id=__codelineno-0-1299 name=__codelineno-0-1299></a>        <span class=n>raw_response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>completions</span><span class=p>(</span><span class=n>messages</span><span class=p>,</span> <span class=n>model</span><span class=p>,</span> <span class=n>agent_name</span><span class=o>=</span><span class=n>agent_name</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span><span id=__span-0-1300><a id=__codelineno-0-1300 name=__codelineno-0-1300></a>        <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>raw_response</span><span class=p>,</span> <span class=n>ModelResponse</span><span class=p>),</span> <span class=s2>&quot;Expected ModelResponse&quot;</span>
</span><span id=__span-0-1301><a id=__codelineno-0-1301 name=__codelineno-0-1301></a>        <span class=n>response</span><span class=p>:</span> <span class=n>ModelResponse</span> <span class=o>=</span> <span class=n>raw_response</span>
</span><span id=__span-0-1302><a id=__codelineno-0-1302 name=__codelineno-0-1302></a>
</span><span id=__span-0-1303><a id=__codelineno-0-1303 name=__codelineno-0-1303></a>        <span class=n>signature_data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>system_fingerprint</span><span class=p>)</span> <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>system_fingerprint</span> <span class=k>else</span> <span class=p>{}</span>
</span><span id=__span-0-1304><a id=__codelineno-0-1304 name=__codelineno-0-1304></a>
</span><span id=__span-0-1305><a id=__codelineno-0-1305 name=__codelineno-0-1305></a>        <span class=k>assert</span> <span class=nb>all</span><span class=p>(</span><span class=nb>map</span><span class=p>(</span><span class=k>lambda</span> <span class=n>choice</span><span class=p>:</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>choice</span><span class=p>,</span> <span class=n>Choices</span><span class=p>),</span> <span class=n>response</span><span class=o>.</span><span class=n>choices</span><span class=p>)),</span> <span class=s2>&quot;Expected Choices&quot;</span>
</span><span id=__span-0-1306><a id=__codelineno-0-1306 name=__codelineno-0-1306></a>        <span class=n>choices</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Choices</span><span class=p>]</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>choices</span>  <span class=c1># type: ignore</span>
</span><span id=__span-0-1307><a id=__codelineno-0-1307 name=__codelineno-0-1307></a>        <span class=n>response_message</span> <span class=o>=</span> <span class=n>choices</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>message</span><span class=o>.</span><span class=n>content</span>
</span><span id=__span-0-1308><a id=__codelineno-0-1308 name=__codelineno-0-1308></a>        <span class=k>assert</span> <span class=n>response_message</span><span class=p>,</span> <span class=s2>&quot;No completions returned&quot;</span>
</span><span id=__span-0-1309><a id=__codelineno-0-1309 name=__codelineno-0-1309></a>
</span><span id=__span-0-1310><a id=__codelineno-0-1310 name=__codelineno-0-1310></a>        <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-0-1311><a id=__codelineno-0-1311 name=__codelineno-0-1311></a>            <span class=s2>&quot;response&quot;</span><span class=p>:</span> <span class=n>response_message</span><span class=p>,</span>
</span><span id=__span-0-1312><a id=__codelineno-0-1312 name=__codelineno-0-1312></a>            <span class=s2>&quot;signature&quot;</span><span class=p>:</span> <span class=n>signature_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;signature&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>),</span>
</span><span id=__span-0-1313><a id=__codelineno-0-1313 name=__codelineno-0-1313></a>            <span class=s2>&quot;public_key&quot;</span><span class=p>:</span> <span class=n>signature_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;public_key&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>),</span>
</span><span id=__span-0-1314><a id=__codelineno-0-1314 name=__codelineno-0-1314></a>        <span class=p>}</span>
</span><span id=__span-0-1315><a id=__codelineno-0-1315 name=__codelineno-0-1315></a>
</span><span id=__span-0-1316><a id=__codelineno-0-1316 name=__codelineno-0-1316></a>    <span class=k>def</span><span class=w> </span><span class=nf>completion_and_get_tools_calls</span><span class=p>(</span>
</span><span id=__span-0-1317><a id=__codelineno-0-1317 name=__codelineno-0-1317></a>        <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-1318><a id=__codelineno-0-1318 name=__codelineno-0-1318></a>        <span class=n>messages</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>ChatCompletionMessageParam</span><span class=p>],</span>
</span><span id=__span-0-1319><a id=__codelineno-0-1319 name=__codelineno-0-1319></a>        <span class=n>model</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-1320><a id=__codelineno-0-1320 name=__codelineno-0-1320></a>        <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span>
</span><span id=__span-0-1321><a id=__codelineno-0-1321 name=__codelineno-0-1321></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>SimpleNamespace</span><span class=p>:</span>
</span><span id=__span-0-1322><a id=__codelineno-0-1322 name=__codelineno-0-1322></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns completion message and/or tool calls from OpenAI or Llama tool formats.&quot;&quot;&quot;</span>
</span><span id=__span-0-1323><a id=__codelineno-0-1323 name=__codelineno-0-1323></a>        <span class=n>raw_response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_run_inference_completions</span><span class=p>(</span><span class=n>messages</span><span class=p>,</span> <span class=n>model</span><span class=p>,</span> <span class=n>stream</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span><span id=__span-0-1324><a id=__codelineno-0-1324 name=__codelineno-0-1324></a>
</span><span id=__span-0-1325><a id=__codelineno-0-1325 name=__codelineno-0-1325></a>        <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>raw_response</span><span class=p>,</span> <span class=n>ModelResponse</span><span class=p>),</span> <span class=s2>&quot;Expected ModelResponse&quot;</span>
</span><span id=__span-0-1326><a id=__codelineno-0-1326 name=__codelineno-0-1326></a>        <span class=n>response</span><span class=p>:</span> <span class=n>ModelResponse</span> <span class=o>=</span> <span class=n>raw_response</span>
</span><span id=__span-0-1327><a id=__codelineno-0-1327 name=__codelineno-0-1327></a>        <span class=k>assert</span> <span class=nb>all</span><span class=p>(</span><span class=nb>map</span><span class=p>(</span><span class=k>lambda</span> <span class=n>choice</span><span class=p>:</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>choice</span><span class=p>,</span> <span class=n>Choices</span><span class=p>),</span> <span class=n>response</span><span class=o>.</span><span class=n>choices</span><span class=p>)),</span> <span class=s2>&quot;Expected Choices&quot;</span>
</span><span id=__span-0-1328><a id=__codelineno-0-1328 name=__codelineno-0-1328></a>        <span class=n>choices</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Choices</span><span class=p>]</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>choices</span>  <span class=c1># type: ignore</span>
</span><span id=__span-0-1329><a id=__codelineno-0-1329 name=__codelineno-0-1329></a>
</span><span id=__span-0-1330><a id=__codelineno-0-1330 name=__codelineno-0-1330></a>        <span class=p>(</span><span class=n>message_without_tool_call</span><span class=p>,</span> <span class=n>tool_calls</span><span class=p>)</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_parse_tool_call</span><span class=p>(</span><span class=n>choices</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>message</span><span class=p>)</span>
</span><span id=__span-0-1331><a id=__codelineno-0-1331 name=__codelineno-0-1331></a>
</span><span id=__span-0-1332><a id=__codelineno-0-1332 name=__codelineno-0-1332></a>        <span class=k>if</span> <span class=n>message_without_tool_call</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-1333><a id=__codelineno-0-1333 name=__codelineno-0-1333></a>            <span class=n>response_message</span> <span class=o>=</span> <span class=n>choices</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>message</span><span class=o>.</span><span class=n>content</span>
</span><span id=__span-0-1334><a id=__codelineno-0-1334 name=__codelineno-0-1334></a>            <span class=n>message_without_tool_call</span> <span class=o>=</span> <span class=n>response_message</span>
</span><span id=__span-0-1335><a id=__codelineno-0-1335 name=__codelineno-0-1335></a>
</span><span id=__span-0-1336><a id=__codelineno-0-1336 name=__codelineno-0-1336></a>        <span class=k>return</span> <span class=n>SimpleNamespace</span><span class=p>(</span><span class=n>message</span><span class=o>=</span><span class=n>message_without_tool_call</span><span class=p>,</span> <span class=n>tool_calls</span><span class=o>=</span><span class=n>tool_calls</span><span class=p>)</span>
</span><span id=__span-0-1337><a id=__codelineno-0-1337 name=__codelineno-0-1337></a>
</span><span id=__span-0-1338><a id=__codelineno-0-1338 name=__codelineno-0-1338></a>    <span class=k>def</span><span class=w> </span><span class=nf>completion_and_run_tools</span><span class=p>(</span>
</span><span id=__span-0-1339><a id=__codelineno-0-1339 name=__codelineno-0-1339></a>        <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-1340><a id=__codelineno-0-1340 name=__codelineno-0-1340></a>        <span class=n>messages</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>ChatCompletionMessageParam</span><span class=p>],</span>
</span><span id=__span-0-1341><a id=__codelineno-0-1341 name=__codelineno-0-1341></a>        <span class=n>model</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-1342><a id=__codelineno-0-1342 name=__codelineno-0-1342></a>        <span class=n>tools</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-1343><a id=__codelineno-0-1343 name=__codelineno-0-1343></a>        <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span>
</span><span id=__span-0-1344><a id=__codelineno-0-1344 name=__codelineno-0-1344></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
</span><span id=__span-0-1345><a id=__codelineno-0-1345 name=__codelineno-0-1345></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns a completion for the given messages using the given model and runs tools.&quot;&quot;&quot;</span>
</span><span id=__span-0-1346><a id=__codelineno-0-1346 name=__codelineno-0-1346></a>        <span class=n>completion_tools_response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>completions_and_run_tools</span><span class=p>(</span><span class=n>messages</span><span class=p>,</span> <span class=n>model</span><span class=p>,</span> <span class=n>tools</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span><span id=__span-0-1347><a id=__codelineno-0-1347 name=__codelineno-0-1347></a>        <span class=k>assert</span> <span class=nb>all</span><span class=p>(</span>
</span><span id=__span-0-1348><a id=__codelineno-0-1348 name=__codelineno-0-1348></a>            <span class=nb>map</span><span class=p>(</span>
</span><span id=__span-0-1349><a id=__codelineno-0-1349 name=__codelineno-0-1349></a>                <span class=k>lambda</span> <span class=n>choice</span><span class=p>:</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>choice</span><span class=p>,</span> <span class=n>Choices</span><span class=p>),</span>
</span><span id=__span-0-1350><a id=__codelineno-0-1350 name=__codelineno-0-1350></a>                <span class=n>completion_tools_response</span><span class=o>.</span><span class=n>choices</span><span class=p>,</span>
</span><span id=__span-0-1351><a id=__codelineno-0-1351 name=__codelineno-0-1351></a>            <span class=p>)</span>
</span><span id=__span-0-1352><a id=__codelineno-0-1352 name=__codelineno-0-1352></a>        <span class=p>),</span> <span class=s2>&quot;Expected Choices&quot;</span>
</span><span id=__span-0-1353><a id=__codelineno-0-1353 name=__codelineno-0-1353></a>        <span class=n>choices</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Choices</span><span class=p>]</span> <span class=o>=</span> <span class=n>completion_tools_response</span><span class=o>.</span><span class=n>choices</span>  <span class=c1># type: ignore</span>
</span><span id=__span-0-1354><a id=__codelineno-0-1354 name=__codelineno-0-1354></a>        <span class=n>response_content</span> <span class=o>=</span> <span class=n>choices</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>message</span><span class=o>.</span><span class=n>content</span>
</span><span id=__span-0-1355><a id=__codelineno-0-1355 name=__codelineno-0-1355></a>        <span class=k>return</span> <span class=n>response_content</span>
</span><span id=__span-0-1356><a id=__codelineno-0-1356 name=__codelineno-0-1356></a>
</span><span id=__span-0-1357><a id=__codelineno-0-1357 name=__codelineno-0-1357></a>    <span class=k>def</span><span class=w> </span><span class=nf>call_agent</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>agent_index</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>task</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-1358><a id=__codelineno-0-1358 name=__codelineno-0-1358></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Calls agent with given task.&quot;&quot;&quot;</span>
</span><span id=__span-0-1359><a id=__codelineno-0-1359 name=__codelineno-0-1359></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_agents</span><span class=p>[</span><span class=n>agent_index</span><span class=p>]</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>task</span><span class=o>=</span><span class=n>task</span><span class=p>)</span>
</span><span id=__span-0-1360><a id=__codelineno-0-1360 name=__codelineno-0-1360></a>
</span><span id=__span-0-1361><a id=__codelineno-0-1361 name=__codelineno-0-1361></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_agents</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Agent</span><span class=p>]:</span>
</span><span id=__span-0-1362><a id=__codelineno-0-1362 name=__codelineno-0-1362></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns list of agents available in environment.&quot;&quot;&quot;</span>
</span><span id=__span-0-1363><a id=__codelineno-0-1363 name=__codelineno-0-1363></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_agents</span>
</span><span id=__span-0-1364><a id=__codelineno-0-1364 name=__codelineno-0-1364></a>
</span><span id=__span-0-1365><a id=__codelineno-0-1365 name=__codelineno-0-1365></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_primary_agent</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Agent</span><span class=p>:</span>
</span><span id=__span-0-1366><a id=__codelineno-0-1366 name=__codelineno-0-1366></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns the agent that is invoked first.&quot;&quot;&quot;</span>
</span><span id=__span-0-1367><a id=__codelineno-0-1367 name=__codelineno-0-1367></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_agents</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span><span id=__span-0-1368><a id=__codelineno-0-1368 name=__codelineno-0-1368></a>
</span><span id=__span-0-1369><a id=__codelineno-0-1369 name=__codelineno-0-1369></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_primary_agent_temp_dir</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Path</span><span class=p>:</span>
</span><span id=__span-0-1370><a id=__codelineno-0-1370 name=__codelineno-0-1370></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns temp dir for primary agent.&quot;&quot;&quot;</span>
</span><span id=__span-0-1371><a id=__codelineno-0-1371 name=__codelineno-0-1371></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_primary_agent</span><span class=p>()</span><span class=o>.</span><span class=n>temp_dir</span>
</span><span id=__span-0-1372><a id=__codelineno-0-1372 name=__codelineno-0-1372></a>
</span><span id=__span-0-1373><a id=__codelineno-0-1373 name=__codelineno-0-1373></a>    <span class=k>def</span><span class=w> </span><span class=nf>is_done</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-1374><a id=__codelineno-0-1374 name=__codelineno-0-1374></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_done</span>
</span><span id=__span-0-1375><a id=__codelineno-0-1375 name=__codelineno-0-1375></a>
</span><span id=__span-0-1376><a id=__codelineno-0-1376 name=__codelineno-0-1376></a>    <span class=k>def</span><span class=w> </span><span class=nf>create_snapshot</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span><span id=__span-0-1377><a id=__codelineno-0-1377 name=__codelineno-0-1377></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Create an in memory snapshot.&quot;&quot;&quot;</span>
</span><span id=__span-0-1378><a id=__codelineno-0-1378 name=__codelineno-0-1378></a>        <span class=k>with</span> <span class=n>tempfile</span><span class=o>.</span><span class=n>NamedTemporaryFile</span><span class=p>(</span><span class=n>suffix</span><span class=o>=</span><span class=s2>&quot;.tar.gz&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-1379><a id=__codelineno-0-1379 name=__codelineno-0-1379></a>            <span class=k>with</span> <span class=n>tarfile</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=n>fileobj</span><span class=o>=</span><span class=n>f</span><span class=p>,</span> <span class=n>mode</span><span class=o>=</span><span class=s2>&quot;w:gz&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>tar</span><span class=p>:</span>
</span><span id=__span-0-1380><a id=__codelineno-0-1380 name=__codelineno-0-1380></a>                <span class=n>tar</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_path</span><span class=p>,</span> <span class=n>arcname</span><span class=o>=</span><span class=s2>&quot;.&quot;</span><span class=p>)</span>
</span><span id=__span-0-1381><a id=__codelineno-0-1381 name=__codelineno-0-1381></a>            <span class=n>f</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span><span id=__span-0-1382><a id=__codelineno-0-1382 name=__codelineno-0-1382></a>            <span class=n>f</span><span class=o>.</span><span class=n>seek</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span><span id=__span-0-1383><a id=__codelineno-0-1383 name=__codelineno-0-1383></a>            <span class=n>snapshot</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span><span id=__span-0-1384><a id=__codelineno-0-1384 name=__codelineno-0-1384></a>        <span class=k>return</span> <span class=n>snapshot</span>
</span><span id=__span-0-1385><a id=__codelineno-0-1385 name=__codelineno-0-1385></a>
</span><span id=__span-0-1386><a id=__codelineno-0-1386 name=__codelineno-0-1386></a>    <span class=k>def</span><span class=w> </span><span class=nf>environment_run_info</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>base_id</span><span class=p>,</span> <span class=n>run_type</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span><span id=__span-0-1387><a id=__codelineno-0-1387 name=__codelineno-0-1387></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns the environment run information.&quot;&quot;&quot;</span>
</span><span id=__span-0-1388><a id=__codelineno-0-1388 name=__codelineno-0-1388></a>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_agents</span> <span class=ow>or</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_primary_agent</span><span class=p>():</span>
</span><span id=__span-0-1389><a id=__codelineno-0-1389 name=__codelineno-0-1389></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Agent not found&quot;</span><span class=p>)</span>
</span><span id=__span-0-1390><a id=__codelineno-0-1390 name=__codelineno-0-1390></a>        <span class=n>primary_agent</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_primary_agent</span><span class=p>()</span>
</span><span id=__span-0-1391><a id=__codelineno-0-1391 name=__codelineno-0-1391></a>
</span><span id=__span-0-1392><a id=__codelineno-0-1392 name=__codelineno-0-1392></a>        <span class=n>full_agent_name</span> <span class=o>=</span> <span class=s2>&quot;/&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=n>primary_agent</span><span class=o>.</span><span class=n>namespace</span><span class=p>,</span> <span class=n>primary_agent</span><span class=o>.</span><span class=n>name</span><span class=p>,</span> <span class=n>primary_agent</span><span class=o>.</span><span class=n>version</span><span class=p>])</span>
</span><span id=__span-0-1393><a id=__codelineno-0-1393 name=__codelineno-0-1393></a>        <span class=n>safe_agent_name</span> <span class=o>=</span> <span class=n>full_agent_name</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;/&quot;</span><span class=p>,</span> <span class=s2>&quot;_&quot;</span><span class=p>)</span>
</span><span id=__span-0-1394><a id=__codelineno-0-1394 name=__codelineno-0-1394></a>        <span class=n>uid</span> <span class=o>=</span> <span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()</span><span class=o>.</span><span class=n>hex</span>
</span><span id=__span-0-1395><a id=__codelineno-0-1395 name=__codelineno-0-1395></a>        <span class=n>generated_name</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;environment_run_</span><span class=si>{</span><span class=n>safe_agent_name</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>uid</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-1396><a id=__codelineno-0-1396 name=__codelineno-0-1396></a>        <span class=n>name</span> <span class=o>=</span> <span class=n>generated_name</span>
</span><span id=__span-0-1397><a id=__codelineno-0-1397 name=__codelineno-0-1397></a>
</span><span id=__span-0-1398><a id=__codelineno-0-1398 name=__codelineno-0-1398></a>        <span class=n>timestamp</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>(</span><span class=n>timezone</span><span class=o>.</span><span class=n>utc</span><span class=p>)</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span><span id=__span-0-1399><a id=__codelineno-0-1399 name=__codelineno-0-1399></a>        <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-0-1400><a id=__codelineno-0-1400 name=__codelineno-0-1400></a>            <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=n>name</span><span class=p>,</span>
</span><span id=__span-0-1401><a id=__codelineno-0-1401 name=__codelineno-0-1401></a>            <span class=s2>&quot;version&quot;</span><span class=p>:</span> <span class=s2>&quot;0&quot;</span><span class=p>,</span>
</span><span id=__span-0-1402><a id=__codelineno-0-1402 name=__codelineno-0-1402></a>            <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;Agent </span><span class=si>{</span><span class=n>run_type</span><span class=si>}</span><span class=s2> </span><span class=si>{</span><span class=n>full_agent_name</span><span class=si>}</span><span class=s2> </span><span class=si>{</span><span class=n>uid</span><span class=si>}</span><span class=s2> </span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-0-1403><a id=__codelineno-0-1403 name=__codelineno-0-1403></a>            <span class=s2>&quot;category&quot;</span><span class=p>:</span> <span class=s2>&quot;environment&quot;</span><span class=p>,</span>
</span><span id=__span-0-1404><a id=__codelineno-0-1404 name=__codelineno-0-1404></a>            <span class=s2>&quot;tags&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;environment&quot;</span><span class=p>],</span>
</span><span id=__span-0-1405><a id=__codelineno-0-1405 name=__codelineno-0-1405></a>            <span class=s2>&quot;details&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-0-1406><a id=__codelineno-0-1406 name=__codelineno-0-1406></a>                <span class=s2>&quot;base_id&quot;</span><span class=p>:</span> <span class=n>base_id</span><span class=p>,</span>
</span><span id=__span-0-1407><a id=__codelineno-0-1407 name=__codelineno-0-1407></a>                <span class=s2>&quot;timestamp&quot;</span><span class=p>:</span> <span class=n>timestamp</span><span class=p>,</span>
</span><span id=__span-0-1408><a id=__codelineno-0-1408 name=__codelineno-0-1408></a>                <span class=s2>&quot;agents&quot;</span><span class=p>:</span> <span class=p>[</span><span class=n>agent</span><span class=o>.</span><span class=n>name</span> <span class=k>for</span> <span class=n>agent</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>_agents</span><span class=p>],</span>
</span><span id=__span-0-1409><a id=__codelineno-0-1409 name=__codelineno-0-1409></a>                <span class=s2>&quot;primary_agent_namespace&quot;</span><span class=p>:</span> <span class=n>primary_agent</span><span class=o>.</span><span class=n>namespace</span><span class=p>,</span>
</span><span id=__span-0-1410><a id=__codelineno-0-1410 name=__codelineno-0-1410></a>                <span class=s2>&quot;primary_agent_name&quot;</span><span class=p>:</span> <span class=n>primary_agent</span><span class=o>.</span><span class=n>name</span><span class=p>,</span>
</span><span id=__span-0-1411><a id=__codelineno-0-1411 name=__codelineno-0-1411></a>                <span class=s2>&quot;primary_agent_version&quot;</span><span class=p>:</span> <span class=n>primary_agent</span><span class=o>.</span><span class=n>version</span><span class=p>,</span>
</span><span id=__span-0-1412><a id=__codelineno-0-1412 name=__codelineno-0-1412></a>                <span class=s2>&quot;run_id&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_run_id</span><span class=p>,</span>
</span><span id=__span-0-1413><a id=__codelineno-0-1413 name=__codelineno-0-1413></a>                <span class=s2>&quot;run_type&quot;</span><span class=p>:</span> <span class=n>run_type</span><span class=p>,</span>
</span><span id=__span-0-1414><a id=__codelineno-0-1414 name=__codelineno-0-1414></a>            <span class=p>},</span>
</span><span id=__span-0-1415><a id=__codelineno-0-1415 name=__codelineno-0-1415></a>            <span class=s2>&quot;show_entry&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-1416><a id=__codelineno-0-1416 name=__codelineno-0-1416></a>        <span class=p>}</span>
</span><span id=__span-0-1417><a id=__codelineno-0-1417 name=__codelineno-0-1417></a>
</span><span id=__span-0-1418><a id=__codelineno-0-1418 name=__codelineno-0-1418></a>    <span class=k>def</span><span class=w> </span><span class=nf>load_snapshot</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>snapshot</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-1419><a id=__codelineno-0-1419 name=__codelineno-0-1419></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Load Environment from Snapshot.&quot;&quot;&quot;</span>
</span><span id=__span-0-1420><a id=__codelineno-0-1420 name=__codelineno-0-1420></a>        <span class=n>shutil</span><span class=o>.</span><span class=n>rmtree</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_path</span><span class=p>,</span> <span class=n>ignore_errors</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-1421><a id=__codelineno-0-1421 name=__codelineno-0-1421></a>
</span><span id=__span-0-1422><a id=__codelineno-0-1422 name=__codelineno-0-1422></a>        <span class=k>with</span> <span class=n>tempfile</span><span class=o>.</span><span class=n>NamedTemporaryFile</span><span class=p>(</span><span class=n>suffix</span><span class=o>=</span><span class=s2>&quot;.tar.gz&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-1423><a id=__codelineno-0-1423 name=__codelineno-0-1423></a>            <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>snapshot</span><span class=p>)</span>
</span><span id=__span-0-1424><a id=__codelineno-0-1424 name=__codelineno-0-1424></a>            <span class=n>f</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span><span id=__span-0-1425><a id=__codelineno-0-1425 name=__codelineno-0-1425></a>            <span class=n>f</span><span class=o>.</span><span class=n>seek</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span><span id=__span-0-1426><a id=__codelineno-0-1426 name=__codelineno-0-1426></a>
</span><span id=__span-0-1427><a id=__codelineno-0-1427 name=__codelineno-0-1427></a>            <span class=k>with</span> <span class=n>tarfile</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=n>fileobj</span><span class=o>=</span><span class=n>f</span><span class=p>,</span> <span class=n>mode</span><span class=o>=</span><span class=s2>&quot;r:gz&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>tar</span><span class=p>:</span>
</span><span id=__span-0-1428><a id=__codelineno-0-1428 name=__codelineno-0-1428></a>                <span class=n>tar</span><span class=o>.</span><span class=n>extractall</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_path</span><span class=p>)</span>
</span><span id=__span-0-1429><a id=__codelineno-0-1429 name=__codelineno-0-1429></a>
</span><span id=__span-0-1430><a id=__codelineno-0-1430 name=__codelineno-0-1430></a>    <span class=k>def</span><span class=w> </span><span class=fm>__str__</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>  <span class=c1># noqa: D105</span>
</span><span id=__span-0-1431><a id=__codelineno-0-1431 name=__codelineno-0-1431></a>        <span class=k>return</span> <span class=sa>f</span><span class=s2>&quot;Environment(</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>_path</span><span class=si>}</span><span class=s2>)&quot;</span>
</span><span id=__span-0-1432><a id=__codelineno-0-1432 name=__codelineno-0-1432></a>
</span><span id=__span-0-1433><a id=__codelineno-0-1433 name=__codelineno-0-1433></a>    <span class=k>def</span><span class=w> </span><span class=nf>clear_temp_agent_files</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>verbose</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-1434><a id=__codelineno-0-1434 name=__codelineno-0-1434></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Remove temp agent files created to be used in `runpy`.&quot;&quot;&quot;</span>
</span><span id=__span-0-1435><a id=__codelineno-0-1435 name=__codelineno-0-1435></a>        <span class=k>for</span> <span class=n>agent</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>_agents</span><span class=p>:</span>
</span><span id=__span-0-1436><a id=__codelineno-0-1436 name=__codelineno-0-1436></a>            <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>agent</span><span class=o>.</span><span class=n>temp_dir</span><span class=p>):</span>
</span><span id=__span-0-1437><a id=__codelineno-0-1437 name=__codelineno-0-1437></a>                <span class=k>if</span> <span class=n>verbose</span><span class=p>:</span>
</span><span id=__span-0-1438><a id=__codelineno-0-1438 name=__codelineno-0-1438></a>                    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;removed agent.temp_files&quot;</span><span class=p>,</span> <span class=n>agent</span><span class=o>.</span><span class=n>temp_dir</span><span class=p>)</span>
</span><span id=__span-0-1439><a id=__codelineno-0-1439 name=__codelineno-0-1439></a>                <span class=n>shutil</span><span class=o>.</span><span class=n>rmtree</span><span class=p>(</span><span class=n>agent</span><span class=o>.</span><span class=n>temp_dir</span><span class=p>)</span>
</span><span id=__span-0-1440><a id=__codelineno-0-1440 name=__codelineno-0-1440></a>
</span><span id=__span-0-1441><a id=__codelineno-0-1441 name=__codelineno-0-1441></a>    <span class=k>def</span><span class=w> </span><span class=nf>set_next_actor</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>who</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-1442><a id=__codelineno-0-1442 name=__codelineno-0-1442></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Set the next actor / action in the dialogue.&quot;&quot;&quot;</span>
</span><span id=__span-0-1443><a id=__codelineno-0-1443 name=__codelineno-0-1443></a>        <span class=n>next_action_fn</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_path</span><span class=p>,</span> <span class=s2>&quot;.next_action&quot;</span><span class=p>)</span>
</span><span id=__span-0-1444><a id=__codelineno-0-1444 name=__codelineno-0-1444></a>        <span class=k>if</span> <span class=n>who</span> <span class=o>==</span> <span class=s2>&quot;agent&quot;</span><span class=p>:</span>
</span><span id=__span-0-1445><a id=__codelineno-0-1445 name=__codelineno-0-1445></a>            <span class=bp>self</span><span class=o>.</span><span class=n>_done</span> <span class=o>=</span> <span class=kc>False</span>
</span><span id=__span-0-1446><a id=__codelineno-0-1446 name=__codelineno-0-1446></a>
</span><span id=__span-0-1447><a id=__codelineno-0-1447 name=__codelineno-0-1447></a>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>next_action_fn</span><span class=p>,</span> <span class=s2>&quot;w&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-1448><a id=__codelineno-0-1448 name=__codelineno-0-1448></a>            <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>who</span><span class=p>)</span>
</span><span id=__span-0-1449><a id=__codelineno-0-1449 name=__codelineno-0-1449></a>
</span><span id=__span-0-1450><a id=__codelineno-0-1450 name=__codelineno-0-1450></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_next_actor</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-1451><a id=__codelineno-0-1451 name=__codelineno-0-1451></a>        <span class=n>next_action_fn</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_path</span><span class=p>,</span> <span class=s2>&quot;.next_action&quot;</span><span class=p>)</span>
</span><span id=__span-0-1452><a id=__codelineno-0-1452 name=__codelineno-0-1452></a>
</span><span id=__span-0-1453><a id=__codelineno-0-1453 name=__codelineno-0-1453></a>        <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>next_action_fn</span><span class=p>):</span>
</span><span id=__span-0-1454><a id=__codelineno-0-1454 name=__codelineno-0-1454></a>            <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>next_action_fn</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-1455><a id=__codelineno-0-1455 name=__codelineno-0-1455></a>                <span class=k>return</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span><span class=o>.</span><span class=n>strip</span><span class=p>(</span><span class=s2>&quot; </span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-1456><a id=__codelineno-0-1456 name=__codelineno-0-1456></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-1457><a id=__codelineno-0-1457 name=__codelineno-0-1457></a>            <span class=c1># By default the user starts the conversation.</span>
</span><span id=__span-0-1458><a id=__codelineno-0-1458 name=__codelineno-0-1458></a>            <span class=k>return</span> <span class=s2>&quot;user&quot;</span>
</span><span id=__span-0-1459><a id=__codelineno-0-1459 name=__codelineno-0-1459></a>
</span><span id=__span-0-1460><a id=__codelineno-0-1460 name=__codelineno-0-1460></a>    <span class=k>def</span><span class=w> </span><span class=nf>run</span><span class=p>(</span>
</span><span id=__span-0-1461><a id=__codelineno-0-1461 name=__codelineno-0-1461></a>        <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-1462><a id=__codelineno-0-1462 name=__codelineno-0-1462></a>        <span class=n>new_message</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-1463><a id=__codelineno-0-1463 name=__codelineno-0-1463></a>        <span class=n>max_iterations</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>10</span><span class=p>,</span>
</span><span id=__span-0-1464><a id=__codelineno-0-1464 name=__codelineno-0-1464></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-1465><a id=__codelineno-0-1465 name=__codelineno-0-1465></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Runs agent(s) against a new or previously created environment.&quot;&quot;&quot;</span>
</span><span id=__span-0-1466><a id=__codelineno-0-1466 name=__codelineno-0-1466></a>        <span class=k>if</span> <span class=n>new_message</span><span class=p>:</span>
</span><span id=__span-0-1467><a id=__codelineno-0-1467 name=__codelineno-0-1467></a>            <span class=bp>self</span><span class=o>.</span><span class=n>_add_message</span><span class=p>(</span><span class=s2>&quot;user&quot;</span><span class=p>,</span> <span class=n>new_message</span><span class=p>)</span>
</span><span id=__span-0-1468><a id=__codelineno-0-1468 name=__codelineno-0-1468></a>
</span><span id=__span-0-1469><a id=__codelineno-0-1469 name=__codelineno-0-1469></a>        <span class=n>iteration</span> <span class=o>=</span> <span class=mi>0</span>
</span><span id=__span-0-1470><a id=__codelineno-0-1470 name=__codelineno-0-1470></a>        <span class=bp>self</span><span class=o>.</span><span class=n>set_next_actor</span><span class=p>(</span><span class=s2>&quot;agent&quot;</span><span class=p>)</span>
</span><span id=__span-0-1471><a id=__codelineno-0-1471 name=__codelineno-0-1471></a>
</span><span id=__span-0-1472><a id=__codelineno-0-1472 name=__codelineno-0-1472></a>        <span class=k>while</span> <span class=n>iteration</span> <span class=o>&lt;</span> <span class=n>max_iterations</span> <span class=ow>and</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_done</span><span class=p>()</span> <span class=ow>and</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_next_actor</span><span class=p>()</span> <span class=o>!=</span> <span class=s2>&quot;user&quot;</span><span class=p>:</span>
</span><span id=__span-0-1473><a id=__codelineno-0-1473 name=__codelineno-0-1473></a>            <span class=n>iteration</span> <span class=o>+=</span> <span class=mi>1</span>
</span><span id=__span-0-1474><a id=__codelineno-0-1474 name=__codelineno-0-1474></a>            <span class=k>if</span> <span class=n>max_iterations</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
</span><span id=__span-0-1475><a id=__codelineno-0-1475 name=__codelineno-0-1475></a>                <span class=bp>self</span><span class=o>.</span><span class=n>add_system_log</span><span class=p>(</span>
</span><span id=__span-0-1476><a id=__codelineno-0-1476 name=__codelineno-0-1476></a>                    <span class=sa>f</span><span class=s2>&quot;Running agent, iteration </span><span class=si>{</span><span class=n>iteration</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>max_iterations</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-0-1477><a id=__codelineno-0-1477 name=__codelineno-0-1477></a>                    <span class=n>logging</span><span class=o>.</span><span class=n>INFO</span><span class=p>,</span>
</span><span id=__span-0-1478><a id=__codelineno-0-1478 name=__codelineno-0-1478></a>                <span class=p>)</span>
</span><span id=__span-0-1479><a id=__codelineno-0-1479 name=__codelineno-0-1479></a>            <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-1480><a id=__codelineno-0-1480 name=__codelineno-0-1480></a>                <span class=n>error_message</span><span class=p>,</span> <span class=n>traceback_message</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_primary_agent</span><span class=p>()</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>task</span><span class=o>=</span><span class=n>new_message</span><span class=p>)</span>
</span><span id=__span-0-1481><a id=__codelineno-0-1481 name=__codelineno-0-1481></a>                <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_debug_mode</span> <span class=ow>and</span> <span class=p>(</span><span class=n>error_message</span> <span class=ow>or</span> <span class=n>traceback_message</span><span class=p>):</span>
</span><span id=__span-0-1482><a id=__codelineno-0-1482 name=__codelineno-0-1482></a>                    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_debug_mode</span> <span class=ow>and</span> <span class=p>(</span><span class=n>error_message</span> <span class=ow>or</span> <span class=n>traceback_message</span><span class=p>):</span>
</span><span id=__span-0-1483><a id=__codelineno-0-1483 name=__codelineno-0-1483></a>                        <span class=n>message_parts</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-0-1484><a id=__codelineno-0-1484 name=__codelineno-0-1484></a>
</span><span id=__span-0-1485><a id=__codelineno-0-1485 name=__codelineno-0-1485></a>                        <span class=k>if</span> <span class=n>error_message</span><span class=p>:</span>
</span><span id=__span-0-1486><a id=__codelineno-0-1486 name=__codelineno-0-1486></a>                            <span class=n>message_parts</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error: </span><span class=se>\n</span><span class=s2> ```</span><span class=se>\n</span><span class=si>{</span><span class=n>error_message</span><span class=si>}</span><span class=se>\n</span><span class=s2>```&quot;</span><span class=p>)</span>
</span><span id=__span-0-1487><a id=__codelineno-0-1487 name=__codelineno-0-1487></a>
</span><span id=__span-0-1488><a id=__codelineno-0-1488 name=__codelineno-0-1488></a>                        <span class=k>if</span> <span class=n>traceback_message</span><span class=p>:</span>
</span><span id=__span-0-1489><a id=__codelineno-0-1489 name=__codelineno-0-1489></a>                            <span class=n>message_parts</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error Traceback: </span><span class=se>\n</span><span class=s2> ```</span><span class=se>\n</span><span class=si>{</span><span class=n>traceback_message</span><span class=si>}</span><span class=se>\n</span><span class=s2>```&quot;</span><span class=p>)</span>
</span><span id=__span-0-1490><a id=__codelineno-0-1490 name=__codelineno-0-1490></a>
</span><span id=__span-0-1491><a id=__codelineno-0-1491 name=__codelineno-0-1491></a>                        <span class=bp>self</span><span class=o>.</span><span class=n>add_reply</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\n\n</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>message_parts</span><span class=p>),</span> <span class=n>message_type</span><span class=o>=</span><span class=s2>&quot;system:debug&quot;</span><span class=p>)</span>
</span><span id=__span-0-1492><a id=__codelineno-0-1492 name=__codelineno-0-1492></a>
</span><span id=__span-0-1493><a id=__codelineno-0-1493 name=__codelineno-0-1493></a>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-1494><a id=__codelineno-0-1494 name=__codelineno-0-1494></a>                <span class=bp>self</span><span class=o>.</span><span class=n>add_system_log</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Environment run failed: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>logging</span><span class=o>.</span><span class=n>ERROR</span><span class=p>)</span>
</span><span id=__span-0-1495><a id=__codelineno-0-1495 name=__codelineno-0-1495></a>                <span class=bp>self</span><span class=o>.</span><span class=n>mark_failed</span><span class=p>()</span>
</span><span id=__span-0-1496><a id=__codelineno-0-1496 name=__codelineno-0-1496></a>                <span class=k>raise</span> <span class=n>e</span>
</span><span id=__span-0-1497><a id=__codelineno-0-1497 name=__codelineno-0-1497></a>
</span><span id=__span-0-1498><a id=__codelineno-0-1498 name=__codelineno-0-1498></a>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_pending_ext_agent</span><span class=p>:</span>
</span><span id=__span-0-1499><a id=__codelineno-0-1499 name=__codelineno-0-1499></a>            <span class=c1># If no external agent was called, mark the whole run as done.</span>
</span><span id=__span-0-1500><a id=__codelineno-0-1500 name=__codelineno-0-1500></a>            <span class=c1># Else this environment will stop for now but this run will be continued later.</span>
</span><span id=__span-0-1501><a id=__codelineno-0-1501 name=__codelineno-0-1501></a>            <span class=bp>self</span><span class=o>.</span><span class=n>mark_done</span><span class=p>()</span>
</span><span id=__span-0-1502><a id=__codelineno-0-1502 name=__codelineno-0-1502></a>
</span><span id=__span-0-1503><a id=__codelineno-0-1503 name=__codelineno-0-1503></a>    <span class=k>def</span><span class=w> </span><span class=nf>generate_folder_hash_id</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-0-1504><a id=__codelineno-0-1504 name=__codelineno-0-1504></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns hash based on files and their contents in path, including subfolders.&quot;&quot;&quot;</span>  <span class=c1># noqa: E501</span>
</span><span id=__span-0-1505><a id=__codelineno-0-1505 name=__codelineno-0-1505></a>        <span class=n>hash_obj</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>()</span>
</span><span id=__span-0-1506><a id=__codelineno-0-1506 name=__codelineno-0-1506></a>
</span><span id=__span-0-1507><a id=__codelineno-0-1507 name=__codelineno-0-1507></a>        <span class=k>for</span> <span class=n>root</span><span class=p>,</span> <span class=n>_dirs</span><span class=p>,</span> <span class=n>files</span> <span class=ow>in</span> <span class=n>os</span><span class=o>.</span><span class=n>walk</span><span class=p>(</span><span class=n>path</span><span class=p>):</span>
</span><span id=__span-0-1508><a id=__codelineno-0-1508 name=__codelineno-0-1508></a>            <span class=k>for</span> <span class=n>file</span> <span class=ow>in</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>files</span><span class=p>):</span>
</span><span id=__span-0-1509><a id=__codelineno-0-1509 name=__codelineno-0-1509></a>                <span class=n>file_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>root</span><span class=p>,</span> <span class=n>file</span><span class=p>)</span>
</span><span id=__span-0-1510><a id=__codelineno-0-1510 name=__codelineno-0-1510></a>                <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=s2>&quot;rb&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-1511><a id=__codelineno-0-1511 name=__codelineno-0-1511></a>                    <span class=k>while</span> <span class=n>chunk</span> <span class=o>:=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>(</span><span class=mi>8192</span><span class=p>):</span>
</span><span id=__span-0-1512><a id=__codelineno-0-1512 name=__codelineno-0-1512></a>                        <span class=n>hash_obj</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>chunk</span><span class=p>)</span>
</span><span id=__span-0-1513><a id=__codelineno-0-1513 name=__codelineno-0-1513></a>
</span><span id=__span-0-1514><a id=__codelineno-0-1514 name=__codelineno-0-1514></a>        <span class=k>return</span> <span class=n>hash_obj</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.environment.Environment.__init__ class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">__init__</span> <a href=#nearai.agents.environment.Environment.__init__ class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=fm>__init__</span><span class=p>(</span><span class=nf>path</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>agents</span><span class=p>:</span> <span class=n><span title=typing.List>List</span></span><span class=p>[</span><span class=n><a class="autorefs autorefs-internal" title=nearai.agents.agent.Agent href=#nearai.agents.agent.Agent>Agent</a></span><span class=p>],</span> <span class=n>client</span><span class=p>:</span> <span class=n><a class="autorefs autorefs-internal" title=nearai.shared.inference_client.InferenceClient href=#nearai.shared.inference_client.InferenceClient>InferenceClient</a></span><span class=p>,</span> <span class=n>hub_client</span><span class=p>:</span> <span class=n><span title=openai.OpenAI>OpenAI</span></span><span class=p>,</span> <span class=n>thread_id</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>run_id</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>create_files</span><span class=p>:</span> <span class=n>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span> <span class=n>env_vars</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n><span title=typing.Dict>Dict</span></span><span class=p>[</span><span class=n>str</span><span class=p>,</span> <span class=n><span title=typing.Any>Any</span></span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>tool_resources</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n><span title=typing.Dict>Dict</span></span><span class=p>[</span><span class=n>str</span><span class=p>,</span> <span class=n><span title=typing.Any>Any</span></span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>print_system_log</span><span class=p>:</span> <span class=n>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span> <span class=n>agent_runner_user</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>fastnear_api_key</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>approvals</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></code></pre></div> <div class="doc doc-contents "> <details class=quote> <summary>Source code in <code>nearai/agents/environment.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-100>100</a></span>
<span class=normal><a href=#__codelineno-0-101>101</a></span>
<span class=normal><a href=#__codelineno-0-102>102</a></span>
<span class=normal><a href=#__codelineno-0-103>103</a></span>
<span class=normal><a href=#__codelineno-0-104>104</a></span>
<span class=normal><a href=#__codelineno-0-105>105</a></span>
<span class=normal><a href=#__codelineno-0-106>106</a></span>
<span class=normal><a href=#__codelineno-0-107>107</a></span>
<span class=normal><a href=#__codelineno-0-108>108</a></span>
<span class=normal><a href=#__codelineno-0-109>109</a></span>
<span class=normal><a href=#__codelineno-0-110>110</a></span>
<span class=normal><a href=#__codelineno-0-111>111</a></span>
<span class=normal><a href=#__codelineno-0-112>112</a></span>
<span class=normal><a href=#__codelineno-0-113>113</a></span>
<span class=normal><a href=#__codelineno-0-114>114</a></span>
<span class=normal><a href=#__codelineno-0-115>115</a></span>
<span class=normal><a href=#__codelineno-0-116>116</a></span>
<span class=normal><a href=#__codelineno-0-117>117</a></span>
<span class=normal><a href=#__codelineno-0-118>118</a></span>
<span class=normal><a href=#__codelineno-0-119>119</a></span>
<span class=normal><a href=#__codelineno-0-120>120</a></span>
<span class=normal><a href=#__codelineno-0-121>121</a></span>
<span class=normal><a href=#__codelineno-0-122>122</a></span>
<span class=normal><a href=#__codelineno-0-123>123</a></span>
<span class=normal><a href=#__codelineno-0-124>124</a></span>
<span class=normal><a href=#__codelineno-0-125>125</a></span>
<span class=normal><a href=#__codelineno-0-126>126</a></span>
<span class=normal><a href=#__codelineno-0-127>127</a></span>
<span class=normal><a href=#__codelineno-0-128>128</a></span>
<span class=normal><a href=#__codelineno-0-129>129</a></span>
<span class=normal><a href=#__codelineno-0-130>130</a></span>
<span class=normal><a href=#__codelineno-0-131>131</a></span>
<span class=normal><a href=#__codelineno-0-132>132</a></span>
<span class=normal><a href=#__codelineno-0-133>133</a></span>
<span class=normal><a href=#__codelineno-0-134>134</a></span>
<span class=normal><a href=#__codelineno-0-135>135</a></span>
<span class=normal><a href=#__codelineno-0-136>136</a></span>
<span class=normal><a href=#__codelineno-0-137>137</a></span>
<span class=normal><a href=#__codelineno-0-138>138</a></span>
<span class=normal><a href=#__codelineno-0-139>139</a></span>
<span class=normal><a href=#__codelineno-0-140>140</a></span>
<span class=normal><a href=#__codelineno-0-141>141</a></span>
<span class=normal><a href=#__codelineno-0-142>142</a></span>
<span class=normal><a href=#__codelineno-0-143>143</a></span>
<span class=normal><a href=#__codelineno-0-144>144</a></span>
<span class=normal><a href=#__codelineno-0-145>145</a></span>
<span class=normal><a href=#__codelineno-0-146>146</a></span>
<span class=normal><a href=#__codelineno-0-147>147</a></span>
<span class=normal><a href=#__codelineno-0-148>148</a></span>
<span class=normal><a href=#__codelineno-0-149>149</a></span>
<span class=normal><a href=#__codelineno-0-150>150</a></span>
<span class=normal><a href=#__codelineno-0-151>151</a></span>
<span class=normal><a href=#__codelineno-0-152>152</a></span>
<span class=normal><a href=#__codelineno-0-153>153</a></span>
<span class=normal><a href=#__codelineno-0-154>154</a></span>
<span class=normal><a href=#__codelineno-0-155>155</a></span>
<span class=normal><a href=#__codelineno-0-156>156</a></span>
<span class=normal><a href=#__codelineno-0-157>157</a></span>
<span class=normal><a href=#__codelineno-0-158>158</a></span>
<span class=normal><a href=#__codelineno-0-159>159</a></span>
<span class=normal><a href=#__codelineno-0-160>160</a></span>
<span class=normal><a href=#__codelineno-0-161>161</a></span>
<span class=normal><a href=#__codelineno-0-162>162</a></span>
<span class=normal><a href=#__codelineno-0-163>163</a></span>
<span class=normal><a href=#__codelineno-0-164>164</a></span>
<span class=normal><a href=#__codelineno-0-165>165</a></span>
<span class=normal><a href=#__codelineno-0-166>166</a></span>
<span class=normal><a href=#__codelineno-0-167>167</a></span>
<span class=normal><a href=#__codelineno-0-168>168</a></span>
<span class=normal><a href=#__codelineno-0-169>169</a></span>
<span class=normal><a href=#__codelineno-0-170>170</a></span>
<span class=normal><a href=#__codelineno-0-171>171</a></span>
<span class=normal><a href=#__codelineno-0-172>172</a></span>
<span class=normal><a href=#__codelineno-0-173>173</a></span>
<span class=normal><a href=#__codelineno-0-174>174</a></span>
<span class=normal><a href=#__codelineno-0-175>175</a></span>
<span class=normal><a href=#__codelineno-0-176>176</a></span>
<span class=normal><a href=#__codelineno-0-177>177</a></span>
<span class=normal><a href=#__codelineno-0-178>178</a></span>
<span class=normal><a href=#__codelineno-0-179>179</a></span>
<span class=normal><a href=#__codelineno-0-180>180</a></span>
<span class=normal><a href=#__codelineno-0-181>181</a></span>
<span class=normal><a href=#__codelineno-0-182>182</a></span>
<span class=normal><a href=#__codelineno-0-183>183</a></span>
<span class=normal><a href=#__codelineno-0-184>184</a></span>
<span class=normal><a href=#__codelineno-0-185>185</a></span>
<span class=normal><a href=#__codelineno-0-186>186</a></span>
<span class=normal><a href=#__codelineno-0-187>187</a></span>
<span class=normal><a href=#__codelineno-0-188>188</a></span>
<span class=normal><a href=#__codelineno-0-189>189</a></span>
<span class=normal><a href=#__codelineno-0-190>190</a></span>
<span class=normal><a href=#__codelineno-0-191>191</a></span>
<span class=normal><a href=#__codelineno-0-192>192</a></span>
<span class=normal><a href=#__codelineno-0-193>193</a></span>
<span class=normal><a href=#__codelineno-0-194>194</a></span>
<span class=normal><a href=#__codelineno-0-195>195</a></span>
<span class=normal><a href=#__codelineno-0-196>196</a></span>
<span class=normal><a href=#__codelineno-0-197>197</a></span>
<span class=normal><a href=#__codelineno-0-198>198</a></span>
<span class=normal><a href=#__codelineno-0-199>199</a></span>
<span class=normal><a href=#__codelineno-0-200>200</a></span>
<span class=normal><a href=#__codelineno-0-201>201</a></span>
<span class=normal><a href=#__codelineno-0-202>202</a></span>
<span class=normal><a href=#__codelineno-0-203>203</a></span>
<span class=normal><a href=#__codelineno-0-204>204</a></span>
<span class=normal><a href=#__codelineno-0-205>205</a></span>
<span class=normal><a href=#__codelineno-0-206>206</a></span>
<span class=normal><a href=#__codelineno-0-207>207</a></span>
<span class=normal><a href=#__codelineno-0-208>208</a></span>
<span class=normal><a href=#__codelineno-0-209>209</a></span>
<span class=normal><a href=#__codelineno-0-210>210</a></span>
<span class=normal><a href=#__codelineno-0-211>211</a></span>
<span class=normal><a href=#__codelineno-0-212>212</a></span>
<span class=normal><a href=#__codelineno-0-213>213</a></span>
<span class=normal><a href=#__codelineno-0-214>214</a></span>
<span class=normal><a href=#__codelineno-0-215>215</a></span>
<span class=normal><a href=#__codelineno-0-216>216</a></span>
<span class=normal><a href=#__codelineno-0-217>217</a></span>
<span class=normal><a href=#__codelineno-0-218>218</a></span>
<span class=normal><a href=#__codelineno-0-219>219</a></span>
<span class=normal><a href=#__codelineno-0-220>220</a></span>
<span class=normal><a href=#__codelineno-0-221>221</a></span>
<span class=normal><a href=#__codelineno-0-222>222</a></span>
<span class=normal><a href=#__codelineno-0-223>223</a></span>
<span class=normal><a href=#__codelineno-0-224>224</a></span>
<span class=normal><a href=#__codelineno-0-225>225</a></span>
<span class=normal><a href=#__codelineno-0-226>226</a></span>
<span class=normal><a href=#__codelineno-0-227>227</a></span>
<span class=normal><a href=#__codelineno-0-228>228</a></span>
<span class=normal><a href=#__codelineno-0-229>229</a></span>
<span class=normal><a href=#__codelineno-0-230>230</a></span>
<span class=normal><a href=#__codelineno-0-231>231</a></span>
<span class=normal><a href=#__codelineno-0-232>232</a></span>
<span class=normal><a href=#__codelineno-0-233>233</a></span>
<span class=normal><a href=#__codelineno-0-234>234</a></span>
<span class=normal><a href=#__codelineno-0-235>235</a></span>
<span class=normal><a href=#__codelineno-0-236>236</a></span>
<span class=normal><a href=#__codelineno-0-237>237</a></span>
<span class=normal><a href=#__codelineno-0-238>238</a></span>
<span class=normal><a href=#__codelineno-0-239>239</a></span>
<span class=normal><a href=#__codelineno-0-240>240</a></span>
<span class=normal><a href=#__codelineno-0-241>241</a></span>
<span class=normal><a href=#__codelineno-0-242>242</a></span>
<span class=normal><a href=#__codelineno-0-243>243</a></span>
<span class=normal><a href=#__codelineno-0-244>244</a></span>
<span class=normal><a href=#__codelineno-0-245>245</a></span>
<span class=normal><a href=#__codelineno-0-246>246</a></span>
<span class=normal><a href=#__codelineno-0-247>247</a></span>
<span class=normal><a href=#__codelineno-0-248>248</a></span>
<span class=normal><a href=#__codelineno-0-249>249</a></span>
<span class=normal><a href=#__codelineno-0-250>250</a></span>
<span class=normal><a href=#__codelineno-0-251>251</a></span>
<span class=normal><a href=#__codelineno-0-252>252</a></span>
<span class=normal><a href=#__codelineno-0-253>253</a></span>
<span class=normal><a href=#__codelineno-0-254>254</a></span>
<span class=normal><a href=#__codelineno-0-255>255</a></span>
<span class=normal><a href=#__codelineno-0-256>256</a></span>
<span class=normal><a href=#__codelineno-0-257>257</a></span>
<span class=normal><a href=#__codelineno-0-258>258</a></span>
<span class=normal><a href=#__codelineno-0-259>259</a></span>
<span class=normal><a href=#__codelineno-0-260>260</a></span>
<span class=normal><a href=#__codelineno-0-261>261</a></span>
<span class=normal><a href=#__codelineno-0-262>262</a></span>
<span class=normal><a href=#__codelineno-0-263>263</a></span>
<span class=normal><a href=#__codelineno-0-264>264</a></span>
<span class=normal><a href=#__codelineno-0-265>265</a></span>
<span class=normal><a href=#__codelineno-0-266>266</a></span>
<span class=normal><a href=#__codelineno-0-267>267</a></span>
<span class=normal><a href=#__codelineno-0-268>268</a></span>
<span class=normal><a href=#__codelineno-0-269>269</a></span>
<span class=normal><a href=#__codelineno-0-270>270</a></span>
<span class=normal><a href=#__codelineno-0-271>271</a></span>
<span class=normal><a href=#__codelineno-0-272>272</a></span>
<span class=normal><a href=#__codelineno-0-273>273</a></span>
<span class=normal><a href=#__codelineno-0-274>274</a></span>
<span class=normal><a href=#__codelineno-0-275>275</a></span>
<span class=normal><a href=#__codelineno-0-276>276</a></span>
<span class=normal><a href=#__codelineno-0-277>277</a></span>
<span class=normal><a href=#__codelineno-0-278>278</a></span>
<span class=normal><a href=#__codelineno-0-279>279</a></span>
<span class=normal><a href=#__codelineno-0-280>280</a></span>
<span class=normal><a href=#__codelineno-0-281>281</a></span>
<span class=normal><a href=#__codelineno-0-282>282</a></span>
<span class=normal><a href=#__codelineno-0-283>283</a></span>
<span class=normal><a href=#__codelineno-0-284>284</a></span>
<span class=normal><a href=#__codelineno-0-285>285</a></span>
<span class=normal><a href=#__codelineno-0-286>286</a></span>
<span class=normal><a href=#__codelineno-0-287>287</a></span>
<span class=normal><a href=#__codelineno-0-288>288</a></span>
<span class=normal><a href=#__codelineno-0-289>289</a></span>
<span class=normal><a href=#__codelineno-0-290>290</a></span>
<span class=normal><a href=#__codelineno-0-291>291</a></span>
<span class=normal><a href=#__codelineno-0-292>292</a></span>
<span class=normal><a href=#__codelineno-0-293>293</a></span>
<span class=normal><a href=#__codelineno-0-294>294</a></span>
<span class=normal><a href=#__codelineno-0-295>295</a></span>
<span class=normal><a href=#__codelineno-0-296>296</a></span>
<span class=normal><a href=#__codelineno-0-297>297</a></span>
<span class=normal><a href=#__codelineno-0-298>298</a></span>
<span class=normal><a href=#__codelineno-0-299>299</a></span>
<span class=normal><a href=#__codelineno-0-300>300</a></span>
<span class=normal><a href=#__codelineno-0-301>301</a></span>
<span class=normal><a href=#__codelineno-0-302>302</a></span>
<span class=normal><a href=#__codelineno-0-303>303</a></span>
<span class=normal><a href=#__codelineno-0-304>304</a></span>
<span class=normal><a href=#__codelineno-0-305>305</a></span>
<span class=normal><a href=#__codelineno-0-306>306</a></span>
<span class=normal><a href=#__codelineno-0-307>307</a></span>
<span class=normal><a href=#__codelineno-0-308>308</a></span>
<span class=normal><a href=#__codelineno-0-309>309</a></span>
<span class=normal><a href=#__codelineno-0-310>310</a></span>
<span class=normal><a href=#__codelineno-0-311>311</a></span>
<span class=normal><a href=#__codelineno-0-312>312</a></span>
<span class=normal><a href=#__codelineno-0-313>313</a></span>
<span class=normal><a href=#__codelineno-0-314>314</a></span>
<span class=normal><a href=#__codelineno-0-315>315</a></span>
<span class=normal><a href=#__codelineno-0-316>316</a></span>
<span class=normal><a href=#__codelineno-0-317>317</a></span>
<span class=normal><a href=#__codelineno-0-318>318</a></span>
<span class=normal><a href=#__codelineno-0-319>319</a></span>
<span class=normal><a href=#__codelineno-0-320>320</a></span>
<span class=normal><a href=#__codelineno-0-321>321</a></span>
<span class=normal><a href=#__codelineno-0-322>322</a></span>
<span class=normal><a href=#__codelineno-0-323>323</a></span>
<span class=normal><a href=#__codelineno-0-324>324</a></span>
<span class=normal><a href=#__codelineno-0-325>325</a></span>
<span class=normal><a href=#__codelineno-0-326>326</a></span>
<span class=normal><a href=#__codelineno-0-327>327</a></span>
<span class=normal><a href=#__codelineno-0-328>328</a></span>
<span class=normal><a href=#__codelineno-0-329>329</a></span>
<span class=normal><a href=#__codelineno-0-330>330</a></span>
<span class=normal><a href=#__codelineno-0-331>331</a></span>
<span class=normal><a href=#__codelineno-0-332>332</a></span>
<span class=normal><a href=#__codelineno-0-333>333</a></span>
<span class=normal><a href=#__codelineno-0-334>334</a></span>
<span class=normal><a href=#__codelineno-0-335>335</a></span>
<span class=normal><a href=#__codelineno-0-336>336</a></span>
<span class=normal><a href=#__codelineno-0-337>337</a></span>
<span class=normal><a href=#__codelineno-0-338>338</a></span>
<span class=normal><a href=#__codelineno-0-339>339</a></span>
<span class=normal><a href=#__codelineno-0-340>340</a></span>
<span class=normal><a href=#__codelineno-0-341>341</a></span>
<span class=normal><a href=#__codelineno-0-342>342</a></span>
<span class=normal><a href=#__codelineno-0-343>343</a></span>
<span class=normal><a href=#__codelineno-0-344>344</a></span>
<span class=normal><a href=#__codelineno-0-345>345</a></span>
<span class=normal><a href=#__codelineno-0-346>346</a></span>
<span class=normal><a href=#__codelineno-0-347>347</a></span>
<span class=normal><a href=#__codelineno-0-348>348</a></span>
<span class=normal><a href=#__codelineno-0-349>349</a></span>
<span class=normal><a href=#__codelineno-0-350>350</a></span>
<span class=normal><a href=#__codelineno-0-351>351</a></span>
<span class=normal><a href=#__codelineno-0-352>352</a></span>
<span class=normal><a href=#__codelineno-0-353>353</a></span>
<span class=normal><a href=#__codelineno-0-354>354</a></span>
<span class=normal><a href=#__codelineno-0-355>355</a></span>
<span class=normal><a href=#__codelineno-0-356>356</a></span>
<span class=normal><a href=#__codelineno-0-357>357</a></span>
<span class=normal><a href=#__codelineno-0-358>358</a></span>
<span class=normal><a href=#__codelineno-0-359>359</a></span>
<span class=normal><a href=#__codelineno-0-360>360</a></span>
<span class=normal><a href=#__codelineno-0-361>361</a></span>
<span class=normal><a href=#__codelineno-0-362>362</a></span>
<span class=normal><a href=#__codelineno-0-363>363</a></span>
<span class=normal><a href=#__codelineno-0-364>364</a></span>
<span class=normal><a href=#__codelineno-0-365>365</a></span>
<span class=normal><a href=#__codelineno-0-366>366</a></span>
<span class=normal><a href=#__codelineno-0-367>367</a></span>
<span class=normal><a href=#__codelineno-0-368>368</a></span>
<span class=normal><a href=#__codelineno-0-369>369</a></span>
<span class=normal><a href=#__codelineno-0-370>370</a></span>
<span class=normal><a href=#__codelineno-0-371>371</a></span>
<span class=normal><a href=#__codelineno-0-372>372</a></span>
<span class=normal><a href=#__codelineno-0-373>373</a></span>
<span class=normal><a href=#__codelineno-0-374>374</a></span>
<span class=normal><a href=#__codelineno-0-375>375</a></span>
<span class=normal><a href=#__codelineno-0-376>376</a></span>
<span class=normal><a href=#__codelineno-0-377>377</a></span>
<span class=normal><a href=#__codelineno-0-378>378</a></span>
<span class=normal><a href=#__codelineno-0-379>379</a></span>
<span class=normal><a href=#__codelineno-0-380>380</a></span>
<span class=normal><a href=#__codelineno-0-381>381</a></span>
<span class=normal><a href=#__codelineno-0-382>382</a></span>
<span class=normal><a href=#__codelineno-0-383>383</a></span>
<span class=normal><a href=#__codelineno-0-384>384</a></span>
<span class=normal><a href=#__codelineno-0-385>385</a></span>
<span class=normal><a href=#__codelineno-0-386>386</a></span>
<span class=normal><a href=#__codelineno-0-387>387</a></span>
<span class=normal><a href=#__codelineno-0-388>388</a></span>
<span class=normal><a href=#__codelineno-0-389>389</a></span>
<span class=normal><a href=#__codelineno-0-390>390</a></span>
<span class=normal><a href=#__codelineno-0-391>391</a></span>
<span class=normal><a href=#__codelineno-0-392>392</a></span>
<span class=normal><a href=#__codelineno-0-393>393</a></span>
<span class=normal><a href=#__codelineno-0-394>394</a></span>
<span class=normal><a href=#__codelineno-0-395>395</a></span>
<span class=normal><a href=#__codelineno-0-396>396</a></span>
<span class=normal><a href=#__codelineno-0-397>397</a></span>
<span class=normal><a href=#__codelineno-0-398>398</a></span>
<span class=normal><a href=#__codelineno-0-399>399</a></span>
<span class=normal><a href=#__codelineno-0-400>400</a></span>
<span class=normal><a href=#__codelineno-0-401>401</a></span>
<span class=normal><a href=#__codelineno-0-402>402</a></span>
<span class=normal><a href=#__codelineno-0-403>403</a></span>
<span class=normal><a href=#__codelineno-0-404>404</a></span>
<span class=normal><a href=#__codelineno-0-405>405</a></span>
<span class=normal><a href=#__codelineno-0-406>406</a></span>
<span class=normal><a href=#__codelineno-0-407>407</a></span>
<span class=normal><a href=#__codelineno-0-408>408</a></span>
<span class=normal><a href=#__codelineno-0-409>409</a></span>
<span class=normal><a href=#__codelineno-0-410>410</a></span>
<span class=normal><a href=#__codelineno-0-411>411</a></span>
<span class=normal><a href=#__codelineno-0-412>412</a></span>
<span class=normal><a href=#__codelineno-0-413>413</a></span>
<span class=normal><a href=#__codelineno-0-414>414</a></span>
<span class=normal><a href=#__codelineno-0-415>415</a></span>
<span class=normal><a href=#__codelineno-0-416>416</a></span>
<span class=normal><a href=#__codelineno-0-417>417</a></span>
<span class=normal><a href=#__codelineno-0-418>418</a></span>
<span class=normal><a href=#__codelineno-0-419>419</a></span>
<span class=normal><a href=#__codelineno-0-420>420</a></span>
<span class=normal><a href=#__codelineno-0-421>421</a></span>
<span class=normal><a href=#__codelineno-0-422>422</a></span>
<span class=normal><a href=#__codelineno-0-423>423</a></span>
<span class=normal><a href=#__codelineno-0-424>424</a></span>
<span class=normal><a href=#__codelineno-0-425>425</a></span>
<span class=normal><a href=#__codelineno-0-426>426</a></span>
<span class=normal><a href=#__codelineno-0-427>427</a></span>
<span class=normal><a href=#__codelineno-0-428>428</a></span>
<span class=normal><a href=#__codelineno-0-429>429</a></span>
<span class=normal><a href=#__codelineno-0-430>430</a></span>
<span class=normal><a href=#__codelineno-0-431>431</a></span>
<span class=normal><a href=#__codelineno-0-432>432</a></span>
<span class=normal><a href=#__codelineno-0-433>433</a></span>
<span class=normal><a href=#__codelineno-0-434>434</a></span>
<span class=normal><a href=#__codelineno-0-435>435</a></span>
<span class=normal><a href=#__codelineno-0-436>436</a></span>
<span class=normal><a href=#__codelineno-0-437>437</a></span>
<span class=normal><a href=#__codelineno-0-438>438</a></span>
<span class=normal><a href=#__codelineno-0-439>439</a></span>
<span class=normal><a href=#__codelineno-0-440>440</a></span>
<span class=normal><a href=#__codelineno-0-441>441</a></span>
<span class=normal><a href=#__codelineno-0-442>442</a></span>
<span class=normal><a href=#__codelineno-0-443>443</a></span>
<span class=normal><a href=#__codelineno-0-444>444</a></span>
<span class=normal><a href=#__codelineno-0-445>445</a></span>
<span class=normal><a href=#__codelineno-0-446>446</a></span>
<span class=normal><a href=#__codelineno-0-447>447</a></span>
<span class=normal><a href=#__codelineno-0-448>448</a></span>
<span class=normal><a href=#__codelineno-0-449>449</a></span>
<span class=normal><a href=#__codelineno-0-450>450</a></span>
<span class=normal><a href=#__codelineno-0-451>451</a></span>
<span class=normal><a href=#__codelineno-0-452>452</a></span>
<span class=normal><a href=#__codelineno-0-453>453</a></span>
<span class=normal><a href=#__codelineno-0-454>454</a></span>
<span class=normal><a href=#__codelineno-0-455>455</a></span>
<span class=normal><a href=#__codelineno-0-456>456</a></span>
<span class=normal><a href=#__codelineno-0-457>457</a></span>
<span class=normal><a href=#__codelineno-0-458>458</a></span>
<span class=normal><a href=#__codelineno-0-459>459</a></span>
<span class=normal><a href=#__codelineno-0-460>460</a></span>
<span class=normal><a href=#__codelineno-0-461>461</a></span>
<span class=normal><a href=#__codelineno-0-462>462</a></span>
<span class=normal><a href=#__codelineno-0-463>463</a></span>
<span class=normal><a href=#__codelineno-0-464>464</a></span>
<span class=normal><a href=#__codelineno-0-465>465</a></span>
<span class=normal><a href=#__codelineno-0-466>466</a></span>
<span class=normal><a href=#__codelineno-0-467>467</a></span>
<span class=normal><a href=#__codelineno-0-468>468</a></span>
<span class=normal><a href=#__codelineno-0-469>469</a></span>
<span class=normal><a href=#__codelineno-0-470>470</a></span>
<span class=normal><a href=#__codelineno-0-471>471</a></span>
<span class=normal><a href=#__codelineno-0-472>472</a></span>
<span class=normal><a href=#__codelineno-0-473>473</a></span>
<span class=normal><a href=#__codelineno-0-474>474</a></span>
<span class=normal><a href=#__codelineno-0-475>475</a></span>
<span class=normal><a href=#__codelineno-0-476>476</a></span>
<span class=normal><a href=#__codelineno-0-477>477</a></span>
<span class=normal><a href=#__codelineno-0-478>478</a></span>
<span class=normal><a href=#__codelineno-0-479>479</a></span>
<span class=normal><a href=#__codelineno-0-480>480</a></span>
<span class=normal><a href=#__codelineno-0-481>481</a></span>
<span class=normal><a href=#__codelineno-0-482>482</a></span>
<span class=normal><a href=#__codelineno-0-483>483</a></span>
<span class=normal><a href=#__codelineno-0-484>484</a></span>
<span class=normal><a href=#__codelineno-0-485>485</a></span>
<span class=normal><a href=#__codelineno-0-486>486</a></span>
<span class=normal><a href=#__codelineno-0-487>487</a></span>
<span class=normal><a href=#__codelineno-0-488>488</a></span>
<span class=normal><a href=#__codelineno-0-489>489</a></span>
<span class=normal><a href=#__codelineno-0-490>490</a></span>
<span class=normal><a href=#__codelineno-0-491>491</a></span>
<span class=normal><a href=#__codelineno-0-492>492</a></span>
<span class=normal><a href=#__codelineno-0-493>493</a></span>
<span class=normal><a href=#__codelineno-0-494>494</a></span>
<span class=normal><a href=#__codelineno-0-495>495</a></span>
<span class=normal><a href=#__codelineno-0-496>496</a></span>
<span class=normal><a href=#__codelineno-0-497>497</a></span>
<span class=normal><a href=#__codelineno-0-498>498</a></span>
<span class=normal><a href=#__codelineno-0-499>499</a></span>
<span class=normal><a href=#__codelineno-0-500>500</a></span>
<span class=normal><a href=#__codelineno-0-501>501</a></span>
<span class=normal><a href=#__codelineno-0-502>502</a></span>
<span class=normal><a href=#__codelineno-0-503>503</a></span>
<span class=normal><a href=#__codelineno-0-504>504</a></span>
<span class=normal><a href=#__codelineno-0-505>505</a></span>
<span class=normal><a href=#__codelineno-0-506>506</a></span>
<span class=normal><a href=#__codelineno-0-507>507</a></span>
<span class=normal><a href=#__codelineno-0-508>508</a></span>
<span class=normal><a href=#__codelineno-0-509>509</a></span>
<span class=normal><a href=#__codelineno-0-510>510</a></span>
<span class=normal><a href=#__codelineno-0-511>511</a></span>
<span class=normal><a href=#__codelineno-0-512>512</a></span>
<span class=normal><a href=#__codelineno-0-513>513</a></span>
<span class=normal><a href=#__codelineno-0-514>514</a></span>
<span class=normal><a href=#__codelineno-0-515>515</a></span>
<span class=normal><a href=#__codelineno-0-516>516</a></span>
<span class=normal><a href=#__codelineno-0-517>517</a></span>
<span class=normal><a href=#__codelineno-0-518>518</a></span>
<span class=normal><a href=#__codelineno-0-519>519</a></span>
<span class=normal><a href=#__codelineno-0-520>520</a></span>
<span class=normal><a href=#__codelineno-0-521>521</a></span>
<span class=normal><a href=#__codelineno-0-522>522</a></span>
<span class=normal><a href=#__codelineno-0-523>523</a></span>
<span class=normal><a href=#__codelineno-0-524>524</a></span>
<span class=normal><a href=#__codelineno-0-525>525</a></span>
<span class=normal><a href=#__codelineno-0-526>526</a></span>
<span class=normal><a href=#__codelineno-0-527>527</a></span>
<span class=normal><a href=#__codelineno-0-528>528</a></span>
<span class=normal><a href=#__codelineno-0-529>529</a></span>
<span class=normal><a href=#__codelineno-0-530>530</a></span>
<span class=normal><a href=#__codelineno-0-531>531</a></span>
<span class=normal><a href=#__codelineno-0-532>532</a></span>
<span class=normal><a href=#__codelineno-0-533>533</a></span>
<span class=normal><a href=#__codelineno-0-534>534</a></span>
<span class=normal><a href=#__codelineno-0-535>535</a></span>
<span class=normal><a href=#__codelineno-0-536>536</a></span>
<span class=normal><a href=#__codelineno-0-537>537</a></span>
<span class=normal><a href=#__codelineno-0-538>538</a></span>
<span class=normal><a href=#__codelineno-0-539>539</a></span>
<span class=normal><a href=#__codelineno-0-540>540</a></span>
<span class=normal><a href=#__codelineno-0-541>541</a></span>
<span class=normal><a href=#__codelineno-0-542>542</a></span>
<span class=normal><a href=#__codelineno-0-543>543</a></span>
<span class=normal><a href=#__codelineno-0-544>544</a></span>
<span class=normal><a href=#__codelineno-0-545>545</a></span>
<span class=normal><a href=#__codelineno-0-546>546</a></span>
<span class=normal><a href=#__codelineno-0-547>547</a></span>
<span class=normal><a href=#__codelineno-0-548>548</a></span>
<span class=normal><a href=#__codelineno-0-549>549</a></span>
<span class=normal><a href=#__codelineno-0-550>550</a></span>
<span class=normal><a href=#__codelineno-0-551>551</a></span>
<span class=normal><a href=#__codelineno-0-552>552</a></span>
<span class=normal><a href=#__codelineno-0-553>553</a></span>
<span class=normal><a href=#__codelineno-0-554>554</a></span>
<span class=normal><a href=#__codelineno-0-555>555</a></span>
<span class=normal><a href=#__codelineno-0-556>556</a></span>
<span class=normal><a href=#__codelineno-0-557>557</a></span>
<span class=normal><a href=#__codelineno-0-558>558</a></span>
<span class=normal><a href=#__codelineno-0-559>559</a></span>
<span class=normal><a href=#__codelineno-0-560>560</a></span>
<span class=normal><a href=#__codelineno-0-561>561</a></span>
<span class=normal><a href=#__codelineno-0-562>562</a></span>
<span class=normal><a href=#__codelineno-0-563>563</a></span>
<span class=normal><a href=#__codelineno-0-564>564</a></span>
<span class=normal><a href=#__codelineno-0-565>565</a></span>
<span class=normal><a href=#__codelineno-0-566>566</a></span>
<span class=normal><a href=#__codelineno-0-567>567</a></span>
<span class=normal><a href=#__codelineno-0-568>568</a></span>
<span class=normal><a href=#__codelineno-0-569>569</a></span>
<span class=normal><a href=#__codelineno-0-570>570</a></span>
<span class=normal><a href=#__codelineno-0-571>571</a></span>
<span class=normal><a href=#__codelineno-0-572>572</a></span>
<span class=normal><a href=#__codelineno-0-573>573</a></span>
<span class=normal><a href=#__codelineno-0-574>574</a></span>
<span class=normal><a href=#__codelineno-0-575>575</a></span>
<span class=normal><a href=#__codelineno-0-576>576</a></span>
<span class=normal><a href=#__codelineno-0-577>577</a></span>
<span class=normal><a href=#__codelineno-0-578>578</a></span>
<span class=normal><a href=#__codelineno-0-579>579</a></span>
<span class=normal><a href=#__codelineno-0-580>580</a></span>
<span class=normal><a href=#__codelineno-0-581>581</a></span>
<span class=normal><a href=#__codelineno-0-582>582</a></span>
<span class=normal><a href=#__codelineno-0-583>583</a></span>
<span class=normal><a href=#__codelineno-0-584>584</a></span>
<span class=normal><a href=#__codelineno-0-585>585</a></span>
<span class=normal><a href=#__codelineno-0-586>586</a></span>
<span class=normal><a href=#__codelineno-0-587>587</a></span>
<span class=normal><a href=#__codelineno-0-588>588</a></span>
<span class=normal><a href=#__codelineno-0-589>589</a></span>
<span class=normal><a href=#__codelineno-0-590>590</a></span>
<span class=normal><a href=#__codelineno-0-591>591</a></span>
<span class=normal><a href=#__codelineno-0-592>592</a></span>
<span class=normal><a href=#__codelineno-0-593>593</a></span>
<span class=normal><a href=#__codelineno-0-594>594</a></span>
<span class=normal><a href=#__codelineno-0-595>595</a></span>
<span class=normal><a href=#__codelineno-0-596>596</a></span>
<span class=normal><a href=#__codelineno-0-597>597</a></span>
<span class=normal><a href=#__codelineno-0-598>598</a></span>
<span class=normal><a href=#__codelineno-0-599>599</a></span>
<span class=normal><a href=#__codelineno-0-600>600</a></span>
<span class=normal><a href=#__codelineno-0-601>601</a></span>
<span class=normal><a href=#__codelineno-0-602>602</a></span>
<span class=normal><a href=#__codelineno-0-603>603</a></span>
<span class=normal><a href=#__codelineno-0-604>604</a></span>
<span class=normal><a href=#__codelineno-0-605>605</a></span>
<span class=normal><a href=#__codelineno-0-606>606</a></span>
<span class=normal><a href=#__codelineno-0-607>607</a></span>
<span class=normal><a href=#__codelineno-0-608>608</a></span>
<span class=normal><a href=#__codelineno-0-609>609</a></span>
<span class=normal><a href=#__codelineno-0-610>610</a></span>
<span class=normal><a href=#__codelineno-0-611>611</a></span>
<span class=normal><a href=#__codelineno-0-612>612</a></span>
<span class=normal><a href=#__codelineno-0-613>613</a></span>
<span class=normal><a href=#__codelineno-0-614>614</a></span>
<span class=normal><a href=#__codelineno-0-615>615</a></span>
<span class=normal><a href=#__codelineno-0-616>616</a></span>
<span class=normal><a href=#__codelineno-0-617>617</a></span>
<span class=normal><a href=#__codelineno-0-618>618</a></span>
<span class=normal><a href=#__codelineno-0-619>619</a></span>
<span class=normal><a href=#__codelineno-0-620>620</a></span>
<span class=normal><a href=#__codelineno-0-621>621</a></span>
<span class=normal><a href=#__codelineno-0-622>622</a></span>
<span class=normal><a href=#__codelineno-0-623>623</a></span>
<span class=normal><a href=#__codelineno-0-624>624</a></span>
<span class=normal><a href=#__codelineno-0-625>625</a></span>
<span class=normal><a href=#__codelineno-0-626>626</a></span>
<span class=normal><a href=#__codelineno-0-627>627</a></span>
<span class=normal><a href=#__codelineno-0-628>628</a></span>
<span class=normal><a href=#__codelineno-0-629>629</a></span>
<span class=normal><a href=#__codelineno-0-630>630</a></span>
<span class=normal><a href=#__codelineno-0-631>631</a></span>
<span class=normal><a href=#__codelineno-0-632>632</a></span>
<span class=normal><a href=#__codelineno-0-633>633</a></span>
<span class=normal><a href=#__codelineno-0-634>634</a></span>
<span class=normal><a href=#__codelineno-0-635>635</a></span>
<span class=normal><a href=#__codelineno-0-636>636</a></span>
<span class=normal><a href=#__codelineno-0-637>637</a></span>
<span class=normal><a href=#__codelineno-0-638>638</a></span>
<span class=normal><a href=#__codelineno-0-639>639</a></span>
<span class=normal><a href=#__codelineno-0-640>640</a></span>
<span class=normal><a href=#__codelineno-0-641>641</a></span>
<span class=normal><a href=#__codelineno-0-642>642</a></span>
<span class=normal><a href=#__codelineno-0-643>643</a></span>
<span class=normal><a href=#__codelineno-0-644>644</a></span>
<span class=normal><a href=#__codelineno-0-645>645</a></span>
<span class=normal><a href=#__codelineno-0-646>646</a></span>
<span class=normal><a href=#__codelineno-0-647>647</a></span>
<span class=normal><a href=#__codelineno-0-648>648</a></span>
<span class=normal><a href=#__codelineno-0-649>649</a></span>
<span class=normal><a href=#__codelineno-0-650>650</a></span>
<span class=normal><a href=#__codelineno-0-651>651</a></span>
<span class=normal><a href=#__codelineno-0-652>652</a></span>
<span class=normal><a href=#__codelineno-0-653>653</a></span>
<span class=normal><a href=#__codelineno-0-654>654</a></span>
<span class=normal><a href=#__codelineno-0-655>655</a></span>
<span class=normal><a href=#__codelineno-0-656>656</a></span>
<span class=normal><a href=#__codelineno-0-657>657</a></span>
<span class=normal><a href=#__codelineno-0-658>658</a></span>
<span class=normal><a href=#__codelineno-0-659>659</a></span>
<span class=normal><a href=#__codelineno-0-660>660</a></span>
<span class=normal><a href=#__codelineno-0-661>661</a></span>
<span class=normal><a href=#__codelineno-0-662>662</a></span>
<span class=normal><a href=#__codelineno-0-663>663</a></span>
<span class=normal><a href=#__codelineno-0-664>664</a></span>
<span class=normal><a href=#__codelineno-0-665>665</a></span>
<span class=normal><a href=#__codelineno-0-666>666</a></span>
<span class=normal><a href=#__codelineno-0-667>667</a></span>
<span class=normal><a href=#__codelineno-0-668>668</a></span>
<span class=normal><a href=#__codelineno-0-669>669</a></span>
<span class=normal><a href=#__codelineno-0-670>670</a></span>
<span class=normal><a href=#__codelineno-0-671>671</a></span>
<span class=normal><a href=#__codelineno-0-672>672</a></span>
<span class=normal><a href=#__codelineno-0-673>673</a></span>
<span class=normal><a href=#__codelineno-0-674>674</a></span>
<span class=normal><a href=#__codelineno-0-675>675</a></span>
<span class=normal><a href=#__codelineno-0-676>676</a></span>
<span class=normal><a href=#__codelineno-0-677>677</a></span>
<span class=normal><a href=#__codelineno-0-678>678</a></span>
<span class=normal><a href=#__codelineno-0-679>679</a></span>
<span class=normal><a href=#__codelineno-0-680>680</a></span>
<span class=normal><a href=#__codelineno-0-681>681</a></span>
<span class=normal><a href=#__codelineno-0-682>682</a></span>
<span class=normal><a href=#__codelineno-0-683>683</a></span>
<span class=normal><a href=#__codelineno-0-684>684</a></span>
<span class=normal><a href=#__codelineno-0-685>685</a></span>
<span class=normal><a href=#__codelineno-0-686>686</a></span>
<span class=normal><a href=#__codelineno-0-687>687</a></span>
<span class=normal><a href=#__codelineno-0-688>688</a></span>
<span class=normal><a href=#__codelineno-0-689>689</a></span>
<span class=normal><a href=#__codelineno-0-690>690</a></span>
<span class=normal><a href=#__codelineno-0-691>691</a></span>
<span class=normal><a href=#__codelineno-0-692>692</a></span>
<span class=normal><a href=#__codelineno-0-693>693</a></span>
<span class=normal><a href=#__codelineno-0-694>694</a></span>
<span class=normal><a href=#__codelineno-0-695>695</a></span>
<span class=normal><a href=#__codelineno-0-696>696</a></span>
<span class=normal><a href=#__codelineno-0-697>697</a></span>
<span class=normal><a href=#__codelineno-0-698>698</a></span>
<span class=normal><a href=#__codelineno-0-699>699</a></span>
<span class=normal><a href=#__codelineno-0-700>700</a></span>
<span class=normal><a href=#__codelineno-0-701>701</a></span>
<span class=normal><a href=#__codelineno-0-702>702</a></span>
<span class=normal><a href=#__codelineno-0-703>703</a></span>
<span class=normal><a href=#__codelineno-0-704>704</a></span>
<span class=normal><a href=#__codelineno-0-705>705</a></span>
<span class=normal><a href=#__codelineno-0-706>706</a></span>
<span class=normal><a href=#__codelineno-0-707>707</a></span>
<span class=normal><a href=#__codelineno-0-708>708</a></span>
<span class=normal><a href=#__codelineno-0-709>709</a></span>
<span class=normal><a href=#__codelineno-0-710>710</a></span>
<span class=normal><a href=#__codelineno-0-711>711</a></span>
<span class=normal><a href=#__codelineno-0-712>712</a></span>
<span class=normal><a href=#__codelineno-0-713>713</a></span>
<span class=normal><a href=#__codelineno-0-714>714</a></span>
<span class=normal><a href=#__codelineno-0-715>715</a></span>
<span class=normal><a href=#__codelineno-0-716>716</a></span>
<span class=normal><a href=#__codelineno-0-717>717</a></span>
<span class=normal><a href=#__codelineno-0-718>718</a></span>
<span class=normal><a href=#__codelineno-0-719>719</a></span>
<span class=normal><a href=#__codelineno-0-720>720</a></span>
<span class=normal><a href=#__codelineno-0-721>721</a></span>
<span class=normal><a href=#__codelineno-0-722>722</a></span>
<span class=normal><a href=#__codelineno-0-723>723</a></span>
<span class=normal><a href=#__codelineno-0-724>724</a></span>
<span class=normal><a href=#__codelineno-0-725>725</a></span>
<span class=normal><a href=#__codelineno-0-726>726</a></span>
<span class=normal><a href=#__codelineno-0-727>727</a></span>
<span class=normal><a href=#__codelineno-0-728>728</a></span>
<span class=normal><a href=#__codelineno-0-729>729</a></span>
<span class=normal><a href=#__codelineno-0-730>730</a></span>
<span class=normal><a href=#__codelineno-0-731>731</a></span>
<span class=normal><a href=#__codelineno-0-732>732</a></span>
<span class=normal><a href=#__codelineno-0-733>733</a></span>
<span class=normal><a href=#__codelineno-0-734>734</a></span>
<span class=normal><a href=#__codelineno-0-735>735</a></span>
<span class=normal><a href=#__codelineno-0-736>736</a></span>
<span class=normal><a href=#__codelineno-0-737>737</a></span>
<span class=normal><a href=#__codelineno-0-738>738</a></span>
<span class=normal><a href=#__codelineno-0-739>739</a></span>
<span class=normal><a href=#__codelineno-0-740>740</a></span>
<span class=normal><a href=#__codelineno-0-741>741</a></span>
<span class=normal><a href=#__codelineno-0-742>742</a></span>
<span class=normal><a href=#__codelineno-0-743>743</a></span>
<span class=normal><a href=#__codelineno-0-744>744</a></span>
<span class=normal><a href=#__codelineno-0-745>745</a></span>
<span class=normal><a href=#__codelineno-0-746>746</a></span>
<span class=normal><a href=#__codelineno-0-747>747</a></span>
<span class=normal><a href=#__codelineno-0-748>748</a></span>
<span class=normal><a href=#__codelineno-0-749>749</a></span>
<span class=normal><a href=#__codelineno-0-750>750</a></span>
<span class=normal><a href=#__codelineno-0-751>751</a></span>
<span class=normal><a href=#__codelineno-0-752>752</a></span>
<span class=normal><a href=#__codelineno-0-753>753</a></span>
<span class=normal><a href=#__codelineno-0-754>754</a></span>
<span class=normal><a href=#__codelineno-0-755>755</a></span>
<span class=normal><a href=#__codelineno-0-756>756</a></span>
<span class=normal><a href=#__codelineno-0-757>757</a></span>
<span class=normal><a href=#__codelineno-0-758>758</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-100><a id=__codelineno-0-100 name=__codelineno-0-100></a><span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span>  <span class=c1># noqa: D107</span>
</span><span id=__span-0-101><a id=__codelineno-0-101 name=__codelineno-0-101></a>    <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-102><a id=__codelineno-0-102 name=__codelineno-0-102></a>    <span class=n>path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-103><a id=__codelineno-0-103 name=__codelineno-0-103></a>    <span class=n>agents</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Agent</span><span class=p>],</span>
</span><span id=__span-0-104><a id=__codelineno-0-104 name=__codelineno-0-104></a>    <span class=n>client</span><span class=p>:</span> <span class=n>InferenceClient</span><span class=p>,</span>
</span><span id=__span-0-105><a id=__codelineno-0-105 name=__codelineno-0-105></a>    <span class=n>hub_client</span><span class=p>:</span> <span class=n>OpenAI</span><span class=p>,</span>
</span><span id=__span-0-106><a id=__codelineno-0-106 name=__codelineno-0-106></a>    <span class=n>thread_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-107><a id=__codelineno-0-107 name=__codelineno-0-107></a>    <span class=n>run_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-108><a id=__codelineno-0-108 name=__codelineno-0-108></a>    <span class=n>create_files</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-109><a id=__codelineno-0-109 name=__codelineno-0-109></a>    <span class=n>env_vars</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-110><a id=__codelineno-0-110 name=__codelineno-0-110></a>    <span class=n>tool_resources</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-111><a id=__codelineno-0-111 name=__codelineno-0-111></a>    <span class=n>print_system_log</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-112><a id=__codelineno-0-112 name=__codelineno-0-112></a>    <span class=n>agent_runner_user</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-113><a id=__codelineno-0-113 name=__codelineno-0-113></a>    <span class=n>fastnear_api_key</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-114><a id=__codelineno-0-114 name=__codelineno-0-114></a>    <span class=n>approvals</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-115><a id=__codelineno-0-115 name=__codelineno-0-115></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-116><a id=__codelineno-0-116 name=__codelineno-0-116></a>    <span class=c1># Warning: never expose `client` or `_hub_client` to agent&#39;s environment</span>
</span><span id=__span-0-117><a id=__codelineno-0-117 name=__codelineno-0-117></a>
</span><span id=__span-0-118><a id=__codelineno-0-118 name=__codelineno-0-118></a>    <span class=bp>self</span><span class=o>.</span><span class=n>base_url</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>base_url</span>
</span><span id=__span-0-119><a id=__codelineno-0-119 name=__codelineno-0-119></a>
</span><span id=__span-0-120><a id=__codelineno-0-120 name=__codelineno-0-120></a>    <span class=c1># user_auth is used to authenticate the user in the ts_runner. It will be removed after that in</span>
</span><span id=__span-0-121><a id=__codelineno-0-121 name=__codelineno-0-121></a>    <span class=c1># `nearai/agents/agent.py`</span>
</span><span id=__span-0-122><a id=__codelineno-0-122 name=__codelineno-0-122></a>    <span class=bp>self</span><span class=o>.</span><span class=n>user_auth</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>_auth</span>
</span><span id=__span-0-123><a id=__codelineno-0-123 name=__codelineno-0-123></a>
</span><span id=__span-0-124><a id=__codelineno-0-124 name=__codelineno-0-124></a>    <span class=c1># Placeholder for solver</span>
</span><span id=__span-0-125><a id=__codelineno-0-125 name=__codelineno-0-125></a>    <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>InferenceClient</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-126><a id=__codelineno-0-126 name=__codelineno-0-126></a>
</span><span id=__span-0-127><a id=__codelineno-0-127 name=__codelineno-0-127></a>    <span class=bp>self</span><span class=o>.</span><span class=n>_path</span> <span class=o>=</span> <span class=n>path</span>
</span><span id=__span-0-128><a id=__codelineno-0-128 name=__codelineno-0-128></a>    <span class=bp>self</span><span class=o>.</span><span class=n>_agents</span> <span class=o>=</span> <span class=n>agents</span>
</span><span id=__span-0-129><a id=__codelineno-0-129 name=__codelineno-0-129></a>    <span class=bp>self</span><span class=o>.</span><span class=n>_done</span> <span class=o>=</span> <span class=kc>False</span>
</span><span id=__span-0-130><a id=__codelineno-0-130 name=__codelineno-0-130></a>    <span class=bp>self</span><span class=o>.</span><span class=n>_pending_ext_agent</span> <span class=o>=</span> <span class=kc>False</span>
</span><span id=__span-0-131><a id=__codelineno-0-131 name=__codelineno-0-131></a>    <span class=bp>self</span><span class=o>.</span><span class=n>env_vars</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=n>env_vars</span> <span class=k>if</span> <span class=n>env_vars</span> <span class=k>else</span> <span class=p>{}</span>
</span><span id=__span-0-132><a id=__codelineno-0-132 name=__codelineno-0-132></a>    <span class=bp>self</span><span class=o>.</span><span class=n>_last_used_model</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-133><a id=__codelineno-0-133 name=__codelineno-0-133></a>    <span class=bp>self</span><span class=o>.</span><span class=n>tool_resources</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=n>tool_resources</span> <span class=k>if</span> <span class=n>tool_resources</span> <span class=k>else</span> <span class=p>{}</span>
</span><span id=__span-0-134><a id=__codelineno-0-134 name=__codelineno-0-134></a>    <span class=bp>self</span><span class=o>.</span><span class=n>print_system_log</span> <span class=o>=</span> <span class=n>print_system_log</span>
</span><span id=__span-0-135><a id=__codelineno-0-135 name=__codelineno-0-135></a>    <span class=bp>self</span><span class=o>.</span><span class=n>agent_runner_user</span> <span class=o>=</span> <span class=n>agent_runner_user</span>
</span><span id=__span-0-136><a id=__codelineno-0-136 name=__codelineno-0-136></a>    <span class=bp>self</span><span class=o>.</span><span class=n>_approvals</span> <span class=o>=</span> <span class=n>approvals</span> <span class=k>if</span> <span class=n>approvals</span> <span class=k>else</span> <span class=n>default_approvals</span>
</span><span id=__span-0-137><a id=__codelineno-0-137 name=__codelineno-0-137></a>    <span class=bp>self</span><span class=o>.</span><span class=n>_thread_id</span> <span class=o>=</span> <span class=n>thread_id</span>
</span><span id=__span-0-138><a id=__codelineno-0-138 name=__codelineno-0-138></a>    <span class=bp>self</span><span class=o>.</span><span class=n>_run_id</span> <span class=o>=</span> <span class=n>run_id</span>
</span><span id=__span-0-139><a id=__codelineno-0-139 name=__codelineno-0-139></a>    <span class=bp>self</span><span class=o>.</span><span class=n>_debug_mode</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=nb>any</span><span class=p>(</span>
</span><span id=__span-0-140><a id=__codelineno-0-140 name=__codelineno-0-140></a>        <span class=nb>str</span><span class=p>(</span><span class=n>value</span><span class=p>)</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=ow>in</span> <span class=p>(</span><span class=s2>&quot;true&quot;</span><span class=p>,</span> <span class=s2>&quot;1&quot;</span><span class=p>,</span> <span class=s2>&quot;yes&quot;</span><span class=p>,</span> <span class=s2>&quot;on&quot;</span><span class=p>)</span>
</span><span id=__span-0-141><a id=__codelineno-0-141 name=__codelineno-0-141></a>        <span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>env_vars</span><span class=o>.</span><span class=n>items</span><span class=p>()</span>
</span><span id=__span-0-142><a id=__codelineno-0-142 name=__codelineno-0-142></a>        <span class=k>if</span> <span class=n>key</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=o>==</span> <span class=s2>&quot;debug&quot;</span>
</span><span id=__span-0-143><a id=__codelineno-0-143 name=__codelineno-0-143></a>    <span class=p>)</span>
</span><span id=__span-0-144><a id=__codelineno-0-144 name=__codelineno-0-144></a>    <span class=c1># Expose the NEAR account_id of a user that signs this request to run an agent.</span>
</span><span id=__span-0-145><a id=__codelineno-0-145 name=__codelineno-0-145></a>    <span class=bp>self</span><span class=o>.</span><span class=n>signer_account_id</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>auth</span><span class=o>.</span><span class=n>account_id</span> <span class=k>if</span> <span class=n>client</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>auth</span> <span class=k>else</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-146><a id=__codelineno-0-146 name=__codelineno-0-146></a>
</span><span id=__span-0-147><a id=__codelineno-0-147 name=__codelineno-0-147></a>    <span class=k>if</span> <span class=n>fastnear_api_key</span><span class=p>:</span>
</span><span id=__span-0-148><a id=__codelineno-0-148 name=__codelineno-0-148></a>        <span class=n>default_mainnet_rpc</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;https://rpc.mainnet.fastnear.com?apiKey=</span><span class=si>{</span><span class=n>fastnear_api_key</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-149><a id=__codelineno-0-149 name=__codelineno-0-149></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-150><a id=__codelineno-0-150 name=__codelineno-0-150></a>        <span class=n>default_mainnet_rpc</span> <span class=o>=</span> <span class=s2>&quot;https://rpc.mainnet.near.org&quot;</span>
</span><span id=__span-0-151><a id=__codelineno-0-151 name=__codelineno-0-151></a>
</span><span id=__span-0-152><a id=__codelineno-0-152 name=__codelineno-0-152></a>    <span class=k>class</span><span class=w> </span><span class=nc>NearAccount</span><span class=p>(</span><span class=n>Account</span><span class=p>):</span>
</span><span id=__span-0-153><a id=__codelineno-0-153 name=__codelineno-0-153></a>        <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>view</span><span class=p>(</span>
</span><span id=__span-0-154><a id=__codelineno-0-154 name=__codelineno-0-154></a>            <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-155><a id=__codelineno-0-155 name=__codelineno-0-155></a>            <span class=n>contract_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-156><a id=__codelineno-0-156 name=__codelineno-0-156></a>            <span class=n>method_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-157><a id=__codelineno-0-157 name=__codelineno-0-157></a>            <span class=n>args</span><span class=p>:</span> <span class=nb>dict</span><span class=p>,</span>
</span><span id=__span-0-158><a id=__codelineno-0-158 name=__codelineno-0-158></a>            <span class=n>block_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-159><a id=__codelineno-0-159 name=__codelineno-0-159></a>            <span class=n>threshold</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-160><a id=__codelineno-0-160 name=__codelineno-0-160></a>            <span class=n>max_retries</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>3</span><span class=p>,</span>
</span><span id=__span-0-161><a id=__codelineno-0-161 name=__codelineno-0-161></a>        <span class=p>):</span>
</span><span id=__span-0-162><a id=__codelineno-0-162 name=__codelineno-0-162></a><span class=w>            </span><span class=sd>&quot;&quot;&quot;Wrapper for the view method of the Account class, adding multiple retry attempts.</span>
</span><span id=__span-0-163><a id=__codelineno-0-163 name=__codelineno-0-163></a>
</span><span id=__span-0-164><a id=__codelineno-0-164 name=__codelineno-0-164></a><span class=sd>            Parameters</span>
</span><span id=__span-0-165><a id=__codelineno-0-165 name=__codelineno-0-165></a><span class=sd>            ----------</span>
</span><span id=__span-0-166><a id=__codelineno-0-166 name=__codelineno-0-166></a><span class=sd>            contract_id : str</span>
</span><span id=__span-0-167><a id=__codelineno-0-167 name=__codelineno-0-167></a><span class=sd>                The ID of the contract to call.</span>
</span><span id=__span-0-168><a id=__codelineno-0-168 name=__codelineno-0-168></a><span class=sd>            method_name : str</span>
</span><span id=__span-0-169><a id=__codelineno-0-169 name=__codelineno-0-169></a><span class=sd>                The name of the method to invoke on the contract.</span>
</span><span id=__span-0-170><a id=__codelineno-0-170 name=__codelineno-0-170></a><span class=sd>            args : dict</span>
</span><span id=__span-0-171><a id=__codelineno-0-171 name=__codelineno-0-171></a><span class=sd>                The arguments to pass to the contract method.</span>
</span><span id=__span-0-172><a id=__codelineno-0-172 name=__codelineno-0-172></a><span class=sd>            block_id : Optional[int]</span>
</span><span id=__span-0-173><a id=__codelineno-0-173 name=__codelineno-0-173></a><span class=sd>                The block ID to query at.</span>
</span><span id=__span-0-174><a id=__codelineno-0-174 name=__codelineno-0-174></a><span class=sd>            threshold : Optional[int]</span>
</span><span id=__span-0-175><a id=__codelineno-0-175 name=__codelineno-0-175></a><span class=sd>                The threshold for the view function.</span>
</span><span id=__span-0-176><a id=__codelineno-0-176 name=__codelineno-0-176></a><span class=sd>            max_retries : int</span>
</span><span id=__span-0-177><a id=__codelineno-0-177 name=__codelineno-0-177></a><span class=sd>                The maximum number of retry attempts.</span>
</span><span id=__span-0-178><a id=__codelineno-0-178 name=__codelineno-0-178></a>
</span><span id=__span-0-179><a id=__codelineno-0-179 name=__codelineno-0-179></a><span class=sd>            Returns</span>
</span><span id=__span-0-180><a id=__codelineno-0-180 name=__codelineno-0-180></a><span class=sd>            -------</span>
</span><span id=__span-0-181><a id=__codelineno-0-181 name=__codelineno-0-181></a><span class=sd>            The result of the contract method call.</span>
</span><span id=__span-0-182><a id=__codelineno-0-182 name=__codelineno-0-182></a>
</span><span id=__span-0-183><a id=__codelineno-0-183 name=__codelineno-0-183></a><span class=sd>            Raises</span>
</span><span id=__span-0-184><a id=__codelineno-0-184 name=__codelineno-0-184></a><span class=sd>            ------</span>
</span><span id=__span-0-185><a id=__codelineno-0-185 name=__codelineno-0-185></a><span class=sd>            Exception</span>
</span><span id=__span-0-186><a id=__codelineno-0-186 name=__codelineno-0-186></a><span class=sd>                If all retry attempts fail, the exception is propagated.</span>
</span><span id=__span-0-187><a id=__codelineno-0-187 name=__codelineno-0-187></a>
</span><span id=__span-0-188><a id=__codelineno-0-188 name=__codelineno-0-188></a><span class=sd>            &quot;&quot;&quot;</span>
</span><span id=__span-0-189><a id=__codelineno-0-189 name=__codelineno-0-189></a>            <span class=n>acc</span> <span class=o>=</span> <span class=n>Account</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>account_id</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>private_key</span><span class=p>,</span> <span class=n>default_mainnet_rpc</span><span class=p>)</span>
</span><span id=__span-0-190><a id=__codelineno-0-190 name=__codelineno-0-190></a>            <span class=k>await</span> <span class=n>acc</span><span class=o>.</span><span class=n>startup</span><span class=p>()</span>
</span><span id=__span-0-191><a id=__codelineno-0-191 name=__codelineno-0-191></a>            <span class=n>max_retries</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=n>max_retries</span><span class=p>,</span> <span class=mi>10</span><span class=p>)</span>
</span><span id=__span-0-192><a id=__codelineno-0-192 name=__codelineno-0-192></a>
</span><span id=__span-0-193><a id=__codelineno-0-193 name=__codelineno-0-193></a>            <span class=k>for</span> <span class=n>attempt</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>max_retries</span> <span class=o>+</span> <span class=mi>1</span><span class=p>):</span>
</span><span id=__span-0-194><a id=__codelineno-0-194 name=__codelineno-0-194></a>                <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-195><a id=__codelineno-0-195 name=__codelineno-0-195></a>                    <span class=c1># Attempt to read the contract view method</span>
</span><span id=__span-0-196><a id=__codelineno-0-196 name=__codelineno-0-196></a>                    <span class=k>return</span> <span class=k>await</span> <span class=n>acc</span><span class=o>.</span><span class=n>view_function</span><span class=p>(</span><span class=n>contract_id</span><span class=p>,</span> <span class=n>method_name</span><span class=p>,</span> <span class=n>args</span><span class=p>,</span> <span class=n>block_id</span><span class=p>,</span> <span class=n>threshold</span><span class=p>)</span>
</span><span id=__span-0-197><a id=__codelineno-0-197 name=__codelineno-0-197></a>                <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-198><a id=__codelineno-0-198 name=__codelineno-0-198></a>                    <span class=c1># Log the error message for the current attempt</span>
</span><span id=__span-0-199><a id=__codelineno-0-199 name=__codelineno-0-199></a>                    <span class=nb>print</span><span class=p>(</span>
</span><span id=__span-0-200><a id=__codelineno-0-200 name=__codelineno-0-200></a>                        <span class=sa>f</span><span class=s2>&quot;Attempt </span><span class=si>{</span><span class=n>attempt</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>max_retries</span><span class=si>}</span><span class=s2> to view method &#39;</span><span class=si>{</span><span class=n>method_name</span><span class=si>}</span><span class=s2>&#39; on contract &quot;</span>
</span><span id=__span-0-201><a id=__codelineno-0-201 name=__codelineno-0-201></a>                        <span class=sa>f</span><span class=s2>&quot;&#39;</span><span class=si>{</span><span class=n>contract_id</span><span class=si>}</span><span class=s2>&#39; failed with error: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-202><a id=__codelineno-0-202 name=__codelineno-0-202></a>                    <span class=p>)</span>
</span><span id=__span-0-203><a id=__codelineno-0-203 name=__codelineno-0-203></a>
</span><span id=__span-0-204><a id=__codelineno-0-204 name=__codelineno-0-204></a>                    <span class=c1># If it&#39;s the last attempt, re-raise the exception</span>
</span><span id=__span-0-205><a id=__codelineno-0-205 name=__codelineno-0-205></a>                    <span class=k>if</span> <span class=n>attempt</span> <span class=o>==</span> <span class=n>max_retries</span><span class=p>:</span>
</span><span id=__span-0-206><a id=__codelineno-0-206 name=__codelineno-0-206></a>                        <span class=k>raise</span>
</span><span id=__span-0-207><a id=__codelineno-0-207 name=__codelineno-0-207></a>
</span><span id=__span-0-208><a id=__codelineno-0-208 name=__codelineno-0-208></a>        <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>call</span><span class=p>(</span>
</span><span id=__span-0-209><a id=__codelineno-0-209 name=__codelineno-0-209></a>            <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-210><a id=__codelineno-0-210 name=__codelineno-0-210></a>            <span class=n>contract_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-211><a id=__codelineno-0-211 name=__codelineno-0-211></a>            <span class=n>method_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-212><a id=__codelineno-0-212 name=__codelineno-0-212></a>            <span class=n>args</span><span class=p>:</span> <span class=nb>dict</span><span class=p>,</span>
</span><span id=__span-0-213><a id=__codelineno-0-213 name=__codelineno-0-213></a>            <span class=n>gas</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>DEFAULT_ATTACHED_GAS</span><span class=p>,</span>
</span><span id=__span-0-214><a id=__codelineno-0-214 name=__codelineno-0-214></a>            <span class=n>amount</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span>
</span><span id=__span-0-215><a id=__codelineno-0-215 name=__codelineno-0-215></a>            <span class=n>nowait</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-216><a id=__codelineno-0-216 name=__codelineno-0-216></a>            <span class=n>included</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-217><a id=__codelineno-0-217 name=__codelineno-0-217></a>            <span class=n>max_retries</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>1</span><span class=p>,</span>
</span><span id=__span-0-218><a id=__codelineno-0-218 name=__codelineno-0-218></a>        <span class=p>):</span>
</span><span id=__span-0-219><a id=__codelineno-0-219 name=__codelineno-0-219></a><span class=w>            </span><span class=sd>&quot;&quot;&quot;Wrapper for the call method of the Account class, adding multiple retry attempts.</span>
</span><span id=__span-0-220><a id=__codelineno-0-220 name=__codelineno-0-220></a>
</span><span id=__span-0-221><a id=__codelineno-0-221 name=__codelineno-0-221></a><span class=sd>            Parameters</span>
</span><span id=__span-0-222><a id=__codelineno-0-222 name=__codelineno-0-222></a><span class=sd>            ----------</span>
</span><span id=__span-0-223><a id=__codelineno-0-223 name=__codelineno-0-223></a><span class=sd>            contract_id : str</span>
</span><span id=__span-0-224><a id=__codelineno-0-224 name=__codelineno-0-224></a><span class=sd>                The ID of the contract to call.</span>
</span><span id=__span-0-225><a id=__codelineno-0-225 name=__codelineno-0-225></a><span class=sd>            method_name : str</span>
</span><span id=__span-0-226><a id=__codelineno-0-226 name=__codelineno-0-226></a><span class=sd>                The name of the method to invoke on the contract.</span>
</span><span id=__span-0-227><a id=__codelineno-0-227 name=__codelineno-0-227></a><span class=sd>            args : dict</span>
</span><span id=__span-0-228><a id=__codelineno-0-228 name=__codelineno-0-228></a><span class=sd>                The arguments to pass to the contract method.</span>
</span><span id=__span-0-229><a id=__codelineno-0-229 name=__codelineno-0-229></a><span class=sd>            gas : int</span>
</span><span id=__span-0-230><a id=__codelineno-0-230 name=__codelineno-0-230></a><span class=sd>                The amount of gas to attach to the call.</span>
</span><span id=__span-0-231><a id=__codelineno-0-231 name=__codelineno-0-231></a><span class=sd>            amount : int</span>
</span><span id=__span-0-232><a id=__codelineno-0-232 name=__codelineno-0-232></a><span class=sd>                The amount of tokens to attach to the call.</span>
</span><span id=__span-0-233><a id=__codelineno-0-233 name=__codelineno-0-233></a><span class=sd>            nowait : bool</span>
</span><span id=__span-0-234><a id=__codelineno-0-234 name=__codelineno-0-234></a><span class=sd>                If True, do not wait for the transaction to be confirmed.</span>
</span><span id=__span-0-235><a id=__codelineno-0-235 name=__codelineno-0-235></a><span class=sd>            included : bool</span>
</span><span id=__span-0-236><a id=__codelineno-0-236 name=__codelineno-0-236></a><span class=sd>                If True, include the transaction in the block.</span>
</span><span id=__span-0-237><a id=__codelineno-0-237 name=__codelineno-0-237></a><span class=sd>            max_retries : int</span>
</span><span id=__span-0-238><a id=__codelineno-0-238 name=__codelineno-0-238></a><span class=sd>                The maximum number of retry attempts.</span>
</span><span id=__span-0-239><a id=__codelineno-0-239 name=__codelineno-0-239></a>
</span><span id=__span-0-240><a id=__codelineno-0-240 name=__codelineno-0-240></a><span class=sd>            Returns</span>
</span><span id=__span-0-241><a id=__codelineno-0-241 name=__codelineno-0-241></a><span class=sd>            -------</span>
</span><span id=__span-0-242><a id=__codelineno-0-242 name=__codelineno-0-242></a><span class=sd>            The result of the contract method call.</span>
</span><span id=__span-0-243><a id=__codelineno-0-243 name=__codelineno-0-243></a>
</span><span id=__span-0-244><a id=__codelineno-0-244 name=__codelineno-0-244></a><span class=sd>            Raises</span>
</span><span id=__span-0-245><a id=__codelineno-0-245 name=__codelineno-0-245></a><span class=sd>            ------</span>
</span><span id=__span-0-246><a id=__codelineno-0-246 name=__codelineno-0-246></a><span class=sd>            Exception</span>
</span><span id=__span-0-247><a id=__codelineno-0-247 name=__codelineno-0-247></a><span class=sd>                If all retry attempts fail, the exception is propagated.</span>
</span><span id=__span-0-248><a id=__codelineno-0-248 name=__codelineno-0-248></a>
</span><span id=__span-0-249><a id=__codelineno-0-249 name=__codelineno-0-249></a><span class=sd>            &quot;&quot;&quot;</span>
</span><span id=__span-0-250><a id=__codelineno-0-250 name=__codelineno-0-250></a>            <span class=n>acc</span> <span class=o>=</span> <span class=n>Account</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>account_id</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>private_key</span><span class=p>,</span> <span class=n>default_mainnet_rpc</span><span class=p>)</span>
</span><span id=__span-0-251><a id=__codelineno-0-251 name=__codelineno-0-251></a>            <span class=k>await</span> <span class=n>acc</span><span class=o>.</span><span class=n>startup</span><span class=p>()</span>
</span><span id=__span-0-252><a id=__codelineno-0-252 name=__codelineno-0-252></a>            <span class=n>max_retries</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=n>max_retries</span><span class=p>,</span> <span class=mi>10</span><span class=p>)</span>
</span><span id=__span-0-253><a id=__codelineno-0-253 name=__codelineno-0-253></a>
</span><span id=__span-0-254><a id=__codelineno-0-254 name=__codelineno-0-254></a>            <span class=k>for</span> <span class=n>attempt</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>max_retries</span> <span class=o>+</span> <span class=mi>1</span><span class=p>):</span>
</span><span id=__span-0-255><a id=__codelineno-0-255 name=__codelineno-0-255></a>                <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-256><a id=__codelineno-0-256 name=__codelineno-0-256></a>                    <span class=c1># Attempt to call the contract method</span>
</span><span id=__span-0-257><a id=__codelineno-0-257 name=__codelineno-0-257></a>                    <span class=k>return</span> <span class=k>await</span> <span class=n>acc</span><span class=o>.</span><span class=n>function_call</span><span class=p>(</span><span class=n>contract_id</span><span class=p>,</span> <span class=n>method_name</span><span class=p>,</span> <span class=n>args</span><span class=p>,</span> <span class=n>gas</span><span class=p>,</span> <span class=n>amount</span><span class=p>,</span> <span class=n>nowait</span><span class=p>,</span> <span class=n>included</span><span class=p>)</span>
</span><span id=__span-0-258><a id=__codelineno-0-258 name=__codelineno-0-258></a>                <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-259><a id=__codelineno-0-259 name=__codelineno-0-259></a>                    <span class=c1># Log the error message for the current attempt</span>
</span><span id=__span-0-260><a id=__codelineno-0-260 name=__codelineno-0-260></a>                    <span class=nb>print</span><span class=p>(</span>
</span><span id=__span-0-261><a id=__codelineno-0-261 name=__codelineno-0-261></a>                        <span class=sa>f</span><span class=s2>&quot;Attempt </span><span class=si>{</span><span class=n>attempt</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>max_retries</span><span class=si>}</span><span class=s2> to call method &#39;</span><span class=si>{</span><span class=n>method_name</span><span class=si>}</span><span class=s2>&#39; on contract &quot;</span>
</span><span id=__span-0-262><a id=__codelineno-0-262 name=__codelineno-0-262></a>                        <span class=sa>f</span><span class=s2>&quot;&#39;</span><span class=si>{</span><span class=n>contract_id</span><span class=si>}</span><span class=s2>&#39; failed with error: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-263><a id=__codelineno-0-263 name=__codelineno-0-263></a>                    <span class=p>)</span>
</span><span id=__span-0-264><a id=__codelineno-0-264 name=__codelineno-0-264></a>
</span><span id=__span-0-265><a id=__codelineno-0-265 name=__codelineno-0-265></a>                    <span class=c1># If it&#39;s the last attempt, re-raise the exception</span>
</span><span id=__span-0-266><a id=__codelineno-0-266 name=__codelineno-0-266></a>                    <span class=k>if</span> <span class=n>attempt</span> <span class=o>==</span> <span class=n>max_retries</span><span class=p>:</span>
</span><span id=__span-0-267><a id=__codelineno-0-267 name=__codelineno-0-267></a>                        <span class=k>raise</span>
</span><span id=__span-0-268><a id=__codelineno-0-268 name=__codelineno-0-268></a>
</span><span id=__span-0-269><a id=__codelineno-0-269 name=__codelineno-0-269></a>        <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>get_balance</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>account_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span>
</span><span id=__span-0-270><a id=__codelineno-0-270 name=__codelineno-0-270></a><span class=w>            </span><span class=sd>&quot;&quot;&quot;Retrieves the balance of the specified NEAR account.</span>
</span><span id=__span-0-271><a id=__codelineno-0-271 name=__codelineno-0-271></a>
</span><span id=__span-0-272><a id=__codelineno-0-272 name=__codelineno-0-272></a><span class=sd>            Parameters</span>
</span><span id=__span-0-273><a id=__codelineno-0-273 name=__codelineno-0-273></a><span class=sd>            ----------</span>
</span><span id=__span-0-274><a id=__codelineno-0-274 name=__codelineno-0-274></a><span class=sd>            account_id : Optional[str]</span>
</span><span id=__span-0-275><a id=__codelineno-0-275 name=__codelineno-0-275></a><span class=sd>                The ID of the account to retrieve the balance for. If not provided, the balance of the current</span>
</span><span id=__span-0-276><a id=__codelineno-0-276 name=__codelineno-0-276></a><span class=sd>                account is retrieved.</span>
</span><span id=__span-0-277><a id=__codelineno-0-277 name=__codelineno-0-277></a>
</span><span id=__span-0-278><a id=__codelineno-0-278 name=__codelineno-0-278></a><span class=sd>            Returns</span>
</span><span id=__span-0-279><a id=__codelineno-0-279 name=__codelineno-0-279></a><span class=sd>            -------</span>
</span><span id=__span-0-280><a id=__codelineno-0-280 name=__codelineno-0-280></a><span class=sd>            int</span>
</span><span id=__span-0-281><a id=__codelineno-0-281 name=__codelineno-0-281></a><span class=sd>                The balance of the specified account in yoctoNEAR.</span>
</span><span id=__span-0-282><a id=__codelineno-0-282 name=__codelineno-0-282></a>
</span><span id=__span-0-283><a id=__codelineno-0-283 name=__codelineno-0-283></a><span class=sd>            Raises</span>
</span><span id=__span-0-284><a id=__codelineno-0-284 name=__codelineno-0-284></a><span class=sd>            ------</span>
</span><span id=__span-0-285><a id=__codelineno-0-285 name=__codelineno-0-285></a><span class=sd>            Exception</span>
</span><span id=__span-0-286><a id=__codelineno-0-286 name=__codelineno-0-286></a><span class=sd>                If there is an error retrieving the balance.</span>
</span><span id=__span-0-287><a id=__codelineno-0-287 name=__codelineno-0-287></a>
</span><span id=__span-0-288><a id=__codelineno-0-288 name=__codelineno-0-288></a><span class=sd>            &quot;&quot;&quot;</span>
</span><span id=__span-0-289><a id=__codelineno-0-289 name=__codelineno-0-289></a>            <span class=n>acc</span> <span class=o>=</span> <span class=n>Account</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>account_id</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>private_key</span><span class=p>,</span> <span class=n>default_mainnet_rpc</span><span class=p>)</span>
</span><span id=__span-0-290><a id=__codelineno-0-290 name=__codelineno-0-290></a>            <span class=k>await</span> <span class=n>acc</span><span class=o>.</span><span class=n>startup</span><span class=p>()</span>
</span><span id=__span-0-291><a id=__codelineno-0-291 name=__codelineno-0-291></a>            <span class=k>return</span> <span class=k>await</span> <span class=n>acc</span><span class=o>.</span><span class=n>get_balance</span><span class=p>(</span><span class=n>account_id</span><span class=p>)</span>
</span><span id=__span-0-292><a id=__codelineno-0-292 name=__codelineno-0-292></a>
</span><span id=__span-0-293><a id=__codelineno-0-293 name=__codelineno-0-293></a>        <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span>
</span><span id=__span-0-294><a id=__codelineno-0-294 name=__codelineno-0-294></a>            <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-295><a id=__codelineno-0-295 name=__codelineno-0-295></a>            <span class=n>account_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-296><a id=__codelineno-0-296 name=__codelineno-0-296></a>            <span class=n>private_key</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Union</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>bytes</span><span class=p>]],</span> <span class=nb>str</span><span class=p>,</span> <span class=nb>bytes</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-297><a id=__codelineno-0-297 name=__codelineno-0-297></a>            <span class=n>rpc_addr</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-298><a id=__codelineno-0-298 name=__codelineno-0-298></a>        <span class=p>):</span>
</span><span id=__span-0-299><a id=__codelineno-0-299 name=__codelineno-0-299></a>            <span class=bp>self</span><span class=o>.</span><span class=n>account_id</span> <span class=o>=</span> <span class=n>account_id</span>
</span><span id=__span-0-300><a id=__codelineno-0-300 name=__codelineno-0-300></a>            <span class=bp>self</span><span class=o>.</span><span class=n>private_key</span> <span class=o>=</span> <span class=n>private_key</span>
</span><span id=__span-0-301><a id=__codelineno-0-301 name=__codelineno-0-301></a>            <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>account_id</span><span class=p>,</span> <span class=n>private_key</span><span class=p>,</span> <span class=n>rpc_addr</span><span class=p>)</span>
</span><span id=__span-0-302><a id=__codelineno-0-302 name=__codelineno-0-302></a>
</span><span id=__span-0-303><a id=__codelineno-0-303 name=__codelineno-0-303></a>    <span class=bp>self</span><span class=o>.</span><span class=n>set_near</span> <span class=o>=</span> <span class=n>NearAccount</span>
</span><span id=__span-0-304><a id=__codelineno-0-304 name=__codelineno-0-304></a>
</span><span id=__span-0-305><a id=__codelineno-0-305 name=__codelineno-0-305></a>    <span class=bp>self</span><span class=o>.</span><span class=n>_tools</span> <span class=o>=</span> <span class=n>ToolRegistry</span><span class=p>()</span>
</span><span id=__span-0-306><a id=__codelineno-0-306 name=__codelineno-0-306></a>
</span><span id=__span-0-307><a id=__codelineno-0-307 name=__codelineno-0-307></a>    <span class=k>if</span> <span class=n>create_files</span><span class=p>:</span>
</span><span id=__span-0-308><a id=__codelineno-0-308 name=__codelineno-0-308></a>        <span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_path</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-309><a id=__codelineno-0-309 name=__codelineno-0-309></a>        <span class=nb>open</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_path</span><span class=p>,</span> <span class=n>CHAT_FILENAME</span><span class=p>),</span> <span class=s2>&quot;a&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span><span id=__span-0-310><a id=__codelineno-0-310 name=__codelineno-0-310></a>    <span class=n>os</span><span class=o>.</span><span class=n>chdir</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_path</span><span class=p>)</span>
</span><span id=__span-0-311><a id=__codelineno-0-311 name=__codelineno-0-311></a>
</span><span id=__span-0-312><a id=__codelineno-0-312 name=__codelineno-0-312></a>    <span class=c1># Protected client methods</span>
</span><span id=__span-0-313><a id=__codelineno-0-313 name=__codelineno-0-313></a>    <span class=k>def</span><span class=w> </span><span class=nf>query_vector_store</span><span class=p>(</span><span class=n>vector_store_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>query</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>full_files</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>):</span>
</span><span id=__span-0-314><a id=__codelineno-0-314 name=__codelineno-0-314></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Queries a vector store.</span>
</span><span id=__span-0-315><a id=__codelineno-0-315 name=__codelineno-0-315></a>
</span><span id=__span-0-316><a id=__codelineno-0-316 name=__codelineno-0-316></a><span class=sd>        vector_store_id: The id of the vector store to query.</span>
</span><span id=__span-0-317><a id=__codelineno-0-317 name=__codelineno-0-317></a><span class=sd>        query: The query to search for.</span>
</span><span id=__span-0-318><a id=__codelineno-0-318 name=__codelineno-0-318></a><span class=sd>        &quot;&quot;&quot;</span>
</span><span id=__span-0-319><a id=__codelineno-0-319 name=__codelineno-0-319></a>        <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>query_vector_store</span><span class=p>(</span><span class=n>vector_store_id</span><span class=p>,</span> <span class=n>query</span><span class=p>,</span> <span class=n>full_files</span><span class=p>)</span>
</span><span id=__span-0-320><a id=__codelineno-0-320 name=__codelineno-0-320></a>
</span><span id=__span-0-321><a id=__codelineno-0-321 name=__codelineno-0-321></a>    <span class=bp>self</span><span class=o>.</span><span class=n>query_vector_store</span> <span class=o>=</span> <span class=n>query_vector_store</span>
</span><span id=__span-0-322><a id=__codelineno-0-322 name=__codelineno-0-322></a>
</span><span id=__span-0-323><a id=__codelineno-0-323 name=__codelineno-0-323></a>    <span class=k>def</span><span class=w> </span><span class=nf>upload_file</span><span class=p>(</span>
</span><span id=__span-0-324><a id=__codelineno-0-324 name=__codelineno-0-324></a>        <span class=n>file_content</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-325><a id=__codelineno-0-325 name=__codelineno-0-325></a>        <span class=n>purpose</span><span class=p>:</span> <span class=n>Literal</span><span class=p>[</span><span class=s2>&quot;assistants&quot;</span><span class=p>,</span> <span class=s2>&quot;batch&quot;</span><span class=p>,</span> <span class=s2>&quot;fine-tune&quot;</span><span class=p>,</span> <span class=s2>&quot;vision&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;assistants&quot;</span><span class=p>,</span>
</span><span id=__span-0-326><a id=__codelineno-0-326 name=__codelineno-0-326></a>        <span class=n>encoding</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;utf-8&quot;</span><span class=p>,</span>
</span><span id=__span-0-327><a id=__codelineno-0-327 name=__codelineno-0-327></a>        <span class=n>file_name</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;file.txt&quot;</span><span class=p>,</span>
</span><span id=__span-0-328><a id=__codelineno-0-328 name=__codelineno-0-328></a>        <span class=n>file_type</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;text/plain&quot;</span><span class=p>,</span>
</span><span id=__span-0-329><a id=__codelineno-0-329 name=__codelineno-0-329></a>    <span class=p>):</span>
</span><span id=__span-0-330><a id=__codelineno-0-330 name=__codelineno-0-330></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Uploads a file to the registry.&quot;&quot;&quot;</span>
</span><span id=__span-0-331><a id=__codelineno-0-331 name=__codelineno-0-331></a>        <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>upload_file</span><span class=p>(</span>
</span><span id=__span-0-332><a id=__codelineno-0-332 name=__codelineno-0-332></a>            <span class=n>file_content</span><span class=p>,</span> <span class=n>purpose</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=n>encoding</span><span class=p>,</span> <span class=n>file_name</span><span class=o>=</span><span class=n>file_name</span><span class=p>,</span> <span class=n>file_type</span><span class=o>=</span><span class=n>file_type</span>
</span><span id=__span-0-333><a id=__codelineno-0-333 name=__codelineno-0-333></a>        <span class=p>)</span>
</span><span id=__span-0-334><a id=__codelineno-0-334 name=__codelineno-0-334></a>
</span><span id=__span-0-335><a id=__codelineno-0-335 name=__codelineno-0-335></a>    <span class=bp>self</span><span class=o>.</span><span class=n>upload_file</span> <span class=o>=</span> <span class=n>upload_file</span>
</span><span id=__span-0-336><a id=__codelineno-0-336 name=__codelineno-0-336></a>
</span><span id=__span-0-337><a id=__codelineno-0-337 name=__codelineno-0-337></a>    <span class=k>def</span><span class=w> </span><span class=nf>remove_file</span><span class=p>(</span><span class=n>file_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-338><a id=__codelineno-0-338 name=__codelineno-0-338></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Removes a file from the registry.&quot;&quot;&quot;</span>
</span><span id=__span-0-339><a id=__codelineno-0-339 name=__codelineno-0-339></a>        <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>remove_file</span><span class=p>(</span><span class=n>file_id</span><span class=p>)</span>
</span><span id=__span-0-340><a id=__codelineno-0-340 name=__codelineno-0-340></a>
</span><span id=__span-0-341><a id=__codelineno-0-341 name=__codelineno-0-341></a>    <span class=bp>self</span><span class=o>.</span><span class=n>remove_file</span> <span class=o>=</span> <span class=n>remove_file</span>
</span><span id=__span-0-342><a id=__codelineno-0-342 name=__codelineno-0-342></a>
</span><span id=__span-0-343><a id=__codelineno-0-343 name=__codelineno-0-343></a>    <span class=k>def</span><span class=w> </span><span class=nf>create_vector_store_from_source</span><span class=p>(</span>
</span><span id=__span-0-344><a id=__codelineno-0-344 name=__codelineno-0-344></a>        <span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-345><a id=__codelineno-0-345 name=__codelineno-0-345></a>        <span class=n>source</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>GitHubSource</span><span class=p>,</span> <span class=n>GitLabSource</span><span class=p>],</span>
</span><span id=__span-0-346><a id=__codelineno-0-346 name=__codelineno-0-346></a>        <span class=n>source_auth</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-347><a id=__codelineno-0-347 name=__codelineno-0-347></a>        <span class=n>chunking_strategy</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>ChunkingStrategy</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-348><a id=__codelineno-0-348 name=__codelineno-0-348></a>        <span class=n>expires_after</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>ExpiresAfter</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-349><a id=__codelineno-0-349 name=__codelineno-0-349></a>        <span class=n>metadata</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-350><a id=__codelineno-0-350 name=__codelineno-0-350></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>VectorStore</span><span class=p>:</span>
</span><span id=__span-0-351><a id=__codelineno-0-351 name=__codelineno-0-351></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Creates a vector store from the given source.</span>
</span><span id=__span-0-352><a id=__codelineno-0-352 name=__codelineno-0-352></a>
</span><span id=__span-0-353><a id=__codelineno-0-353 name=__codelineno-0-353></a><span class=sd>        Args:</span>
</span><span id=__span-0-354><a id=__codelineno-0-354 name=__codelineno-0-354></a><span class=sd>        ----</span>
</span><span id=__span-0-355><a id=__codelineno-0-355 name=__codelineno-0-355></a><span class=sd>            name: The name of the vector store.</span>
</span><span id=__span-0-356><a id=__codelineno-0-356 name=__codelineno-0-356></a><span class=sd>            source: The source from which to create the vector store.</span>
</span><span id=__span-0-357><a id=__codelineno-0-357 name=__codelineno-0-357></a><span class=sd>            source_auth: The source authentication token.</span>
</span><span id=__span-0-358><a id=__codelineno-0-358 name=__codelineno-0-358></a><span class=sd>            chunking_strategy: The chunking strategy to use.</span>
</span><span id=__span-0-359><a id=__codelineno-0-359 name=__codelineno-0-359></a><span class=sd>            expires_after: The expiration policy.</span>
</span><span id=__span-0-360><a id=__codelineno-0-360 name=__codelineno-0-360></a><span class=sd>            metadata: Additional metadata.</span>
</span><span id=__span-0-361><a id=__codelineno-0-361 name=__codelineno-0-361></a>
</span><span id=__span-0-362><a id=__codelineno-0-362 name=__codelineno-0-362></a><span class=sd>        Returns:</span>
</span><span id=__span-0-363><a id=__codelineno-0-363 name=__codelineno-0-363></a><span class=sd>        -------</span>
</span><span id=__span-0-364><a id=__codelineno-0-364 name=__codelineno-0-364></a><span class=sd>            VectorStore: The created vector store.</span>
</span><span id=__span-0-365><a id=__codelineno-0-365 name=__codelineno-0-365></a>
</span><span id=__span-0-366><a id=__codelineno-0-366 name=__codelineno-0-366></a><span class=sd>        &quot;&quot;&quot;</span>
</span><span id=__span-0-367><a id=__codelineno-0-367 name=__codelineno-0-367></a>        <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>create_vector_store_from_source</span><span class=p>(</span>
</span><span id=__span-0-368><a id=__codelineno-0-368 name=__codelineno-0-368></a>            <span class=n>name</span><span class=o>=</span><span class=n>name</span><span class=p>,</span>
</span><span id=__span-0-369><a id=__codelineno-0-369 name=__codelineno-0-369></a>            <span class=n>source</span><span class=o>=</span><span class=n>source</span><span class=p>,</span>
</span><span id=__span-0-370><a id=__codelineno-0-370 name=__codelineno-0-370></a>            <span class=n>source_auth</span><span class=o>=</span><span class=n>source_auth</span><span class=p>,</span>
</span><span id=__span-0-371><a id=__codelineno-0-371 name=__codelineno-0-371></a>            <span class=n>chunking_strategy</span><span class=o>=</span><span class=n>chunking_strategy</span><span class=p>,</span>
</span><span id=__span-0-372><a id=__codelineno-0-372 name=__codelineno-0-372></a>            <span class=n>expires_after</span><span class=o>=</span><span class=n>expires_after</span><span class=p>,</span>
</span><span id=__span-0-373><a id=__codelineno-0-373 name=__codelineno-0-373></a>            <span class=n>metadata</span><span class=o>=</span><span class=n>metadata</span><span class=p>,</span>
</span><span id=__span-0-374><a id=__codelineno-0-374 name=__codelineno-0-374></a>        <span class=p>)</span>
</span><span id=__span-0-375><a id=__codelineno-0-375 name=__codelineno-0-375></a>
</span><span id=__span-0-376><a id=__codelineno-0-376 name=__codelineno-0-376></a>    <span class=bp>self</span><span class=o>.</span><span class=n>create_vector_store_from_source</span> <span class=o>=</span> <span class=n>create_vector_store_from_source</span>
</span><span id=__span-0-377><a id=__codelineno-0-377 name=__codelineno-0-377></a>
</span><span id=__span-0-378><a id=__codelineno-0-378 name=__codelineno-0-378></a>    <span class=k>def</span><span class=w> </span><span class=nf>add_file_to_vector_store</span><span class=p>(</span><span class=n>vector_store_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>file_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-379><a id=__codelineno-0-379 name=__codelineno-0-379></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Adds a file to the vector store.&quot;&quot;&quot;</span>
</span><span id=__span-0-380><a id=__codelineno-0-380 name=__codelineno-0-380></a>        <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>add_file_to_vector_store</span><span class=p>(</span><span class=n>vector_store_id</span><span class=p>,</span> <span class=n>file_id</span><span class=p>)</span>
</span><span id=__span-0-381><a id=__codelineno-0-381 name=__codelineno-0-381></a>
</span><span id=__span-0-382><a id=__codelineno-0-382 name=__codelineno-0-382></a>    <span class=bp>self</span><span class=o>.</span><span class=n>add_file_to_vector_store</span> <span class=o>=</span> <span class=n>add_file_to_vector_store</span>
</span><span id=__span-0-383><a id=__codelineno-0-383 name=__codelineno-0-383></a>
</span><span id=__span-0-384><a id=__codelineno-0-384 name=__codelineno-0-384></a>    <span class=c1># positional arguments are not allowed because arguments list will be updated</span>
</span><span id=__span-0-385><a id=__codelineno-0-385 name=__codelineno-0-385></a>    <span class=k>def</span><span class=w> </span><span class=nf>find_agents</span><span class=p>(</span><span class=o>*</span><span class=p>,</span> <span class=n>owner_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>with_capabilities</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>bool</span><span class=p>]</span> <span class=o>=</span> <span class=kc>False</span><span class=p>):</span>
</span><span id=__span-0-386><a id=__codelineno-0-386 name=__codelineno-0-386></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Find agents based on various parameters.&quot;&quot;&quot;</span>
</span><span id=__span-0-387><a id=__codelineno-0-387 name=__codelineno-0-387></a>        <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>find_agents</span><span class=p>(</span><span class=n>owner_id</span><span class=p>,</span> <span class=n>with_capabilities</span><span class=p>)</span>
</span><span id=__span-0-388><a id=__codelineno-0-388 name=__codelineno-0-388></a>
</span><span id=__span-0-389><a id=__codelineno-0-389 name=__codelineno-0-389></a>    <span class=bp>self</span><span class=o>.</span><span class=n>find_agents</span> <span class=o>=</span> <span class=n>find_agents</span>
</span><span id=__span-0-390><a id=__codelineno-0-390 name=__codelineno-0-390></a>
</span><span id=__span-0-391><a id=__codelineno-0-391 name=__codelineno-0-391></a>    <span class=k>def</span><span class=w> </span><span class=nf>create_vector_store</span><span class=p>(</span>
</span><span id=__span-0-392><a id=__codelineno-0-392 name=__codelineno-0-392></a>        <span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-393><a id=__codelineno-0-393 name=__codelineno-0-393></a>        <span class=n>file_ids</span><span class=p>:</span> <span class=nb>list</span><span class=p>,</span>
</span><span id=__span-0-394><a id=__codelineno-0-394 name=__codelineno-0-394></a>        <span class=n>expires_after</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>ExpiresAfter</span><span class=p>,</span> <span class=n>NotGiven</span><span class=p>]</span> <span class=o>=</span> <span class=n>NOT_GIVEN</span><span class=p>,</span>
</span><span id=__span-0-395><a id=__codelineno-0-395 name=__codelineno-0-395></a>        <span class=n>chunking_strategy</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span>
</span><span id=__span-0-396><a id=__codelineno-0-396 name=__codelineno-0-396></a>            <span class=n>AutoFileChunkingStrategyParam</span><span class=p>,</span> <span class=n>StaticFileChunkingStrategyObjectParam</span><span class=p>,</span> <span class=n>NotGiven</span>
</span><span id=__span-0-397><a id=__codelineno-0-397 name=__codelineno-0-397></a>        <span class=p>]</span> <span class=o>=</span> <span class=n>NOT_GIVEN</span><span class=p>,</span>
</span><span id=__span-0-398><a id=__codelineno-0-398 name=__codelineno-0-398></a>        <span class=n>metadata</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-399><a id=__codelineno-0-399 name=__codelineno-0-399></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>VectorStore</span><span class=p>:</span>
</span><span id=__span-0-400><a id=__codelineno-0-400 name=__codelineno-0-400></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Creates a vector store.</span>
</span><span id=__span-0-401><a id=__codelineno-0-401 name=__codelineno-0-401></a>
</span><span id=__span-0-402><a id=__codelineno-0-402 name=__codelineno-0-402></a><span class=sd>        Args:</span>
</span><span id=__span-0-403><a id=__codelineno-0-403 name=__codelineno-0-403></a><span class=sd>        ----</span>
</span><span id=__span-0-404><a id=__codelineno-0-404 name=__codelineno-0-404></a><span class=sd>            name: The name of the vector store.</span>
</span><span id=__span-0-405><a id=__codelineno-0-405 name=__codelineno-0-405></a><span class=sd>            file_ids: List of file ids to create the vector store.</span>
</span><span id=__span-0-406><a id=__codelineno-0-406 name=__codelineno-0-406></a><span class=sd>            chunking_strategy: The chunking strategy to use.</span>
</span><span id=__span-0-407><a id=__codelineno-0-407 name=__codelineno-0-407></a><span class=sd>            expires_after: The expiration policy.</span>
</span><span id=__span-0-408><a id=__codelineno-0-408 name=__codelineno-0-408></a><span class=sd>            metadata: Additional metadata.</span>
</span><span id=__span-0-409><a id=__codelineno-0-409 name=__codelineno-0-409></a>
</span><span id=__span-0-410><a id=__codelineno-0-410 name=__codelineno-0-410></a><span class=sd>        Returns:</span>
</span><span id=__span-0-411><a id=__codelineno-0-411 name=__codelineno-0-411></a><span class=sd>        -------</span>
</span><span id=__span-0-412><a id=__codelineno-0-412 name=__codelineno-0-412></a><span class=sd>            VectorStore: The created vector store.</span>
</span><span id=__span-0-413><a id=__codelineno-0-413 name=__codelineno-0-413></a>
</span><span id=__span-0-414><a id=__codelineno-0-414 name=__codelineno-0-414></a><span class=sd>        &quot;&quot;&quot;</span>
</span><span id=__span-0-415><a id=__codelineno-0-415 name=__codelineno-0-415></a>        <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>create_vector_store</span><span class=p>(</span>
</span><span id=__span-0-416><a id=__codelineno-0-416 name=__codelineno-0-416></a>            <span class=n>name</span><span class=o>=</span><span class=n>name</span><span class=p>,</span>
</span><span id=__span-0-417><a id=__codelineno-0-417 name=__codelineno-0-417></a>            <span class=n>file_ids</span><span class=o>=</span><span class=n>file_ids</span><span class=p>,</span>
</span><span id=__span-0-418><a id=__codelineno-0-418 name=__codelineno-0-418></a>            <span class=n>chunking_strategy</span><span class=o>=</span><span class=n>chunking_strategy</span><span class=p>,</span>
</span><span id=__span-0-419><a id=__codelineno-0-419 name=__codelineno-0-419></a>            <span class=n>expires_after</span><span class=o>=</span><span class=n>expires_after</span><span class=p>,</span>
</span><span id=__span-0-420><a id=__codelineno-0-420 name=__codelineno-0-420></a>            <span class=n>metadata</span><span class=o>=</span><span class=n>metadata</span><span class=p>,</span>
</span><span id=__span-0-421><a id=__codelineno-0-421 name=__codelineno-0-421></a>        <span class=p>)</span>
</span><span id=__span-0-422><a id=__codelineno-0-422 name=__codelineno-0-422></a>
</span><span id=__span-0-423><a id=__codelineno-0-423 name=__codelineno-0-423></a>    <span class=bp>self</span><span class=o>.</span><span class=n>create_vector_store</span> <span class=o>=</span> <span class=n>create_vector_store</span>
</span><span id=__span-0-424><a id=__codelineno-0-424 name=__codelineno-0-424></a>
</span><span id=__span-0-425><a id=__codelineno-0-425 name=__codelineno-0-425></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_vector_store</span><span class=p>(</span><span class=n>vector_store_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>VectorStore</span><span class=p>:</span>
</span><span id=__span-0-426><a id=__codelineno-0-426 name=__codelineno-0-426></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Gets a vector store by id.&quot;&quot;&quot;</span>
</span><span id=__span-0-427><a id=__codelineno-0-427 name=__codelineno-0-427></a>        <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>get_vector_store</span><span class=p>(</span><span class=n>vector_store_id</span><span class=p>)</span>
</span><span id=__span-0-428><a id=__codelineno-0-428 name=__codelineno-0-428></a>
</span><span id=__span-0-429><a id=__codelineno-0-429 name=__codelineno-0-429></a>    <span class=bp>self</span><span class=o>.</span><span class=n>get_vector_store</span> <span class=o>=</span> <span class=n>get_vector_store</span>
</span><span id=__span-0-430><a id=__codelineno-0-430 name=__codelineno-0-430></a>
</span><span id=__span-0-431><a id=__codelineno-0-431 name=__codelineno-0-431></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_vector_store_files</span><span class=p>(</span><span class=n>vector_store_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=n>VectorStoreFile</span><span class=p>]]:</span>
</span><span id=__span-0-432><a id=__codelineno-0-432 name=__codelineno-0-432></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Gets a list of vector store files.&quot;&quot;&quot;</span>
</span><span id=__span-0-433><a id=__codelineno-0-433 name=__codelineno-0-433></a>        <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>get_vector_store_files</span><span class=p>(</span><span class=n>vector_store_id</span><span class=p>)</span>
</span><span id=__span-0-434><a id=__codelineno-0-434 name=__codelineno-0-434></a>
</span><span id=__span-0-435><a id=__codelineno-0-435 name=__codelineno-0-435></a>    <span class=bp>self</span><span class=o>.</span><span class=n>get_vector_store_files</span> <span class=o>=</span> <span class=n>get_vector_store_files</span>
</span><span id=__span-0-436><a id=__codelineno-0-436 name=__codelineno-0-436></a>
</span><span id=__span-0-437><a id=__codelineno-0-437 name=__codelineno-0-437></a>    <span class=c1># Save cache of requested models for inference to avoid extra server calls</span>
</span><span id=__span-0-438><a id=__codelineno-0-438 name=__codelineno-0-438></a>    <span class=bp>self</span><span class=o>.</span><span class=n>cached_models_for_inference</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-0-439><a id=__codelineno-0-439 name=__codelineno-0-439></a>
</span><span id=__span-0-440><a id=__codelineno-0-440 name=__codelineno-0-440></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_model_for_inference</span><span class=p>(</span><span class=n>model</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-0-441><a id=__codelineno-0-441 name=__codelineno-0-441></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns &#39;provider::model_full_path&#39;.&quot;&quot;&quot;</span>
</span><span id=__span-0-442><a id=__codelineno-0-442 name=__codelineno-0-442></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>cached_models_for_inference</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-443><a id=__codelineno-0-443 name=__codelineno-0-443></a>            <span class=n>provider</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_primary_agent</span><span class=p>()</span><span class=o>.</span><span class=n>model_provider</span> <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_agents</span> <span class=k>else</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-444><a id=__codelineno-0-444 name=__codelineno-0-444></a>            <span class=k>if</span> <span class=n>model</span> <span class=o>==</span> <span class=s2>&quot;&quot;</span><span class=p>:</span>
</span><span id=__span-0-445><a id=__codelineno-0-445 name=__codelineno-0-445></a>                <span class=n>model</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_primary_agent</span><span class=p>()</span><span class=o>.</span><span class=n>model</span> <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_agents</span> <span class=k>else</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-446><a id=__codelineno-0-446 name=__codelineno-0-446></a>            <span class=k>if</span> <span class=n>model</span> <span class=o>==</span> <span class=s2>&quot;&quot;</span><span class=p>:</span>
</span><span id=__span-0-447><a id=__codelineno-0-447 name=__codelineno-0-447></a>                <span class=k>return</span> <span class=n>DEFAULT_PROVIDER_MODEL</span>
</span><span id=__span-0-448><a id=__codelineno-0-448 name=__codelineno-0-448></a>
</span><span id=__span-0-449><a id=__codelineno-0-449 name=__codelineno-0-449></a>            <span class=n>_</span><span class=p>,</span> <span class=n>model_for_inference</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>provider_models</span><span class=o>.</span><span class=n>match_provider_model</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>provider</span><span class=p>)</span>
</span><span id=__span-0-450><a id=__codelineno-0-450 name=__codelineno-0-450></a>
</span><span id=__span-0-451><a id=__codelineno-0-451 name=__codelineno-0-451></a>            <span class=bp>self</span><span class=o>.</span><span class=n>cached_models_for_inference</span><span class=p>[</span><span class=n>model</span><span class=p>]</span> <span class=o>=</span> <span class=n>model_for_inference</span>
</span><span id=__span-0-452><a id=__codelineno-0-452 name=__codelineno-0-452></a>
</span><span id=__span-0-453><a id=__codelineno-0-453 name=__codelineno-0-453></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>cached_models_for_inference</span><span class=p>[</span><span class=n>model</span><span class=p>]</span>
</span><span id=__span-0-454><a id=__codelineno-0-454 name=__codelineno-0-454></a>
</span><span id=__span-0-455><a id=__codelineno-0-455 name=__codelineno-0-455></a>    <span class=bp>self</span><span class=o>.</span><span class=n>get_model_for_inference</span> <span class=o>=</span> <span class=n>get_model_for_inference</span>
</span><span id=__span-0-456><a id=__codelineno-0-456 name=__codelineno-0-456></a>
</span><span id=__span-0-457><a id=__codelineno-0-457 name=__codelineno-0-457></a>    <span class=k>def</span><span class=w> </span><span class=nf>_run_inference_completions</span><span class=p>(</span>
</span><span id=__span-0-458><a id=__codelineno-0-458 name=__codelineno-0-458></a>        <span class=n>messages</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Iterable</span><span class=p>[</span><span class=n>ChatCompletionMessageParam</span><span class=p>],</span> <span class=nb>str</span><span class=p>],</span>
</span><span id=__span-0-459><a id=__codelineno-0-459 name=__codelineno-0-459></a>        <span class=n>model</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Iterable</span><span class=p>[</span><span class=n>ChatCompletionMessageParam</span><span class=p>],</span> <span class=nb>str</span><span class=p>],</span>
</span><span id=__span-0-460><a id=__codelineno-0-460 name=__codelineno-0-460></a>        <span class=n>stream</span><span class=p>:</span> <span class=nb>bool</span><span class=p>,</span>
</span><span id=__span-0-461><a id=__codelineno-0-461 name=__codelineno-0-461></a>        <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span>
</span><span id=__span-0-462><a id=__codelineno-0-462 name=__codelineno-0-462></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span><span class=n>ModelResponse</span><span class=p>,</span> <span class=n>CustomStreamWrapper</span><span class=p>]:</span>
</span><span id=__span-0-463><a id=__codelineno-0-463 name=__codelineno-0-463></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Run inference completions for given parameters.&quot;&quot;&quot;</span>
</span><span id=__span-0-464><a id=__codelineno-0-464 name=__codelineno-0-464></a>        <span class=n>params</span><span class=p>,</span> <span class=n>kwargs</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_inference_parameters</span><span class=p>(</span><span class=n>messages</span><span class=p>,</span> <span class=n>model</span><span class=p>,</span> <span class=n>stream</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span><span id=__span-0-465><a id=__codelineno-0-465 name=__codelineno-0-465></a>
</span><span id=__span-0-466><a id=__codelineno-0-466 name=__codelineno-0-466></a>        <span class=n>completions</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>completions</span><span class=p>(</span>
</span><span id=__span-0-467><a id=__codelineno-0-467 name=__codelineno-0-467></a>            <span class=n>params</span><span class=o>.</span><span class=n>model</span><span class=p>,</span> <span class=n>params</span><span class=o>.</span><span class=n>messages</span><span class=p>,</span> <span class=n>params</span><span class=o>.</span><span class=n>stream</span><span class=p>,</span> <span class=n>params</span><span class=o>.</span><span class=n>temperature</span><span class=p>,</span> <span class=n>params</span><span class=o>.</span><span class=n>max_tokens</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span>
</span><span id=__span-0-468><a id=__codelineno-0-468 name=__codelineno-0-468></a>        <span class=p>)</span>
</span><span id=__span-0-469><a id=__codelineno-0-469 name=__codelineno-0-469></a>
</span><span id=__span-0-470><a id=__codelineno-0-470 name=__codelineno-0-470></a>        <span class=k>return</span> <span class=n>completions</span>
</span><span id=__span-0-471><a id=__codelineno-0-471 name=__codelineno-0-471></a>
</span><span id=__span-0-472><a id=__codelineno-0-472 name=__codelineno-0-472></a>    <span class=bp>self</span><span class=o>.</span><span class=n>_run_inference_completions</span> <span class=o>=</span> <span class=n>_run_inference_completions</span>
</span><span id=__span-0-473><a id=__codelineno-0-473 name=__codelineno-0-473></a>
</span><span id=__span-0-474><a id=__codelineno-0-474 name=__codelineno-0-474></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_agent_public_key</span><span class=p>():</span>
</span><span id=__span-0-475><a id=__codelineno-0-475 name=__codelineno-0-475></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns public key of the agent.&quot;&quot;&quot;</span>
</span><span id=__span-0-476><a id=__codelineno-0-476 name=__codelineno-0-476></a>        <span class=n>agent_name</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_primary_agent</span><span class=p>()</span><span class=o>.</span><span class=n>get_full_name</span><span class=p>()</span>
</span><span id=__span-0-477><a id=__codelineno-0-477 name=__codelineno-0-477></a>
</span><span id=__span-0-478><a id=__codelineno-0-478 name=__codelineno-0-478></a>        <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>get_agent_public_key</span><span class=p>(</span><span class=n>agent_name</span><span class=p>)</span>
</span><span id=__span-0-479><a id=__codelineno-0-479 name=__codelineno-0-479></a>
</span><span id=__span-0-480><a id=__codelineno-0-480 name=__codelineno-0-480></a>    <span class=bp>self</span><span class=o>.</span><span class=n>get_agent_public_key</span> <span class=o>=</span> <span class=n>get_agent_public_key</span>
</span><span id=__span-0-481><a id=__codelineno-0-481 name=__codelineno-0-481></a>
</span><span id=__span-0-482><a id=__codelineno-0-482 name=__codelineno-0-482></a>    <span class=k>def</span><span class=w> </span><span class=nf>run_agent</span><span class=p>(</span>
</span><span id=__span-0-483><a id=__codelineno-0-483 name=__codelineno-0-483></a>        <span class=n>agent_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-484><a id=__codelineno-0-484 name=__codelineno-0-484></a>        <span class=n>query</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-485><a id=__codelineno-0-485 name=__codelineno-0-485></a>        <span class=n>thread_mode</span><span class=p>:</span> <span class=n>ThreadMode</span> <span class=o>=</span> <span class=n>ThreadMode</span><span class=o>.</span><span class=n>FORK</span><span class=p>,</span>
</span><span id=__span-0-486><a id=__codelineno-0-486 name=__codelineno-0-486></a>        <span class=n>run_mode</span><span class=p>:</span> <span class=n>RunMode</span> <span class=o>=</span> <span class=n>RunMode</span><span class=o>.</span><span class=n>SIMPLE</span><span class=p>,</span>
</span><span id=__span-0-487><a id=__codelineno-0-487 name=__codelineno-0-487></a>    <span class=p>):</span>
</span><span id=__span-0-488><a id=__codelineno-0-488 name=__codelineno-0-488></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Runs a child agent on the thread.&quot;&quot;&quot;</span>
</span><span id=__span-0-489><a id=__codelineno-0-489 name=__codelineno-0-489></a>        <span class=n>child_thread_id</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_thread_id</span>
</span><span id=__span-0-490><a id=__codelineno-0-490 name=__codelineno-0-490></a>
</span><span id=__span-0-491><a id=__codelineno-0-491 name=__codelineno-0-491></a>        <span class=k>if</span> <span class=n>thread_mode</span> <span class=o>==</span> <span class=n>ThreadMode</span><span class=o>.</span><span class=n>SAME</span><span class=p>:</span>
</span><span id=__span-0-492><a id=__codelineno-0-492 name=__codelineno-0-492></a>            <span class=k>pass</span>
</span><span id=__span-0-493><a id=__codelineno-0-493 name=__codelineno-0-493></a>        <span class=k>elif</span> <span class=n>thread_mode</span> <span class=o>==</span> <span class=n>ThreadMode</span><span class=o>.</span><span class=n>FORK</span><span class=p>:</span>
</span><span id=__span-0-494><a id=__codelineno-0-494 name=__codelineno-0-494></a>            <span class=n>child_thread_id</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>threads_fork</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_thread_id</span><span class=p>)</span><span class=o>.</span><span class=n>id</span>
</span><span id=__span-0-495><a id=__codelineno-0-495 name=__codelineno-0-495></a>            <span class=bp>self</span><span class=o>.</span><span class=n>add_system_log</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Forked thread </span><span class=si>{</span><span class=n>child_thread_id</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>logging</span><span class=o>.</span><span class=n>INFO</span><span class=p>)</span>
</span><span id=__span-0-496><a id=__codelineno-0-496 name=__codelineno-0-496></a>        <span class=k>elif</span> <span class=n>thread_mode</span> <span class=o>==</span> <span class=n>ThreadMode</span><span class=o>.</span><span class=n>CHILD</span><span class=p>:</span>
</span><span id=__span-0-497><a id=__codelineno-0-497 name=__codelineno-0-497></a>            <span class=n>child_thread_id</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>create_subthread</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_thread_id</span><span class=p>)</span><span class=o>.</span><span class=n>id</span>
</span><span id=__span-0-498><a id=__codelineno-0-498 name=__codelineno-0-498></a>            <span class=bp>self</span><span class=o>.</span><span class=n>add_system_log</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Created subthread </span><span class=si>{</span><span class=n>child_thread_id</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>logging</span><span class=o>.</span><span class=n>INFO</span><span class=p>)</span>
</span><span id=__span-0-499><a id=__codelineno-0-499 name=__codelineno-0-499></a>
</span><span id=__span-0-500><a id=__codelineno-0-500 name=__codelineno-0-500></a>        <span class=k>if</span> <span class=n>query</span><span class=p>:</span>
</span><span id=__span-0-501><a id=__codelineno-0-501 name=__codelineno-0-501></a>            <span class=n>client</span><span class=o>.</span><span class=n>threads_messages_create</span><span class=p>(</span><span class=n>thread_id</span><span class=o>=</span><span class=n>child_thread_id</span><span class=p>,</span> <span class=n>content</span><span class=o>=</span><span class=n>query</span><span class=p>,</span> <span class=n>role</span><span class=o>=</span><span class=s2>&quot;user&quot;</span><span class=p>)</span>
</span><span id=__span-0-502><a id=__codelineno-0-502 name=__codelineno-0-502></a>
</span><span id=__span-0-503><a id=__codelineno-0-503 name=__codelineno-0-503></a>        <span class=bp>self</span><span class=o>.</span><span class=n>add_system_log</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Running agent </span><span class=si>{</span><span class=n>agent_id</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>logging</span><span class=o>.</span><span class=n>INFO</span><span class=p>)</span>
</span><span id=__span-0-504><a id=__codelineno-0-504 name=__codelineno-0-504></a>        <span class=n>client</span><span class=o>.</span><span class=n>run_agent</span><span class=p>(</span>
</span><span id=__span-0-505><a id=__codelineno-0-505 name=__codelineno-0-505></a>            <span class=n>parent_run_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_run_id</span><span class=p>,</span>
</span><span id=__span-0-506><a id=__codelineno-0-506 name=__codelineno-0-506></a>            <span class=n>run_on_thread_id</span><span class=o>=</span><span class=n>child_thread_id</span><span class=p>,</span>
</span><span id=__span-0-507><a id=__codelineno-0-507 name=__codelineno-0-507></a>            <span class=n>assistant_id</span><span class=o>=</span><span class=n>agent_id</span><span class=p>,</span>
</span><span id=__span-0-508><a id=__codelineno-0-508 name=__codelineno-0-508></a>            <span class=n>run_mode</span><span class=o>=</span><span class=n>run_mode</span><span class=p>,</span>
</span><span id=__span-0-509><a id=__codelineno-0-509 name=__codelineno-0-509></a>        <span class=p>)</span>
</span><span id=__span-0-510><a id=__codelineno-0-510 name=__codelineno-0-510></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_pending_ext_agent</span> <span class=o>=</span> <span class=kc>True</span>
</span><span id=__span-0-511><a id=__codelineno-0-511 name=__codelineno-0-511></a>
</span><span id=__span-0-512><a id=__codelineno-0-512 name=__codelineno-0-512></a>        <span class=k>return</span> <span class=n>child_thread_id</span>
</span><span id=__span-0-513><a id=__codelineno-0-513 name=__codelineno-0-513></a>
</span><span id=__span-0-514><a id=__codelineno-0-514 name=__codelineno-0-514></a>    <span class=bp>self</span><span class=o>.</span><span class=n>run_agent</span> <span class=o>=</span> <span class=n>run_agent</span>
</span><span id=__span-0-515><a id=__codelineno-0-515 name=__codelineno-0-515></a>
</span><span id=__span-0-516><a id=__codelineno-0-516 name=__codelineno-0-516></a>    <span class=k>def</span><span class=w> </span><span class=nf>schedule_run</span><span class=p>(</span>
</span><span id=__span-0-517><a id=__codelineno-0-517 name=__codelineno-0-517></a>        <span class=n>agent</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-518><a id=__codelineno-0-518 name=__codelineno-0-518></a>        <span class=n>input_message</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-519><a id=__codelineno-0-519 name=__codelineno-0-519></a>        <span class=n>run_at</span><span class=p>:</span> <span class=n>datetime</span><span class=p>,</span>
</span><span id=__span-0-520><a id=__codelineno-0-520 name=__codelineno-0-520></a>        <span class=n>run_params</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-521><a id=__codelineno-0-521 name=__codelineno-0-521></a>        <span class=n>thread_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-522><a id=__codelineno-0-522 name=__codelineno-0-522></a>    <span class=p>):</span>
</span><span id=__span-0-523><a id=__codelineno-0-523 name=__codelineno-0-523></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Schedules a run.&quot;&quot;&quot;</span>
</span><span id=__span-0-524><a id=__codelineno-0-524 name=__codelineno-0-524></a>        <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>schedule_run</span><span class=p>(</span><span class=n>agent</span><span class=p>,</span> <span class=n>input_message</span><span class=p>,</span> <span class=n>thread_id</span><span class=p>,</span> <span class=n>run_params</span><span class=p>,</span> <span class=n>run_at</span><span class=p>)</span>
</span><span id=__span-0-525><a id=__codelineno-0-525 name=__codelineno-0-525></a>
</span><span id=__span-0-526><a id=__codelineno-0-526 name=__codelineno-0-526></a>    <span class=bp>self</span><span class=o>.</span><span class=n>schedule_run</span> <span class=o>=</span> <span class=n>schedule_run</span>
</span><span id=__span-0-527><a id=__codelineno-0-527 name=__codelineno-0-527></a>
</span><span id=__span-0-528><a id=__codelineno-0-528 name=__codelineno-0-528></a>    <span class=c1># TODO(https://github.com/nearai/nearai/issues/549): Allow only a subset of agents to access/update user memory.</span>
</span><span id=__span-0-529><a id=__codelineno-0-529 name=__codelineno-0-529></a>    <span class=k>def</span><span class=w> </span><span class=nf>add_user_memory</span><span class=p>(</span><span class=n>memory</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-530><a id=__codelineno-0-530 name=__codelineno-0-530></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Add user memory.&quot;&quot;&quot;</span>
</span><span id=__span-0-531><a id=__codelineno-0-531 name=__codelineno-0-531></a>        <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>add_user_memory</span><span class=p>(</span><span class=n>memory</span><span class=p>)</span>
</span><span id=__span-0-532><a id=__codelineno-0-532 name=__codelineno-0-532></a>
</span><span id=__span-0-533><a id=__codelineno-0-533 name=__codelineno-0-533></a>    <span class=bp>self</span><span class=o>.</span><span class=n>add_user_memory</span> <span class=o>=</span> <span class=n>add_user_memory</span>
</span><span id=__span-0-534><a id=__codelineno-0-534 name=__codelineno-0-534></a>
</span><span id=__span-0-535><a id=__codelineno-0-535 name=__codelineno-0-535></a>    <span class=k>def</span><span class=w> </span><span class=nf>query_user_memory</span><span class=p>(</span><span class=n>query</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-536><a id=__codelineno-0-536 name=__codelineno-0-536></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Query user memory.&quot;&quot;&quot;</span>
</span><span id=__span-0-537><a id=__codelineno-0-537 name=__codelineno-0-537></a>        <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>query_user_memory</span><span class=p>(</span><span class=n>query</span><span class=p>)</span>
</span><span id=__span-0-538><a id=__codelineno-0-538 name=__codelineno-0-538></a>
</span><span id=__span-0-539><a id=__codelineno-0-539 name=__codelineno-0-539></a>    <span class=bp>self</span><span class=o>.</span><span class=n>query_user_memory</span> <span class=o>=</span> <span class=n>query_user_memory</span>
</span><span id=__span-0-540><a id=__codelineno-0-540 name=__codelineno-0-540></a>
</span><span id=__span-0-541><a id=__codelineno-0-541 name=__codelineno-0-541></a>    <span class=k>def</span><span class=w> </span><span class=nf>generate_image</span><span class=p>(</span><span class=n>prompt</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-542><a id=__codelineno-0-542 name=__codelineno-0-542></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Generate an image.&quot;&quot;&quot;</span>
</span><span id=__span-0-543><a id=__codelineno-0-543 name=__codelineno-0-543></a>        <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>generate_image</span><span class=p>(</span><span class=n>prompt</span><span class=p>)</span>
</span><span id=__span-0-544><a id=__codelineno-0-544 name=__codelineno-0-544></a>
</span><span id=__span-0-545><a id=__codelineno-0-545 name=__codelineno-0-545></a>    <span class=bp>self</span><span class=o>.</span><span class=n>generate_image</span> <span class=o>=</span> <span class=n>generate_image</span>
</span><span id=__span-0-546><a id=__codelineno-0-546 name=__codelineno-0-546></a>
</span><span id=__span-0-547><a id=__codelineno-0-547 name=__codelineno-0-547></a>    <span class=k>def</span><span class=w> </span><span class=nf>save_agent_data</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]):</span>
</span><span id=__span-0-548><a id=__codelineno-0-548 name=__codelineno-0-548></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Save agent data.&quot;&quot;&quot;</span>
</span><span id=__span-0-549><a id=__codelineno-0-549 name=__codelineno-0-549></a>        <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>save_agent_data</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>data</span><span class=p>)</span>
</span><span id=__span-0-550><a id=__codelineno-0-550 name=__codelineno-0-550></a>
</span><span id=__span-0-551><a id=__codelineno-0-551 name=__codelineno-0-551></a>    <span class=bp>self</span><span class=o>.</span><span class=n>save_agent_data</span> <span class=o>=</span> <span class=n>save_agent_data</span>
</span><span id=__span-0-552><a id=__codelineno-0-552 name=__codelineno-0-552></a>
</span><span id=__span-0-553><a id=__codelineno-0-553 name=__codelineno-0-553></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_agent_data</span><span class=p>():</span>
</span><span id=__span-0-554><a id=__codelineno-0-554 name=__codelineno-0-554></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Get agent data.&quot;&quot;&quot;</span>
</span><span id=__span-0-555><a id=__codelineno-0-555 name=__codelineno-0-555></a>        <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>get_agent_data</span><span class=p>()</span>
</span><span id=__span-0-556><a id=__codelineno-0-556 name=__codelineno-0-556></a>
</span><span id=__span-0-557><a id=__codelineno-0-557 name=__codelineno-0-557></a>    <span class=bp>self</span><span class=o>.</span><span class=n>get_agent_data</span> <span class=o>=</span> <span class=n>get_agent_data</span>
</span><span id=__span-0-558><a id=__codelineno-0-558 name=__codelineno-0-558></a>
</span><span id=__span-0-559><a id=__codelineno-0-559 name=__codelineno-0-559></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_agent_data_by_key</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span><span id=__span-0-560><a id=__codelineno-0-560 name=__codelineno-0-560></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Get agent data by key.&quot;&quot;&quot;</span>
</span><span id=__span-0-561><a id=__codelineno-0-561 name=__codelineno-0-561></a>        <span class=n>namespace</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_primary_agent</span><span class=p>()</span><span class=o>.</span><span class=n>namespace</span>
</span><span id=__span-0-562><a id=__codelineno-0-562 name=__codelineno-0-562></a>        <span class=n>name</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_primary_agent</span><span class=p>()</span><span class=o>.</span><span class=n>name</span>
</span><span id=__span-0-563><a id=__codelineno-0-563 name=__codelineno-0-563></a>        <span class=n>result</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>get_agent_data_by_key</span><span class=p>(</span><span class=n>key</span><span class=p>)</span>
</span><span id=__span-0-564><a id=__codelineno-0-564 name=__codelineno-0-564></a>        <span class=k>return</span> <span class=p>(</span>
</span><span id=__span-0-565><a id=__codelineno-0-565 name=__codelineno-0-565></a>            <span class=n>result</span>
</span><span id=__span-0-566><a id=__codelineno-0-566 name=__codelineno-0-566></a>            <span class=k>if</span> <span class=n>result</span>
</span><span id=__span-0-567><a id=__codelineno-0-567 name=__codelineno-0-567></a>            <span class=k>else</span> <span class=p>{</span>
</span><span id=__span-0-568><a id=__codelineno-0-568 name=__codelineno-0-568></a>                <span class=s2>&quot;value&quot;</span><span class=p>:</span> <span class=n>default</span><span class=p>,</span>
</span><span id=__span-0-569><a id=__codelineno-0-569 name=__codelineno-0-569></a>                <span class=s2>&quot;namespace&quot;</span><span class=p>:</span> <span class=n>namespace</span><span class=p>,</span>
</span><span id=__span-0-570><a id=__codelineno-0-570 name=__codelineno-0-570></a>                <span class=s2>&quot;key&quot;</span><span class=p>:</span> <span class=n>key</span><span class=p>,</span>
</span><span id=__span-0-571><a id=__codelineno-0-571 name=__codelineno-0-571></a>                <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=n>name</span><span class=p>,</span>
</span><span id=__span-0-572><a id=__codelineno-0-572 name=__codelineno-0-572></a>                <span class=s2>&quot;updated_at&quot;</span><span class=p>:</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-573><a id=__codelineno-0-573 name=__codelineno-0-573></a>                <span class=s2>&quot;created_at&quot;</span><span class=p>:</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-574><a id=__codelineno-0-574 name=__codelineno-0-574></a>            <span class=p>}</span>
</span><span id=__span-0-575><a id=__codelineno-0-575 name=__codelineno-0-575></a>        <span class=p>)</span>
</span><span id=__span-0-576><a id=__codelineno-0-576 name=__codelineno-0-576></a>
</span><span id=__span-0-577><a id=__codelineno-0-577 name=__codelineno-0-577></a>    <span class=bp>self</span><span class=o>.</span><span class=n>get_agent_data_by_key</span> <span class=o>=</span> <span class=n>get_agent_data_by_key</span>
</span><span id=__span-0-578><a id=__codelineno-0-578 name=__codelineno-0-578></a>
</span><span id=__span-0-579><a id=__codelineno-0-579 name=__codelineno-0-579></a>    <span class=c1># HubClient methods</span>
</span><span id=__span-0-580><a id=__codelineno-0-580 name=__codelineno-0-580></a>    <span class=k>def</span><span class=w> </span><span class=nf>add_reply</span><span class=p>(</span>
</span><span id=__span-0-581><a id=__codelineno-0-581 name=__codelineno-0-581></a>        <span class=n>message</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-582><a id=__codelineno-0-582 name=__codelineno-0-582></a>        <span class=n>attachments</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Iterable</span><span class=p>[</span><span class=n>Attachment</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-583><a id=__codelineno-0-583 name=__codelineno-0-583></a>        <span class=n>message_type</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-584><a id=__codelineno-0-584 name=__codelineno-0-584></a>        <span class=n>thread_id</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_thread_id</span><span class=p>,</span>
</span><span id=__span-0-585><a id=__codelineno-0-585 name=__codelineno-0-585></a>    <span class=p>):</span>
</span><span id=__span-0-586><a id=__codelineno-0-586 name=__codelineno-0-586></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Assistant adds a message to the environment.&quot;&quot;&quot;</span>
</span><span id=__span-0-587><a id=__codelineno-0-587 name=__codelineno-0-587></a>        <span class=c1># NOTE: message from `user` are not stored in the memory</span>
</span><span id=__span-0-588><a id=__codelineno-0-588 name=__codelineno-0-588></a>
</span><span id=__span-0-589><a id=__codelineno-0-589 name=__codelineno-0-589></a>        <span class=k>return</span> <span class=n>hub_client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>messages</span><span class=o>.</span><span class=n>create</span><span class=p>(</span>
</span><span id=__span-0-590><a id=__codelineno-0-590 name=__codelineno-0-590></a>            <span class=n>thread_id</span><span class=o>=</span><span class=n>thread_id</span><span class=p>,</span>
</span><span id=__span-0-591><a id=__codelineno-0-591 name=__codelineno-0-591></a>            <span class=n>role</span><span class=o>=</span><span class=s2>&quot;assistant&quot;</span><span class=p>,</span>
</span><span id=__span-0-592><a id=__codelineno-0-592 name=__codelineno-0-592></a>            <span class=n>content</span><span class=o>=</span><span class=n>message</span><span class=p>,</span>
</span><span id=__span-0-593><a id=__codelineno-0-593 name=__codelineno-0-593></a>            <span class=n>extra_body</span><span class=o>=</span><span class=p>{</span>
</span><span id=__span-0-594><a id=__codelineno-0-594 name=__codelineno-0-594></a>                <span class=s2>&quot;assistant_id&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_primary_agent</span><span class=p>()</span><span class=o>.</span><span class=n>identifier</span><span class=p>,</span>
</span><span id=__span-0-595><a id=__codelineno-0-595 name=__codelineno-0-595></a>                <span class=s2>&quot;run_id&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_run_id</span><span class=p>,</span>
</span><span id=__span-0-596><a id=__codelineno-0-596 name=__codelineno-0-596></a>            <span class=p>},</span>
</span><span id=__span-0-597><a id=__codelineno-0-597 name=__codelineno-0-597></a>            <span class=n>attachments</span><span class=o>=</span><span class=n>attachments</span><span class=p>,</span>
</span><span id=__span-0-598><a id=__codelineno-0-598 name=__codelineno-0-598></a>            <span class=n>metadata</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;message_type&quot;</span><span class=p>:</span> <span class=n>message_type</span><span class=p>}</span> <span class=k>if</span> <span class=n>message_type</span> <span class=k>else</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-599><a id=__codelineno-0-599 name=__codelineno-0-599></a>        <span class=p>)</span>
</span><span id=__span-0-600><a id=__codelineno-0-600 name=__codelineno-0-600></a>
</span><span id=__span-0-601><a id=__codelineno-0-601 name=__codelineno-0-601></a>    <span class=bp>self</span><span class=o>.</span><span class=n>add_reply</span> <span class=o>=</span> <span class=n>add_reply</span>
</span><span id=__span-0-602><a id=__codelineno-0-602 name=__codelineno-0-602></a>
</span><span id=__span-0-603><a id=__codelineno-0-603 name=__codelineno-0-603></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_thread</span><span class=p>(</span><span class=n>thread_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_thread_id</span><span class=p>):</span>
</span><span id=__span-0-604><a id=__codelineno-0-604 name=__codelineno-0-604></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns the current Thread object or the requested Thread.&quot;&quot;&quot;</span>
</span><span id=__span-0-605><a id=__codelineno-0-605 name=__codelineno-0-605></a>        <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>get_thread</span><span class=p>(</span><span class=n>thread_id</span><span class=p>)</span>
</span><span id=__span-0-606><a id=__codelineno-0-606 name=__codelineno-0-606></a>
</span><span id=__span-0-607><a id=__codelineno-0-607 name=__codelineno-0-607></a>    <span class=bp>self</span><span class=o>.</span><span class=n>get_thread</span> <span class=o>=</span> <span class=n>get_thread</span>
</span><span id=__span-0-608><a id=__codelineno-0-608 name=__codelineno-0-608></a>
</span><span id=__span-0-609><a id=__codelineno-0-609 name=__codelineno-0-609></a>    <span class=k>def</span><span class=w> </span><span class=nf>_add_message</span><span class=p>(</span>
</span><span id=__span-0-610><a id=__codelineno-0-610 name=__codelineno-0-610></a>        <span class=n>role</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-611><a id=__codelineno-0-611 name=__codelineno-0-611></a>        <span class=n>message</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-612><a id=__codelineno-0-612 name=__codelineno-0-612></a>        <span class=n>attachments</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Iterable</span><span class=p>[</span><span class=n>Attachment</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-613><a id=__codelineno-0-613 name=__codelineno-0-613></a>        <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span>
</span><span id=__span-0-614><a id=__codelineno-0-614 name=__codelineno-0-614></a>    <span class=p>):</span>
</span><span id=__span-0-615><a id=__codelineno-0-615 name=__codelineno-0-615></a>        <span class=k>return</span> <span class=n>hub_client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>messages</span><span class=o>.</span><span class=n>create</span><span class=p>(</span>
</span><span id=__span-0-616><a id=__codelineno-0-616 name=__codelineno-0-616></a>            <span class=n>thread_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_thread_id</span><span class=p>,</span>
</span><span id=__span-0-617><a id=__codelineno-0-617 name=__codelineno-0-617></a>            <span class=n>role</span><span class=o>=</span><span class=n>role</span><span class=p>,</span>  <span class=c1># type: ignore</span>
</span><span id=__span-0-618><a id=__codelineno-0-618 name=__codelineno-0-618></a>            <span class=n>content</span><span class=o>=</span><span class=n>message</span><span class=p>,</span>
</span><span id=__span-0-619><a id=__codelineno-0-619 name=__codelineno-0-619></a>            <span class=n>extra_body</span><span class=o>=</span><span class=p>{</span>
</span><span id=__span-0-620><a id=__codelineno-0-620 name=__codelineno-0-620></a>                <span class=s2>&quot;assistant_id&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_primary_agent</span><span class=p>()</span><span class=o>.</span><span class=n>identifier</span><span class=p>,</span>
</span><span id=__span-0-621><a id=__codelineno-0-621 name=__codelineno-0-621></a>                <span class=s2>&quot;run_id&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_run_id</span><span class=p>,</span>
</span><span id=__span-0-622><a id=__codelineno-0-622 name=__codelineno-0-622></a>            <span class=p>},</span>
</span><span id=__span-0-623><a id=__codelineno-0-623 name=__codelineno-0-623></a>            <span class=n>metadata</span><span class=o>=</span><span class=n>kwargs</span><span class=p>,</span>
</span><span id=__span-0-624><a id=__codelineno-0-624 name=__codelineno-0-624></a>            <span class=n>attachments</span><span class=o>=</span><span class=n>attachments</span><span class=p>,</span>
</span><span id=__span-0-625><a id=__codelineno-0-625 name=__codelineno-0-625></a>        <span class=p>)</span>
</span><span id=__span-0-626><a id=__codelineno-0-626 name=__codelineno-0-626></a>
</span><span id=__span-0-627><a id=__codelineno-0-627 name=__codelineno-0-627></a>    <span class=bp>self</span><span class=o>.</span><span class=n>_add_message</span> <span class=o>=</span> <span class=n>_add_message</span>
</span><span id=__span-0-628><a id=__codelineno-0-628 name=__codelineno-0-628></a>
</span><span id=__span-0-629><a id=__codelineno-0-629 name=__codelineno-0-629></a>    <span class=k>def</span><span class=w> </span><span class=nf>_list_messages</span><span class=p>(</span>
</span><span id=__span-0-630><a id=__codelineno-0-630 name=__codelineno-0-630></a>        <span class=n>limit</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=n>NotGiven</span><span class=p>]</span> <span class=o>=</span> <span class=n>NOT_GIVEN</span><span class=p>,</span>
</span><span id=__span-0-631><a id=__codelineno-0-631 name=__codelineno-0-631></a>        <span class=n>order</span><span class=p>:</span> <span class=n>Literal</span><span class=p>[</span><span class=s2>&quot;asc&quot;</span><span class=p>,</span> <span class=s2>&quot;desc&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;asc&quot;</span><span class=p>,</span>
</span><span id=__span-0-632><a id=__codelineno-0-632 name=__codelineno-0-632></a>        <span class=n>thread_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-633><a id=__codelineno-0-633 name=__codelineno-0-633></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Message</span><span class=p>]:</span>
</span><span id=__span-0-634><a id=__codelineno-0-634 name=__codelineno-0-634></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns messages from the environment.&quot;&quot;&quot;</span>
</span><span id=__span-0-635><a id=__codelineno-0-635 name=__codelineno-0-635></a>        <span class=n>messages</span> <span class=o>=</span> <span class=n>hub_client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>messages</span><span class=o>.</span><span class=n>list</span><span class=p>(</span>
</span><span id=__span-0-636><a id=__codelineno-0-636 name=__codelineno-0-636></a>            <span class=n>thread_id</span><span class=o>=</span><span class=n>thread_id</span> <span class=ow>or</span> <span class=bp>self</span><span class=o>.</span><span class=n>_thread_id</span><span class=p>,</span> <span class=n>limit</span><span class=o>=</span><span class=n>limit</span><span class=p>,</span> <span class=n>order</span><span class=o>=</span><span class=n>order</span>
</span><span id=__span-0-637><a id=__codelineno-0-637 name=__codelineno-0-637></a>        <span class=p>)</span>
</span><span id=__span-0-638><a id=__codelineno-0-638 name=__codelineno-0-638></a>        <span class=bp>self</span><span class=o>.</span><span class=n>add_system_log</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Retrieved </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>messages</span><span class=o>.</span><span class=n>data</span><span class=p>)</span><span class=si>}</span><span class=s2> messages from NEAR AI Hub&quot;</span><span class=p>)</span>
</span><span id=__span-0-639><a id=__codelineno-0-639 name=__codelineno-0-639></a>        <span class=k>return</span> <span class=n>messages</span><span class=o>.</span><span class=n>data</span>
</span><span id=__span-0-640><a id=__codelineno-0-640 name=__codelineno-0-640></a>
</span><span id=__span-0-641><a id=__codelineno-0-641 name=__codelineno-0-641></a>    <span class=bp>self</span><span class=o>.</span><span class=n>_list_messages</span> <span class=o>=</span> <span class=n>_list_messages</span>
</span><span id=__span-0-642><a id=__codelineno-0-642 name=__codelineno-0-642></a>
</span><span id=__span-0-643><a id=__codelineno-0-643 name=__codelineno-0-643></a>    <span class=k>def</span><span class=w> </span><span class=nf>list_files_from_thread</span><span class=p>(</span>
</span><span id=__span-0-644><a id=__codelineno-0-644 name=__codelineno-0-644></a>        <span class=n>order</span><span class=p>:</span> <span class=n>Literal</span><span class=p>[</span><span class=s2>&quot;asc&quot;</span><span class=p>,</span> <span class=s2>&quot;desc&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;asc&quot;</span><span class=p>,</span> <span class=n>thread_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-645><a id=__codelineno-0-645 name=__codelineno-0-645></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>FileObject</span><span class=p>]:</span>
</span><span id=__span-0-646><a id=__codelineno-0-646 name=__codelineno-0-646></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Lists files in the thread.&quot;&quot;&quot;</span>
</span><span id=__span-0-647><a id=__codelineno-0-647 name=__codelineno-0-647></a>        <span class=n>messages</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_list_messages</span><span class=p>(</span><span class=n>order</span><span class=o>=</span><span class=n>order</span><span class=p>)</span>
</span><span id=__span-0-648><a id=__codelineno-0-648 name=__codelineno-0-648></a>        <span class=c1># Extract attachments from messages</span>
</span><span id=__span-0-649><a id=__codelineno-0-649 name=__codelineno-0-649></a>        <span class=n>attachments</span> <span class=o>=</span> <span class=p>[</span><span class=n>a</span> <span class=k>for</span> <span class=n>m</span> <span class=ow>in</span> <span class=n>messages</span> <span class=k>if</span> <span class=n>m</span><span class=o>.</span><span class=n>attachments</span> <span class=k>for</span> <span class=n>a</span> <span class=ow>in</span> <span class=n>m</span><span class=o>.</span><span class=n>attachments</span><span class=p>]</span>
</span><span id=__span-0-650><a id=__codelineno-0-650 name=__codelineno-0-650></a>        <span class=c1># Extract files from attachments</span>
</span><span id=__span-0-651><a id=__codelineno-0-651 name=__codelineno-0-651></a>        <span class=n>file_ids</span> <span class=o>=</span> <span class=p>[</span><span class=n>a</span><span class=o>.</span><span class=n>file_id</span> <span class=k>for</span> <span class=n>a</span> <span class=ow>in</span> <span class=n>attachments</span><span class=p>]</span>
</span><span id=__span-0-652><a id=__codelineno-0-652 name=__codelineno-0-652></a>        <span class=n>files</span> <span class=o>=</span> <span class=p>[</span><span class=n>hub_client</span><span class=o>.</span><span class=n>files</span><span class=o>.</span><span class=n>retrieve</span><span class=p>(</span><span class=n>f</span><span class=p>)</span> <span class=k>for</span> <span class=n>f</span> <span class=ow>in</span> <span class=n>file_ids</span> <span class=k>if</span> <span class=n>f</span><span class=p>]</span>
</span><span id=__span-0-653><a id=__codelineno-0-653 name=__codelineno-0-653></a>        <span class=k>return</span> <span class=n>files</span>
</span><span id=__span-0-654><a id=__codelineno-0-654 name=__codelineno-0-654></a>
</span><span id=__span-0-655><a id=__codelineno-0-655 name=__codelineno-0-655></a>    <span class=bp>self</span><span class=o>.</span><span class=n>list_files_from_thread</span> <span class=o>=</span> <span class=n>list_files_from_thread</span>
</span><span id=__span-0-656><a id=__codelineno-0-656 name=__codelineno-0-656></a>
</span><span id=__span-0-657><a id=__codelineno-0-657 name=__codelineno-0-657></a>    <span class=k>def</span><span class=w> </span><span class=nf>read_file_by_id</span><span class=p>(</span><span class=n>file_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-658><a id=__codelineno-0-658 name=__codelineno-0-658></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Read a file from the thread.&quot;&quot;&quot;</span>
</span><span id=__span-0-659><a id=__codelineno-0-659 name=__codelineno-0-659></a>        <span class=n>content</span> <span class=o>=</span> <span class=n>hub_client</span><span class=o>.</span><span class=n>files</span><span class=o>.</span><span class=n>content</span><span class=p>(</span><span class=n>file_id</span><span class=p>)</span><span class=o>.</span><span class=n>content</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s2>&quot;utf-8&quot;</span><span class=p>)</span>
</span><span id=__span-0-660><a id=__codelineno-0-660 name=__codelineno-0-660></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;file content returned by api&quot;</span><span class=p>,</span> <span class=n>content</span><span class=p>)</span>
</span><span id=__span-0-661><a id=__codelineno-0-661 name=__codelineno-0-661></a>        <span class=k>return</span> <span class=n>content</span>
</span><span id=__span-0-662><a id=__codelineno-0-662 name=__codelineno-0-662></a>
</span><span id=__span-0-663><a id=__codelineno-0-663 name=__codelineno-0-663></a>    <span class=bp>self</span><span class=o>.</span><span class=n>read_file_by_id</span> <span class=o>=</span> <span class=n>read_file_by_id</span>
</span><span id=__span-0-664><a id=__codelineno-0-664 name=__codelineno-0-664></a>
</span><span id=__span-0-665><a id=__codelineno-0-665 name=__codelineno-0-665></a>    <span class=k>def</span><span class=w> </span><span class=nf>write_file</span><span class=p>(</span>
</span><span id=__span-0-666><a id=__codelineno-0-666 name=__codelineno-0-666></a>        <span class=n>filename</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-667><a id=__codelineno-0-667 name=__codelineno-0-667></a>        <span class=n>content</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>bytes</span><span class=p>],</span>
</span><span id=__span-0-668><a id=__codelineno-0-668 name=__codelineno-0-668></a>        <span class=n>encoding</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;utf-8&quot;</span><span class=p>,</span>
</span><span id=__span-0-669><a id=__codelineno-0-669 name=__codelineno-0-669></a>        <span class=n>filetype</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;text/plain&quot;</span><span class=p>,</span>
</span><span id=__span-0-670><a id=__codelineno-0-670 name=__codelineno-0-670></a>        <span class=n>write_to_disk</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-671><a id=__codelineno-0-671 name=__codelineno-0-671></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>FileObject</span><span class=p>:</span>
</span><span id=__span-0-672><a id=__codelineno-0-672 name=__codelineno-0-672></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Writes a file to the environment.</span>
</span><span id=__span-0-673><a id=__codelineno-0-673 name=__codelineno-0-673></a>
</span><span id=__span-0-674><a id=__codelineno-0-674 name=__codelineno-0-674></a><span class=sd>        filename: The name of the file to write to</span>
</span><span id=__span-0-675><a id=__codelineno-0-675 name=__codelineno-0-675></a><span class=sd>        content: The content to write to the file</span>
</span><span id=__span-0-676><a id=__codelineno-0-676 name=__codelineno-0-676></a><span class=sd>        encoding: The encoding to use when writing the file (default is utf-8)</span>
</span><span id=__span-0-677><a id=__codelineno-0-677 name=__codelineno-0-677></a><span class=sd>        filetype: The MIME type of the file (default is text/plain)</span>
</span><span id=__span-0-678><a id=__codelineno-0-678 name=__codelineno-0-678></a><span class=sd>        write_to_disk: If True, write locally to disk (default is True)</span>
</span><span id=__span-0-679><a id=__codelineno-0-679 name=__codelineno-0-679></a><span class=sd>        &quot;&quot;&quot;</span>
</span><span id=__span-0-680><a id=__codelineno-0-680 name=__codelineno-0-680></a>        <span class=k>if</span> <span class=n>write_to_disk</span><span class=p>:</span>
</span><span id=__span-0-681><a id=__codelineno-0-681 name=__codelineno-0-681></a>            <span class=c1># Write locally</span>
</span><span id=__span-0-682><a id=__codelineno-0-682 name=__codelineno-0-682></a>            <span class=n>path</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>get_primary_agent_temp_dir</span><span class=p>())</span> <span class=o>/</span> <span class=n>filename</span>
</span><span id=__span-0-683><a id=__codelineno-0-683 name=__codelineno-0-683></a>            <span class=n>path</span><span class=o>.</span><span class=n>parent</span><span class=o>.</span><span class=n>mkdir</span><span class=p>(</span><span class=n>parents</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-684><a id=__codelineno-0-684 name=__codelineno-0-684></a>            <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>content</span><span class=p>,</span> <span class=nb>bytes</span><span class=p>):</span>
</span><span id=__span-0-685><a id=__codelineno-0-685 name=__codelineno-0-685></a>                <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=s2>&quot;wb&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-686><a id=__codelineno-0-686 name=__codelineno-0-686></a>                    <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>
</span><span id=__span-0-687><a id=__codelineno-0-687 name=__codelineno-0-687></a>            <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-688><a id=__codelineno-0-688 name=__codelineno-0-688></a>                <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=s2>&quot;w&quot;</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=n>encoding</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-689><a id=__codelineno-0-689 name=__codelineno-0-689></a>                    <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>
</span><span id=__span-0-690><a id=__codelineno-0-690 name=__codelineno-0-690></a>
</span><span id=__span-0-691><a id=__codelineno-0-691 name=__codelineno-0-691></a>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>content</span><span class=p>,</span> <span class=nb>bytes</span><span class=p>):</span>
</span><span id=__span-0-692><a id=__codelineno-0-692 name=__codelineno-0-692></a>            <span class=n>file_data</span> <span class=o>=</span> <span class=n>content</span>
</span><span id=__span-0-693><a id=__codelineno-0-693 name=__codelineno-0-693></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-694><a id=__codelineno-0-694 name=__codelineno-0-694></a>            <span class=n>file_data</span> <span class=o>=</span> <span class=n>io</span><span class=o>.</span><span class=n>BytesIO</span><span class=p>(</span><span class=n>content</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=n>encoding</span><span class=p>))</span>  <span class=c1># type:ignore</span>
</span><span id=__span-0-695><a id=__codelineno-0-695 name=__codelineno-0-695></a>
</span><span id=__span-0-696><a id=__codelineno-0-696 name=__codelineno-0-696></a>        <span class=c1># Upload to Hub</span>
</span><span id=__span-0-697><a id=__codelineno-0-697 name=__codelineno-0-697></a>        <span class=n>file</span> <span class=o>=</span> <span class=n>hub_client</span><span class=o>.</span><span class=n>files</span><span class=o>.</span><span class=n>create</span><span class=p>(</span><span class=n>file</span><span class=o>=</span><span class=p>(</span><span class=n>filename</span><span class=p>,</span> <span class=n>file_data</span><span class=p>,</span> <span class=n>filetype</span><span class=p>),</span> <span class=n>purpose</span><span class=o>=</span><span class=s2>&quot;assistants&quot;</span><span class=p>)</span>
</span><span id=__span-0-698><a id=__codelineno-0-698 name=__codelineno-0-698></a>        <span class=n>res</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>add_reply</span><span class=p>(</span>
</span><span id=__span-0-699><a id=__codelineno-0-699 name=__codelineno-0-699></a>            <span class=n>message</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;Successfully wrote </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>content</span><span class=p>)</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=n>content</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=mi>0</span><span class=si>}</span><span class=s2> characters to </span><span class=si>{</span><span class=n>filename</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-0-700><a id=__codelineno-0-700 name=__codelineno-0-700></a>            <span class=n>attachments</span><span class=o>=</span><span class=p>[{</span><span class=s2>&quot;file_id&quot;</span><span class=p>:</span> <span class=n>file</span><span class=o>.</span><span class=n>id</span><span class=p>,</span> <span class=s2>&quot;tools&quot;</span><span class=p>:</span> <span class=p>[{</span><span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;file_search&quot;</span><span class=p>}]}],</span>
</span><span id=__span-0-701><a id=__codelineno-0-701 name=__codelineno-0-701></a>            <span class=n>message_type</span><span class=o>=</span><span class=s2>&quot;system:file_write&quot;</span><span class=p>,</span>
</span><span id=__span-0-702><a id=__codelineno-0-702 name=__codelineno-0-702></a>        <span class=p>)</span>
</span><span id=__span-0-703><a id=__codelineno-0-703 name=__codelineno-0-703></a>        <span class=bp>self</span><span class=o>.</span><span class=n>add_system_log</span><span class=p>(</span>
</span><span id=__span-0-704><a id=__codelineno-0-704 name=__codelineno-0-704></a>            <span class=sa>f</span><span class=s2>&quot;Uploaded file </span><span class=si>{</span><span class=n>filename</span><span class=si>}</span><span class=s2> with </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>content</span><span class=p>)</span><span class=si>}</span><span class=s2> characters, id: </span><span class=si>{</span><span class=n>file</span><span class=o>.</span><span class=n>id</span><span class=si>}</span><span class=s2>. Added in thread as: </span><span class=si>{</span><span class=n>res</span><span class=o>.</span><span class=n>id</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-705><a id=__codelineno-0-705 name=__codelineno-0-705></a>        <span class=p>)</span>
</span><span id=__span-0-706><a id=__codelineno-0-706 name=__codelineno-0-706></a>        <span class=k>return</span> <span class=n>file</span>
</span><span id=__span-0-707><a id=__codelineno-0-707 name=__codelineno-0-707></a>
</span><span id=__span-0-708><a id=__codelineno-0-708 name=__codelineno-0-708></a>    <span class=bp>self</span><span class=o>.</span><span class=n>write_file</span> <span class=o>=</span> <span class=n>write_file</span>
</span><span id=__span-0-709><a id=__codelineno-0-709 name=__codelineno-0-709></a>
</span><span id=__span-0-710><a id=__codelineno-0-710 name=__codelineno-0-710></a>    <span class=k>def</span><span class=w> </span><span class=nf>mark_done</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n>Run</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-711><a id=__codelineno-0-711 name=__codelineno-0-711></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_done</span> <span class=o>=</span> <span class=kc>True</span>
</span><span id=__span-0-712><a id=__codelineno-0-712 name=__codelineno-0-712></a>        <span class=n>res</span> <span class=o>=</span> <span class=n>hub_client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>runs</span><span class=o>.</span><span class=n>update</span><span class=p>(</span>
</span><span id=__span-0-713><a id=__codelineno-0-713 name=__codelineno-0-713></a>            <span class=n>thread_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_thread_id</span><span class=p>,</span>
</span><span id=__span-0-714><a id=__codelineno-0-714 name=__codelineno-0-714></a>            <span class=n>run_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_run_id</span><span class=p>,</span>
</span><span id=__span-0-715><a id=__codelineno-0-715 name=__codelineno-0-715></a>            <span class=n>extra_body</span><span class=o>=</span><span class=p>{</span>
</span><span id=__span-0-716><a id=__codelineno-0-716 name=__codelineno-0-716></a>                <span class=s2>&quot;status&quot;</span><span class=p>:</span> <span class=s2>&quot;completed&quot;</span><span class=p>,</span>
</span><span id=__span-0-717><a id=__codelineno-0-717 name=__codelineno-0-717></a>                <span class=s2>&quot;completed_at&quot;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>(),</span>
</span><span id=__span-0-718><a id=__codelineno-0-718 name=__codelineno-0-718></a>            <span class=p>},</span>
</span><span id=__span-0-719><a id=__codelineno-0-719 name=__codelineno-0-719></a>        <span class=p>)</span>
</span><span id=__span-0-720><a id=__codelineno-0-720 name=__codelineno-0-720></a>        <span class=k>return</span> <span class=n>res</span>
</span><span id=__span-0-721><a id=__codelineno-0-721 name=__codelineno-0-721></a>
</span><span id=__span-0-722><a id=__codelineno-0-722 name=__codelineno-0-722></a>    <span class=bp>self</span><span class=o>.</span><span class=n>mark_done</span> <span class=o>=</span> <span class=n>mark_done</span>
</span><span id=__span-0-723><a id=__codelineno-0-723 name=__codelineno-0-723></a>
</span><span id=__span-0-724><a id=__codelineno-0-724 name=__codelineno-0-724></a>    <span class=k>def</span><span class=w> </span><span class=nf>mark_failed</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n>Run</span><span class=p>:</span>
</span><span id=__span-0-725><a id=__codelineno-0-725 name=__codelineno-0-725></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Marks the environment run as failed.&quot;&quot;&quot;</span>
</span><span id=__span-0-726><a id=__codelineno-0-726 name=__codelineno-0-726></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_done</span> <span class=o>=</span> <span class=kc>True</span>
</span><span id=__span-0-727><a id=__codelineno-0-727 name=__codelineno-0-727></a>        <span class=bp>self</span><span class=o>.</span><span class=n>add_system_log</span><span class=p>(</span><span class=s2>&quot;Environment run failed&quot;</span><span class=p>,</span> <span class=n>logging</span><span class=o>.</span><span class=n>ERROR</span><span class=p>)</span>
</span><span id=__span-0-728><a id=__codelineno-0-728 name=__codelineno-0-728></a>        <span class=n>res</span> <span class=o>=</span> <span class=n>hub_client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>runs</span><span class=o>.</span><span class=n>update</span><span class=p>(</span>
</span><span id=__span-0-729><a id=__codelineno-0-729 name=__codelineno-0-729></a>            <span class=n>thread_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_thread_id</span><span class=p>,</span>
</span><span id=__span-0-730><a id=__codelineno-0-730 name=__codelineno-0-730></a>            <span class=n>run_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_run_id</span><span class=p>,</span>
</span><span id=__span-0-731><a id=__codelineno-0-731 name=__codelineno-0-731></a>            <span class=n>extra_body</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;status&quot;</span><span class=p>:</span> <span class=s2>&quot;failed&quot;</span><span class=p>,</span> <span class=s2>&quot;failed_at&quot;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()},</span>
</span><span id=__span-0-732><a id=__codelineno-0-732 name=__codelineno-0-732></a>        <span class=p>)</span>
</span><span id=__span-0-733><a id=__codelineno-0-733 name=__codelineno-0-733></a>        <span class=k>return</span> <span class=n>res</span>
</span><span id=__span-0-734><a id=__codelineno-0-734 name=__codelineno-0-734></a>
</span><span id=__span-0-735><a id=__codelineno-0-735 name=__codelineno-0-735></a>    <span class=bp>self</span><span class=o>.</span><span class=n>mark_failed</span> <span class=o>=</span> <span class=n>mark_failed</span>
</span><span id=__span-0-736><a id=__codelineno-0-736 name=__codelineno-0-736></a>
</span><span id=__span-0-737><a id=__codelineno-0-737 name=__codelineno-0-737></a>    <span class=k>def</span><span class=w> </span><span class=nf>request_user_input</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n>Run</span><span class=p>:</span>
</span><span id=__span-0-738><a id=__codelineno-0-738 name=__codelineno-0-738></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Must be called to request input from the user.&quot;&quot;&quot;</span>
</span><span id=__span-0-739><a id=__codelineno-0-739 name=__codelineno-0-739></a>        <span class=k>return</span> <span class=n>hub_client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>runs</span><span class=o>.</span><span class=n>update</span><span class=p>(</span>
</span><span id=__span-0-740><a id=__codelineno-0-740 name=__codelineno-0-740></a>            <span class=n>thread_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_thread_id</span><span class=p>,</span>
</span><span id=__span-0-741><a id=__codelineno-0-741 name=__codelineno-0-741></a>            <span class=n>run_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_run_id</span><span class=p>,</span>
</span><span id=__span-0-742><a id=__codelineno-0-742 name=__codelineno-0-742></a>            <span class=n>extra_body</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;status&quot;</span><span class=p>:</span> <span class=s2>&quot;requires_action&quot;</span><span class=p>,</span> <span class=s2>&quot;required_action&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;user_input&quot;</span><span class=p>}},</span>
</span><span id=__span-0-743><a id=__codelineno-0-743 name=__codelineno-0-743></a>        <span class=p>)</span>
</span><span id=__span-0-744><a id=__codelineno-0-744 name=__codelineno-0-744></a>
</span><span id=__span-0-745><a id=__codelineno-0-745 name=__codelineno-0-745></a>    <span class=bp>self</span><span class=o>.</span><span class=n>request_user_input</span> <span class=o>=</span> <span class=n>request_user_input</span>
</span><span id=__span-0-746><a id=__codelineno-0-746 name=__codelineno-0-746></a>
</span><span id=__span-0-747><a id=__codelineno-0-747 name=__codelineno-0-747></a>    <span class=k>def</span><span class=w> </span><span class=nf>request_agent_input</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n>Run</span><span class=p>:</span>
</span><span id=__span-0-748><a id=__codelineno-0-748 name=__codelineno-0-748></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Mark the run as ready for input from another agent.&quot;&quot;&quot;</span>
</span><span id=__span-0-749><a id=__codelineno-0-749 name=__codelineno-0-749></a>        <span class=k>return</span> <span class=n>hub_client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>runs</span><span class=o>.</span><span class=n>update</span><span class=p>(</span>
</span><span id=__span-0-750><a id=__codelineno-0-750 name=__codelineno-0-750></a>            <span class=n>thread_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_thread_id</span><span class=p>,</span>
</span><span id=__span-0-751><a id=__codelineno-0-751 name=__codelineno-0-751></a>            <span class=n>run_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_run_id</span><span class=p>,</span>
</span><span id=__span-0-752><a id=__codelineno-0-752 name=__codelineno-0-752></a>            <span class=n>extra_body</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;status&quot;</span><span class=p>:</span> <span class=s2>&quot;requires_action&quot;</span><span class=p>,</span> <span class=s2>&quot;required_action&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;agent_input&quot;</span><span class=p>}},</span>
</span><span id=__span-0-753><a id=__codelineno-0-753 name=__codelineno-0-753></a>        <span class=p>)</span>
</span><span id=__span-0-754><a id=__codelineno-0-754 name=__codelineno-0-754></a>
</span><span id=__span-0-755><a id=__codelineno-0-755 name=__codelineno-0-755></a>    <span class=bp>self</span><span class=o>.</span><span class=n>request_agent_input</span> <span class=o>=</span> <span class=n>request_agent_input</span>
</span><span id=__span-0-756><a id=__codelineno-0-756 name=__codelineno-0-756></a>
</span><span id=__span-0-757><a id=__codelineno-0-757 name=__codelineno-0-757></a>    <span class=c1># Must be placed after method definitions</span>
</span><span id=__span-0-758><a id=__codelineno-0-758 name=__codelineno-0-758></a>    <span class=bp>self</span><span class=o>.</span><span class=n>register_standard_tools</span><span class=p>()</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.environment.Environment.add_agent_log class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">add_agent_log</span> <a href=#nearai.agents.environment.Environment.add_agent_log class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>add_agent_log</span><span class=p>(</span><span class=n>log</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>level</span><span class=p>:</span> <span class=n>int</span> <span class=o>=</span> <span class=n><span title=logging.INFO>INFO</span></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Add agent log with timestamp and log level.</p> <details class=quote> <summary>Source code in <code>nearai/agents/environment.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-826>826</a></span>
<span class=normal><a href=#__codelineno-0-827>827</a></span>
<span class=normal><a href=#__codelineno-0-828>828</a></span>
<span class=normal><a href=#__codelineno-0-829>829</a></span>
<span class=normal><a href=#__codelineno-0-830>830</a></span>
<span class=normal><a href=#__codelineno-0-831>831</a></span>
<span class=normal><a href=#__codelineno-0-832>832</a></span>
<span class=normal><a href=#__codelineno-0-833>833</a></span>
<span class=normal><a href=#__codelineno-0-834>834</a></span>
<span class=normal><a href=#__codelineno-0-835>835</a></span>
<span class=normal><a href=#__codelineno-0-836>836</a></span>
<span class=normal><a href=#__codelineno-0-837>837</a></span>
<span class=normal><a href=#__codelineno-0-838>838</a></span>
<span class=normal><a href=#__codelineno-0-839>839</a></span>
<span class=normal><a href=#__codelineno-0-840>840</a></span>
<span class=normal><a href=#__codelineno-0-841>841</a></span>
<span class=normal><a href=#__codelineno-0-842>842</a></span>
<span class=normal><a href=#__codelineno-0-843>843</a></span>
<span class=normal><a href=#__codelineno-0-844>844</a></span>
<span class=normal><a href=#__codelineno-0-845>845</a></span>
<span class=normal><a href=#__codelineno-0-846>846</a></span>
<span class=normal><a href=#__codelineno-0-847>847</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-826><a id=__codelineno-0-826 name=__codelineno-0-826></a><span class=k>def</span><span class=w> </span><span class=nf>add_agent_log</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>log</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>level</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>INFO</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-827><a id=__codelineno-0-827 name=__codelineno-0-827></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Add agent log with timestamp and log level.&quot;&quot;&quot;</span>
</span><span id=__span-0-828><a id=__codelineno-0-828 name=__codelineno-0-828></a>    <span class=n>logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=s2>&quot;agent_logger&quot;</span><span class=p>)</span>
</span><span id=__span-0-829><a id=__codelineno-0-829 name=__codelineno-0-829></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>logger</span><span class=o>.</span><span class=n>handlers</span><span class=p>:</span>
</span><span id=__span-0-830><a id=__codelineno-0-830 name=__codelineno-0-830></a>        <span class=c1># Configure the logger if it hasn&#39;t been set up yet</span>
</span><span id=__span-0-831><a id=__codelineno-0-831 name=__codelineno-0-831></a>        <span class=n>logger</span><span class=o>.</span><span class=n>setLevel</span><span class=p>(</span><span class=n>logging</span><span class=o>.</span><span class=n>DEBUG</span><span class=p>)</span>
</span><span id=__span-0-832><a id=__codelineno-0-832 name=__codelineno-0-832></a>        <span class=n>file_handler</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>FileHandler</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_path</span><span class=p>,</span> <span class=n>AGENT_LOG_FILENAME</span><span class=p>))</span>
</span><span id=__span-0-833><a id=__codelineno-0-833 name=__codelineno-0-833></a>        <span class=n>formatter</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>Formatter</span><span class=p>(</span><span class=s2>&quot;</span><span class=si>%(asctime)s</span><span class=s2> - </span><span class=si>%(levelname)s</span><span class=s2> - </span><span class=si>%(message)s</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>datefmt</span><span class=o>=</span><span class=s2>&quot;%Y-%m-</span><span class=si>%d</span><span class=s2> %H:%M:%S&quot;</span><span class=p>)</span>
</span><span id=__span-0-834><a id=__codelineno-0-834 name=__codelineno-0-834></a>        <span class=n>file_handler</span><span class=o>.</span><span class=n>setFormatter</span><span class=p>(</span><span class=n>formatter</span><span class=p>)</span>
</span><span id=__span-0-835><a id=__codelineno-0-835 name=__codelineno-0-835></a>        <span class=n>logger</span><span class=o>.</span><span class=n>addHandler</span><span class=p>(</span><span class=n>file_handler</span><span class=p>)</span>
</span><span id=__span-0-836><a id=__codelineno-0-836 name=__codelineno-0-836></a>
</span><span id=__span-0-837><a id=__codelineno-0-837 name=__codelineno-0-837></a>        <span class=c1># Add Thread log handler</span>
</span><span id=__span-0-838><a id=__codelineno-0-838 name=__codelineno-0-838></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_debug_mode</span><span class=p>:</span>
</span><span id=__span-0-839><a id=__codelineno-0-839 name=__codelineno-0-839></a>            <span class=n>custom_handler</span> <span class=o>=</span> <span class=n>CustomLogHandler</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>add_reply</span><span class=p>,</span> <span class=s2>&quot;agent&quot;</span><span class=p>)</span>
</span><span id=__span-0-840><a id=__codelineno-0-840 name=__codelineno-0-840></a>            <span class=n>custom_handler</span><span class=o>.</span><span class=n>setFormatter</span><span class=p>(</span><span class=n>formatter</span><span class=p>)</span>
</span><span id=__span-0-841><a id=__codelineno-0-841 name=__codelineno-0-841></a>            <span class=n>logger</span><span class=o>.</span><span class=n>addHandler</span><span class=p>(</span><span class=n>custom_handler</span><span class=p>)</span>
</span><span id=__span-0-842><a id=__codelineno-0-842 name=__codelineno-0-842></a>
</span><span id=__span-0-843><a id=__codelineno-0-843 name=__codelineno-0-843></a>    <span class=c1># Log the message</span>
</span><span id=__span-0-844><a id=__codelineno-0-844 name=__codelineno-0-844></a>    <span class=n>logger</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=n>level</span><span class=p>,</span> <span class=n>log</span><span class=p>)</span>
</span><span id=__span-0-845><a id=__codelineno-0-845 name=__codelineno-0-845></a>    <span class=c1># Force the handler to write to disk</span>
</span><span id=__span-0-846><a id=__codelineno-0-846 name=__codelineno-0-846></a>    <span class=k>for</span> <span class=n>handler</span> <span class=ow>in</span> <span class=n>logger</span><span class=o>.</span><span class=n>handlers</span><span class=p>:</span>
</span><span id=__span-0-847><a id=__codelineno-0-847 name=__codelineno-0-847></a>        <span class=n>handler</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.environment.Environment.add_agent_start_system_log class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">add_agent_start_system_log</span> <a href=#nearai.agents.environment.Environment.add_agent_start_system_log class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>add_agent_start_system_log</span><span class=p>(</span><span class=n>agent_idx</span><span class=p>:</span> <span class=n>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Adds agent start system log.</p> <details class=quote> <summary>Source code in <code>nearai/agents/environment.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-849>849</a></span>
<span class=normal><a href=#__codelineno-0-850>850</a></span>
<span class=normal><a href=#__codelineno-0-851>851</a></span>
<span class=normal><a href=#__codelineno-0-852>852</a></span>
<span class=normal><a href=#__codelineno-0-853>853</a></span>
<span class=normal><a href=#__codelineno-0-854>854</a></span>
<span class=normal><a href=#__codelineno-0-855>855</a></span>
<span class=normal><a href=#__codelineno-0-856>856</a></span>
<span class=normal><a href=#__codelineno-0-857>857</a></span>
<span class=normal><a href=#__codelineno-0-858>858</a></span>
<span class=normal><a href=#__codelineno-0-859>859</a></span>
<span class=normal><a href=#__codelineno-0-860>860</a></span>
<span class=normal><a href=#__codelineno-0-861>861</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-849><a id=__codelineno-0-849 name=__codelineno-0-849></a><span class=k>def</span><span class=w> </span><span class=nf>add_agent_start_system_log</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>agent_idx</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-850><a id=__codelineno-0-850 name=__codelineno-0-850></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Adds agent start system log.&quot;&quot;&quot;</span>
</span><span id=__span-0-851><a id=__codelineno-0-851 name=__codelineno-0-851></a>    <span class=n>agent</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_agents</span><span class=p>[</span><span class=n>agent_idx</span><span class=p>]</span>
</span><span id=__span-0-852><a id=__codelineno-0-852 name=__codelineno-0-852></a>    <span class=n>message</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;Running agent </span><span class=si>{</span><span class=n>agent</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-853><a id=__codelineno-0-853 name=__codelineno-0-853></a>    <span class=k>if</span> <span class=n>agent</span><span class=o>.</span><span class=n>model</span> <span class=o>!=</span> <span class=s2>&quot;&quot;</span><span class=p>:</span>
</span><span id=__span-0-854><a id=__codelineno-0-854 name=__codelineno-0-854></a>        <span class=n>model</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_model_for_inference</span><span class=p>(</span><span class=n>agent</span><span class=o>.</span><span class=n>model</span><span class=p>)</span>
</span><span id=__span-0-855><a id=__codelineno-0-855 name=__codelineno-0-855></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_last_used_model</span> <span class=o>=</span> <span class=n>model</span>
</span><span id=__span-0-856><a id=__codelineno-0-856 name=__codelineno-0-856></a>        <span class=n>message</span> <span class=o>+=</span> <span class=sa>f</span><span class=s2>&quot; that will connect to </span><span class=si>{</span><span class=n>model</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-857><a id=__codelineno-0-857 name=__codelineno-0-857></a>        <span class=k>if</span> <span class=n>agent</span><span class=o>.</span><span class=n>model_temperature</span><span class=p>:</span>
</span><span id=__span-0-858><a id=__codelineno-0-858 name=__codelineno-0-858></a>            <span class=n>message</span> <span class=o>+=</span> <span class=sa>f</span><span class=s2>&quot;, temperature=</span><span class=si>{</span><span class=n>agent</span><span class=o>.</span><span class=n>model_temperature</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-859><a id=__codelineno-0-859 name=__codelineno-0-859></a>        <span class=k>if</span> <span class=n>agent</span><span class=o>.</span><span class=n>model_max_tokens</span><span class=p>:</span>
</span><span id=__span-0-860><a id=__codelineno-0-860 name=__codelineno-0-860></a>            <span class=n>message</span> <span class=o>+=</span> <span class=sa>f</span><span class=s2>&quot;, max_tokens=</span><span class=si>{</span><span class=n>agent</span><span class=o>.</span><span class=n>model_max_tokens</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-861><a id=__codelineno-0-861 name=__codelineno-0-861></a>    <span class=bp>self</span><span class=o>.</span><span class=n>add_system_log</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.environment.Environment.add_message class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">add_message</span> <a href=#nearai.agents.environment.Environment.add_message class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>add_message</span><span class=p>(</span><span class=n>role</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>message</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>attachments</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n><span title=typing.Iterable>Iterable</span></span><span class=p>[</span><span class=n><span title=openai.types.beta.threads.message_create_params.Attachment>Attachment</span></span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n><span title=typing.Any>Any</span></span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Deprecated. Please use <code>add_reply</code> instead. Assistant adds a message to the environment.</p> <details class=quote> <summary>Source code in <code>nearai/agents/environment.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-785>785</a></span>
<span class=normal><a href=#__codelineno-0-786>786</a></span>
<span class=normal><a href=#__codelineno-0-787>787</a></span>
<span class=normal><a href=#__codelineno-0-788>788</a></span>
<span class=normal><a href=#__codelineno-0-789>789</a></span>
<span class=normal><a href=#__codelineno-0-790>790</a></span>
<span class=normal><a href=#__codelineno-0-791>791</a></span>
<span class=normal><a href=#__codelineno-0-792>792</a></span>
<span class=normal><a href=#__codelineno-0-793>793</a></span>
<span class=normal><a href=#__codelineno-0-794>794</a></span>
<span class=normal><a href=#__codelineno-0-795>795</a></span>
<span class=normal><a href=#__codelineno-0-796>796</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-785><a id=__codelineno-0-785 name=__codelineno-0-785></a><span class=k>def</span><span class=w> </span><span class=nf>add_message</span><span class=p>(</span>
</span><span id=__span-0-786><a id=__codelineno-0-786 name=__codelineno-0-786></a>    <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-787><a id=__codelineno-0-787 name=__codelineno-0-787></a>    <span class=n>role</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-788><a id=__codelineno-0-788 name=__codelineno-0-788></a>    <span class=n>message</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-789><a id=__codelineno-0-789 name=__codelineno-0-789></a>    <span class=n>attachments</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Iterable</span><span class=p>[</span><span class=n>Attachment</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-790><a id=__codelineno-0-790 name=__codelineno-0-790></a>    <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span>
</span><span id=__span-0-791><a id=__codelineno-0-791 name=__codelineno-0-791></a><span class=p>):</span>
</span><span id=__span-0-792><a id=__codelineno-0-792 name=__codelineno-0-792></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Deprecated. Please use `add_reply` instead. Assistant adds a message to the environment.&quot;&quot;&quot;</span>
</span><span id=__span-0-793><a id=__codelineno-0-793 name=__codelineno-0-793></a>    <span class=c1># Prevent agent to save messages on behalf of `user` to avoid adding false memory</span>
</span><span id=__span-0-794><a id=__codelineno-0-794 name=__codelineno-0-794></a>    <span class=n>role</span> <span class=o>=</span> <span class=s2>&quot;assistant&quot;</span>
</span><span id=__span-0-795><a id=__codelineno-0-795 name=__codelineno-0-795></a>
</span><span id=__span-0-796><a id=__codelineno-0-796 name=__codelineno-0-796></a>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_add_message</span><span class=p>(</span><span class=n>role</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=n>attachments</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.environment.Environment.add_system_log class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">add_system_log</span> <a href=#nearai.agents.environment.Environment.add_system_log class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>add_system_log</span><span class=p>(</span><span class=n>log</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>level</span><span class=p>:</span> <span class=n>int</span> <span class=o>=</span> <span class=n><span title=logging.INFO>INFO</span></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Add system log with timestamp and log level.</p> <details class=quote> <summary>Source code in <code>nearai/agents/environment.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-798>798</a></span>
<span class=normal><a href=#__codelineno-0-799>799</a></span>
<span class=normal><a href=#__codelineno-0-800>800</a></span>
<span class=normal><a href=#__codelineno-0-801>801</a></span>
<span class=normal><a href=#__codelineno-0-802>802</a></span>
<span class=normal><a href=#__codelineno-0-803>803</a></span>
<span class=normal><a href=#__codelineno-0-804>804</a></span>
<span class=normal><a href=#__codelineno-0-805>805</a></span>
<span class=normal><a href=#__codelineno-0-806>806</a></span>
<span class=normal><a href=#__codelineno-0-807>807</a></span>
<span class=normal><a href=#__codelineno-0-808>808</a></span>
<span class=normal><a href=#__codelineno-0-809>809</a></span>
<span class=normal><a href=#__codelineno-0-810>810</a></span>
<span class=normal><a href=#__codelineno-0-811>811</a></span>
<span class=normal><a href=#__codelineno-0-812>812</a></span>
<span class=normal><a href=#__codelineno-0-813>813</a></span>
<span class=normal><a href=#__codelineno-0-814>814</a></span>
<span class=normal><a href=#__codelineno-0-815>815</a></span>
<span class=normal><a href=#__codelineno-0-816>816</a></span>
<span class=normal><a href=#__codelineno-0-817>817</a></span>
<span class=normal><a href=#__codelineno-0-818>818</a></span>
<span class=normal><a href=#__codelineno-0-819>819</a></span>
<span class=normal><a href=#__codelineno-0-820>820</a></span>
<span class=normal><a href=#__codelineno-0-821>821</a></span>
<span class=normal><a href=#__codelineno-0-822>822</a></span>
<span class=normal><a href=#__codelineno-0-823>823</a></span>
<span class=normal><a href=#__codelineno-0-824>824</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-798><a id=__codelineno-0-798 name=__codelineno-0-798></a><span class=k>def</span><span class=w> </span><span class=nf>add_system_log</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>log</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>level</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>INFO</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-799><a id=__codelineno-0-799 name=__codelineno-0-799></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Add system log with timestamp and log level.&quot;&quot;&quot;</span>
</span><span id=__span-0-800><a id=__codelineno-0-800 name=__codelineno-0-800></a>    <span class=n>logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=s2>&quot;system_logger&quot;</span><span class=p>)</span>
</span><span id=__span-0-801><a id=__codelineno-0-801 name=__codelineno-0-801></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>logger</span><span class=o>.</span><span class=n>handlers</span><span class=p>:</span>
</span><span id=__span-0-802><a id=__codelineno-0-802 name=__codelineno-0-802></a>        <span class=c1># Configure the logger if it hasn&#39;t been set up yet</span>
</span><span id=__span-0-803><a id=__codelineno-0-803 name=__codelineno-0-803></a>        <span class=n>logger</span><span class=o>.</span><span class=n>setLevel</span><span class=p>(</span><span class=n>logging</span><span class=o>.</span><span class=n>DEBUG</span><span class=p>)</span>
</span><span id=__span-0-804><a id=__codelineno-0-804 name=__codelineno-0-804></a>        <span class=n>file_handler</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>FileHandler</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_path</span><span class=p>,</span> <span class=n>SYSTEM_LOG_FILENAME</span><span class=p>))</span>
</span><span id=__span-0-805><a id=__codelineno-0-805 name=__codelineno-0-805></a>        <span class=n>formatter</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>Formatter</span><span class=p>(</span><span class=s2>&quot;</span><span class=si>%(asctime)s</span><span class=s2> - </span><span class=si>%(levelname)s</span><span class=s2> - </span><span class=si>%(message)s</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>datefmt</span><span class=o>=</span><span class=s2>&quot;%Y-%m-</span><span class=si>%d</span><span class=s2> %H:%M:%S&quot;</span><span class=p>)</span>
</span><span id=__span-0-806><a id=__codelineno-0-806 name=__codelineno-0-806></a>        <span class=n>file_handler</span><span class=o>.</span><span class=n>setFormatter</span><span class=p>(</span><span class=n>formatter</span><span class=p>)</span>
</span><span id=__span-0-807><a id=__codelineno-0-807 name=__codelineno-0-807></a>        <span class=n>logger</span><span class=o>.</span><span class=n>addHandler</span><span class=p>(</span><span class=n>file_handler</span><span class=p>)</span>
</span><span id=__span-0-808><a id=__codelineno-0-808 name=__codelineno-0-808></a>
</span><span id=__span-0-809><a id=__codelineno-0-809 name=__codelineno-0-809></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>print_system_log</span><span class=p>:</span>
</span><span id=__span-0-810><a id=__codelineno-0-810 name=__codelineno-0-810></a>            <span class=n>console_handler</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>StreamHandler</span><span class=p>()</span>
</span><span id=__span-0-811><a id=__codelineno-0-811 name=__codelineno-0-811></a>            <span class=n>console_handler</span><span class=o>.</span><span class=n>setFormatter</span><span class=p>(</span><span class=n>formatter</span><span class=p>)</span>
</span><span id=__span-0-812><a id=__codelineno-0-812 name=__codelineno-0-812></a>            <span class=n>logger</span><span class=o>.</span><span class=n>addHandler</span><span class=p>(</span><span class=n>console_handler</span><span class=p>)</span>
</span><span id=__span-0-813><a id=__codelineno-0-813 name=__codelineno-0-813></a>
</span><span id=__span-0-814><a id=__codelineno-0-814 name=__codelineno-0-814></a>        <span class=c1># Add Thread log handler</span>
</span><span id=__span-0-815><a id=__codelineno-0-815 name=__codelineno-0-815></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_debug_mode</span><span class=p>:</span>
</span><span id=__span-0-816><a id=__codelineno-0-816 name=__codelineno-0-816></a>            <span class=n>custom_handler</span> <span class=o>=</span> <span class=n>CustomLogHandler</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>add_reply</span><span class=p>,</span> <span class=s2>&quot;system&quot;</span><span class=p>)</span>
</span><span id=__span-0-817><a id=__codelineno-0-817 name=__codelineno-0-817></a>            <span class=n>custom_handler</span><span class=o>.</span><span class=n>setFormatter</span><span class=p>(</span><span class=n>formatter</span><span class=p>)</span>
</span><span id=__span-0-818><a id=__codelineno-0-818 name=__codelineno-0-818></a>            <span class=n>logger</span><span class=o>.</span><span class=n>addHandler</span><span class=p>(</span><span class=n>custom_handler</span><span class=p>)</span>
</span><span id=__span-0-819><a id=__codelineno-0-819 name=__codelineno-0-819></a>
</span><span id=__span-0-820><a id=__codelineno-0-820 name=__codelineno-0-820></a>    <span class=c1># Log the message</span>
</span><span id=__span-0-821><a id=__codelineno-0-821 name=__codelineno-0-821></a>    <span class=n>logger</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=n>level</span><span class=p>,</span> <span class=n>log</span><span class=p>)</span>
</span><span id=__span-0-822><a id=__codelineno-0-822 name=__codelineno-0-822></a>    <span class=c1># Force the handler to write to disk</span>
</span><span id=__span-0-823><a id=__codelineno-0-823 name=__codelineno-0-823></a>    <span class=k>for</span> <span class=n>handler</span> <span class=ow>in</span> <span class=n>logger</span><span class=o>.</span><span class=n>handlers</span><span class=p>:</span>
</span><span id=__span-0-824><a id=__codelineno-0-824 name=__codelineno-0-824></a>        <span class=n>handler</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.environment.Environment.call_agent class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">call_agent</span> <a href=#nearai.agents.environment.Environment.call_agent class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>call_agent</span><span class=p>(</span><span class=n>agent_index</span><span class=p>:</span> <span class=n>int</span><span class=p>,</span> <span class=n>task</span><span class=p>:</span> <span class=n>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Calls agent with given task.</p> <details class=quote> <summary>Source code in <code>nearai/agents/environment.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1357>1357</a></span>
<span class=normal><a href=#__codelineno-0-1358>1358</a></span>
<span class=normal><a href=#__codelineno-0-1359>1359</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1357><a id=__codelineno-0-1357 name=__codelineno-0-1357></a><span class=k>def</span><span class=w> </span><span class=nf>call_agent</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>agent_index</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>task</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-1358><a id=__codelineno-0-1358 name=__codelineno-0-1358></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Calls agent with given task.&quot;&quot;&quot;</span>
</span><span id=__span-0-1359><a id=__codelineno-0-1359 name=__codelineno-0-1359></a>    <span class=bp>self</span><span class=o>.</span><span class=n>_agents</span><span class=p>[</span><span class=n>agent_index</span><span class=p>]</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>task</span><span class=o>=</span><span class=n>task</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.environment.Environment.clear_temp_agent_files class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">clear_temp_agent_files</span> <a href=#nearai.agents.environment.Environment.clear_temp_agent_files class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>clear_temp_agent_files</span><span class=p>(</span><span class=n>verbose</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Remove temp agent files created to be used in <code>runpy</code>.</p> <details class=quote> <summary>Source code in <code>nearai/agents/environment.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1433>1433</a></span>
<span class=normal><a href=#__codelineno-0-1434>1434</a></span>
<span class=normal><a href=#__codelineno-0-1435>1435</a></span>
<span class=normal><a href=#__codelineno-0-1436>1436</a></span>
<span class=normal><a href=#__codelineno-0-1437>1437</a></span>
<span class=normal><a href=#__codelineno-0-1438>1438</a></span>
<span class=normal><a href=#__codelineno-0-1439>1439</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1433><a id=__codelineno-0-1433 name=__codelineno-0-1433></a><span class=k>def</span><span class=w> </span><span class=nf>clear_temp_agent_files</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>verbose</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-1434><a id=__codelineno-0-1434 name=__codelineno-0-1434></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Remove temp agent files created to be used in `runpy`.&quot;&quot;&quot;</span>
</span><span id=__span-0-1435><a id=__codelineno-0-1435 name=__codelineno-0-1435></a>    <span class=k>for</span> <span class=n>agent</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>_agents</span><span class=p>:</span>
</span><span id=__span-0-1436><a id=__codelineno-0-1436 name=__codelineno-0-1436></a>        <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>agent</span><span class=o>.</span><span class=n>temp_dir</span><span class=p>):</span>
</span><span id=__span-0-1437><a id=__codelineno-0-1437 name=__codelineno-0-1437></a>            <span class=k>if</span> <span class=n>verbose</span><span class=p>:</span>
</span><span id=__span-0-1438><a id=__codelineno-0-1438 name=__codelineno-0-1438></a>                <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;removed agent.temp_files&quot;</span><span class=p>,</span> <span class=n>agent</span><span class=o>.</span><span class=n>temp_dir</span><span class=p>)</span>
</span><span id=__span-0-1439><a id=__codelineno-0-1439 name=__codelineno-0-1439></a>            <span class=n>shutil</span><span class=o>.</span><span class=n>rmtree</span><span class=p>(</span><span class=n>agent</span><span class=o>.</span><span class=n>temp_dir</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.environment.Environment.completion class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">completion</span> <a href=#nearai.agents.environment.Environment.completion class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>completion</span><span class=p>(</span><span class=n>messages</span><span class=p>:</span> <span class=n><span title=typing.Union>Union</span></span><span class=p>[</span><span class=n><span title=typing.Iterable>Iterable</span></span><span class=p>[</span><span class=n><span title=litellm.types.completion.ChatCompletionMessageParam>ChatCompletionMessageParam</span></span><span class=p>],</span> <span class=n>str</span><span class=p>],</span> <span class=n>model</span><span class=p>:</span> <span class=n><span title=typing.Union>Union</span></span><span class=p>[</span><span class=n><span title=typing.Iterable>Iterable</span></span><span class=p>[</span><span class=n><span title=litellm.types.completion.ChatCompletionMessageParam>ChatCompletionMessageParam</span></span><span class=p>],</span> <span class=n>str</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n><span title=typing.Any>Any</span></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>str</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Returns a completion for the given messages using the given model.</p> <details class=quote> <summary>Source code in <code>nearai/agents/environment.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1274>1274</a></span>
<span class=normal><a href=#__codelineno-0-1275>1275</a></span>
<span class=normal><a href=#__codelineno-0-1276>1276</a></span>
<span class=normal><a href=#__codelineno-0-1277>1277</a></span>
<span class=normal><a href=#__codelineno-0-1278>1278</a></span>
<span class=normal><a href=#__codelineno-0-1279>1279</a></span>
<span class=normal><a href=#__codelineno-0-1280>1280</a></span>
<span class=normal><a href=#__codelineno-0-1281>1281</a></span>
<span class=normal><a href=#__codelineno-0-1282>1282</a></span>
<span class=normal><a href=#__codelineno-0-1283>1283</a></span>
<span class=normal><a href=#__codelineno-0-1284>1284</a></span>
<span class=normal><a href=#__codelineno-0-1285>1285</a></span>
<span class=normal><a href=#__codelineno-0-1286>1286</a></span>
<span class=normal><a href=#__codelineno-0-1287>1287</a></span>
<span class=normal><a href=#__codelineno-0-1288>1288</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1274><a id=__codelineno-0-1274 name=__codelineno-0-1274></a><span class=k>def</span><span class=w> </span><span class=nf>completion</span><span class=p>(</span>
</span><span id=__span-0-1275><a id=__codelineno-0-1275 name=__codelineno-0-1275></a>    <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-1276><a id=__codelineno-0-1276 name=__codelineno-0-1276></a>    <span class=n>messages</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Iterable</span><span class=p>[</span><span class=n>ChatCompletionMessageParam</span><span class=p>],</span> <span class=nb>str</span><span class=p>],</span>
</span><span id=__span-0-1277><a id=__codelineno-0-1277 name=__codelineno-0-1277></a>    <span class=n>model</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Iterable</span><span class=p>[</span><span class=n>ChatCompletionMessageParam</span><span class=p>],</span> <span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-1278><a id=__codelineno-0-1278 name=__codelineno-0-1278></a>    <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span>
</span><span id=__span-0-1279><a id=__codelineno-0-1279 name=__codelineno-0-1279></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-0-1280><a id=__codelineno-0-1280 name=__codelineno-0-1280></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns a completion for the given messages using the given model.&quot;&quot;&quot;</span>
</span><span id=__span-0-1281><a id=__codelineno-0-1281 name=__codelineno-0-1281></a>    <span class=n>raw_response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>completions</span><span class=p>(</span><span class=n>messages</span><span class=p>,</span> <span class=n>model</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span><span id=__span-0-1282><a id=__codelineno-0-1282 name=__codelineno-0-1282></a>    <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>raw_response</span><span class=p>,</span> <span class=n>ModelResponse</span><span class=p>),</span> <span class=s2>&quot;Expected ModelResponse&quot;</span>
</span><span id=__span-0-1283><a id=__codelineno-0-1283 name=__codelineno-0-1283></a>    <span class=n>response</span><span class=p>:</span> <span class=n>ModelResponse</span> <span class=o>=</span> <span class=n>raw_response</span>
</span><span id=__span-0-1284><a id=__codelineno-0-1284 name=__codelineno-0-1284></a>    <span class=k>assert</span> <span class=nb>all</span><span class=p>(</span><span class=nb>map</span><span class=p>(</span><span class=k>lambda</span> <span class=n>choice</span><span class=p>:</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>choice</span><span class=p>,</span> <span class=n>Choices</span><span class=p>),</span> <span class=n>response</span><span class=o>.</span><span class=n>choices</span><span class=p>)),</span> <span class=s2>&quot;Expected Choices&quot;</span>
</span><span id=__span-0-1285><a id=__codelineno-0-1285 name=__codelineno-0-1285></a>    <span class=n>choices</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Choices</span><span class=p>]</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>choices</span>  <span class=c1># type: ignore</span>
</span><span id=__span-0-1286><a id=__codelineno-0-1286 name=__codelineno-0-1286></a>    <span class=n>response_message</span> <span class=o>=</span> <span class=n>choices</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>message</span><span class=o>.</span><span class=n>content</span>
</span><span id=__span-0-1287><a id=__codelineno-0-1287 name=__codelineno-0-1287></a>    <span class=k>assert</span> <span class=n>response_message</span><span class=p>,</span> <span class=s2>&quot;No completions returned&quot;</span>
</span><span id=__span-0-1288><a id=__codelineno-0-1288 name=__codelineno-0-1288></a>    <span class=k>return</span> <span class=n>response_message</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.environment.Environment.completion_and_get_tools_calls class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">completion_and_get_tools_calls</span> <a href=#nearai.agents.environment.Environment.completion_and_get_tools_calls class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>completion_and_get_tools_calls</span><span class=p>(</span><span class=n>messages</span><span class=p>:</span> <span class=n><span title=typing.List>List</span></span><span class=p>[</span><span class=n><span title=litellm.types.completion.ChatCompletionMessageParam>ChatCompletionMessageParam</span></span><span class=p>],</span> <span class=n>model</span><span class=p>:</span> <span class=n>str</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n><span title=typing.Any>Any</span></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=types.SimpleNamespace>SimpleNamespace</span></span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Returns completion message and/or tool calls from OpenAI or Llama tool formats.</p> <details class=quote> <summary>Source code in <code>nearai/agents/environment.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1316>1316</a></span>
<span class=normal><a href=#__codelineno-0-1317>1317</a></span>
<span class=normal><a href=#__codelineno-0-1318>1318</a></span>
<span class=normal><a href=#__codelineno-0-1319>1319</a></span>
<span class=normal><a href=#__codelineno-0-1320>1320</a></span>
<span class=normal><a href=#__codelineno-0-1321>1321</a></span>
<span class=normal><a href=#__codelineno-0-1322>1322</a></span>
<span class=normal><a href=#__codelineno-0-1323>1323</a></span>
<span class=normal><a href=#__codelineno-0-1324>1324</a></span>
<span class=normal><a href=#__codelineno-0-1325>1325</a></span>
<span class=normal><a href=#__codelineno-0-1326>1326</a></span>
<span class=normal><a href=#__codelineno-0-1327>1327</a></span>
<span class=normal><a href=#__codelineno-0-1328>1328</a></span>
<span class=normal><a href=#__codelineno-0-1329>1329</a></span>
<span class=normal><a href=#__codelineno-0-1330>1330</a></span>
<span class=normal><a href=#__codelineno-0-1331>1331</a></span>
<span class=normal><a href=#__codelineno-0-1332>1332</a></span>
<span class=normal><a href=#__codelineno-0-1333>1333</a></span>
<span class=normal><a href=#__codelineno-0-1334>1334</a></span>
<span class=normal><a href=#__codelineno-0-1335>1335</a></span>
<span class=normal><a href=#__codelineno-0-1336>1336</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1316><a id=__codelineno-0-1316 name=__codelineno-0-1316></a><span class=k>def</span><span class=w> </span><span class=nf>completion_and_get_tools_calls</span><span class=p>(</span>
</span><span id=__span-0-1317><a id=__codelineno-0-1317 name=__codelineno-0-1317></a>    <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-1318><a id=__codelineno-0-1318 name=__codelineno-0-1318></a>    <span class=n>messages</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>ChatCompletionMessageParam</span><span class=p>],</span>
</span><span id=__span-0-1319><a id=__codelineno-0-1319 name=__codelineno-0-1319></a>    <span class=n>model</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-1320><a id=__codelineno-0-1320 name=__codelineno-0-1320></a>    <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span>
</span><span id=__span-0-1321><a id=__codelineno-0-1321 name=__codelineno-0-1321></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>SimpleNamespace</span><span class=p>:</span>
</span><span id=__span-0-1322><a id=__codelineno-0-1322 name=__codelineno-0-1322></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns completion message and/or tool calls from OpenAI or Llama tool formats.&quot;&quot;&quot;</span>
</span><span id=__span-0-1323><a id=__codelineno-0-1323 name=__codelineno-0-1323></a>    <span class=n>raw_response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_run_inference_completions</span><span class=p>(</span><span class=n>messages</span><span class=p>,</span> <span class=n>model</span><span class=p>,</span> <span class=n>stream</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span><span id=__span-0-1324><a id=__codelineno-0-1324 name=__codelineno-0-1324></a>
</span><span id=__span-0-1325><a id=__codelineno-0-1325 name=__codelineno-0-1325></a>    <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>raw_response</span><span class=p>,</span> <span class=n>ModelResponse</span><span class=p>),</span> <span class=s2>&quot;Expected ModelResponse&quot;</span>
</span><span id=__span-0-1326><a id=__codelineno-0-1326 name=__codelineno-0-1326></a>    <span class=n>response</span><span class=p>:</span> <span class=n>ModelResponse</span> <span class=o>=</span> <span class=n>raw_response</span>
</span><span id=__span-0-1327><a id=__codelineno-0-1327 name=__codelineno-0-1327></a>    <span class=k>assert</span> <span class=nb>all</span><span class=p>(</span><span class=nb>map</span><span class=p>(</span><span class=k>lambda</span> <span class=n>choice</span><span class=p>:</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>choice</span><span class=p>,</span> <span class=n>Choices</span><span class=p>),</span> <span class=n>response</span><span class=o>.</span><span class=n>choices</span><span class=p>)),</span> <span class=s2>&quot;Expected Choices&quot;</span>
</span><span id=__span-0-1328><a id=__codelineno-0-1328 name=__codelineno-0-1328></a>    <span class=n>choices</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Choices</span><span class=p>]</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>choices</span>  <span class=c1># type: ignore</span>
</span><span id=__span-0-1329><a id=__codelineno-0-1329 name=__codelineno-0-1329></a>
</span><span id=__span-0-1330><a id=__codelineno-0-1330 name=__codelineno-0-1330></a>    <span class=p>(</span><span class=n>message_without_tool_call</span><span class=p>,</span> <span class=n>tool_calls</span><span class=p>)</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_parse_tool_call</span><span class=p>(</span><span class=n>choices</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>message</span><span class=p>)</span>
</span><span id=__span-0-1331><a id=__codelineno-0-1331 name=__codelineno-0-1331></a>
</span><span id=__span-0-1332><a id=__codelineno-0-1332 name=__codelineno-0-1332></a>    <span class=k>if</span> <span class=n>message_without_tool_call</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-1333><a id=__codelineno-0-1333 name=__codelineno-0-1333></a>        <span class=n>response_message</span> <span class=o>=</span> <span class=n>choices</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>message</span><span class=o>.</span><span class=n>content</span>
</span><span id=__span-0-1334><a id=__codelineno-0-1334 name=__codelineno-0-1334></a>        <span class=n>message_without_tool_call</span> <span class=o>=</span> <span class=n>response_message</span>
</span><span id=__span-0-1335><a id=__codelineno-0-1335 name=__codelineno-0-1335></a>
</span><span id=__span-0-1336><a id=__codelineno-0-1336 name=__codelineno-0-1336></a>    <span class=k>return</span> <span class=n>SimpleNamespace</span><span class=p>(</span><span class=n>message</span><span class=o>=</span><span class=n>message_without_tool_call</span><span class=p>,</span> <span class=n>tool_calls</span><span class=o>=</span><span class=n>tool_calls</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.environment.Environment.completion_and_run_tools class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">completion_and_run_tools</span> <a href=#nearai.agents.environment.Environment.completion_and_run_tools class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>completion_and_run_tools</span><span class=p>(</span><span class=n>messages</span><span class=p>:</span> <span class=n><span title=typing.List>List</span></span><span class=p>[</span><span class=n><span title=litellm.types.completion.ChatCompletionMessageParam>ChatCompletionMessageParam</span></span><span class=p>],</span> <span class=n>model</span><span class=p>:</span> <span class=n>str</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=n>tools</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n><span title=typing.List>List</span></span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n><span title=typing.Any>Any</span></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>str</span><span class=p>]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Returns a completion for the given messages using the given model and runs tools.</p> <details class=quote> <summary>Source code in <code>nearai/agents/environment.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1338>1338</a></span>
<span class=normal><a href=#__codelineno-0-1339>1339</a></span>
<span class=normal><a href=#__codelineno-0-1340>1340</a></span>
<span class=normal><a href=#__codelineno-0-1341>1341</a></span>
<span class=normal><a href=#__codelineno-0-1342>1342</a></span>
<span class=normal><a href=#__codelineno-0-1343>1343</a></span>
<span class=normal><a href=#__codelineno-0-1344>1344</a></span>
<span class=normal><a href=#__codelineno-0-1345>1345</a></span>
<span class=normal><a href=#__codelineno-0-1346>1346</a></span>
<span class=normal><a href=#__codelineno-0-1347>1347</a></span>
<span class=normal><a href=#__codelineno-0-1348>1348</a></span>
<span class=normal><a href=#__codelineno-0-1349>1349</a></span>
<span class=normal><a href=#__codelineno-0-1350>1350</a></span>
<span class=normal><a href=#__codelineno-0-1351>1351</a></span>
<span class=normal><a href=#__codelineno-0-1352>1352</a></span>
<span class=normal><a href=#__codelineno-0-1353>1353</a></span>
<span class=normal><a href=#__codelineno-0-1354>1354</a></span>
<span class=normal><a href=#__codelineno-0-1355>1355</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1338><a id=__codelineno-0-1338 name=__codelineno-0-1338></a><span class=k>def</span><span class=w> </span><span class=nf>completion_and_run_tools</span><span class=p>(</span>
</span><span id=__span-0-1339><a id=__codelineno-0-1339 name=__codelineno-0-1339></a>    <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-1340><a id=__codelineno-0-1340 name=__codelineno-0-1340></a>    <span class=n>messages</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>ChatCompletionMessageParam</span><span class=p>],</span>
</span><span id=__span-0-1341><a id=__codelineno-0-1341 name=__codelineno-0-1341></a>    <span class=n>model</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-1342><a id=__codelineno-0-1342 name=__codelineno-0-1342></a>    <span class=n>tools</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-1343><a id=__codelineno-0-1343 name=__codelineno-0-1343></a>    <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span>
</span><span id=__span-0-1344><a id=__codelineno-0-1344 name=__codelineno-0-1344></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
</span><span id=__span-0-1345><a id=__codelineno-0-1345 name=__codelineno-0-1345></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns a completion for the given messages using the given model and runs tools.&quot;&quot;&quot;</span>
</span><span id=__span-0-1346><a id=__codelineno-0-1346 name=__codelineno-0-1346></a>    <span class=n>completion_tools_response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>completions_and_run_tools</span><span class=p>(</span><span class=n>messages</span><span class=p>,</span> <span class=n>model</span><span class=p>,</span> <span class=n>tools</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span><span id=__span-0-1347><a id=__codelineno-0-1347 name=__codelineno-0-1347></a>    <span class=k>assert</span> <span class=nb>all</span><span class=p>(</span>
</span><span id=__span-0-1348><a id=__codelineno-0-1348 name=__codelineno-0-1348></a>        <span class=nb>map</span><span class=p>(</span>
</span><span id=__span-0-1349><a id=__codelineno-0-1349 name=__codelineno-0-1349></a>            <span class=k>lambda</span> <span class=n>choice</span><span class=p>:</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>choice</span><span class=p>,</span> <span class=n>Choices</span><span class=p>),</span>
</span><span id=__span-0-1350><a id=__codelineno-0-1350 name=__codelineno-0-1350></a>            <span class=n>completion_tools_response</span><span class=o>.</span><span class=n>choices</span><span class=p>,</span>
</span><span id=__span-0-1351><a id=__codelineno-0-1351 name=__codelineno-0-1351></a>        <span class=p>)</span>
</span><span id=__span-0-1352><a id=__codelineno-0-1352 name=__codelineno-0-1352></a>    <span class=p>),</span> <span class=s2>&quot;Expected Choices&quot;</span>
</span><span id=__span-0-1353><a id=__codelineno-0-1353 name=__codelineno-0-1353></a>    <span class=n>choices</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Choices</span><span class=p>]</span> <span class=o>=</span> <span class=n>completion_tools_response</span><span class=o>.</span><span class=n>choices</span>  <span class=c1># type: ignore</span>
</span><span id=__span-0-1354><a id=__codelineno-0-1354 name=__codelineno-0-1354></a>    <span class=n>response_content</span> <span class=o>=</span> <span class=n>choices</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>message</span><span class=o>.</span><span class=n>content</span>
</span><span id=__span-0-1355><a id=__codelineno-0-1355 name=__codelineno-0-1355></a>    <span class=k>return</span> <span class=n>response_content</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.environment.Environment.completions class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">completions</span> <a href=#nearai.agents.environment.Environment.completions class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>completions</span><span class=p>(</span><span class=n>messages</span><span class=p>:</span> <span class=n><span title=typing.Union>Union</span></span><span class=p>[</span><span class=n><span title=typing.Iterable>Iterable</span></span><span class=p>[</span><span class=n><span title=litellm.types.completion.ChatCompletionMessageParam>ChatCompletionMessageParam</span></span><span class=p>],</span> <span class=n>str</span><span class=p>],</span> <span class=n>model</span><span class=p>:</span> <span class=n><span title=typing.Union>Union</span></span><span class=p>[</span><span class=n><span title=typing.Iterable>Iterable</span></span><span class=p>[</span><span class=n><span title=litellm.types.completion.ChatCompletionMessageParam>ChatCompletionMessageParam</span></span><span class=p>],</span> <span class=n>str</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=n>stream</span><span class=p>:</span> <span class=n>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n><span title=typing.Any>Any</span></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=typing.Union>Union</span></span><span class=p>[</span><span class=n><span title=litellm.types.utils.ModelResponse>ModelResponse</span></span><span class=p>,</span> <span class=n><span title=litellm.utils.CustomStreamWrapper>CustomStreamWrapper</span></span><span class=p>]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Returns all completions for given messages using the given model.</p> <details class=quote> <summary>Source code in <code>nearai/agents/environment.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1091>1091</a></span>
<span class=normal><a href=#__codelineno-0-1092>1092</a></span>
<span class=normal><a href=#__codelineno-0-1093>1093</a></span>
<span class=normal><a href=#__codelineno-0-1094>1094</a></span>
<span class=normal><a href=#__codelineno-0-1095>1095</a></span>
<span class=normal><a href=#__codelineno-0-1096>1096</a></span>
<span class=normal><a href=#__codelineno-0-1097>1097</a></span>
<span class=normal><a href=#__codelineno-0-1098>1098</a></span>
<span class=normal><a href=#__codelineno-0-1099>1099</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1091><a id=__codelineno-0-1091 name=__codelineno-0-1091></a><span class=k>def</span><span class=w> </span><span class=nf>completions</span><span class=p>(</span>
</span><span id=__span-0-1092><a id=__codelineno-0-1092 name=__codelineno-0-1092></a>    <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-1093><a id=__codelineno-0-1093 name=__codelineno-0-1093></a>    <span class=n>messages</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Iterable</span><span class=p>[</span><span class=n>ChatCompletionMessageParam</span><span class=p>],</span> <span class=nb>str</span><span class=p>],</span>
</span><span id=__span-0-1094><a id=__codelineno-0-1094 name=__codelineno-0-1094></a>    <span class=n>model</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Iterable</span><span class=p>[</span><span class=n>ChatCompletionMessageParam</span><span class=p>],</span> <span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-1095><a id=__codelineno-0-1095 name=__codelineno-0-1095></a>    <span class=n>stream</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-1096><a id=__codelineno-0-1096 name=__codelineno-0-1096></a>    <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span>
</span><span id=__span-0-1097><a id=__codelineno-0-1097 name=__codelineno-0-1097></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span><span class=n>ModelResponse</span><span class=p>,</span> <span class=n>CustomStreamWrapper</span><span class=p>]:</span>
</span><span id=__span-0-1098><a id=__codelineno-0-1098 name=__codelineno-0-1098></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns all completions for given messages using the given model.&quot;&quot;&quot;</span>
</span><span id=__span-0-1099><a id=__codelineno-0-1099 name=__codelineno-0-1099></a>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_run_inference_completions</span><span class=p>(</span><span class=n>messages</span><span class=p>,</span> <span class=n>model</span><span class=p>,</span> <span class=n>stream</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.environment.Environment.completions_and_run_tools class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">completions_and_run_tools</span> <a href=#nearai.agents.environment.Environment.completions_and_run_tools class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>completions_and_run_tools</span><span class=p>(</span><span class=n>messages</span><span class=p>:</span> <span class=n><span title=typing.List>List</span></span><span class=p>[</span><span class=n><span title=litellm.types.completion.ChatCompletionMessageParam>ChatCompletionMessageParam</span></span><span class=p>],</span> <span class=n>model</span><span class=p>:</span> <span class=n>str</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=n>tools</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n><span title=typing.List>List</span></span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>add_responses_to_messages</span><span class=p>:</span> <span class=n>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span> <span class=n>agent_role_name</span><span class=o>=</span><span class=s1>&#39;assistant&#39;</span><span class=p>,</span> <span class=n>tool_role_name</span><span class=o>=</span><span class=s1>&#39;tool&#39;</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n><span title=typing.Any>Any</span></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=litellm.types.utils.ModelResponse>ModelResponse</span></span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Returns all completions for given messages using the given model and runs tools.</p> <details class=quote> <summary>Source code in <code>nearai/agents/environment.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1134>1134</a></span>
<span class=normal><a href=#__codelineno-0-1135>1135</a></span>
<span class=normal><a href=#__codelineno-0-1136>1136</a></span>
<span class=normal><a href=#__codelineno-0-1137>1137</a></span>
<span class=normal><a href=#__codelineno-0-1138>1138</a></span>
<span class=normal><a href=#__codelineno-0-1139>1139</a></span>
<span class=normal><a href=#__codelineno-0-1140>1140</a></span>
<span class=normal><a href=#__codelineno-0-1141>1141</a></span>
<span class=normal><a href=#__codelineno-0-1142>1142</a></span>
<span class=normal><a href=#__codelineno-0-1143>1143</a></span>
<span class=normal><a href=#__codelineno-0-1144>1144</a></span>
<span class=normal><a href=#__codelineno-0-1145>1145</a></span>
<span class=normal><a href=#__codelineno-0-1146>1146</a></span>
<span class=normal><a href=#__codelineno-0-1147>1147</a></span>
<span class=normal><a href=#__codelineno-0-1148>1148</a></span>
<span class=normal><a href=#__codelineno-0-1149>1149</a></span>
<span class=normal><a href=#__codelineno-0-1150>1150</a></span>
<span class=normal><a href=#__codelineno-0-1151>1151</a></span>
<span class=normal><a href=#__codelineno-0-1152>1152</a></span>
<span class=normal><a href=#__codelineno-0-1153>1153</a></span>
<span class=normal><a href=#__codelineno-0-1154>1154</a></span>
<span class=normal><a href=#__codelineno-0-1155>1155</a></span>
<span class=normal><a href=#__codelineno-0-1156>1156</a></span>
<span class=normal><a href=#__codelineno-0-1157>1157</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1134><a id=__codelineno-0-1134 name=__codelineno-0-1134></a><span class=k>def</span><span class=w> </span><span class=nf>completions_and_run_tools</span><span class=p>(</span>
</span><span id=__span-0-1135><a id=__codelineno-0-1135 name=__codelineno-0-1135></a>    <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-1136><a id=__codelineno-0-1136 name=__codelineno-0-1136></a>    <span class=n>messages</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>ChatCompletionMessageParam</span><span class=p>],</span>
</span><span id=__span-0-1137><a id=__codelineno-0-1137 name=__codelineno-0-1137></a>    <span class=n>model</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-1138><a id=__codelineno-0-1138 name=__codelineno-0-1138></a>    <span class=n>tools</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-1139><a id=__codelineno-0-1139 name=__codelineno-0-1139></a>    <span class=n>add_responses_to_messages</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-1140><a id=__codelineno-0-1140 name=__codelineno-0-1140></a>    <span class=n>agent_role_name</span><span class=o>=</span><span class=s2>&quot;assistant&quot;</span><span class=p>,</span>
</span><span id=__span-0-1141><a id=__codelineno-0-1141 name=__codelineno-0-1141></a>    <span class=n>tool_role_name</span><span class=o>=</span><span class=s2>&quot;tool&quot;</span><span class=p>,</span>
</span><span id=__span-0-1142><a id=__codelineno-0-1142 name=__codelineno-0-1142></a>    <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span>
</span><span id=__span-0-1143><a id=__codelineno-0-1143 name=__codelineno-0-1143></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>ModelResponse</span><span class=p>:</span>
</span><span id=__span-0-1144><a id=__codelineno-0-1144 name=__codelineno-0-1144></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns all completions for given messages using the given model and runs tools.&quot;&quot;&quot;</span>
</span><span id=__span-0-1145><a id=__codelineno-0-1145 name=__codelineno-0-1145></a>    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_use_llama_tool_syntax</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>tools</span><span class=p>):</span>
</span><span id=__span-0-1146><a id=__codelineno-0-1146 name=__codelineno-0-1146></a>        <span class=n>tool_prompt</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_llama_tool_prompt</span><span class=p>(</span><span class=n>tools</span><span class=p>)</span>
</span><span id=__span-0-1147><a id=__codelineno-0-1147 name=__codelineno-0-1147></a>        <span class=n>messages</span><span class=o>.</span><span class=n>append</span><span class=p>({</span><span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;system&quot;</span><span class=p>,</span> <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=n>tool_prompt</span><span class=p>})</span>
</span><span id=__span-0-1148><a id=__codelineno-0-1148 name=__codelineno-0-1148></a>    <span class=n>raw_response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_run_inference_completions</span><span class=p>(</span><span class=n>messages</span><span class=p>,</span> <span class=n>model</span><span class=p>,</span> <span class=n>stream</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>tools</span><span class=o>=</span><span class=n>tools</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span><span id=__span-0-1149><a id=__codelineno-0-1149 name=__codelineno-0-1149></a>    <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>raw_response</span><span class=p>,</span> <span class=n>ModelResponse</span><span class=p>),</span> <span class=s2>&quot;Expected ModelResponse&quot;</span>
</span><span id=__span-0-1150><a id=__codelineno-0-1150 name=__codelineno-0-1150></a>    <span class=n>response</span><span class=p>:</span> <span class=n>ModelResponse</span> <span class=o>=</span> <span class=n>raw_response</span>
</span><span id=__span-0-1151><a id=__codelineno-0-1151 name=__codelineno-0-1151></a>    <span class=k>assert</span> <span class=nb>all</span><span class=p>(</span><span class=nb>map</span><span class=p>(</span><span class=k>lambda</span> <span class=n>choice</span><span class=p>:</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>choice</span><span class=p>,</span> <span class=n>Choices</span><span class=p>),</span> <span class=n>response</span><span class=o>.</span><span class=n>choices</span><span class=p>)),</span> <span class=s2>&quot;Expected Choices&quot;</span>
</span><span id=__span-0-1152><a id=__codelineno-0-1152 name=__codelineno-0-1152></a>    <span class=n>choices</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Choices</span><span class=p>]</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>choices</span>  <span class=c1># type: ignore</span>
</span><span id=__span-0-1153><a id=__codelineno-0-1153 name=__codelineno-0-1153></a>    <span class=n>response_message</span> <span class=o>=</span> <span class=n>choices</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>message</span>
</span><span id=__span-0-1154><a id=__codelineno-0-1154 name=__codelineno-0-1154></a>
</span><span id=__span-0-1155><a id=__codelineno-0-1155 name=__codelineno-0-1155></a>    <span class=bp>self</span><span class=o>.</span><span class=n>_handle_tool_calls</span><span class=p>(</span><span class=n>response_message</span><span class=p>,</span> <span class=n>add_responses_to_messages</span><span class=p>,</span> <span class=n>agent_role_name</span><span class=p>,</span> <span class=n>tool_role_name</span><span class=p>)</span>
</span><span id=__span-0-1156><a id=__codelineno-0-1156 name=__codelineno-0-1156></a>
</span><span id=__span-0-1157><a id=__codelineno-0-1157 name=__codelineno-0-1157></a>    <span class=k>return</span> <span class=n>response</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.environment.Environment.create_snapshot class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">create_snapshot</span> <a href=#nearai.agents.environment.Environment.create_snapshot class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>create_snapshot</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n>bytes</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Create an in memory snapshot.</p> <details class=quote> <summary>Source code in <code>nearai/agents/environment.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1376>1376</a></span>
<span class=normal><a href=#__codelineno-0-1377>1377</a></span>
<span class=normal><a href=#__codelineno-0-1378>1378</a></span>
<span class=normal><a href=#__codelineno-0-1379>1379</a></span>
<span class=normal><a href=#__codelineno-0-1380>1380</a></span>
<span class=normal><a href=#__codelineno-0-1381>1381</a></span>
<span class=normal><a href=#__codelineno-0-1382>1382</a></span>
<span class=normal><a href=#__codelineno-0-1383>1383</a></span>
<span class=normal><a href=#__codelineno-0-1384>1384</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1376><a id=__codelineno-0-1376 name=__codelineno-0-1376></a><span class=k>def</span><span class=w> </span><span class=nf>create_snapshot</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bytes</span><span class=p>:</span>
</span><span id=__span-0-1377><a id=__codelineno-0-1377 name=__codelineno-0-1377></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Create an in memory snapshot.&quot;&quot;&quot;</span>
</span><span id=__span-0-1378><a id=__codelineno-0-1378 name=__codelineno-0-1378></a>    <span class=k>with</span> <span class=n>tempfile</span><span class=o>.</span><span class=n>NamedTemporaryFile</span><span class=p>(</span><span class=n>suffix</span><span class=o>=</span><span class=s2>&quot;.tar.gz&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-1379><a id=__codelineno-0-1379 name=__codelineno-0-1379></a>        <span class=k>with</span> <span class=n>tarfile</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=n>fileobj</span><span class=o>=</span><span class=n>f</span><span class=p>,</span> <span class=n>mode</span><span class=o>=</span><span class=s2>&quot;w:gz&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>tar</span><span class=p>:</span>
</span><span id=__span-0-1380><a id=__codelineno-0-1380 name=__codelineno-0-1380></a>            <span class=n>tar</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_path</span><span class=p>,</span> <span class=n>arcname</span><span class=o>=</span><span class=s2>&quot;.&quot;</span><span class=p>)</span>
</span><span id=__span-0-1381><a id=__codelineno-0-1381 name=__codelineno-0-1381></a>        <span class=n>f</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span><span id=__span-0-1382><a id=__codelineno-0-1382 name=__codelineno-0-1382></a>        <span class=n>f</span><span class=o>.</span><span class=n>seek</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span><span id=__span-0-1383><a id=__codelineno-0-1383 name=__codelineno-0-1383></a>        <span class=n>snapshot</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span><span id=__span-0-1384><a id=__codelineno-0-1384 name=__codelineno-0-1384></a>    <span class=k>return</span> <span class=n>snapshot</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.environment.Environment.environment_run_info class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">environment_run_info</span> <a href=#nearai.agents.environment.Environment.environment_run_info class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>environment_run_info</span><span class=p>(</span><span class=n>base_id</span><span class=p>,</span> <span class=n>run_type</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>dict</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Returns the environment run information.</p> <details class=quote> <summary>Source code in <code>nearai/agents/environment.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1386>1386</a></span>
<span class=normal><a href=#__codelineno-0-1387>1387</a></span>
<span class=normal><a href=#__codelineno-0-1388>1388</a></span>
<span class=normal><a href=#__codelineno-0-1389>1389</a></span>
<span class=normal><a href=#__codelineno-0-1390>1390</a></span>
<span class=normal><a href=#__codelineno-0-1391>1391</a></span>
<span class=normal><a href=#__codelineno-0-1392>1392</a></span>
<span class=normal><a href=#__codelineno-0-1393>1393</a></span>
<span class=normal><a href=#__codelineno-0-1394>1394</a></span>
<span class=normal><a href=#__codelineno-0-1395>1395</a></span>
<span class=normal><a href=#__codelineno-0-1396>1396</a></span>
<span class=normal><a href=#__codelineno-0-1397>1397</a></span>
<span class=normal><a href=#__codelineno-0-1398>1398</a></span>
<span class=normal><a href=#__codelineno-0-1399>1399</a></span>
<span class=normal><a href=#__codelineno-0-1400>1400</a></span>
<span class=normal><a href=#__codelineno-0-1401>1401</a></span>
<span class=normal><a href=#__codelineno-0-1402>1402</a></span>
<span class=normal><a href=#__codelineno-0-1403>1403</a></span>
<span class=normal><a href=#__codelineno-0-1404>1404</a></span>
<span class=normal><a href=#__codelineno-0-1405>1405</a></span>
<span class=normal><a href=#__codelineno-0-1406>1406</a></span>
<span class=normal><a href=#__codelineno-0-1407>1407</a></span>
<span class=normal><a href=#__codelineno-0-1408>1408</a></span>
<span class=normal><a href=#__codelineno-0-1409>1409</a></span>
<span class=normal><a href=#__codelineno-0-1410>1410</a></span>
<span class=normal><a href=#__codelineno-0-1411>1411</a></span>
<span class=normal><a href=#__codelineno-0-1412>1412</a></span>
<span class=normal><a href=#__codelineno-0-1413>1413</a></span>
<span class=normal><a href=#__codelineno-0-1414>1414</a></span>
<span class=normal><a href=#__codelineno-0-1415>1415</a></span>
<span class=normal><a href=#__codelineno-0-1416>1416</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1386><a id=__codelineno-0-1386 name=__codelineno-0-1386></a><span class=k>def</span><span class=w> </span><span class=nf>environment_run_info</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>base_id</span><span class=p>,</span> <span class=n>run_type</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span><span id=__span-0-1387><a id=__codelineno-0-1387 name=__codelineno-0-1387></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns the environment run information.&quot;&quot;&quot;</span>
</span><span id=__span-0-1388><a id=__codelineno-0-1388 name=__codelineno-0-1388></a>    <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_agents</span> <span class=ow>or</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_primary_agent</span><span class=p>():</span>
</span><span id=__span-0-1389><a id=__codelineno-0-1389 name=__codelineno-0-1389></a>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Agent not found&quot;</span><span class=p>)</span>
</span><span id=__span-0-1390><a id=__codelineno-0-1390 name=__codelineno-0-1390></a>    <span class=n>primary_agent</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_primary_agent</span><span class=p>()</span>
</span><span id=__span-0-1391><a id=__codelineno-0-1391 name=__codelineno-0-1391></a>
</span><span id=__span-0-1392><a id=__codelineno-0-1392 name=__codelineno-0-1392></a>    <span class=n>full_agent_name</span> <span class=o>=</span> <span class=s2>&quot;/&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=n>primary_agent</span><span class=o>.</span><span class=n>namespace</span><span class=p>,</span> <span class=n>primary_agent</span><span class=o>.</span><span class=n>name</span><span class=p>,</span> <span class=n>primary_agent</span><span class=o>.</span><span class=n>version</span><span class=p>])</span>
</span><span id=__span-0-1393><a id=__codelineno-0-1393 name=__codelineno-0-1393></a>    <span class=n>safe_agent_name</span> <span class=o>=</span> <span class=n>full_agent_name</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;/&quot;</span><span class=p>,</span> <span class=s2>&quot;_&quot;</span><span class=p>)</span>
</span><span id=__span-0-1394><a id=__codelineno-0-1394 name=__codelineno-0-1394></a>    <span class=n>uid</span> <span class=o>=</span> <span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()</span><span class=o>.</span><span class=n>hex</span>
</span><span id=__span-0-1395><a id=__codelineno-0-1395 name=__codelineno-0-1395></a>    <span class=n>generated_name</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;environment_run_</span><span class=si>{</span><span class=n>safe_agent_name</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>uid</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-1396><a id=__codelineno-0-1396 name=__codelineno-0-1396></a>    <span class=n>name</span> <span class=o>=</span> <span class=n>generated_name</span>
</span><span id=__span-0-1397><a id=__codelineno-0-1397 name=__codelineno-0-1397></a>
</span><span id=__span-0-1398><a id=__codelineno-0-1398 name=__codelineno-0-1398></a>    <span class=n>timestamp</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>(</span><span class=n>timezone</span><span class=o>.</span><span class=n>utc</span><span class=p>)</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span>
</span><span id=__span-0-1399><a id=__codelineno-0-1399 name=__codelineno-0-1399></a>    <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-0-1400><a id=__codelineno-0-1400 name=__codelineno-0-1400></a>        <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=n>name</span><span class=p>,</span>
</span><span id=__span-0-1401><a id=__codelineno-0-1401 name=__codelineno-0-1401></a>        <span class=s2>&quot;version&quot;</span><span class=p>:</span> <span class=s2>&quot;0&quot;</span><span class=p>,</span>
</span><span id=__span-0-1402><a id=__codelineno-0-1402 name=__codelineno-0-1402></a>        <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;Agent </span><span class=si>{</span><span class=n>run_type</span><span class=si>}</span><span class=s2> </span><span class=si>{</span><span class=n>full_agent_name</span><span class=si>}</span><span class=s2> </span><span class=si>{</span><span class=n>uid</span><span class=si>}</span><span class=s2> </span><span class=si>{</span><span class=n>timestamp</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-0-1403><a id=__codelineno-0-1403 name=__codelineno-0-1403></a>        <span class=s2>&quot;category&quot;</span><span class=p>:</span> <span class=s2>&quot;environment&quot;</span><span class=p>,</span>
</span><span id=__span-0-1404><a id=__codelineno-0-1404 name=__codelineno-0-1404></a>        <span class=s2>&quot;tags&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;environment&quot;</span><span class=p>],</span>
</span><span id=__span-0-1405><a id=__codelineno-0-1405 name=__codelineno-0-1405></a>        <span class=s2>&quot;details&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-0-1406><a id=__codelineno-0-1406 name=__codelineno-0-1406></a>            <span class=s2>&quot;base_id&quot;</span><span class=p>:</span> <span class=n>base_id</span><span class=p>,</span>
</span><span id=__span-0-1407><a id=__codelineno-0-1407 name=__codelineno-0-1407></a>            <span class=s2>&quot;timestamp&quot;</span><span class=p>:</span> <span class=n>timestamp</span><span class=p>,</span>
</span><span id=__span-0-1408><a id=__codelineno-0-1408 name=__codelineno-0-1408></a>            <span class=s2>&quot;agents&quot;</span><span class=p>:</span> <span class=p>[</span><span class=n>agent</span><span class=o>.</span><span class=n>name</span> <span class=k>for</span> <span class=n>agent</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>_agents</span><span class=p>],</span>
</span><span id=__span-0-1409><a id=__codelineno-0-1409 name=__codelineno-0-1409></a>            <span class=s2>&quot;primary_agent_namespace&quot;</span><span class=p>:</span> <span class=n>primary_agent</span><span class=o>.</span><span class=n>namespace</span><span class=p>,</span>
</span><span id=__span-0-1410><a id=__codelineno-0-1410 name=__codelineno-0-1410></a>            <span class=s2>&quot;primary_agent_name&quot;</span><span class=p>:</span> <span class=n>primary_agent</span><span class=o>.</span><span class=n>name</span><span class=p>,</span>
</span><span id=__span-0-1411><a id=__codelineno-0-1411 name=__codelineno-0-1411></a>            <span class=s2>&quot;primary_agent_version&quot;</span><span class=p>:</span> <span class=n>primary_agent</span><span class=o>.</span><span class=n>version</span><span class=p>,</span>
</span><span id=__span-0-1412><a id=__codelineno-0-1412 name=__codelineno-0-1412></a>            <span class=s2>&quot;run_id&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_run_id</span><span class=p>,</span>
</span><span id=__span-0-1413><a id=__codelineno-0-1413 name=__codelineno-0-1413></a>            <span class=s2>&quot;run_type&quot;</span><span class=p>:</span> <span class=n>run_type</span><span class=p>,</span>
</span><span id=__span-0-1414><a id=__codelineno-0-1414 name=__codelineno-0-1414></a>        <span class=p>},</span>
</span><span id=__span-0-1415><a id=__codelineno-0-1415 name=__codelineno-0-1415></a>        <span class=s2>&quot;show_entry&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-1416><a id=__codelineno-0-1416 name=__codelineno-0-1416></a>    <span class=p>}</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.environment.Environment.exec_command class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">exec_command</span> <a href=#nearai.agents.environment.Environment.exec_command class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>exec_command</span><span class=p>(</span><span class=n>command</span><span class=p>:</span> <span class=n>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=typing.Dict>Dict</span></span><span class=p>[</span><span class=n>str</span><span class=p>,</span> <span class=n><span title=typing.Union>Union</span></span><span class=p>[</span><span class=n>str</span><span class=p>,</span> <span class=n>int</span><span class=p>]]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Executes a command in the environment and logs the output.</p> <p>The environment does not allow running interactive programs. It will run a program for 1 second then will interrupt it if it is still running or if it is waiting for user input. command: The command to execute, like 'ls -l' or 'python3 tests.py'</p> <details class=quote> <summary>Source code in <code>nearai/agents/environment.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-987> 987</a></span>
<span class=normal><a href=#__codelineno-0-988> 988</a></span>
<span class=normal><a href=#__codelineno-0-989> 989</a></span>
<span class=normal><a href=#__codelineno-0-990> 990</a></span>
<span class=normal><a href=#__codelineno-0-991> 991</a></span>
<span class=normal><a href=#__codelineno-0-992> 992</a></span>
<span class=normal><a href=#__codelineno-0-993> 993</a></span>
<span class=normal><a href=#__codelineno-0-994> 994</a></span>
<span class=normal><a href=#__codelineno-0-995> 995</a></span>
<span class=normal><a href=#__codelineno-0-996> 996</a></span>
<span class=normal><a href=#__codelineno-0-997> 997</a></span>
<span class=normal><a href=#__codelineno-0-998> 998</a></span>
<span class=normal><a href=#__codelineno-0-999> 999</a></span>
<span class=normal><a href=#__codelineno-0-1000>1000</a></span>
<span class=normal><a href=#__codelineno-0-1001>1001</a></span>
<span class=normal><a href=#__codelineno-0-1002>1002</a></span>
<span class=normal><a href=#__codelineno-0-1003>1003</a></span>
<span class=normal><a href=#__codelineno-0-1004>1004</a></span>
<span class=normal><a href=#__codelineno-0-1005>1005</a></span>
<span class=normal><a href=#__codelineno-0-1006>1006</a></span>
<span class=normal><a href=#__codelineno-0-1007>1007</a></span>
<span class=normal><a href=#__codelineno-0-1008>1008</a></span>
<span class=normal><a href=#__codelineno-0-1009>1009</a></span>
<span class=normal><a href=#__codelineno-0-1010>1010</a></span>
<span class=normal><a href=#__codelineno-0-1011>1011</a></span>
<span class=normal><a href=#__codelineno-0-1012>1012</a></span>
<span class=normal><a href=#__codelineno-0-1013>1013</a></span>
<span class=normal><a href=#__codelineno-0-1014>1014</a></span>
<span class=normal><a href=#__codelineno-0-1015>1015</a></span>
<span class=normal><a href=#__codelineno-0-1016>1016</a></span>
<span class=normal><a href=#__codelineno-0-1017>1017</a></span>
<span class=normal><a href=#__codelineno-0-1018>1018</a></span>
<span class=normal><a href=#__codelineno-0-1019>1019</a></span>
<span class=normal><a href=#__codelineno-0-1020>1020</a></span>
<span class=normal><a href=#__codelineno-0-1021>1021</a></span>
<span class=normal><a href=#__codelineno-0-1022>1022</a></span>
<span class=normal><a href=#__codelineno-0-1023>1023</a></span>
<span class=normal><a href=#__codelineno-0-1024>1024</a></span>
<span class=normal><a href=#__codelineno-0-1025>1025</a></span>
<span class=normal><a href=#__codelineno-0-1026>1026</a></span>
<span class=normal><a href=#__codelineno-0-1027>1027</a></span>
<span class=normal><a href=#__codelineno-0-1028>1028</a></span>
<span class=normal><a href=#__codelineno-0-1029>1029</a></span>
<span class=normal><a href=#__codelineno-0-1030>1030</a></span>
<span class=normal><a href=#__codelineno-0-1031>1031</a></span>
<span class=normal><a href=#__codelineno-0-1032>1032</a></span>
<span class=normal><a href=#__codelineno-0-1033>1033</a></span>
<span class=normal><a href=#__codelineno-0-1034>1034</a></span>
<span class=normal><a href=#__codelineno-0-1035>1035</a></span>
<span class=normal><a href=#__codelineno-0-1036>1036</a></span>
<span class=normal><a href=#__codelineno-0-1037>1037</a></span>
<span class=normal><a href=#__codelineno-0-1038>1038</a></span>
<span class=normal><a href=#__codelineno-0-1039>1039</a></span>
<span class=normal><a href=#__codelineno-0-1040>1040</a></span>
<span class=normal><a href=#__codelineno-0-1041>1041</a></span>
<span class=normal><a href=#__codelineno-0-1042>1042</a></span>
<span class=normal><a href=#__codelineno-0-1043>1043</a></span>
<span class=normal><a href=#__codelineno-0-1044>1044</a></span>
<span class=normal><a href=#__codelineno-0-1045>1045</a></span>
<span class=normal><a href=#__codelineno-0-1046>1046</a></span>
<span class=normal><a href=#__codelineno-0-1047>1047</a></span>
<span class=normal><a href=#__codelineno-0-1048>1048</a></span>
<span class=normal><a href=#__codelineno-0-1049>1049</a></span>
<span class=normal><a href=#__codelineno-0-1050>1050</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-987><a id=__codelineno-0-987 name=__codelineno-0-987></a><span class=k>def</span><span class=w> </span><span class=nf>exec_command</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>command</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>int</span><span class=p>]]:</span>
</span><span id=__span-0-988><a id=__codelineno-0-988 name=__codelineno-0-988></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Executes a command in the environment and logs the output.</span>
</span><span id=__span-0-989><a id=__codelineno-0-989 name=__codelineno-0-989></a>
</span><span id=__span-0-990><a id=__codelineno-0-990 name=__codelineno-0-990></a><span class=sd>    The environment does not allow running interactive programs.</span>
</span><span id=__span-0-991><a id=__codelineno-0-991 name=__codelineno-0-991></a><span class=sd>    It will run a program for 1 second then will interrupt it if it is still running</span>
</span><span id=__span-0-992><a id=__codelineno-0-992 name=__codelineno-0-992></a><span class=sd>    or if it is waiting for user input.</span>
</span><span id=__span-0-993><a id=__codelineno-0-993 name=__codelineno-0-993></a><span class=sd>    command: The command to execute, like &#39;ls -l&#39; or &#39;python3 tests.py&#39;</span>
</span><span id=__span-0-994><a id=__codelineno-0-994 name=__codelineno-0-994></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-995><a id=__codelineno-0-995 name=__codelineno-0-995></a>    <span class=n>approval_function</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_approvals</span><span class=p>[</span><span class=s2>&quot;confirm_execution&quot;</span><span class=p>]</span> <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_approvals</span> <span class=k>else</span> <span class=kc>None</span>
</span><span id=__span-0-996><a id=__codelineno-0-996 name=__codelineno-0-996></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>approval_function</span><span class=p>:</span>
</span><span id=__span-0-997><a id=__codelineno-0-997 name=__codelineno-0-997></a>        <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-0-998><a id=__codelineno-0-998 name=__codelineno-0-998></a>            <span class=s2>&quot;stderr&quot;</span><span class=p>:</span> <span class=s2>&quot;Agent runner misconfiguration. No command execution approval function found.&quot;</span><span class=p>,</span>
</span><span id=__span-0-999><a id=__codelineno-0-999 name=__codelineno-0-999></a>        <span class=p>}</span>
</span><span id=__span-0-1000><a id=__codelineno-0-1000 name=__codelineno-0-1000></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>approval_function</span><span class=p>(</span><span class=n>command</span><span class=p>):</span>
</span><span id=__span-0-1001><a id=__codelineno-0-1001 name=__codelineno-0-1001></a>        <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-0-1002><a id=__codelineno-0-1002 name=__codelineno-0-1002></a>            <span class=s2>&quot;command&quot;</span><span class=p>:</span> <span class=n>command</span><span class=p>,</span>
</span><span id=__span-0-1003><a id=__codelineno-0-1003 name=__codelineno-0-1003></a>            <span class=s2>&quot;returncode&quot;</span><span class=p>:</span> <span class=mi>999</span><span class=p>,</span>
</span><span id=__span-0-1004><a id=__codelineno-0-1004 name=__codelineno-0-1004></a>            <span class=s2>&quot;stdout&quot;</span><span class=p>:</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-1005><a id=__codelineno-0-1005 name=__codelineno-0-1005></a>            <span class=s2>&quot;stderr&quot;</span><span class=p>:</span> <span class=s2>&quot;Command execution was not approved.&quot;</span><span class=p>,</span>
</span><span id=__span-0-1006><a id=__codelineno-0-1006 name=__codelineno-0-1006></a>        <span class=p>}</span>
</span><span id=__span-0-1007><a id=__codelineno-0-1007 name=__codelineno-0-1007></a>
</span><span id=__span-0-1008><a id=__codelineno-0-1008 name=__codelineno-0-1008></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-1009><a id=__codelineno-0-1009 name=__codelineno-0-1009></a>        <span class=n>process</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>Popen</span><span class=p>(</span>
</span><span id=__span-0-1010><a id=__codelineno-0-1010 name=__codelineno-0-1010></a>            <span class=n>shlex</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=n>command</span><span class=p>),</span>
</span><span id=__span-0-1011><a id=__codelineno-0-1011 name=__codelineno-0-1011></a>            <span class=n>stdout</span><span class=o>=</span><span class=n>subprocess</span><span class=o>.</span><span class=n>PIPE</span><span class=p>,</span>
</span><span id=__span-0-1012><a id=__codelineno-0-1012 name=__codelineno-0-1012></a>            <span class=n>stderr</span><span class=o>=</span><span class=n>subprocess</span><span class=o>.</span><span class=n>PIPE</span><span class=p>,</span>
</span><span id=__span-0-1013><a id=__codelineno-0-1013 name=__codelineno-0-1013></a>            <span class=n>bufsize</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
</span><span id=__span-0-1014><a id=__codelineno-0-1014 name=__codelineno-0-1014></a>            <span class=n>universal_newlines</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-1015><a id=__codelineno-0-1015 name=__codelineno-0-1015></a>            <span class=n>cwd</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_path</span><span class=p>,</span>
</span><span id=__span-0-1016><a id=__codelineno-0-1016 name=__codelineno-0-1016></a>        <span class=p>)</span>
</span><span id=__span-0-1017><a id=__codelineno-0-1017 name=__codelineno-0-1017></a>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-1018><a id=__codelineno-0-1018 name=__codelineno-0-1018></a>        <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-0-1019><a id=__codelineno-0-1019 name=__codelineno-0-1019></a>            <span class=s2>&quot;command&quot;</span><span class=p>:</span> <span class=n>command</span><span class=p>,</span>
</span><span id=__span-0-1020><a id=__codelineno-0-1020 name=__codelineno-0-1020></a>            <span class=s2>&quot;returncode&quot;</span><span class=p>:</span> <span class=mi>999</span><span class=p>,</span>
</span><span id=__span-0-1021><a id=__codelineno-0-1021 name=__codelineno-0-1021></a>            <span class=s2>&quot;stdout&quot;</span><span class=p>:</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-1022><a id=__codelineno-0-1022 name=__codelineno-0-1022></a>            <span class=s2>&quot;stderr&quot;</span><span class=p>:</span> <span class=s2>&quot;Failed to execute: &quot;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>),</span>
</span><span id=__span-0-1023><a id=__codelineno-0-1023 name=__codelineno-0-1023></a>        <span class=p>}</span>
</span><span id=__span-0-1024><a id=__codelineno-0-1024 name=__codelineno-0-1024></a>
</span><span id=__span-0-1025><a id=__codelineno-0-1025 name=__codelineno-0-1025></a>    <span class=n>msg</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-1026><a id=__codelineno-0-1026 name=__codelineno-0-1026></a>
</span><span id=__span-0-1027><a id=__codelineno-0-1027 name=__codelineno-0-1027></a>    <span class=k>def</span><span class=w> </span><span class=nf>kill_process_tree</span><span class=p>(</span><span class=n>p</span><span class=p>:</span> <span class=n>Any</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-1028><a id=__codelineno-0-1028 name=__codelineno-0-1028></a>        <span class=k>nonlocal</span> <span class=n>msg</span>
</span><span id=__span-0-1029><a id=__codelineno-0-1029 name=__codelineno-0-1029></a>        <span class=n>msg</span> <span class=o>=</span> <span class=s2>&quot;Killing process due to timeout&quot;</span>
</span><span id=__span-0-1030><a id=__codelineno-0-1030 name=__codelineno-0-1030></a>
</span><span id=__span-0-1031><a id=__codelineno-0-1031 name=__codelineno-0-1031></a>        <span class=n>process</span> <span class=o>=</span> <span class=n>psutil</span><span class=o>.</span><span class=n>Process</span><span class=p>(</span><span class=n>p</span><span class=o>.</span><span class=n>pid</span><span class=p>)</span>
</span><span id=__span-0-1032><a id=__codelineno-0-1032 name=__codelineno-0-1032></a>        <span class=k>for</span> <span class=n>proc</span> <span class=ow>in</span> <span class=n>process</span><span class=o>.</span><span class=n>children</span><span class=p>(</span><span class=n>recursive</span><span class=o>=</span><span class=kc>True</span><span class=p>):</span>
</span><span id=__span-0-1033><a id=__codelineno-0-1033 name=__codelineno-0-1033></a>            <span class=n>proc</span><span class=o>.</span><span class=n>kill</span><span class=p>()</span>
</span><span id=__span-0-1034><a id=__codelineno-0-1034 name=__codelineno-0-1034></a>        <span class=n>process</span><span class=o>.</span><span class=n>kill</span><span class=p>()</span>
</span><span id=__span-0-1035><a id=__codelineno-0-1035 name=__codelineno-0-1035></a>
</span><span id=__span-0-1036><a id=__codelineno-0-1036 name=__codelineno-0-1036></a>    <span class=n>timer</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Timer</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=n>kill_process_tree</span><span class=p>,</span> <span class=p>(</span><span class=n>process</span><span class=p>,))</span>
</span><span id=__span-0-1037><a id=__codelineno-0-1037 name=__codelineno-0-1037></a>    <span class=n>timer</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span><span id=__span-0-1038><a id=__codelineno-0-1038 name=__codelineno-0-1038></a>    <span class=n>process</span><span class=o>.</span><span class=n>wait</span><span class=p>()</span>
</span><span id=__span-0-1039><a id=__codelineno-0-1039 name=__codelineno-0-1039></a>    <span class=n>timer</span><span class=o>.</span><span class=n>cancel</span><span class=p>()</span>
</span><span id=__span-0-1040><a id=__codelineno-0-1040 name=__codelineno-0-1040></a>
</span><span id=__span-0-1041><a id=__codelineno-0-1041 name=__codelineno-0-1041></a>    <span class=n>result</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-1042><a id=__codelineno-0-1042 name=__codelineno-0-1042></a>        <span class=s2>&quot;command&quot;</span><span class=p>:</span> <span class=n>command</span><span class=p>,</span>
</span><span id=__span-0-1043><a id=__codelineno-0-1043 name=__codelineno-0-1043></a>        <span class=s2>&quot;stdout&quot;</span><span class=p>:</span> <span class=n>process</span><span class=o>.</span><span class=n>stdout</span><span class=o>.</span><span class=n>read</span><span class=p>()</span> <span class=k>if</span> <span class=n>process</span><span class=o>.</span><span class=n>stdout</span> <span class=ow>and</span> <span class=nb>hasattr</span><span class=p>(</span><span class=n>process</span><span class=o>.</span><span class=n>stdout</span><span class=p>,</span> <span class=s2>&quot;read&quot;</span><span class=p>)</span> <span class=k>else</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-1044><a id=__codelineno-0-1044 name=__codelineno-0-1044></a>        <span class=s2>&quot;stderr&quot;</span><span class=p>:</span> <span class=n>process</span><span class=o>.</span><span class=n>stderr</span><span class=o>.</span><span class=n>read</span><span class=p>()</span> <span class=k>if</span> <span class=n>process</span><span class=o>.</span><span class=n>stderr</span> <span class=ow>and</span> <span class=nb>hasattr</span><span class=p>(</span><span class=n>process</span><span class=o>.</span><span class=n>stderr</span><span class=p>,</span> <span class=s2>&quot;read&quot;</span><span class=p>)</span> <span class=k>else</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-1045><a id=__codelineno-0-1045 name=__codelineno-0-1045></a>        <span class=s2>&quot;returncode&quot;</span><span class=p>:</span> <span class=n>process</span><span class=o>.</span><span class=n>returncode</span><span class=p>,</span>
</span><span id=__span-0-1046><a id=__codelineno-0-1046 name=__codelineno-0-1046></a>        <span class=s2>&quot;msg&quot;</span><span class=p>:</span> <span class=n>msg</span><span class=p>,</span>
</span><span id=__span-0-1047><a id=__codelineno-0-1047 name=__codelineno-0-1047></a>    <span class=p>}</span>
</span><span id=__span-0-1048><a id=__codelineno-0-1048 name=__codelineno-0-1048></a>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_path</span><span class=p>,</span> <span class=n>TERMINAL_FILENAME</span><span class=p>),</span> <span class=s2>&quot;a&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-1049><a id=__codelineno-0-1049 name=__codelineno-0-1049></a>        <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>result</span><span class=p>)</span> <span class=o>+</span> <span class=n>DELIMITER</span><span class=p>)</span>
</span><span id=__span-0-1050><a id=__codelineno-0-1050 name=__codelineno-0-1050></a>    <span class=k>return</span> <span class=n>result</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.environment.Environment.generate_folder_hash_id class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">generate_folder_hash_id</span> <a href=#nearai.agents.environment.Environment.generate_folder_hash_id class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>generate_folder_hash_id</span><span class=p>(</span><span class=n>path</span><span class=p>:</span> <span class=n>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>str</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Returns hash based on files and their contents in path, including subfolders.</p> <details class=quote> <summary>Source code in <code>nearai/agents/environment.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1503>1503</a></span>
<span class=normal><a href=#__codelineno-0-1504>1504</a></span>
<span class=normal><a href=#__codelineno-0-1505>1505</a></span>
<span class=normal><a href=#__codelineno-0-1506>1506</a></span>
<span class=normal><a href=#__codelineno-0-1507>1507</a></span>
<span class=normal><a href=#__codelineno-0-1508>1508</a></span>
<span class=normal><a href=#__codelineno-0-1509>1509</a></span>
<span class=normal><a href=#__codelineno-0-1510>1510</a></span>
<span class=normal><a href=#__codelineno-0-1511>1511</a></span>
<span class=normal><a href=#__codelineno-0-1512>1512</a></span>
<span class=normal><a href=#__codelineno-0-1513>1513</a></span>
<span class=normal><a href=#__codelineno-0-1514>1514</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1503><a id=__codelineno-0-1503 name=__codelineno-0-1503></a><span class=k>def</span><span class=w> </span><span class=nf>generate_folder_hash_id</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-0-1504><a id=__codelineno-0-1504 name=__codelineno-0-1504></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns hash based on files and their contents in path, including subfolders.&quot;&quot;&quot;</span>  <span class=c1># noqa: E501</span>
</span><span id=__span-0-1505><a id=__codelineno-0-1505 name=__codelineno-0-1505></a>    <span class=n>hash_obj</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>()</span>
</span><span id=__span-0-1506><a id=__codelineno-0-1506 name=__codelineno-0-1506></a>
</span><span id=__span-0-1507><a id=__codelineno-0-1507 name=__codelineno-0-1507></a>    <span class=k>for</span> <span class=n>root</span><span class=p>,</span> <span class=n>_dirs</span><span class=p>,</span> <span class=n>files</span> <span class=ow>in</span> <span class=n>os</span><span class=o>.</span><span class=n>walk</span><span class=p>(</span><span class=n>path</span><span class=p>):</span>
</span><span id=__span-0-1508><a id=__codelineno-0-1508 name=__codelineno-0-1508></a>        <span class=k>for</span> <span class=n>file</span> <span class=ow>in</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>files</span><span class=p>):</span>
</span><span id=__span-0-1509><a id=__codelineno-0-1509 name=__codelineno-0-1509></a>            <span class=n>file_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>root</span><span class=p>,</span> <span class=n>file</span><span class=p>)</span>
</span><span id=__span-0-1510><a id=__codelineno-0-1510 name=__codelineno-0-1510></a>            <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=s2>&quot;rb&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-1511><a id=__codelineno-0-1511 name=__codelineno-0-1511></a>                <span class=k>while</span> <span class=n>chunk</span> <span class=o>:=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>(</span><span class=mi>8192</span><span class=p>):</span>
</span><span id=__span-0-1512><a id=__codelineno-0-1512 name=__codelineno-0-1512></a>                    <span class=n>hash_obj</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>chunk</span><span class=p>)</span>
</span><span id=__span-0-1513><a id=__codelineno-0-1513 name=__codelineno-0-1513></a>
</span><span id=__span-0-1514><a id=__codelineno-0-1514 name=__codelineno-0-1514></a>    <span class=k>return</span> <span class=n>hash_obj</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.environment.Environment.get_agent_temp_path class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_agent_temp_path</span> <a href=#nearai.agents.environment.Environment.get_agent_temp_path class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>get_agent_temp_path</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n><span title=pathlib.Path>Path</span></span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Returns temp dir for primary agent where execution happens.</p> <details class=quote> <summary>Source code in <code>nearai/agents/environment.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-930>930</a></span>
<span class=normal><a href=#__codelineno-0-931>931</a></span>
<span class=normal><a href=#__codelineno-0-932>932</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-930><a id=__codelineno-0-930 name=__codelineno-0-930></a><span class=k>def</span><span class=w> </span><span class=nf>get_agent_temp_path</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Path</span><span class=p>:</span>
</span><span id=__span-0-931><a id=__codelineno-0-931 name=__codelineno-0-931></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns temp dir for primary agent where execution happens.&quot;&quot;&quot;</span>
</span><span id=__span-0-932><a id=__codelineno-0-932 name=__codelineno-0-932></a>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_primary_agent_temp_dir</span><span class=p>()</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.environment.Environment.get_agents class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_agents</span> <a href=#nearai.agents.environment.Environment.get_agents class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>get_agents</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n><span title=typing.List>List</span></span><span class=p>[</span><span class=n><a class="autorefs autorefs-internal" title=nearai.agents.agent.Agent href=#nearai.agents.agent.Agent>Agent</a></span><span class=p>]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Returns list of agents available in environment.</p> <details class=quote> <summary>Source code in <code>nearai/agents/environment.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1361>1361</a></span>
<span class=normal><a href=#__codelineno-0-1362>1362</a></span>
<span class=normal><a href=#__codelineno-0-1363>1363</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1361><a id=__codelineno-0-1361 name=__codelineno-0-1361></a><span class=k>def</span><span class=w> </span><span class=nf>get_agents</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Agent</span><span class=p>]:</span>
</span><span id=__span-0-1362><a id=__codelineno-0-1362 name=__codelineno-0-1362></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns list of agents available in environment.&quot;&quot;&quot;</span>
</span><span id=__span-0-1363><a id=__codelineno-0-1363 name=__codelineno-0-1363></a>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_agents</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.environment.Environment.get_inference_parameters class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_inference_parameters</span> <a href=#nearai.agents.environment.Environment.get_inference_parameters class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>get_inference_parameters</span><span class=p>(</span><span class=n>messages</span><span class=p>:</span> <span class=n><span title=typing.Union>Union</span></span><span class=p>[</span><span class=n><span title=typing.Iterable>Iterable</span></span><span class=p>[</span><span class=n><span title=litellm.types.completion.ChatCompletionMessageParam>ChatCompletionMessageParam</span></span><span class=p>],</span> <span class=n>str</span><span class=p>],</span> <span class=n>model</span><span class=p>:</span> <span class=n><span title=typing.Union>Union</span></span><span class=p>[</span><span class=n><span title=typing.Iterable>Iterable</span></span><span class=p>[</span><span class=n><span title=litellm.types.completion.ChatCompletionMessageParam>ChatCompletionMessageParam</span></span><span class=p>],</span> <span class=n>str</span><span class=p>],</span> <span class=n>stream</span><span class=p>:</span> <span class=n>bool</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n><span title=typing.Any>Any</span></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=typing.Tuple>Tuple</span></span><span class=p>[</span><span class=n><span title=nearai.agents.environment.InferenceParameters>InferenceParameters</span></span><span class=p>,</span> <span class=n><span title=typing.Any>Any</span></span><span class=p>]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Run inference parameters to run completions.</p> <details class=quote> <summary>Source code in <code>nearai/agents/environment.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1052>1052</a></span>
<span class=normal><a href=#__codelineno-0-1053>1053</a></span>
<span class=normal><a href=#__codelineno-0-1054>1054</a></span>
<span class=normal><a href=#__codelineno-0-1055>1055</a></span>
<span class=normal><a href=#__codelineno-0-1056>1056</a></span>
<span class=normal><a href=#__codelineno-0-1057>1057</a></span>
<span class=normal><a href=#__codelineno-0-1058>1058</a></span>
<span class=normal><a href=#__codelineno-0-1059>1059</a></span>
<span class=normal><a href=#__codelineno-0-1060>1060</a></span>
<span class=normal><a href=#__codelineno-0-1061>1061</a></span>
<span class=normal><a href=#__codelineno-0-1062>1062</a></span>
<span class=normal><a href=#__codelineno-0-1063>1063</a></span>
<span class=normal><a href=#__codelineno-0-1064>1064</a></span>
<span class=normal><a href=#__codelineno-0-1065>1065</a></span>
<span class=normal><a href=#__codelineno-0-1066>1066</a></span>
<span class=normal><a href=#__codelineno-0-1067>1067</a></span>
<span class=normal><a href=#__codelineno-0-1068>1068</a></span>
<span class=normal><a href=#__codelineno-0-1069>1069</a></span>
<span class=normal><a href=#__codelineno-0-1070>1070</a></span>
<span class=normal><a href=#__codelineno-0-1071>1071</a></span>
<span class=normal><a href=#__codelineno-0-1072>1072</a></span>
<span class=normal><a href=#__codelineno-0-1073>1073</a></span>
<span class=normal><a href=#__codelineno-0-1074>1074</a></span>
<span class=normal><a href=#__codelineno-0-1075>1075</a></span>
<span class=normal><a href=#__codelineno-0-1076>1076</a></span>
<span class=normal><a href=#__codelineno-0-1077>1077</a></span>
<span class=normal><a href=#__codelineno-0-1078>1078</a></span>
<span class=normal><a href=#__codelineno-0-1079>1079</a></span>
<span class=normal><a href=#__codelineno-0-1080>1080</a></span>
<span class=normal><a href=#__codelineno-0-1081>1081</a></span>
<span class=normal><a href=#__codelineno-0-1082>1082</a></span>
<span class=normal><a href=#__codelineno-0-1083>1083</a></span>
<span class=normal><a href=#__codelineno-0-1084>1084</a></span>
<span class=normal><a href=#__codelineno-0-1085>1085</a></span>
<span class=normal><a href=#__codelineno-0-1086>1086</a></span>
<span class=normal><a href=#__codelineno-0-1087>1087</a></span>
<span class=normal><a href=#__codelineno-0-1088>1088</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1052><a id=__codelineno-0-1052 name=__codelineno-0-1052></a><span class=k>def</span><span class=w> </span><span class=nf>get_inference_parameters</span><span class=p>(</span>
</span><span id=__span-0-1053><a id=__codelineno-0-1053 name=__codelineno-0-1053></a>    <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-1054><a id=__codelineno-0-1054 name=__codelineno-0-1054></a>    <span class=n>messages</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Iterable</span><span class=p>[</span><span class=n>ChatCompletionMessageParam</span><span class=p>],</span> <span class=nb>str</span><span class=p>],</span>
</span><span id=__span-0-1055><a id=__codelineno-0-1055 name=__codelineno-0-1055></a>    <span class=n>model</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Iterable</span><span class=p>[</span><span class=n>ChatCompletionMessageParam</span><span class=p>],</span> <span class=nb>str</span><span class=p>],</span>
</span><span id=__span-0-1056><a id=__codelineno-0-1056 name=__codelineno-0-1056></a>    <span class=n>stream</span><span class=p>:</span> <span class=nb>bool</span><span class=p>,</span>
</span><span id=__span-0-1057><a id=__codelineno-0-1057 name=__codelineno-0-1057></a>    <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span>
</span><span id=__span-0-1058><a id=__codelineno-0-1058 name=__codelineno-0-1058></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=n>InferenceParameters</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span><span id=__span-0-1059><a id=__codelineno-0-1059 name=__codelineno-0-1059></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Run inference parameters to run completions.&quot;&quot;&quot;</span>
</span><span id=__span-0-1060><a id=__codelineno-0-1060 name=__codelineno-0-1060></a>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>messages</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-1061><a id=__codelineno-0-1061 name=__codelineno-0-1061></a>        <span class=bp>self</span><span class=o>.</span><span class=n>add_system_log</span><span class=p>(</span>
</span><span id=__span-0-1062><a id=__codelineno-0-1062 name=__codelineno-0-1062></a>            <span class=s2>&quot;Deprecated completions call. Pass `messages` as a first parameter.&quot;</span><span class=p>,</span>
</span><span id=__span-0-1063><a id=__codelineno-0-1063 name=__codelineno-0-1063></a>            <span class=n>logging</span><span class=o>.</span><span class=n>WARNING</span><span class=p>,</span>
</span><span id=__span-0-1064><a id=__codelineno-0-1064 name=__codelineno-0-1064></a>        <span class=p>)</span>
</span><span id=__span-0-1065><a id=__codelineno-0-1065 name=__codelineno-0-1065></a>        <span class=n>messages_or_model</span> <span class=o>=</span> <span class=n>messages</span>
</span><span id=__span-0-1066><a id=__codelineno-0-1066 name=__codelineno-0-1066></a>        <span class=n>model_or_messages</span> <span class=o>=</span> <span class=n>model</span>
</span><span id=__span-0-1067><a id=__codelineno-0-1067 name=__codelineno-0-1067></a>        <span class=n>model</span> <span class=o>=</span> <span class=n>cast</span><span class=p>(</span><span class=nb>str</span><span class=p>,</span> <span class=n>messages_or_model</span><span class=p>)</span>
</span><span id=__span-0-1068><a id=__codelineno-0-1068 name=__codelineno-0-1068></a>        <span class=n>messages</span> <span class=o>=</span> <span class=n>cast</span><span class=p>(</span><span class=n>Iterable</span><span class=p>[</span><span class=n>ChatCompletionMessageParam</span><span class=p>],</span> <span class=n>model_or_messages</span><span class=p>)</span>
</span><span id=__span-0-1069><a id=__codelineno-0-1069 name=__codelineno-0-1069></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-1070><a id=__codelineno-0-1070 name=__codelineno-0-1070></a>        <span class=n>model</span> <span class=o>=</span> <span class=n>cast</span><span class=p>(</span><span class=nb>str</span><span class=p>,</span> <span class=n>model</span><span class=p>)</span>
</span><span id=__span-0-1071><a id=__codelineno-0-1071 name=__codelineno-0-1071></a>        <span class=n>messages</span> <span class=o>=</span> <span class=n>cast</span><span class=p>(</span><span class=n>Iterable</span><span class=p>[</span><span class=n>ChatCompletionMessageParam</span><span class=p>],</span> <span class=n>messages</span><span class=p>)</span>
</span><span id=__span-0-1072><a id=__codelineno-0-1072 name=__codelineno-0-1072></a>    <span class=n>model</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_model_for_inference</span><span class=p>(</span><span class=n>model</span><span class=p>)</span>
</span><span id=__span-0-1073><a id=__codelineno-0-1073 name=__codelineno-0-1073></a>    <span class=k>if</span> <span class=n>model</span> <span class=o>!=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_last_used_model</span><span class=p>:</span>
</span><span id=__span-0-1074><a id=__codelineno-0-1074 name=__codelineno-0-1074></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_last_used_model</span> <span class=o>=</span> <span class=n>model</span>
</span><span id=__span-0-1075><a id=__codelineno-0-1075 name=__codelineno-0-1075></a>        <span class=bp>self</span><span class=o>.</span><span class=n>add_system_log</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Connecting to </span><span class=si>{</span><span class=n>model</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-1076><a id=__codelineno-0-1076 name=__codelineno-0-1076></a>
</span><span id=__span-0-1077><a id=__codelineno-0-1077 name=__codelineno-0-1077></a>    <span class=n>temperature</span> <span class=o>=</span> <span class=n>kwargs</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;temperature&quot;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_primary_agent</span><span class=p>()</span><span class=o>.</span><span class=n>model_temperature</span> <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_agents</span> <span class=k>else</span> <span class=kc>None</span><span class=p>)</span>
</span><span id=__span-0-1078><a id=__codelineno-0-1078 name=__codelineno-0-1078></a>    <span class=n>max_tokens</span> <span class=o>=</span> <span class=n>kwargs</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;max_tokens&quot;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_primary_agent</span><span class=p>()</span><span class=o>.</span><span class=n>model_max_tokens</span> <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_agents</span> <span class=k>else</span> <span class=kc>None</span><span class=p>)</span>
</span><span id=__span-0-1079><a id=__codelineno-0-1079 name=__codelineno-0-1079></a>
</span><span id=__span-0-1080><a id=__codelineno-0-1080 name=__codelineno-0-1080></a>    <span class=n>params</span> <span class=o>=</span> <span class=n>InferenceParameters</span><span class=p>(</span>
</span><span id=__span-0-1081><a id=__codelineno-0-1081 name=__codelineno-0-1081></a>        <span class=n>model</span><span class=o>=</span><span class=n>model</span><span class=p>,</span>
</span><span id=__span-0-1082><a id=__codelineno-0-1082 name=__codelineno-0-1082></a>        <span class=n>messages</span><span class=o>=</span><span class=n>messages</span><span class=p>,</span>
</span><span id=__span-0-1083><a id=__codelineno-0-1083 name=__codelineno-0-1083></a>        <span class=n>stream</span><span class=o>=</span><span class=n>stream</span><span class=p>,</span>
</span><span id=__span-0-1084><a id=__codelineno-0-1084 name=__codelineno-0-1084></a>        <span class=n>temperature</span><span class=o>=</span><span class=n>temperature</span><span class=p>,</span>
</span><span id=__span-0-1085><a id=__codelineno-0-1085 name=__codelineno-0-1085></a>        <span class=n>max_tokens</span><span class=o>=</span><span class=n>max_tokens</span><span class=p>,</span>
</span><span id=__span-0-1086><a id=__codelineno-0-1086 name=__codelineno-0-1086></a>    <span class=p>)</span>
</span><span id=__span-0-1087><a id=__codelineno-0-1087 name=__codelineno-0-1087></a>
</span><span id=__span-0-1088><a id=__codelineno-0-1088 name=__codelineno-0-1088></a>    <span class=k>return</span> <span class=n>params</span><span class=p>,</span> <span class=n>kwargs</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.environment.Environment.get_last_message class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_last_message</span> <a href=#nearai.agents.environment.Environment.get_last_message class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>get_last_message</span><span class=p>(</span><span class=n>role</span><span class=p>:</span> <span class=n>str</span> <span class=o>=</span> <span class=s1>&#39;user&#39;</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Reads last message from the given role and returns it.</p> <details class=quote> <summary>Source code in <code>nearai/agents/environment.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-777>777</a></span>
<span class=normal><a href=#__codelineno-0-778>778</a></span>
<span class=normal><a href=#__codelineno-0-779>779</a></span>
<span class=normal><a href=#__codelineno-0-780>780</a></span>
<span class=normal><a href=#__codelineno-0-781>781</a></span>
<span class=normal><a href=#__codelineno-0-782>782</a></span>
<span class=normal><a href=#__codelineno-0-783>783</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-777><a id=__codelineno-0-777 name=__codelineno-0-777></a><span class=k>def</span><span class=w> </span><span class=nf>get_last_message</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>role</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;user&quot;</span><span class=p>):</span>
</span><span id=__span-0-778><a id=__codelineno-0-778 name=__codelineno-0-778></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Reads last message from the given role and returns it.&quot;&quot;&quot;</span>
</span><span id=__span-0-779><a id=__codelineno-0-779 name=__codelineno-0-779></a>    <span class=k>for</span> <span class=n>message</span> <span class=ow>in</span> <span class=nb>reversed</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>list_messages</span><span class=p>()):</span>
</span><span id=__span-0-780><a id=__codelineno-0-780 name=__codelineno-0-780></a>        <span class=k>if</span> <span class=n>message</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;role&quot;</span><span class=p>)</span> <span class=o>==</span> <span class=n>role</span><span class=p>:</span>
</span><span id=__span-0-781><a id=__codelineno-0-781 name=__codelineno-0-781></a>            <span class=k>return</span> <span class=n>message</span>
</span><span id=__span-0-782><a id=__codelineno-0-782 name=__codelineno-0-782></a>
</span><span id=__span-0-783><a id=__codelineno-0-783 name=__codelineno-0-783></a>    <span class=k>return</span> <span class=kc>None</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.environment.Environment.get_primary_agent class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_primary_agent</span> <a href=#nearai.agents.environment.Environment.get_primary_agent class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>get_primary_agent</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n><a class="autorefs autorefs-internal" title=nearai.agents.agent.Agent href=#nearai.agents.agent.Agent>Agent</a></span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Returns the agent that is invoked first.</p> <details class=quote> <summary>Source code in <code>nearai/agents/environment.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1365>1365</a></span>
<span class=normal><a href=#__codelineno-0-1366>1366</a></span>
<span class=normal><a href=#__codelineno-0-1367>1367</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1365><a id=__codelineno-0-1365 name=__codelineno-0-1365></a><span class=k>def</span><span class=w> </span><span class=nf>get_primary_agent</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Agent</span><span class=p>:</span>
</span><span id=__span-0-1366><a id=__codelineno-0-1366 name=__codelineno-0-1366></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns the agent that is invoked first.&quot;&quot;&quot;</span>
</span><span id=__span-0-1367><a id=__codelineno-0-1367 name=__codelineno-0-1367></a>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_agents</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.environment.Environment.get_primary_agent_temp_dir class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_primary_agent_temp_dir</span> <a href=#nearai.agents.environment.Environment.get_primary_agent_temp_dir class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>get_primary_agent_temp_dir</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n><span title=pathlib.Path>Path</span></span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Returns temp dir for primary agent.</p> <details class=quote> <summary>Source code in <code>nearai/agents/environment.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1369>1369</a></span>
<span class=normal><a href=#__codelineno-0-1370>1370</a></span>
<span class=normal><a href=#__codelineno-0-1371>1371</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1369><a id=__codelineno-0-1369 name=__codelineno-0-1369></a><span class=k>def</span><span class=w> </span><span class=nf>get_primary_agent_temp_dir</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Path</span><span class=p>:</span>
</span><span id=__span-0-1370><a id=__codelineno-0-1370 name=__codelineno-0-1370></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns temp dir for primary agent.&quot;&quot;&quot;</span>
</span><span id=__span-0-1371><a id=__codelineno-0-1371 name=__codelineno-0-1371></a>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_primary_agent</span><span class=p>()</span><span class=o>.</span><span class=n>temp_dir</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.environment.Environment.get_system_path class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_system_path</span> <a href=#nearai.agents.environment.Environment.get_system_path class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>get_system_path</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n><span title=pathlib.Path>Path</span></span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Returns the system path where chat.txt &amp; system_log are stored.</p> <details class=quote> <summary>Source code in <code>nearai/agents/environment.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-926>926</a></span>
<span class=normal><a href=#__codelineno-0-927>927</a></span>
<span class=normal><a href=#__codelineno-0-928>928</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-926><a id=__codelineno-0-926 name=__codelineno-0-926></a><span class=k>def</span><span class=w> </span><span class=nf>get_system_path</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Path</span><span class=p>:</span>
</span><span id=__span-0-927><a id=__codelineno-0-927 name=__codelineno-0-927></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns the system path where chat.txt &amp; system_log are stored.&quot;&quot;&quot;</span>
</span><span id=__span-0-928><a id=__codelineno-0-928 name=__codelineno-0-928></a>    <span class=k>return</span> <span class=n>Path</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_path</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.environment.Environment.get_tool_registry class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_tool_registry</span> <a href=#nearai.agents.environment.Environment.get_tool_registry class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>get_tool_registry</span><span class=p>(</span><span class=n>new</span><span class=p>:</span> <span class=n>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><a class="autorefs autorefs-internal" title=nearai.agents.tool_registry.ToolRegistry href=#nearai.agents.tool_registry.ToolRegistry>ToolRegistry</a></span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Returns the tool registry, a dictionary of tools that can be called by the agent.</p> <details class=quote> <summary>Source code in <code>nearai/agents/environment.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-762>762</a></span>
<span class=normal><a href=#__codelineno-0-763>763</a></span>
<span class=normal><a href=#__codelineno-0-764>764</a></span>
<span class=normal><a href=#__codelineno-0-765>765</a></span>
<span class=normal><a href=#__codelineno-0-766>766</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-762><a id=__codelineno-0-762 name=__codelineno-0-762></a><span class=k>def</span><span class=w> </span><span class=nf>get_tool_registry</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>new</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>ToolRegistry</span><span class=p>:</span>
</span><span id=__span-0-763><a id=__codelineno-0-763 name=__codelineno-0-763></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns the tool registry, a dictionary of tools that can be called by the agent.&quot;&quot;&quot;</span>
</span><span id=__span-0-764><a id=__codelineno-0-764 name=__codelineno-0-764></a>    <span class=k>if</span> <span class=n>new</span><span class=p>:</span>
</span><span id=__span-0-765><a id=__codelineno-0-765 name=__codelineno-0-765></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_tools</span> <span class=o>=</span> <span class=n>ToolRegistry</span><span class=p>()</span>
</span><span id=__span-0-766><a id=__codelineno-0-766 name=__codelineno-0-766></a>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_tools</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.environment.Environment.list_files class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">list_files</span> <a href=#nearai.agents.environment.Environment.list_files class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>list_files</span><span class=p>(</span><span class=n>path</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>order</span><span class=p>:</span> <span class=n><span title=typing.Literal>Literal</span></span><span class=p>[</span><span class=s1>&#39;asc&#39;</span><span class=p>,</span> <span class=s1>&#39;desc&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;asc&#39;</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=typing.List>List</span></span><span class=p>[</span><span class=n>str</span><span class=p>]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Lists files in the environment.</p> <details class=quote> <summary>Source code in <code>nearai/agents/environment.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-922>922</a></span>
<span class=normal><a href=#__codelineno-0-923>923</a></span>
<span class=normal><a href=#__codelineno-0-924>924</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-922><a id=__codelineno-0-922 name=__codelineno-0-922></a><span class=k>def</span><span class=w> </span><span class=nf>list_files</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>order</span><span class=p>:</span> <span class=n>Literal</span><span class=p>[</span><span class=s2>&quot;asc&quot;</span><span class=p>,</span> <span class=s2>&quot;desc&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;asc&quot;</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
</span><span id=__span-0-923><a id=__codelineno-0-923 name=__codelineno-0-923></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Lists files in the environment.&quot;&quot;&quot;</span>
</span><span id=__span-0-924><a id=__codelineno-0-924 name=__codelineno-0-924></a>    <span class=k>return</span> <span class=n>os</span><span class=o>.</span><span class=n>listdir</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>get_primary_agent_temp_dir</span><span class=p>(),</span> <span class=n>path</span><span class=p>))</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.environment.Environment.list_messages class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">list_messages</span> <a href=#nearai.agents.environment.Environment.list_messages class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>list_messages</span><span class=p>(</span><span class=n>thread_id</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>limit</span><span class=p>:</span> <span class=n><span title=typing.Union>Union</span></span><span class=p>[</span><span class=n>int</span><span class=p>,</span> <span class=n><span title=openai.NotGiven>NotGiven</span></span><span class=p>]</span> <span class=o>=</span> <span class=mi>200</span><span class=p>,</span> <span class=n>order</span><span class=p>:</span> <span class=n><span title=typing.Literal>Literal</span></span><span class=p>[</span><span class=s1>&#39;asc&#39;</span><span class=p>,</span> <span class=s1>&#39;desc&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;asc&#39;</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Backwards compatibility for chat_completions messages.</p> <details class=quote> <summary>Source code in <code>nearai/agents/environment.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-873>873</a></span>
<span class=normal><a href=#__codelineno-0-874>874</a></span>
<span class=normal><a href=#__codelineno-0-875>875</a></span>
<span class=normal><a href=#__codelineno-0-876>876</a></span>
<span class=normal><a href=#__codelineno-0-877>877</a></span>
<span class=normal><a href=#__codelineno-0-878>878</a></span>
<span class=normal><a href=#__codelineno-0-879>879</a></span>
<span class=normal><a href=#__codelineno-0-880>880</a></span>
<span class=normal><a href=#__codelineno-0-881>881</a></span>
<span class=normal><a href=#__codelineno-0-882>882</a></span>
<span class=normal><a href=#__codelineno-0-883>883</a></span>
<span class=normal><a href=#__codelineno-0-884>884</a></span>
<span class=normal><a href=#__codelineno-0-885>885</a></span>
<span class=normal><a href=#__codelineno-0-886>886</a></span>
<span class=normal><a href=#__codelineno-0-887>887</a></span>
<span class=normal><a href=#__codelineno-0-888>888</a></span>
<span class=normal><a href=#__codelineno-0-889>889</a></span>
<span class=normal><a href=#__codelineno-0-890>890</a></span>
<span class=normal><a href=#__codelineno-0-891>891</a></span>
<span class=normal><a href=#__codelineno-0-892>892</a></span>
<span class=normal><a href=#__codelineno-0-893>893</a></span>
<span class=normal><a href=#__codelineno-0-894>894</a></span>
<span class=normal><a href=#__codelineno-0-895>895</a></span>
<span class=normal><a href=#__codelineno-0-896>896</a></span>
<span class=normal><a href=#__codelineno-0-897>897</a></span>
<span class=normal><a href=#__codelineno-0-898>898</a></span>
<span class=normal><a href=#__codelineno-0-899>899</a></span>
<span class=normal><a href=#__codelineno-0-900>900</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-873><a id=__codelineno-0-873 name=__codelineno-0-873></a><span class=k>def</span><span class=w> </span><span class=nf>list_messages</span><span class=p>(</span>
</span><span id=__span-0-874><a id=__codelineno-0-874 name=__codelineno-0-874></a>    <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-875><a id=__codelineno-0-875 name=__codelineno-0-875></a>    <span class=n>thread_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-876><a id=__codelineno-0-876 name=__codelineno-0-876></a>    <span class=n>limit</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=n>NotGiven</span><span class=p>]</span> <span class=o>=</span> <span class=mi>200</span><span class=p>,</span>  <span class=c1># api defaults to 20</span>
</span><span id=__span-0-877><a id=__codelineno-0-877 name=__codelineno-0-877></a>    <span class=n>order</span><span class=p>:</span> <span class=n>Literal</span><span class=p>[</span><span class=s2>&quot;asc&quot;</span><span class=p>,</span> <span class=s2>&quot;desc&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;asc&quot;</span><span class=p>,</span>
</span><span id=__span-0-878><a id=__codelineno-0-878 name=__codelineno-0-878></a><span class=p>):</span>
</span><span id=__span-0-879><a id=__codelineno-0-879 name=__codelineno-0-879></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Backwards compatibility for chat_completions messages.&quot;&quot;&quot;</span>
</span><span id=__span-0-880><a id=__codelineno-0-880 name=__codelineno-0-880></a>    <span class=n>messages</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_list_messages</span><span class=p>(</span><span class=n>thread_id</span><span class=o>=</span><span class=n>thread_id</span><span class=p>,</span> <span class=n>limit</span><span class=o>=</span><span class=n>limit</span><span class=p>,</span> <span class=n>order</span><span class=o>=</span><span class=n>order</span><span class=p>)</span>
</span><span id=__span-0-881><a id=__codelineno-0-881 name=__codelineno-0-881></a>
</span><span id=__span-0-882><a id=__codelineno-0-882 name=__codelineno-0-882></a>    <span class=c1># Filter out system and agent log messages when running in debug mode. Agent behavior shouldn&#39;t change based on logs.  # noqa: E501</span>
</span><span id=__span-0-883><a id=__codelineno-0-883 name=__codelineno-0-883></a>    <span class=n>messages</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-0-884><a id=__codelineno-0-884 name=__codelineno-0-884></a>        <span class=n>m</span>
</span><span id=__span-0-885><a id=__codelineno-0-885 name=__codelineno-0-885></a>        <span class=k>for</span> <span class=n>m</span> <span class=ow>in</span> <span class=n>messages</span>
</span><span id=__span-0-886><a id=__codelineno-0-886 name=__codelineno-0-886></a>        <span class=k>if</span> <span class=ow>not</span> <span class=p>(</span>
</span><span id=__span-0-887><a id=__codelineno-0-887 name=__codelineno-0-887></a>            <span class=n>m</span><span class=o>.</span><span class=n>metadata</span>
</span><span id=__span-0-888><a id=__codelineno-0-888 name=__codelineno-0-888></a>            <span class=ow>and</span> <span class=nb>any</span><span class=p>(</span><span class=n>m</span><span class=o>.</span><span class=n>metadata</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;message_type&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=n>prefix</span><span class=p>)</span> <span class=k>for</span> <span class=n>prefix</span> <span class=ow>in</span> <span class=p>[</span><span class=s2>&quot;system:&quot;</span><span class=p>,</span> <span class=s2>&quot;agent:&quot;</span><span class=p>])</span>
</span><span id=__span-0-889><a id=__codelineno-0-889 name=__codelineno-0-889></a>        <span class=p>)</span>
</span><span id=__span-0-890><a id=__codelineno-0-890 name=__codelineno-0-890></a>    <span class=p>]</span>
</span><span id=__span-0-891><a id=__codelineno-0-891 name=__codelineno-0-891></a>
</span><span id=__span-0-892><a id=__codelineno-0-892 name=__codelineno-0-892></a>    <span class=n>legacy_messages</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-0-893><a id=__codelineno-0-893 name=__codelineno-0-893></a>        <span class=p>{</span>
</span><span id=__span-0-894><a id=__codelineno-0-894 name=__codelineno-0-894></a>            <span class=s2>&quot;id&quot;</span><span class=p>:</span> <span class=n>m</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span><span id=__span-0-895><a id=__codelineno-0-895 name=__codelineno-0-895></a>            <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=n>c</span><span class=o>.</span><span class=n>text</span><span class=o>.</span><span class=n>value</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>m</span><span class=o>.</span><span class=n>content</span><span class=p>]),</span>  <span class=c1># type: ignore</span>
</span><span id=__span-0-896><a id=__codelineno-0-896 name=__codelineno-0-896></a>            <span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=n>m</span><span class=o>.</span><span class=n>role</span><span class=p>,</span>
</span><span id=__span-0-897><a id=__codelineno-0-897 name=__codelineno-0-897></a>        <span class=p>}</span>
</span><span id=__span-0-898><a id=__codelineno-0-898 name=__codelineno-0-898></a>        <span class=k>for</span> <span class=n>m</span> <span class=ow>in</span> <span class=n>messages</span>
</span><span id=__span-0-899><a id=__codelineno-0-899 name=__codelineno-0-899></a>    <span class=p>]</span>
</span><span id=__span-0-900><a id=__codelineno-0-900 name=__codelineno-0-900></a>    <span class=k>return</span> <span class=n>legacy_messages</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.environment.Environment.list_terminal_commands class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">list_terminal_commands</span> <a href=#nearai.agents.environment.Environment.list_terminal_commands class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>list_terminal_commands</span><span class=p>(</span><span class=n>filename</span><span class=p>:</span> <span class=n>str</span> <span class=o>=</span> <span class=n><span title=nearai.agents.environment.TERMINAL_FILENAME>TERMINAL_FILENAME</span></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=typing.List>List</span></span><span class=p>[</span><span class=n><span title=typing.Any>Any</span></span><span class=p>]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Returns the terminal commands from the terminal file.</p> <details class=quote> <summary>Source code in <code>nearai/agents/environment.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-863>863</a></span>
<span class=normal><a href=#__codelineno-0-864>864</a></span>
<span class=normal><a href=#__codelineno-0-865>865</a></span>
<span class=normal><a href=#__codelineno-0-866>866</a></span>
<span class=normal><a href=#__codelineno-0-867>867</a></span>
<span class=normal><a href=#__codelineno-0-868>868</a></span>
<span class=normal><a href=#__codelineno-0-869>869</a></span>
<span class=normal><a href=#__codelineno-0-870>870</a></span>
<span class=normal><a href=#__codelineno-0-871>871</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-863><a id=__codelineno-0-863 name=__codelineno-0-863></a><span class=k>def</span><span class=w> </span><span class=nf>list_terminal_commands</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>filename</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>TERMINAL_FILENAME</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Any</span><span class=p>]:</span>
</span><span id=__span-0-864><a id=__codelineno-0-864 name=__codelineno-0-864></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns the terminal commands from the terminal file.&quot;&quot;&quot;</span>
</span><span id=__span-0-865><a id=__codelineno-0-865 name=__codelineno-0-865></a>    <span class=n>path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_path</span><span class=p>,</span> <span class=n>filename</span><span class=p>)</span>
</span><span id=__span-0-866><a id=__codelineno-0-866 name=__codelineno-0-866></a>
</span><span id=__span-0-867><a id=__codelineno-0-867 name=__codelineno-0-867></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>path</span><span class=p>):</span>
</span><span id=__span-0-868><a id=__codelineno-0-868 name=__codelineno-0-868></a>        <span class=k>return</span> <span class=p>[]</span>
</span><span id=__span-0-869><a id=__codelineno-0-869 name=__codelineno-0-869></a>
</span><span id=__span-0-870><a id=__codelineno-0-870 name=__codelineno-0-870></a>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=s2>&quot;r&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-871><a id=__codelineno-0-871 name=__codelineno-0-871></a>        <span class=k>return</span> <span class=p>[</span><span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>message</span><span class=p>)</span> <span class=k>for</span> <span class=n>message</span> <span class=ow>in</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=n>DELIMITER</span><span class=p>)</span> <span class=k>if</span> <span class=n>message</span><span class=p>]</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.environment.Environment.load_snapshot class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">load_snapshot</span> <a href=#nearai.agents.environment.Environment.load_snapshot class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>load_snapshot</span><span class=p>(</span><span class=n>snapshot</span><span class=p>:</span> <span class=n>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Load Environment from Snapshot.</p> <details class=quote> <summary>Source code in <code>nearai/agents/environment.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1418>1418</a></span>
<span class=normal><a href=#__codelineno-0-1419>1419</a></span>
<span class=normal><a href=#__codelineno-0-1420>1420</a></span>
<span class=normal><a href=#__codelineno-0-1421>1421</a></span>
<span class=normal><a href=#__codelineno-0-1422>1422</a></span>
<span class=normal><a href=#__codelineno-0-1423>1423</a></span>
<span class=normal><a href=#__codelineno-0-1424>1424</a></span>
<span class=normal><a href=#__codelineno-0-1425>1425</a></span>
<span class=normal><a href=#__codelineno-0-1426>1426</a></span>
<span class=normal><a href=#__codelineno-0-1427>1427</a></span>
<span class=normal><a href=#__codelineno-0-1428>1428</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1418><a id=__codelineno-0-1418 name=__codelineno-0-1418></a><span class=k>def</span><span class=w> </span><span class=nf>load_snapshot</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>snapshot</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-1419><a id=__codelineno-0-1419 name=__codelineno-0-1419></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Load Environment from Snapshot.&quot;&quot;&quot;</span>
</span><span id=__span-0-1420><a id=__codelineno-0-1420 name=__codelineno-0-1420></a>    <span class=n>shutil</span><span class=o>.</span><span class=n>rmtree</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_path</span><span class=p>,</span> <span class=n>ignore_errors</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-1421><a id=__codelineno-0-1421 name=__codelineno-0-1421></a>
</span><span id=__span-0-1422><a id=__codelineno-0-1422 name=__codelineno-0-1422></a>    <span class=k>with</span> <span class=n>tempfile</span><span class=o>.</span><span class=n>NamedTemporaryFile</span><span class=p>(</span><span class=n>suffix</span><span class=o>=</span><span class=s2>&quot;.tar.gz&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-1423><a id=__codelineno-0-1423 name=__codelineno-0-1423></a>        <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>snapshot</span><span class=p>)</span>
</span><span id=__span-0-1424><a id=__codelineno-0-1424 name=__codelineno-0-1424></a>        <span class=n>f</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span><span id=__span-0-1425><a id=__codelineno-0-1425 name=__codelineno-0-1425></a>        <span class=n>f</span><span class=o>.</span><span class=n>seek</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span><span id=__span-0-1426><a id=__codelineno-0-1426 name=__codelineno-0-1426></a>
</span><span id=__span-0-1427><a id=__codelineno-0-1427 name=__codelineno-0-1427></a>        <span class=k>with</span> <span class=n>tarfile</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=n>fileobj</span><span class=o>=</span><span class=n>f</span><span class=p>,</span> <span class=n>mode</span><span class=o>=</span><span class=s2>&quot;r:gz&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>tar</span><span class=p>:</span>
</span><span id=__span-0-1428><a id=__codelineno-0-1428 name=__codelineno-0-1428></a>            <span class=n>tar</span><span class=o>.</span><span class=n>extractall</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_path</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.environment.Environment.read_file class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">read_file</span> <a href=#nearai.agents.environment.Environment.read_file class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>read_file</span><span class=p>(</span><span class=n>filename</span><span class=p>:</span> <span class=n>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n><span title=typing.Union>Union</span></span><span class=p>[</span><span class=n>bytes</span><span class=p>,</span> <span class=n>str</span><span class=p>]]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Reads a file from the environment or thread.</p> <details class=quote> <summary>Source code in <code>nearai/agents/environment.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-934>934</a></span>
<span class=normal><a href=#__codelineno-0-935>935</a></span>
<span class=normal><a href=#__codelineno-0-936>936</a></span>
<span class=normal><a href=#__codelineno-0-937>937</a></span>
<span class=normal><a href=#__codelineno-0-938>938</a></span>
<span class=normal><a href=#__codelineno-0-939>939</a></span>
<span class=normal><a href=#__codelineno-0-940>940</a></span>
<span class=normal><a href=#__codelineno-0-941>941</a></span>
<span class=normal><a href=#__codelineno-0-942>942</a></span>
<span class=normal><a href=#__codelineno-0-943>943</a></span>
<span class=normal><a href=#__codelineno-0-944>944</a></span>
<span class=normal><a href=#__codelineno-0-945>945</a></span>
<span class=normal><a href=#__codelineno-0-946>946</a></span>
<span class=normal><a href=#__codelineno-0-947>947</a></span>
<span class=normal><a href=#__codelineno-0-948>948</a></span>
<span class=normal><a href=#__codelineno-0-949>949</a></span>
<span class=normal><a href=#__codelineno-0-950>950</a></span>
<span class=normal><a href=#__codelineno-0-951>951</a></span>
<span class=normal><a href=#__codelineno-0-952>952</a></span>
<span class=normal><a href=#__codelineno-0-953>953</a></span>
<span class=normal><a href=#__codelineno-0-954>954</a></span>
<span class=normal><a href=#__codelineno-0-955>955</a></span>
<span class=normal><a href=#__codelineno-0-956>956</a></span>
<span class=normal><a href=#__codelineno-0-957>957</a></span>
<span class=normal><a href=#__codelineno-0-958>958</a></span>
<span class=normal><a href=#__codelineno-0-959>959</a></span>
<span class=normal><a href=#__codelineno-0-960>960</a></span>
<span class=normal><a href=#__codelineno-0-961>961</a></span>
<span class=normal><a href=#__codelineno-0-962>962</a></span>
<span class=normal><a href=#__codelineno-0-963>963</a></span>
<span class=normal><a href=#__codelineno-0-964>964</a></span>
<span class=normal><a href=#__codelineno-0-965>965</a></span>
<span class=normal><a href=#__codelineno-0-966>966</a></span>
<span class=normal><a href=#__codelineno-0-967>967</a></span>
<span class=normal><a href=#__codelineno-0-968>968</a></span>
<span class=normal><a href=#__codelineno-0-969>969</a></span>
<span class=normal><a href=#__codelineno-0-970>970</a></span>
<span class=normal><a href=#__codelineno-0-971>971</a></span>
<span class=normal><a href=#__codelineno-0-972>972</a></span>
<span class=normal><a href=#__codelineno-0-973>973</a></span>
<span class=normal><a href=#__codelineno-0-974>974</a></span>
<span class=normal><a href=#__codelineno-0-975>975</a></span>
<span class=normal><a href=#__codelineno-0-976>976</a></span>
<span class=normal><a href=#__codelineno-0-977>977</a></span>
<span class=normal><a href=#__codelineno-0-978>978</a></span>
<span class=normal><a href=#__codelineno-0-979>979</a></span>
<span class=normal><a href=#__codelineno-0-980>980</a></span>
<span class=normal><a href=#__codelineno-0-981>981</a></span>
<span class=normal><a href=#__codelineno-0-982>982</a></span>
<span class=normal><a href=#__codelineno-0-983>983</a></span>
<span class=normal><a href=#__codelineno-0-984>984</a></span>
<span class=normal><a href=#__codelineno-0-985>985</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-934><a id=__codelineno-0-934 name=__codelineno-0-934></a><span class=k>def</span><span class=w> </span><span class=nf>read_file</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>filename</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Union</span><span class=p>[</span><span class=nb>bytes</span><span class=p>,</span> <span class=nb>str</span><span class=p>]]:</span>
</span><span id=__span-0-935><a id=__codelineno-0-935 name=__codelineno-0-935></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Reads a file from the environment or thread.&quot;&quot;&quot;</span>
</span><span id=__span-0-936><a id=__codelineno-0-936 name=__codelineno-0-936></a>    <span class=n>file_content</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Union</span><span class=p>[</span><span class=nb>bytes</span><span class=p>,</span> <span class=nb>str</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-937><a id=__codelineno-0-937 name=__codelineno-0-937></a>    <span class=c1># First try to read from local filesystem</span>
</span><span id=__span-0-938><a id=__codelineno-0-938 name=__codelineno-0-938></a>    <span class=n>local_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>get_primary_agent_temp_dir</span><span class=p>(),</span> <span class=n>filename</span><span class=p>)</span>
</span><span id=__span-0-939><a id=__codelineno-0-939 name=__codelineno-0-939></a>    <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>local_path</span><span class=p>):</span>
</span><span id=__span-0-940><a id=__codelineno-0-940 name=__codelineno-0-940></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-941><a id=__codelineno-0-941 name=__codelineno-0-941></a>            <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>local_path</span><span class=p>,</span> <span class=s2>&quot;rb&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>local_path_file</span><span class=p>:</span>
</span><span id=__span-0-942><a id=__codelineno-0-942 name=__codelineno-0-942></a>                <span class=n>local_file_content</span> <span class=o>=</span> <span class=n>local_path_file</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span><span id=__span-0-943><a id=__codelineno-0-943 name=__codelineno-0-943></a>                <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-944><a id=__codelineno-0-944 name=__codelineno-0-944></a>                    <span class=c1># Try to decode as text</span>
</span><span id=__span-0-945><a id=__codelineno-0-945 name=__codelineno-0-945></a>                    <span class=n>file_content</span> <span class=o>=</span> <span class=n>local_file_content</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s2>&quot;utf-8&quot;</span><span class=p>)</span>
</span><span id=__span-0-946><a id=__codelineno-0-946 name=__codelineno-0-946></a>                <span class=k>except</span> <span class=ne>UnicodeDecodeError</span><span class=p>:</span>
</span><span id=__span-0-947><a id=__codelineno-0-947 name=__codelineno-0-947></a>                    <span class=c1># If decoding fails, store as binary</span>
</span><span id=__span-0-948><a id=__codelineno-0-948 name=__codelineno-0-948></a>                    <span class=n>file_content</span> <span class=o>=</span> <span class=n>local_file_content</span>
</span><span id=__span-0-949><a id=__codelineno-0-949 name=__codelineno-0-949></a>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-950><a id=__codelineno-0-950 name=__codelineno-0-950></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error with read_file: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-951><a id=__codelineno-0-951 name=__codelineno-0-951></a>
</span><span id=__span-0-952><a id=__codelineno-0-952 name=__codelineno-0-952></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>file_content</span><span class=p>:</span>
</span><span id=__span-0-953><a id=__codelineno-0-953 name=__codelineno-0-953></a>        <span class=c1># Next check files written out by the agent.</span>
</span><span id=__span-0-954><a id=__codelineno-0-954 name=__codelineno-0-954></a>        <span class=c1># Agent output files take precedence over files packaged with the agent</span>
</span><span id=__span-0-955><a id=__codelineno-0-955 name=__codelineno-0-955></a>        <span class=n>thread_files</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>list_files_from_thread</span><span class=p>(</span><span class=n>order</span><span class=o>=</span><span class=s2>&quot;desc&quot;</span><span class=p>)</span>
</span><span id=__span-0-956><a id=__codelineno-0-956 name=__codelineno-0-956></a>
</span><span id=__span-0-957><a id=__codelineno-0-957 name=__codelineno-0-957></a>        <span class=c1># Then try to read from thread, starting from the most recent</span>
</span><span id=__span-0-958><a id=__codelineno-0-958 name=__codelineno-0-958></a>        <span class=k>for</span> <span class=n>f</span> <span class=ow>in</span> <span class=n>thread_files</span><span class=p>:</span>
</span><span id=__span-0-959><a id=__codelineno-0-959 name=__codelineno-0-959></a>            <span class=k>if</span> <span class=n>f</span><span class=o>.</span><span class=n>filename</span> <span class=o>==</span> <span class=n>filename</span><span class=p>:</span>
</span><span id=__span-0-960><a id=__codelineno-0-960 name=__codelineno-0-960></a>                <span class=n>file_content</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>read_file_by_id</span><span class=p>(</span><span class=n>f</span><span class=o>.</span><span class=n>id</span><span class=p>)</span>
</span><span id=__span-0-961><a id=__codelineno-0-961 name=__codelineno-0-961></a>                <span class=k>break</span>
</span><span id=__span-0-962><a id=__codelineno-0-962 name=__codelineno-0-962></a>
</span><span id=__span-0-963><a id=__codelineno-0-963 name=__codelineno-0-963></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>file_content</span><span class=p>:</span>
</span><span id=__span-0-964><a id=__codelineno-0-964 name=__codelineno-0-964></a>            <span class=c1># Next check agent file cache</span>
</span><span id=__span-0-965><a id=__codelineno-0-965 name=__codelineno-0-965></a>            <span class=c1># Agent output files &amp; thread files take precedence over cached files</span>
</span><span id=__span-0-966><a id=__codelineno-0-966 name=__codelineno-0-966></a>            <span class=n>file_cache</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_primary_agent</span><span class=p>()</span><span class=o>.</span><span class=n>file_cache</span>
</span><span id=__span-0-967><a id=__codelineno-0-967 name=__codelineno-0-967></a>            <span class=k>if</span> <span class=n>file_cache</span><span class=p>:</span>
</span><span id=__span-0-968><a id=__codelineno-0-968 name=__codelineno-0-968></a>                <span class=n>file_content</span> <span class=o>=</span> <span class=n>file_cache</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>filename</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
</span><span id=__span-0-969><a id=__codelineno-0-969 name=__codelineno-0-969></a>
</span><span id=__span-0-970><a id=__codelineno-0-970 name=__codelineno-0-970></a>        <span class=c1># Write the file content from the thread or cache to the local filesystem</span>
</span><span id=__span-0-971><a id=__codelineno-0-971 name=__codelineno-0-971></a>        <span class=c1># This allows exec_command to operate on the file</span>
</span><span id=__span-0-972><a id=__codelineno-0-972 name=__codelineno-0-972></a>        <span class=k>if</span> <span class=n>file_content</span><span class=p>:</span>
</span><span id=__span-0-973><a id=__codelineno-0-973 name=__codelineno-0-973></a>            <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=n>local_path</span><span class=p>)):</span>
</span><span id=__span-0-974><a id=__codelineno-0-974 name=__codelineno-0-974></a>                <span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=n>local_path</span><span class=p>))</span>
</span><span id=__span-0-975><a id=__codelineno-0-975 name=__codelineno-0-975></a>
</span><span id=__span-0-976><a id=__codelineno-0-976 name=__codelineno-0-976></a>            <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>local_path</span><span class=p>,</span> <span class=s2>&quot;wb&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>local_file</span><span class=p>:</span>
</span><span id=__span-0-977><a id=__codelineno-0-977 name=__codelineno-0-977></a>                <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>file_content</span><span class=p>,</span> <span class=nb>bytes</span><span class=p>):</span>
</span><span id=__span-0-978><a id=__codelineno-0-978 name=__codelineno-0-978></a>                    <span class=n>local_file</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>file_content</span><span class=p>)</span>
</span><span id=__span-0-979><a id=__codelineno-0-979 name=__codelineno-0-979></a>                <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-980><a id=__codelineno-0-980 name=__codelineno-0-980></a>                    <span class=n>local_file</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>file_content</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s2>&quot;utf-8&quot;</span><span class=p>))</span>
</span><span id=__span-0-981><a id=__codelineno-0-981 name=__codelineno-0-981></a>
</span><span id=__span-0-982><a id=__codelineno-0-982 name=__codelineno-0-982></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>file_content</span><span class=p>:</span>
</span><span id=__span-0-983><a id=__codelineno-0-983 name=__codelineno-0-983></a>        <span class=bp>self</span><span class=o>.</span><span class=n>add_system_log</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Warn: File </span><span class=si>{</span><span class=n>filename</span><span class=si>}</span><span class=s2> not found during read_file operation&quot;</span><span class=p>)</span>
</span><span id=__span-0-984><a id=__codelineno-0-984 name=__codelineno-0-984></a>
</span><span id=__span-0-985><a id=__codelineno-0-985 name=__codelineno-0-985></a>    <span class=k>return</span> <span class=n>file_content</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.environment.Environment.run class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">run</span> <a href=#nearai.agents.environment.Environment.run class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>run</span><span class=p>(</span><span class=n>new_message</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>max_iterations</span><span class=p>:</span> <span class=n>int</span> <span class=o>=</span> <span class=mi>10</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Runs agent(s) against a new or previously created environment.</p> <details class=quote> <summary>Source code in <code>nearai/agents/environment.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1460>1460</a></span>
<span class=normal><a href=#__codelineno-0-1461>1461</a></span>
<span class=normal><a href=#__codelineno-0-1462>1462</a></span>
<span class=normal><a href=#__codelineno-0-1463>1463</a></span>
<span class=normal><a href=#__codelineno-0-1464>1464</a></span>
<span class=normal><a href=#__codelineno-0-1465>1465</a></span>
<span class=normal><a href=#__codelineno-0-1466>1466</a></span>
<span class=normal><a href=#__codelineno-0-1467>1467</a></span>
<span class=normal><a href=#__codelineno-0-1468>1468</a></span>
<span class=normal><a href=#__codelineno-0-1469>1469</a></span>
<span class=normal><a href=#__codelineno-0-1470>1470</a></span>
<span class=normal><a href=#__codelineno-0-1471>1471</a></span>
<span class=normal><a href=#__codelineno-0-1472>1472</a></span>
<span class=normal><a href=#__codelineno-0-1473>1473</a></span>
<span class=normal><a href=#__codelineno-0-1474>1474</a></span>
<span class=normal><a href=#__codelineno-0-1475>1475</a></span>
<span class=normal><a href=#__codelineno-0-1476>1476</a></span>
<span class=normal><a href=#__codelineno-0-1477>1477</a></span>
<span class=normal><a href=#__codelineno-0-1478>1478</a></span>
<span class=normal><a href=#__codelineno-0-1479>1479</a></span>
<span class=normal><a href=#__codelineno-0-1480>1480</a></span>
<span class=normal><a href=#__codelineno-0-1481>1481</a></span>
<span class=normal><a href=#__codelineno-0-1482>1482</a></span>
<span class=normal><a href=#__codelineno-0-1483>1483</a></span>
<span class=normal><a href=#__codelineno-0-1484>1484</a></span>
<span class=normal><a href=#__codelineno-0-1485>1485</a></span>
<span class=normal><a href=#__codelineno-0-1486>1486</a></span>
<span class=normal><a href=#__codelineno-0-1487>1487</a></span>
<span class=normal><a href=#__codelineno-0-1488>1488</a></span>
<span class=normal><a href=#__codelineno-0-1489>1489</a></span>
<span class=normal><a href=#__codelineno-0-1490>1490</a></span>
<span class=normal><a href=#__codelineno-0-1491>1491</a></span>
<span class=normal><a href=#__codelineno-0-1492>1492</a></span>
<span class=normal><a href=#__codelineno-0-1493>1493</a></span>
<span class=normal><a href=#__codelineno-0-1494>1494</a></span>
<span class=normal><a href=#__codelineno-0-1495>1495</a></span>
<span class=normal><a href=#__codelineno-0-1496>1496</a></span>
<span class=normal><a href=#__codelineno-0-1497>1497</a></span>
<span class=normal><a href=#__codelineno-0-1498>1498</a></span>
<span class=normal><a href=#__codelineno-0-1499>1499</a></span>
<span class=normal><a href=#__codelineno-0-1500>1500</a></span>
<span class=normal><a href=#__codelineno-0-1501>1501</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1460><a id=__codelineno-0-1460 name=__codelineno-0-1460></a><span class=k>def</span><span class=w> </span><span class=nf>run</span><span class=p>(</span>
</span><span id=__span-0-1461><a id=__codelineno-0-1461 name=__codelineno-0-1461></a>    <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-1462><a id=__codelineno-0-1462 name=__codelineno-0-1462></a>    <span class=n>new_message</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-1463><a id=__codelineno-0-1463 name=__codelineno-0-1463></a>    <span class=n>max_iterations</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>10</span><span class=p>,</span>
</span><span id=__span-0-1464><a id=__codelineno-0-1464 name=__codelineno-0-1464></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-1465><a id=__codelineno-0-1465 name=__codelineno-0-1465></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Runs agent(s) against a new or previously created environment.&quot;&quot;&quot;</span>
</span><span id=__span-0-1466><a id=__codelineno-0-1466 name=__codelineno-0-1466></a>    <span class=k>if</span> <span class=n>new_message</span><span class=p>:</span>
</span><span id=__span-0-1467><a id=__codelineno-0-1467 name=__codelineno-0-1467></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_add_message</span><span class=p>(</span><span class=s2>&quot;user&quot;</span><span class=p>,</span> <span class=n>new_message</span><span class=p>)</span>
</span><span id=__span-0-1468><a id=__codelineno-0-1468 name=__codelineno-0-1468></a>
</span><span id=__span-0-1469><a id=__codelineno-0-1469 name=__codelineno-0-1469></a>    <span class=n>iteration</span> <span class=o>=</span> <span class=mi>0</span>
</span><span id=__span-0-1470><a id=__codelineno-0-1470 name=__codelineno-0-1470></a>    <span class=bp>self</span><span class=o>.</span><span class=n>set_next_actor</span><span class=p>(</span><span class=s2>&quot;agent&quot;</span><span class=p>)</span>
</span><span id=__span-0-1471><a id=__codelineno-0-1471 name=__codelineno-0-1471></a>
</span><span id=__span-0-1472><a id=__codelineno-0-1472 name=__codelineno-0-1472></a>    <span class=k>while</span> <span class=n>iteration</span> <span class=o>&lt;</span> <span class=n>max_iterations</span> <span class=ow>and</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_done</span><span class=p>()</span> <span class=ow>and</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_next_actor</span><span class=p>()</span> <span class=o>!=</span> <span class=s2>&quot;user&quot;</span><span class=p>:</span>
</span><span id=__span-0-1473><a id=__codelineno-0-1473 name=__codelineno-0-1473></a>        <span class=n>iteration</span> <span class=o>+=</span> <span class=mi>1</span>
</span><span id=__span-0-1474><a id=__codelineno-0-1474 name=__codelineno-0-1474></a>        <span class=k>if</span> <span class=n>max_iterations</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
</span><span id=__span-0-1475><a id=__codelineno-0-1475 name=__codelineno-0-1475></a>            <span class=bp>self</span><span class=o>.</span><span class=n>add_system_log</span><span class=p>(</span>
</span><span id=__span-0-1476><a id=__codelineno-0-1476 name=__codelineno-0-1476></a>                <span class=sa>f</span><span class=s2>&quot;Running agent, iteration </span><span class=si>{</span><span class=n>iteration</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>max_iterations</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-0-1477><a id=__codelineno-0-1477 name=__codelineno-0-1477></a>                <span class=n>logging</span><span class=o>.</span><span class=n>INFO</span><span class=p>,</span>
</span><span id=__span-0-1478><a id=__codelineno-0-1478 name=__codelineno-0-1478></a>            <span class=p>)</span>
</span><span id=__span-0-1479><a id=__codelineno-0-1479 name=__codelineno-0-1479></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-1480><a id=__codelineno-0-1480 name=__codelineno-0-1480></a>            <span class=n>error_message</span><span class=p>,</span> <span class=n>traceback_message</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_primary_agent</span><span class=p>()</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>task</span><span class=o>=</span><span class=n>new_message</span><span class=p>)</span>
</span><span id=__span-0-1481><a id=__codelineno-0-1481 name=__codelineno-0-1481></a>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_debug_mode</span> <span class=ow>and</span> <span class=p>(</span><span class=n>error_message</span> <span class=ow>or</span> <span class=n>traceback_message</span><span class=p>):</span>
</span><span id=__span-0-1482><a id=__codelineno-0-1482 name=__codelineno-0-1482></a>                <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_debug_mode</span> <span class=ow>and</span> <span class=p>(</span><span class=n>error_message</span> <span class=ow>or</span> <span class=n>traceback_message</span><span class=p>):</span>
</span><span id=__span-0-1483><a id=__codelineno-0-1483 name=__codelineno-0-1483></a>                    <span class=n>message_parts</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-0-1484><a id=__codelineno-0-1484 name=__codelineno-0-1484></a>
</span><span id=__span-0-1485><a id=__codelineno-0-1485 name=__codelineno-0-1485></a>                    <span class=k>if</span> <span class=n>error_message</span><span class=p>:</span>
</span><span id=__span-0-1486><a id=__codelineno-0-1486 name=__codelineno-0-1486></a>                        <span class=n>message_parts</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error: </span><span class=se>\n</span><span class=s2> ```</span><span class=se>\n</span><span class=si>{</span><span class=n>error_message</span><span class=si>}</span><span class=se>\n</span><span class=s2>```&quot;</span><span class=p>)</span>
</span><span id=__span-0-1487><a id=__codelineno-0-1487 name=__codelineno-0-1487></a>
</span><span id=__span-0-1488><a id=__codelineno-0-1488 name=__codelineno-0-1488></a>                    <span class=k>if</span> <span class=n>traceback_message</span><span class=p>:</span>
</span><span id=__span-0-1489><a id=__codelineno-0-1489 name=__codelineno-0-1489></a>                        <span class=n>message_parts</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error Traceback: </span><span class=se>\n</span><span class=s2> ```</span><span class=se>\n</span><span class=si>{</span><span class=n>traceback_message</span><span class=si>}</span><span class=se>\n</span><span class=s2>```&quot;</span><span class=p>)</span>
</span><span id=__span-0-1490><a id=__codelineno-0-1490 name=__codelineno-0-1490></a>
</span><span id=__span-0-1491><a id=__codelineno-0-1491 name=__codelineno-0-1491></a>                    <span class=bp>self</span><span class=o>.</span><span class=n>add_reply</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\n\n</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>message_parts</span><span class=p>),</span> <span class=n>message_type</span><span class=o>=</span><span class=s2>&quot;system:debug&quot;</span><span class=p>)</span>
</span><span id=__span-0-1492><a id=__codelineno-0-1492 name=__codelineno-0-1492></a>
</span><span id=__span-0-1493><a id=__codelineno-0-1493 name=__codelineno-0-1493></a>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-1494><a id=__codelineno-0-1494 name=__codelineno-0-1494></a>            <span class=bp>self</span><span class=o>.</span><span class=n>add_system_log</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Environment run failed: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>logging</span><span class=o>.</span><span class=n>ERROR</span><span class=p>)</span>
</span><span id=__span-0-1495><a id=__codelineno-0-1495 name=__codelineno-0-1495></a>            <span class=bp>self</span><span class=o>.</span><span class=n>mark_failed</span><span class=p>()</span>
</span><span id=__span-0-1496><a id=__codelineno-0-1496 name=__codelineno-0-1496></a>            <span class=k>raise</span> <span class=n>e</span>
</span><span id=__span-0-1497><a id=__codelineno-0-1497 name=__codelineno-0-1497></a>
</span><span id=__span-0-1498><a id=__codelineno-0-1498 name=__codelineno-0-1498></a>    <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_pending_ext_agent</span><span class=p>:</span>
</span><span id=__span-0-1499><a id=__codelineno-0-1499 name=__codelineno-0-1499></a>        <span class=c1># If no external agent was called, mark the whole run as done.</span>
</span><span id=__span-0-1500><a id=__codelineno-0-1500 name=__codelineno-0-1500></a>        <span class=c1># Else this environment will stop for now but this run will be continued later.</span>
</span><span id=__span-0-1501><a id=__codelineno-0-1501 name=__codelineno-0-1501></a>        <span class=bp>self</span><span class=o>.</span><span class=n>mark_done</span><span class=p>()</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.environment.Environment.set_next_actor class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">set_next_actor</span> <a href=#nearai.agents.environment.Environment.set_next_actor class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>set_next_actor</span><span class=p>(</span><span class=n>who</span><span class=p>:</span> <span class=n>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Set the next actor / action in the dialogue.</p> <details class=quote> <summary>Source code in <code>nearai/agents/environment.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1441>1441</a></span>
<span class=normal><a href=#__codelineno-0-1442>1442</a></span>
<span class=normal><a href=#__codelineno-0-1443>1443</a></span>
<span class=normal><a href=#__codelineno-0-1444>1444</a></span>
<span class=normal><a href=#__codelineno-0-1445>1445</a></span>
<span class=normal><a href=#__codelineno-0-1446>1446</a></span>
<span class=normal><a href=#__codelineno-0-1447>1447</a></span>
<span class=normal><a href=#__codelineno-0-1448>1448</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1441><a id=__codelineno-0-1441 name=__codelineno-0-1441></a><span class=k>def</span><span class=w> </span><span class=nf>set_next_actor</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>who</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-1442><a id=__codelineno-0-1442 name=__codelineno-0-1442></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Set the next actor / action in the dialogue.&quot;&quot;&quot;</span>
</span><span id=__span-0-1443><a id=__codelineno-0-1443 name=__codelineno-0-1443></a>    <span class=n>next_action_fn</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_path</span><span class=p>,</span> <span class=s2>&quot;.next_action&quot;</span><span class=p>)</span>
</span><span id=__span-0-1444><a id=__codelineno-0-1444 name=__codelineno-0-1444></a>    <span class=k>if</span> <span class=n>who</span> <span class=o>==</span> <span class=s2>&quot;agent&quot;</span><span class=p>:</span>
</span><span id=__span-0-1445><a id=__codelineno-0-1445 name=__codelineno-0-1445></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_done</span> <span class=o>=</span> <span class=kc>False</span>
</span><span id=__span-0-1446><a id=__codelineno-0-1446 name=__codelineno-0-1446></a>
</span><span id=__span-0-1447><a id=__codelineno-0-1447 name=__codelineno-0-1447></a>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>next_action_fn</span><span class=p>,</span> <span class=s2>&quot;w&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-1448><a id=__codelineno-0-1448 name=__codelineno-0-1448></a>        <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>who</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.environment.Environment.signed_completion class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">signed_completion</span> <a href=#nearai.agents.environment.Environment.signed_completion class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>signed_completion</span><span class=p>(</span><span class=n>messages</span><span class=p>:</span> <span class=n><span title=typing.Union>Union</span></span><span class=p>[</span><span class=n><span title=typing.Iterable>Iterable</span></span><span class=p>[</span><span class=n><span title=litellm.types.completion.ChatCompletionMessageParam>ChatCompletionMessageParam</span></span><span class=p>],</span> <span class=n>str</span><span class=p>],</span> <span class=n>model</span><span class=p>:</span> <span class=n><span title=typing.Union>Union</span></span><span class=p>[</span><span class=n><span title=typing.Iterable>Iterable</span></span><span class=p>[</span><span class=n><span title=litellm.types.completion.ChatCompletionMessageParam>ChatCompletionMessageParam</span></span><span class=p>],</span> <span class=n>str</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n><span title=typing.Any>Any</span></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=typing.Dict>Dict</span></span><span class=p>[</span><span class=n>str</span><span class=p>,</span> <span class=n>str</span><span class=p>]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Returns a completion for the given messages using the given model with the agent signature.</p> <details class=quote> <summary>Source code in <code>nearai/agents/environment.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1290>1290</a></span>
<span class=normal><a href=#__codelineno-0-1291>1291</a></span>
<span class=normal><a href=#__codelineno-0-1292>1292</a></span>
<span class=normal><a href=#__codelineno-0-1293>1293</a></span>
<span class=normal><a href=#__codelineno-0-1294>1294</a></span>
<span class=normal><a href=#__codelineno-0-1295>1295</a></span>
<span class=normal><a href=#__codelineno-0-1296>1296</a></span>
<span class=normal><a href=#__codelineno-0-1297>1297</a></span>
<span class=normal><a href=#__codelineno-0-1298>1298</a></span>
<span class=normal><a href=#__codelineno-0-1299>1299</a></span>
<span class=normal><a href=#__codelineno-0-1300>1300</a></span>
<span class=normal><a href=#__codelineno-0-1301>1301</a></span>
<span class=normal><a href=#__codelineno-0-1302>1302</a></span>
<span class=normal><a href=#__codelineno-0-1303>1303</a></span>
<span class=normal><a href=#__codelineno-0-1304>1304</a></span>
<span class=normal><a href=#__codelineno-0-1305>1305</a></span>
<span class=normal><a href=#__codelineno-0-1306>1306</a></span>
<span class=normal><a href=#__codelineno-0-1307>1307</a></span>
<span class=normal><a href=#__codelineno-0-1308>1308</a></span>
<span class=normal><a href=#__codelineno-0-1309>1309</a></span>
<span class=normal><a href=#__codelineno-0-1310>1310</a></span>
<span class=normal><a href=#__codelineno-0-1311>1311</a></span>
<span class=normal><a href=#__codelineno-0-1312>1312</a></span>
<span class=normal><a href=#__codelineno-0-1313>1313</a></span>
<span class=normal><a href=#__codelineno-0-1314>1314</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1290><a id=__codelineno-0-1290 name=__codelineno-0-1290></a><span class=k>def</span><span class=w> </span><span class=nf>signed_completion</span><span class=p>(</span>
</span><span id=__span-0-1291><a id=__codelineno-0-1291 name=__codelineno-0-1291></a>    <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-1292><a id=__codelineno-0-1292 name=__codelineno-0-1292></a>    <span class=n>messages</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Iterable</span><span class=p>[</span><span class=n>ChatCompletionMessageParam</span><span class=p>],</span> <span class=nb>str</span><span class=p>],</span>
</span><span id=__span-0-1293><a id=__codelineno-0-1293 name=__codelineno-0-1293></a>    <span class=n>model</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Iterable</span><span class=p>[</span><span class=n>ChatCompletionMessageParam</span><span class=p>],</span> <span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-1294><a id=__codelineno-0-1294 name=__codelineno-0-1294></a>    <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span>
</span><span id=__span-0-1295><a id=__codelineno-0-1295 name=__codelineno-0-1295></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]:</span>
</span><span id=__span-0-1296><a id=__codelineno-0-1296 name=__codelineno-0-1296></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns a completion for the given messages using the given model with the agent signature.&quot;&quot;&quot;</span>
</span><span id=__span-0-1297><a id=__codelineno-0-1297 name=__codelineno-0-1297></a>    <span class=c1># TODO Return signed completions for non-latest versions only?</span>
</span><span id=__span-0-1298><a id=__codelineno-0-1298 name=__codelineno-0-1298></a>    <span class=n>agent_name</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_primary_agent</span><span class=p>()</span><span class=o>.</span><span class=n>get_full_name</span><span class=p>()</span>
</span><span id=__span-0-1299><a id=__codelineno-0-1299 name=__codelineno-0-1299></a>    <span class=n>raw_response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>completions</span><span class=p>(</span><span class=n>messages</span><span class=p>,</span> <span class=n>model</span><span class=p>,</span> <span class=n>agent_name</span><span class=o>=</span><span class=n>agent_name</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span><span id=__span-0-1300><a id=__codelineno-0-1300 name=__codelineno-0-1300></a>    <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>raw_response</span><span class=p>,</span> <span class=n>ModelResponse</span><span class=p>),</span> <span class=s2>&quot;Expected ModelResponse&quot;</span>
</span><span id=__span-0-1301><a id=__codelineno-0-1301 name=__codelineno-0-1301></a>    <span class=n>response</span><span class=p>:</span> <span class=n>ModelResponse</span> <span class=o>=</span> <span class=n>raw_response</span>
</span><span id=__span-0-1302><a id=__codelineno-0-1302 name=__codelineno-0-1302></a>
</span><span id=__span-0-1303><a id=__codelineno-0-1303 name=__codelineno-0-1303></a>    <span class=n>signature_data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>system_fingerprint</span><span class=p>)</span> <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>system_fingerprint</span> <span class=k>else</span> <span class=p>{}</span>
</span><span id=__span-0-1304><a id=__codelineno-0-1304 name=__codelineno-0-1304></a>
</span><span id=__span-0-1305><a id=__codelineno-0-1305 name=__codelineno-0-1305></a>    <span class=k>assert</span> <span class=nb>all</span><span class=p>(</span><span class=nb>map</span><span class=p>(</span><span class=k>lambda</span> <span class=n>choice</span><span class=p>:</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>choice</span><span class=p>,</span> <span class=n>Choices</span><span class=p>),</span> <span class=n>response</span><span class=o>.</span><span class=n>choices</span><span class=p>)),</span> <span class=s2>&quot;Expected Choices&quot;</span>
</span><span id=__span-0-1306><a id=__codelineno-0-1306 name=__codelineno-0-1306></a>    <span class=n>choices</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Choices</span><span class=p>]</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>choices</span>  <span class=c1># type: ignore</span>
</span><span id=__span-0-1307><a id=__codelineno-0-1307 name=__codelineno-0-1307></a>    <span class=n>response_message</span> <span class=o>=</span> <span class=n>choices</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>message</span><span class=o>.</span><span class=n>content</span>
</span><span id=__span-0-1308><a id=__codelineno-0-1308 name=__codelineno-0-1308></a>    <span class=k>assert</span> <span class=n>response_message</span><span class=p>,</span> <span class=s2>&quot;No completions returned&quot;</span>
</span><span id=__span-0-1309><a id=__codelineno-0-1309 name=__codelineno-0-1309></a>
</span><span id=__span-0-1310><a id=__codelineno-0-1310 name=__codelineno-0-1310></a>    <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-0-1311><a id=__codelineno-0-1311 name=__codelineno-0-1311></a>        <span class=s2>&quot;response&quot;</span><span class=p>:</span> <span class=n>response_message</span><span class=p>,</span>
</span><span id=__span-0-1312><a id=__codelineno-0-1312 name=__codelineno-0-1312></a>        <span class=s2>&quot;signature&quot;</span><span class=p>:</span> <span class=n>signature_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;signature&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>),</span>
</span><span id=__span-0-1313><a id=__codelineno-0-1313 name=__codelineno-0-1313></a>        <span class=s2>&quot;public_key&quot;</span><span class=p>:</span> <span class=n>signature_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;public_key&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>),</span>
</span><span id=__span-0-1314><a id=__codelineno-0-1314 name=__codelineno-0-1314></a>    <span class=p>}</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.environment.Environment.verify_message class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">verify_message</span> <a href=#nearai.agents.environment.Environment.verify_message class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>verify_message</span><span class=p>(</span><span class=n>account_id</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>public_key</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>signature</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>message</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>nonce</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>callback_url</span><span class=p>:</span> <span class=n>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><a class="autorefs autorefs-internal" title=nearai.shared.near.sign.SignatureVerificationResult href=#nearai.shared.near.sign.SignatureVerificationResult>SignatureVerificationResult</a></span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Verifies that the user message is signed with NEAR Account.</p> <details class=quote> <summary>Source code in <code>nearai/agents/environment.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-902>902</a></span>
<span class=normal><a href=#__codelineno-0-903>903</a></span>
<span class=normal><a href=#__codelineno-0-904>904</a></span>
<span class=normal><a href=#__codelineno-0-905>905</a></span>
<span class=normal><a href=#__codelineno-0-906>906</a></span>
<span class=normal><a href=#__codelineno-0-907>907</a></span>
<span class=normal><a href=#__codelineno-0-908>908</a></span>
<span class=normal><a href=#__codelineno-0-909>909</a></span>
<span class=normal><a href=#__codelineno-0-910>910</a></span>
<span class=normal><a href=#__codelineno-0-911>911</a></span>
<span class=normal><a href=#__codelineno-0-912>912</a></span>
<span class=normal><a href=#__codelineno-0-913>913</a></span>
<span class=normal><a href=#__codelineno-0-914>914</a></span>
<span class=normal><a href=#__codelineno-0-915>915</a></span>
<span class=normal><a href=#__codelineno-0-916>916</a></span>
<span class=normal><a href=#__codelineno-0-917>917</a></span>
<span class=normal><a href=#__codelineno-0-918>918</a></span>
<span class=normal><a href=#__codelineno-0-919>919</a></span>
<span class=normal><a href=#__codelineno-0-920>920</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-902><a id=__codelineno-0-902 name=__codelineno-0-902></a><span class=k>def</span><span class=w> </span><span class=nf>verify_message</span><span class=p>(</span>
</span><span id=__span-0-903><a id=__codelineno-0-903 name=__codelineno-0-903></a>    <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-904><a id=__codelineno-0-904 name=__codelineno-0-904></a>    <span class=n>account_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-905><a id=__codelineno-0-905 name=__codelineno-0-905></a>    <span class=n>public_key</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-906><a id=__codelineno-0-906 name=__codelineno-0-906></a>    <span class=n>signature</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-907><a id=__codelineno-0-907 name=__codelineno-0-907></a>    <span class=n>message</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-908><a id=__codelineno-0-908 name=__codelineno-0-908></a>    <span class=n>nonce</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-909><a id=__codelineno-0-909 name=__codelineno-0-909></a>    <span class=n>callback_url</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-910><a id=__codelineno-0-910 name=__codelineno-0-910></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>near</span><span class=o>.</span><span class=n>SignatureVerificationResult</span><span class=p>:</span>
</span><span id=__span-0-911><a id=__codelineno-0-911 name=__codelineno-0-911></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Verifies that the user message is signed with NEAR Account.&quot;&quot;&quot;</span>
</span><span id=__span-0-912><a id=__codelineno-0-912 name=__codelineno-0-912></a>    <span class=k>return</span> <span class=n>near</span><span class=o>.</span><span class=n>verify_signed_message</span><span class=p>(</span>
</span><span id=__span-0-913><a id=__codelineno-0-913 name=__codelineno-0-913></a>        <span class=n>account_id</span><span class=p>,</span>
</span><span id=__span-0-914><a id=__codelineno-0-914 name=__codelineno-0-914></a>        <span class=n>public_key</span><span class=p>,</span>
</span><span id=__span-0-915><a id=__codelineno-0-915 name=__codelineno-0-915></a>        <span class=n>signature</span><span class=p>,</span>
</span><span id=__span-0-916><a id=__codelineno-0-916 name=__codelineno-0-916></a>        <span class=n>message</span><span class=p>,</span>
</span><span id=__span-0-917><a id=__codelineno-0-917 name=__codelineno-0-917></a>        <span class=n>nonce</span><span class=p>,</span>
</span><span id=__span-0-918><a id=__codelineno-0-918 name=__codelineno-0-918></a>        <span class=bp>self</span><span class=o>.</span><span class=n>get_primary_agent</span><span class=p>()</span><span class=o>.</span><span class=n>name</span><span class=p>,</span>
</span><span id=__span-0-919><a id=__codelineno-0-919 name=__codelineno-0-919></a>        <span class=n>callback_url</span><span class=p>,</span>
</span><span id=__span-0-920><a id=__codelineno-0-920 name=__codelineno-0-920></a>    <span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.environment.Environment.verify_signed_message class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">verify_signed_message</span> <a href=#nearai.agents.environment.Environment.verify_signed_message class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>verify_signed_message</span><span class=p>(</span><span class=n>completion</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>messages</span><span class=p>:</span> <span class=n><span title=typing.Union>Union</span></span><span class=p>[</span><span class=n><span title=typing.Iterable>Iterable</span></span><span class=p>[</span><span class=n><span title=litellm.types.completion.ChatCompletionMessageParam>ChatCompletionMessageParam</span></span><span class=p>],</span> <span class=n>str</span><span class=p>],</span> <span class=n>public_key</span><span class=p>:</span> <span class=n><span title=typing.Union>Union</span></span><span class=p>[</span><span class=n>str</span><span class=p>,</span> <span class=kc>None</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>signature</span><span class=p>:</span> <span class=n><span title=typing.Union>Union</span></span><span class=p>[</span><span class=n>str</span><span class=p>,</span> <span class=kc>None</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>model</span><span class=p>:</span> <span class=n><span title=typing.Union>Union</span></span><span class=p>[</span><span class=n><span title=typing.Iterable>Iterable</span></span><span class=p>[</span><span class=n><span title=litellm.types.completion.ChatCompletionMessageParam>ChatCompletionMessageParam</span></span><span class=p>],</span> <span class=n>str</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n><span title=typing.Any>Any</span></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>bool</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Verifies a signed message.</p> <details class=quote> <summary>Source code in <code>nearai/agents/environment.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1101>1101</a></span>
<span class=normal><a href=#__codelineno-0-1102>1102</a></span>
<span class=normal><a href=#__codelineno-0-1103>1103</a></span>
<span class=normal><a href=#__codelineno-0-1104>1104</a></span>
<span class=normal><a href=#__codelineno-0-1105>1105</a></span>
<span class=normal><a href=#__codelineno-0-1106>1106</a></span>
<span class=normal><a href=#__codelineno-0-1107>1107</a></span>
<span class=normal><a href=#__codelineno-0-1108>1108</a></span>
<span class=normal><a href=#__codelineno-0-1109>1109</a></span>
<span class=normal><a href=#__codelineno-0-1110>1110</a></span>
<span class=normal><a href=#__codelineno-0-1111>1111</a></span>
<span class=normal><a href=#__codelineno-0-1112>1112</a></span>
<span class=normal><a href=#__codelineno-0-1113>1113</a></span>
<span class=normal><a href=#__codelineno-0-1114>1114</a></span>
<span class=normal><a href=#__codelineno-0-1115>1115</a></span>
<span class=normal><a href=#__codelineno-0-1116>1116</a></span>
<span class=normal><a href=#__codelineno-0-1117>1117</a></span>
<span class=normal><a href=#__codelineno-0-1118>1118</a></span>
<span class=normal><a href=#__codelineno-0-1119>1119</a></span>
<span class=normal><a href=#__codelineno-0-1120>1120</a></span>
<span class=normal><a href=#__codelineno-0-1121>1121</a></span>
<span class=normal><a href=#__codelineno-0-1122>1122</a></span>
<span class=normal><a href=#__codelineno-0-1123>1123</a></span>
<span class=normal><a href=#__codelineno-0-1124>1124</a></span>
<span class=normal><a href=#__codelineno-0-1125>1125</a></span>
<span class=normal><a href=#__codelineno-0-1126>1126</a></span>
<span class=normal><a href=#__codelineno-0-1127>1127</a></span>
<span class=normal><a href=#__codelineno-0-1128>1128</a></span>
<span class=normal><a href=#__codelineno-0-1129>1129</a></span>
<span class=normal><a href=#__codelineno-0-1130>1130</a></span>
<span class=normal><a href=#__codelineno-0-1131>1131</a></span>
<span class=normal><a href=#__codelineno-0-1132>1132</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1101><a id=__codelineno-0-1101 name=__codelineno-0-1101></a><span class=k>def</span><span class=w> </span><span class=nf>verify_signed_message</span><span class=p>(</span>
</span><span id=__span-0-1102><a id=__codelineno-0-1102 name=__codelineno-0-1102></a>    <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-1103><a id=__codelineno-0-1103 name=__codelineno-0-1103></a>    <span class=n>completion</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-1104><a id=__codelineno-0-1104 name=__codelineno-0-1104></a>    <span class=n>messages</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Iterable</span><span class=p>[</span><span class=n>ChatCompletionMessageParam</span><span class=p>],</span> <span class=nb>str</span><span class=p>],</span>
</span><span id=__span-0-1105><a id=__codelineno-0-1105 name=__codelineno-0-1105></a>    <span class=n>public_key</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=kc>None</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-1106><a id=__codelineno-0-1106 name=__codelineno-0-1106></a>    <span class=n>signature</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=kc>None</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-1107><a id=__codelineno-0-1107 name=__codelineno-0-1107></a>    <span class=n>model</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Iterable</span><span class=p>[</span><span class=n>ChatCompletionMessageParam</span><span class=p>],</span> <span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-1108><a id=__codelineno-0-1108 name=__codelineno-0-1108></a>    <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span>
</span><span id=__span-0-1109><a id=__codelineno-0-1109 name=__codelineno-0-1109></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span><span id=__span-0-1110><a id=__codelineno-0-1110 name=__codelineno-0-1110></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Verifies a signed message.&quot;&quot;&quot;</span>
</span><span id=__span-0-1111><a id=__codelineno-0-1111 name=__codelineno-0-1111></a>    <span class=k>if</span> <span class=n>public_key</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>or</span> <span class=n>signature</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-1112><a id=__codelineno-0-1112 name=__codelineno-0-1112></a>        <span class=k>return</span> <span class=kc>False</span>
</span><span id=__span-0-1113><a id=__codelineno-0-1113 name=__codelineno-0-1113></a>
</span><span id=__span-0-1114><a id=__codelineno-0-1114 name=__codelineno-0-1114></a>    <span class=n>params</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_inference_parameters</span><span class=p>(</span><span class=n>messages</span><span class=p>,</span> <span class=n>model</span><span class=p>,</span> <span class=kc>False</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span><span id=__span-0-1115><a id=__codelineno-0-1115 name=__codelineno-0-1115></a>
</span><span id=__span-0-1116><a id=__codelineno-0-1116 name=__codelineno-0-1116></a>    <span class=n>messages_without_ids</span> <span class=o>=</span> <span class=p>[{</span><span class=n>k</span><span class=p>:</span> <span class=n>v</span> <span class=k>for</span> <span class=n>k</span><span class=p>,</span> <span class=n>v</span> <span class=ow>in</span> <span class=n>item</span><span class=o>.</span><span class=n>items</span><span class=p>()</span> <span class=k>if</span> <span class=n>k</span> <span class=o>!=</span> <span class=s2>&quot;id&quot;</span><span class=p>}</span> <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>params</span><span class=o>.</span><span class=n>messages</span><span class=p>]</span>
</span><span id=__span-0-1117><a id=__codelineno-0-1117 name=__codelineno-0-1117></a>    <span class=n>ordered_messages_without_ids</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-0-1118><a id=__codelineno-0-1118 name=__codelineno-0-1118></a>        <span class=p>{</span><span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>item</span><span class=p>[</span><span class=s2>&quot;role&quot;</span><span class=p>]),</span> <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>item</span><span class=p>[</span><span class=s2>&quot;content&quot;</span><span class=p>])}</span> <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>messages_without_ids</span>
</span><span id=__span-0-1119><a id=__codelineno-0-1119 name=__codelineno-0-1119></a>    <span class=p>]</span>
</span><span id=__span-0-1120><a id=__codelineno-0-1120 name=__codelineno-0-1120></a>
</span><span id=__span-0-1121><a id=__codelineno-0-1121 name=__codelineno-0-1121></a>    <span class=k>return</span> <span class=n>validate_completion_signature</span><span class=p>(</span>
</span><span id=__span-0-1122><a id=__codelineno-0-1122 name=__codelineno-0-1122></a>        <span class=n>public_key</span><span class=p>,</span>
</span><span id=__span-0-1123><a id=__codelineno-0-1123 name=__codelineno-0-1123></a>        <span class=n>signature</span><span class=p>,</span>
</span><span id=__span-0-1124><a id=__codelineno-0-1124 name=__codelineno-0-1124></a>        <span class=n>CompletionSignaturePayload</span><span class=p>(</span>
</span><span id=__span-0-1125><a id=__codelineno-0-1125 name=__codelineno-0-1125></a>            <span class=n>agent_name</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>get_primary_agent</span><span class=p>()</span><span class=o>.</span><span class=n>get_full_name</span><span class=p>(),</span>
</span><span id=__span-0-1126><a id=__codelineno-0-1126 name=__codelineno-0-1126></a>            <span class=n>completion</span><span class=o>=</span><span class=n>completion</span><span class=p>,</span>
</span><span id=__span-0-1127><a id=__codelineno-0-1127 name=__codelineno-0-1127></a>            <span class=n>model</span><span class=o>=</span><span class=n>params</span><span class=o>.</span><span class=n>model</span><span class=p>,</span>
</span><span id=__span-0-1128><a id=__codelineno-0-1128 name=__codelineno-0-1128></a>            <span class=n>messages</span><span class=o>=</span><span class=n>ordered_messages_without_ids</span><span class=p>,</span>
</span><span id=__span-0-1129><a id=__codelineno-0-1129 name=__codelineno-0-1129></a>            <span class=n>temperature</span><span class=o>=</span><span class=n>params</span><span class=o>.</span><span class=n>temperature</span><span class=p>,</span>
</span><span id=__span-0-1130><a id=__codelineno-0-1130 name=__codelineno-0-1130></a>            <span class=n>max_tokens</span><span class=o>=</span><span class=n>params</span><span class=o>.</span><span class=n>max_tokens</span><span class=p>,</span>
</span><span id=__span-0-1131><a id=__codelineno-0-1131 name=__codelineno-0-1131></a>        <span class=p>),</span>
</span><span id=__span-0-1132><a id=__codelineno-0-1132 name=__codelineno-0-1132></a>    <span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> </div> </div> </div> <div class="doc doc-object doc-module"> <h4 id=nearai.agents.tool_json_helper class="doc doc-heading"> <span class="doc doc-object-name doc-module-name">tool_json_helper</span> <a href=#nearai.agents.tool_json_helper class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h5 id=nearai.agents.tool_json_helper.parse_json_args class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">parse_json_args</span> <a href=#nearai.agents.tool_json_helper.parse_json_args class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>parse_json_args</span><span class=p>(</span><span class=n>signature</span><span class=p>:</span> <span class=n>dict</span><span class=p>,</span> <span class=n>args</span><span class=p>:</span> <span class=n>str</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Parses LLM generated JSON args, trying various repair strategies if args are not valid JSON.</p> <details class=quote> <summary>Source code in <code>nearai/agents/tool_json_helper.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-12>12</a></span>
<span class=normal><a href=#__codelineno-0-13>13</a></span>
<span class=normal><a href=#__codelineno-0-14>14</a></span>
<span class=normal><a href=#__codelineno-0-15>15</a></span>
<span class=normal><a href=#__codelineno-0-16>16</a></span>
<span class=normal><a href=#__codelineno-0-17>17</a></span>
<span class=normal><a href=#__codelineno-0-18>18</a></span>
<span class=normal><a href=#__codelineno-0-19>19</a></span>
<span class=normal><a href=#__codelineno-0-20>20</a></span>
<span class=normal><a href=#__codelineno-0-21>21</a></span>
<span class=normal><a href=#__codelineno-0-22>22</a></span>
<span class=normal><a href=#__codelineno-0-23>23</a></span>
<span class=normal><a href=#__codelineno-0-24>24</a></span>
<span class=normal><a href=#__codelineno-0-25>25</a></span>
<span class=normal><a href=#__codelineno-0-26>26</a></span>
<span class=normal><a href=#__codelineno-0-27>27</a></span>
<span class=normal><a href=#__codelineno-0-28>28</a></span>
<span class=normal><a href=#__codelineno-0-29>29</a></span>
<span class=normal><a href=#__codelineno-0-30>30</a></span>
<span class=normal><a href=#__codelineno-0-31>31</a></span>
<span class=normal><a href=#__codelineno-0-32>32</a></span>
<span class=normal><a href=#__codelineno-0-33>33</a></span>
<span class=normal><a href=#__codelineno-0-34>34</a></span>
<span class=normal><a href=#__codelineno-0-35>35</a></span>
<span class=normal><a href=#__codelineno-0-36>36</a></span>
<span class=normal><a href=#__codelineno-0-37>37</a></span>
<span class=normal><a href=#__codelineno-0-38>38</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12></a><span class=k>def</span><span class=w> </span><span class=nf>parse_json_args</span><span class=p>(</span><span class=n>signature</span><span class=p>:</span> <span class=nb>dict</span><span class=p>,</span> <span class=n>args</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Parses LLM generated JSON args, trying various repair strategies if args are not valid JSON.&quot;&quot;&quot;</span>
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14></a>    <span class=c1># if args is empty or an empty json object check if the function has no arguments</span>
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>args</span> <span class=ow>or</span> <span class=n>args</span> <span class=o>==</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2>&quot;</span><span class=p>:</span>
</span><span id=__span-0-16><a id=__codelineno-0-16 name=__codelineno-0-16></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>signature</span><span class=p>[</span><span class=s2>&quot;function&quot;</span><span class=p>][</span><span class=s2>&quot;parameters&quot;</span><span class=p>][</span><span class=s2>&quot;required&quot;</span><span class=p>]:</span>
</span><span id=__span-0-17><a id=__codelineno-0-17 name=__codelineno-0-17></a>            <span class=k>return</span> <span class=p>{}</span>
</span><span id=__span-0-18><a id=__codelineno-0-18 name=__codelineno-0-18></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Function requires arguments&quot;</span><span class=p>)</span>
</span><span id=__span-0-20><a id=__codelineno-0-20 name=__codelineno-0-20></a>
</span><span id=__span-0-21><a id=__codelineno-0-21 name=__codelineno-0-21></a>    <span class=n>transforms</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-0-22><a id=__codelineno-0-22 name=__codelineno-0-22></a>        <span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>x</span><span class=p>),</span>
</span><span id=__span-0-23><a id=__codelineno-0-23 name=__codelineno-0-23></a>        <span class=n>_ending_transform</span><span class=p>,</span>
</span><span id=__span-0-24><a id=__codelineno-0-24 name=__codelineno-0-24></a>        <span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>parse_json_args_based_on_signature</span><span class=p>(</span><span class=n>signature</span><span class=p>,</span> <span class=n>x</span><span class=p>),</span>
</span><span id=__span-0-25><a id=__codelineno-0-25 name=__codelineno-0-25></a>    <span class=p>]</span>
</span><span id=__span-0-26><a id=__codelineno-0-26 name=__codelineno-0-26></a>
</span><span id=__span-0-27><a id=__codelineno-0-27 name=__codelineno-0-27></a>    <span class=k>for</span> <span class=n>transform</span> <span class=ow>in</span> <span class=n>transforms</span><span class=p>:</span>
</span><span id=__span-0-28><a id=__codelineno-0-28 name=__codelineno-0-28></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-29><a id=__codelineno-0-29 name=__codelineno-0-29></a>            <span class=n>result</span> <span class=o>=</span> <span class=n>transform</span><span class=p>(</span><span class=n>args</span><span class=p>)</span>
</span><span id=__span-0-30><a id=__codelineno-0-30 name=__codelineno-0-30></a>            <span class=c1># check that all result keys are valid properties in the signature</span>
</span><span id=__span-0-31><a id=__codelineno-0-31 name=__codelineno-0-31></a>            <span class=k>for</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>result</span><span class=o>.</span><span class=n>keys</span><span class=p>():</span>
</span><span id=__span-0-32><a id=__codelineno-0-32 name=__codelineno-0-32></a>                <span class=k>if</span> <span class=n>key</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>signature</span><span class=p>[</span><span class=s2>&quot;function&quot;</span><span class=p>][</span><span class=s2>&quot;parameters&quot;</span><span class=p>][</span><span class=s2>&quot;properties&quot;</span><span class=p>]:</span>
</span><span id=__span-0-33><a id=__codelineno-0-33 name=__codelineno-0-33></a>                    <span class=k>raise</span> <span class=n>json</span><span class=o>.</span><span class=n>JSONDecodeError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Unknown parameter </span><span class=si>{</span><span class=n>key</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>args</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span><span id=__span-0-34><a id=__codelineno-0-34 name=__codelineno-0-34></a>            <span class=k>return</span> <span class=n>result</span>
</span><span id=__span-0-35><a id=__codelineno-0-35 name=__codelineno-0-35></a>        <span class=k>except</span> <span class=n>json</span><span class=o>.</span><span class=n>JSONDecodeError</span><span class=p>:</span>
</span><span id=__span-0-36><a id=__codelineno-0-36 name=__codelineno-0-36></a>            <span class=k>continue</span>
</span><span id=__span-0-37><a id=__codelineno-0-37 name=__codelineno-0-37></a>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>err</span><span class=p>:</span>
</span><span id=__span-0-38><a id=__codelineno-0-38 name=__codelineno-0-38></a>            <span class=k>raise</span> <span class=n>json</span><span class=o>.</span><span class=n>JSONDecodeError</span><span class=p>(</span><span class=s2>&quot;Error parsing function args&quot;</span><span class=p>,</span> <span class=n>args</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span> <span class=kn>from</span><span class=w> </span><span class=nn>err</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.agents.tool_json_helper.parse_json_args_based_on_signature class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">parse_json_args_based_on_signature</span> <a href=#nearai.agents.tool_json_helper.parse_json_args_based_on_signature class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>parse_json_args_based_on_signature</span><span class=p>(</span><span class=n>signature</span><span class=p>:</span> <span class=n>dict</span><span class=p>,</span> <span class=n>args</span><span class=p>:</span> <span class=n>str</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Finds parameter names based on the signature and tries to extract the values in between from the args string.</p> <details class=quote> <summary>Source code in <code>nearai/agents/tool_json_helper.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-41>41</a></span>
<span class=normal><a href=#__codelineno-0-42>42</a></span>
<span class=normal><a href=#__codelineno-0-43>43</a></span>
<span class=normal><a href=#__codelineno-0-44>44</a></span>
<span class=normal><a href=#__codelineno-0-45>45</a></span>
<span class=normal><a href=#__codelineno-0-46>46</a></span>
<span class=normal><a href=#__codelineno-0-47>47</a></span>
<span class=normal><a href=#__codelineno-0-48>48</a></span>
<span class=normal><a href=#__codelineno-0-49>49</a></span>
<span class=normal><a href=#__codelineno-0-50>50</a></span>
<span class=normal><a href=#__codelineno-0-51>51</a></span>
<span class=normal><a href=#__codelineno-0-52>52</a></span>
<span class=normal><a href=#__codelineno-0-53>53</a></span>
<span class=normal><a href=#__codelineno-0-54>54</a></span>
<span class=normal><a href=#__codelineno-0-55>55</a></span>
<span class=normal><a href=#__codelineno-0-56>56</a></span>
<span class=normal><a href=#__codelineno-0-57>57</a></span>
<span class=normal><a href=#__codelineno-0-58>58</a></span>
<span class=normal><a href=#__codelineno-0-59>59</a></span>
<span class=normal><a href=#__codelineno-0-60>60</a></span>
<span class=normal><a href=#__codelineno-0-61>61</a></span>
<span class=normal><a href=#__codelineno-0-62>62</a></span>
<span class=normal><a href=#__codelineno-0-63>63</a></span>
<span class=normal><a href=#__codelineno-0-64>64</a></span>
<span class=normal><a href=#__codelineno-0-65>65</a></span>
<span class=normal><a href=#__codelineno-0-66>66</a></span>
<span class=normal><a href=#__codelineno-0-67>67</a></span>
<span class=normal><a href=#__codelineno-0-68>68</a></span>
<span class=normal><a href=#__codelineno-0-69>69</a></span>
<span class=normal><a href=#__codelineno-0-70>70</a></span>
<span class=normal><a href=#__codelineno-0-71>71</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-41><a id=__codelineno-0-41 name=__codelineno-0-41></a><span class=k>def</span><span class=w> </span><span class=nf>parse_json_args_based_on_signature</span><span class=p>(</span><span class=n>signature</span><span class=p>:</span> <span class=nb>dict</span><span class=p>,</span> <span class=n>args</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-42><a id=__codelineno-0-42 name=__codelineno-0-42></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Finds parameter names based on the signature and tries to extract the values in between from the args string.&quot;&quot;&quot;</span>
</span><span id=__span-0-43><a id=__codelineno-0-43 name=__codelineno-0-43></a>    <span class=n>parameter_names</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>signature</span><span class=p>[</span><span class=s2>&quot;function&quot;</span><span class=p>][</span><span class=s2>&quot;parameters&quot;</span><span class=p>][</span><span class=s2>&quot;properties&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>keys</span><span class=p>())</span>
</span><span id=__span-0-44><a id=__codelineno-0-44 name=__codelineno-0-44></a>    <span class=c1># find each parameter name in the args string</span>
</span><span id=__span-0-45><a id=__codelineno-0-45 name=__codelineno-0-45></a>    <span class=c1>#   assuming each parameter name is surrounded by &quot;s, followed by a colon and optionally preceded by a comma,</span>
</span><span id=__span-0-46><a id=__codelineno-0-46 name=__codelineno-0-46></a>    <span class=c1>#   extract the intervening values as values</span>
</span><span id=__span-0-47><a id=__codelineno-0-47 name=__codelineno-0-47></a>    <span class=n>parameter_positions</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-0-48><a id=__codelineno-0-48 name=__codelineno-0-48></a>    <span class=n>parameter_values</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-0-49><a id=__codelineno-0-49 name=__codelineno-0-49></a>    <span class=k>for</span> <span class=n>param</span> <span class=ow>in</span> <span class=n>parameter_names</span><span class=p>:</span>
</span><span id=__span-0-50><a id=__codelineno-0-50 name=__codelineno-0-50></a>        <span class=n>match</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;,?</span><span class=se>\\</span><span class=s1>s*&quot;(</span><span class=si>{</span><span class=n>param</span><span class=si>}</span><span class=s1>)&quot;</span><span class=se>\\</span><span class=s1>s*:&#39;</span><span class=p>,</span> <span class=n>args</span><span class=p>)</span>
</span><span id=__span-0-51><a id=__codelineno-0-51 name=__codelineno-0-51></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>match</span><span class=p>:</span>
</span><span id=__span-0-52><a id=__codelineno-0-52 name=__codelineno-0-52></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Parameter </span><span class=si>{</span><span class=n>param</span><span class=si>}</span><span class=s2> not found in args </span><span class=si>{</span><span class=n>args</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-53><a id=__codelineno-0-53 name=__codelineno-0-53></a>        <span class=n>parameter_positions</span><span class=p>[</span><span class=n>param</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>match</span><span class=o>.</span><span class=n>start</span><span class=p>(),</span> <span class=n>match</span><span class=o>.</span><span class=n>end</span><span class=p>())</span>
</span><span id=__span-0-54><a id=__codelineno-0-54 name=__codelineno-0-54></a>    <span class=c1># sort the parameter positions by start position</span>
</span><span id=__span-0-55><a id=__codelineno-0-55 name=__codelineno-0-55></a>    <span class=n>sorted_positions</span> <span class=o>=</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>parameter_positions</span><span class=o>.</span><span class=n>items</span><span class=p>(),</span> <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=mi>0</span><span class=p>])</span>
</span><span id=__span-0-56><a id=__codelineno-0-56 name=__codelineno-0-56></a>    <span class=c1># for each parameter, extract the value from the args string</span>
</span><span id=__span-0-57><a id=__codelineno-0-57 name=__codelineno-0-57></a>    <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=p>(</span><span class=n>param</span><span class=p>,</span> <span class=p>(</span><span class=n>start</span><span class=p>,</span> <span class=n>end</span><span class=p>))</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>sorted_positions</span><span class=p>):</span>  <span class=c1># noqa B007</span>
</span><span id=__span-0-58><a id=__codelineno-0-58 name=__codelineno-0-58></a>        <span class=c1># if this is the last parameter, extract the value from the start position to the end of the string</span>
</span><span id=__span-0-59><a id=__codelineno-0-59 name=__codelineno-0-59></a>        <span class=k>if</span> <span class=n>i</span> <span class=o>==</span> <span class=nb>len</span><span class=p>(</span><span class=n>sorted_positions</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span><span class=p>:</span>
</span><span id=__span-0-60><a id=__codelineno-0-60 name=__codelineno-0-60></a>            <span class=n>raw_value</span> <span class=o>=</span> <span class=n>args</span><span class=p>[</span><span class=n>end</span><span class=p>:</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span><span id=__span-0-61><a id=__codelineno-0-61 name=__codelineno-0-61></a>            <span class=k>if</span> <span class=n>raw_value</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=s2>&quot;}&quot;</span><span class=p>):</span>
</span><span id=__span-0-62><a id=__codelineno-0-62 name=__codelineno-0-62></a>                <span class=n>raw_value</span> <span class=o>=</span> <span class=n>raw_value</span><span class=p>[:</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span><span id=__span-0-63><a id=__codelineno-0-63 name=__codelineno-0-63></a>        <span class=c1># otherwise, extract the value from the start position to the start position of the next parameter</span>
</span><span id=__span-0-64><a id=__codelineno-0-64 name=__codelineno-0-64></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-65><a id=__codelineno-0-65 name=__codelineno-0-65></a>            <span class=n>next_start</span> <span class=o>=</span> <span class=n>sorted_positions</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>][</span><span class=mi>1</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span>
</span><span id=__span-0-66><a id=__codelineno-0-66 name=__codelineno-0-66></a>            <span class=n>raw_value</span> <span class=o>=</span> <span class=n>args</span><span class=p>[</span><span class=n>end</span><span class=p>:</span><span class=n>next_start</span><span class=p>]</span>
</span><span id=__span-0-67><a id=__codelineno-0-67 name=__codelineno-0-67></a>        <span class=n>raw_value</span> <span class=o>=</span> <span class=n>raw_value</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span><span id=__span-0-68><a id=__codelineno-0-68 name=__codelineno-0-68></a>        <span class=k>if</span> <span class=n>raw_value</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s1>&#39;&quot;&#39;</span><span class=p>)</span> <span class=ow>and</span> <span class=n>raw_value</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=s1>&#39;&quot;&#39;</span><span class=p>):</span>
</span><span id=__span-0-69><a id=__codelineno-0-69 name=__codelineno-0-69></a>            <span class=n>raw_value</span> <span class=o>=</span> <span class=n>raw_value</span><span class=p>[</span><span class=mi>1</span><span class=p>:</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span><span id=__span-0-70><a id=__codelineno-0-70 name=__codelineno-0-70></a>        <span class=n>parameter_values</span><span class=p>[</span><span class=n>param</span><span class=p>]</span> <span class=o>=</span> <span class=n>raw_value</span>
</span><span id=__span-0-71><a id=__codelineno-0-71 name=__codelineno-0-71></a>    <span class=k>return</span> <span class=n>parameter_values</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-module"> <h4 id=nearai.agents.tool_registry class="doc doc-heading"> <span class="doc doc-object-name doc-module-name">tool_registry</span> <a href=#nearai.agents.tool_registry class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h5 id=nearai.agents.tool_registry.ToolRegistry class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">ToolRegistry</span> <a href=#nearai.agents.tool_registry.ToolRegistry class=headerlink title="Permanent link">&para;</a></h5> <div class="doc doc-contents "> <p>A registry for tools that can be called by the agent.</p> <p>Tool definitions follow this structure:</p> <div class="language-text highlight"><pre><span></span><code>{
    &quot;type&quot;: &quot;function&quot;,
    &quot;function&quot;: {
        &quot;name&quot;: &quot;get_current_weather&quot;,
        &quot;description&quot;: &quot;Get the current weather in a given location&quot;,
        &quot;parameters&quot;: {
            &quot;type&quot;: &quot;object&quot;,
            &quot;properties&quot;: {
                &quot;location&quot;: {
                    &quot;type&quot;: &quot;string&quot;,
                    &quot;description&quot;: &quot;The city and state, e.g. San Francisco, CA&quot;,
                },
                &quot;unit&quot;: {&quot;type&quot;: &quot;string&quot;, &quot;enum&quot;: [&quot;celsius&quot;, &quot;fahrenheit&quot;]},
            },
            &quot;required&quot;: [&quot;location&quot;],
        },
    },
}
</code></pre></div> <details class=quote> <summary>Source code in <code>nearai/agents/tool_registry.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-5>  5</a></span>
<span class=normal><a href=#__codelineno-0-6>  6</a></span>
<span class=normal><a href=#__codelineno-0-7>  7</a></span>
<span class=normal><a href=#__codelineno-0-8>  8</a></span>
<span class=normal><a href=#__codelineno-0-9>  9</a></span>
<span class=normal><a href=#__codelineno-0-10> 10</a></span>
<span class=normal><a href=#__codelineno-0-11> 11</a></span>
<span class=normal><a href=#__codelineno-0-12> 12</a></span>
<span class=normal><a href=#__codelineno-0-13> 13</a></span>
<span class=normal><a href=#__codelineno-0-14> 14</a></span>
<span class=normal><a href=#__codelineno-0-15> 15</a></span>
<span class=normal><a href=#__codelineno-0-16> 16</a></span>
<span class=normal><a href=#__codelineno-0-17> 17</a></span>
<span class=normal><a href=#__codelineno-0-18> 18</a></span>
<span class=normal><a href=#__codelineno-0-19> 19</a></span>
<span class=normal><a href=#__codelineno-0-20> 20</a></span>
<span class=normal><a href=#__codelineno-0-21> 21</a></span>
<span class=normal><a href=#__codelineno-0-22> 22</a></span>
<span class=normal><a href=#__codelineno-0-23> 23</a></span>
<span class=normal><a href=#__codelineno-0-24> 24</a></span>
<span class=normal><a href=#__codelineno-0-25> 25</a></span>
<span class=normal><a href=#__codelineno-0-26> 26</a></span>
<span class=normal><a href=#__codelineno-0-27> 27</a></span>
<span class=normal><a href=#__codelineno-0-28> 28</a></span>
<span class=normal><a href=#__codelineno-0-29> 29</a></span>
<span class=normal><a href=#__codelineno-0-30> 30</a></span>
<span class=normal><a href=#__codelineno-0-31> 31</a></span>
<span class=normal><a href=#__codelineno-0-32> 32</a></span>
<span class=normal><a href=#__codelineno-0-33> 33</a></span>
<span class=normal><a href=#__codelineno-0-34> 34</a></span>
<span class=normal><a href=#__codelineno-0-35> 35</a></span>
<span class=normal><a href=#__codelineno-0-36> 36</a></span>
<span class=normal><a href=#__codelineno-0-37> 37</a></span>
<span class=normal><a href=#__codelineno-0-38> 38</a></span>
<span class=normal><a href=#__codelineno-0-39> 39</a></span>
<span class=normal><a href=#__codelineno-0-40> 40</a></span>
<span class=normal><a href=#__codelineno-0-41> 41</a></span>
<span class=normal><a href=#__codelineno-0-42> 42</a></span>
<span class=normal><a href=#__codelineno-0-43> 43</a></span>
<span class=normal><a href=#__codelineno-0-44> 44</a></span>
<span class=normal><a href=#__codelineno-0-45> 45</a></span>
<span class=normal><a href=#__codelineno-0-46> 46</a></span>
<span class=normal><a href=#__codelineno-0-47> 47</a></span>
<span class=normal><a href=#__codelineno-0-48> 48</a></span>
<span class=normal><a href=#__codelineno-0-49> 49</a></span>
<span class=normal><a href=#__codelineno-0-50> 50</a></span>
<span class=normal><a href=#__codelineno-0-51> 51</a></span>
<span class=normal><a href=#__codelineno-0-52> 52</a></span>
<span class=normal><a href=#__codelineno-0-53> 53</a></span>
<span class=normal><a href=#__codelineno-0-54> 54</a></span>
<span class=normal><a href=#__codelineno-0-55> 55</a></span>
<span class=normal><a href=#__codelineno-0-56> 56</a></span>
<span class=normal><a href=#__codelineno-0-57> 57</a></span>
<span class=normal><a href=#__codelineno-0-58> 58</a></span>
<span class=normal><a href=#__codelineno-0-59> 59</a></span>
<span class=normal><a href=#__codelineno-0-60> 60</a></span>
<span class=normal><a href=#__codelineno-0-61> 61</a></span>
<span class=normal><a href=#__codelineno-0-62> 62</a></span>
<span class=normal><a href=#__codelineno-0-63> 63</a></span>
<span class=normal><a href=#__codelineno-0-64> 64</a></span>
<span class=normal><a href=#__codelineno-0-65> 65</a></span>
<span class=normal><a href=#__codelineno-0-66> 66</a></span>
<span class=normal><a href=#__codelineno-0-67> 67</a></span>
<span class=normal><a href=#__codelineno-0-68> 68</a></span>
<span class=normal><a href=#__codelineno-0-69> 69</a></span>
<span class=normal><a href=#__codelineno-0-70> 70</a></span>
<span class=normal><a href=#__codelineno-0-71> 71</a></span>
<span class=normal><a href=#__codelineno-0-72> 72</a></span>
<span class=normal><a href=#__codelineno-0-73> 73</a></span>
<span class=normal><a href=#__codelineno-0-74> 74</a></span>
<span class=normal><a href=#__codelineno-0-75> 75</a></span>
<span class=normal><a href=#__codelineno-0-76> 76</a></span>
<span class=normal><a href=#__codelineno-0-77> 77</a></span>
<span class=normal><a href=#__codelineno-0-78> 78</a></span>
<span class=normal><a href=#__codelineno-0-79> 79</a></span>
<span class=normal><a href=#__codelineno-0-80> 80</a></span>
<span class=normal><a href=#__codelineno-0-81> 81</a></span>
<span class=normal><a href=#__codelineno-0-82> 82</a></span>
<span class=normal><a href=#__codelineno-0-83> 83</a></span>
<span class=normal><a href=#__codelineno-0-84> 84</a></span>
<span class=normal><a href=#__codelineno-0-85> 85</a></span>
<span class=normal><a href=#__codelineno-0-86> 86</a></span>
<span class=normal><a href=#__codelineno-0-87> 87</a></span>
<span class=normal><a href=#__codelineno-0-88> 88</a></span>
<span class=normal><a href=#__codelineno-0-89> 89</a></span>
<span class=normal><a href=#__codelineno-0-90> 90</a></span>
<span class=normal><a href=#__codelineno-0-91> 91</a></span>
<span class=normal><a href=#__codelineno-0-92> 92</a></span>
<span class=normal><a href=#__codelineno-0-93> 93</a></span>
<span class=normal><a href=#__codelineno-0-94> 94</a></span>
<span class=normal><a href=#__codelineno-0-95> 95</a></span>
<span class=normal><a href=#__codelineno-0-96> 96</a></span>
<span class=normal><a href=#__codelineno-0-97> 97</a></span>
<span class=normal><a href=#__codelineno-0-98> 98</a></span>
<span class=normal><a href=#__codelineno-0-99> 99</a></span>
<span class=normal><a href=#__codelineno-0-100>100</a></span>
<span class=normal><a href=#__codelineno-0-101>101</a></span>
<span class=normal><a href=#__codelineno-0-102>102</a></span>
<span class=normal><a href=#__codelineno-0-103>103</a></span>
<span class=normal><a href=#__codelineno-0-104>104</a></span>
<span class=normal><a href=#__codelineno-0-105>105</a></span>
<span class=normal><a href=#__codelineno-0-106>106</a></span>
<span class=normal><a href=#__codelineno-0-107>107</a></span>
<span class=normal><a href=#__codelineno-0-108>108</a></span>
<span class=normal><a href=#__codelineno-0-109>109</a></span>
<span class=normal><a href=#__codelineno-0-110>110</a></span>
<span class=normal><a href=#__codelineno-0-111>111</a></span>
<span class=normal><a href=#__codelineno-0-112>112</a></span>
<span class=normal><a href=#__codelineno-0-113>113</a></span>
<span class=normal><a href=#__codelineno-0-114>114</a></span>
<span class=normal><a href=#__codelineno-0-115>115</a></span>
<span class=normal><a href=#__codelineno-0-116>116</a></span>
<span class=normal><a href=#__codelineno-0-117>117</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5></a><span class=k>class</span><span class=w> </span><span class=nc>ToolRegistry</span><span class=p>:</span>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;A registry for tools that can be called by the agent.</span>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7></a>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8></a><span class=sd>    Tool definitions follow this structure:</span>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9></a>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10></a><span class=sd>        {</span>
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11></a><span class=sd>            &quot;type&quot;: &quot;function&quot;,</span>
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12></a><span class=sd>            &quot;function&quot;: {</span>
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13></a><span class=sd>                &quot;name&quot;: &quot;get_current_weather&quot;,</span>
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14></a><span class=sd>                &quot;description&quot;: &quot;Get the current weather in a given location&quot;,</span>
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15></a><span class=sd>                &quot;parameters&quot;: {</span>
</span><span id=__span-0-16><a id=__codelineno-0-16 name=__codelineno-0-16></a><span class=sd>                    &quot;type&quot;: &quot;object&quot;,</span>
</span><span id=__span-0-17><a id=__codelineno-0-17 name=__codelineno-0-17></a><span class=sd>                    &quot;properties&quot;: {</span>
</span><span id=__span-0-18><a id=__codelineno-0-18 name=__codelineno-0-18></a><span class=sd>                        &quot;location&quot;: {</span>
</span><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19></a><span class=sd>                            &quot;type&quot;: &quot;string&quot;,</span>
</span><span id=__span-0-20><a id=__codelineno-0-20 name=__codelineno-0-20></a><span class=sd>                            &quot;description&quot;: &quot;The city and state, e.g. San Francisco, CA&quot;,</span>
</span><span id=__span-0-21><a id=__codelineno-0-21 name=__codelineno-0-21></a><span class=sd>                        },</span>
</span><span id=__span-0-22><a id=__codelineno-0-22 name=__codelineno-0-22></a><span class=sd>                        &quot;unit&quot;: {&quot;type&quot;: &quot;string&quot;, &quot;enum&quot;: [&quot;celsius&quot;, &quot;fahrenheit&quot;]},</span>
</span><span id=__span-0-23><a id=__codelineno-0-23 name=__codelineno-0-23></a><span class=sd>                    },</span>
</span><span id=__span-0-24><a id=__codelineno-0-24 name=__codelineno-0-24></a><span class=sd>                    &quot;required&quot;: [&quot;location&quot;],</span>
</span><span id=__span-0-25><a id=__codelineno-0-25 name=__codelineno-0-25></a><span class=sd>                },</span>
</span><span id=__span-0-26><a id=__codelineno-0-26 name=__codelineno-0-26></a><span class=sd>            },</span>
</span><span id=__span-0-27><a id=__codelineno-0-27 name=__codelineno-0-27></a><span class=sd>        }</span>
</span><span id=__span-0-28><a id=__codelineno-0-28 name=__codelineno-0-28></a>
</span><span id=__span-0-29><a id=__codelineno-0-29 name=__codelineno-0-29></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-30><a id=__codelineno-0-30 name=__codelineno-0-30></a>
</span><span id=__span-0-31><a id=__codelineno-0-31 name=__codelineno-0-31></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>  <span class=c1># noqa: D107</span>
</span><span id=__span-0-32><a id=__codelineno-0-32 name=__codelineno-0-32></a>        <span class=bp>self</span><span class=o>.</span><span class=n>tools</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Callable</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-0-33><a id=__codelineno-0-33 name=__codelineno-0-33></a>
</span><span id=__span-0-34><a id=__codelineno-0-34 name=__codelineno-0-34></a>    <span class=k>def</span><span class=w> </span><span class=nf>register_tool</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>tool</span><span class=p>:</span> <span class=n>Callable</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-35><a id=__codelineno-0-35 name=__codelineno-0-35></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Register a tool.&quot;&quot;&quot;</span>
</span><span id=__span-0-36><a id=__codelineno-0-36 name=__codelineno-0-36></a>        <span class=bp>self</span><span class=o>.</span><span class=n>tools</span><span class=p>[</span><span class=n>tool</span><span class=o>.</span><span class=vm>__name__</span><span class=p>]</span> <span class=o>=</span> <span class=n>tool</span>
</span><span id=__span-0-37><a id=__codelineno-0-37 name=__codelineno-0-37></a>
</span><span id=__span-0-38><a id=__codelineno-0-38 name=__codelineno-0-38></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_tool</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Callable</span><span class=p>]:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-39><a id=__codelineno-0-39 name=__codelineno-0-39></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Get a tool by name.&quot;&quot;&quot;</span>
</span><span id=__span-0-40><a id=__codelineno-0-40 name=__codelineno-0-40></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>tools</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>name</span><span class=p>)</span>
</span><span id=__span-0-41><a id=__codelineno-0-41 name=__codelineno-0-41></a>
</span><span id=__span-0-42><a id=__codelineno-0-42 name=__codelineno-0-42></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_all_tools</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Callable</span><span class=p>]:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-43><a id=__codelineno-0-43 name=__codelineno-0-43></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Get all tools.&quot;&quot;&quot;</span>
</span><span id=__span-0-44><a id=__codelineno-0-44 name=__codelineno-0-44></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>tools</span>
</span><span id=__span-0-45><a id=__codelineno-0-45 name=__codelineno-0-45></a>
</span><span id=__span-0-46><a id=__codelineno-0-46 name=__codelineno-0-46></a>    <span class=k>def</span><span class=w> </span><span class=nf>call_tool</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n>Any</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Any</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-47><a id=__codelineno-0-47 name=__codelineno-0-47></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Call a tool by name.&quot;&quot;&quot;</span>
</span><span id=__span-0-48><a id=__codelineno-0-48 name=__codelineno-0-48></a>        <span class=n>tool</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_tool</span><span class=p>(</span><span class=n>name</span><span class=p>)</span>
</span><span id=__span-0-49><a id=__codelineno-0-49 name=__codelineno-0-49></a>        <span class=k>if</span> <span class=n>tool</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-50><a id=__codelineno-0-50 name=__codelineno-0-50></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Tool &#39;</span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>&#39; not found.&quot;</span><span class=p>)</span>
</span><span id=__span-0-51><a id=__codelineno-0-51 name=__codelineno-0-51></a>        <span class=k>return</span> <span class=n>tool</span><span class=p>(</span><span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span><span id=__span-0-52><a id=__codelineno-0-52 name=__codelineno-0-52></a>
</span><span id=__span-0-53><a id=__codelineno-0-53 name=__codelineno-0-53></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_tool_definition</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>]:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-54><a id=__codelineno-0-54 name=__codelineno-0-54></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Get the definition of a tool by name.&quot;&quot;&quot;</span>
</span><span id=__span-0-55><a id=__codelineno-0-55 name=__codelineno-0-55></a>        <span class=n>tool</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_tool</span><span class=p>(</span><span class=n>name</span><span class=p>)</span>
</span><span id=__span-0-56><a id=__codelineno-0-56 name=__codelineno-0-56></a>        <span class=k>if</span> <span class=n>tool</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-57><a id=__codelineno-0-57 name=__codelineno-0-57></a>            <span class=k>return</span> <span class=kc>None</span>
</span><span id=__span-0-58><a id=__codelineno-0-58 name=__codelineno-0-58></a>
</span><span id=__span-0-59><a id=__codelineno-0-59 name=__codelineno-0-59></a>        <span class=k>assert</span> <span class=n>tool</span><span class=o>.</span><span class=vm>__doc__</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&quot;Docstring missing for tool &#39;</span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>&#39;.&quot;</span>
</span><span id=__span-0-60><a id=__codelineno-0-60 name=__codelineno-0-60></a>        <span class=n>docstring</span> <span class=o>=</span> <span class=n>tool</span><span class=o>.</span><span class=vm>__doc__</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-61><a id=__codelineno-0-61 name=__codelineno-0-61></a>
</span><span id=__span-0-62><a id=__codelineno-0-62 name=__codelineno-0-62></a>        <span class=c1># The first line of the docstring is the function description</span>
</span><span id=__span-0-63><a id=__codelineno-0-63 name=__codelineno-0-63></a>        <span class=n>function_description</span> <span class=o>=</span> <span class=n>docstring</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span><span id=__span-0-64><a id=__codelineno-0-64 name=__codelineno-0-64></a>
</span><span id=__span-0-65><a id=__codelineno-0-65 name=__codelineno-0-65></a>        <span class=c1># The rest of the lines contain parameter descriptions</span>
</span><span id=__span-0-66><a id=__codelineno-0-66 name=__codelineno-0-66></a>        <span class=n>param_descriptions</span> <span class=o>=</span> <span class=n>docstring</span><span class=p>[</span><span class=mi>1</span><span class=p>:]</span>
</span><span id=__span-0-67><a id=__codelineno-0-67 name=__codelineno-0-67></a>
</span><span id=__span-0-68><a id=__codelineno-0-68 name=__codelineno-0-68></a>        <span class=c1># Extract parameter names and types</span>
</span><span id=__span-0-69><a id=__codelineno-0-69 name=__codelineno-0-69></a>        <span class=n>signature</span> <span class=o>=</span> <span class=n>inspect</span><span class=o>.</span><span class=n>signature</span><span class=p>(</span><span class=n>tool</span><span class=p>)</span>
</span><span id=__span-0-70><a id=__codelineno-0-70 name=__codelineno-0-70></a>        <span class=n>type_hints</span> <span class=o>=</span> <span class=n>get_type_hints</span><span class=p>(</span><span class=n>tool</span><span class=p>)</span>
</span><span id=__span-0-71><a id=__codelineno-0-71 name=__codelineno-0-71></a>
</span><span id=__span-0-72><a id=__codelineno-0-72 name=__codelineno-0-72></a>        <span class=n>parameters</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;object&quot;</span><span class=p>,</span> <span class=s2>&quot;properties&quot;</span><span class=p>:</span> <span class=p>{},</span> <span class=s2>&quot;required&quot;</span><span class=p>:</span> <span class=p>[]}</span>
</span><span id=__span-0-73><a id=__codelineno-0-73 name=__codelineno-0-73></a>
</span><span id=__span-0-74><a id=__codelineno-0-74 name=__codelineno-0-74></a>        <span class=c1># Iterate through function parameters</span>
</span><span id=__span-0-75><a id=__codelineno-0-75 name=__codelineno-0-75></a>        <span class=k>for</span> <span class=n>param</span> <span class=ow>in</span> <span class=n>signature</span><span class=o>.</span><span class=n>parameters</span><span class=o>.</span><span class=n>values</span><span class=p>():</span>
</span><span id=__span-0-76><a id=__codelineno-0-76 name=__codelineno-0-76></a>            <span class=n>param_name</span> <span class=o>=</span> <span class=n>param</span><span class=o>.</span><span class=n>name</span>
</span><span id=__span-0-77><a id=__codelineno-0-77 name=__codelineno-0-77></a>            <span class=n>param_type</span> <span class=o>=</span> <span class=n>type_hints</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>param_name</span><span class=p>,</span> <span class=nb>str</span><span class=p>)</span>  <span class=c1># Default to str if type hint is missing</span>
</span><span id=__span-0-78><a id=__codelineno-0-78 name=__codelineno-0-78></a>            <span class=n>param_description</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-79><a id=__codelineno-0-79 name=__codelineno-0-79></a>
</span><span id=__span-0-80><a id=__codelineno-0-80 name=__codelineno-0-80></a>            <span class=c1># Find the parameter description in the docstring</span>
</span><span id=__span-0-81><a id=__codelineno-0-81 name=__codelineno-0-81></a>            <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>param_descriptions</span><span class=p>:</span>
</span><span id=__span-0-82><a id=__codelineno-0-82 name=__codelineno-0-82></a>                <span class=k>if</span> <span class=n>line</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=n>param_name</span><span class=p>):</span>
</span><span id=__span-0-83><a id=__codelineno-0-83 name=__codelineno-0-83></a>                    <span class=n>param_description</span> <span class=o>=</span> <span class=n>line</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;:&quot;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span><span id=__span-0-84><a id=__codelineno-0-84 name=__codelineno-0-84></a>                    <span class=k>break</span>
</span><span id=__span-0-85><a id=__codelineno-0-85 name=__codelineno-0-85></a>
</span><span id=__span-0-86><a id=__codelineno-0-86 name=__codelineno-0-86></a>            <span class=c1># Convert type hint to JSON Schema type</span>
</span><span id=__span-0-87><a id=__codelineno-0-87 name=__codelineno-0-87></a>            <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>param_type</span><span class=p>,</span> <span class=n>_GenericAlias</span><span class=p>)</span> <span class=ow>and</span> <span class=n>param_type</span><span class=o>.</span><span class=n>__origin__</span> <span class=ow>is</span> <span class=n>Literal</span><span class=p>:</span>
</span><span id=__span-0-88><a id=__codelineno-0-88 name=__codelineno-0-88></a>                <span class=n>json_type</span> <span class=o>=</span> <span class=s2>&quot;string&quot;</span>
</span><span id=__span-0-89><a id=__codelineno-0-89 name=__codelineno-0-89></a>            <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-90><a id=__codelineno-0-90 name=__codelineno-0-90></a>                <span class=n>json_type</span> <span class=o>=</span> <span class=n>param_type</span><span class=o>.</span><span class=vm>__name__</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
</span><span id=__span-0-91><a id=__codelineno-0-91 name=__codelineno-0-91></a>
</span><span id=__span-0-92><a id=__codelineno-0-92 name=__codelineno-0-92></a>            <span class=k>if</span> <span class=n>json_type</span> <span class=o>==</span> <span class=s2>&quot;union&quot;</span><span class=p>:</span>
</span><span id=__span-0-93><a id=__codelineno-0-93 name=__codelineno-0-93></a>                <span class=n>json_type</span> <span class=o>=</span> <span class=p>[</span><span class=n>t</span><span class=o>.</span><span class=vm>__name__</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>param_type</span><span class=o>.</span><span class=n>__args__</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span>
</span><span id=__span-0-94><a id=__codelineno-0-94 name=__codelineno-0-94></a>
</span><span id=__span-0-95><a id=__codelineno-0-95 name=__codelineno-0-95></a>            <span class=n>json_type</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;int&quot;</span><span class=p>:</span> <span class=s2>&quot;integer&quot;</span><span class=p>,</span> <span class=s2>&quot;float&quot;</span><span class=p>:</span> <span class=s2>&quot;number&quot;</span><span class=p>,</span> <span class=s2>&quot;str&quot;</span><span class=p>:</span> <span class=s2>&quot;string&quot;</span><span class=p>,</span> <span class=s2>&quot;bool&quot;</span><span class=p>:</span> <span class=s2>&quot;boolean&quot;</span><span class=p>}</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
</span><span id=__span-0-96><a id=__codelineno-0-96 name=__codelineno-0-96></a>                <span class=n>json_type</span><span class=p>,</span> <span class=s2>&quot;string&quot;</span>
</span><span id=__span-0-97><a id=__codelineno-0-97 name=__codelineno-0-97></a>            <span class=p>)</span>
</span><span id=__span-0-98><a id=__codelineno-0-98 name=__codelineno-0-98></a>
</span><span id=__span-0-99><a id=__codelineno-0-99 name=__codelineno-0-99></a>            <span class=c1># Add parameter to the definition</span>
</span><span id=__span-0-100><a id=__codelineno-0-100 name=__codelineno-0-100></a>            <span class=n>parameters</span><span class=p>[</span><span class=s2>&quot;properties&quot;</span><span class=p>][</span><span class=n>param_name</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=n>param_description</span><span class=p>,</span> <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=n>json_type</span><span class=p>}</span>
</span><span id=__span-0-101><a id=__codelineno-0-101 name=__codelineno-0-101></a>
</span><span id=__span-0-102><a id=__codelineno-0-102 name=__codelineno-0-102></a>            <span class=c1># Params without default values are required params</span>
</span><span id=__span-0-103><a id=__codelineno-0-103 name=__codelineno-0-103></a>            <span class=k>if</span> <span class=n>param</span><span class=o>.</span><span class=n>default</span> <span class=o>==</span> <span class=n>inspect</span><span class=o>.</span><span class=n>Parameter</span><span class=o>.</span><span class=n>empty</span><span class=p>:</span>
</span><span id=__span-0-104><a id=__codelineno-0-104 name=__codelineno-0-104></a>                <span class=n>parameters</span><span class=p>[</span><span class=s2>&quot;required&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>param_name</span><span class=p>)</span>
</span><span id=__span-0-105><a id=__codelineno-0-105 name=__codelineno-0-105></a>
</span><span id=__span-0-106><a id=__codelineno-0-106 name=__codelineno-0-106></a>        <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-0-107><a id=__codelineno-0-107 name=__codelineno-0-107></a>            <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;function&quot;</span><span class=p>,</span>
</span><span id=__span-0-108><a id=__codelineno-0-108 name=__codelineno-0-108></a>            <span class=s2>&quot;function&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=n>tool</span><span class=o>.</span><span class=vm>__name__</span><span class=p>,</span> <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=n>function_description</span><span class=p>,</span> <span class=s2>&quot;parameters&quot;</span><span class=p>:</span> <span class=n>parameters</span><span class=p>},</span>
</span><span id=__span-0-109><a id=__codelineno-0-109 name=__codelineno-0-109></a>        <span class=p>}</span>
</span><span id=__span-0-110><a id=__codelineno-0-110 name=__codelineno-0-110></a>
</span><span id=__span-0-111><a id=__codelineno-0-111 name=__codelineno-0-111></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_all_tool_definitions</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=n>Dict</span><span class=p>]:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-112><a id=__codelineno-0-112 name=__codelineno-0-112></a>        <span class=n>definitions</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-0-113><a id=__codelineno-0-113 name=__codelineno-0-113></a>        <span class=k>for</span> <span class=n>tool_name</span><span class=p>,</span> <span class=n>_tool</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>tools</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span><span id=__span-0-114><a id=__codelineno-0-114 name=__codelineno-0-114></a>            <span class=n>definition</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_tool_definition</span><span class=p>(</span><span class=n>tool_name</span><span class=p>)</span>
</span><span id=__span-0-115><a id=__codelineno-0-115 name=__codelineno-0-115></a>            <span class=k>if</span> <span class=n>definition</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-116><a id=__codelineno-0-116 name=__codelineno-0-116></a>                <span class=n>definitions</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>definition</span><span class=p>)</span>
</span><span id=__span-0-117><a id=__codelineno-0-117 name=__codelineno-0-117></a>        <span class=k>return</span> <span class=n>definitions</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.tool_registry.ToolRegistry.call_tool class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">call_tool</span> <a href=#nearai.agents.tool_registry.ToolRegistry.call_tool class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>call_tool</span><span class=p>(</span><span class=n>name</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n><span title=typing.Any>Any</span></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=typing.Any>Any</span></span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Call a tool by name.</p> <details class=quote> <summary>Source code in <code>nearai/agents/tool_registry.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-46>46</a></span>
<span class=normal><a href=#__codelineno-0-47>47</a></span>
<span class=normal><a href=#__codelineno-0-48>48</a></span>
<span class=normal><a href=#__codelineno-0-49>49</a></span>
<span class=normal><a href=#__codelineno-0-50>50</a></span>
<span class=normal><a href=#__codelineno-0-51>51</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-46><a id=__codelineno-0-46 name=__codelineno-0-46></a><span class=k>def</span><span class=w> </span><span class=nf>call_tool</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n>Any</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Any</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-47><a id=__codelineno-0-47 name=__codelineno-0-47></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Call a tool by name.&quot;&quot;&quot;</span>
</span><span id=__span-0-48><a id=__codelineno-0-48 name=__codelineno-0-48></a>    <span class=n>tool</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_tool</span><span class=p>(</span><span class=n>name</span><span class=p>)</span>
</span><span id=__span-0-49><a id=__codelineno-0-49 name=__codelineno-0-49></a>    <span class=k>if</span> <span class=n>tool</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-50><a id=__codelineno-0-50 name=__codelineno-0-50></a>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Tool &#39;</span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>&#39; not found.&quot;</span><span class=p>)</span>
</span><span id=__span-0-51><a id=__codelineno-0-51 name=__codelineno-0-51></a>    <span class=k>return</span> <span class=n>tool</span><span class=p>(</span><span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.tool_registry.ToolRegistry.get_all_tools class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_all_tools</span> <a href=#nearai.agents.tool_registry.ToolRegistry.get_all_tools class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>get_all_tools</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n><span title=typing.Dict>Dict</span></span><span class=p>[</span><span class=n>str</span><span class=p>,</span> <span class=n><span title=typing.Callable>Callable</span></span><span class=p>]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Get all tools.</p> <details class=quote> <summary>Source code in <code>nearai/agents/tool_registry.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-42>42</a></span>
<span class=normal><a href=#__codelineno-0-43>43</a></span>
<span class=normal><a href=#__codelineno-0-44>44</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-42><a id=__codelineno-0-42 name=__codelineno-0-42></a><span class=k>def</span><span class=w> </span><span class=nf>get_all_tools</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Callable</span><span class=p>]:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-43><a id=__codelineno-0-43 name=__codelineno-0-43></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Get all tools.&quot;&quot;&quot;</span>
</span><span id=__span-0-44><a id=__codelineno-0-44 name=__codelineno-0-44></a>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>tools</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.tool_registry.ToolRegistry.get_tool class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_tool</span> <a href=#nearai.agents.tool_registry.ToolRegistry.get_tool class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>get_tool</span><span class=p>(</span><span class=n>name</span><span class=p>:</span> <span class=n>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n><span title=typing.Callable>Callable</span></span><span class=p>]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Get a tool by name.</p> <details class=quote> <summary>Source code in <code>nearai/agents/tool_registry.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-38>38</a></span>
<span class=normal><a href=#__codelineno-0-39>39</a></span>
<span class=normal><a href=#__codelineno-0-40>40</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-38><a id=__codelineno-0-38 name=__codelineno-0-38></a><span class=k>def</span><span class=w> </span><span class=nf>get_tool</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Callable</span><span class=p>]:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-39><a id=__codelineno-0-39 name=__codelineno-0-39></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Get a tool by name.&quot;&quot;&quot;</span>
</span><span id=__span-0-40><a id=__codelineno-0-40 name=__codelineno-0-40></a>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>tools</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>name</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.tool_registry.ToolRegistry.get_tool_definition class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_tool_definition</span> <a href=#nearai.agents.tool_registry.ToolRegistry.get_tool_definition class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>get_tool_definition</span><span class=p>(</span><span class=n>name</span><span class=p>:</span> <span class=n>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n><span title=typing.Dict>Dict</span></span><span class=p>]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Get the definition of a tool by name.</p> <details class=quote> <summary>Source code in <code>nearai/agents/tool_registry.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-53> 53</a></span>
<span class=normal><a href=#__codelineno-0-54> 54</a></span>
<span class=normal><a href=#__codelineno-0-55> 55</a></span>
<span class=normal><a href=#__codelineno-0-56> 56</a></span>
<span class=normal><a href=#__codelineno-0-57> 57</a></span>
<span class=normal><a href=#__codelineno-0-58> 58</a></span>
<span class=normal><a href=#__codelineno-0-59> 59</a></span>
<span class=normal><a href=#__codelineno-0-60> 60</a></span>
<span class=normal><a href=#__codelineno-0-61> 61</a></span>
<span class=normal><a href=#__codelineno-0-62> 62</a></span>
<span class=normal><a href=#__codelineno-0-63> 63</a></span>
<span class=normal><a href=#__codelineno-0-64> 64</a></span>
<span class=normal><a href=#__codelineno-0-65> 65</a></span>
<span class=normal><a href=#__codelineno-0-66> 66</a></span>
<span class=normal><a href=#__codelineno-0-67> 67</a></span>
<span class=normal><a href=#__codelineno-0-68> 68</a></span>
<span class=normal><a href=#__codelineno-0-69> 69</a></span>
<span class=normal><a href=#__codelineno-0-70> 70</a></span>
<span class=normal><a href=#__codelineno-0-71> 71</a></span>
<span class=normal><a href=#__codelineno-0-72> 72</a></span>
<span class=normal><a href=#__codelineno-0-73> 73</a></span>
<span class=normal><a href=#__codelineno-0-74> 74</a></span>
<span class=normal><a href=#__codelineno-0-75> 75</a></span>
<span class=normal><a href=#__codelineno-0-76> 76</a></span>
<span class=normal><a href=#__codelineno-0-77> 77</a></span>
<span class=normal><a href=#__codelineno-0-78> 78</a></span>
<span class=normal><a href=#__codelineno-0-79> 79</a></span>
<span class=normal><a href=#__codelineno-0-80> 80</a></span>
<span class=normal><a href=#__codelineno-0-81> 81</a></span>
<span class=normal><a href=#__codelineno-0-82> 82</a></span>
<span class=normal><a href=#__codelineno-0-83> 83</a></span>
<span class=normal><a href=#__codelineno-0-84> 84</a></span>
<span class=normal><a href=#__codelineno-0-85> 85</a></span>
<span class=normal><a href=#__codelineno-0-86> 86</a></span>
<span class=normal><a href=#__codelineno-0-87> 87</a></span>
<span class=normal><a href=#__codelineno-0-88> 88</a></span>
<span class=normal><a href=#__codelineno-0-89> 89</a></span>
<span class=normal><a href=#__codelineno-0-90> 90</a></span>
<span class=normal><a href=#__codelineno-0-91> 91</a></span>
<span class=normal><a href=#__codelineno-0-92> 92</a></span>
<span class=normal><a href=#__codelineno-0-93> 93</a></span>
<span class=normal><a href=#__codelineno-0-94> 94</a></span>
<span class=normal><a href=#__codelineno-0-95> 95</a></span>
<span class=normal><a href=#__codelineno-0-96> 96</a></span>
<span class=normal><a href=#__codelineno-0-97> 97</a></span>
<span class=normal><a href=#__codelineno-0-98> 98</a></span>
<span class=normal><a href=#__codelineno-0-99> 99</a></span>
<span class=normal><a href=#__codelineno-0-100>100</a></span>
<span class=normal><a href=#__codelineno-0-101>101</a></span>
<span class=normal><a href=#__codelineno-0-102>102</a></span>
<span class=normal><a href=#__codelineno-0-103>103</a></span>
<span class=normal><a href=#__codelineno-0-104>104</a></span>
<span class=normal><a href=#__codelineno-0-105>105</a></span>
<span class=normal><a href=#__codelineno-0-106>106</a></span>
<span class=normal><a href=#__codelineno-0-107>107</a></span>
<span class=normal><a href=#__codelineno-0-108>108</a></span>
<span class=normal><a href=#__codelineno-0-109>109</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-53><a id=__codelineno-0-53 name=__codelineno-0-53></a><span class=k>def</span><span class=w> </span><span class=nf>get_tool_definition</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>]:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-54><a id=__codelineno-0-54 name=__codelineno-0-54></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Get the definition of a tool by name.&quot;&quot;&quot;</span>
</span><span id=__span-0-55><a id=__codelineno-0-55 name=__codelineno-0-55></a>    <span class=n>tool</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_tool</span><span class=p>(</span><span class=n>name</span><span class=p>)</span>
</span><span id=__span-0-56><a id=__codelineno-0-56 name=__codelineno-0-56></a>    <span class=k>if</span> <span class=n>tool</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-57><a id=__codelineno-0-57 name=__codelineno-0-57></a>        <span class=k>return</span> <span class=kc>None</span>
</span><span id=__span-0-58><a id=__codelineno-0-58 name=__codelineno-0-58></a>
</span><span id=__span-0-59><a id=__codelineno-0-59 name=__codelineno-0-59></a>    <span class=k>assert</span> <span class=n>tool</span><span class=o>.</span><span class=vm>__doc__</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&quot;Docstring missing for tool &#39;</span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>&#39;.&quot;</span>
</span><span id=__span-0-60><a id=__codelineno-0-60 name=__codelineno-0-60></a>    <span class=n>docstring</span> <span class=o>=</span> <span class=n>tool</span><span class=o>.</span><span class=vm>__doc__</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-61><a id=__codelineno-0-61 name=__codelineno-0-61></a>
</span><span id=__span-0-62><a id=__codelineno-0-62 name=__codelineno-0-62></a>    <span class=c1># The first line of the docstring is the function description</span>
</span><span id=__span-0-63><a id=__codelineno-0-63 name=__codelineno-0-63></a>    <span class=n>function_description</span> <span class=o>=</span> <span class=n>docstring</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span><span id=__span-0-64><a id=__codelineno-0-64 name=__codelineno-0-64></a>
</span><span id=__span-0-65><a id=__codelineno-0-65 name=__codelineno-0-65></a>    <span class=c1># The rest of the lines contain parameter descriptions</span>
</span><span id=__span-0-66><a id=__codelineno-0-66 name=__codelineno-0-66></a>    <span class=n>param_descriptions</span> <span class=o>=</span> <span class=n>docstring</span><span class=p>[</span><span class=mi>1</span><span class=p>:]</span>
</span><span id=__span-0-67><a id=__codelineno-0-67 name=__codelineno-0-67></a>
</span><span id=__span-0-68><a id=__codelineno-0-68 name=__codelineno-0-68></a>    <span class=c1># Extract parameter names and types</span>
</span><span id=__span-0-69><a id=__codelineno-0-69 name=__codelineno-0-69></a>    <span class=n>signature</span> <span class=o>=</span> <span class=n>inspect</span><span class=o>.</span><span class=n>signature</span><span class=p>(</span><span class=n>tool</span><span class=p>)</span>
</span><span id=__span-0-70><a id=__codelineno-0-70 name=__codelineno-0-70></a>    <span class=n>type_hints</span> <span class=o>=</span> <span class=n>get_type_hints</span><span class=p>(</span><span class=n>tool</span><span class=p>)</span>
</span><span id=__span-0-71><a id=__codelineno-0-71 name=__codelineno-0-71></a>
</span><span id=__span-0-72><a id=__codelineno-0-72 name=__codelineno-0-72></a>    <span class=n>parameters</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;object&quot;</span><span class=p>,</span> <span class=s2>&quot;properties&quot;</span><span class=p>:</span> <span class=p>{},</span> <span class=s2>&quot;required&quot;</span><span class=p>:</span> <span class=p>[]}</span>
</span><span id=__span-0-73><a id=__codelineno-0-73 name=__codelineno-0-73></a>
</span><span id=__span-0-74><a id=__codelineno-0-74 name=__codelineno-0-74></a>    <span class=c1># Iterate through function parameters</span>
</span><span id=__span-0-75><a id=__codelineno-0-75 name=__codelineno-0-75></a>    <span class=k>for</span> <span class=n>param</span> <span class=ow>in</span> <span class=n>signature</span><span class=o>.</span><span class=n>parameters</span><span class=o>.</span><span class=n>values</span><span class=p>():</span>
</span><span id=__span-0-76><a id=__codelineno-0-76 name=__codelineno-0-76></a>        <span class=n>param_name</span> <span class=o>=</span> <span class=n>param</span><span class=o>.</span><span class=n>name</span>
</span><span id=__span-0-77><a id=__codelineno-0-77 name=__codelineno-0-77></a>        <span class=n>param_type</span> <span class=o>=</span> <span class=n>type_hints</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>param_name</span><span class=p>,</span> <span class=nb>str</span><span class=p>)</span>  <span class=c1># Default to str if type hint is missing</span>
</span><span id=__span-0-78><a id=__codelineno-0-78 name=__codelineno-0-78></a>        <span class=n>param_description</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-79><a id=__codelineno-0-79 name=__codelineno-0-79></a>
</span><span id=__span-0-80><a id=__codelineno-0-80 name=__codelineno-0-80></a>        <span class=c1># Find the parameter description in the docstring</span>
</span><span id=__span-0-81><a id=__codelineno-0-81 name=__codelineno-0-81></a>        <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>param_descriptions</span><span class=p>:</span>
</span><span id=__span-0-82><a id=__codelineno-0-82 name=__codelineno-0-82></a>            <span class=k>if</span> <span class=n>line</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=n>param_name</span><span class=p>):</span>
</span><span id=__span-0-83><a id=__codelineno-0-83 name=__codelineno-0-83></a>                <span class=n>param_description</span> <span class=o>=</span> <span class=n>line</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;:&quot;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span><span id=__span-0-84><a id=__codelineno-0-84 name=__codelineno-0-84></a>                <span class=k>break</span>
</span><span id=__span-0-85><a id=__codelineno-0-85 name=__codelineno-0-85></a>
</span><span id=__span-0-86><a id=__codelineno-0-86 name=__codelineno-0-86></a>        <span class=c1># Convert type hint to JSON Schema type</span>
</span><span id=__span-0-87><a id=__codelineno-0-87 name=__codelineno-0-87></a>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>param_type</span><span class=p>,</span> <span class=n>_GenericAlias</span><span class=p>)</span> <span class=ow>and</span> <span class=n>param_type</span><span class=o>.</span><span class=n>__origin__</span> <span class=ow>is</span> <span class=n>Literal</span><span class=p>:</span>
</span><span id=__span-0-88><a id=__codelineno-0-88 name=__codelineno-0-88></a>            <span class=n>json_type</span> <span class=o>=</span> <span class=s2>&quot;string&quot;</span>
</span><span id=__span-0-89><a id=__codelineno-0-89 name=__codelineno-0-89></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-90><a id=__codelineno-0-90 name=__codelineno-0-90></a>            <span class=n>json_type</span> <span class=o>=</span> <span class=n>param_type</span><span class=o>.</span><span class=vm>__name__</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
</span><span id=__span-0-91><a id=__codelineno-0-91 name=__codelineno-0-91></a>
</span><span id=__span-0-92><a id=__codelineno-0-92 name=__codelineno-0-92></a>        <span class=k>if</span> <span class=n>json_type</span> <span class=o>==</span> <span class=s2>&quot;union&quot;</span><span class=p>:</span>
</span><span id=__span-0-93><a id=__codelineno-0-93 name=__codelineno-0-93></a>            <span class=n>json_type</span> <span class=o>=</span> <span class=p>[</span><span class=n>t</span><span class=o>.</span><span class=vm>__name__</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>param_type</span><span class=o>.</span><span class=n>__args__</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span>
</span><span id=__span-0-94><a id=__codelineno-0-94 name=__codelineno-0-94></a>
</span><span id=__span-0-95><a id=__codelineno-0-95 name=__codelineno-0-95></a>        <span class=n>json_type</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;int&quot;</span><span class=p>:</span> <span class=s2>&quot;integer&quot;</span><span class=p>,</span> <span class=s2>&quot;float&quot;</span><span class=p>:</span> <span class=s2>&quot;number&quot;</span><span class=p>,</span> <span class=s2>&quot;str&quot;</span><span class=p>:</span> <span class=s2>&quot;string&quot;</span><span class=p>,</span> <span class=s2>&quot;bool&quot;</span><span class=p>:</span> <span class=s2>&quot;boolean&quot;</span><span class=p>}</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
</span><span id=__span-0-96><a id=__codelineno-0-96 name=__codelineno-0-96></a>            <span class=n>json_type</span><span class=p>,</span> <span class=s2>&quot;string&quot;</span>
</span><span id=__span-0-97><a id=__codelineno-0-97 name=__codelineno-0-97></a>        <span class=p>)</span>
</span><span id=__span-0-98><a id=__codelineno-0-98 name=__codelineno-0-98></a>
</span><span id=__span-0-99><a id=__codelineno-0-99 name=__codelineno-0-99></a>        <span class=c1># Add parameter to the definition</span>
</span><span id=__span-0-100><a id=__codelineno-0-100 name=__codelineno-0-100></a>        <span class=n>parameters</span><span class=p>[</span><span class=s2>&quot;properties&quot;</span><span class=p>][</span><span class=n>param_name</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=n>param_description</span><span class=p>,</span> <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=n>json_type</span><span class=p>}</span>
</span><span id=__span-0-101><a id=__codelineno-0-101 name=__codelineno-0-101></a>
</span><span id=__span-0-102><a id=__codelineno-0-102 name=__codelineno-0-102></a>        <span class=c1># Params without default values are required params</span>
</span><span id=__span-0-103><a id=__codelineno-0-103 name=__codelineno-0-103></a>        <span class=k>if</span> <span class=n>param</span><span class=o>.</span><span class=n>default</span> <span class=o>==</span> <span class=n>inspect</span><span class=o>.</span><span class=n>Parameter</span><span class=o>.</span><span class=n>empty</span><span class=p>:</span>
</span><span id=__span-0-104><a id=__codelineno-0-104 name=__codelineno-0-104></a>            <span class=n>parameters</span><span class=p>[</span><span class=s2>&quot;required&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>param_name</span><span class=p>)</span>
</span><span id=__span-0-105><a id=__codelineno-0-105 name=__codelineno-0-105></a>
</span><span id=__span-0-106><a id=__codelineno-0-106 name=__codelineno-0-106></a>    <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-0-107><a id=__codelineno-0-107 name=__codelineno-0-107></a>        <span class=s2>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;function&quot;</span><span class=p>,</span>
</span><span id=__span-0-108><a id=__codelineno-0-108 name=__codelineno-0-108></a>        <span class=s2>&quot;function&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=n>tool</span><span class=o>.</span><span class=vm>__name__</span><span class=p>,</span> <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=n>function_description</span><span class=p>,</span> <span class=s2>&quot;parameters&quot;</span><span class=p>:</span> <span class=n>parameters</span><span class=p>},</span>
</span><span id=__span-0-109><a id=__codelineno-0-109 name=__codelineno-0-109></a>    <span class=p>}</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.agents.tool_registry.ToolRegistry.register_tool class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">register_tool</span> <a href=#nearai.agents.tool_registry.ToolRegistry.register_tool class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>register_tool</span><span class=p>(</span><span class=n>tool</span><span class=p>:</span> <span class=n><span title=typing.Callable>Callable</span></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Register a tool.</p> <details class=quote> <summary>Source code in <code>nearai/agents/tool_registry.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-34>34</a></span>
<span class=normal><a href=#__codelineno-0-35>35</a></span>
<span class=normal><a href=#__codelineno-0-36>36</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-34><a id=__codelineno-0-34 name=__codelineno-0-34></a><span class=k>def</span><span class=w> </span><span class=nf>register_tool</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>tool</span><span class=p>:</span> <span class=n>Callable</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-35><a id=__codelineno-0-35 name=__codelineno-0-35></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Register a tool.&quot;&quot;&quot;</span>
</span><span id=__span-0-36><a id=__codelineno-0-36 name=__codelineno-0-36></a>    <span class=bp>self</span><span class=o>.</span><span class=n>tools</span><span class=p>[</span><span class=n>tool</span><span class=o>.</span><span class=vm>__name__</span><span class=p>]</span> <span class=o>=</span> <span class=n>tool</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> </div> </div> </div> </div> </div> </div> <div class="doc doc-object doc-module"> <h3 id=nearai.cli class="doc doc-heading"> <span class="doc doc-object-name doc-module-name">cli</span> <a href=#nearai.cli class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h4 id=nearai.cli.AgentCli class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">AgentCli</span> <a href=#nearai.cli.AgentCli class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-482>482</a></span>
<span class=normal><a href=#__codelineno-0-483>483</a></span>
<span class=normal><a href=#__codelineno-0-484>484</a></span>
<span class=normal><a href=#__codelineno-0-485>485</a></span>
<span class=normal><a href=#__codelineno-0-486>486</a></span>
<span class=normal><a href=#__codelineno-0-487>487</a></span>
<span class=normal><a href=#__codelineno-0-488>488</a></span>
<span class=normal><a href=#__codelineno-0-489>489</a></span>
<span class=normal><a href=#__codelineno-0-490>490</a></span>
<span class=normal><a href=#__codelineno-0-491>491</a></span>
<span class=normal><a href=#__codelineno-0-492>492</a></span>
<span class=normal><a href=#__codelineno-0-493>493</a></span>
<span class=normal><a href=#__codelineno-0-494>494</a></span>
<span class=normal><a href=#__codelineno-0-495>495</a></span>
<span class=normal><a href=#__codelineno-0-496>496</a></span>
<span class=normal><a href=#__codelineno-0-497>497</a></span>
<span class=normal><a href=#__codelineno-0-498>498</a></span>
<span class=normal><a href=#__codelineno-0-499>499</a></span>
<span class=normal><a href=#__codelineno-0-500>500</a></span>
<span class=normal><a href=#__codelineno-0-501>501</a></span>
<span class=normal><a href=#__codelineno-0-502>502</a></span>
<span class=normal><a href=#__codelineno-0-503>503</a></span>
<span class=normal><a href=#__codelineno-0-504>504</a></span>
<span class=normal><a href=#__codelineno-0-505>505</a></span>
<span class=normal><a href=#__codelineno-0-506>506</a></span>
<span class=normal><a href=#__codelineno-0-507>507</a></span>
<span class=normal><a href=#__codelineno-0-508>508</a></span>
<span class=normal><a href=#__codelineno-0-509>509</a></span>
<span class=normal><a href=#__codelineno-0-510>510</a></span>
<span class=normal><a href=#__codelineno-0-511>511</a></span>
<span class=normal><a href=#__codelineno-0-512>512</a></span>
<span class=normal><a href=#__codelineno-0-513>513</a></span>
<span class=normal><a href=#__codelineno-0-514>514</a></span>
<span class=normal><a href=#__codelineno-0-515>515</a></span>
<span class=normal><a href=#__codelineno-0-516>516</a></span>
<span class=normal><a href=#__codelineno-0-517>517</a></span>
<span class=normal><a href=#__codelineno-0-518>518</a></span>
<span class=normal><a href=#__codelineno-0-519>519</a></span>
<span class=normal><a href=#__codelineno-0-520>520</a></span>
<span class=normal><a href=#__codelineno-0-521>521</a></span>
<span class=normal><a href=#__codelineno-0-522>522</a></span>
<span class=normal><a href=#__codelineno-0-523>523</a></span>
<span class=normal><a href=#__codelineno-0-524>524</a></span>
<span class=normal><a href=#__codelineno-0-525>525</a></span>
<span class=normal><a href=#__codelineno-0-526>526</a></span>
<span class=normal><a href=#__codelineno-0-527>527</a></span>
<span class=normal><a href=#__codelineno-0-528>528</a></span>
<span class=normal><a href=#__codelineno-0-529>529</a></span>
<span class=normal><a href=#__codelineno-0-530>530</a></span>
<span class=normal><a href=#__codelineno-0-531>531</a></span>
<span class=normal><a href=#__codelineno-0-532>532</a></span>
<span class=normal><a href=#__codelineno-0-533>533</a></span>
<span class=normal><a href=#__codelineno-0-534>534</a></span>
<span class=normal><a href=#__codelineno-0-535>535</a></span>
<span class=normal><a href=#__codelineno-0-536>536</a></span>
<span class=normal><a href=#__codelineno-0-537>537</a></span>
<span class=normal><a href=#__codelineno-0-538>538</a></span>
<span class=normal><a href=#__codelineno-0-539>539</a></span>
<span class=normal><a href=#__codelineno-0-540>540</a></span>
<span class=normal><a href=#__codelineno-0-541>541</a></span>
<span class=normal><a href=#__codelineno-0-542>542</a></span>
<span class=normal><a href=#__codelineno-0-543>543</a></span>
<span class=normal><a href=#__codelineno-0-544>544</a></span>
<span class=normal><a href=#__codelineno-0-545>545</a></span>
<span class=normal><a href=#__codelineno-0-546>546</a></span>
<span class=normal><a href=#__codelineno-0-547>547</a></span>
<span class=normal><a href=#__codelineno-0-548>548</a></span>
<span class=normal><a href=#__codelineno-0-549>549</a></span>
<span class=normal><a href=#__codelineno-0-550>550</a></span>
<span class=normal><a href=#__codelineno-0-551>551</a></span>
<span class=normal><a href=#__codelineno-0-552>552</a></span>
<span class=normal><a href=#__codelineno-0-553>553</a></span>
<span class=normal><a href=#__codelineno-0-554>554</a></span>
<span class=normal><a href=#__codelineno-0-555>555</a></span>
<span class=normal><a href=#__codelineno-0-556>556</a></span>
<span class=normal><a href=#__codelineno-0-557>557</a></span>
<span class=normal><a href=#__codelineno-0-558>558</a></span>
<span class=normal><a href=#__codelineno-0-559>559</a></span>
<span class=normal><a href=#__codelineno-0-560>560</a></span>
<span class=normal><a href=#__codelineno-0-561>561</a></span>
<span class=normal><a href=#__codelineno-0-562>562</a></span>
<span class=normal><a href=#__codelineno-0-563>563</a></span>
<span class=normal><a href=#__codelineno-0-564>564</a></span>
<span class=normal><a href=#__codelineno-0-565>565</a></span>
<span class=normal><a href=#__codelineno-0-566>566</a></span>
<span class=normal><a href=#__codelineno-0-567>567</a></span>
<span class=normal><a href=#__codelineno-0-568>568</a></span>
<span class=normal><a href=#__codelineno-0-569>569</a></span>
<span class=normal><a href=#__codelineno-0-570>570</a></span>
<span class=normal><a href=#__codelineno-0-571>571</a></span>
<span class=normal><a href=#__codelineno-0-572>572</a></span>
<span class=normal><a href=#__codelineno-0-573>573</a></span>
<span class=normal><a href=#__codelineno-0-574>574</a></span>
<span class=normal><a href=#__codelineno-0-575>575</a></span>
<span class=normal><a href=#__codelineno-0-576>576</a></span>
<span class=normal><a href=#__codelineno-0-577>577</a></span>
<span class=normal><a href=#__codelineno-0-578>578</a></span>
<span class=normal><a href=#__codelineno-0-579>579</a></span>
<span class=normal><a href=#__codelineno-0-580>580</a></span>
<span class=normal><a href=#__codelineno-0-581>581</a></span>
<span class=normal><a href=#__codelineno-0-582>582</a></span>
<span class=normal><a href=#__codelineno-0-583>583</a></span>
<span class=normal><a href=#__codelineno-0-584>584</a></span>
<span class=normal><a href=#__codelineno-0-585>585</a></span>
<span class=normal><a href=#__codelineno-0-586>586</a></span>
<span class=normal><a href=#__codelineno-0-587>587</a></span>
<span class=normal><a href=#__codelineno-0-588>588</a></span>
<span class=normal><a href=#__codelineno-0-589>589</a></span>
<span class=normal><a href=#__codelineno-0-590>590</a></span>
<span class=normal><a href=#__codelineno-0-591>591</a></span>
<span class=normal><a href=#__codelineno-0-592>592</a></span>
<span class=normal><a href=#__codelineno-0-593>593</a></span>
<span class=normal><a href=#__codelineno-0-594>594</a></span>
<span class=normal><a href=#__codelineno-0-595>595</a></span>
<span class=normal><a href=#__codelineno-0-596>596</a></span>
<span class=normal><a href=#__codelineno-0-597>597</a></span>
<span class=normal><a href=#__codelineno-0-598>598</a></span>
<span class=normal><a href=#__codelineno-0-599>599</a></span>
<span class=normal><a href=#__codelineno-0-600>600</a></span>
<span class=normal><a href=#__codelineno-0-601>601</a></span>
<span class=normal><a href=#__codelineno-0-602>602</a></span>
<span class=normal><a href=#__codelineno-0-603>603</a></span>
<span class=normal><a href=#__codelineno-0-604>604</a></span>
<span class=normal><a href=#__codelineno-0-605>605</a></span>
<span class=normal><a href=#__codelineno-0-606>606</a></span>
<span class=normal><a href=#__codelineno-0-607>607</a></span>
<span class=normal><a href=#__codelineno-0-608>608</a></span>
<span class=normal><a href=#__codelineno-0-609>609</a></span>
<span class=normal><a href=#__codelineno-0-610>610</a></span>
<span class=normal><a href=#__codelineno-0-611>611</a></span>
<span class=normal><a href=#__codelineno-0-612>612</a></span>
<span class=normal><a href=#__codelineno-0-613>613</a></span>
<span class=normal><a href=#__codelineno-0-614>614</a></span>
<span class=normal><a href=#__codelineno-0-615>615</a></span>
<span class=normal><a href=#__codelineno-0-616>616</a></span>
<span class=normal><a href=#__codelineno-0-617>617</a></span>
<span class=normal><a href=#__codelineno-0-618>618</a></span>
<span class=normal><a href=#__codelineno-0-619>619</a></span>
<span class=normal><a href=#__codelineno-0-620>620</a></span>
<span class=normal><a href=#__codelineno-0-621>621</a></span>
<span class=normal><a href=#__codelineno-0-622>622</a></span>
<span class=normal><a href=#__codelineno-0-623>623</a></span>
<span class=normal><a href=#__codelineno-0-624>624</a></span>
<span class=normal><a href=#__codelineno-0-625>625</a></span>
<span class=normal><a href=#__codelineno-0-626>626</a></span>
<span class=normal><a href=#__codelineno-0-627>627</a></span>
<span class=normal><a href=#__codelineno-0-628>628</a></span>
<span class=normal><a href=#__codelineno-0-629>629</a></span>
<span class=normal><a href=#__codelineno-0-630>630</a></span>
<span class=normal><a href=#__codelineno-0-631>631</a></span>
<span class=normal><a href=#__codelineno-0-632>632</a></span>
<span class=normal><a href=#__codelineno-0-633>633</a></span>
<span class=normal><a href=#__codelineno-0-634>634</a></span>
<span class=normal><a href=#__codelineno-0-635>635</a></span>
<span class=normal><a href=#__codelineno-0-636>636</a></span>
<span class=normal><a href=#__codelineno-0-637>637</a></span>
<span class=normal><a href=#__codelineno-0-638>638</a></span>
<span class=normal><a href=#__codelineno-0-639>639</a></span>
<span class=normal><a href=#__codelineno-0-640>640</a></span>
<span class=normal><a href=#__codelineno-0-641>641</a></span>
<span class=normal><a href=#__codelineno-0-642>642</a></span>
<span class=normal><a href=#__codelineno-0-643>643</a></span>
<span class=normal><a href=#__codelineno-0-644>644</a></span>
<span class=normal><a href=#__codelineno-0-645>645</a></span>
<span class=normal><a href=#__codelineno-0-646>646</a></span>
<span class=normal><a href=#__codelineno-0-647>647</a></span>
<span class=normal><a href=#__codelineno-0-648>648</a></span>
<span class=normal><a href=#__codelineno-0-649>649</a></span>
<span class=normal><a href=#__codelineno-0-650>650</a></span>
<span class=normal><a href=#__codelineno-0-651>651</a></span>
<span class=normal><a href=#__codelineno-0-652>652</a></span>
<span class=normal><a href=#__codelineno-0-653>653</a></span>
<span class=normal><a href=#__codelineno-0-654>654</a></span>
<span class=normal><a href=#__codelineno-0-655>655</a></span>
<span class=normal><a href=#__codelineno-0-656>656</a></span>
<span class=normal><a href=#__codelineno-0-657>657</a></span>
<span class=normal><a href=#__codelineno-0-658>658</a></span>
<span class=normal><a href=#__codelineno-0-659>659</a></span>
<span class=normal><a href=#__codelineno-0-660>660</a></span>
<span class=normal><a href=#__codelineno-0-661>661</a></span>
<span class=normal><a href=#__codelineno-0-662>662</a></span>
<span class=normal><a href=#__codelineno-0-663>663</a></span>
<span class=normal><a href=#__codelineno-0-664>664</a></span>
<span class=normal><a href=#__codelineno-0-665>665</a></span>
<span class=normal><a href=#__codelineno-0-666>666</a></span>
<span class=normal><a href=#__codelineno-0-667>667</a></span>
<span class=normal><a href=#__codelineno-0-668>668</a></span>
<span class=normal><a href=#__codelineno-0-669>669</a></span>
<span class=normal><a href=#__codelineno-0-670>670</a></span>
<span class=normal><a href=#__codelineno-0-671>671</a></span>
<span class=normal><a href=#__codelineno-0-672>672</a></span>
<span class=normal><a href=#__codelineno-0-673>673</a></span>
<span class=normal><a href=#__codelineno-0-674>674</a></span>
<span class=normal><a href=#__codelineno-0-675>675</a></span>
<span class=normal><a href=#__codelineno-0-676>676</a></span>
<span class=normal><a href=#__codelineno-0-677>677</a></span>
<span class=normal><a href=#__codelineno-0-678>678</a></span>
<span class=normal><a href=#__codelineno-0-679>679</a></span>
<span class=normal><a href=#__codelineno-0-680>680</a></span>
<span class=normal><a href=#__codelineno-0-681>681</a></span>
<span class=normal><a href=#__codelineno-0-682>682</a></span>
<span class=normal><a href=#__codelineno-0-683>683</a></span>
<span class=normal><a href=#__codelineno-0-684>684</a></span>
<span class=normal><a href=#__codelineno-0-685>685</a></span>
<span class=normal><a href=#__codelineno-0-686>686</a></span>
<span class=normal><a href=#__codelineno-0-687>687</a></span>
<span class=normal><a href=#__codelineno-0-688>688</a></span>
<span class=normal><a href=#__codelineno-0-689>689</a></span>
<span class=normal><a href=#__codelineno-0-690>690</a></span>
<span class=normal><a href=#__codelineno-0-691>691</a></span>
<span class=normal><a href=#__codelineno-0-692>692</a></span>
<span class=normal><a href=#__codelineno-0-693>693</a></span>
<span class=normal><a href=#__codelineno-0-694>694</a></span>
<span class=normal><a href=#__codelineno-0-695>695</a></span>
<span class=normal><a href=#__codelineno-0-696>696</a></span>
<span class=normal><a href=#__codelineno-0-697>697</a></span>
<span class=normal><a href=#__codelineno-0-698>698</a></span>
<span class=normal><a href=#__codelineno-0-699>699</a></span>
<span class=normal><a href=#__codelineno-0-700>700</a></span>
<span class=normal><a href=#__codelineno-0-701>701</a></span>
<span class=normal><a href=#__codelineno-0-702>702</a></span>
<span class=normal><a href=#__codelineno-0-703>703</a></span>
<span class=normal><a href=#__codelineno-0-704>704</a></span>
<span class=normal><a href=#__codelineno-0-705>705</a></span>
<span class=normal><a href=#__codelineno-0-706>706</a></span>
<span class=normal><a href=#__codelineno-0-707>707</a></span>
<span class=normal><a href=#__codelineno-0-708>708</a></span>
<span class=normal><a href=#__codelineno-0-709>709</a></span>
<span class=normal><a href=#__codelineno-0-710>710</a></span>
<span class=normal><a href=#__codelineno-0-711>711</a></span>
<span class=normal><a href=#__codelineno-0-712>712</a></span>
<span class=normal><a href=#__codelineno-0-713>713</a></span>
<span class=normal><a href=#__codelineno-0-714>714</a></span>
<span class=normal><a href=#__codelineno-0-715>715</a></span>
<span class=normal><a href=#__codelineno-0-716>716</a></span>
<span class=normal><a href=#__codelineno-0-717>717</a></span>
<span class=normal><a href=#__codelineno-0-718>718</a></span>
<span class=normal><a href=#__codelineno-0-719>719</a></span>
<span class=normal><a href=#__codelineno-0-720>720</a></span>
<span class=normal><a href=#__codelineno-0-721>721</a></span>
<span class=normal><a href=#__codelineno-0-722>722</a></span>
<span class=normal><a href=#__codelineno-0-723>723</a></span>
<span class=normal><a href=#__codelineno-0-724>724</a></span>
<span class=normal><a href=#__codelineno-0-725>725</a></span>
<span class=normal><a href=#__codelineno-0-726>726</a></span>
<span class=normal><a href=#__codelineno-0-727>727</a></span>
<span class=normal><a href=#__codelineno-0-728>728</a></span>
<span class=normal><a href=#__codelineno-0-729>729</a></span>
<span class=normal><a href=#__codelineno-0-730>730</a></span>
<span class=normal><a href=#__codelineno-0-731>731</a></span>
<span class=normal><a href=#__codelineno-0-732>732</a></span>
<span class=normal><a href=#__codelineno-0-733>733</a></span>
<span class=normal><a href=#__codelineno-0-734>734</a></span>
<span class=normal><a href=#__codelineno-0-735>735</a></span>
<span class=normal><a href=#__codelineno-0-736>736</a></span>
<span class=normal><a href=#__codelineno-0-737>737</a></span>
<span class=normal><a href=#__codelineno-0-738>738</a></span>
<span class=normal><a href=#__codelineno-0-739>739</a></span>
<span class=normal><a href=#__codelineno-0-740>740</a></span>
<span class=normal><a href=#__codelineno-0-741>741</a></span>
<span class=normal><a href=#__codelineno-0-742>742</a></span>
<span class=normal><a href=#__codelineno-0-743>743</a></span>
<span class=normal><a href=#__codelineno-0-744>744</a></span>
<span class=normal><a href=#__codelineno-0-745>745</a></span>
<span class=normal><a href=#__codelineno-0-746>746</a></span>
<span class=normal><a href=#__codelineno-0-747>747</a></span>
<span class=normal><a href=#__codelineno-0-748>748</a></span>
<span class=normal><a href=#__codelineno-0-749>749</a></span>
<span class=normal><a href=#__codelineno-0-750>750</a></span>
<span class=normal><a href=#__codelineno-0-751>751</a></span>
<span class=normal><a href=#__codelineno-0-752>752</a></span>
<span class=normal><a href=#__codelineno-0-753>753</a></span>
<span class=normal><a href=#__codelineno-0-754>754</a></span>
<span class=normal><a href=#__codelineno-0-755>755</a></span>
<span class=normal><a href=#__codelineno-0-756>756</a></span>
<span class=normal><a href=#__codelineno-0-757>757</a></span>
<span class=normal><a href=#__codelineno-0-758>758</a></span>
<span class=normal><a href=#__codelineno-0-759>759</a></span>
<span class=normal><a href=#__codelineno-0-760>760</a></span>
<span class=normal><a href=#__codelineno-0-761>761</a></span>
<span class=normal><a href=#__codelineno-0-762>762</a></span>
<span class=normal><a href=#__codelineno-0-763>763</a></span>
<span class=normal><a href=#__codelineno-0-764>764</a></span>
<span class=normal><a href=#__codelineno-0-765>765</a></span>
<span class=normal><a href=#__codelineno-0-766>766</a></span>
<span class=normal><a href=#__codelineno-0-767>767</a></span>
<span class=normal><a href=#__codelineno-0-768>768</a></span>
<span class=normal><a href=#__codelineno-0-769>769</a></span>
<span class=normal><a href=#__codelineno-0-770>770</a></span>
<span class=normal><a href=#__codelineno-0-771>771</a></span>
<span class=normal><a href=#__codelineno-0-772>772</a></span>
<span class=normal><a href=#__codelineno-0-773>773</a></span>
<span class=normal><a href=#__codelineno-0-774>774</a></span>
<span class=normal><a href=#__codelineno-0-775>775</a></span>
<span class=normal><a href=#__codelineno-0-776>776</a></span>
<span class=normal><a href=#__codelineno-0-777>777</a></span>
<span class=normal><a href=#__codelineno-0-778>778</a></span>
<span class=normal><a href=#__codelineno-0-779>779</a></span>
<span class=normal><a href=#__codelineno-0-780>780</a></span>
<span class=normal><a href=#__codelineno-0-781>781</a></span>
<span class=normal><a href=#__codelineno-0-782>782</a></span>
<span class=normal><a href=#__codelineno-0-783>783</a></span>
<span class=normal><a href=#__codelineno-0-784>784</a></span>
<span class=normal><a href=#__codelineno-0-785>785</a></span>
<span class=normal><a href=#__codelineno-0-786>786</a></span>
<span class=normal><a href=#__codelineno-0-787>787</a></span>
<span class=normal><a href=#__codelineno-0-788>788</a></span>
<span class=normal><a href=#__codelineno-0-789>789</a></span>
<span class=normal><a href=#__codelineno-0-790>790</a></span>
<span class=normal><a href=#__codelineno-0-791>791</a></span>
<span class=normal><a href=#__codelineno-0-792>792</a></span>
<span class=normal><a href=#__codelineno-0-793>793</a></span>
<span class=normal><a href=#__codelineno-0-794>794</a></span>
<span class=normal><a href=#__codelineno-0-795>795</a></span>
<span class=normal><a href=#__codelineno-0-796>796</a></span>
<span class=normal><a href=#__codelineno-0-797>797</a></span>
<span class=normal><a href=#__codelineno-0-798>798</a></span>
<span class=normal><a href=#__codelineno-0-799>799</a></span>
<span class=normal><a href=#__codelineno-0-800>800</a></span>
<span class=normal><a href=#__codelineno-0-801>801</a></span>
<span class=normal><a href=#__codelineno-0-802>802</a></span>
<span class=normal><a href=#__codelineno-0-803>803</a></span>
<span class=normal><a href=#__codelineno-0-804>804</a></span>
<span class=normal><a href=#__codelineno-0-805>805</a></span>
<span class=normal><a href=#__codelineno-0-806>806</a></span>
<span class=normal><a href=#__codelineno-0-807>807</a></span>
<span class=normal><a href=#__codelineno-0-808>808</a></span>
<span class=normal><a href=#__codelineno-0-809>809</a></span>
<span class=normal><a href=#__codelineno-0-810>810</a></span>
<span class=normal><a href=#__codelineno-0-811>811</a></span>
<span class=normal><a href=#__codelineno-0-812>812</a></span>
<span class=normal><a href=#__codelineno-0-813>813</a></span>
<span class=normal><a href=#__codelineno-0-814>814</a></span>
<span class=normal><a href=#__codelineno-0-815>815</a></span>
<span class=normal><a href=#__codelineno-0-816>816</a></span>
<span class=normal><a href=#__codelineno-0-817>817</a></span>
<span class=normal><a href=#__codelineno-0-818>818</a></span>
<span class=normal><a href=#__codelineno-0-819>819</a></span>
<span class=normal><a href=#__codelineno-0-820>820</a></span>
<span class=normal><a href=#__codelineno-0-821>821</a></span>
<span class=normal><a href=#__codelineno-0-822>822</a></span>
<span class=normal><a href=#__codelineno-0-823>823</a></span>
<span class=normal><a href=#__codelineno-0-824>824</a></span>
<span class=normal><a href=#__codelineno-0-825>825</a></span>
<span class=normal><a href=#__codelineno-0-826>826</a></span>
<span class=normal><a href=#__codelineno-0-827>827</a></span>
<span class=normal><a href=#__codelineno-0-828>828</a></span>
<span class=normal><a href=#__codelineno-0-829>829</a></span>
<span class=normal><a href=#__codelineno-0-830>830</a></span>
<span class=normal><a href=#__codelineno-0-831>831</a></span>
<span class=normal><a href=#__codelineno-0-832>832</a></span>
<span class=normal><a href=#__codelineno-0-833>833</a></span>
<span class=normal><a href=#__codelineno-0-834>834</a></span>
<span class=normal><a href=#__codelineno-0-835>835</a></span>
<span class=normal><a href=#__codelineno-0-836>836</a></span>
<span class=normal><a href=#__codelineno-0-837>837</a></span>
<span class=normal><a href=#__codelineno-0-838>838</a></span>
<span class=normal><a href=#__codelineno-0-839>839</a></span>
<span class=normal><a href=#__codelineno-0-840>840</a></span>
<span class=normal><a href=#__codelineno-0-841>841</a></span>
<span class=normal><a href=#__codelineno-0-842>842</a></span>
<span class=normal><a href=#__codelineno-0-843>843</a></span>
<span class=normal><a href=#__codelineno-0-844>844</a></span>
<span class=normal><a href=#__codelineno-0-845>845</a></span>
<span class=normal><a href=#__codelineno-0-846>846</a></span>
<span class=normal><a href=#__codelineno-0-847>847</a></span>
<span class=normal><a href=#__codelineno-0-848>848</a></span>
<span class=normal><a href=#__codelineno-0-849>849</a></span>
<span class=normal><a href=#__codelineno-0-850>850</a></span>
<span class=normal><a href=#__codelineno-0-851>851</a></span>
<span class=normal><a href=#__codelineno-0-852>852</a></span>
<span class=normal><a href=#__codelineno-0-853>853</a></span>
<span class=normal><a href=#__codelineno-0-854>854</a></span>
<span class=normal><a href=#__codelineno-0-855>855</a></span>
<span class=normal><a href=#__codelineno-0-856>856</a></span>
<span class=normal><a href=#__codelineno-0-857>857</a></span>
<span class=normal><a href=#__codelineno-0-858>858</a></span>
<span class=normal><a href=#__codelineno-0-859>859</a></span>
<span class=normal><a href=#__codelineno-0-860>860</a></span>
<span class=normal><a href=#__codelineno-0-861>861</a></span>
<span class=normal><a href=#__codelineno-0-862>862</a></span>
<span class=normal><a href=#__codelineno-0-863>863</a></span>
<span class=normal><a href=#__codelineno-0-864>864</a></span>
<span class=normal><a href=#__codelineno-0-865>865</a></span>
<span class=normal><a href=#__codelineno-0-866>866</a></span>
<span class=normal><a href=#__codelineno-0-867>867</a></span>
<span class=normal><a href=#__codelineno-0-868>868</a></span>
<span class=normal><a href=#__codelineno-0-869>869</a></span>
<span class=normal><a href=#__codelineno-0-870>870</a></span>
<span class=normal><a href=#__codelineno-0-871>871</a></span>
<span class=normal><a href=#__codelineno-0-872>872</a></span>
<span class=normal><a href=#__codelineno-0-873>873</a></span>
<span class=normal><a href=#__codelineno-0-874>874</a></span>
<span class=normal><a href=#__codelineno-0-875>875</a></span>
<span class=normal><a href=#__codelineno-0-876>876</a></span>
<span class=normal><a href=#__codelineno-0-877>877</a></span>
<span class=normal><a href=#__codelineno-0-878>878</a></span>
<span class=normal><a href=#__codelineno-0-879>879</a></span>
<span class=normal><a href=#__codelineno-0-880>880</a></span>
<span class=normal><a href=#__codelineno-0-881>881</a></span>
<span class=normal><a href=#__codelineno-0-882>882</a></span>
<span class=normal><a href=#__codelineno-0-883>883</a></span>
<span class=normal><a href=#__codelineno-0-884>884</a></span>
<span class=normal><a href=#__codelineno-0-885>885</a></span>
<span class=normal><a href=#__codelineno-0-886>886</a></span>
<span class=normal><a href=#__codelineno-0-887>887</a></span>
<span class=normal><a href=#__codelineno-0-888>888</a></span>
<span class=normal><a href=#__codelineno-0-889>889</a></span>
<span class=normal><a href=#__codelineno-0-890>890</a></span>
<span class=normal><a href=#__codelineno-0-891>891</a></span>
<span class=normal><a href=#__codelineno-0-892>892</a></span>
<span class=normal><a href=#__codelineno-0-893>893</a></span>
<span class=normal><a href=#__codelineno-0-894>894</a></span>
<span class=normal><a href=#__codelineno-0-895>895</a></span>
<span class=normal><a href=#__codelineno-0-896>896</a></span>
<span class=normal><a href=#__codelineno-0-897>897</a></span>
<span class=normal><a href=#__codelineno-0-898>898</a></span>
<span class=normal><a href=#__codelineno-0-899>899</a></span>
<span class=normal><a href=#__codelineno-0-900>900</a></span>
<span class=normal><a href=#__codelineno-0-901>901</a></span>
<span class=normal><a href=#__codelineno-0-902>902</a></span>
<span class=normal><a href=#__codelineno-0-903>903</a></span>
<span class=normal><a href=#__codelineno-0-904>904</a></span>
<span class=normal><a href=#__codelineno-0-905>905</a></span>
<span class=normal><a href=#__codelineno-0-906>906</a></span>
<span class=normal><a href=#__codelineno-0-907>907</a></span>
<span class=normal><a href=#__codelineno-0-908>908</a></span>
<span class=normal><a href=#__codelineno-0-909>909</a></span>
<span class=normal><a href=#__codelineno-0-910>910</a></span>
<span class=normal><a href=#__codelineno-0-911>911</a></span>
<span class=normal><a href=#__codelineno-0-912>912</a></span>
<span class=normal><a href=#__codelineno-0-913>913</a></span>
<span class=normal><a href=#__codelineno-0-914>914</a></span>
<span class=normal><a href=#__codelineno-0-915>915</a></span>
<span class=normal><a href=#__codelineno-0-916>916</a></span>
<span class=normal><a href=#__codelineno-0-917>917</a></span>
<span class=normal><a href=#__codelineno-0-918>918</a></span>
<span class=normal><a href=#__codelineno-0-919>919</a></span>
<span class=normal><a href=#__codelineno-0-920>920</a></span>
<span class=normal><a href=#__codelineno-0-921>921</a></span>
<span class=normal><a href=#__codelineno-0-922>922</a></span>
<span class=normal><a href=#__codelineno-0-923>923</a></span>
<span class=normal><a href=#__codelineno-0-924>924</a></span>
<span class=normal><a href=#__codelineno-0-925>925</a></span>
<span class=normal><a href=#__codelineno-0-926>926</a></span>
<span class=normal><a href=#__codelineno-0-927>927</a></span>
<span class=normal><a href=#__codelineno-0-928>928</a></span>
<span class=normal><a href=#__codelineno-0-929>929</a></span>
<span class=normal><a href=#__codelineno-0-930>930</a></span>
<span class=normal><a href=#__codelineno-0-931>931</a></span>
<span class=normal><a href=#__codelineno-0-932>932</a></span>
<span class=normal><a href=#__codelineno-0-933>933</a></span>
<span class=normal><a href=#__codelineno-0-934>934</a></span>
<span class=normal><a href=#__codelineno-0-935>935</a></span>
<span class=normal><a href=#__codelineno-0-936>936</a></span>
<span class=normal><a href=#__codelineno-0-937>937</a></span>
<span class=normal><a href=#__codelineno-0-938>938</a></span>
<span class=normal><a href=#__codelineno-0-939>939</a></span>
<span class=normal><a href=#__codelineno-0-940>940</a></span>
<span class=normal><a href=#__codelineno-0-941>941</a></span>
<span class=normal><a href=#__codelineno-0-942>942</a></span>
<span class=normal><a href=#__codelineno-0-943>943</a></span>
<span class=normal><a href=#__codelineno-0-944>944</a></span>
<span class=normal><a href=#__codelineno-0-945>945</a></span>
<span class=normal><a href=#__codelineno-0-946>946</a></span>
<span class=normal><a href=#__codelineno-0-947>947</a></span>
<span class=normal><a href=#__codelineno-0-948>948</a></span>
<span class=normal><a href=#__codelineno-0-949>949</a></span>
<span class=normal><a href=#__codelineno-0-950>950</a></span>
<span class=normal><a href=#__codelineno-0-951>951</a></span>
<span class=normal><a href=#__codelineno-0-952>952</a></span>
<span class=normal><a href=#__codelineno-0-953>953</a></span>
<span class=normal><a href=#__codelineno-0-954>954</a></span>
<span class=normal><a href=#__codelineno-0-955>955</a></span>
<span class=normal><a href=#__codelineno-0-956>956</a></span>
<span class=normal><a href=#__codelineno-0-957>957</a></span>
<span class=normal><a href=#__codelineno-0-958>958</a></span>
<span class=normal><a href=#__codelineno-0-959>959</a></span>
<span class=normal><a href=#__codelineno-0-960>960</a></span>
<span class=normal><a href=#__codelineno-0-961>961</a></span>
<span class=normal><a href=#__codelineno-0-962>962</a></span>
<span class=normal><a href=#__codelineno-0-963>963</a></span>
<span class=normal><a href=#__codelineno-0-964>964</a></span>
<span class=normal><a href=#__codelineno-0-965>965</a></span>
<span class=normal><a href=#__codelineno-0-966>966</a></span>
<span class=normal><a href=#__codelineno-0-967>967</a></span>
<span class=normal><a href=#__codelineno-0-968>968</a></span>
<span class=normal><a href=#__codelineno-0-969>969</a></span>
<span class=normal><a href=#__codelineno-0-970>970</a></span>
<span class=normal><a href=#__codelineno-0-971>971</a></span>
<span class=normal><a href=#__codelineno-0-972>972</a></span>
<span class=normal><a href=#__codelineno-0-973>973</a></span>
<span class=normal><a href=#__codelineno-0-974>974</a></span>
<span class=normal><a href=#__codelineno-0-975>975</a></span>
<span class=normal><a href=#__codelineno-0-976>976</a></span>
<span class=normal><a href=#__codelineno-0-977>977</a></span>
<span class=normal><a href=#__codelineno-0-978>978</a></span>
<span class=normal><a href=#__codelineno-0-979>979</a></span>
<span class=normal><a href=#__codelineno-0-980>980</a></span>
<span class=normal><a href=#__codelineno-0-981>981</a></span>
<span class=normal><a href=#__codelineno-0-982>982</a></span>
<span class=normal><a href=#__codelineno-0-983>983</a></span>
<span class=normal><a href=#__codelineno-0-984>984</a></span>
<span class=normal><a href=#__codelineno-0-985>985</a></span>
<span class=normal><a href=#__codelineno-0-986>986</a></span>
<span class=normal><a href=#__codelineno-0-987>987</a></span>
<span class=normal><a href=#__codelineno-0-988>988</a></span>
<span class=normal><a href=#__codelineno-0-989>989</a></span>
<span class=normal><a href=#__codelineno-0-990>990</a></span>
<span class=normal><a href=#__codelineno-0-991>991</a></span>
<span class=normal><a href=#__codelineno-0-992>992</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-482><a id=__codelineno-0-482 name=__codelineno-0-482></a><span class=k>class</span><span class=w> </span><span class=nc>AgentCli</span><span class=p>:</span>
</span><span id=__span-0-483><a id=__codelineno-0-483 name=__codelineno-0-483></a>    <span class=k>def</span><span class=w> </span><span class=nf>dev</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span>
</span><span id=__span-0-484><a id=__codelineno-0-484 name=__codelineno-0-484></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Run local UI for development of agents that have their own UI.&quot;&quot;&quot;</span>
</span><span id=__span-0-485><a id=__codelineno-0-485 name=__codelineno-0-485></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=s2>&quot;hub/demo/.env&quot;</span><span class=p>):</span>
</span><span id=__span-0-486><a id=__codelineno-0-486 name=__codelineno-0-486></a>            <span class=n>shutil</span><span class=o>.</span><span class=n>copy</span><span class=p>(</span><span class=s2>&quot;hub/demo/.env.example&quot;</span><span class=p>,</span> <span class=s2>&quot;hub/demo/.env&quot;</span><span class=p>)</span>
</span><span id=__span-0-487><a id=__codelineno-0-487 name=__codelineno-0-487></a>
</span><span id=__span-0-488><a id=__codelineno-0-488 name=__codelineno-0-488></a>        <span class=n>ret_val</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>system</span><span class=p>(</span><span class=s2>&quot;npm install --prefix hub/demo&quot;</span><span class=p>)</span>
</span><span id=__span-0-489><a id=__codelineno-0-489 name=__codelineno-0-489></a>        <span class=k>if</span> <span class=n>ret_val</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
</span><span id=__span-0-490><a id=__codelineno-0-490 name=__codelineno-0-490></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Node.js is required to run the development server.&quot;</span><span class=p>)</span>
</span><span id=__span-0-491><a id=__codelineno-0-491 name=__codelineno-0-491></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Please install Node.js from https://nodejs.org/&quot;</span><span class=p>)</span>
</span><span id=__span-0-492><a id=__codelineno-0-492 name=__codelineno-0-492></a>        <span class=n>ret_val</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>system</span><span class=p>(</span><span class=s2>&quot;npm run dev --prefix hub/demo&quot;</span><span class=p>)</span>
</span><span id=__span-0-493><a id=__codelineno-0-493 name=__codelineno-0-493></a>        <span class=k>return</span> <span class=n>ret_val</span>
</span><span id=__span-0-494><a id=__codelineno-0-494 name=__codelineno-0-494></a>
</span><span id=__span-0-495><a id=__codelineno-0-495 name=__codelineno-0-495></a>    <span class=k>def</span><span class=w> </span><span class=nf>inspect</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-496><a id=__codelineno-0-496 name=__codelineno-0-496></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Inspect environment from given path.&quot;&quot;&quot;</span>
</span><span id=__span-0-497><a id=__codelineno-0-497 name=__codelineno-0-497></a>        <span class=kn>import</span><span class=w> </span><span class=nn>subprocess</span>
</span><span id=__span-0-498><a id=__codelineno-0-498 name=__codelineno-0-498></a>
</span><span id=__span-0-499><a id=__codelineno-0-499 name=__codelineno-0-499></a>        <span class=n>filename</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>abspath</span><span class=p>(</span><span class=vm>__file__</span><span class=p>))</span><span class=o>.</span><span class=n>parent</span> <span class=o>/</span> <span class=s2>&quot;streamlit_inspect.py&quot;</span>
</span><span id=__span-0-500><a id=__codelineno-0-500 name=__codelineno-0-500></a>        <span class=n>subprocess</span><span class=o>.</span><span class=n>call</span><span class=p>([</span><span class=s2>&quot;streamlit&quot;</span><span class=p>,</span> <span class=s2>&quot;run&quot;</span><span class=p>,</span> <span class=n>filename</span><span class=p>,</span> <span class=s2>&quot;--&quot;</span><span class=p>,</span> <span class=n>path</span><span class=p>])</span>
</span><span id=__span-0-501><a id=__codelineno-0-501 name=__codelineno-0-501></a>
</span><span id=__span-0-502><a id=__codelineno-0-502 name=__codelineno-0-502></a>    <span class=k>def</span><span class=w> </span><span class=nf>interactive</span><span class=p>(</span>
</span><span id=__span-0-503><a id=__codelineno-0-503 name=__codelineno-0-503></a>        <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-504><a id=__codelineno-0-504 name=__codelineno-0-504></a>        <span class=n>agent</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-505><a id=__codelineno-0-505 name=__codelineno-0-505></a>        <span class=n>thread_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-506><a id=__codelineno-0-506 name=__codelineno-0-506></a>        <span class=n>tool_resources</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-507><a id=__codelineno-0-507 name=__codelineno-0-507></a>        <span class=n>local</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-508><a id=__codelineno-0-508 name=__codelineno-0-508></a>        <span class=n>verbose</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-509><a id=__codelineno-0-509 name=__codelineno-0-509></a>        <span class=n>env_vars</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-510><a id=__codelineno-0-510 name=__codelineno-0-510></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-511><a id=__codelineno-0-511 name=__codelineno-0-511></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Runs agent interactively.</span>
</span><span id=__span-0-512><a id=__codelineno-0-512 name=__codelineno-0-512></a>
</span><span id=__span-0-513><a id=__codelineno-0-513 name=__codelineno-0-513></a><span class=sd>        Args:</span>
</span><span id=__span-0-514><a id=__codelineno-0-514 name=__codelineno-0-514></a><span class=sd>        ----</span>
</span><span id=__span-0-515><a id=__codelineno-0-515 name=__codelineno-0-515></a><span class=sd>            agent: Optional path to the agent directory. If not provided, will show agent selection menu</span>
</span><span id=__span-0-516><a id=__codelineno-0-516 name=__codelineno-0-516></a><span class=sd>            thread_id: Optional thread ID to continue an existing conversation</span>
</span><span id=__span-0-517><a id=__codelineno-0-517 name=__codelineno-0-517></a><span class=sd>            tool_resources: Optional tool resources to pass to the agent</span>
</span><span id=__span-0-518><a id=__codelineno-0-518 name=__codelineno-0-518></a><span class=sd>            local: Whether to run the agent locally (default: False)</span>
</span><span id=__span-0-519><a id=__codelineno-0-519 name=__codelineno-0-519></a><span class=sd>            verbose: Whether to show detailed debug information during execution</span>
</span><span id=__span-0-520><a id=__codelineno-0-520 name=__codelineno-0-520></a><span class=sd>            env_vars: Optional environment variables to pass to the agent</span>
</span><span id=__span-0-521><a id=__codelineno-0-521 name=__codelineno-0-521></a>
</span><span id=__span-0-522><a id=__codelineno-0-522 name=__codelineno-0-522></a><span class=sd>        &quot;&quot;&quot;</span>
</span><span id=__span-0-523><a id=__codelineno-0-523 name=__codelineno-0-523></a>        <span class=n>assert_user_auth</span><span class=p>()</span>
</span><span id=__span-0-524><a id=__codelineno-0-524 name=__codelineno-0-524></a>
</span><span id=__span-0-525><a id=__codelineno-0-525 name=__codelineno-0-525></a>        <span class=k>if</span> <span class=n>agent</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-526><a id=__codelineno-0-526 name=__codelineno-0-526></a>            <span class=c1># List available agents in the registry folder</span>
</span><span id=__span-0-527><a id=__codelineno-0-527 name=__codelineno-0-527></a>            <span class=n>registry_path</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=n>get_registry_folder</span><span class=p>())</span>
</span><span id=__span-0-528><a id=__codelineno-0-528 name=__codelineno-0-528></a>            <span class=k>if</span> <span class=ow>not</span> <span class=n>registry_path</span><span class=o>.</span><span class=n>exists</span><span class=p>():</span>
</span><span id=__span-0-529><a id=__codelineno-0-529 name=__codelineno-0-529></a>                <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Error: Registry folder not found. Please create an agent first.&quot;</span><span class=p>)</span>
</span><span id=__span-0-530><a id=__codelineno-0-530 name=__codelineno-0-530></a>                <span class=k>return</span>
</span><span id=__span-0-531><a id=__codelineno-0-531 name=__codelineno-0-531></a>
</span><span id=__span-0-532><a id=__codelineno-0-532 name=__codelineno-0-532></a>            <span class=n>agents</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-0-533><a id=__codelineno-0-533 name=__codelineno-0-533></a>            <span class=c1># Walk through registry to find agents</span>
</span><span id=__span-0-534><a id=__codelineno-0-534 name=__codelineno-0-534></a>            <span class=k>for</span> <span class=n>namespace</span> <span class=ow>in</span> <span class=n>registry_path</span><span class=o>.</span><span class=n>iterdir</span><span class=p>():</span>
</span><span id=__span-0-535><a id=__codelineno-0-535 name=__codelineno-0-535></a>                <span class=k>if</span> <span class=n>namespace</span><span class=o>.</span><span class=n>is_dir</span><span class=p>():</span>
</span><span id=__span-0-536><a id=__codelineno-0-536 name=__codelineno-0-536></a>                    <span class=k>for</span> <span class=n>agent_name</span> <span class=ow>in</span> <span class=n>namespace</span><span class=o>.</span><span class=n>iterdir</span><span class=p>():</span>
</span><span id=__span-0-537><a id=__codelineno-0-537 name=__codelineno-0-537></a>                        <span class=k>if</span> <span class=n>agent_name</span><span class=o>.</span><span class=n>is_dir</span><span class=p>():</span>
</span><span id=__span-0-538><a id=__codelineno-0-538 name=__codelineno-0-538></a>                            <span class=k>for</span> <span class=n>version</span> <span class=ow>in</span> <span class=n>agent_name</span><span class=o>.</span><span class=n>iterdir</span><span class=p>():</span>
</span><span id=__span-0-539><a id=__codelineno-0-539 name=__codelineno-0-539></a>                                <span class=k>if</span> <span class=n>version</span><span class=o>.</span><span class=n>is_dir</span><span class=p>():</span>
</span><span id=__span-0-540><a id=__codelineno-0-540 name=__codelineno-0-540></a>                                    <span class=n>agents</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>version</span><span class=p>)</span>
</span><span id=__span-0-541><a id=__codelineno-0-541 name=__codelineno-0-541></a>
</span><span id=__span-0-542><a id=__codelineno-0-542 name=__codelineno-0-542></a>            <span class=k>if</span> <span class=ow>not</span> <span class=n>agents</span><span class=p>:</span>
</span><span id=__span-0-543><a id=__codelineno-0-543 name=__codelineno-0-543></a>                <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;No agents found. Please create an agent first with &#39;nearai agent create&#39;&quot;</span><span class=p>)</span>
</span><span id=__span-0-544><a id=__codelineno-0-544 name=__codelineno-0-544></a>                <span class=k>return</span>
</span><span id=__span-0-545><a id=__codelineno-0-545 name=__codelineno-0-545></a>
</span><span id=__span-0-546><a id=__codelineno-0-546 name=__codelineno-0-546></a>            <span class=c1># Sort agents by namespace then name</span>
</span><span id=__span-0-547><a id=__codelineno-0-547 name=__codelineno-0-547></a>            <span class=n>agents</span> <span class=o>=</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>agents</span><span class=p>,</span> <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=p>(</span><span class=n>x</span><span class=o>.</span><span class=n>parts</span><span class=p>[</span><span class=o>-</span><span class=mi>3</span><span class=p>],</span> <span class=n>x</span><span class=o>.</span><span class=n>parts</span><span class=p>[</span><span class=o>-</span><span class=mi>2</span><span class=p>]))</span>
</span><span id=__span-0-548><a id=__codelineno-0-548 name=__codelineno-0-548></a>            <span class=n>display_agents_in_columns</span><span class=p>(</span><span class=n>agents</span><span class=p>)</span>
</span><span id=__span-0-549><a id=__codelineno-0-549 name=__codelineno-0-549></a>
</span><span id=__span-0-550><a id=__codelineno-0-550 name=__codelineno-0-550></a>            <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span><span id=__span-0-551><a id=__codelineno-0-551 name=__codelineno-0-551></a>                <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-552><a id=__codelineno-0-552 name=__codelineno-0-552></a>                    <span class=n>choice</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>Prompt</span><span class=o>.</span><span class=n>ask</span><span class=p>(</span><span class=s2>&quot;[blue bold]Select an agent (enter number)&quot;</span><span class=p>))</span> <span class=o>-</span> <span class=mi>1</span>
</span><span id=__span-0-553><a id=__codelineno-0-553 name=__codelineno-0-553></a>                    <span class=k>if</span> <span class=mi>0</span> <span class=o>&lt;=</span> <span class=n>choice</span> <span class=o>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=n>agents</span><span class=p>):</span>
</span><span id=__span-0-554><a id=__codelineno-0-554 name=__codelineno-0-554></a>                        <span class=n>agent</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>agents</span><span class=p>[</span><span class=n>choice</span><span class=p>])</span>
</span><span id=__span-0-555><a id=__codelineno-0-555 name=__codelineno-0-555></a>                        <span class=k>break</span>
</span><span id=__span-0-556><a id=__codelineno-0-556 name=__codelineno-0-556></a>                    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Invalid selection. Please try again.&quot;</span><span class=p>)</span>
</span><span id=__span-0-557><a id=__codelineno-0-557 name=__codelineno-0-557></a>                <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
</span><span id=__span-0-558><a id=__codelineno-0-558 name=__codelineno-0-558></a>                    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Please enter a valid number.&quot;</span><span class=p>)</span>
</span><span id=__span-0-559><a id=__codelineno-0-559 name=__codelineno-0-559></a>                <span class=k>except</span> <span class=ne>KeyboardInterrupt</span><span class=p>:</span>
</span><span id=__span-0-560><a id=__codelineno-0-560 name=__codelineno-0-560></a>                    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>Operation cancelled.&quot;</span><span class=p>)</span>
</span><span id=__span-0-561><a id=__codelineno-0-561 name=__codelineno-0-561></a>                    <span class=k>return</span>
</span><span id=__span-0-562><a id=__codelineno-0-562 name=__codelineno-0-562></a>
</span><span id=__span-0-563><a id=__codelineno-0-563 name=__codelineno-0-563></a>        <span class=c1># Convert agent path to Path object if it&#39;s a string</span>
</span><span id=__span-0-564><a id=__codelineno-0-564 name=__codelineno-0-564></a>        <span class=n>agent_path</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=n>agent</span><span class=p>)</span>
</span><span id=__span-0-565><a id=__codelineno-0-565 name=__codelineno-0-565></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>agent_path</span><span class=o>.</span><span class=n>exists</span><span class=p>():</span>
</span><span id=__span-0-566><a id=__codelineno-0-566 name=__codelineno-0-566></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error: Agent not found at path: </span><span class=si>{</span><span class=n>agent_path</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-567><a id=__codelineno-0-567 name=__codelineno-0-567></a>            <span class=k>return</span>
</span><span id=__span-0-568><a id=__codelineno-0-568 name=__codelineno-0-568></a>
</span><span id=__span-0-569><a id=__codelineno-0-569 name=__codelineno-0-569></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-570><a id=__codelineno-0-570 name=__codelineno-0-570></a>            <span class=c1># Get the last 3 parts of the path (namespace/name/version)</span>
</span><span id=__span-0-571><a id=__codelineno-0-571 name=__codelineno-0-571></a>            <span class=n>parts</span> <span class=o>=</span> <span class=n>agent_path</span><span class=o>.</span><span class=n>parts</span><span class=p>[</span><span class=o>-</span><span class=mi>3</span><span class=p>:]</span>
</span><span id=__span-0-572><a id=__codelineno-0-572 name=__codelineno-0-572></a>            <span class=n>agent_id</span> <span class=o>=</span> <span class=s2>&quot;/&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>parts</span><span class=p>)</span>
</span><span id=__span-0-573><a id=__codelineno-0-573 name=__codelineno-0-573></a>        <span class=k>except</span> <span class=ne>IndexError</span><span class=p>:</span>
</span><span id=__span-0-574><a id=__codelineno-0-574 name=__codelineno-0-574></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Error: Invalid agent path. Expected format: path/to/namespace/name/version&quot;</span><span class=p>)</span>
</span><span id=__span-0-575><a id=__codelineno-0-575 name=__codelineno-0-575></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Example: ~/.nearai/registry/namespace/agent-name/0.0.1&quot;</span><span class=p>)</span>
</span><span id=__span-0-576><a id=__codelineno-0-576 name=__codelineno-0-576></a>            <span class=k>return</span>
</span><span id=__span-0-577><a id=__codelineno-0-577 name=__codelineno-0-577></a>
</span><span id=__span-0-578><a id=__codelineno-0-578 name=__codelineno-0-578></a>        <span class=n>last_message_id</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-579><a id=__codelineno-0-579 name=__codelineno-0-579></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>=== Starting interactive session with agent: </span><span class=si>{</span><span class=n>agent_id</span><span class=si>}</span><span class=s2> ===&quot;</span><span class=p>)</span>
</span><span id=__span-0-580><a id=__codelineno-0-580 name=__codelineno-0-580></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Type &#39;exit&#39; to end the session</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-581><a id=__codelineno-0-581 name=__codelineno-0-581></a>
</span><span id=__span-0-582><a id=__codelineno-0-582 name=__codelineno-0-582></a>        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span><span id=__span-0-583><a id=__codelineno-0-583 name=__codelineno-0-583></a>            <span class=n>new_message</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=s2>&quot;&gt; &quot;</span><span class=p>)</span>
</span><span id=__span-0-584><a id=__codelineno-0-584 name=__codelineno-0-584></a>            <span class=k>if</span> <span class=n>new_message</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=o>==</span> <span class=s2>&quot;exit&quot;</span><span class=p>:</span>
</span><span id=__span-0-585><a id=__codelineno-0-585 name=__codelineno-0-585></a>                <span class=k>break</span>
</span><span id=__span-0-586><a id=__codelineno-0-586 name=__codelineno-0-586></a>
</span><span id=__span-0-587><a id=__codelineno-0-587 name=__codelineno-0-587></a>            <span class=n>last_message_id</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_task</span><span class=p>(</span>
</span><span id=__span-0-588><a id=__codelineno-0-588 name=__codelineno-0-588></a>                <span class=n>agent</span><span class=o>=</span><span class=n>agent_id</span><span class=p>,</span>
</span><span id=__span-0-589><a id=__codelineno-0-589 name=__codelineno-0-589></a>                <span class=n>task</span><span class=o>=</span><span class=n>new_message</span><span class=p>,</span>
</span><span id=__span-0-590><a id=__codelineno-0-590 name=__codelineno-0-590></a>                <span class=n>thread_id</span><span class=o>=</span><span class=n>thread_id</span><span class=p>,</span>
</span><span id=__span-0-591><a id=__codelineno-0-591 name=__codelineno-0-591></a>                <span class=n>tool_resources</span><span class=o>=</span><span class=n>tool_resources</span><span class=p>,</span>
</span><span id=__span-0-592><a id=__codelineno-0-592 name=__codelineno-0-592></a>                <span class=n>last_message_id</span><span class=o>=</span><span class=n>last_message_id</span><span class=p>,</span>
</span><span id=__span-0-593><a id=__codelineno-0-593 name=__codelineno-0-593></a>                <span class=n>local</span><span class=o>=</span><span class=n>local</span><span class=p>,</span>
</span><span id=__span-0-594><a id=__codelineno-0-594 name=__codelineno-0-594></a>                <span class=n>verbose</span><span class=o>=</span><span class=n>verbose</span><span class=p>,</span>
</span><span id=__span-0-595><a id=__codelineno-0-595 name=__codelineno-0-595></a>                <span class=n>env_vars</span><span class=o>=</span><span class=n>env_vars</span><span class=p>,</span>
</span><span id=__span-0-596><a id=__codelineno-0-596 name=__codelineno-0-596></a>            <span class=p>)</span>
</span><span id=__span-0-597><a id=__codelineno-0-597 name=__codelineno-0-597></a>
</span><span id=__span-0-598><a id=__codelineno-0-598 name=__codelineno-0-598></a>            <span class=c1># Update thread_id for the next iteration</span>
</span><span id=__span-0-599><a id=__codelineno-0-599 name=__codelineno-0-599></a>            <span class=k>if</span> <span class=n>thread_id</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-600><a id=__codelineno-0-600 name=__codelineno-0-600></a>                <span class=n>thread_id</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>last_thread_id</span>
</span><span id=__span-0-601><a id=__codelineno-0-601 name=__codelineno-0-601></a>
</span><span id=__span-0-602><a id=__codelineno-0-602 name=__codelineno-0-602></a>    <span class=k>def</span><span class=w> </span><span class=nf>task</span><span class=p>(</span>
</span><span id=__span-0-603><a id=__codelineno-0-603 name=__codelineno-0-603></a>        <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-604><a id=__codelineno-0-604 name=__codelineno-0-604></a>        <span class=n>agent</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-605><a id=__codelineno-0-605 name=__codelineno-0-605></a>        <span class=n>task</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-606><a id=__codelineno-0-606 name=__codelineno-0-606></a>        <span class=n>thread_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-607><a id=__codelineno-0-607 name=__codelineno-0-607></a>        <span class=n>tool_resources</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-608><a id=__codelineno-0-608 name=__codelineno-0-608></a>        <span class=n>file_ids</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-609><a id=__codelineno-0-609 name=__codelineno-0-609></a>        <span class=n>local</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-610><a id=__codelineno-0-610 name=__codelineno-0-610></a>        <span class=n>verbose</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-611><a id=__codelineno-0-611 name=__codelineno-0-611></a>        <span class=n>env_vars</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-612><a id=__codelineno-0-612 name=__codelineno-0-612></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-613><a id=__codelineno-0-613 name=__codelineno-0-613></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;CLI wrapper for the _task method.&quot;&quot;&quot;</span>
</span><span id=__span-0-614><a id=__codelineno-0-614 name=__codelineno-0-614></a>        <span class=n>last_message_id</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_task</span><span class=p>(</span>
</span><span id=__span-0-615><a id=__codelineno-0-615 name=__codelineno-0-615></a>            <span class=n>agent</span><span class=o>=</span><span class=n>agent</span><span class=p>,</span>
</span><span id=__span-0-616><a id=__codelineno-0-616 name=__codelineno-0-616></a>            <span class=n>task</span><span class=o>=</span><span class=n>task</span><span class=p>,</span>
</span><span id=__span-0-617><a id=__codelineno-0-617 name=__codelineno-0-617></a>            <span class=n>thread_id</span><span class=o>=</span><span class=n>thread_id</span><span class=p>,</span>
</span><span id=__span-0-618><a id=__codelineno-0-618 name=__codelineno-0-618></a>            <span class=n>tool_resources</span><span class=o>=</span><span class=n>tool_resources</span><span class=p>,</span>
</span><span id=__span-0-619><a id=__codelineno-0-619 name=__codelineno-0-619></a>            <span class=n>file_ids</span><span class=o>=</span><span class=n>file_ids</span><span class=p>,</span>
</span><span id=__span-0-620><a id=__codelineno-0-620 name=__codelineno-0-620></a>            <span class=n>local</span><span class=o>=</span><span class=n>local</span><span class=p>,</span>
</span><span id=__span-0-621><a id=__codelineno-0-621 name=__codelineno-0-621></a>            <span class=n>verbose</span><span class=o>=</span><span class=n>verbose</span><span class=p>,</span>
</span><span id=__span-0-622><a id=__codelineno-0-622 name=__codelineno-0-622></a>            <span class=n>env_vars</span><span class=o>=</span><span class=n>env_vars</span><span class=p>,</span>
</span><span id=__span-0-623><a id=__codelineno-0-623 name=__codelineno-0-623></a>        <span class=p>)</span>
</span><span id=__span-0-624><a id=__codelineno-0-624 name=__codelineno-0-624></a>        <span class=k>if</span> <span class=n>last_message_id</span><span class=p>:</span>
</span><span id=__span-0-625><a id=__codelineno-0-625 name=__codelineno-0-625></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Task completed. Thread ID: </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>last_thread_id</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-626><a id=__codelineno-0-626 name=__codelineno-0-626></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Last message ID: </span><span class=si>{</span><span class=n>last_message_id</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-627><a id=__codelineno-0-627 name=__codelineno-0-627></a>
</span><span id=__span-0-628><a id=__codelineno-0-628 name=__codelineno-0-628></a>    <span class=k>def</span><span class=w> </span><span class=nf>_task</span><span class=p>(</span>
</span><span id=__span-0-629><a id=__codelineno-0-629 name=__codelineno-0-629></a>        <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-630><a id=__codelineno-0-630 name=__codelineno-0-630></a>        <span class=n>agent</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-631><a id=__codelineno-0-631 name=__codelineno-0-631></a>        <span class=n>task</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-632><a id=__codelineno-0-632 name=__codelineno-0-632></a>        <span class=n>thread_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-633><a id=__codelineno-0-633 name=__codelineno-0-633></a>        <span class=n>tool_resources</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-634><a id=__codelineno-0-634 name=__codelineno-0-634></a>        <span class=n>file_ids</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-635><a id=__codelineno-0-635 name=__codelineno-0-635></a>        <span class=n>last_message_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-636><a id=__codelineno-0-636 name=__codelineno-0-636></a>        <span class=n>local</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-637><a id=__codelineno-0-637 name=__codelineno-0-637></a>        <span class=n>verbose</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-638><a id=__codelineno-0-638 name=__codelineno-0-638></a>        <span class=n>env_vars</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-639><a id=__codelineno-0-639 name=__codelineno-0-639></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
</span><span id=__span-0-640><a id=__codelineno-0-640 name=__codelineno-0-640></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Runs agent non-interactively with a single task.&quot;&quot;&quot;</span>
</span><span id=__span-0-641><a id=__codelineno-0-641 name=__codelineno-0-641></a>        <span class=n>assert_user_auth</span><span class=p>()</span>
</span><span id=__span-0-642><a id=__codelineno-0-642 name=__codelineno-0-642></a>
</span><span id=__span-0-643><a id=__codelineno-0-643 name=__codelineno-0-643></a>        <span class=n>hub_client</span> <span class=o>=</span> <span class=n>get_hub_client</span><span class=p>()</span>
</span><span id=__span-0-644><a id=__codelineno-0-644 name=__codelineno-0-644></a>        <span class=k>if</span> <span class=n>thread_id</span><span class=p>:</span>
</span><span id=__span-0-645><a id=__codelineno-0-645 name=__codelineno-0-645></a>            <span class=n>thread</span> <span class=o>=</span> <span class=n>hub_client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>retrieve</span><span class=p>(</span><span class=n>thread_id</span><span class=p>)</span>
</span><span id=__span-0-646><a id=__codelineno-0-646 name=__codelineno-0-646></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-647><a id=__codelineno-0-647 name=__codelineno-0-647></a>            <span class=n>thread</span> <span class=o>=</span> <span class=n>hub_client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>create</span><span class=p>(</span>
</span><span id=__span-0-648><a id=__codelineno-0-648 name=__codelineno-0-648></a>                <span class=n>tool_resources</span><span class=o>=</span><span class=n>tool_resources</span><span class=p>,</span>
</span><span id=__span-0-649><a id=__codelineno-0-649 name=__codelineno-0-649></a>            <span class=p>)</span>
</span><span id=__span-0-650><a id=__codelineno-0-650 name=__codelineno-0-650></a>
</span><span id=__span-0-651><a id=__codelineno-0-651 name=__codelineno-0-651></a>        <span class=n>hub_client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>messages</span><span class=o>.</span><span class=n>create</span><span class=p>(</span>
</span><span id=__span-0-652><a id=__codelineno-0-652 name=__codelineno-0-652></a>            <span class=n>thread_id</span><span class=o>=</span><span class=n>thread</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span><span id=__span-0-653><a id=__codelineno-0-653 name=__codelineno-0-653></a>            <span class=n>role</span><span class=o>=</span><span class=s2>&quot;user&quot;</span><span class=p>,</span>
</span><span id=__span-0-654><a id=__codelineno-0-654 name=__codelineno-0-654></a>            <span class=n>content</span><span class=o>=</span><span class=n>task</span><span class=p>,</span>
</span><span id=__span-0-655><a id=__codelineno-0-655 name=__codelineno-0-655></a>            <span class=n>attachments</span><span class=o>=</span><span class=p>[</span><span class=n>Attachment</span><span class=p>(</span><span class=n>file_id</span><span class=o>=</span><span class=n>file_id</span><span class=p>)</span> <span class=k>for</span> <span class=n>file_id</span> <span class=ow>in</span> <span class=n>file_ids</span><span class=p>]</span> <span class=k>if</span> <span class=n>file_ids</span> <span class=k>else</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-656><a id=__codelineno-0-656 name=__codelineno-0-656></a>        <span class=p>)</span>
</span><span id=__span-0-657><a id=__codelineno-0-657 name=__codelineno-0-657></a>
</span><span id=__span-0-658><a id=__codelineno-0-658 name=__codelineno-0-658></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>local</span><span class=p>:</span>
</span><span id=__span-0-659><a id=__codelineno-0-659 name=__codelineno-0-659></a>            <span class=n>hub_client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>runs</span><span class=o>.</span><span class=n>create_and_poll</span><span class=p>(</span>
</span><span id=__span-0-660><a id=__codelineno-0-660 name=__codelineno-0-660></a>                <span class=n>thread_id</span><span class=o>=</span><span class=n>thread</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span><span id=__span-0-661><a id=__codelineno-0-661 name=__codelineno-0-661></a>                <span class=n>assistant_id</span><span class=o>=</span><span class=n>agent</span><span class=p>,</span>
</span><span id=__span-0-662><a id=__codelineno-0-662 name=__codelineno-0-662></a>            <span class=p>)</span>
</span><span id=__span-0-663><a id=__codelineno-0-663 name=__codelineno-0-663></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-664><a id=__codelineno-0-664 name=__codelineno-0-664></a>            <span class=n>run</span> <span class=o>=</span> <span class=n>hub_client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>runs</span><span class=o>.</span><span class=n>create</span><span class=p>(</span>
</span><span id=__span-0-665><a id=__codelineno-0-665 name=__codelineno-0-665></a>                <span class=n>thread_id</span><span class=o>=</span><span class=n>thread</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span><span id=__span-0-666><a id=__codelineno-0-666 name=__codelineno-0-666></a>                <span class=n>assistant_id</span><span class=o>=</span><span class=n>agent</span><span class=p>,</span>
</span><span id=__span-0-667><a id=__codelineno-0-667 name=__codelineno-0-667></a>                <span class=n>extra_body</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;delegate_execution&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>},</span>
</span><span id=__span-0-668><a id=__codelineno-0-668 name=__codelineno-0-668></a>            <span class=p>)</span>
</span><span id=__span-0-669><a id=__codelineno-0-669 name=__codelineno-0-669></a>            <span class=n>params</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-670><a id=__codelineno-0-670 name=__codelineno-0-670></a>                <span class=s2>&quot;api_url&quot;</span><span class=p>:</span> <span class=n>CONFIG</span><span class=o>.</span><span class=n>api_url</span><span class=p>,</span>
</span><span id=__span-0-671><a id=__codelineno-0-671 name=__codelineno-0-671></a>                <span class=s2>&quot;tool_resources&quot;</span><span class=p>:</span> <span class=n>run</span><span class=o>.</span><span class=n>tools</span><span class=p>,</span>
</span><span id=__span-0-672><a id=__codelineno-0-672 name=__codelineno-0-672></a>                <span class=s2>&quot;data_source&quot;</span><span class=p>:</span> <span class=s2>&quot;local_files&quot;</span><span class=p>,</span>
</span><span id=__span-0-673><a id=__codelineno-0-673 name=__codelineno-0-673></a>                <span class=s2>&quot;user_env_vars&quot;</span><span class=p>:</span> <span class=n>env_vars</span><span class=p>,</span>
</span><span id=__span-0-674><a id=__codelineno-0-674 name=__codelineno-0-674></a>                <span class=s2>&quot;agent_env_vars&quot;</span><span class=p>:</span> <span class=p>{},</span>
</span><span id=__span-0-675><a id=__codelineno-0-675 name=__codelineno-0-675></a>                <span class=s2>&quot;verbose&quot;</span><span class=p>:</span> <span class=n>verbose</span><span class=p>,</span>
</span><span id=__span-0-676><a id=__codelineno-0-676 name=__codelineno-0-676></a>            <span class=p>}</span>
</span><span id=__span-0-677><a id=__codelineno-0-677 name=__codelineno-0-677></a>            <span class=n>auth</span> <span class=o>=</span> <span class=n>CONFIG</span><span class=o>.</span><span class=n>auth</span>
</span><span id=__span-0-678><a id=__codelineno-0-678 name=__codelineno-0-678></a>            <span class=k>assert</span> <span class=n>auth</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span>
</span><span id=__span-0-679><a id=__codelineno-0-679 name=__codelineno-0-679></a>            <span class=n>LocalRunner</span><span class=p>(</span><span class=n>agent</span><span class=p>,</span> <span class=n>agent</span><span class=p>,</span> <span class=n>thread</span><span class=o>.</span><span class=n>id</span><span class=p>,</span> <span class=n>run</span><span class=o>.</span><span class=n>id</span><span class=p>,</span> <span class=n>auth</span><span class=p>,</span> <span class=n>params</span><span class=p>)</span>
</span><span id=__span-0-680><a id=__codelineno-0-680 name=__codelineno-0-680></a>
</span><span id=__span-0-681><a id=__codelineno-0-681 name=__codelineno-0-681></a>        <span class=c1># List new messages</span>
</span><span id=__span-0-682><a id=__codelineno-0-682 name=__codelineno-0-682></a>        <span class=n>messages</span> <span class=o>=</span> <span class=n>hub_client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>messages</span><span class=o>.</span><span class=n>list</span><span class=p>(</span><span class=n>thread_id</span><span class=o>=</span><span class=n>thread</span><span class=o>.</span><span class=n>id</span><span class=p>,</span> <span class=n>after</span><span class=o>=</span><span class=n>last_message_id</span><span class=p>,</span> <span class=n>order</span><span class=o>=</span><span class=s2>&quot;asc&quot;</span><span class=p>)</span>
</span><span id=__span-0-683><a id=__codelineno-0-683 name=__codelineno-0-683></a>        <span class=n>message_list</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>messages</span><span class=p>)</span>
</span><span id=__span-0-684><a id=__codelineno-0-684 name=__codelineno-0-684></a>        <span class=k>if</span> <span class=n>message_list</span><span class=p>:</span>
</span><span id=__span-0-685><a id=__codelineno-0-685 name=__codelineno-0-685></a>            <span class=k>for</span> <span class=n>msg</span> <span class=ow>in</span> <span class=n>message_list</span><span class=p>:</span>
</span><span id=__span-0-686><a id=__codelineno-0-686 name=__codelineno-0-686></a>                <span class=k>if</span> <span class=n>msg</span><span class=o>.</span><span class=n>metadata</span> <span class=ow>and</span> <span class=n>msg</span><span class=o>.</span><span class=n>metadata</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;message_type&quot;</span><span class=p>):</span>
</span><span id=__span-0-687><a id=__codelineno-0-687 name=__codelineno-0-687></a>                    <span class=k>continue</span>
</span><span id=__span-0-688><a id=__codelineno-0-688 name=__codelineno-0-688></a>                <span class=k>if</span> <span class=n>msg</span><span class=o>.</span><span class=n>role</span> <span class=o>==</span> <span class=s2>&quot;assistant&quot;</span><span class=p>:</span>
</span><span id=__span-0-689><a id=__codelineno-0-689 name=__codelineno-0-689></a>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Assistant: </span><span class=si>{</span><span class=n>msg</span><span class=o>.</span><span class=n>content</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>text</span><span class=o>.</span><span class=n>value</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-690><a id=__codelineno-0-690 name=__codelineno-0-690></a>            <span class=n>last_message_id</span> <span class=o>=</span> <span class=n>message_list</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>id</span>
</span><span id=__span-0-691><a id=__codelineno-0-691 name=__codelineno-0-691></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-692><a id=__codelineno-0-692 name=__codelineno-0-692></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;No new messages&quot;</span><span class=p>)</span>
</span><span id=__span-0-693><a id=__codelineno-0-693 name=__codelineno-0-693></a>
</span><span id=__span-0-694><a id=__codelineno-0-694 name=__codelineno-0-694></a>        <span class=c1># Store the thread_id for potential use in interactive mode</span>
</span><span id=__span-0-695><a id=__codelineno-0-695 name=__codelineno-0-695></a>        <span class=bp>self</span><span class=o>.</span><span class=n>last_thread_id</span> <span class=o>=</span> <span class=n>thread</span><span class=o>.</span><span class=n>id</span>
</span><span id=__span-0-696><a id=__codelineno-0-696 name=__codelineno-0-696></a>
</span><span id=__span-0-697><a id=__codelineno-0-697 name=__codelineno-0-697></a>        <span class=k>return</span> <span class=n>last_message_id</span>
</span><span id=__span-0-698><a id=__codelineno-0-698 name=__codelineno-0-698></a>
</span><span id=__span-0-699><a id=__codelineno-0-699 name=__codelineno-0-699></a>    <span class=k>def</span><span class=w> </span><span class=nf>create</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>name</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>description</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>fork</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-700><a id=__codelineno-0-700 name=__codelineno-0-700></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Create a new agent or fork an existing one.</span>
</span><span id=__span-0-701><a id=__codelineno-0-701 name=__codelineno-0-701></a>
</span><span id=__span-0-702><a id=__codelineno-0-702 name=__codelineno-0-702></a><span class=sd>        Usage:</span>
</span><span id=__span-0-703><a id=__codelineno-0-703 name=__codelineno-0-703></a><span class=sd>          nearai agent create  # Enters interactive mode</span>
</span><span id=__span-0-704><a id=__codelineno-0-704 name=__codelineno-0-704></a><span class=sd>          nearai agent create --name &lt;agent_name&gt; --description &lt;description&gt;</span>
</span><span id=__span-0-705><a id=__codelineno-0-705 name=__codelineno-0-705></a><span class=sd>          nearai agent create --fork &lt;namespace/agent_name/version&gt; [--name &lt;new_agent_name&gt;]</span>
</span><span id=__span-0-706><a id=__codelineno-0-706 name=__codelineno-0-706></a>
</span><span id=__span-0-707><a id=__codelineno-0-707 name=__codelineno-0-707></a><span class=sd>        Options:</span>
</span><span id=__span-0-708><a id=__codelineno-0-708 name=__codelineno-0-708></a><span class=sd>          --name          Name of the new agent (optional).</span>
</span><span id=__span-0-709><a id=__codelineno-0-709 name=__codelineno-0-709></a><span class=sd>          --description   Description of the new agent (optional).</span>
</span><span id=__span-0-710><a id=__codelineno-0-710 name=__codelineno-0-710></a><span class=sd>          --fork          Fork an existing agent specified by namespace/agent_name/version.</span>
</span><span id=__span-0-711><a id=__codelineno-0-711 name=__codelineno-0-711></a>
</span><span id=__span-0-712><a id=__codelineno-0-712 name=__codelineno-0-712></a><span class=sd>        Examples</span>
</span><span id=__span-0-713><a id=__codelineno-0-713 name=__codelineno-0-713></a><span class=sd>        --------</span>
</span><span id=__span-0-714><a id=__codelineno-0-714 name=__codelineno-0-714></a><span class=sd>          nearai agent create   # Enters interactive mode</span>
</span><span id=__span-0-715><a id=__codelineno-0-715 name=__codelineno-0-715></a><span class=sd>          nearai agent create --name my_agent --description &quot;My new agent&quot;</span>
</span><span id=__span-0-716><a id=__codelineno-0-716 name=__codelineno-0-716></a><span class=sd>          nearai agent create --fork agentic.near/summary/0.0.3 --name new_summary_agent</span>
</span><span id=__span-0-717><a id=__codelineno-0-717 name=__codelineno-0-717></a>
</span><span id=__span-0-718><a id=__codelineno-0-718 name=__codelineno-0-718></a><span class=sd>        &quot;&quot;&quot;</span>
</span><span id=__span-0-719><a id=__codelineno-0-719 name=__codelineno-0-719></a>        <span class=c1># Check if the user is authenticated</span>
</span><span id=__span-0-720><a id=__codelineno-0-720 name=__codelineno-0-720></a>        <span class=k>if</span> <span class=n>CONFIG</span><span class=o>.</span><span class=n>auth</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>or</span> <span class=n>CONFIG</span><span class=o>.</span><span class=n>auth</span><span class=o>.</span><span class=n>namespace</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-721><a id=__codelineno-0-721 name=__codelineno-0-721></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Please login with `nearai login` before creating an agent.&quot;</span><span class=p>)</span>
</span><span id=__span-0-722><a id=__codelineno-0-722 name=__codelineno-0-722></a>            <span class=k>return</span>
</span><span id=__span-0-723><a id=__codelineno-0-723 name=__codelineno-0-723></a>
</span><span id=__span-0-724><a id=__codelineno-0-724 name=__codelineno-0-724></a>        <span class=n>namespace</span> <span class=o>=</span> <span class=n>CONFIG</span><span class=o>.</span><span class=n>auth</span><span class=o>.</span><span class=n>namespace</span>
</span><span id=__span-0-725><a id=__codelineno-0-725 name=__codelineno-0-725></a>
</span><span id=__span-0-726><a id=__codelineno-0-726 name=__codelineno-0-726></a>        <span class=k>if</span> <span class=n>fork</span><span class=p>:</span>
</span><span id=__span-0-727><a id=__codelineno-0-727 name=__codelineno-0-727></a>            <span class=c1># Fork an existing agent</span>
</span><span id=__span-0-728><a id=__codelineno-0-728 name=__codelineno-0-728></a>            <span class=bp>self</span><span class=o>.</span><span class=n>_fork_agent</span><span class=p>(</span><span class=n>fork</span><span class=p>,</span> <span class=n>namespace</span><span class=p>,</span> <span class=n>name</span><span class=p>)</span>
</span><span id=__span-0-729><a id=__codelineno-0-729 name=__codelineno-0-729></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-730><a id=__codelineno-0-730 name=__codelineno-0-730></a>            <span class=c1># Create a new agent from scratch</span>
</span><span id=__span-0-731><a id=__codelineno-0-731 name=__codelineno-0-731></a>            <span class=bp>self</span><span class=o>.</span><span class=n>_create_new_agent</span><span class=p>(</span><span class=n>namespace</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>description</span><span class=p>)</span>
</span><span id=__span-0-732><a id=__codelineno-0-732 name=__codelineno-0-732></a>
</span><span id=__span-0-733><a id=__codelineno-0-733 name=__codelineno-0-733></a>    <span class=k>def</span><span class=w> </span><span class=nf>_create_new_agent</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>namespace</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>name</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>],</span> <span class=n>description</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-734><a id=__codelineno-0-734 name=__codelineno-0-734></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Create a new agent from scratch.&quot;&quot;&quot;</span>
</span><span id=__span-0-735><a id=__codelineno-0-735 name=__codelineno-0-735></a>        <span class=c1># If no name/description provided, use interactive prompts</span>
</span><span id=__span-0-736><a id=__codelineno-0-736 name=__codelineno-0-736></a>        <span class=n>init_instructions</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-737><a id=__codelineno-0-737 name=__codelineno-0-737></a>        <span class=k>if</span> <span class=n>name</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>and</span> <span class=n>description</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-738><a id=__codelineno-0-738 name=__codelineno-0-738></a>            <span class=n>_</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>description</span><span class=p>,</span> <span class=n>init_instructions</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_prompt_agent_details</span><span class=p>()</span>
</span><span id=__span-0-739><a id=__codelineno-0-739 name=__codelineno-0-739></a>
</span><span id=__span-0-740><a id=__codelineno-0-740 name=__codelineno-0-740></a>        <span class=c1># Set the agent path</span>
</span><span id=__span-0-741><a id=__codelineno-0-741 name=__codelineno-0-741></a>        <span class=n>registry_folder</span> <span class=o>=</span> <span class=n>get_registry_folder</span><span class=p>()</span>
</span><span id=__span-0-742><a id=__codelineno-0-742 name=__codelineno-0-742></a>        <span class=k>if</span> <span class=n>registry_folder</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-743><a id=__codelineno-0-743 name=__codelineno-0-743></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Registry folder path cannot be None&quot;</span><span class=p>)</span>
</span><span id=__span-0-744><a id=__codelineno-0-744 name=__codelineno-0-744></a>
</span><span id=__span-0-745><a id=__codelineno-0-745 name=__codelineno-0-745></a>        <span class=c1># Narrow the type of namespace &amp; name from Optional[str] to str</span>
</span><span id=__span-0-746><a id=__codelineno-0-746 name=__codelineno-0-746></a>        <span class=n>namespace_str</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>namespace</span> <span class=k>if</span> <span class=n>namespace</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=k>else</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-747><a id=__codelineno-0-747 name=__codelineno-0-747></a>        <span class=k>if</span> <span class=n>namespace_str</span> <span class=o>==</span> <span class=s2>&quot;&quot;</span><span class=p>:</span>
</span><span id=__span-0-748><a id=__codelineno-0-748 name=__codelineno-0-748></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Namespace cannot be None or empty&quot;</span><span class=p>)</span>
</span><span id=__span-0-749><a id=__codelineno-0-749 name=__codelineno-0-749></a>
</span><span id=__span-0-750><a id=__codelineno-0-750 name=__codelineno-0-750></a>        <span class=n>name_str</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>name</span> <span class=k>if</span> <span class=n>name</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=k>else</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-751><a id=__codelineno-0-751 name=__codelineno-0-751></a>        <span class=k>if</span> <span class=n>name_str</span> <span class=o>==</span> <span class=s2>&quot;&quot;</span><span class=p>:</span>
</span><span id=__span-0-752><a id=__codelineno-0-752 name=__codelineno-0-752></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Name cannot be None or empty&quot;</span><span class=p>)</span>
</span><span id=__span-0-753><a id=__codelineno-0-753 name=__codelineno-0-753></a>
</span><span id=__span-0-754><a id=__codelineno-0-754 name=__codelineno-0-754></a>        <span class=n>agent_path</span> <span class=o>=</span> <span class=n>registry_folder</span> <span class=o>/</span> <span class=n>namespace_str</span> <span class=o>/</span> <span class=n>name_str</span> <span class=o>/</span> <span class=s2>&quot;0.0.1&quot;</span>
</span><span id=__span-0-755><a id=__codelineno-0-755 name=__codelineno-0-755></a>        <span class=n>agent_path</span><span class=o>.</span><span class=n>mkdir</span><span class=p>(</span><span class=n>parents</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-756><a id=__codelineno-0-756 name=__codelineno-0-756></a>
</span><span id=__span-0-757><a id=__codelineno-0-757 name=__codelineno-0-757></a>        <span class=n>metadata</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-758><a id=__codelineno-0-758 name=__codelineno-0-758></a>            <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=n>name_str</span><span class=p>,</span>
</span><span id=__span-0-759><a id=__codelineno-0-759 name=__codelineno-0-759></a>            <span class=s2>&quot;version&quot;</span><span class=p>:</span> <span class=s2>&quot;0.0.1&quot;</span><span class=p>,</span>
</span><span id=__span-0-760><a id=__codelineno-0-760 name=__codelineno-0-760></a>            <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=n>description</span> <span class=ow>or</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-761><a id=__codelineno-0-761 name=__codelineno-0-761></a>            <span class=s2>&quot;category&quot;</span><span class=p>:</span> <span class=s2>&quot;agent&quot;</span><span class=p>,</span>
</span><span id=__span-0-762><a id=__codelineno-0-762 name=__codelineno-0-762></a>            <span class=s2>&quot;tags&quot;</span><span class=p>:</span> <span class=p>[],</span>
</span><span id=__span-0-763><a id=__codelineno-0-763 name=__codelineno-0-763></a>            <span class=s2>&quot;details&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-0-764><a id=__codelineno-0-764 name=__codelineno-0-764></a>                <span class=s2>&quot;agent&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-0-765><a id=__codelineno-0-765 name=__codelineno-0-765></a>                    <span class=s2>&quot;defaults&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-0-766><a id=__codelineno-0-766 name=__codelineno-0-766></a>                        <span class=s2>&quot;model&quot;</span><span class=p>:</span> <span class=n>DEFAULT_MODEL</span><span class=p>,</span>
</span><span id=__span-0-767><a id=__codelineno-0-767 name=__codelineno-0-767></a>                        <span class=s2>&quot;model_provider&quot;</span><span class=p>:</span> <span class=n>DEFAULT_PROVIDER</span><span class=p>,</span>
</span><span id=__span-0-768><a id=__codelineno-0-768 name=__codelineno-0-768></a>                        <span class=s2>&quot;model_temperature&quot;</span><span class=p>:</span> <span class=n>DEFAULT_MODEL_TEMPERATURE</span><span class=p>,</span>
</span><span id=__span-0-769><a id=__codelineno-0-769 name=__codelineno-0-769></a>                        <span class=s2>&quot;model_max_tokens&quot;</span><span class=p>:</span> <span class=n>DEFAULT_MODEL_MAX_TOKENS</span><span class=p>,</span>
</span><span id=__span-0-770><a id=__codelineno-0-770 name=__codelineno-0-770></a>                    <span class=p>}</span>
</span><span id=__span-0-771><a id=__codelineno-0-771 name=__codelineno-0-771></a>                <span class=p>}</span>
</span><span id=__span-0-772><a id=__codelineno-0-772 name=__codelineno-0-772></a>            <span class=p>},</span>
</span><span id=__span-0-773><a id=__codelineno-0-773 name=__codelineno-0-773></a>            <span class=s2>&quot;show_entry&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-774><a id=__codelineno-0-774 name=__codelineno-0-774></a>        <span class=p>}</span>
</span><span id=__span-0-775><a id=__codelineno-0-775 name=__codelineno-0-775></a>
</span><span id=__span-0-776><a id=__codelineno-0-776 name=__codelineno-0-776></a>        <span class=n>metadata_path</span> <span class=o>=</span> <span class=n>agent_path</span> <span class=o>/</span> <span class=s2>&quot;metadata.json&quot;</span>
</span><span id=__span-0-777><a id=__codelineno-0-777 name=__codelineno-0-777></a>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>metadata_path</span><span class=p>,</span> <span class=s2>&quot;w&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-778><a id=__codelineno-0-778 name=__codelineno-0-778></a>            <span class=n>json</span><span class=o>.</span><span class=n>dump</span><span class=p>(</span><span class=n>metadata</span><span class=p>,</span> <span class=n>f</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</span><span id=__span-0-779><a id=__codelineno-0-779 name=__codelineno-0-779></a>
</span><span id=__span-0-780><a id=__codelineno-0-780 name=__codelineno-0-780></a>        <span class=c1># Create a default agent.py with the provided initial</span>
</span><span id=__span-0-781><a id=__codelineno-0-781 name=__codelineno-0-781></a>        <span class=n>agent_py_content</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;&quot;&quot;from nearai.agents.environment import Environment</span>
</span><span id=__span-0-782><a id=__codelineno-0-782 name=__codelineno-0-782></a>
</span><span id=__span-0-783><a id=__codelineno-0-783 name=__codelineno-0-783></a>
</span><span id=__span-0-784><a id=__codelineno-0-784 name=__codelineno-0-784></a><span class=s2>def run(env: Environment):</span>
</span><span id=__span-0-785><a id=__codelineno-0-785 name=__codelineno-0-785></a><span class=s2>    # Your agent code here</span>
</span><span id=__span-0-786><a id=__codelineno-0-786 name=__codelineno-0-786></a><span class=s2>    prompt = </span><span class=se>{{</span><span class=s2>&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;</span><span class=si>{</span><span class=n>init_instructions</span><span class=si>}</span><span class=s2>&quot;</span><span class=se>}}</span>
</span><span id=__span-0-787><a id=__codelineno-0-787 name=__codelineno-0-787></a><span class=s2>    result = env.completion([prompt] + env.list_messages())</span>
</span><span id=__span-0-788><a id=__codelineno-0-788 name=__codelineno-0-788></a><span class=s2>    env.add_reply(result)</span>
</span><span id=__span-0-789><a id=__codelineno-0-789 name=__codelineno-0-789></a><span class=s2>    env.request_user_input()</span>
</span><span id=__span-0-790><a id=__codelineno-0-790 name=__codelineno-0-790></a>
</span><span id=__span-0-791><a id=__codelineno-0-791 name=__codelineno-0-791></a><span class=s2>run(env)</span>
</span><span id=__span-0-792><a id=__codelineno-0-792 name=__codelineno-0-792></a>
</span><span id=__span-0-793><a id=__codelineno-0-793 name=__codelineno-0-793></a><span class=s2>&quot;&quot;&quot;</span>
</span><span id=__span-0-794><a id=__codelineno-0-794 name=__codelineno-0-794></a>        <span class=n>agent_py_path</span> <span class=o>=</span> <span class=n>agent_path</span> <span class=o>/</span> <span class=s2>&quot;agent.py&quot;</span>
</span><span id=__span-0-795><a id=__codelineno-0-795 name=__codelineno-0-795></a>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>agent_py_path</span><span class=p>,</span> <span class=s2>&quot;w&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-796><a id=__codelineno-0-796 name=__codelineno-0-796></a>            <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>agent_py_content</span><span class=p>)</span>
</span><span id=__span-0-797><a id=__codelineno-0-797 name=__codelineno-0-797></a>
</span><span id=__span-0-798><a id=__codelineno-0-798 name=__codelineno-0-798></a>        <span class=c1># Create success message</span>
</span><span id=__span-0-799><a id=__codelineno-0-799 name=__codelineno-0-799></a>        <span class=n>console</span> <span class=o>=</span> <span class=n>Console</span><span class=p>()</span>
</span><span id=__span-0-800><a id=__codelineno-0-800 name=__codelineno-0-800></a>        <span class=n>success_title</span> <span class=o>=</span> <span class=n>Text</span><span class=p>(</span><span class=s2>&quot; 🎉 SUCCESS!&quot;</span><span class=p>,</span> <span class=n>style</span><span class=o>=</span><span class=s2>&quot;bold green&quot;</span><span class=p>)</span>
</span><span id=__span-0-801><a id=__codelineno-0-801 name=__codelineno-0-801></a>        <span class=n>path_text</span> <span class=o>=</span> <span class=n>Text</span><span class=o>.</span><span class=n>assemble</span><span class=p>((</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>  • New AI Agent created at: &quot;</span><span class=p>,</span> <span class=s2>&quot;bold green&quot;</span><span class=p>),</span> <span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>agent_path</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span> <span class=s2>&quot;bold&quot;</span><span class=p>))</span>
</span><span id=__span-0-802><a id=__codelineno-0-802 name=__codelineno-0-802></a>
</span><span id=__span-0-803><a id=__codelineno-0-803 name=__codelineno-0-803></a>        <span class=n>files_panel</span> <span class=o>=</span> <span class=n>Panel</span><span class=p>(</span>
</span><span id=__span-0-804><a id=__codelineno-0-804 name=__codelineno-0-804></a>            <span class=n>Text</span><span class=o>.</span><span class=n>assemble</span><span class=p>(</span>
</span><span id=__span-0-805><a id=__codelineno-0-805 name=__codelineno-0-805></a>                <span class=p>(</span><span class=s2>&quot;Edit agent code here:</span><span class=se>\n\n</span><span class=s2>&quot;</span><span class=p>,</span> <span class=s2>&quot;yellow&quot;</span><span class=p>),</span>
</span><span id=__span-0-806><a id=__codelineno-0-806 name=__codelineno-0-806></a>                <span class=p>(</span><span class=sa>f</span><span class=s2>&quot;📄 - </span><span class=si>{</span><span class=n>agent_path</span><span class=si>}</span><span class=s2>/agent.py</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>,</span> <span class=s2>&quot;bold blue&quot;</span><span class=p>),</span>
</span><span id=__span-0-807><a id=__codelineno-0-807 name=__codelineno-0-807></a>                <span class=p>(</span><span class=sa>f</span><span class=s2>&quot;📄 - </span><span class=si>{</span><span class=n>agent_path</span><span class=si>}</span><span class=s2>/metadata.json&quot;</span><span class=p>,</span> <span class=s2>&quot;bold blue&quot;</span><span class=p>),</span>
</span><span id=__span-0-808><a id=__codelineno-0-808 name=__codelineno-0-808></a>            <span class=p>),</span>
</span><span id=__span-0-809><a id=__codelineno-0-809 name=__codelineno-0-809></a>            <span class=n>title</span><span class=o>=</span><span class=s2>&quot;Agent Files&quot;</span><span class=p>,</span>
</span><span id=__span-0-810><a id=__codelineno-0-810 name=__codelineno-0-810></a>            <span class=n>border_style</span><span class=o>=</span><span class=s2>&quot;yellow&quot;</span><span class=p>,</span>
</span><span id=__span-0-811><a id=__codelineno-0-811 name=__codelineno-0-811></a>        <span class=p>)</span>
</span><span id=__span-0-812><a id=__codelineno-0-812 name=__codelineno-0-812></a>
</span><span id=__span-0-813><a id=__codelineno-0-813 name=__codelineno-0-813></a>        <span class=n>commands_panel</span> <span class=o>=</span> <span class=n>Panel</span><span class=p>(</span>
</span><span id=__span-0-814><a id=__codelineno-0-814 name=__codelineno-0-814></a>            <span class=n>Text</span><span class=o>.</span><span class=n>assemble</span><span class=p>(</span>
</span><span id=__span-0-815><a id=__codelineno-0-815 name=__codelineno-0-815></a>                <span class=p>(</span><span class=s2>&quot;Run this agent locally:</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>,</span> <span class=s2>&quot;light_green&quot;</span><span class=p>),</span>
</span><span id=__span-0-816><a id=__codelineno-0-816 name=__codelineno-0-816></a>                <span class=p>(</span><span class=sa>f</span><span class=s2>&quot;  nearai agent interactive </span><span class=si>{</span><span class=n>agent_path</span><span class=si>}</span><span class=s2> --local</span><span class=se>\n\n</span><span class=s2>&quot;</span><span class=p>,</span> <span class=s2>&quot;bold&quot;</span><span class=p>),</span>
</span><span id=__span-0-817><a id=__codelineno-0-817 name=__codelineno-0-817></a>                <span class=p>(</span><span class=s2>&quot;Upload this agent to NEAR AI&#39;s public registry:</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>,</span> <span class=s2>&quot;light_green&quot;</span><span class=p>),</span>
</span><span id=__span-0-818><a id=__codelineno-0-818 name=__codelineno-0-818></a>                <span class=p>(</span><span class=sa>f</span><span class=s2>&quot;  nearai registry upload </span><span class=si>{</span><span class=n>agent_path</span><span class=si>}</span><span class=se>\n\n</span><span class=s2>&quot;</span><span class=p>,</span> <span class=s2>&quot;bold&quot;</span><span class=p>),</span>
</span><span id=__span-0-819><a id=__codelineno-0-819 name=__codelineno-0-819></a>                <span class=p>(</span><span class=s2>&quot;Run ANY agent from your local registry:</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>,</span> <span class=s2>&quot;light_green&quot;</span><span class=p>),</span>
</span><span id=__span-0-820><a id=__codelineno-0-820 name=__codelineno-0-820></a>                <span class=p>(</span><span class=s2>&quot;  nearai agent interactive --local&quot;</span><span class=p>,</span> <span class=s2>&quot;bold&quot;</span><span class=p>),</span>
</span><span id=__span-0-821><a id=__codelineno-0-821 name=__codelineno-0-821></a>            <span class=p>),</span>
</span><span id=__span-0-822><a id=__codelineno-0-822 name=__codelineno-0-822></a>            <span class=n>title</span><span class=o>=</span><span class=s2>&quot;Useful Commands&quot;</span><span class=p>,</span>
</span><span id=__span-0-823><a id=__codelineno-0-823 name=__codelineno-0-823></a>            <span class=n>border_style</span><span class=o>=</span><span class=s2>&quot;green&quot;</span><span class=p>,</span>
</span><span id=__span-0-824><a id=__codelineno-0-824 name=__codelineno-0-824></a>        <span class=p>)</span>
</span><span id=__span-0-825><a id=__codelineno-0-825 name=__codelineno-0-825></a>
</span><span id=__span-0-826><a id=__codelineno-0-826 name=__codelineno-0-826></a>        <span class=n>console</span><span class=o>.</span><span class=n>print</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-827><a id=__codelineno-0-827 name=__codelineno-0-827></a>        <span class=n>console</span><span class=o>.</span><span class=n>print</span><span class=p>(</span><span class=n>success_title</span><span class=p>)</span>
</span><span id=__span-0-828><a id=__codelineno-0-828 name=__codelineno-0-828></a>        <span class=n>console</span><span class=o>.</span><span class=n>print</span><span class=p>(</span><span class=n>path_text</span><span class=p>)</span>
</span><span id=__span-0-829><a id=__codelineno-0-829 name=__codelineno-0-829></a>        <span class=n>console</span><span class=o>.</span><span class=n>print</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-830><a id=__codelineno-0-830 name=__codelineno-0-830></a>        <span class=n>console</span><span class=o>.</span><span class=n>print</span><span class=p>(</span><span class=n>files_panel</span><span class=p>)</span>
</span><span id=__span-0-831><a id=__codelineno-0-831 name=__codelineno-0-831></a>        <span class=n>console</span><span class=o>.</span><span class=n>print</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-832><a id=__codelineno-0-832 name=__codelineno-0-832></a>        <span class=n>console</span><span class=o>.</span><span class=n>print</span><span class=p>(</span><span class=n>commands_panel</span><span class=p>)</span>
</span><span id=__span-0-833><a id=__codelineno-0-833 name=__codelineno-0-833></a>        <span class=n>console</span><span class=o>.</span><span class=n>print</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-834><a id=__codelineno-0-834 name=__codelineno-0-834></a>
</span><span id=__span-0-835><a id=__codelineno-0-835 name=__codelineno-0-835></a>    <span class=k>def</span><span class=w> </span><span class=nf>_fork_agent</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>fork</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>namespace</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>new_name</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-836><a id=__codelineno-0-836 name=__codelineno-0-836></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Fork an existing agent.&quot;&quot;&quot;</span>
</span><span id=__span-0-837><a id=__codelineno-0-837 name=__codelineno-0-837></a>        <span class=kn>import</span><span class=w> </span><span class=nn>shutil</span>
</span><span id=__span-0-838><a id=__codelineno-0-838 name=__codelineno-0-838></a>
</span><span id=__span-0-839><a id=__codelineno-0-839 name=__codelineno-0-839></a>        <span class=c1># Parse the fork parameter</span>
</span><span id=__span-0-840><a id=__codelineno-0-840 name=__codelineno-0-840></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-841><a id=__codelineno-0-841 name=__codelineno-0-841></a>            <span class=n>entry_location</span> <span class=o>=</span> <span class=n>parse_location</span><span class=p>(</span><span class=n>fork</span><span class=p>)</span>
</span><span id=__span-0-842><a id=__codelineno-0-842 name=__codelineno-0-842></a>            <span class=n>fork_namespace</span> <span class=o>=</span> <span class=n>entry_location</span><span class=o>.</span><span class=n>namespace</span>
</span><span id=__span-0-843><a id=__codelineno-0-843 name=__codelineno-0-843></a>            <span class=n>fork_name</span> <span class=o>=</span> <span class=n>entry_location</span><span class=o>.</span><span class=n>name</span>
</span><span id=__span-0-844><a id=__codelineno-0-844 name=__codelineno-0-844></a>            <span class=n>fork_version</span> <span class=o>=</span> <span class=n>entry_location</span><span class=o>.</span><span class=n>version</span>
</span><span id=__span-0-845><a id=__codelineno-0-845 name=__codelineno-0-845></a>        <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
</span><span id=__span-0-846><a id=__codelineno-0-846 name=__codelineno-0-846></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Invalid fork parameter format. Expected format: &lt;namespace&gt;/&lt;agent-name&gt;/&lt;version&gt;&quot;</span><span class=p>)</span>
</span><span id=__span-0-847><a id=__codelineno-0-847 name=__codelineno-0-847></a>            <span class=k>return</span>
</span><span id=__span-0-848><a id=__codelineno-0-848 name=__codelineno-0-848></a>
</span><span id=__span-0-849><a id=__codelineno-0-849 name=__codelineno-0-849></a>        <span class=c1># Download the agent from the registry</span>
</span><span id=__span-0-850><a id=__codelineno-0-850 name=__codelineno-0-850></a>        <span class=n>agent_location</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>fork_namespace</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>fork_name</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>fork_version</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-851><a id=__codelineno-0-851 name=__codelineno-0-851></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Downloading agent &#39;</span><span class=si>{</span><span class=n>agent_location</span><span class=si>}</span><span class=s2>&#39;...&quot;</span><span class=p>)</span>
</span><span id=__span-0-852><a id=__codelineno-0-852 name=__codelineno-0-852></a>        <span class=n>registry</span><span class=o>.</span><span class=n>download</span><span class=p>(</span><span class=n>agent_location</span><span class=p>,</span> <span class=n>force</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>show_progress</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-853><a id=__codelineno-0-853 name=__codelineno-0-853></a>        <span class=n>source_path</span> <span class=o>=</span> <span class=n>get_registry_folder</span><span class=p>()</span> <span class=o>/</span> <span class=n>fork_namespace</span> <span class=o>/</span> <span class=n>fork_name</span> <span class=o>/</span> <span class=n>fork_version</span>
</span><span id=__span-0-854><a id=__codelineno-0-854 name=__codelineno-0-854></a>
</span><span id=__span-0-855><a id=__codelineno-0-855 name=__codelineno-0-855></a>        <span class=c1># Prompt for the new agent name if not provided</span>
</span><span id=__span-0-856><a id=__codelineno-0-856 name=__codelineno-0-856></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>new_name</span><span class=p>:</span>
</span><span id=__span-0-857><a id=__codelineno-0-857 name=__codelineno-0-857></a>            <span class=n>new_name</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=s2>&quot;Enter the new agent name: &quot;</span><span class=p>)</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span><span id=__span-0-858><a id=__codelineno-0-858 name=__codelineno-0-858></a>            <span class=k>if</span> <span class=ow>not</span> <span class=n>new_name</span><span class=p>:</span>
</span><span id=__span-0-859><a id=__codelineno-0-859 name=__codelineno-0-859></a>                <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Agent name cannot be empty.&quot;</span><span class=p>)</span>
</span><span id=__span-0-860><a id=__codelineno-0-860 name=__codelineno-0-860></a>                <span class=k>return</span>
</span><span id=__span-0-861><a id=__codelineno-0-861 name=__codelineno-0-861></a>
</span><span id=__span-0-862><a id=__codelineno-0-862 name=__codelineno-0-862></a>            <span class=c1># confirm pattern is ok</span>
</span><span id=__span-0-863><a id=__codelineno-0-863 name=__codelineno-0-863></a>            <span class=n>identifier_pattern</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=sa>r</span><span class=s2>&quot;^[a-zA-Z0-9_\-.]+$&quot;</span><span class=p>)</span>
</span><span id=__span-0-864><a id=__codelineno-0-864 name=__codelineno-0-864></a>            <span class=k>if</span> <span class=n>identifier_pattern</span><span class=o>.</span><span class=n>match</span><span class=p>(</span><span class=n>new_name</span><span class=p>)</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-865><a id=__codelineno-0-865 name=__codelineno-0-865></a>                <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Invalid Name, please choose something different&quot;</span><span class=p>)</span>
</span><span id=__span-0-866><a id=__codelineno-0-866 name=__codelineno-0-866></a>                <span class=k>return</span>
</span><span id=__span-0-867><a id=__codelineno-0-867 name=__codelineno-0-867></a>
</span><span id=__span-0-868><a id=__codelineno-0-868 name=__codelineno-0-868></a>        <span class=c1># Set the destination path</span>
</span><span id=__span-0-869><a id=__codelineno-0-869 name=__codelineno-0-869></a>        <span class=n>dest_path</span> <span class=o>=</span> <span class=n>get_registry_folder</span><span class=p>()</span> <span class=o>/</span> <span class=n>namespace</span> <span class=o>/</span> <span class=n>new_name</span> <span class=o>/</span> <span class=s2>&quot;0.0.1&quot;</span>
</span><span id=__span-0-870><a id=__codelineno-0-870 name=__codelineno-0-870></a>
</span><span id=__span-0-871><a id=__codelineno-0-871 name=__codelineno-0-871></a>        <span class=c1># Copy the agent files</span>
</span><span id=__span-0-872><a id=__codelineno-0-872 name=__codelineno-0-872></a>        <span class=n>shutil</span><span class=o>.</span><span class=n>copytree</span><span class=p>(</span><span class=n>source_path</span><span class=p>,</span> <span class=n>dest_path</span><span class=p>)</span>
</span><span id=__span-0-873><a id=__codelineno-0-873 name=__codelineno-0-873></a>
</span><span id=__span-0-874><a id=__codelineno-0-874 name=__codelineno-0-874></a>        <span class=c1># Update metadata.json</span>
</span><span id=__span-0-875><a id=__codelineno-0-875 name=__codelineno-0-875></a>        <span class=n>metadata_path</span> <span class=o>=</span> <span class=n>dest_path</span> <span class=o>/</span> <span class=s2>&quot;metadata.json&quot;</span>
</span><span id=__span-0-876><a id=__codelineno-0-876 name=__codelineno-0-876></a>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>metadata_path</span><span class=p>,</span> <span class=s2>&quot;r&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>file</span><span class=p>:</span>
</span><span id=__span-0-877><a id=__codelineno-0-877 name=__codelineno-0-877></a>            <span class=n>metadata</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>file</span><span class=p>)</span>
</span><span id=__span-0-878><a id=__codelineno-0-878 name=__codelineno-0-878></a>
</span><span id=__span-0-879><a id=__codelineno-0-879 name=__codelineno-0-879></a>        <span class=n>metadata</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>new_name</span>
</span><span id=__span-0-880><a id=__codelineno-0-880 name=__codelineno-0-880></a>        <span class=n>metadata</span><span class=p>[</span><span class=s2>&quot;version&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;0.0.1&quot;</span>
</span><span id=__span-0-881><a id=__codelineno-0-881 name=__codelineno-0-881></a>
</span><span id=__span-0-882><a id=__codelineno-0-882 name=__codelineno-0-882></a>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>metadata_path</span><span class=p>,</span> <span class=s2>&quot;w&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>file</span><span class=p>:</span>
</span><span id=__span-0-883><a id=__codelineno-0-883 name=__codelineno-0-883></a>            <span class=n>json</span><span class=o>.</span><span class=n>dump</span><span class=p>(</span><span class=n>metadata</span><span class=p>,</span> <span class=n>file</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</span><span id=__span-0-884><a id=__codelineno-0-884 name=__codelineno-0-884></a>
</span><span id=__span-0-885><a id=__codelineno-0-885 name=__codelineno-0-885></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>Forked agent &#39;</span><span class=si>{</span><span class=n>agent_location</span><span class=si>}</span><span class=s2>&#39; to &#39;</span><span class=si>{</span><span class=n>dest_path</span><span class=si>}</span><span class=s2>&#39;&quot;</span><span class=p>)</span>
</span><span id=__span-0-886><a id=__codelineno-0-886 name=__codelineno-0-886></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Agent &#39;</span><span class=si>{</span><span class=n>new_name</span><span class=si>}</span><span class=s2>&#39; created at &#39;</span><span class=si>{</span><span class=n>dest_path</span><span class=si>}</span><span class=s2>&#39; with updated metadata.&quot;</span><span class=p>)</span>
</span><span id=__span-0-887><a id=__codelineno-0-887 name=__codelineno-0-887></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>Useful commands:&quot;</span><span class=p>)</span>
</span><span id=__span-0-888><a id=__codelineno-0-888 name=__codelineno-0-888></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;  &gt; nearai agent interactive </span><span class=si>{</span><span class=n>new_name</span><span class=si>}</span><span class=s2> --local&quot;</span><span class=p>)</span>
</span><span id=__span-0-889><a id=__codelineno-0-889 name=__codelineno-0-889></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;  &gt; nearai registry upload </span><span class=si>{</span><span class=n>dest_path</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-890><a id=__codelineno-0-890 name=__codelineno-0-890></a>
</span><span id=__span-0-891><a id=__codelineno-0-891 name=__codelineno-0-891></a>    <span class=k>def</span><span class=w> </span><span class=nf>_prompt_agent_details</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]:</span>
</span><span id=__span-0-892><a id=__codelineno-0-892 name=__codelineno-0-892></a>        <span class=n>console</span> <span class=o>=</span> <span class=n>Console</span><span class=p>()</span>
</span><span id=__span-0-893><a id=__codelineno-0-893 name=__codelineno-0-893></a>
</span><span id=__span-0-894><a id=__codelineno-0-894 name=__codelineno-0-894></a>        <span class=c1># Get namespace from CONFIG, with null check</span>
</span><span id=__span-0-895><a id=__codelineno-0-895 name=__codelineno-0-895></a>        <span class=k>if</span> <span class=n>CONFIG</span><span class=o>.</span><span class=n>auth</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-896><a id=__codelineno-0-896 name=__codelineno-0-896></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Not logged in. Please run &#39;nearai login&#39; first.&quot;</span><span class=p>)</span>
</span><span id=__span-0-897><a id=__codelineno-0-897 name=__codelineno-0-897></a>        <span class=n>namespace</span> <span class=o>=</span> <span class=n>CONFIG</span><span class=o>.</span><span class=n>auth</span><span class=o>.</span><span class=n>namespace</span>
</span><span id=__span-0-898><a id=__codelineno-0-898 name=__codelineno-0-898></a>
</span><span id=__span-0-899><a id=__codelineno-0-899 name=__codelineno-0-899></a>        <span class=c1># Welcome message</span>
</span><span id=__span-0-900><a id=__codelineno-0-900 name=__codelineno-0-900></a>        <span class=n>console</span><span class=o>.</span><span class=n>print</span><span class=p>(</span><span class=n>NEAR_AI_BANNER</span><span class=p>)</span>
</span><span id=__span-0-901><a id=__codelineno-0-901 name=__codelineno-0-901></a>        <span class=n>welcome_panel</span> <span class=o>=</span> <span class=n>Panel</span><span class=p>(</span>
</span><span id=__span-0-902><a id=__codelineno-0-902 name=__codelineno-0-902></a>            <span class=n>Text</span><span class=o>.</span><span class=n>assemble</span><span class=p>(</span>
</span><span id=__span-0-903><a id=__codelineno-0-903 name=__codelineno-0-903></a>                <span class=p>(</span><span class=s2>&quot;Let&#39;s create a new agent! 🦾 </span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>,</span> <span class=s2>&quot;bold green&quot;</span><span class=p>),</span>
</span><span id=__span-0-904><a id=__codelineno-0-904 name=__codelineno-0-904></a>                <span class=p>(</span><span class=s2>&quot;We&#39;ll need some basic information to get started.&quot;</span><span class=p>,</span> <span class=s2>&quot;dim&quot;</span><span class=p>),</span>
</span><span id=__span-0-905><a id=__codelineno-0-905 name=__codelineno-0-905></a>            <span class=p>),</span>
</span><span id=__span-0-906><a id=__codelineno-0-906 name=__codelineno-0-906></a>            <span class=n>title</span><span class=o>=</span><span class=s2>&quot;Agent Creator&quot;</span><span class=p>,</span>
</span><span id=__span-0-907><a id=__codelineno-0-907 name=__codelineno-0-907></a>            <span class=n>border_style</span><span class=o>=</span><span class=s2>&quot;green&quot;</span><span class=p>,</span>
</span><span id=__span-0-908><a id=__codelineno-0-908 name=__codelineno-0-908></a>        <span class=p>)</span>
</span><span id=__span-0-909><a id=__codelineno-0-909 name=__codelineno-0-909></a>        <span class=n>console</span><span class=o>.</span><span class=n>print</span><span class=p>(</span><span class=n>welcome_panel</span><span class=p>)</span>
</span><span id=__span-0-910><a id=__codelineno-0-910 name=__codelineno-0-910></a>        <span class=n>console</span><span class=o>.</span><span class=n>print</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-911><a id=__codelineno-0-911 name=__codelineno-0-911></a>
</span><span id=__span-0-912><a id=__codelineno-0-912 name=__codelineno-0-912></a>        <span class=c1># Name prompt with explanation</span>
</span><span id=__span-0-913><a id=__codelineno-0-913 name=__codelineno-0-913></a>        <span class=n>name_info</span> <span class=o>=</span> <span class=n>Panel</span><span class=p>(</span>
</span><span id=__span-0-914><a id=__codelineno-0-914 name=__codelineno-0-914></a>            <span class=n>Text</span><span class=o>.</span><span class=n>assemble</span><span class=p>(</span>
</span><span id=__span-0-915><a id=__codelineno-0-915 name=__codelineno-0-915></a>                <span class=p>(</span><span class=s2>&quot;Choose a unique name for your agent using only:</span><span class=se>\n\n</span><span class=s2>&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>),</span>
</span><span id=__span-0-916><a id=__codelineno-0-916 name=__codelineno-0-916></a>                <span class=p>(</span><span class=s2>&quot;• letters</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>,</span> <span class=s2>&quot;dim&quot;</span><span class=p>),</span>
</span><span id=__span-0-917><a id=__codelineno-0-917 name=__codelineno-0-917></a>                <span class=p>(</span><span class=s2>&quot;• numbers</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>,</span> <span class=s2>&quot;dim&quot;</span><span class=p>),</span>
</span><span id=__span-0-918><a id=__codelineno-0-918 name=__codelineno-0-918></a>                <span class=p>(</span><span class=s2>&quot;• dots (.)</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>,</span> <span class=s2>&quot;dim&quot;</span><span class=p>),</span>
</span><span id=__span-0-919><a id=__codelineno-0-919 name=__codelineno-0-919></a>                <span class=p>(</span><span class=s2>&quot;• hyphens (-)</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>,</span> <span class=s2>&quot;dim&quot;</span><span class=p>),</span>
</span><span id=__span-0-920><a id=__codelineno-0-920 name=__codelineno-0-920></a>                <span class=p>(</span><span class=s2>&quot;• underscores (_)</span><span class=se>\n\n</span><span class=s2>&quot;</span><span class=p>,</span> <span class=s2>&quot;dim&quot;</span><span class=p>),</span>
</span><span id=__span-0-921><a id=__codelineno-0-921 name=__codelineno-0-921></a>                <span class=p>(</span><span class=s2>&quot;Examples: &#39;code-reviewer&#39;, &#39;data.analyzer&#39;, &#39;text_summarizer&#39;&quot;</span><span class=p>,</span> <span class=s2>&quot;green&quot;</span><span class=p>),</span>
</span><span id=__span-0-922><a id=__codelineno-0-922 name=__codelineno-0-922></a>            <span class=p>),</span>
</span><span id=__span-0-923><a id=__codelineno-0-923 name=__codelineno-0-923></a>            <span class=n>title</span><span class=o>=</span><span class=s2>&quot;Agent Name Rules&quot;</span><span class=p>,</span>
</span><span id=__span-0-924><a id=__codelineno-0-924 name=__codelineno-0-924></a>            <span class=n>border_style</span><span class=o>=</span><span class=s2>&quot;blue&quot;</span><span class=p>,</span>
</span><span id=__span-0-925><a id=__codelineno-0-925 name=__codelineno-0-925></a>        <span class=p>)</span>
</span><span id=__span-0-926><a id=__codelineno-0-926 name=__codelineno-0-926></a>        <span class=n>console</span><span class=o>.</span><span class=n>print</span><span class=p>(</span><span class=n>name_info</span><span class=p>)</span>
</span><span id=__span-0-927><a id=__codelineno-0-927 name=__codelineno-0-927></a>
</span><span id=__span-0-928><a id=__codelineno-0-928 name=__codelineno-0-928></a>        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span><span id=__span-0-929><a id=__codelineno-0-929 name=__codelineno-0-929></a>            <span class=n>name</span> <span class=o>=</span> <span class=n>Prompt</span><span class=o>.</span><span class=n>ask</span><span class=p>(</span><span class=s2>&quot;[bold blue]Enter agent name&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span><span id=__span-0-930><a id=__codelineno-0-930 name=__codelineno-0-930></a>            <span class=c1># Validate name format</span>
</span><span id=__span-0-931><a id=__codelineno-0-931 name=__codelineno-0-931></a>            <span class=k>if</span> <span class=ow>not</span> <span class=n>re</span><span class=o>.</span><span class=n>match</span><span class=p>(</span><span class=sa>r</span><span class=s2>&quot;^[a-zA-Z0-9][a-zA-Z0-9._-]*$&quot;</span><span class=p>,</span> <span class=n>name</span><span class=p>):</span>
</span><span id=__span-0-932><a id=__codelineno-0-932 name=__codelineno-0-932></a>                <span class=n>console</span><span class=o>.</span><span class=n>print</span><span class=p>(</span>
</span><span id=__span-0-933><a id=__codelineno-0-933 name=__codelineno-0-933></a>                    <span class=s2>&quot;[red]❌ Invalid name format. &quot;</span> <span class=s2>&quot;Please use only letters, numbers, dots, hyphens, or underscores.&quot;</span>
</span><span id=__span-0-934><a id=__codelineno-0-934 name=__codelineno-0-934></a>                <span class=p>)</span>
</span><span id=__span-0-935><a id=__codelineno-0-935 name=__codelineno-0-935></a>                <span class=k>continue</span>
</span><span id=__span-0-936><a id=__codelineno-0-936 name=__codelineno-0-936></a>            <span class=k>if</span> <span class=s2>&quot; &quot;</span> <span class=ow>in</span> <span class=n>name</span><span class=p>:</span>
</span><span id=__span-0-937><a id=__codelineno-0-937 name=__codelineno-0-937></a>                <span class=n>console</span><span class=o>.</span><span class=n>print</span><span class=p>(</span><span class=s2>&quot;[red]❌ Spaces are not allowed. Use dots, hyphens, or underscores instead.&quot;</span><span class=p>)</span>
</span><span id=__span-0-938><a id=__codelineno-0-938 name=__codelineno-0-938></a>                <span class=k>continue</span>
</span><span id=__span-0-939><a id=__codelineno-0-939 name=__codelineno-0-939></a>            <span class=k>break</span>
</span><span id=__span-0-940><a id=__codelineno-0-940 name=__codelineno-0-940></a>
</span><span id=__span-0-941><a id=__codelineno-0-941 name=__codelineno-0-941></a>        <span class=n>console</span><span class=o>.</span><span class=n>print</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-942><a id=__codelineno-0-942 name=__codelineno-0-942></a>
</span><span id=__span-0-943><a id=__codelineno-0-943 name=__codelineno-0-943></a>        <span class=c1># Description prompt</span>
</span><span id=__span-0-944><a id=__codelineno-0-944 name=__codelineno-0-944></a>        <span class=n>description_info</span> <span class=o>=</span> <span class=n>Panel</span><span class=p>(</span>
</span><span id=__span-0-945><a id=__codelineno-0-945 name=__codelineno-0-945></a>            <span class=s2>&quot;Describe what your agent will do in a few words...&quot;</span><span class=p>,</span> <span class=n>title</span><span class=o>=</span><span class=s2>&quot;Description Info&quot;</span><span class=p>,</span> <span class=n>border_style</span><span class=o>=</span><span class=s2>&quot;blue&quot;</span>
</span><span id=__span-0-946><a id=__codelineno-0-946 name=__codelineno-0-946></a>        <span class=p>)</span>
</span><span id=__span-0-947><a id=__codelineno-0-947 name=__codelineno-0-947></a>        <span class=n>console</span><span class=o>.</span><span class=n>print</span><span class=p>(</span><span class=n>description_info</span><span class=p>)</span>
</span><span id=__span-0-948><a id=__codelineno-0-948 name=__codelineno-0-948></a>        <span class=n>description</span> <span class=o>=</span> <span class=n>Prompt</span><span class=o>.</span><span class=n>ask</span><span class=p>(</span><span class=s2>&quot;[bold blue]Enter description&quot;</span><span class=p>)</span>
</span><span id=__span-0-949><a id=__codelineno-0-949 name=__codelineno-0-949></a>
</span><span id=__span-0-950><a id=__codelineno-0-950 name=__codelineno-0-950></a>        <span class=n>console</span><span class=o>.</span><span class=n>print</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-951><a id=__codelineno-0-951 name=__codelineno-0-951></a>
</span><span id=__span-0-952><a id=__codelineno-0-952 name=__codelineno-0-952></a>        <span class=c1># Initial instructions prompt</span>
</span><span id=__span-0-953><a id=__codelineno-0-953 name=__codelineno-0-953></a>        <span class=n>init_instructions_info</span> <span class=o>=</span> <span class=n>Panel</span><span class=p>(</span>
</span><span id=__span-0-954><a id=__codelineno-0-954 name=__codelineno-0-954></a>            <span class=n>Text</span><span class=o>.</span><span class=n>assemble</span><span class=p>(</span>
</span><span id=__span-0-955><a id=__codelineno-0-955 name=__codelineno-0-955></a>                <span class=p>(</span><span class=s2>&quot;Provide initial instructions for your AI agent...</span><span class=se>\n\n</span><span class=s2>&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>),</span>
</span><span id=__span-0-956><a id=__codelineno-0-956 name=__codelineno-0-956></a>                <span class=p>(</span><span class=s2>&quot;This will be used as the system message to guide the agent&#39;s behavior.</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>,</span> <span class=s2>&quot;dim&quot;</span><span class=p>),</span>
</span><span id=__span-0-957><a id=__codelineno-0-957 name=__codelineno-0-957></a>                <span class=p>(</span><span class=s2>&quot;You can edit these instructions later in the `agent.py` file.</span><span class=se>\n\n</span><span class=s2>&quot;</span><span class=p>,</span> <span class=s2>&quot;dim&quot;</span><span class=p>),</span>
</span><span id=__span-0-958><a id=__codelineno-0-958 name=__codelineno-0-958></a>                <span class=p>(</span>
</span><span id=__span-0-959><a id=__codelineno-0-959 name=__codelineno-0-959></a>                    <span class=s2>&quot;Example: You are a helpful humorous assistant. Use puns or jokes to make the user smile.&quot;</span><span class=p>,</span>
</span><span id=__span-0-960><a id=__codelineno-0-960 name=__codelineno-0-960></a>                    <span class=s2>&quot;green&quot;</span><span class=p>,</span>
</span><span id=__span-0-961><a id=__codelineno-0-961 name=__codelineno-0-961></a>                <span class=p>),</span>
</span><span id=__span-0-962><a id=__codelineno-0-962 name=__codelineno-0-962></a>            <span class=p>),</span>
</span><span id=__span-0-963><a id=__codelineno-0-963 name=__codelineno-0-963></a>            <span class=n>title</span><span class=o>=</span><span class=s2>&quot;Instructions&quot;</span><span class=p>,</span>
</span><span id=__span-0-964><a id=__codelineno-0-964 name=__codelineno-0-964></a>            <span class=n>border_style</span><span class=o>=</span><span class=s2>&quot;blue&quot;</span><span class=p>,</span>
</span><span id=__span-0-965><a id=__codelineno-0-965 name=__codelineno-0-965></a>        <span class=p>)</span>
</span><span id=__span-0-966><a id=__codelineno-0-966 name=__codelineno-0-966></a>        <span class=n>console</span><span class=o>.</span><span class=n>print</span><span class=p>(</span><span class=n>init_instructions_info</span><span class=p>)</span>
</span><span id=__span-0-967><a id=__codelineno-0-967 name=__codelineno-0-967></a>        <span class=n>init_instructions</span> <span class=o>=</span> <span class=n>Prompt</span><span class=o>.</span><span class=n>ask</span><span class=p>(</span><span class=s2>&quot;[bold blue]Enter instructions&quot;</span><span class=p>)</span>
</span><span id=__span-0-968><a id=__codelineno-0-968 name=__codelineno-0-968></a>
</span><span id=__span-0-969><a id=__codelineno-0-969 name=__codelineno-0-969></a>        <span class=c1># Confirmation</span>
</span><span id=__span-0-970><a id=__codelineno-0-970 name=__codelineno-0-970></a>        <span class=n>console</span><span class=o>.</span><span class=n>print</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-971><a id=__codelineno-0-971 name=__codelineno-0-971></a>        <span class=n>summary_panel</span> <span class=o>=</span> <span class=n>Panel</span><span class=p>(</span>
</span><span id=__span-0-972><a id=__codelineno-0-972 name=__codelineno-0-972></a>            <span class=n>Text</span><span class=o>.</span><span class=n>assemble</span><span class=p>(</span>
</span><span id=__span-0-973><a id=__codelineno-0-973 name=__codelineno-0-973></a>                <span class=p>(</span><span class=s2>&quot;Summary of your new agent:</span><span class=se>\n\n</span><span class=s2>&quot;</span><span class=p>,</span> <span class=s2>&quot;bold&quot;</span><span class=p>),</span>
</span><span id=__span-0-974><a id=__codelineno-0-974 name=__codelineno-0-974></a>                <span class=p>(</span><span class=s2>&quot;Namespace/Account:    &quot;</span><span class=p>,</span> <span class=s2>&quot;dim&quot;</span><span class=p>),</span>
</span><span id=__span-0-975><a id=__codelineno-0-975 name=__codelineno-0-975></a>                <span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>namespace</span><span class=si>}</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>,</span> <span class=s2>&quot;green&quot;</span><span class=p>),</span>
</span><span id=__span-0-976><a id=__codelineno-0-976 name=__codelineno-0-976></a>                <span class=p>(</span><span class=s2>&quot;Agent Name:           &quot;</span><span class=p>,</span> <span class=s2>&quot;dim&quot;</span><span class=p>),</span>
</span><span id=__span-0-977><a id=__codelineno-0-977 name=__codelineno-0-977></a>                <span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>,</span> <span class=s2>&quot;green&quot;</span><span class=p>),</span>
</span><span id=__span-0-978><a id=__codelineno-0-978 name=__codelineno-0-978></a>                <span class=p>(</span><span class=s2>&quot;Description:          &quot;</span><span class=p>,</span> <span class=s2>&quot;dim&quot;</span><span class=p>),</span>
</span><span id=__span-0-979><a id=__codelineno-0-979 name=__codelineno-0-979></a>                <span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>description</span><span class=si>}</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>,</span> <span class=s2>&quot;green&quot;</span><span class=p>),</span>
</span><span id=__span-0-980><a id=__codelineno-0-980 name=__codelineno-0-980></a>                <span class=p>(</span><span class=s2>&quot;Instructions:         &quot;</span><span class=p>,</span> <span class=s2>&quot;dim&quot;</span><span class=p>),</span>
</span><span id=__span-0-981><a id=__codelineno-0-981 name=__codelineno-0-981></a>                <span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>init_instructions</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span> <span class=s2>&quot;green&quot;</span><span class=p>),</span>
</span><span id=__span-0-982><a id=__codelineno-0-982 name=__codelineno-0-982></a>            <span class=p>),</span>
</span><span id=__span-0-983><a id=__codelineno-0-983 name=__codelineno-0-983></a>            <span class=n>title</span><span class=o>=</span><span class=s2>&quot;📋 Review&quot;</span><span class=p>,</span>
</span><span id=__span-0-984><a id=__codelineno-0-984 name=__codelineno-0-984></a>            <span class=n>border_style</span><span class=o>=</span><span class=s2>&quot;green&quot;</span><span class=p>,</span>
</span><span id=__span-0-985><a id=__codelineno-0-985 name=__codelineno-0-985></a>        <span class=p>)</span>
</span><span id=__span-0-986><a id=__codelineno-0-986 name=__codelineno-0-986></a>        <span class=n>console</span><span class=o>.</span><span class=n>print</span><span class=p>(</span><span class=n>summary_panel</span><span class=p>)</span>
</span><span id=__span-0-987><a id=__codelineno-0-987 name=__codelineno-0-987></a>        <span class=n>console</span><span class=o>.</span><span class=n>print</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-988><a id=__codelineno-0-988 name=__codelineno-0-988></a>
</span><span id=__span-0-989><a id=__codelineno-0-989 name=__codelineno-0-989></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>Confirm</span><span class=o>.</span><span class=n>ask</span><span class=p>(</span><span class=s2>&quot;[bold]Would you like to proceed?&quot;</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=kc>True</span><span class=p>):</span>
</span><span id=__span-0-990><a id=__codelineno-0-990 name=__codelineno-0-990></a>            <span class=n>console</span><span class=o>.</span><span class=n>print</span><span class=p>(</span><span class=s2>&quot;[red]❌ Agent creation cancelled&quot;</span><span class=p>)</span>
</span><span id=__span-0-991><a id=__codelineno-0-991 name=__codelineno-0-991></a>            <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span><span id=__span-0-992><a id=__codelineno-0-992 name=__codelineno-0-992></a>        <span class=k>return</span> <span class=n>namespace</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>description</span><span class=p>,</span> <span class=n>init_instructions</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h5 id=nearai.cli.AgentCli._create_new_agent class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">_create_new_agent</span> <a href=#nearai.cli.AgentCli._create_new_agent class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>_create_new_agent</span><span class=p>(</span><span class=n>namespace</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>name</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>str</span><span class=p>],</span> <span class=n>description</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>str</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Create a new agent from scratch.</p> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-733>733</a></span>
<span class=normal><a href=#__codelineno-0-734>734</a></span>
<span class=normal><a href=#__codelineno-0-735>735</a></span>
<span class=normal><a href=#__codelineno-0-736>736</a></span>
<span class=normal><a href=#__codelineno-0-737>737</a></span>
<span class=normal><a href=#__codelineno-0-738>738</a></span>
<span class=normal><a href=#__codelineno-0-739>739</a></span>
<span class=normal><a href=#__codelineno-0-740>740</a></span>
<span class=normal><a href=#__codelineno-0-741>741</a></span>
<span class=normal><a href=#__codelineno-0-742>742</a></span>
<span class=normal><a href=#__codelineno-0-743>743</a></span>
<span class=normal><a href=#__codelineno-0-744>744</a></span>
<span class=normal><a href=#__codelineno-0-745>745</a></span>
<span class=normal><a href=#__codelineno-0-746>746</a></span>
<span class=normal><a href=#__codelineno-0-747>747</a></span>
<span class=normal><a href=#__codelineno-0-748>748</a></span>
<span class=normal><a href=#__codelineno-0-749>749</a></span>
<span class=normal><a href=#__codelineno-0-750>750</a></span>
<span class=normal><a href=#__codelineno-0-751>751</a></span>
<span class=normal><a href=#__codelineno-0-752>752</a></span>
<span class=normal><a href=#__codelineno-0-753>753</a></span>
<span class=normal><a href=#__codelineno-0-754>754</a></span>
<span class=normal><a href=#__codelineno-0-755>755</a></span>
<span class=normal><a href=#__codelineno-0-756>756</a></span>
<span class=normal><a href=#__codelineno-0-757>757</a></span>
<span class=normal><a href=#__codelineno-0-758>758</a></span>
<span class=normal><a href=#__codelineno-0-759>759</a></span>
<span class=normal><a href=#__codelineno-0-760>760</a></span>
<span class=normal><a href=#__codelineno-0-761>761</a></span>
<span class=normal><a href=#__codelineno-0-762>762</a></span>
<span class=normal><a href=#__codelineno-0-763>763</a></span>
<span class=normal><a href=#__codelineno-0-764>764</a></span>
<span class=normal><a href=#__codelineno-0-765>765</a></span>
<span class=normal><a href=#__codelineno-0-766>766</a></span>
<span class=normal><a href=#__codelineno-0-767>767</a></span>
<span class=normal><a href=#__codelineno-0-768>768</a></span>
<span class=normal><a href=#__codelineno-0-769>769</a></span>
<span class=normal><a href=#__codelineno-0-770>770</a></span>
<span class=normal><a href=#__codelineno-0-771>771</a></span>
<span class=normal><a href=#__codelineno-0-772>772</a></span>
<span class=normal><a href=#__codelineno-0-773>773</a></span>
<span class=normal><a href=#__codelineno-0-774>774</a></span>
<span class=normal><a href=#__codelineno-0-775>775</a></span>
<span class=normal><a href=#__codelineno-0-776>776</a></span>
<span class=normal><a href=#__codelineno-0-777>777</a></span>
<span class=normal><a href=#__codelineno-0-778>778</a></span>
<span class=normal><a href=#__codelineno-0-779>779</a></span>
<span class=normal><a href=#__codelineno-0-780>780</a></span>
<span class=normal><a href=#__codelineno-0-781>781</a></span>
<span class=normal><a href=#__codelineno-0-782>782</a></span>
<span class=normal><a href=#__codelineno-0-783>783</a></span>
<span class=normal><a href=#__codelineno-0-784>784</a></span>
<span class=normal><a href=#__codelineno-0-785>785</a></span>
<span class=normal><a href=#__codelineno-0-786>786</a></span>
<span class=normal><a href=#__codelineno-0-787>787</a></span>
<span class=normal><a href=#__codelineno-0-788>788</a></span>
<span class=normal><a href=#__codelineno-0-789>789</a></span>
<span class=normal><a href=#__codelineno-0-790>790</a></span>
<span class=normal><a href=#__codelineno-0-791>791</a></span>
<span class=normal><a href=#__codelineno-0-792>792</a></span>
<span class=normal><a href=#__codelineno-0-793>793</a></span>
<span class=normal><a href=#__codelineno-0-794>794</a></span>
<span class=normal><a href=#__codelineno-0-795>795</a></span>
<span class=normal><a href=#__codelineno-0-796>796</a></span>
<span class=normal><a href=#__codelineno-0-797>797</a></span>
<span class=normal><a href=#__codelineno-0-798>798</a></span>
<span class=normal><a href=#__codelineno-0-799>799</a></span>
<span class=normal><a href=#__codelineno-0-800>800</a></span>
<span class=normal><a href=#__codelineno-0-801>801</a></span>
<span class=normal><a href=#__codelineno-0-802>802</a></span>
<span class=normal><a href=#__codelineno-0-803>803</a></span>
<span class=normal><a href=#__codelineno-0-804>804</a></span>
<span class=normal><a href=#__codelineno-0-805>805</a></span>
<span class=normal><a href=#__codelineno-0-806>806</a></span>
<span class=normal><a href=#__codelineno-0-807>807</a></span>
<span class=normal><a href=#__codelineno-0-808>808</a></span>
<span class=normal><a href=#__codelineno-0-809>809</a></span>
<span class=normal><a href=#__codelineno-0-810>810</a></span>
<span class=normal><a href=#__codelineno-0-811>811</a></span>
<span class=normal><a href=#__codelineno-0-812>812</a></span>
<span class=normal><a href=#__codelineno-0-813>813</a></span>
<span class=normal><a href=#__codelineno-0-814>814</a></span>
<span class=normal><a href=#__codelineno-0-815>815</a></span>
<span class=normal><a href=#__codelineno-0-816>816</a></span>
<span class=normal><a href=#__codelineno-0-817>817</a></span>
<span class=normal><a href=#__codelineno-0-818>818</a></span>
<span class=normal><a href=#__codelineno-0-819>819</a></span>
<span class=normal><a href=#__codelineno-0-820>820</a></span>
<span class=normal><a href=#__codelineno-0-821>821</a></span>
<span class=normal><a href=#__codelineno-0-822>822</a></span>
<span class=normal><a href=#__codelineno-0-823>823</a></span>
<span class=normal><a href=#__codelineno-0-824>824</a></span>
<span class=normal><a href=#__codelineno-0-825>825</a></span>
<span class=normal><a href=#__codelineno-0-826>826</a></span>
<span class=normal><a href=#__codelineno-0-827>827</a></span>
<span class=normal><a href=#__codelineno-0-828>828</a></span>
<span class=normal><a href=#__codelineno-0-829>829</a></span>
<span class=normal><a href=#__codelineno-0-830>830</a></span>
<span class=normal><a href=#__codelineno-0-831>831</a></span>
<span class=normal><a href=#__codelineno-0-832>832</a></span>
<span class=normal><a href=#__codelineno-0-833>833</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-733><a id=__codelineno-0-733 name=__codelineno-0-733></a>    <span class=k>def</span><span class=w> </span><span class=nf>_create_new_agent</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>namespace</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>name</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>],</span> <span class=n>description</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-734><a id=__codelineno-0-734 name=__codelineno-0-734></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Create a new agent from scratch.&quot;&quot;&quot;</span>
</span><span id=__span-0-735><a id=__codelineno-0-735 name=__codelineno-0-735></a>        <span class=c1># If no name/description provided, use interactive prompts</span>
</span><span id=__span-0-736><a id=__codelineno-0-736 name=__codelineno-0-736></a>        <span class=n>init_instructions</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-737><a id=__codelineno-0-737 name=__codelineno-0-737></a>        <span class=k>if</span> <span class=n>name</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>and</span> <span class=n>description</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-738><a id=__codelineno-0-738 name=__codelineno-0-738></a>            <span class=n>_</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>description</span><span class=p>,</span> <span class=n>init_instructions</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_prompt_agent_details</span><span class=p>()</span>
</span><span id=__span-0-739><a id=__codelineno-0-739 name=__codelineno-0-739></a>
</span><span id=__span-0-740><a id=__codelineno-0-740 name=__codelineno-0-740></a>        <span class=c1># Set the agent path</span>
</span><span id=__span-0-741><a id=__codelineno-0-741 name=__codelineno-0-741></a>        <span class=n>registry_folder</span> <span class=o>=</span> <span class=n>get_registry_folder</span><span class=p>()</span>
</span><span id=__span-0-742><a id=__codelineno-0-742 name=__codelineno-0-742></a>        <span class=k>if</span> <span class=n>registry_folder</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-743><a id=__codelineno-0-743 name=__codelineno-0-743></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Registry folder path cannot be None&quot;</span><span class=p>)</span>
</span><span id=__span-0-744><a id=__codelineno-0-744 name=__codelineno-0-744></a>
</span><span id=__span-0-745><a id=__codelineno-0-745 name=__codelineno-0-745></a>        <span class=c1># Narrow the type of namespace &amp; name from Optional[str] to str</span>
</span><span id=__span-0-746><a id=__codelineno-0-746 name=__codelineno-0-746></a>        <span class=n>namespace_str</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>namespace</span> <span class=k>if</span> <span class=n>namespace</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=k>else</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-747><a id=__codelineno-0-747 name=__codelineno-0-747></a>        <span class=k>if</span> <span class=n>namespace_str</span> <span class=o>==</span> <span class=s2>&quot;&quot;</span><span class=p>:</span>
</span><span id=__span-0-748><a id=__codelineno-0-748 name=__codelineno-0-748></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Namespace cannot be None or empty&quot;</span><span class=p>)</span>
</span><span id=__span-0-749><a id=__codelineno-0-749 name=__codelineno-0-749></a>
</span><span id=__span-0-750><a id=__codelineno-0-750 name=__codelineno-0-750></a>        <span class=n>name_str</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>name</span> <span class=k>if</span> <span class=n>name</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=k>else</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-751><a id=__codelineno-0-751 name=__codelineno-0-751></a>        <span class=k>if</span> <span class=n>name_str</span> <span class=o>==</span> <span class=s2>&quot;&quot;</span><span class=p>:</span>
</span><span id=__span-0-752><a id=__codelineno-0-752 name=__codelineno-0-752></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Name cannot be None or empty&quot;</span><span class=p>)</span>
</span><span id=__span-0-753><a id=__codelineno-0-753 name=__codelineno-0-753></a>
</span><span id=__span-0-754><a id=__codelineno-0-754 name=__codelineno-0-754></a>        <span class=n>agent_path</span> <span class=o>=</span> <span class=n>registry_folder</span> <span class=o>/</span> <span class=n>namespace_str</span> <span class=o>/</span> <span class=n>name_str</span> <span class=o>/</span> <span class=s2>&quot;0.0.1&quot;</span>
</span><span id=__span-0-755><a id=__codelineno-0-755 name=__codelineno-0-755></a>        <span class=n>agent_path</span><span class=o>.</span><span class=n>mkdir</span><span class=p>(</span><span class=n>parents</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-756><a id=__codelineno-0-756 name=__codelineno-0-756></a>
</span><span id=__span-0-757><a id=__codelineno-0-757 name=__codelineno-0-757></a>        <span class=n>metadata</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-758><a id=__codelineno-0-758 name=__codelineno-0-758></a>            <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=n>name_str</span><span class=p>,</span>
</span><span id=__span-0-759><a id=__codelineno-0-759 name=__codelineno-0-759></a>            <span class=s2>&quot;version&quot;</span><span class=p>:</span> <span class=s2>&quot;0.0.1&quot;</span><span class=p>,</span>
</span><span id=__span-0-760><a id=__codelineno-0-760 name=__codelineno-0-760></a>            <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=n>description</span> <span class=ow>or</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-761><a id=__codelineno-0-761 name=__codelineno-0-761></a>            <span class=s2>&quot;category&quot;</span><span class=p>:</span> <span class=s2>&quot;agent&quot;</span><span class=p>,</span>
</span><span id=__span-0-762><a id=__codelineno-0-762 name=__codelineno-0-762></a>            <span class=s2>&quot;tags&quot;</span><span class=p>:</span> <span class=p>[],</span>
</span><span id=__span-0-763><a id=__codelineno-0-763 name=__codelineno-0-763></a>            <span class=s2>&quot;details&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-0-764><a id=__codelineno-0-764 name=__codelineno-0-764></a>                <span class=s2>&quot;agent&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-0-765><a id=__codelineno-0-765 name=__codelineno-0-765></a>                    <span class=s2>&quot;defaults&quot;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-0-766><a id=__codelineno-0-766 name=__codelineno-0-766></a>                        <span class=s2>&quot;model&quot;</span><span class=p>:</span> <span class=n>DEFAULT_MODEL</span><span class=p>,</span>
</span><span id=__span-0-767><a id=__codelineno-0-767 name=__codelineno-0-767></a>                        <span class=s2>&quot;model_provider&quot;</span><span class=p>:</span> <span class=n>DEFAULT_PROVIDER</span><span class=p>,</span>
</span><span id=__span-0-768><a id=__codelineno-0-768 name=__codelineno-0-768></a>                        <span class=s2>&quot;model_temperature&quot;</span><span class=p>:</span> <span class=n>DEFAULT_MODEL_TEMPERATURE</span><span class=p>,</span>
</span><span id=__span-0-769><a id=__codelineno-0-769 name=__codelineno-0-769></a>                        <span class=s2>&quot;model_max_tokens&quot;</span><span class=p>:</span> <span class=n>DEFAULT_MODEL_MAX_TOKENS</span><span class=p>,</span>
</span><span id=__span-0-770><a id=__codelineno-0-770 name=__codelineno-0-770></a>                    <span class=p>}</span>
</span><span id=__span-0-771><a id=__codelineno-0-771 name=__codelineno-0-771></a>                <span class=p>}</span>
</span><span id=__span-0-772><a id=__codelineno-0-772 name=__codelineno-0-772></a>            <span class=p>},</span>
</span><span id=__span-0-773><a id=__codelineno-0-773 name=__codelineno-0-773></a>            <span class=s2>&quot;show_entry&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-774><a id=__codelineno-0-774 name=__codelineno-0-774></a>        <span class=p>}</span>
</span><span id=__span-0-775><a id=__codelineno-0-775 name=__codelineno-0-775></a>
</span><span id=__span-0-776><a id=__codelineno-0-776 name=__codelineno-0-776></a>        <span class=n>metadata_path</span> <span class=o>=</span> <span class=n>agent_path</span> <span class=o>/</span> <span class=s2>&quot;metadata.json&quot;</span>
</span><span id=__span-0-777><a id=__codelineno-0-777 name=__codelineno-0-777></a>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>metadata_path</span><span class=p>,</span> <span class=s2>&quot;w&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-778><a id=__codelineno-0-778 name=__codelineno-0-778></a>            <span class=n>json</span><span class=o>.</span><span class=n>dump</span><span class=p>(</span><span class=n>metadata</span><span class=p>,</span> <span class=n>f</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</span><span id=__span-0-779><a id=__codelineno-0-779 name=__codelineno-0-779></a>
</span><span id=__span-0-780><a id=__codelineno-0-780 name=__codelineno-0-780></a>        <span class=c1># Create a default agent.py with the provided initial</span>
</span><span id=__span-0-781><a id=__codelineno-0-781 name=__codelineno-0-781></a>        <span class=n>agent_py_content</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;&quot;&quot;from nearai.agents.environment import Environment</span>
</span><span id=__span-0-782><a id=__codelineno-0-782 name=__codelineno-0-782></a>
</span><span id=__span-0-783><a id=__codelineno-0-783 name=__codelineno-0-783></a>
</span><span id=__span-0-784><a id=__codelineno-0-784 name=__codelineno-0-784></a><span class=s2>def run(env: Environment):</span>
</span><span id=__span-0-785><a id=__codelineno-0-785 name=__codelineno-0-785></a><span class=s2>    # Your agent code here</span>
</span><span id=__span-0-786><a id=__codelineno-0-786 name=__codelineno-0-786></a><span class=s2>    prompt = </span><span class=se>{{</span><span class=s2>&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;</span><span class=si>{</span><span class=n>init_instructions</span><span class=si>}</span><span class=s2>&quot;</span><span class=se>}}</span>
</span><span id=__span-0-787><a id=__codelineno-0-787 name=__codelineno-0-787></a><span class=s2>    result = env.completion([prompt] + env.list_messages())</span>
</span><span id=__span-0-788><a id=__codelineno-0-788 name=__codelineno-0-788></a><span class=s2>    env.add_reply(result)</span>
</span><span id=__span-0-789><a id=__codelineno-0-789 name=__codelineno-0-789></a><span class=s2>    env.request_user_input()</span>
</span><span id=__span-0-790><a id=__codelineno-0-790 name=__codelineno-0-790></a>
</span><span id=__span-0-791><a id=__codelineno-0-791 name=__codelineno-0-791></a><span class=s2>run(env)</span>
</span><span id=__span-0-792><a id=__codelineno-0-792 name=__codelineno-0-792></a>
</span><span id=__span-0-793><a id=__codelineno-0-793 name=__codelineno-0-793></a><span class=s2>&quot;&quot;&quot;</span>
</span><span id=__span-0-794><a id=__codelineno-0-794 name=__codelineno-0-794></a>        <span class=n>agent_py_path</span> <span class=o>=</span> <span class=n>agent_path</span> <span class=o>/</span> <span class=s2>&quot;agent.py&quot;</span>
</span><span id=__span-0-795><a id=__codelineno-0-795 name=__codelineno-0-795></a>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>agent_py_path</span><span class=p>,</span> <span class=s2>&quot;w&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-796><a id=__codelineno-0-796 name=__codelineno-0-796></a>            <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>agent_py_content</span><span class=p>)</span>
</span><span id=__span-0-797><a id=__codelineno-0-797 name=__codelineno-0-797></a>
</span><span id=__span-0-798><a id=__codelineno-0-798 name=__codelineno-0-798></a>        <span class=c1># Create success message</span>
</span><span id=__span-0-799><a id=__codelineno-0-799 name=__codelineno-0-799></a>        <span class=n>console</span> <span class=o>=</span> <span class=n>Console</span><span class=p>()</span>
</span><span id=__span-0-800><a id=__codelineno-0-800 name=__codelineno-0-800></a>        <span class=n>success_title</span> <span class=o>=</span> <span class=n>Text</span><span class=p>(</span><span class=s2>&quot; 🎉 SUCCESS!&quot;</span><span class=p>,</span> <span class=n>style</span><span class=o>=</span><span class=s2>&quot;bold green&quot;</span><span class=p>)</span>
</span><span id=__span-0-801><a id=__codelineno-0-801 name=__codelineno-0-801></a>        <span class=n>path_text</span> <span class=o>=</span> <span class=n>Text</span><span class=o>.</span><span class=n>assemble</span><span class=p>((</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>  • New AI Agent created at: &quot;</span><span class=p>,</span> <span class=s2>&quot;bold green&quot;</span><span class=p>),</span> <span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>agent_path</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span> <span class=s2>&quot;bold&quot;</span><span class=p>))</span>
</span><span id=__span-0-802><a id=__codelineno-0-802 name=__codelineno-0-802></a>
</span><span id=__span-0-803><a id=__codelineno-0-803 name=__codelineno-0-803></a>        <span class=n>files_panel</span> <span class=o>=</span> <span class=n>Panel</span><span class=p>(</span>
</span><span id=__span-0-804><a id=__codelineno-0-804 name=__codelineno-0-804></a>            <span class=n>Text</span><span class=o>.</span><span class=n>assemble</span><span class=p>(</span>
</span><span id=__span-0-805><a id=__codelineno-0-805 name=__codelineno-0-805></a>                <span class=p>(</span><span class=s2>&quot;Edit agent code here:</span><span class=se>\n\n</span><span class=s2>&quot;</span><span class=p>,</span> <span class=s2>&quot;yellow&quot;</span><span class=p>),</span>
</span><span id=__span-0-806><a id=__codelineno-0-806 name=__codelineno-0-806></a>                <span class=p>(</span><span class=sa>f</span><span class=s2>&quot;📄 - </span><span class=si>{</span><span class=n>agent_path</span><span class=si>}</span><span class=s2>/agent.py</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>,</span> <span class=s2>&quot;bold blue&quot;</span><span class=p>),</span>
</span><span id=__span-0-807><a id=__codelineno-0-807 name=__codelineno-0-807></a>                <span class=p>(</span><span class=sa>f</span><span class=s2>&quot;📄 - </span><span class=si>{</span><span class=n>agent_path</span><span class=si>}</span><span class=s2>/metadata.json&quot;</span><span class=p>,</span> <span class=s2>&quot;bold blue&quot;</span><span class=p>),</span>
</span><span id=__span-0-808><a id=__codelineno-0-808 name=__codelineno-0-808></a>            <span class=p>),</span>
</span><span id=__span-0-809><a id=__codelineno-0-809 name=__codelineno-0-809></a>            <span class=n>title</span><span class=o>=</span><span class=s2>&quot;Agent Files&quot;</span><span class=p>,</span>
</span><span id=__span-0-810><a id=__codelineno-0-810 name=__codelineno-0-810></a>            <span class=n>border_style</span><span class=o>=</span><span class=s2>&quot;yellow&quot;</span><span class=p>,</span>
</span><span id=__span-0-811><a id=__codelineno-0-811 name=__codelineno-0-811></a>        <span class=p>)</span>
</span><span id=__span-0-812><a id=__codelineno-0-812 name=__codelineno-0-812></a>
</span><span id=__span-0-813><a id=__codelineno-0-813 name=__codelineno-0-813></a>        <span class=n>commands_panel</span> <span class=o>=</span> <span class=n>Panel</span><span class=p>(</span>
</span><span id=__span-0-814><a id=__codelineno-0-814 name=__codelineno-0-814></a>            <span class=n>Text</span><span class=o>.</span><span class=n>assemble</span><span class=p>(</span>
</span><span id=__span-0-815><a id=__codelineno-0-815 name=__codelineno-0-815></a>                <span class=p>(</span><span class=s2>&quot;Run this agent locally:</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>,</span> <span class=s2>&quot;light_green&quot;</span><span class=p>),</span>
</span><span id=__span-0-816><a id=__codelineno-0-816 name=__codelineno-0-816></a>                <span class=p>(</span><span class=sa>f</span><span class=s2>&quot;  nearai agent interactive </span><span class=si>{</span><span class=n>agent_path</span><span class=si>}</span><span class=s2> --local</span><span class=se>\n\n</span><span class=s2>&quot;</span><span class=p>,</span> <span class=s2>&quot;bold&quot;</span><span class=p>),</span>
</span><span id=__span-0-817><a id=__codelineno-0-817 name=__codelineno-0-817></a>                <span class=p>(</span><span class=s2>&quot;Upload this agent to NEAR AI&#39;s public registry:</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>,</span> <span class=s2>&quot;light_green&quot;</span><span class=p>),</span>
</span><span id=__span-0-818><a id=__codelineno-0-818 name=__codelineno-0-818></a>                <span class=p>(</span><span class=sa>f</span><span class=s2>&quot;  nearai registry upload </span><span class=si>{</span><span class=n>agent_path</span><span class=si>}</span><span class=se>\n\n</span><span class=s2>&quot;</span><span class=p>,</span> <span class=s2>&quot;bold&quot;</span><span class=p>),</span>
</span><span id=__span-0-819><a id=__codelineno-0-819 name=__codelineno-0-819></a>                <span class=p>(</span><span class=s2>&quot;Run ANY agent from your local registry:</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>,</span> <span class=s2>&quot;light_green&quot;</span><span class=p>),</span>
</span><span id=__span-0-820><a id=__codelineno-0-820 name=__codelineno-0-820></a>                <span class=p>(</span><span class=s2>&quot;  nearai agent interactive --local&quot;</span><span class=p>,</span> <span class=s2>&quot;bold&quot;</span><span class=p>),</span>
</span><span id=__span-0-821><a id=__codelineno-0-821 name=__codelineno-0-821></a>            <span class=p>),</span>
</span><span id=__span-0-822><a id=__codelineno-0-822 name=__codelineno-0-822></a>            <span class=n>title</span><span class=o>=</span><span class=s2>&quot;Useful Commands&quot;</span><span class=p>,</span>
</span><span id=__span-0-823><a id=__codelineno-0-823 name=__codelineno-0-823></a>            <span class=n>border_style</span><span class=o>=</span><span class=s2>&quot;green&quot;</span><span class=p>,</span>
</span><span id=__span-0-824><a id=__codelineno-0-824 name=__codelineno-0-824></a>        <span class=p>)</span>
</span><span id=__span-0-825><a id=__codelineno-0-825 name=__codelineno-0-825></a>
</span><span id=__span-0-826><a id=__codelineno-0-826 name=__codelineno-0-826></a>        <span class=n>console</span><span class=o>.</span><span class=n>print</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-827><a id=__codelineno-0-827 name=__codelineno-0-827></a>        <span class=n>console</span><span class=o>.</span><span class=n>print</span><span class=p>(</span><span class=n>success_title</span><span class=p>)</span>
</span><span id=__span-0-828><a id=__codelineno-0-828 name=__codelineno-0-828></a>        <span class=n>console</span><span class=o>.</span><span class=n>print</span><span class=p>(</span><span class=n>path_text</span><span class=p>)</span>
</span><span id=__span-0-829><a id=__codelineno-0-829 name=__codelineno-0-829></a>        <span class=n>console</span><span class=o>.</span><span class=n>print</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-830><a id=__codelineno-0-830 name=__codelineno-0-830></a>        <span class=n>console</span><span class=o>.</span><span class=n>print</span><span class=p>(</span><span class=n>files_panel</span><span class=p>)</span>
</span><span id=__span-0-831><a id=__codelineno-0-831 name=__codelineno-0-831></a>        <span class=n>console</span><span class=o>.</span><span class=n>print</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-832><a id=__codelineno-0-832 name=__codelineno-0-832></a>        <span class=n>console</span><span class=o>.</span><span class=n>print</span><span class=p>(</span><span class=n>commands_panel</span><span class=p>)</span>
</span><span id=__span-0-833><a id=__codelineno-0-833 name=__codelineno-0-833></a>        <span class=n>console</span><span class=o>.</span><span class=n>print</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.cli.AgentCli._fork_agent class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">_fork_agent</span> <a href=#nearai.cli.AgentCli._fork_agent class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>_fork_agent</span><span class=p>(</span><span class=n>fork</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>namespace</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>new_name</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>str</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Fork an existing agent.</p> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-835>835</a></span>
<span class=normal><a href=#__codelineno-0-836>836</a></span>
<span class=normal><a href=#__codelineno-0-837>837</a></span>
<span class=normal><a href=#__codelineno-0-838>838</a></span>
<span class=normal><a href=#__codelineno-0-839>839</a></span>
<span class=normal><a href=#__codelineno-0-840>840</a></span>
<span class=normal><a href=#__codelineno-0-841>841</a></span>
<span class=normal><a href=#__codelineno-0-842>842</a></span>
<span class=normal><a href=#__codelineno-0-843>843</a></span>
<span class=normal><a href=#__codelineno-0-844>844</a></span>
<span class=normal><a href=#__codelineno-0-845>845</a></span>
<span class=normal><a href=#__codelineno-0-846>846</a></span>
<span class=normal><a href=#__codelineno-0-847>847</a></span>
<span class=normal><a href=#__codelineno-0-848>848</a></span>
<span class=normal><a href=#__codelineno-0-849>849</a></span>
<span class=normal><a href=#__codelineno-0-850>850</a></span>
<span class=normal><a href=#__codelineno-0-851>851</a></span>
<span class=normal><a href=#__codelineno-0-852>852</a></span>
<span class=normal><a href=#__codelineno-0-853>853</a></span>
<span class=normal><a href=#__codelineno-0-854>854</a></span>
<span class=normal><a href=#__codelineno-0-855>855</a></span>
<span class=normal><a href=#__codelineno-0-856>856</a></span>
<span class=normal><a href=#__codelineno-0-857>857</a></span>
<span class=normal><a href=#__codelineno-0-858>858</a></span>
<span class=normal><a href=#__codelineno-0-859>859</a></span>
<span class=normal><a href=#__codelineno-0-860>860</a></span>
<span class=normal><a href=#__codelineno-0-861>861</a></span>
<span class=normal><a href=#__codelineno-0-862>862</a></span>
<span class=normal><a href=#__codelineno-0-863>863</a></span>
<span class=normal><a href=#__codelineno-0-864>864</a></span>
<span class=normal><a href=#__codelineno-0-865>865</a></span>
<span class=normal><a href=#__codelineno-0-866>866</a></span>
<span class=normal><a href=#__codelineno-0-867>867</a></span>
<span class=normal><a href=#__codelineno-0-868>868</a></span>
<span class=normal><a href=#__codelineno-0-869>869</a></span>
<span class=normal><a href=#__codelineno-0-870>870</a></span>
<span class=normal><a href=#__codelineno-0-871>871</a></span>
<span class=normal><a href=#__codelineno-0-872>872</a></span>
<span class=normal><a href=#__codelineno-0-873>873</a></span>
<span class=normal><a href=#__codelineno-0-874>874</a></span>
<span class=normal><a href=#__codelineno-0-875>875</a></span>
<span class=normal><a href=#__codelineno-0-876>876</a></span>
<span class=normal><a href=#__codelineno-0-877>877</a></span>
<span class=normal><a href=#__codelineno-0-878>878</a></span>
<span class=normal><a href=#__codelineno-0-879>879</a></span>
<span class=normal><a href=#__codelineno-0-880>880</a></span>
<span class=normal><a href=#__codelineno-0-881>881</a></span>
<span class=normal><a href=#__codelineno-0-882>882</a></span>
<span class=normal><a href=#__codelineno-0-883>883</a></span>
<span class=normal><a href=#__codelineno-0-884>884</a></span>
<span class=normal><a href=#__codelineno-0-885>885</a></span>
<span class=normal><a href=#__codelineno-0-886>886</a></span>
<span class=normal><a href=#__codelineno-0-887>887</a></span>
<span class=normal><a href=#__codelineno-0-888>888</a></span>
<span class=normal><a href=#__codelineno-0-889>889</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-835><a id=__codelineno-0-835 name=__codelineno-0-835></a><span class=k>def</span><span class=w> </span><span class=nf>_fork_agent</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>fork</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>namespace</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>new_name</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-836><a id=__codelineno-0-836 name=__codelineno-0-836></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Fork an existing agent.&quot;&quot;&quot;</span>
</span><span id=__span-0-837><a id=__codelineno-0-837 name=__codelineno-0-837></a>    <span class=kn>import</span><span class=w> </span><span class=nn>shutil</span>
</span><span id=__span-0-838><a id=__codelineno-0-838 name=__codelineno-0-838></a>
</span><span id=__span-0-839><a id=__codelineno-0-839 name=__codelineno-0-839></a>    <span class=c1># Parse the fork parameter</span>
</span><span id=__span-0-840><a id=__codelineno-0-840 name=__codelineno-0-840></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-841><a id=__codelineno-0-841 name=__codelineno-0-841></a>        <span class=n>entry_location</span> <span class=o>=</span> <span class=n>parse_location</span><span class=p>(</span><span class=n>fork</span><span class=p>)</span>
</span><span id=__span-0-842><a id=__codelineno-0-842 name=__codelineno-0-842></a>        <span class=n>fork_namespace</span> <span class=o>=</span> <span class=n>entry_location</span><span class=o>.</span><span class=n>namespace</span>
</span><span id=__span-0-843><a id=__codelineno-0-843 name=__codelineno-0-843></a>        <span class=n>fork_name</span> <span class=o>=</span> <span class=n>entry_location</span><span class=o>.</span><span class=n>name</span>
</span><span id=__span-0-844><a id=__codelineno-0-844 name=__codelineno-0-844></a>        <span class=n>fork_version</span> <span class=o>=</span> <span class=n>entry_location</span><span class=o>.</span><span class=n>version</span>
</span><span id=__span-0-845><a id=__codelineno-0-845 name=__codelineno-0-845></a>    <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
</span><span id=__span-0-846><a id=__codelineno-0-846 name=__codelineno-0-846></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Invalid fork parameter format. Expected format: &lt;namespace&gt;/&lt;agent-name&gt;/&lt;version&gt;&quot;</span><span class=p>)</span>
</span><span id=__span-0-847><a id=__codelineno-0-847 name=__codelineno-0-847></a>        <span class=k>return</span>
</span><span id=__span-0-848><a id=__codelineno-0-848 name=__codelineno-0-848></a>
</span><span id=__span-0-849><a id=__codelineno-0-849 name=__codelineno-0-849></a>    <span class=c1># Download the agent from the registry</span>
</span><span id=__span-0-850><a id=__codelineno-0-850 name=__codelineno-0-850></a>    <span class=n>agent_location</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>fork_namespace</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>fork_name</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>fork_version</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-851><a id=__codelineno-0-851 name=__codelineno-0-851></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Downloading agent &#39;</span><span class=si>{</span><span class=n>agent_location</span><span class=si>}</span><span class=s2>&#39;...&quot;</span><span class=p>)</span>
</span><span id=__span-0-852><a id=__codelineno-0-852 name=__codelineno-0-852></a>    <span class=n>registry</span><span class=o>.</span><span class=n>download</span><span class=p>(</span><span class=n>agent_location</span><span class=p>,</span> <span class=n>force</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>show_progress</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-853><a id=__codelineno-0-853 name=__codelineno-0-853></a>    <span class=n>source_path</span> <span class=o>=</span> <span class=n>get_registry_folder</span><span class=p>()</span> <span class=o>/</span> <span class=n>fork_namespace</span> <span class=o>/</span> <span class=n>fork_name</span> <span class=o>/</span> <span class=n>fork_version</span>
</span><span id=__span-0-854><a id=__codelineno-0-854 name=__codelineno-0-854></a>
</span><span id=__span-0-855><a id=__codelineno-0-855 name=__codelineno-0-855></a>    <span class=c1># Prompt for the new agent name if not provided</span>
</span><span id=__span-0-856><a id=__codelineno-0-856 name=__codelineno-0-856></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>new_name</span><span class=p>:</span>
</span><span id=__span-0-857><a id=__codelineno-0-857 name=__codelineno-0-857></a>        <span class=n>new_name</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=s2>&quot;Enter the new agent name: &quot;</span><span class=p>)</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span><span id=__span-0-858><a id=__codelineno-0-858 name=__codelineno-0-858></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>new_name</span><span class=p>:</span>
</span><span id=__span-0-859><a id=__codelineno-0-859 name=__codelineno-0-859></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Agent name cannot be empty.&quot;</span><span class=p>)</span>
</span><span id=__span-0-860><a id=__codelineno-0-860 name=__codelineno-0-860></a>            <span class=k>return</span>
</span><span id=__span-0-861><a id=__codelineno-0-861 name=__codelineno-0-861></a>
</span><span id=__span-0-862><a id=__codelineno-0-862 name=__codelineno-0-862></a>        <span class=c1># confirm pattern is ok</span>
</span><span id=__span-0-863><a id=__codelineno-0-863 name=__codelineno-0-863></a>        <span class=n>identifier_pattern</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=sa>r</span><span class=s2>&quot;^[a-zA-Z0-9_\-.]+$&quot;</span><span class=p>)</span>
</span><span id=__span-0-864><a id=__codelineno-0-864 name=__codelineno-0-864></a>        <span class=k>if</span> <span class=n>identifier_pattern</span><span class=o>.</span><span class=n>match</span><span class=p>(</span><span class=n>new_name</span><span class=p>)</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-865><a id=__codelineno-0-865 name=__codelineno-0-865></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Invalid Name, please choose something different&quot;</span><span class=p>)</span>
</span><span id=__span-0-866><a id=__codelineno-0-866 name=__codelineno-0-866></a>            <span class=k>return</span>
</span><span id=__span-0-867><a id=__codelineno-0-867 name=__codelineno-0-867></a>
</span><span id=__span-0-868><a id=__codelineno-0-868 name=__codelineno-0-868></a>    <span class=c1># Set the destination path</span>
</span><span id=__span-0-869><a id=__codelineno-0-869 name=__codelineno-0-869></a>    <span class=n>dest_path</span> <span class=o>=</span> <span class=n>get_registry_folder</span><span class=p>()</span> <span class=o>/</span> <span class=n>namespace</span> <span class=o>/</span> <span class=n>new_name</span> <span class=o>/</span> <span class=s2>&quot;0.0.1&quot;</span>
</span><span id=__span-0-870><a id=__codelineno-0-870 name=__codelineno-0-870></a>
</span><span id=__span-0-871><a id=__codelineno-0-871 name=__codelineno-0-871></a>    <span class=c1># Copy the agent files</span>
</span><span id=__span-0-872><a id=__codelineno-0-872 name=__codelineno-0-872></a>    <span class=n>shutil</span><span class=o>.</span><span class=n>copytree</span><span class=p>(</span><span class=n>source_path</span><span class=p>,</span> <span class=n>dest_path</span><span class=p>)</span>
</span><span id=__span-0-873><a id=__codelineno-0-873 name=__codelineno-0-873></a>
</span><span id=__span-0-874><a id=__codelineno-0-874 name=__codelineno-0-874></a>    <span class=c1># Update metadata.json</span>
</span><span id=__span-0-875><a id=__codelineno-0-875 name=__codelineno-0-875></a>    <span class=n>metadata_path</span> <span class=o>=</span> <span class=n>dest_path</span> <span class=o>/</span> <span class=s2>&quot;metadata.json&quot;</span>
</span><span id=__span-0-876><a id=__codelineno-0-876 name=__codelineno-0-876></a>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>metadata_path</span><span class=p>,</span> <span class=s2>&quot;r&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>file</span><span class=p>:</span>
</span><span id=__span-0-877><a id=__codelineno-0-877 name=__codelineno-0-877></a>        <span class=n>metadata</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>file</span><span class=p>)</span>
</span><span id=__span-0-878><a id=__codelineno-0-878 name=__codelineno-0-878></a>
</span><span id=__span-0-879><a id=__codelineno-0-879 name=__codelineno-0-879></a>    <span class=n>metadata</span><span class=p>[</span><span class=s2>&quot;name&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>new_name</span>
</span><span id=__span-0-880><a id=__codelineno-0-880 name=__codelineno-0-880></a>    <span class=n>metadata</span><span class=p>[</span><span class=s2>&quot;version&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;0.0.1&quot;</span>
</span><span id=__span-0-881><a id=__codelineno-0-881 name=__codelineno-0-881></a>
</span><span id=__span-0-882><a id=__codelineno-0-882 name=__codelineno-0-882></a>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>metadata_path</span><span class=p>,</span> <span class=s2>&quot;w&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>file</span><span class=p>:</span>
</span><span id=__span-0-883><a id=__codelineno-0-883 name=__codelineno-0-883></a>        <span class=n>json</span><span class=o>.</span><span class=n>dump</span><span class=p>(</span><span class=n>metadata</span><span class=p>,</span> <span class=n>file</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</span><span id=__span-0-884><a id=__codelineno-0-884 name=__codelineno-0-884></a>
</span><span id=__span-0-885><a id=__codelineno-0-885 name=__codelineno-0-885></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>Forked agent &#39;</span><span class=si>{</span><span class=n>agent_location</span><span class=si>}</span><span class=s2>&#39; to &#39;</span><span class=si>{</span><span class=n>dest_path</span><span class=si>}</span><span class=s2>&#39;&quot;</span><span class=p>)</span>
</span><span id=__span-0-886><a id=__codelineno-0-886 name=__codelineno-0-886></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Agent &#39;</span><span class=si>{</span><span class=n>new_name</span><span class=si>}</span><span class=s2>&#39; created at &#39;</span><span class=si>{</span><span class=n>dest_path</span><span class=si>}</span><span class=s2>&#39; with updated metadata.&quot;</span><span class=p>)</span>
</span><span id=__span-0-887><a id=__codelineno-0-887 name=__codelineno-0-887></a>    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>Useful commands:&quot;</span><span class=p>)</span>
</span><span id=__span-0-888><a id=__codelineno-0-888 name=__codelineno-0-888></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;  &gt; nearai agent interactive </span><span class=si>{</span><span class=n>new_name</span><span class=si>}</span><span class=s2> --local&quot;</span><span class=p>)</span>
</span><span id=__span-0-889><a id=__codelineno-0-889 name=__codelineno-0-889></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;  &gt; nearai registry upload </span><span class=si>{</span><span class=n>dest_path</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.cli.AgentCli._task class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">_task</span> <a href=#nearai.cli.AgentCli._task class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>_task</span><span class=p>(</span><span class=n>agent</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>task</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>thread_id</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>tool_resources</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n><span title=typing.Dict>Dict</span></span><span class=p>[</span><span class=n>str</span><span class=p>,</span> <span class=n><span title=typing.Any>Any</span></span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>file_ids</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n><span title=typing.List>List</span></span><span class=p>[</span><span class=n>str</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>last_message_id</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>local</span><span class=p>:</span> <span class=n>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span> <span class=n>verbose</span><span class=p>:</span> <span class=n>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span> <span class=n>env_vars</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n><span title=typing.Dict>Dict</span></span><span class=p>[</span><span class=n>str</span><span class=p>,</span> <span class=n><span title=typing.Any>Any</span></span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>str</span><span class=p>]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Runs agent non-interactively with a single task.</p> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-628>628</a></span>
<span class=normal><a href=#__codelineno-0-629>629</a></span>
<span class=normal><a href=#__codelineno-0-630>630</a></span>
<span class=normal><a href=#__codelineno-0-631>631</a></span>
<span class=normal><a href=#__codelineno-0-632>632</a></span>
<span class=normal><a href=#__codelineno-0-633>633</a></span>
<span class=normal><a href=#__codelineno-0-634>634</a></span>
<span class=normal><a href=#__codelineno-0-635>635</a></span>
<span class=normal><a href=#__codelineno-0-636>636</a></span>
<span class=normal><a href=#__codelineno-0-637>637</a></span>
<span class=normal><a href=#__codelineno-0-638>638</a></span>
<span class=normal><a href=#__codelineno-0-639>639</a></span>
<span class=normal><a href=#__codelineno-0-640>640</a></span>
<span class=normal><a href=#__codelineno-0-641>641</a></span>
<span class=normal><a href=#__codelineno-0-642>642</a></span>
<span class=normal><a href=#__codelineno-0-643>643</a></span>
<span class=normal><a href=#__codelineno-0-644>644</a></span>
<span class=normal><a href=#__codelineno-0-645>645</a></span>
<span class=normal><a href=#__codelineno-0-646>646</a></span>
<span class=normal><a href=#__codelineno-0-647>647</a></span>
<span class=normal><a href=#__codelineno-0-648>648</a></span>
<span class=normal><a href=#__codelineno-0-649>649</a></span>
<span class=normal><a href=#__codelineno-0-650>650</a></span>
<span class=normal><a href=#__codelineno-0-651>651</a></span>
<span class=normal><a href=#__codelineno-0-652>652</a></span>
<span class=normal><a href=#__codelineno-0-653>653</a></span>
<span class=normal><a href=#__codelineno-0-654>654</a></span>
<span class=normal><a href=#__codelineno-0-655>655</a></span>
<span class=normal><a href=#__codelineno-0-656>656</a></span>
<span class=normal><a href=#__codelineno-0-657>657</a></span>
<span class=normal><a href=#__codelineno-0-658>658</a></span>
<span class=normal><a href=#__codelineno-0-659>659</a></span>
<span class=normal><a href=#__codelineno-0-660>660</a></span>
<span class=normal><a href=#__codelineno-0-661>661</a></span>
<span class=normal><a href=#__codelineno-0-662>662</a></span>
<span class=normal><a href=#__codelineno-0-663>663</a></span>
<span class=normal><a href=#__codelineno-0-664>664</a></span>
<span class=normal><a href=#__codelineno-0-665>665</a></span>
<span class=normal><a href=#__codelineno-0-666>666</a></span>
<span class=normal><a href=#__codelineno-0-667>667</a></span>
<span class=normal><a href=#__codelineno-0-668>668</a></span>
<span class=normal><a href=#__codelineno-0-669>669</a></span>
<span class=normal><a href=#__codelineno-0-670>670</a></span>
<span class=normal><a href=#__codelineno-0-671>671</a></span>
<span class=normal><a href=#__codelineno-0-672>672</a></span>
<span class=normal><a href=#__codelineno-0-673>673</a></span>
<span class=normal><a href=#__codelineno-0-674>674</a></span>
<span class=normal><a href=#__codelineno-0-675>675</a></span>
<span class=normal><a href=#__codelineno-0-676>676</a></span>
<span class=normal><a href=#__codelineno-0-677>677</a></span>
<span class=normal><a href=#__codelineno-0-678>678</a></span>
<span class=normal><a href=#__codelineno-0-679>679</a></span>
<span class=normal><a href=#__codelineno-0-680>680</a></span>
<span class=normal><a href=#__codelineno-0-681>681</a></span>
<span class=normal><a href=#__codelineno-0-682>682</a></span>
<span class=normal><a href=#__codelineno-0-683>683</a></span>
<span class=normal><a href=#__codelineno-0-684>684</a></span>
<span class=normal><a href=#__codelineno-0-685>685</a></span>
<span class=normal><a href=#__codelineno-0-686>686</a></span>
<span class=normal><a href=#__codelineno-0-687>687</a></span>
<span class=normal><a href=#__codelineno-0-688>688</a></span>
<span class=normal><a href=#__codelineno-0-689>689</a></span>
<span class=normal><a href=#__codelineno-0-690>690</a></span>
<span class=normal><a href=#__codelineno-0-691>691</a></span>
<span class=normal><a href=#__codelineno-0-692>692</a></span>
<span class=normal><a href=#__codelineno-0-693>693</a></span>
<span class=normal><a href=#__codelineno-0-694>694</a></span>
<span class=normal><a href=#__codelineno-0-695>695</a></span>
<span class=normal><a href=#__codelineno-0-696>696</a></span>
<span class=normal><a href=#__codelineno-0-697>697</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-628><a id=__codelineno-0-628 name=__codelineno-0-628></a><span class=k>def</span><span class=w> </span><span class=nf>_task</span><span class=p>(</span>
</span><span id=__span-0-629><a id=__codelineno-0-629 name=__codelineno-0-629></a>    <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-630><a id=__codelineno-0-630 name=__codelineno-0-630></a>    <span class=n>agent</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-631><a id=__codelineno-0-631 name=__codelineno-0-631></a>    <span class=n>task</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-632><a id=__codelineno-0-632 name=__codelineno-0-632></a>    <span class=n>thread_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-633><a id=__codelineno-0-633 name=__codelineno-0-633></a>    <span class=n>tool_resources</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-634><a id=__codelineno-0-634 name=__codelineno-0-634></a>    <span class=n>file_ids</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-635><a id=__codelineno-0-635 name=__codelineno-0-635></a>    <span class=n>last_message_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-636><a id=__codelineno-0-636 name=__codelineno-0-636></a>    <span class=n>local</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-637><a id=__codelineno-0-637 name=__codelineno-0-637></a>    <span class=n>verbose</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-638><a id=__codelineno-0-638 name=__codelineno-0-638></a>    <span class=n>env_vars</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-639><a id=__codelineno-0-639 name=__codelineno-0-639></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
</span><span id=__span-0-640><a id=__codelineno-0-640 name=__codelineno-0-640></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Runs agent non-interactively with a single task.&quot;&quot;&quot;</span>
</span><span id=__span-0-641><a id=__codelineno-0-641 name=__codelineno-0-641></a>    <span class=n>assert_user_auth</span><span class=p>()</span>
</span><span id=__span-0-642><a id=__codelineno-0-642 name=__codelineno-0-642></a>
</span><span id=__span-0-643><a id=__codelineno-0-643 name=__codelineno-0-643></a>    <span class=n>hub_client</span> <span class=o>=</span> <span class=n>get_hub_client</span><span class=p>()</span>
</span><span id=__span-0-644><a id=__codelineno-0-644 name=__codelineno-0-644></a>    <span class=k>if</span> <span class=n>thread_id</span><span class=p>:</span>
</span><span id=__span-0-645><a id=__codelineno-0-645 name=__codelineno-0-645></a>        <span class=n>thread</span> <span class=o>=</span> <span class=n>hub_client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>retrieve</span><span class=p>(</span><span class=n>thread_id</span><span class=p>)</span>
</span><span id=__span-0-646><a id=__codelineno-0-646 name=__codelineno-0-646></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-647><a id=__codelineno-0-647 name=__codelineno-0-647></a>        <span class=n>thread</span> <span class=o>=</span> <span class=n>hub_client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>create</span><span class=p>(</span>
</span><span id=__span-0-648><a id=__codelineno-0-648 name=__codelineno-0-648></a>            <span class=n>tool_resources</span><span class=o>=</span><span class=n>tool_resources</span><span class=p>,</span>
</span><span id=__span-0-649><a id=__codelineno-0-649 name=__codelineno-0-649></a>        <span class=p>)</span>
</span><span id=__span-0-650><a id=__codelineno-0-650 name=__codelineno-0-650></a>
</span><span id=__span-0-651><a id=__codelineno-0-651 name=__codelineno-0-651></a>    <span class=n>hub_client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>messages</span><span class=o>.</span><span class=n>create</span><span class=p>(</span>
</span><span id=__span-0-652><a id=__codelineno-0-652 name=__codelineno-0-652></a>        <span class=n>thread_id</span><span class=o>=</span><span class=n>thread</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span><span id=__span-0-653><a id=__codelineno-0-653 name=__codelineno-0-653></a>        <span class=n>role</span><span class=o>=</span><span class=s2>&quot;user&quot;</span><span class=p>,</span>
</span><span id=__span-0-654><a id=__codelineno-0-654 name=__codelineno-0-654></a>        <span class=n>content</span><span class=o>=</span><span class=n>task</span><span class=p>,</span>
</span><span id=__span-0-655><a id=__codelineno-0-655 name=__codelineno-0-655></a>        <span class=n>attachments</span><span class=o>=</span><span class=p>[</span><span class=n>Attachment</span><span class=p>(</span><span class=n>file_id</span><span class=o>=</span><span class=n>file_id</span><span class=p>)</span> <span class=k>for</span> <span class=n>file_id</span> <span class=ow>in</span> <span class=n>file_ids</span><span class=p>]</span> <span class=k>if</span> <span class=n>file_ids</span> <span class=k>else</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-656><a id=__codelineno-0-656 name=__codelineno-0-656></a>    <span class=p>)</span>
</span><span id=__span-0-657><a id=__codelineno-0-657 name=__codelineno-0-657></a>
</span><span id=__span-0-658><a id=__codelineno-0-658 name=__codelineno-0-658></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>local</span><span class=p>:</span>
</span><span id=__span-0-659><a id=__codelineno-0-659 name=__codelineno-0-659></a>        <span class=n>hub_client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>runs</span><span class=o>.</span><span class=n>create_and_poll</span><span class=p>(</span>
</span><span id=__span-0-660><a id=__codelineno-0-660 name=__codelineno-0-660></a>            <span class=n>thread_id</span><span class=o>=</span><span class=n>thread</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span><span id=__span-0-661><a id=__codelineno-0-661 name=__codelineno-0-661></a>            <span class=n>assistant_id</span><span class=o>=</span><span class=n>agent</span><span class=p>,</span>
</span><span id=__span-0-662><a id=__codelineno-0-662 name=__codelineno-0-662></a>        <span class=p>)</span>
</span><span id=__span-0-663><a id=__codelineno-0-663 name=__codelineno-0-663></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-664><a id=__codelineno-0-664 name=__codelineno-0-664></a>        <span class=n>run</span> <span class=o>=</span> <span class=n>hub_client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>runs</span><span class=o>.</span><span class=n>create</span><span class=p>(</span>
</span><span id=__span-0-665><a id=__codelineno-0-665 name=__codelineno-0-665></a>            <span class=n>thread_id</span><span class=o>=</span><span class=n>thread</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span><span id=__span-0-666><a id=__codelineno-0-666 name=__codelineno-0-666></a>            <span class=n>assistant_id</span><span class=o>=</span><span class=n>agent</span><span class=p>,</span>
</span><span id=__span-0-667><a id=__codelineno-0-667 name=__codelineno-0-667></a>            <span class=n>extra_body</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;delegate_execution&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>},</span>
</span><span id=__span-0-668><a id=__codelineno-0-668 name=__codelineno-0-668></a>        <span class=p>)</span>
</span><span id=__span-0-669><a id=__codelineno-0-669 name=__codelineno-0-669></a>        <span class=n>params</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-670><a id=__codelineno-0-670 name=__codelineno-0-670></a>            <span class=s2>&quot;api_url&quot;</span><span class=p>:</span> <span class=n>CONFIG</span><span class=o>.</span><span class=n>api_url</span><span class=p>,</span>
</span><span id=__span-0-671><a id=__codelineno-0-671 name=__codelineno-0-671></a>            <span class=s2>&quot;tool_resources&quot;</span><span class=p>:</span> <span class=n>run</span><span class=o>.</span><span class=n>tools</span><span class=p>,</span>
</span><span id=__span-0-672><a id=__codelineno-0-672 name=__codelineno-0-672></a>            <span class=s2>&quot;data_source&quot;</span><span class=p>:</span> <span class=s2>&quot;local_files&quot;</span><span class=p>,</span>
</span><span id=__span-0-673><a id=__codelineno-0-673 name=__codelineno-0-673></a>            <span class=s2>&quot;user_env_vars&quot;</span><span class=p>:</span> <span class=n>env_vars</span><span class=p>,</span>
</span><span id=__span-0-674><a id=__codelineno-0-674 name=__codelineno-0-674></a>            <span class=s2>&quot;agent_env_vars&quot;</span><span class=p>:</span> <span class=p>{},</span>
</span><span id=__span-0-675><a id=__codelineno-0-675 name=__codelineno-0-675></a>            <span class=s2>&quot;verbose&quot;</span><span class=p>:</span> <span class=n>verbose</span><span class=p>,</span>
</span><span id=__span-0-676><a id=__codelineno-0-676 name=__codelineno-0-676></a>        <span class=p>}</span>
</span><span id=__span-0-677><a id=__codelineno-0-677 name=__codelineno-0-677></a>        <span class=n>auth</span> <span class=o>=</span> <span class=n>CONFIG</span><span class=o>.</span><span class=n>auth</span>
</span><span id=__span-0-678><a id=__codelineno-0-678 name=__codelineno-0-678></a>        <span class=k>assert</span> <span class=n>auth</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span>
</span><span id=__span-0-679><a id=__codelineno-0-679 name=__codelineno-0-679></a>        <span class=n>LocalRunner</span><span class=p>(</span><span class=n>agent</span><span class=p>,</span> <span class=n>agent</span><span class=p>,</span> <span class=n>thread</span><span class=o>.</span><span class=n>id</span><span class=p>,</span> <span class=n>run</span><span class=o>.</span><span class=n>id</span><span class=p>,</span> <span class=n>auth</span><span class=p>,</span> <span class=n>params</span><span class=p>)</span>
</span><span id=__span-0-680><a id=__codelineno-0-680 name=__codelineno-0-680></a>
</span><span id=__span-0-681><a id=__codelineno-0-681 name=__codelineno-0-681></a>    <span class=c1># List new messages</span>
</span><span id=__span-0-682><a id=__codelineno-0-682 name=__codelineno-0-682></a>    <span class=n>messages</span> <span class=o>=</span> <span class=n>hub_client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>messages</span><span class=o>.</span><span class=n>list</span><span class=p>(</span><span class=n>thread_id</span><span class=o>=</span><span class=n>thread</span><span class=o>.</span><span class=n>id</span><span class=p>,</span> <span class=n>after</span><span class=o>=</span><span class=n>last_message_id</span><span class=p>,</span> <span class=n>order</span><span class=o>=</span><span class=s2>&quot;asc&quot;</span><span class=p>)</span>
</span><span id=__span-0-683><a id=__codelineno-0-683 name=__codelineno-0-683></a>    <span class=n>message_list</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>messages</span><span class=p>)</span>
</span><span id=__span-0-684><a id=__codelineno-0-684 name=__codelineno-0-684></a>    <span class=k>if</span> <span class=n>message_list</span><span class=p>:</span>
</span><span id=__span-0-685><a id=__codelineno-0-685 name=__codelineno-0-685></a>        <span class=k>for</span> <span class=n>msg</span> <span class=ow>in</span> <span class=n>message_list</span><span class=p>:</span>
</span><span id=__span-0-686><a id=__codelineno-0-686 name=__codelineno-0-686></a>            <span class=k>if</span> <span class=n>msg</span><span class=o>.</span><span class=n>metadata</span> <span class=ow>and</span> <span class=n>msg</span><span class=o>.</span><span class=n>metadata</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;message_type&quot;</span><span class=p>):</span>
</span><span id=__span-0-687><a id=__codelineno-0-687 name=__codelineno-0-687></a>                <span class=k>continue</span>
</span><span id=__span-0-688><a id=__codelineno-0-688 name=__codelineno-0-688></a>            <span class=k>if</span> <span class=n>msg</span><span class=o>.</span><span class=n>role</span> <span class=o>==</span> <span class=s2>&quot;assistant&quot;</span><span class=p>:</span>
</span><span id=__span-0-689><a id=__codelineno-0-689 name=__codelineno-0-689></a>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Assistant: </span><span class=si>{</span><span class=n>msg</span><span class=o>.</span><span class=n>content</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>text</span><span class=o>.</span><span class=n>value</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-690><a id=__codelineno-0-690 name=__codelineno-0-690></a>        <span class=n>last_message_id</span> <span class=o>=</span> <span class=n>message_list</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>id</span>
</span><span id=__span-0-691><a id=__codelineno-0-691 name=__codelineno-0-691></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-692><a id=__codelineno-0-692 name=__codelineno-0-692></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;No new messages&quot;</span><span class=p>)</span>
</span><span id=__span-0-693><a id=__codelineno-0-693 name=__codelineno-0-693></a>
</span><span id=__span-0-694><a id=__codelineno-0-694 name=__codelineno-0-694></a>    <span class=c1># Store the thread_id for potential use in interactive mode</span>
</span><span id=__span-0-695><a id=__codelineno-0-695 name=__codelineno-0-695></a>    <span class=bp>self</span><span class=o>.</span><span class=n>last_thread_id</span> <span class=o>=</span> <span class=n>thread</span><span class=o>.</span><span class=n>id</span>
</span><span id=__span-0-696><a id=__codelineno-0-696 name=__codelineno-0-696></a>
</span><span id=__span-0-697><a id=__codelineno-0-697 name=__codelineno-0-697></a>    <span class=k>return</span> <span class=n>last_message_id</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.cli.AgentCli.create class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">create</span> <a href=#nearai.cli.AgentCli.create class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>create</span><span class=p>(</span><span class=n>name</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>description</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>fork</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Create a new agent or fork an existing one.</p> <details class=usage open> <summary>Usage</summary> <p>nearai agent create # Enters interactive mode nearai agent create --name <agent_name> --description <description> nearai agent create --fork <namespace agent_name version> [--name <new_agent_name>]</p> </details> <details class=options open> <summary>Options</summary> <p>--name Name of the new agent (optional). --description Description of the new agent (optional). --fork Fork an existing agent specified by namespace/agent_name/version.</p> </details> <h6 id=nearai.cli.AgentCli.create--examples>Examples<a class=headerlink href=#nearai.cli.AgentCli.create--examples title="Permanent link">&para;</a></h6> <p>nearai agent create # Enters interactive mode nearai agent create --name my_agent --description "My new agent" nearai agent create --fork agentic.near/summary/0.0.3 --name new_summary_agent</p> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-699>699</a></span>
<span class=normal><a href=#__codelineno-0-700>700</a></span>
<span class=normal><a href=#__codelineno-0-701>701</a></span>
<span class=normal><a href=#__codelineno-0-702>702</a></span>
<span class=normal><a href=#__codelineno-0-703>703</a></span>
<span class=normal><a href=#__codelineno-0-704>704</a></span>
<span class=normal><a href=#__codelineno-0-705>705</a></span>
<span class=normal><a href=#__codelineno-0-706>706</a></span>
<span class=normal><a href=#__codelineno-0-707>707</a></span>
<span class=normal><a href=#__codelineno-0-708>708</a></span>
<span class=normal><a href=#__codelineno-0-709>709</a></span>
<span class=normal><a href=#__codelineno-0-710>710</a></span>
<span class=normal><a href=#__codelineno-0-711>711</a></span>
<span class=normal><a href=#__codelineno-0-712>712</a></span>
<span class=normal><a href=#__codelineno-0-713>713</a></span>
<span class=normal><a href=#__codelineno-0-714>714</a></span>
<span class=normal><a href=#__codelineno-0-715>715</a></span>
<span class=normal><a href=#__codelineno-0-716>716</a></span>
<span class=normal><a href=#__codelineno-0-717>717</a></span>
<span class=normal><a href=#__codelineno-0-718>718</a></span>
<span class=normal><a href=#__codelineno-0-719>719</a></span>
<span class=normal><a href=#__codelineno-0-720>720</a></span>
<span class=normal><a href=#__codelineno-0-721>721</a></span>
<span class=normal><a href=#__codelineno-0-722>722</a></span>
<span class=normal><a href=#__codelineno-0-723>723</a></span>
<span class=normal><a href=#__codelineno-0-724>724</a></span>
<span class=normal><a href=#__codelineno-0-725>725</a></span>
<span class=normal><a href=#__codelineno-0-726>726</a></span>
<span class=normal><a href=#__codelineno-0-727>727</a></span>
<span class=normal><a href=#__codelineno-0-728>728</a></span>
<span class=normal><a href=#__codelineno-0-729>729</a></span>
<span class=normal><a href=#__codelineno-0-730>730</a></span>
<span class=normal><a href=#__codelineno-0-731>731</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-699><a id=__codelineno-0-699 name=__codelineno-0-699></a><span class=k>def</span><span class=w> </span><span class=nf>create</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>name</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>description</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>fork</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-700><a id=__codelineno-0-700 name=__codelineno-0-700></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Create a new agent or fork an existing one.</span>
</span><span id=__span-0-701><a id=__codelineno-0-701 name=__codelineno-0-701></a>
</span><span id=__span-0-702><a id=__codelineno-0-702 name=__codelineno-0-702></a><span class=sd>    Usage:</span>
</span><span id=__span-0-703><a id=__codelineno-0-703 name=__codelineno-0-703></a><span class=sd>      nearai agent create  # Enters interactive mode</span>
</span><span id=__span-0-704><a id=__codelineno-0-704 name=__codelineno-0-704></a><span class=sd>      nearai agent create --name &lt;agent_name&gt; --description &lt;description&gt;</span>
</span><span id=__span-0-705><a id=__codelineno-0-705 name=__codelineno-0-705></a><span class=sd>      nearai agent create --fork &lt;namespace/agent_name/version&gt; [--name &lt;new_agent_name&gt;]</span>
</span><span id=__span-0-706><a id=__codelineno-0-706 name=__codelineno-0-706></a>
</span><span id=__span-0-707><a id=__codelineno-0-707 name=__codelineno-0-707></a><span class=sd>    Options:</span>
</span><span id=__span-0-708><a id=__codelineno-0-708 name=__codelineno-0-708></a><span class=sd>      --name          Name of the new agent (optional).</span>
</span><span id=__span-0-709><a id=__codelineno-0-709 name=__codelineno-0-709></a><span class=sd>      --description   Description of the new agent (optional).</span>
</span><span id=__span-0-710><a id=__codelineno-0-710 name=__codelineno-0-710></a><span class=sd>      --fork          Fork an existing agent specified by namespace/agent_name/version.</span>
</span><span id=__span-0-711><a id=__codelineno-0-711 name=__codelineno-0-711></a>
</span><span id=__span-0-712><a id=__codelineno-0-712 name=__codelineno-0-712></a><span class=sd>    Examples</span>
</span><span id=__span-0-713><a id=__codelineno-0-713 name=__codelineno-0-713></a><span class=sd>    --------</span>
</span><span id=__span-0-714><a id=__codelineno-0-714 name=__codelineno-0-714></a><span class=sd>      nearai agent create   # Enters interactive mode</span>
</span><span id=__span-0-715><a id=__codelineno-0-715 name=__codelineno-0-715></a><span class=sd>      nearai agent create --name my_agent --description &quot;My new agent&quot;</span>
</span><span id=__span-0-716><a id=__codelineno-0-716 name=__codelineno-0-716></a><span class=sd>      nearai agent create --fork agentic.near/summary/0.0.3 --name new_summary_agent</span>
</span><span id=__span-0-717><a id=__codelineno-0-717 name=__codelineno-0-717></a>
</span><span id=__span-0-718><a id=__codelineno-0-718 name=__codelineno-0-718></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-719><a id=__codelineno-0-719 name=__codelineno-0-719></a>    <span class=c1># Check if the user is authenticated</span>
</span><span id=__span-0-720><a id=__codelineno-0-720 name=__codelineno-0-720></a>    <span class=k>if</span> <span class=n>CONFIG</span><span class=o>.</span><span class=n>auth</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>or</span> <span class=n>CONFIG</span><span class=o>.</span><span class=n>auth</span><span class=o>.</span><span class=n>namespace</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-721><a id=__codelineno-0-721 name=__codelineno-0-721></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Please login with `nearai login` before creating an agent.&quot;</span><span class=p>)</span>
</span><span id=__span-0-722><a id=__codelineno-0-722 name=__codelineno-0-722></a>        <span class=k>return</span>
</span><span id=__span-0-723><a id=__codelineno-0-723 name=__codelineno-0-723></a>
</span><span id=__span-0-724><a id=__codelineno-0-724 name=__codelineno-0-724></a>    <span class=n>namespace</span> <span class=o>=</span> <span class=n>CONFIG</span><span class=o>.</span><span class=n>auth</span><span class=o>.</span><span class=n>namespace</span>
</span><span id=__span-0-725><a id=__codelineno-0-725 name=__codelineno-0-725></a>
</span><span id=__span-0-726><a id=__codelineno-0-726 name=__codelineno-0-726></a>    <span class=k>if</span> <span class=n>fork</span><span class=p>:</span>
</span><span id=__span-0-727><a id=__codelineno-0-727 name=__codelineno-0-727></a>        <span class=c1># Fork an existing agent</span>
</span><span id=__span-0-728><a id=__codelineno-0-728 name=__codelineno-0-728></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_fork_agent</span><span class=p>(</span><span class=n>fork</span><span class=p>,</span> <span class=n>namespace</span><span class=p>,</span> <span class=n>name</span><span class=p>)</span>
</span><span id=__span-0-729><a id=__codelineno-0-729 name=__codelineno-0-729></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-730><a id=__codelineno-0-730 name=__codelineno-0-730></a>        <span class=c1># Create a new agent from scratch</span>
</span><span id=__span-0-731><a id=__codelineno-0-731 name=__codelineno-0-731></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_create_new_agent</span><span class=p>(</span><span class=n>namespace</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>description</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.cli.AgentCli.dev class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">dev</span> <a href=#nearai.cli.AgentCli.dev class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>dev</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n>int</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Run local UI for development of agents that have their own UI.</p> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-483>483</a></span>
<span class=normal><a href=#__codelineno-0-484>484</a></span>
<span class=normal><a href=#__codelineno-0-485>485</a></span>
<span class=normal><a href=#__codelineno-0-486>486</a></span>
<span class=normal><a href=#__codelineno-0-487>487</a></span>
<span class=normal><a href=#__codelineno-0-488>488</a></span>
<span class=normal><a href=#__codelineno-0-489>489</a></span>
<span class=normal><a href=#__codelineno-0-490>490</a></span>
<span class=normal><a href=#__codelineno-0-491>491</a></span>
<span class=normal><a href=#__codelineno-0-492>492</a></span>
<span class=normal><a href=#__codelineno-0-493>493</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-483><a id=__codelineno-0-483 name=__codelineno-0-483></a><span class=k>def</span><span class=w> </span><span class=nf>dev</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span>
</span><span id=__span-0-484><a id=__codelineno-0-484 name=__codelineno-0-484></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Run local UI for development of agents that have their own UI.&quot;&quot;&quot;</span>
</span><span id=__span-0-485><a id=__codelineno-0-485 name=__codelineno-0-485></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=s2>&quot;hub/demo/.env&quot;</span><span class=p>):</span>
</span><span id=__span-0-486><a id=__codelineno-0-486 name=__codelineno-0-486></a>        <span class=n>shutil</span><span class=o>.</span><span class=n>copy</span><span class=p>(</span><span class=s2>&quot;hub/demo/.env.example&quot;</span><span class=p>,</span> <span class=s2>&quot;hub/demo/.env&quot;</span><span class=p>)</span>
</span><span id=__span-0-487><a id=__codelineno-0-487 name=__codelineno-0-487></a>
</span><span id=__span-0-488><a id=__codelineno-0-488 name=__codelineno-0-488></a>    <span class=n>ret_val</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>system</span><span class=p>(</span><span class=s2>&quot;npm install --prefix hub/demo&quot;</span><span class=p>)</span>
</span><span id=__span-0-489><a id=__codelineno-0-489 name=__codelineno-0-489></a>    <span class=k>if</span> <span class=n>ret_val</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
</span><span id=__span-0-490><a id=__codelineno-0-490 name=__codelineno-0-490></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Node.js is required to run the development server.&quot;</span><span class=p>)</span>
</span><span id=__span-0-491><a id=__codelineno-0-491 name=__codelineno-0-491></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Please install Node.js from https://nodejs.org/&quot;</span><span class=p>)</span>
</span><span id=__span-0-492><a id=__codelineno-0-492 name=__codelineno-0-492></a>    <span class=n>ret_val</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>system</span><span class=p>(</span><span class=s2>&quot;npm run dev --prefix hub/demo&quot;</span><span class=p>)</span>
</span><span id=__span-0-493><a id=__codelineno-0-493 name=__codelineno-0-493></a>    <span class=k>return</span> <span class=n>ret_val</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.cli.AgentCli.inspect class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">inspect</span> <a href=#nearai.cli.AgentCli.inspect class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>inspect</span><span class=p>(</span><span class=n>path</span><span class=p>:</span> <span class=n>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Inspect environment from given path.</p> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-495>495</a></span>
<span class=normal><a href=#__codelineno-0-496>496</a></span>
<span class=normal><a href=#__codelineno-0-497>497</a></span>
<span class=normal><a href=#__codelineno-0-498>498</a></span>
<span class=normal><a href=#__codelineno-0-499>499</a></span>
<span class=normal><a href=#__codelineno-0-500>500</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-495><a id=__codelineno-0-495 name=__codelineno-0-495></a><span class=k>def</span><span class=w> </span><span class=nf>inspect</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-496><a id=__codelineno-0-496 name=__codelineno-0-496></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Inspect environment from given path.&quot;&quot;&quot;</span>
</span><span id=__span-0-497><a id=__codelineno-0-497 name=__codelineno-0-497></a>    <span class=kn>import</span><span class=w> </span><span class=nn>subprocess</span>
</span><span id=__span-0-498><a id=__codelineno-0-498 name=__codelineno-0-498></a>
</span><span id=__span-0-499><a id=__codelineno-0-499 name=__codelineno-0-499></a>    <span class=n>filename</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>abspath</span><span class=p>(</span><span class=vm>__file__</span><span class=p>))</span><span class=o>.</span><span class=n>parent</span> <span class=o>/</span> <span class=s2>&quot;streamlit_inspect.py&quot;</span>
</span><span id=__span-0-500><a id=__codelineno-0-500 name=__codelineno-0-500></a>    <span class=n>subprocess</span><span class=o>.</span><span class=n>call</span><span class=p>([</span><span class=s2>&quot;streamlit&quot;</span><span class=p>,</span> <span class=s2>&quot;run&quot;</span><span class=p>,</span> <span class=n>filename</span><span class=p>,</span> <span class=s2>&quot;--&quot;</span><span class=p>,</span> <span class=n>path</span><span class=p>])</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.cli.AgentCli.interactive class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">interactive</span> <a href=#nearai.cli.AgentCli.interactive class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>interactive</span><span class=p>(</span><span class=n>agent</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>thread_id</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>tool_resources</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n><span title=typing.Dict>Dict</span></span><span class=p>[</span><span class=n>str</span><span class=p>,</span> <span class=n><span title=typing.Any>Any</span></span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>local</span><span class=p>:</span> <span class=n>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span> <span class=n>verbose</span><span class=p>:</span> <span class=n>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span> <span class=n>env_vars</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n><span title=typing.Dict>Dict</span></span><span class=p>[</span><span class=n>str</span><span class=p>,</span> <span class=n><span title=typing.Any>Any</span></span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Runs agent interactively.</p> <hr> <div class="language-text highlight"><pre><span></span><code>agent: Optional path to the agent directory. If not provided, will show agent selection menu
thread_id: Optional thread ID to continue an existing conversation
tool_resources: Optional tool resources to pass to the agent
local: Whether to run the agent locally (default: False)
verbose: Whether to show detailed debug information during execution
env_vars: Optional environment variables to pass to the agent
</code></pre></div> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-502>502</a></span>
<span class=normal><a href=#__codelineno-0-503>503</a></span>
<span class=normal><a href=#__codelineno-0-504>504</a></span>
<span class=normal><a href=#__codelineno-0-505>505</a></span>
<span class=normal><a href=#__codelineno-0-506>506</a></span>
<span class=normal><a href=#__codelineno-0-507>507</a></span>
<span class=normal><a href=#__codelineno-0-508>508</a></span>
<span class=normal><a href=#__codelineno-0-509>509</a></span>
<span class=normal><a href=#__codelineno-0-510>510</a></span>
<span class=normal><a href=#__codelineno-0-511>511</a></span>
<span class=normal><a href=#__codelineno-0-512>512</a></span>
<span class=normal><a href=#__codelineno-0-513>513</a></span>
<span class=normal><a href=#__codelineno-0-514>514</a></span>
<span class=normal><a href=#__codelineno-0-515>515</a></span>
<span class=normal><a href=#__codelineno-0-516>516</a></span>
<span class=normal><a href=#__codelineno-0-517>517</a></span>
<span class=normal><a href=#__codelineno-0-518>518</a></span>
<span class=normal><a href=#__codelineno-0-519>519</a></span>
<span class=normal><a href=#__codelineno-0-520>520</a></span>
<span class=normal><a href=#__codelineno-0-521>521</a></span>
<span class=normal><a href=#__codelineno-0-522>522</a></span>
<span class=normal><a href=#__codelineno-0-523>523</a></span>
<span class=normal><a href=#__codelineno-0-524>524</a></span>
<span class=normal><a href=#__codelineno-0-525>525</a></span>
<span class=normal><a href=#__codelineno-0-526>526</a></span>
<span class=normal><a href=#__codelineno-0-527>527</a></span>
<span class=normal><a href=#__codelineno-0-528>528</a></span>
<span class=normal><a href=#__codelineno-0-529>529</a></span>
<span class=normal><a href=#__codelineno-0-530>530</a></span>
<span class=normal><a href=#__codelineno-0-531>531</a></span>
<span class=normal><a href=#__codelineno-0-532>532</a></span>
<span class=normal><a href=#__codelineno-0-533>533</a></span>
<span class=normal><a href=#__codelineno-0-534>534</a></span>
<span class=normal><a href=#__codelineno-0-535>535</a></span>
<span class=normal><a href=#__codelineno-0-536>536</a></span>
<span class=normal><a href=#__codelineno-0-537>537</a></span>
<span class=normal><a href=#__codelineno-0-538>538</a></span>
<span class=normal><a href=#__codelineno-0-539>539</a></span>
<span class=normal><a href=#__codelineno-0-540>540</a></span>
<span class=normal><a href=#__codelineno-0-541>541</a></span>
<span class=normal><a href=#__codelineno-0-542>542</a></span>
<span class=normal><a href=#__codelineno-0-543>543</a></span>
<span class=normal><a href=#__codelineno-0-544>544</a></span>
<span class=normal><a href=#__codelineno-0-545>545</a></span>
<span class=normal><a href=#__codelineno-0-546>546</a></span>
<span class=normal><a href=#__codelineno-0-547>547</a></span>
<span class=normal><a href=#__codelineno-0-548>548</a></span>
<span class=normal><a href=#__codelineno-0-549>549</a></span>
<span class=normal><a href=#__codelineno-0-550>550</a></span>
<span class=normal><a href=#__codelineno-0-551>551</a></span>
<span class=normal><a href=#__codelineno-0-552>552</a></span>
<span class=normal><a href=#__codelineno-0-553>553</a></span>
<span class=normal><a href=#__codelineno-0-554>554</a></span>
<span class=normal><a href=#__codelineno-0-555>555</a></span>
<span class=normal><a href=#__codelineno-0-556>556</a></span>
<span class=normal><a href=#__codelineno-0-557>557</a></span>
<span class=normal><a href=#__codelineno-0-558>558</a></span>
<span class=normal><a href=#__codelineno-0-559>559</a></span>
<span class=normal><a href=#__codelineno-0-560>560</a></span>
<span class=normal><a href=#__codelineno-0-561>561</a></span>
<span class=normal><a href=#__codelineno-0-562>562</a></span>
<span class=normal><a href=#__codelineno-0-563>563</a></span>
<span class=normal><a href=#__codelineno-0-564>564</a></span>
<span class=normal><a href=#__codelineno-0-565>565</a></span>
<span class=normal><a href=#__codelineno-0-566>566</a></span>
<span class=normal><a href=#__codelineno-0-567>567</a></span>
<span class=normal><a href=#__codelineno-0-568>568</a></span>
<span class=normal><a href=#__codelineno-0-569>569</a></span>
<span class=normal><a href=#__codelineno-0-570>570</a></span>
<span class=normal><a href=#__codelineno-0-571>571</a></span>
<span class=normal><a href=#__codelineno-0-572>572</a></span>
<span class=normal><a href=#__codelineno-0-573>573</a></span>
<span class=normal><a href=#__codelineno-0-574>574</a></span>
<span class=normal><a href=#__codelineno-0-575>575</a></span>
<span class=normal><a href=#__codelineno-0-576>576</a></span>
<span class=normal><a href=#__codelineno-0-577>577</a></span>
<span class=normal><a href=#__codelineno-0-578>578</a></span>
<span class=normal><a href=#__codelineno-0-579>579</a></span>
<span class=normal><a href=#__codelineno-0-580>580</a></span>
<span class=normal><a href=#__codelineno-0-581>581</a></span>
<span class=normal><a href=#__codelineno-0-582>582</a></span>
<span class=normal><a href=#__codelineno-0-583>583</a></span>
<span class=normal><a href=#__codelineno-0-584>584</a></span>
<span class=normal><a href=#__codelineno-0-585>585</a></span>
<span class=normal><a href=#__codelineno-0-586>586</a></span>
<span class=normal><a href=#__codelineno-0-587>587</a></span>
<span class=normal><a href=#__codelineno-0-588>588</a></span>
<span class=normal><a href=#__codelineno-0-589>589</a></span>
<span class=normal><a href=#__codelineno-0-590>590</a></span>
<span class=normal><a href=#__codelineno-0-591>591</a></span>
<span class=normal><a href=#__codelineno-0-592>592</a></span>
<span class=normal><a href=#__codelineno-0-593>593</a></span>
<span class=normal><a href=#__codelineno-0-594>594</a></span>
<span class=normal><a href=#__codelineno-0-595>595</a></span>
<span class=normal><a href=#__codelineno-0-596>596</a></span>
<span class=normal><a href=#__codelineno-0-597>597</a></span>
<span class=normal><a href=#__codelineno-0-598>598</a></span>
<span class=normal><a href=#__codelineno-0-599>599</a></span>
<span class=normal><a href=#__codelineno-0-600>600</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-502><a id=__codelineno-0-502 name=__codelineno-0-502></a><span class=k>def</span><span class=w> </span><span class=nf>interactive</span><span class=p>(</span>
</span><span id=__span-0-503><a id=__codelineno-0-503 name=__codelineno-0-503></a>    <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-504><a id=__codelineno-0-504 name=__codelineno-0-504></a>    <span class=n>agent</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-505><a id=__codelineno-0-505 name=__codelineno-0-505></a>    <span class=n>thread_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-506><a id=__codelineno-0-506 name=__codelineno-0-506></a>    <span class=n>tool_resources</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-507><a id=__codelineno-0-507 name=__codelineno-0-507></a>    <span class=n>local</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-508><a id=__codelineno-0-508 name=__codelineno-0-508></a>    <span class=n>verbose</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-509><a id=__codelineno-0-509 name=__codelineno-0-509></a>    <span class=n>env_vars</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-510><a id=__codelineno-0-510 name=__codelineno-0-510></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-511><a id=__codelineno-0-511 name=__codelineno-0-511></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Runs agent interactively.</span>
</span><span id=__span-0-512><a id=__codelineno-0-512 name=__codelineno-0-512></a>
</span><span id=__span-0-513><a id=__codelineno-0-513 name=__codelineno-0-513></a><span class=sd>    Args:</span>
</span><span id=__span-0-514><a id=__codelineno-0-514 name=__codelineno-0-514></a><span class=sd>    ----</span>
</span><span id=__span-0-515><a id=__codelineno-0-515 name=__codelineno-0-515></a><span class=sd>        agent: Optional path to the agent directory. If not provided, will show agent selection menu</span>
</span><span id=__span-0-516><a id=__codelineno-0-516 name=__codelineno-0-516></a><span class=sd>        thread_id: Optional thread ID to continue an existing conversation</span>
</span><span id=__span-0-517><a id=__codelineno-0-517 name=__codelineno-0-517></a><span class=sd>        tool_resources: Optional tool resources to pass to the agent</span>
</span><span id=__span-0-518><a id=__codelineno-0-518 name=__codelineno-0-518></a><span class=sd>        local: Whether to run the agent locally (default: False)</span>
</span><span id=__span-0-519><a id=__codelineno-0-519 name=__codelineno-0-519></a><span class=sd>        verbose: Whether to show detailed debug information during execution</span>
</span><span id=__span-0-520><a id=__codelineno-0-520 name=__codelineno-0-520></a><span class=sd>        env_vars: Optional environment variables to pass to the agent</span>
</span><span id=__span-0-521><a id=__codelineno-0-521 name=__codelineno-0-521></a>
</span><span id=__span-0-522><a id=__codelineno-0-522 name=__codelineno-0-522></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-523><a id=__codelineno-0-523 name=__codelineno-0-523></a>    <span class=n>assert_user_auth</span><span class=p>()</span>
</span><span id=__span-0-524><a id=__codelineno-0-524 name=__codelineno-0-524></a>
</span><span id=__span-0-525><a id=__codelineno-0-525 name=__codelineno-0-525></a>    <span class=k>if</span> <span class=n>agent</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-526><a id=__codelineno-0-526 name=__codelineno-0-526></a>        <span class=c1># List available agents in the registry folder</span>
</span><span id=__span-0-527><a id=__codelineno-0-527 name=__codelineno-0-527></a>        <span class=n>registry_path</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=n>get_registry_folder</span><span class=p>())</span>
</span><span id=__span-0-528><a id=__codelineno-0-528 name=__codelineno-0-528></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>registry_path</span><span class=o>.</span><span class=n>exists</span><span class=p>():</span>
</span><span id=__span-0-529><a id=__codelineno-0-529 name=__codelineno-0-529></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Error: Registry folder not found. Please create an agent first.&quot;</span><span class=p>)</span>
</span><span id=__span-0-530><a id=__codelineno-0-530 name=__codelineno-0-530></a>            <span class=k>return</span>
</span><span id=__span-0-531><a id=__codelineno-0-531 name=__codelineno-0-531></a>
</span><span id=__span-0-532><a id=__codelineno-0-532 name=__codelineno-0-532></a>        <span class=n>agents</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-0-533><a id=__codelineno-0-533 name=__codelineno-0-533></a>        <span class=c1># Walk through registry to find agents</span>
</span><span id=__span-0-534><a id=__codelineno-0-534 name=__codelineno-0-534></a>        <span class=k>for</span> <span class=n>namespace</span> <span class=ow>in</span> <span class=n>registry_path</span><span class=o>.</span><span class=n>iterdir</span><span class=p>():</span>
</span><span id=__span-0-535><a id=__codelineno-0-535 name=__codelineno-0-535></a>            <span class=k>if</span> <span class=n>namespace</span><span class=o>.</span><span class=n>is_dir</span><span class=p>():</span>
</span><span id=__span-0-536><a id=__codelineno-0-536 name=__codelineno-0-536></a>                <span class=k>for</span> <span class=n>agent_name</span> <span class=ow>in</span> <span class=n>namespace</span><span class=o>.</span><span class=n>iterdir</span><span class=p>():</span>
</span><span id=__span-0-537><a id=__codelineno-0-537 name=__codelineno-0-537></a>                    <span class=k>if</span> <span class=n>agent_name</span><span class=o>.</span><span class=n>is_dir</span><span class=p>():</span>
</span><span id=__span-0-538><a id=__codelineno-0-538 name=__codelineno-0-538></a>                        <span class=k>for</span> <span class=n>version</span> <span class=ow>in</span> <span class=n>agent_name</span><span class=o>.</span><span class=n>iterdir</span><span class=p>():</span>
</span><span id=__span-0-539><a id=__codelineno-0-539 name=__codelineno-0-539></a>                            <span class=k>if</span> <span class=n>version</span><span class=o>.</span><span class=n>is_dir</span><span class=p>():</span>
</span><span id=__span-0-540><a id=__codelineno-0-540 name=__codelineno-0-540></a>                                <span class=n>agents</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>version</span><span class=p>)</span>
</span><span id=__span-0-541><a id=__codelineno-0-541 name=__codelineno-0-541></a>
</span><span id=__span-0-542><a id=__codelineno-0-542 name=__codelineno-0-542></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>agents</span><span class=p>:</span>
</span><span id=__span-0-543><a id=__codelineno-0-543 name=__codelineno-0-543></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;No agents found. Please create an agent first with &#39;nearai agent create&#39;&quot;</span><span class=p>)</span>
</span><span id=__span-0-544><a id=__codelineno-0-544 name=__codelineno-0-544></a>            <span class=k>return</span>
</span><span id=__span-0-545><a id=__codelineno-0-545 name=__codelineno-0-545></a>
</span><span id=__span-0-546><a id=__codelineno-0-546 name=__codelineno-0-546></a>        <span class=c1># Sort agents by namespace then name</span>
</span><span id=__span-0-547><a id=__codelineno-0-547 name=__codelineno-0-547></a>        <span class=n>agents</span> <span class=o>=</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>agents</span><span class=p>,</span> <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=p>(</span><span class=n>x</span><span class=o>.</span><span class=n>parts</span><span class=p>[</span><span class=o>-</span><span class=mi>3</span><span class=p>],</span> <span class=n>x</span><span class=o>.</span><span class=n>parts</span><span class=p>[</span><span class=o>-</span><span class=mi>2</span><span class=p>]))</span>
</span><span id=__span-0-548><a id=__codelineno-0-548 name=__codelineno-0-548></a>        <span class=n>display_agents_in_columns</span><span class=p>(</span><span class=n>agents</span><span class=p>)</span>
</span><span id=__span-0-549><a id=__codelineno-0-549 name=__codelineno-0-549></a>
</span><span id=__span-0-550><a id=__codelineno-0-550 name=__codelineno-0-550></a>        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span><span id=__span-0-551><a id=__codelineno-0-551 name=__codelineno-0-551></a>            <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-552><a id=__codelineno-0-552 name=__codelineno-0-552></a>                <span class=n>choice</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>Prompt</span><span class=o>.</span><span class=n>ask</span><span class=p>(</span><span class=s2>&quot;[blue bold]Select an agent (enter number)&quot;</span><span class=p>))</span> <span class=o>-</span> <span class=mi>1</span>
</span><span id=__span-0-553><a id=__codelineno-0-553 name=__codelineno-0-553></a>                <span class=k>if</span> <span class=mi>0</span> <span class=o>&lt;=</span> <span class=n>choice</span> <span class=o>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=n>agents</span><span class=p>):</span>
</span><span id=__span-0-554><a id=__codelineno-0-554 name=__codelineno-0-554></a>                    <span class=n>agent</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>agents</span><span class=p>[</span><span class=n>choice</span><span class=p>])</span>
</span><span id=__span-0-555><a id=__codelineno-0-555 name=__codelineno-0-555></a>                    <span class=k>break</span>
</span><span id=__span-0-556><a id=__codelineno-0-556 name=__codelineno-0-556></a>                <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Invalid selection. Please try again.&quot;</span><span class=p>)</span>
</span><span id=__span-0-557><a id=__codelineno-0-557 name=__codelineno-0-557></a>            <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
</span><span id=__span-0-558><a id=__codelineno-0-558 name=__codelineno-0-558></a>                <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Please enter a valid number.&quot;</span><span class=p>)</span>
</span><span id=__span-0-559><a id=__codelineno-0-559 name=__codelineno-0-559></a>            <span class=k>except</span> <span class=ne>KeyboardInterrupt</span><span class=p>:</span>
</span><span id=__span-0-560><a id=__codelineno-0-560 name=__codelineno-0-560></a>                <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>Operation cancelled.&quot;</span><span class=p>)</span>
</span><span id=__span-0-561><a id=__codelineno-0-561 name=__codelineno-0-561></a>                <span class=k>return</span>
</span><span id=__span-0-562><a id=__codelineno-0-562 name=__codelineno-0-562></a>
</span><span id=__span-0-563><a id=__codelineno-0-563 name=__codelineno-0-563></a>    <span class=c1># Convert agent path to Path object if it&#39;s a string</span>
</span><span id=__span-0-564><a id=__codelineno-0-564 name=__codelineno-0-564></a>    <span class=n>agent_path</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=n>agent</span><span class=p>)</span>
</span><span id=__span-0-565><a id=__codelineno-0-565 name=__codelineno-0-565></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>agent_path</span><span class=o>.</span><span class=n>exists</span><span class=p>():</span>
</span><span id=__span-0-566><a id=__codelineno-0-566 name=__codelineno-0-566></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error: Agent not found at path: </span><span class=si>{</span><span class=n>agent_path</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-567><a id=__codelineno-0-567 name=__codelineno-0-567></a>        <span class=k>return</span>
</span><span id=__span-0-568><a id=__codelineno-0-568 name=__codelineno-0-568></a>
</span><span id=__span-0-569><a id=__codelineno-0-569 name=__codelineno-0-569></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-570><a id=__codelineno-0-570 name=__codelineno-0-570></a>        <span class=c1># Get the last 3 parts of the path (namespace/name/version)</span>
</span><span id=__span-0-571><a id=__codelineno-0-571 name=__codelineno-0-571></a>        <span class=n>parts</span> <span class=o>=</span> <span class=n>agent_path</span><span class=o>.</span><span class=n>parts</span><span class=p>[</span><span class=o>-</span><span class=mi>3</span><span class=p>:]</span>
</span><span id=__span-0-572><a id=__codelineno-0-572 name=__codelineno-0-572></a>        <span class=n>agent_id</span> <span class=o>=</span> <span class=s2>&quot;/&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>parts</span><span class=p>)</span>
</span><span id=__span-0-573><a id=__codelineno-0-573 name=__codelineno-0-573></a>    <span class=k>except</span> <span class=ne>IndexError</span><span class=p>:</span>
</span><span id=__span-0-574><a id=__codelineno-0-574 name=__codelineno-0-574></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Error: Invalid agent path. Expected format: path/to/namespace/name/version&quot;</span><span class=p>)</span>
</span><span id=__span-0-575><a id=__codelineno-0-575 name=__codelineno-0-575></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Example: ~/.nearai/registry/namespace/agent-name/0.0.1&quot;</span><span class=p>)</span>
</span><span id=__span-0-576><a id=__codelineno-0-576 name=__codelineno-0-576></a>        <span class=k>return</span>
</span><span id=__span-0-577><a id=__codelineno-0-577 name=__codelineno-0-577></a>
</span><span id=__span-0-578><a id=__codelineno-0-578 name=__codelineno-0-578></a>    <span class=n>last_message_id</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-579><a id=__codelineno-0-579 name=__codelineno-0-579></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>=== Starting interactive session with agent: </span><span class=si>{</span><span class=n>agent_id</span><span class=si>}</span><span class=s2> ===&quot;</span><span class=p>)</span>
</span><span id=__span-0-580><a id=__codelineno-0-580 name=__codelineno-0-580></a>    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Type &#39;exit&#39; to end the session</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-581><a id=__codelineno-0-581 name=__codelineno-0-581></a>
</span><span id=__span-0-582><a id=__codelineno-0-582 name=__codelineno-0-582></a>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span><span id=__span-0-583><a id=__codelineno-0-583 name=__codelineno-0-583></a>        <span class=n>new_message</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=s2>&quot;&gt; &quot;</span><span class=p>)</span>
</span><span id=__span-0-584><a id=__codelineno-0-584 name=__codelineno-0-584></a>        <span class=k>if</span> <span class=n>new_message</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=o>==</span> <span class=s2>&quot;exit&quot;</span><span class=p>:</span>
</span><span id=__span-0-585><a id=__codelineno-0-585 name=__codelineno-0-585></a>            <span class=k>break</span>
</span><span id=__span-0-586><a id=__codelineno-0-586 name=__codelineno-0-586></a>
</span><span id=__span-0-587><a id=__codelineno-0-587 name=__codelineno-0-587></a>        <span class=n>last_message_id</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_task</span><span class=p>(</span>
</span><span id=__span-0-588><a id=__codelineno-0-588 name=__codelineno-0-588></a>            <span class=n>agent</span><span class=o>=</span><span class=n>agent_id</span><span class=p>,</span>
</span><span id=__span-0-589><a id=__codelineno-0-589 name=__codelineno-0-589></a>            <span class=n>task</span><span class=o>=</span><span class=n>new_message</span><span class=p>,</span>
</span><span id=__span-0-590><a id=__codelineno-0-590 name=__codelineno-0-590></a>            <span class=n>thread_id</span><span class=o>=</span><span class=n>thread_id</span><span class=p>,</span>
</span><span id=__span-0-591><a id=__codelineno-0-591 name=__codelineno-0-591></a>            <span class=n>tool_resources</span><span class=o>=</span><span class=n>tool_resources</span><span class=p>,</span>
</span><span id=__span-0-592><a id=__codelineno-0-592 name=__codelineno-0-592></a>            <span class=n>last_message_id</span><span class=o>=</span><span class=n>last_message_id</span><span class=p>,</span>
</span><span id=__span-0-593><a id=__codelineno-0-593 name=__codelineno-0-593></a>            <span class=n>local</span><span class=o>=</span><span class=n>local</span><span class=p>,</span>
</span><span id=__span-0-594><a id=__codelineno-0-594 name=__codelineno-0-594></a>            <span class=n>verbose</span><span class=o>=</span><span class=n>verbose</span><span class=p>,</span>
</span><span id=__span-0-595><a id=__codelineno-0-595 name=__codelineno-0-595></a>            <span class=n>env_vars</span><span class=o>=</span><span class=n>env_vars</span><span class=p>,</span>
</span><span id=__span-0-596><a id=__codelineno-0-596 name=__codelineno-0-596></a>        <span class=p>)</span>
</span><span id=__span-0-597><a id=__codelineno-0-597 name=__codelineno-0-597></a>
</span><span id=__span-0-598><a id=__codelineno-0-598 name=__codelineno-0-598></a>        <span class=c1># Update thread_id for the next iteration</span>
</span><span id=__span-0-599><a id=__codelineno-0-599 name=__codelineno-0-599></a>        <span class=k>if</span> <span class=n>thread_id</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-600><a id=__codelineno-0-600 name=__codelineno-0-600></a>            <span class=n>thread_id</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>last_thread_id</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.cli.AgentCli.task class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">task</span> <a href=#nearai.cli.AgentCli.task class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>task</span><span class=p>(</span><span class=n>agent</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>task</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>thread_id</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>tool_resources</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n><span title=typing.Dict>Dict</span></span><span class=p>[</span><span class=n>str</span><span class=p>,</span> <span class=n><span title=typing.Any>Any</span></span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>file_ids</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n><span title=typing.List>List</span></span><span class=p>[</span><span class=n>str</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>local</span><span class=p>:</span> <span class=n>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span> <span class=n>verbose</span><span class=p>:</span> <span class=n>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span> <span class=n>env_vars</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n><span title=typing.Dict>Dict</span></span><span class=p>[</span><span class=n>str</span><span class=p>,</span> <span class=n><span title=typing.Any>Any</span></span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>CLI wrapper for the _task method.</p> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-602>602</a></span>
<span class=normal><a href=#__codelineno-0-603>603</a></span>
<span class=normal><a href=#__codelineno-0-604>604</a></span>
<span class=normal><a href=#__codelineno-0-605>605</a></span>
<span class=normal><a href=#__codelineno-0-606>606</a></span>
<span class=normal><a href=#__codelineno-0-607>607</a></span>
<span class=normal><a href=#__codelineno-0-608>608</a></span>
<span class=normal><a href=#__codelineno-0-609>609</a></span>
<span class=normal><a href=#__codelineno-0-610>610</a></span>
<span class=normal><a href=#__codelineno-0-611>611</a></span>
<span class=normal><a href=#__codelineno-0-612>612</a></span>
<span class=normal><a href=#__codelineno-0-613>613</a></span>
<span class=normal><a href=#__codelineno-0-614>614</a></span>
<span class=normal><a href=#__codelineno-0-615>615</a></span>
<span class=normal><a href=#__codelineno-0-616>616</a></span>
<span class=normal><a href=#__codelineno-0-617>617</a></span>
<span class=normal><a href=#__codelineno-0-618>618</a></span>
<span class=normal><a href=#__codelineno-0-619>619</a></span>
<span class=normal><a href=#__codelineno-0-620>620</a></span>
<span class=normal><a href=#__codelineno-0-621>621</a></span>
<span class=normal><a href=#__codelineno-0-622>622</a></span>
<span class=normal><a href=#__codelineno-0-623>623</a></span>
<span class=normal><a href=#__codelineno-0-624>624</a></span>
<span class=normal><a href=#__codelineno-0-625>625</a></span>
<span class=normal><a href=#__codelineno-0-626>626</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-602><a id=__codelineno-0-602 name=__codelineno-0-602></a><span class=k>def</span><span class=w> </span><span class=nf>task</span><span class=p>(</span>
</span><span id=__span-0-603><a id=__codelineno-0-603 name=__codelineno-0-603></a>    <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-604><a id=__codelineno-0-604 name=__codelineno-0-604></a>    <span class=n>agent</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-605><a id=__codelineno-0-605 name=__codelineno-0-605></a>    <span class=n>task</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-606><a id=__codelineno-0-606 name=__codelineno-0-606></a>    <span class=n>thread_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-607><a id=__codelineno-0-607 name=__codelineno-0-607></a>    <span class=n>tool_resources</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-608><a id=__codelineno-0-608 name=__codelineno-0-608></a>    <span class=n>file_ids</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-609><a id=__codelineno-0-609 name=__codelineno-0-609></a>    <span class=n>local</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-610><a id=__codelineno-0-610 name=__codelineno-0-610></a>    <span class=n>verbose</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-611><a id=__codelineno-0-611 name=__codelineno-0-611></a>    <span class=n>env_vars</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-612><a id=__codelineno-0-612 name=__codelineno-0-612></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-613><a id=__codelineno-0-613 name=__codelineno-0-613></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;CLI wrapper for the _task method.&quot;&quot;&quot;</span>
</span><span id=__span-0-614><a id=__codelineno-0-614 name=__codelineno-0-614></a>    <span class=n>last_message_id</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_task</span><span class=p>(</span>
</span><span id=__span-0-615><a id=__codelineno-0-615 name=__codelineno-0-615></a>        <span class=n>agent</span><span class=o>=</span><span class=n>agent</span><span class=p>,</span>
</span><span id=__span-0-616><a id=__codelineno-0-616 name=__codelineno-0-616></a>        <span class=n>task</span><span class=o>=</span><span class=n>task</span><span class=p>,</span>
</span><span id=__span-0-617><a id=__codelineno-0-617 name=__codelineno-0-617></a>        <span class=n>thread_id</span><span class=o>=</span><span class=n>thread_id</span><span class=p>,</span>
</span><span id=__span-0-618><a id=__codelineno-0-618 name=__codelineno-0-618></a>        <span class=n>tool_resources</span><span class=o>=</span><span class=n>tool_resources</span><span class=p>,</span>
</span><span id=__span-0-619><a id=__codelineno-0-619 name=__codelineno-0-619></a>        <span class=n>file_ids</span><span class=o>=</span><span class=n>file_ids</span><span class=p>,</span>
</span><span id=__span-0-620><a id=__codelineno-0-620 name=__codelineno-0-620></a>        <span class=n>local</span><span class=o>=</span><span class=n>local</span><span class=p>,</span>
</span><span id=__span-0-621><a id=__codelineno-0-621 name=__codelineno-0-621></a>        <span class=n>verbose</span><span class=o>=</span><span class=n>verbose</span><span class=p>,</span>
</span><span id=__span-0-622><a id=__codelineno-0-622 name=__codelineno-0-622></a>        <span class=n>env_vars</span><span class=o>=</span><span class=n>env_vars</span><span class=p>,</span>
</span><span id=__span-0-623><a id=__codelineno-0-623 name=__codelineno-0-623></a>    <span class=p>)</span>
</span><span id=__span-0-624><a id=__codelineno-0-624 name=__codelineno-0-624></a>    <span class=k>if</span> <span class=n>last_message_id</span><span class=p>:</span>
</span><span id=__span-0-625><a id=__codelineno-0-625 name=__codelineno-0-625></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Task completed. Thread ID: </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>last_thread_id</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-626><a id=__codelineno-0-626 name=__codelineno-0-626></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Last message ID: </span><span class=si>{</span><span class=n>last_message_id</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h4 id=nearai.cli.BenchmarkCli class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">BenchmarkCli</span> <a href=#nearai.cli.BenchmarkCli class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-282>282</a></span>
<span class=normal><a href=#__codelineno-0-283>283</a></span>
<span class=normal><a href=#__codelineno-0-284>284</a></span>
<span class=normal><a href=#__codelineno-0-285>285</a></span>
<span class=normal><a href=#__codelineno-0-286>286</a></span>
<span class=normal><a href=#__codelineno-0-287>287</a></span>
<span class=normal><a href=#__codelineno-0-288>288</a></span>
<span class=normal><a href=#__codelineno-0-289>289</a></span>
<span class=normal><a href=#__codelineno-0-290>290</a></span>
<span class=normal><a href=#__codelineno-0-291>291</a></span>
<span class=normal><a href=#__codelineno-0-292>292</a></span>
<span class=normal><a href=#__codelineno-0-293>293</a></span>
<span class=normal><a href=#__codelineno-0-294>294</a></span>
<span class=normal><a href=#__codelineno-0-295>295</a></span>
<span class=normal><a href=#__codelineno-0-296>296</a></span>
<span class=normal><a href=#__codelineno-0-297>297</a></span>
<span class=normal><a href=#__codelineno-0-298>298</a></span>
<span class=normal><a href=#__codelineno-0-299>299</a></span>
<span class=normal><a href=#__codelineno-0-300>300</a></span>
<span class=normal><a href=#__codelineno-0-301>301</a></span>
<span class=normal><a href=#__codelineno-0-302>302</a></span>
<span class=normal><a href=#__codelineno-0-303>303</a></span>
<span class=normal><a href=#__codelineno-0-304>304</a></span>
<span class=normal><a href=#__codelineno-0-305>305</a></span>
<span class=normal><a href=#__codelineno-0-306>306</a></span>
<span class=normal><a href=#__codelineno-0-307>307</a></span>
<span class=normal><a href=#__codelineno-0-308>308</a></span>
<span class=normal><a href=#__codelineno-0-309>309</a></span>
<span class=normal><a href=#__codelineno-0-310>310</a></span>
<span class=normal><a href=#__codelineno-0-311>311</a></span>
<span class=normal><a href=#__codelineno-0-312>312</a></span>
<span class=normal><a href=#__codelineno-0-313>313</a></span>
<span class=normal><a href=#__codelineno-0-314>314</a></span>
<span class=normal><a href=#__codelineno-0-315>315</a></span>
<span class=normal><a href=#__codelineno-0-316>316</a></span>
<span class=normal><a href=#__codelineno-0-317>317</a></span>
<span class=normal><a href=#__codelineno-0-318>318</a></span>
<span class=normal><a href=#__codelineno-0-319>319</a></span>
<span class=normal><a href=#__codelineno-0-320>320</a></span>
<span class=normal><a href=#__codelineno-0-321>321</a></span>
<span class=normal><a href=#__codelineno-0-322>322</a></span>
<span class=normal><a href=#__codelineno-0-323>323</a></span>
<span class=normal><a href=#__codelineno-0-324>324</a></span>
<span class=normal><a href=#__codelineno-0-325>325</a></span>
<span class=normal><a href=#__codelineno-0-326>326</a></span>
<span class=normal><a href=#__codelineno-0-327>327</a></span>
<span class=normal><a href=#__codelineno-0-328>328</a></span>
<span class=normal><a href=#__codelineno-0-329>329</a></span>
<span class=normal><a href=#__codelineno-0-330>330</a></span>
<span class=normal><a href=#__codelineno-0-331>331</a></span>
<span class=normal><a href=#__codelineno-0-332>332</a></span>
<span class=normal><a href=#__codelineno-0-333>333</a></span>
<span class=normal><a href=#__codelineno-0-334>334</a></span>
<span class=normal><a href=#__codelineno-0-335>335</a></span>
<span class=normal><a href=#__codelineno-0-336>336</a></span>
<span class=normal><a href=#__codelineno-0-337>337</a></span>
<span class=normal><a href=#__codelineno-0-338>338</a></span>
<span class=normal><a href=#__codelineno-0-339>339</a></span>
<span class=normal><a href=#__codelineno-0-340>340</a></span>
<span class=normal><a href=#__codelineno-0-341>341</a></span>
<span class=normal><a href=#__codelineno-0-342>342</a></span>
<span class=normal><a href=#__codelineno-0-343>343</a></span>
<span class=normal><a href=#__codelineno-0-344>344</a></span>
<span class=normal><a href=#__codelineno-0-345>345</a></span>
<span class=normal><a href=#__codelineno-0-346>346</a></span>
<span class=normal><a href=#__codelineno-0-347>347</a></span>
<span class=normal><a href=#__codelineno-0-348>348</a></span>
<span class=normal><a href=#__codelineno-0-349>349</a></span>
<span class=normal><a href=#__codelineno-0-350>350</a></span>
<span class=normal><a href=#__codelineno-0-351>351</a></span>
<span class=normal><a href=#__codelineno-0-352>352</a></span>
<span class=normal><a href=#__codelineno-0-353>353</a></span>
<span class=normal><a href=#__codelineno-0-354>354</a></span>
<span class=normal><a href=#__codelineno-0-355>355</a></span>
<span class=normal><a href=#__codelineno-0-356>356</a></span>
<span class=normal><a href=#__codelineno-0-357>357</a></span>
<span class=normal><a href=#__codelineno-0-358>358</a></span>
<span class=normal><a href=#__codelineno-0-359>359</a></span>
<span class=normal><a href=#__codelineno-0-360>360</a></span>
<span class=normal><a href=#__codelineno-0-361>361</a></span>
<span class=normal><a href=#__codelineno-0-362>362</a></span>
<span class=normal><a href=#__codelineno-0-363>363</a></span>
<span class=normal><a href=#__codelineno-0-364>364</a></span>
<span class=normal><a href=#__codelineno-0-365>365</a></span>
<span class=normal><a href=#__codelineno-0-366>366</a></span>
<span class=normal><a href=#__codelineno-0-367>367</a></span>
<span class=normal><a href=#__codelineno-0-368>368</a></span>
<span class=normal><a href=#__codelineno-0-369>369</a></span>
<span class=normal><a href=#__codelineno-0-370>370</a></span>
<span class=normal><a href=#__codelineno-0-371>371</a></span>
<span class=normal><a href=#__codelineno-0-372>372</a></span>
<span class=normal><a href=#__codelineno-0-373>373</a></span>
<span class=normal><a href=#__codelineno-0-374>374</a></span>
<span class=normal><a href=#__codelineno-0-375>375</a></span>
<span class=normal><a href=#__codelineno-0-376>376</a></span>
<span class=normal><a href=#__codelineno-0-377>377</a></span>
<span class=normal><a href=#__codelineno-0-378>378</a></span>
<span class=normal><a href=#__codelineno-0-379>379</a></span>
<span class=normal><a href=#__codelineno-0-380>380</a></span>
<span class=normal><a href=#__codelineno-0-381>381</a></span>
<span class=normal><a href=#__codelineno-0-382>382</a></span>
<span class=normal><a href=#__codelineno-0-383>383</a></span>
<span class=normal><a href=#__codelineno-0-384>384</a></span>
<span class=normal><a href=#__codelineno-0-385>385</a></span>
<span class=normal><a href=#__codelineno-0-386>386</a></span>
<span class=normal><a href=#__codelineno-0-387>387</a></span>
<span class=normal><a href=#__codelineno-0-388>388</a></span>
<span class=normal><a href=#__codelineno-0-389>389</a></span>
<span class=normal><a href=#__codelineno-0-390>390</a></span>
<span class=normal><a href=#__codelineno-0-391>391</a></span>
<span class=normal><a href=#__codelineno-0-392>392</a></span>
<span class=normal><a href=#__codelineno-0-393>393</a></span>
<span class=normal><a href=#__codelineno-0-394>394</a></span>
<span class=normal><a href=#__codelineno-0-395>395</a></span>
<span class=normal><a href=#__codelineno-0-396>396</a></span>
<span class=normal><a href=#__codelineno-0-397>397</a></span>
<span class=normal><a href=#__codelineno-0-398>398</a></span>
<span class=normal><a href=#__codelineno-0-399>399</a></span>
<span class=normal><a href=#__codelineno-0-400>400</a></span>
<span class=normal><a href=#__codelineno-0-401>401</a></span>
<span class=normal><a href=#__codelineno-0-402>402</a></span>
<span class=normal><a href=#__codelineno-0-403>403</a></span>
<span class=normal><a href=#__codelineno-0-404>404</a></span>
<span class=normal><a href=#__codelineno-0-405>405</a></span>
<span class=normal><a href=#__codelineno-0-406>406</a></span>
<span class=normal><a href=#__codelineno-0-407>407</a></span>
<span class=normal><a href=#__codelineno-0-408>408</a></span>
<span class=normal><a href=#__codelineno-0-409>409</a></span>
<span class=normal><a href=#__codelineno-0-410>410</a></span>
<span class=normal><a href=#__codelineno-0-411>411</a></span>
<span class=normal><a href=#__codelineno-0-412>412</a></span>
<span class=normal><a href=#__codelineno-0-413>413</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-282><a id=__codelineno-0-282 name=__codelineno-0-282></a><span class=k>class</span><span class=w> </span><span class=nc>BenchmarkCli</span><span class=p>:</span>
</span><span id=__span-0-283><a id=__codelineno-0-283 name=__codelineno-0-283></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-0-284><a id=__codelineno-0-284 name=__codelineno-0-284></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Initialize Benchmark API.&quot;&quot;&quot;</span>
</span><span id=__span-0-285><a id=__codelineno-0-285 name=__codelineno-0-285></a>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span> <span class=o>=</span> <span class=n>BenchmarkApi</span><span class=p>()</span>
</span><span id=__span-0-286><a id=__codelineno-0-286 name=__codelineno-0-286></a>
</span><span id=__span-0-287><a id=__codelineno-0-287 name=__codelineno-0-287></a>    <span class=k>def</span><span class=w> </span><span class=nf>_get_or_create_benchmark</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>benchmark_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>solver_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>args</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=n>force</span><span class=p>:</span> <span class=nb>bool</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span>
</span><span id=__span-0-288><a id=__codelineno-0-288 name=__codelineno-0-288></a>        <span class=k>if</span> <span class=n>CONFIG</span><span class=o>.</span><span class=n>auth</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-289><a id=__codelineno-0-289 name=__codelineno-0-289></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Please login with `nearai login`&quot;</span><span class=p>)</span>
</span><span id=__span-0-290><a id=__codelineno-0-290 name=__codelineno-0-290></a>            <span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span><span id=__span-0-291><a id=__codelineno-0-291 name=__codelineno-0-291></a>        <span class=n>namespace</span> <span class=o>=</span> <span class=n>CONFIG</span><span class=o>.</span><span class=n>auth</span><span class=o>.</span><span class=n>namespace</span>
</span><span id=__span-0-292><a id=__codelineno-0-292 name=__codelineno-0-292></a>
</span><span id=__span-0-293><a id=__codelineno-0-293 name=__codelineno-0-293></a>        <span class=c1># Sort the args to have a consistent representation.</span>
</span><span id=__span-0-294><a id=__codelineno-0-294 name=__codelineno-0-294></a>        <span class=n>solver_args</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>OrderedDict</span><span class=p>(</span><span class=nb>sorted</span><span class=p>(</span><span class=n>args</span><span class=o>.</span><span class=n>items</span><span class=p>())))</span>
</span><span id=__span-0-295><a id=__codelineno-0-295 name=__codelineno-0-295></a>
</span><span id=__span-0-296><a id=__codelineno-0-296 name=__codelineno-0-296></a>        <span class=n>benchmark_id</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>get_benchmark_v1_benchmark_get_get</span><span class=p>(</span>
</span><span id=__span-0-297><a id=__codelineno-0-297 name=__codelineno-0-297></a>            <span class=n>namespace</span><span class=o>=</span><span class=n>namespace</span><span class=p>,</span>
</span><span id=__span-0-298><a id=__codelineno-0-298 name=__codelineno-0-298></a>            <span class=n>benchmark_name</span><span class=o>=</span><span class=n>benchmark_name</span><span class=p>,</span>
</span><span id=__span-0-299><a id=__codelineno-0-299 name=__codelineno-0-299></a>            <span class=n>solver_name</span><span class=o>=</span><span class=n>solver_name</span><span class=p>,</span>
</span><span id=__span-0-300><a id=__codelineno-0-300 name=__codelineno-0-300></a>            <span class=n>solver_args</span><span class=o>=</span><span class=n>solver_args</span><span class=p>,</span>
</span><span id=__span-0-301><a id=__codelineno-0-301 name=__codelineno-0-301></a>        <span class=p>)</span>
</span><span id=__span-0-302><a id=__codelineno-0-302 name=__codelineno-0-302></a>
</span><span id=__span-0-303><a id=__codelineno-0-303 name=__codelineno-0-303></a>        <span class=k>if</span> <span class=n>benchmark_id</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span> <span class=ow>or</span> <span class=n>force</span><span class=p>:</span>
</span><span id=__span-0-304><a id=__codelineno-0-304 name=__codelineno-0-304></a>            <span class=n>benchmark_id</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>create_benchmark_v1_benchmark_create_get</span><span class=p>(</span>
</span><span id=__span-0-305><a id=__codelineno-0-305 name=__codelineno-0-305></a>                <span class=n>benchmark_name</span><span class=o>=</span><span class=n>benchmark_name</span><span class=p>,</span>
</span><span id=__span-0-306><a id=__codelineno-0-306 name=__codelineno-0-306></a>                <span class=n>solver_name</span><span class=o>=</span><span class=n>solver_name</span><span class=p>,</span>
</span><span id=__span-0-307><a id=__codelineno-0-307 name=__codelineno-0-307></a>                <span class=n>solver_args</span><span class=o>=</span><span class=n>solver_args</span><span class=p>,</span>
</span><span id=__span-0-308><a id=__codelineno-0-308 name=__codelineno-0-308></a>            <span class=p>)</span>
</span><span id=__span-0-309><a id=__codelineno-0-309 name=__codelineno-0-309></a>
</span><span id=__span-0-310><a id=__codelineno-0-310 name=__codelineno-0-310></a>        <span class=k>assert</span> <span class=n>benchmark_id</span> <span class=o>!=</span> <span class=o>-</span><span class=mi>1</span>
</span><span id=__span-0-311><a id=__codelineno-0-311 name=__codelineno-0-311></a>        <span class=k>return</span> <span class=n>benchmark_id</span>
</span><span id=__span-0-312><a id=__codelineno-0-312 name=__codelineno-0-312></a>
</span><span id=__span-0-313><a id=__codelineno-0-313 name=__codelineno-0-313></a>    <span class=k>def</span><span class=w> </span><span class=nf>run</span><span class=p>(</span>
</span><span id=__span-0-314><a id=__codelineno-0-314 name=__codelineno-0-314></a>        <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-315><a id=__codelineno-0-315 name=__codelineno-0-315></a>        <span class=n>dataset</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-316><a id=__codelineno-0-316 name=__codelineno-0-316></a>        <span class=n>solver_strategy</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-317><a id=__codelineno-0-317 name=__codelineno-0-317></a>        <span class=n>max_concurrent</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>2</span><span class=p>,</span>
</span><span id=__span-0-318><a id=__codelineno-0-318 name=__codelineno-0-318></a>        <span class=n>force</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-319><a id=__codelineno-0-319 name=__codelineno-0-319></a>        <span class=n>subset</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-320><a id=__codelineno-0-320 name=__codelineno-0-320></a>        <span class=n>check_compatibility</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-321><a id=__codelineno-0-321 name=__codelineno-0-321></a>        <span class=n>record</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-322><a id=__codelineno-0-322 name=__codelineno-0-322></a>        <span class=n>num_inference_retries</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>10</span><span class=p>,</span>
</span><span id=__span-0-323><a id=__codelineno-0-323 name=__codelineno-0-323></a>        <span class=o>**</span><span class=n>solver_args</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span>
</span><span id=__span-0-324><a id=__codelineno-0-324 name=__codelineno-0-324></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-325><a id=__codelineno-0-325 name=__codelineno-0-325></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Run benchmark on a dataset with a solver strategy.</span>
</span><span id=__span-0-326><a id=__codelineno-0-326 name=__codelineno-0-326></a>
</span><span id=__span-0-327><a id=__codelineno-0-327 name=__codelineno-0-327></a><span class=sd>        It will cache the results in the database and subsequent runs will pull the results from the cache.</span>
</span><span id=__span-0-328><a id=__codelineno-0-328 name=__codelineno-0-328></a><span class=sd>        If force is set to True, it will run the benchmark again and update the cache.</span>
</span><span id=__span-0-329><a id=__codelineno-0-329 name=__codelineno-0-329></a><span class=sd>        &quot;&quot;&quot;</span>
</span><span id=__span-0-330><a id=__codelineno-0-330 name=__codelineno-0-330></a>        <span class=kn>from</span><span class=w> </span><span class=nn>nearai.benchmark</span><span class=w> </span><span class=kn>import</span> <span class=n>BenchmarkExecutor</span><span class=p>,</span> <span class=n>DatasetInfo</span>
</span><span id=__span-0-331><a id=__codelineno-0-331 name=__codelineno-0-331></a>        <span class=kn>from</span><span class=w> </span><span class=nn>nearai.dataset</span><span class=w> </span><span class=kn>import</span> <span class=n>get_dataset</span><span class=p>,</span> <span class=n>load_dataset</span>
</span><span id=__span-0-332><a id=__codelineno-0-332 name=__codelineno-0-332></a>        <span class=kn>from</span><span class=w> </span><span class=nn>nearai.solvers</span><span class=w> </span><span class=kn>import</span> <span class=n>SolverScoringMethod</span><span class=p>,</span> <span class=n>SolverStrategy</span><span class=p>,</span> <span class=n>SolverStrategyRegistry</span>
</span><span id=__span-0-333><a id=__codelineno-0-333 name=__codelineno-0-333></a>
</span><span id=__span-0-334><a id=__codelineno-0-334 name=__codelineno-0-334></a>        <span class=n>CONFIG</span><span class=o>.</span><span class=n>num_inference_retries</span> <span class=o>=</span> <span class=n>num_inference_retries</span>
</span><span id=__span-0-335><a id=__codelineno-0-335 name=__codelineno-0-335></a>
</span><span id=__span-0-336><a id=__codelineno-0-336 name=__codelineno-0-336></a>        <span class=n>args</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span><span class=n>solver_args</span><span class=p>)</span>
</span><span id=__span-0-337><a id=__codelineno-0-337 name=__codelineno-0-337></a>        <span class=k>if</span> <span class=n>subset</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-338><a id=__codelineno-0-338 name=__codelineno-0-338></a>            <span class=n>args</span><span class=p>[</span><span class=s2>&quot;subset&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>subset</span>
</span><span id=__span-0-339><a id=__codelineno-0-339 name=__codelineno-0-339></a>
</span><span id=__span-0-340><a id=__codelineno-0-340 name=__codelineno-0-340></a>        <span class=n>benchmark_id</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_or_create_benchmark</span><span class=p>(</span>
</span><span id=__span-0-341><a id=__codelineno-0-341 name=__codelineno-0-341></a>            <span class=n>benchmark_name</span><span class=o>=</span><span class=n>dataset</span><span class=p>,</span>
</span><span id=__span-0-342><a id=__codelineno-0-342 name=__codelineno-0-342></a>            <span class=n>solver_name</span><span class=o>=</span><span class=n>solver_strategy</span><span class=p>,</span>
</span><span id=__span-0-343><a id=__codelineno-0-343 name=__codelineno-0-343></a>            <span class=n>args</span><span class=o>=</span><span class=n>args</span><span class=p>,</span>
</span><span id=__span-0-344><a id=__codelineno-0-344 name=__codelineno-0-344></a>            <span class=n>force</span><span class=o>=</span><span class=n>force</span><span class=p>,</span>
</span><span id=__span-0-345><a id=__codelineno-0-345 name=__codelineno-0-345></a>        <span class=p>)</span>
</span><span id=__span-0-346><a id=__codelineno-0-346 name=__codelineno-0-346></a>
</span><span id=__span-0-347><a id=__codelineno-0-347 name=__codelineno-0-347></a>        <span class=n>solver_strategy_class</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>SolverStrategy</span><span class=p>,</span> <span class=kc>None</span><span class=p>]</span> <span class=o>=</span> <span class=n>SolverStrategyRegistry</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>solver_strategy</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
</span><span id=__span-0-348><a id=__codelineno-0-348 name=__codelineno-0-348></a>        <span class=k>assert</span> <span class=p>(</span>
</span><span id=__span-0-349><a id=__codelineno-0-349 name=__codelineno-0-349></a>            <span class=n>solver_strategy_class</span>
</span><span id=__span-0-350><a id=__codelineno-0-350 name=__codelineno-0-350></a>        <span class=p>),</span> <span class=sa>f</span><span class=s2>&quot;Solver strategy </span><span class=si>{</span><span class=n>solver_strategy</span><span class=si>}</span><span class=s2> not found. Available strategies: </span><span class=si>{</span><span class=nb>list</span><span class=p>(</span><span class=n>SolverStrategyRegistry</span><span class=o>.</span><span class=n>keys</span><span class=p>())</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-351><a id=__codelineno-0-351 name=__codelineno-0-351></a>
</span><span id=__span-0-352><a id=__codelineno-0-352 name=__codelineno-0-352></a>        <span class=n>name</span> <span class=o>=</span> <span class=n>dataset</span>
</span><span id=__span-0-353><a id=__codelineno-0-353 name=__codelineno-0-353></a>        <span class=k>if</span> <span class=n>solver_strategy_class</span><span class=o>.</span><span class=n>scoring_method</span> <span class=o>==</span> <span class=n>SolverScoringMethod</span><span class=o>.</span><span class=n>Custom</span><span class=p>:</span>
</span><span id=__span-0-354><a id=__codelineno-0-354 name=__codelineno-0-354></a>            <span class=n>dataset</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>get_dataset</span><span class=p>(</span><span class=n>dataset</span><span class=p>))</span>
</span><span id=__span-0-355><a id=__codelineno-0-355 name=__codelineno-0-355></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-356><a id=__codelineno-0-356 name=__codelineno-0-356></a>            <span class=n>dataset</span> <span class=o>=</span> <span class=n>load_dataset</span><span class=p>(</span><span class=n>dataset</span><span class=p>)</span>
</span><span id=__span-0-357><a id=__codelineno-0-357 name=__codelineno-0-357></a>
</span><span id=__span-0-358><a id=__codelineno-0-358 name=__codelineno-0-358></a>        <span class=n>solver_strategy_obj</span><span class=p>:</span> <span class=n>SolverStrategy</span> <span class=o>=</span> <span class=n>solver_strategy_class</span><span class=p>(</span><span class=n>dataset_ref</span><span class=o>=</span><span class=n>dataset</span><span class=p>,</span> <span class=o>**</span><span class=n>solver_args</span><span class=p>)</span>  <span class=c1># type: ignore</span>
</span><span id=__span-0-359><a id=__codelineno-0-359 name=__codelineno-0-359></a>        <span class=k>if</span> <span class=n>check_compatibility</span><span class=p>:</span>
</span><span id=__span-0-360><a id=__codelineno-0-360 name=__codelineno-0-360></a>            <span class=k>assert</span> <span class=n>name</span> <span class=ow>in</span> <span class=n>solver_strategy_obj</span><span class=o>.</span><span class=n>compatible_datasets</span><span class=p>()</span> <span class=ow>or</span> <span class=nb>any</span><span class=p>(</span>
</span><span id=__span-0-361><a id=__codelineno-0-361 name=__codelineno-0-361></a>                <span class=nb>map</span><span class=p>(</span><span class=k>lambda</span> <span class=n>n</span><span class=p>:</span> <span class=n>n</span> <span class=ow>in</span> <span class=n>name</span><span class=p>,</span> <span class=n>solver_strategy_obj</span><span class=o>.</span><span class=n>compatible_datasets</span><span class=p>())</span>
</span><span id=__span-0-362><a id=__codelineno-0-362 name=__codelineno-0-362></a>            <span class=p>),</span> <span class=sa>f</span><span class=s2>&quot;Solver strategy </span><span class=si>{</span><span class=n>solver_strategy</span><span class=si>}</span><span class=s2> is not compatible with dataset </span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-363><a id=__codelineno-0-363 name=__codelineno-0-363></a>
</span><span id=__span-0-364><a id=__codelineno-0-364 name=__codelineno-0-364></a>        <span class=n>dest_path</span> <span class=o>=</span> <span class=n>get_registry_folder</span><span class=p>()</span> <span class=o>/</span> <span class=n>name</span>
</span><span id=__span-0-365><a id=__codelineno-0-365 name=__codelineno-0-365></a>        <span class=n>metadata_path</span> <span class=o>=</span> <span class=n>dest_path</span> <span class=o>/</span> <span class=s2>&quot;metadata.json&quot;</span>
</span><span id=__span-0-366><a id=__codelineno-0-366 name=__codelineno-0-366></a>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>metadata_path</span><span class=p>,</span> <span class=s2>&quot;r&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>file</span><span class=p>:</span>
</span><span id=__span-0-367><a id=__codelineno-0-367 name=__codelineno-0-367></a>            <span class=n>metadata</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>file</span><span class=p>)</span>
</span><span id=__span-0-368><a id=__codelineno-0-368 name=__codelineno-0-368></a>
</span><span id=__span-0-369><a id=__codelineno-0-369 name=__codelineno-0-369></a>        <span class=n>be</span> <span class=o>=</span> <span class=n>BenchmarkExecutor</span><span class=p>(</span>
</span><span id=__span-0-370><a id=__codelineno-0-370 name=__codelineno-0-370></a>            <span class=n>DatasetInfo</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>subset</span><span class=p>,</span> <span class=n>dataset</span><span class=p>,</span> <span class=n>metadata</span><span class=p>),</span> <span class=n>solver_strategy_obj</span><span class=p>,</span> <span class=n>benchmark_id</span><span class=o>=</span><span class=n>benchmark_id</span>
</span><span id=__span-0-371><a id=__codelineno-0-371 name=__codelineno-0-371></a>        <span class=p>)</span>
</span><span id=__span-0-372><a id=__codelineno-0-372 name=__codelineno-0-372></a>
</span><span id=__span-0-373><a id=__codelineno-0-373 name=__codelineno-0-373></a>        <span class=n>cpu_count</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>cpu_count</span><span class=p>()</span>
</span><span id=__span-0-374><a id=__codelineno-0-374 name=__codelineno-0-374></a>        <span class=n>max_concurrent</span> <span class=o>=</span> <span class=p>(</span><span class=n>cpu_count</span> <span class=k>if</span> <span class=n>cpu_count</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=k>else</span> <span class=mi>1</span><span class=p>)</span> <span class=k>if</span> <span class=n>max_concurrent</span> <span class=o>&lt;</span> <span class=mi>0</span> <span class=k>else</span> <span class=n>max_concurrent</span>
</span><span id=__span-0-375><a id=__codelineno-0-375 name=__codelineno-0-375></a>        <span class=n>be</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>max_concurrent</span><span class=o>=</span><span class=n>max_concurrent</span><span class=p>,</span> <span class=n>record</span><span class=o>=</span><span class=n>record</span><span class=p>)</span>
</span><span id=__span-0-376><a id=__codelineno-0-376 name=__codelineno-0-376></a>
</span><span id=__span-0-377><a id=__codelineno-0-377 name=__codelineno-0-377></a>    <span class=k>def</span><span class=w> </span><span class=nf>list</span><span class=p>(</span>
</span><span id=__span-0-378><a id=__codelineno-0-378 name=__codelineno-0-378></a>        <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-379><a id=__codelineno-0-379 name=__codelineno-0-379></a>        <span class=n>namespace</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-380><a id=__codelineno-0-380 name=__codelineno-0-380></a>        <span class=n>benchmark</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-381><a id=__codelineno-0-381 name=__codelineno-0-381></a>        <span class=n>solver</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-382><a id=__codelineno-0-382 name=__codelineno-0-382></a>        <span class=n>args</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-383><a id=__codelineno-0-383 name=__codelineno-0-383></a>        <span class=n>total</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>32</span><span class=p>,</span>
</span><span id=__span-0-384><a id=__codelineno-0-384 name=__codelineno-0-384></a>        <span class=n>offset</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span>
</span><span id=__span-0-385><a id=__codelineno-0-385 name=__codelineno-0-385></a>    <span class=p>):</span>
</span><span id=__span-0-386><a id=__codelineno-0-386 name=__codelineno-0-386></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;List all executed benchmarks.&quot;&quot;&quot;</span>
</span><span id=__span-0-387><a id=__codelineno-0-387 name=__codelineno-0-387></a>        <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>list_benchmarks_v1_benchmark_list_get</span><span class=p>(</span>
</span><span id=__span-0-388><a id=__codelineno-0-388 name=__codelineno-0-388></a>            <span class=n>namespace</span><span class=o>=</span><span class=n>namespace</span><span class=p>,</span>
</span><span id=__span-0-389><a id=__codelineno-0-389 name=__codelineno-0-389></a>            <span class=n>benchmark_name</span><span class=o>=</span><span class=n>benchmark</span><span class=p>,</span>
</span><span id=__span-0-390><a id=__codelineno-0-390 name=__codelineno-0-390></a>            <span class=n>solver_name</span><span class=o>=</span><span class=n>solver</span><span class=p>,</span>
</span><span id=__span-0-391><a id=__codelineno-0-391 name=__codelineno-0-391></a>            <span class=n>solver_args</span><span class=o>=</span><span class=n>args</span><span class=p>,</span>
</span><span id=__span-0-392><a id=__codelineno-0-392 name=__codelineno-0-392></a>            <span class=n>total</span><span class=o>=</span><span class=n>total</span><span class=p>,</span>
</span><span id=__span-0-393><a id=__codelineno-0-393 name=__codelineno-0-393></a>            <span class=n>offset</span><span class=o>=</span><span class=n>offset</span><span class=p>,</span>
</span><span id=__span-0-394><a id=__codelineno-0-394 name=__codelineno-0-394></a>        <span class=p>)</span>
</span><span id=__span-0-395><a id=__codelineno-0-395 name=__codelineno-0-395></a>
</span><span id=__span-0-396><a id=__codelineno-0-396 name=__codelineno-0-396></a>        <span class=n>header</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>,</span> <span class=s2>&quot;namespace&quot;</span><span class=p>,</span> <span class=s2>&quot;benchmark&quot;</span><span class=p>,</span> <span class=s2>&quot;solver&quot;</span><span class=p>,</span> <span class=s2>&quot;args&quot;</span><span class=p>,</span> <span class=s2>&quot;score&quot;</span><span class=p>,</span> <span class=s2>&quot;solved&quot;</span><span class=p>,</span> <span class=s2>&quot;total&quot;</span><span class=p>]</span>
</span><span id=__span-0-397><a id=__codelineno-0-397 name=__codelineno-0-397></a>        <span class=n>table</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-0-398><a id=__codelineno-0-398 name=__codelineno-0-398></a>        <span class=k>for</span> <span class=n>benchmark_output</span> <span class=ow>in</span> <span class=n>result</span><span class=p>:</span>
</span><span id=__span-0-399><a id=__codelineno-0-399 name=__codelineno-0-399></a>            <span class=n>score</span> <span class=o>=</span> <span class=mi>100</span> <span class=o>*</span> <span class=n>benchmark_output</span><span class=o>.</span><span class=n>solved</span> <span class=o>/</span> <span class=n>benchmark_output</span><span class=o>.</span><span class=n>total</span>
</span><span id=__span-0-400><a id=__codelineno-0-400 name=__codelineno-0-400></a>            <span class=n>table</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
</span><span id=__span-0-401><a id=__codelineno-0-401 name=__codelineno-0-401></a>                <span class=p>[</span>
</span><span id=__span-0-402><a id=__codelineno-0-402 name=__codelineno-0-402></a>                    <span class=n>fill</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>benchmark_output</span><span class=o>.</span><span class=n>id</span><span class=p>)),</span>
</span><span id=__span-0-403><a id=__codelineno-0-403 name=__codelineno-0-403></a>                    <span class=n>fill</span><span class=p>(</span><span class=n>benchmark_output</span><span class=o>.</span><span class=n>namespace</span><span class=p>),</span>
</span><span id=__span-0-404><a id=__codelineno-0-404 name=__codelineno-0-404></a>                    <span class=n>fill</span><span class=p>(</span><span class=n>benchmark_output</span><span class=o>.</span><span class=n>benchmark</span><span class=p>),</span>
</span><span id=__span-0-405><a id=__codelineno-0-405 name=__codelineno-0-405></a>                    <span class=n>fill</span><span class=p>(</span><span class=n>benchmark_output</span><span class=o>.</span><span class=n>solver</span><span class=p>),</span>
</span><span id=__span-0-406><a id=__codelineno-0-406 name=__codelineno-0-406></a>                    <span class=n>fill</span><span class=p>(</span><span class=n>benchmark_output</span><span class=o>.</span><span class=n>args</span><span class=p>),</span>
</span><span id=__span-0-407><a id=__codelineno-0-407 name=__codelineno-0-407></a>                    <span class=n>fill</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>score</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>%&quot;</span><span class=p>),</span>
</span><span id=__span-0-408><a id=__codelineno-0-408 name=__codelineno-0-408></a>                    <span class=n>fill</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>benchmark_output</span><span class=o>.</span><span class=n>solved</span><span class=p>)),</span>
</span><span id=__span-0-409><a id=__codelineno-0-409 name=__codelineno-0-409></a>                    <span class=n>fill</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>benchmark_output</span><span class=o>.</span><span class=n>total</span><span class=p>)),</span>
</span><span id=__span-0-410><a id=__codelineno-0-410 name=__codelineno-0-410></a>                <span class=p>]</span>
</span><span id=__span-0-411><a id=__codelineno-0-411 name=__codelineno-0-411></a>            <span class=p>)</span>
</span><span id=__span-0-412><a id=__codelineno-0-412 name=__codelineno-0-412></a>
</span><span id=__span-0-413><a id=__codelineno-0-413 name=__codelineno-0-413></a>        <span class=nb>print</span><span class=p>(</span><span class=n>tabulate</span><span class=p>(</span><span class=n>table</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>header</span><span class=p>,</span> <span class=n>tablefmt</span><span class=o>=</span><span class=s2>&quot;simple_grid&quot;</span><span class=p>))</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h5 id=nearai.cli.BenchmarkCli.__init__ class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">__init__</span> <a href=#nearai.cli.BenchmarkCli.__init__ class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=fm>__init__</span><span class=p>()</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Initialize Benchmark API.</p> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-283>283</a></span>
<span class=normal><a href=#__codelineno-0-284>284</a></span>
<span class=normal><a href=#__codelineno-0-285>285</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-283><a id=__codelineno-0-283 name=__codelineno-0-283></a><span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-0-284><a id=__codelineno-0-284 name=__codelineno-0-284></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Initialize Benchmark API.&quot;&quot;&quot;</span>
</span><span id=__span-0-285><a id=__codelineno-0-285 name=__codelineno-0-285></a>    <span class=bp>self</span><span class=o>.</span><span class=n>client</span> <span class=o>=</span> <span class=n>BenchmarkApi</span><span class=p>()</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.cli.BenchmarkCli.list class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">list</span> <a href=#nearai.cli.BenchmarkCli.list class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nb>list</span><span class=p>(</span><span class=nf>namespace</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>benchmark</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>solver</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>args</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>total</span><span class=p>:</span> <span class=n>int</span> <span class=o>=</span> <span class=mi>32</span><span class=p>,</span> <span class=n>offset</span><span class=p>:</span> <span class=n>int</span> <span class=o>=</span> <span class=mi>0</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>List all executed benchmarks.</p> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-377>377</a></span>
<span class=normal><a href=#__codelineno-0-378>378</a></span>
<span class=normal><a href=#__codelineno-0-379>379</a></span>
<span class=normal><a href=#__codelineno-0-380>380</a></span>
<span class=normal><a href=#__codelineno-0-381>381</a></span>
<span class=normal><a href=#__codelineno-0-382>382</a></span>
<span class=normal><a href=#__codelineno-0-383>383</a></span>
<span class=normal><a href=#__codelineno-0-384>384</a></span>
<span class=normal><a href=#__codelineno-0-385>385</a></span>
<span class=normal><a href=#__codelineno-0-386>386</a></span>
<span class=normal><a href=#__codelineno-0-387>387</a></span>
<span class=normal><a href=#__codelineno-0-388>388</a></span>
<span class=normal><a href=#__codelineno-0-389>389</a></span>
<span class=normal><a href=#__codelineno-0-390>390</a></span>
<span class=normal><a href=#__codelineno-0-391>391</a></span>
<span class=normal><a href=#__codelineno-0-392>392</a></span>
<span class=normal><a href=#__codelineno-0-393>393</a></span>
<span class=normal><a href=#__codelineno-0-394>394</a></span>
<span class=normal><a href=#__codelineno-0-395>395</a></span>
<span class=normal><a href=#__codelineno-0-396>396</a></span>
<span class=normal><a href=#__codelineno-0-397>397</a></span>
<span class=normal><a href=#__codelineno-0-398>398</a></span>
<span class=normal><a href=#__codelineno-0-399>399</a></span>
<span class=normal><a href=#__codelineno-0-400>400</a></span>
<span class=normal><a href=#__codelineno-0-401>401</a></span>
<span class=normal><a href=#__codelineno-0-402>402</a></span>
<span class=normal><a href=#__codelineno-0-403>403</a></span>
<span class=normal><a href=#__codelineno-0-404>404</a></span>
<span class=normal><a href=#__codelineno-0-405>405</a></span>
<span class=normal><a href=#__codelineno-0-406>406</a></span>
<span class=normal><a href=#__codelineno-0-407>407</a></span>
<span class=normal><a href=#__codelineno-0-408>408</a></span>
<span class=normal><a href=#__codelineno-0-409>409</a></span>
<span class=normal><a href=#__codelineno-0-410>410</a></span>
<span class=normal><a href=#__codelineno-0-411>411</a></span>
<span class=normal><a href=#__codelineno-0-412>412</a></span>
<span class=normal><a href=#__codelineno-0-413>413</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-377><a id=__codelineno-0-377 name=__codelineno-0-377></a><span class=k>def</span><span class=w> </span><span class=nf>list</span><span class=p>(</span>
</span><span id=__span-0-378><a id=__codelineno-0-378 name=__codelineno-0-378></a>    <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-379><a id=__codelineno-0-379 name=__codelineno-0-379></a>    <span class=n>namespace</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-380><a id=__codelineno-0-380 name=__codelineno-0-380></a>    <span class=n>benchmark</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-381><a id=__codelineno-0-381 name=__codelineno-0-381></a>    <span class=n>solver</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-382><a id=__codelineno-0-382 name=__codelineno-0-382></a>    <span class=n>args</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-383><a id=__codelineno-0-383 name=__codelineno-0-383></a>    <span class=n>total</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>32</span><span class=p>,</span>
</span><span id=__span-0-384><a id=__codelineno-0-384 name=__codelineno-0-384></a>    <span class=n>offset</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span>
</span><span id=__span-0-385><a id=__codelineno-0-385 name=__codelineno-0-385></a><span class=p>):</span>
</span><span id=__span-0-386><a id=__codelineno-0-386 name=__codelineno-0-386></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;List all executed benchmarks.&quot;&quot;&quot;</span>
</span><span id=__span-0-387><a id=__codelineno-0-387 name=__codelineno-0-387></a>    <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>list_benchmarks_v1_benchmark_list_get</span><span class=p>(</span>
</span><span id=__span-0-388><a id=__codelineno-0-388 name=__codelineno-0-388></a>        <span class=n>namespace</span><span class=o>=</span><span class=n>namespace</span><span class=p>,</span>
</span><span id=__span-0-389><a id=__codelineno-0-389 name=__codelineno-0-389></a>        <span class=n>benchmark_name</span><span class=o>=</span><span class=n>benchmark</span><span class=p>,</span>
</span><span id=__span-0-390><a id=__codelineno-0-390 name=__codelineno-0-390></a>        <span class=n>solver_name</span><span class=o>=</span><span class=n>solver</span><span class=p>,</span>
</span><span id=__span-0-391><a id=__codelineno-0-391 name=__codelineno-0-391></a>        <span class=n>solver_args</span><span class=o>=</span><span class=n>args</span><span class=p>,</span>
</span><span id=__span-0-392><a id=__codelineno-0-392 name=__codelineno-0-392></a>        <span class=n>total</span><span class=o>=</span><span class=n>total</span><span class=p>,</span>
</span><span id=__span-0-393><a id=__codelineno-0-393 name=__codelineno-0-393></a>        <span class=n>offset</span><span class=o>=</span><span class=n>offset</span><span class=p>,</span>
</span><span id=__span-0-394><a id=__codelineno-0-394 name=__codelineno-0-394></a>    <span class=p>)</span>
</span><span id=__span-0-395><a id=__codelineno-0-395 name=__codelineno-0-395></a>
</span><span id=__span-0-396><a id=__codelineno-0-396 name=__codelineno-0-396></a>    <span class=n>header</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;id&quot;</span><span class=p>,</span> <span class=s2>&quot;namespace&quot;</span><span class=p>,</span> <span class=s2>&quot;benchmark&quot;</span><span class=p>,</span> <span class=s2>&quot;solver&quot;</span><span class=p>,</span> <span class=s2>&quot;args&quot;</span><span class=p>,</span> <span class=s2>&quot;score&quot;</span><span class=p>,</span> <span class=s2>&quot;solved&quot;</span><span class=p>,</span> <span class=s2>&quot;total&quot;</span><span class=p>]</span>
</span><span id=__span-0-397><a id=__codelineno-0-397 name=__codelineno-0-397></a>    <span class=n>table</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-0-398><a id=__codelineno-0-398 name=__codelineno-0-398></a>    <span class=k>for</span> <span class=n>benchmark_output</span> <span class=ow>in</span> <span class=n>result</span><span class=p>:</span>
</span><span id=__span-0-399><a id=__codelineno-0-399 name=__codelineno-0-399></a>        <span class=n>score</span> <span class=o>=</span> <span class=mi>100</span> <span class=o>*</span> <span class=n>benchmark_output</span><span class=o>.</span><span class=n>solved</span> <span class=o>/</span> <span class=n>benchmark_output</span><span class=o>.</span><span class=n>total</span>
</span><span id=__span-0-400><a id=__codelineno-0-400 name=__codelineno-0-400></a>        <span class=n>table</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
</span><span id=__span-0-401><a id=__codelineno-0-401 name=__codelineno-0-401></a>            <span class=p>[</span>
</span><span id=__span-0-402><a id=__codelineno-0-402 name=__codelineno-0-402></a>                <span class=n>fill</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>benchmark_output</span><span class=o>.</span><span class=n>id</span><span class=p>)),</span>
</span><span id=__span-0-403><a id=__codelineno-0-403 name=__codelineno-0-403></a>                <span class=n>fill</span><span class=p>(</span><span class=n>benchmark_output</span><span class=o>.</span><span class=n>namespace</span><span class=p>),</span>
</span><span id=__span-0-404><a id=__codelineno-0-404 name=__codelineno-0-404></a>                <span class=n>fill</span><span class=p>(</span><span class=n>benchmark_output</span><span class=o>.</span><span class=n>benchmark</span><span class=p>),</span>
</span><span id=__span-0-405><a id=__codelineno-0-405 name=__codelineno-0-405></a>                <span class=n>fill</span><span class=p>(</span><span class=n>benchmark_output</span><span class=o>.</span><span class=n>solver</span><span class=p>),</span>
</span><span id=__span-0-406><a id=__codelineno-0-406 name=__codelineno-0-406></a>                <span class=n>fill</span><span class=p>(</span><span class=n>benchmark_output</span><span class=o>.</span><span class=n>args</span><span class=p>),</span>
</span><span id=__span-0-407><a id=__codelineno-0-407 name=__codelineno-0-407></a>                <span class=n>fill</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>score</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>%&quot;</span><span class=p>),</span>
</span><span id=__span-0-408><a id=__codelineno-0-408 name=__codelineno-0-408></a>                <span class=n>fill</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>benchmark_output</span><span class=o>.</span><span class=n>solved</span><span class=p>)),</span>
</span><span id=__span-0-409><a id=__codelineno-0-409 name=__codelineno-0-409></a>                <span class=n>fill</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>benchmark_output</span><span class=o>.</span><span class=n>total</span><span class=p>)),</span>
</span><span id=__span-0-410><a id=__codelineno-0-410 name=__codelineno-0-410></a>            <span class=p>]</span>
</span><span id=__span-0-411><a id=__codelineno-0-411 name=__codelineno-0-411></a>        <span class=p>)</span>
</span><span id=__span-0-412><a id=__codelineno-0-412 name=__codelineno-0-412></a>
</span><span id=__span-0-413><a id=__codelineno-0-413 name=__codelineno-0-413></a>    <span class=nb>print</span><span class=p>(</span><span class=n>tabulate</span><span class=p>(</span><span class=n>table</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>header</span><span class=p>,</span> <span class=n>tablefmt</span><span class=o>=</span><span class=s2>&quot;simple_grid&quot;</span><span class=p>))</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.cli.BenchmarkCli.run class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">run</span> <a href=#nearai.cli.BenchmarkCli.run class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>run</span><span class=p>(</span><span class=n>dataset</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>solver_strategy</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>max_concurrent</span><span class=p>:</span> <span class=n>int</span> <span class=o>=</span> <span class=mi>2</span><span class=p>,</span> <span class=n>force</span><span class=p>:</span> <span class=n>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span> <span class=n>subset</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>check_compatibility</span><span class=p>:</span> <span class=n>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span> <span class=n>record</span><span class=p>:</span> <span class=n>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span> <span class=n>num_inference_retries</span><span class=p>:</span> <span class=n>int</span> <span class=o>=</span> <span class=mi>10</span><span class=p>,</span> <span class=o>**</span><span class=n>solver_args</span><span class=p>:</span> <span class=n><span title=typing.Any>Any</span></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Run benchmark on a dataset with a solver strategy.</p> <p>It will cache the results in the database and subsequent runs will pull the results from the cache. If force is set to True, it will run the benchmark again and update the cache.</p> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-313>313</a></span>
<span class=normal><a href=#__codelineno-0-314>314</a></span>
<span class=normal><a href=#__codelineno-0-315>315</a></span>
<span class=normal><a href=#__codelineno-0-316>316</a></span>
<span class=normal><a href=#__codelineno-0-317>317</a></span>
<span class=normal><a href=#__codelineno-0-318>318</a></span>
<span class=normal><a href=#__codelineno-0-319>319</a></span>
<span class=normal><a href=#__codelineno-0-320>320</a></span>
<span class=normal><a href=#__codelineno-0-321>321</a></span>
<span class=normal><a href=#__codelineno-0-322>322</a></span>
<span class=normal><a href=#__codelineno-0-323>323</a></span>
<span class=normal><a href=#__codelineno-0-324>324</a></span>
<span class=normal><a href=#__codelineno-0-325>325</a></span>
<span class=normal><a href=#__codelineno-0-326>326</a></span>
<span class=normal><a href=#__codelineno-0-327>327</a></span>
<span class=normal><a href=#__codelineno-0-328>328</a></span>
<span class=normal><a href=#__codelineno-0-329>329</a></span>
<span class=normal><a href=#__codelineno-0-330>330</a></span>
<span class=normal><a href=#__codelineno-0-331>331</a></span>
<span class=normal><a href=#__codelineno-0-332>332</a></span>
<span class=normal><a href=#__codelineno-0-333>333</a></span>
<span class=normal><a href=#__codelineno-0-334>334</a></span>
<span class=normal><a href=#__codelineno-0-335>335</a></span>
<span class=normal><a href=#__codelineno-0-336>336</a></span>
<span class=normal><a href=#__codelineno-0-337>337</a></span>
<span class=normal><a href=#__codelineno-0-338>338</a></span>
<span class=normal><a href=#__codelineno-0-339>339</a></span>
<span class=normal><a href=#__codelineno-0-340>340</a></span>
<span class=normal><a href=#__codelineno-0-341>341</a></span>
<span class=normal><a href=#__codelineno-0-342>342</a></span>
<span class=normal><a href=#__codelineno-0-343>343</a></span>
<span class=normal><a href=#__codelineno-0-344>344</a></span>
<span class=normal><a href=#__codelineno-0-345>345</a></span>
<span class=normal><a href=#__codelineno-0-346>346</a></span>
<span class=normal><a href=#__codelineno-0-347>347</a></span>
<span class=normal><a href=#__codelineno-0-348>348</a></span>
<span class=normal><a href=#__codelineno-0-349>349</a></span>
<span class=normal><a href=#__codelineno-0-350>350</a></span>
<span class=normal><a href=#__codelineno-0-351>351</a></span>
<span class=normal><a href=#__codelineno-0-352>352</a></span>
<span class=normal><a href=#__codelineno-0-353>353</a></span>
<span class=normal><a href=#__codelineno-0-354>354</a></span>
<span class=normal><a href=#__codelineno-0-355>355</a></span>
<span class=normal><a href=#__codelineno-0-356>356</a></span>
<span class=normal><a href=#__codelineno-0-357>357</a></span>
<span class=normal><a href=#__codelineno-0-358>358</a></span>
<span class=normal><a href=#__codelineno-0-359>359</a></span>
<span class=normal><a href=#__codelineno-0-360>360</a></span>
<span class=normal><a href=#__codelineno-0-361>361</a></span>
<span class=normal><a href=#__codelineno-0-362>362</a></span>
<span class=normal><a href=#__codelineno-0-363>363</a></span>
<span class=normal><a href=#__codelineno-0-364>364</a></span>
<span class=normal><a href=#__codelineno-0-365>365</a></span>
<span class=normal><a href=#__codelineno-0-366>366</a></span>
<span class=normal><a href=#__codelineno-0-367>367</a></span>
<span class=normal><a href=#__codelineno-0-368>368</a></span>
<span class=normal><a href=#__codelineno-0-369>369</a></span>
<span class=normal><a href=#__codelineno-0-370>370</a></span>
<span class=normal><a href=#__codelineno-0-371>371</a></span>
<span class=normal><a href=#__codelineno-0-372>372</a></span>
<span class=normal><a href=#__codelineno-0-373>373</a></span>
<span class=normal><a href=#__codelineno-0-374>374</a></span>
<span class=normal><a href=#__codelineno-0-375>375</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-313><a id=__codelineno-0-313 name=__codelineno-0-313></a><span class=k>def</span><span class=w> </span><span class=nf>run</span><span class=p>(</span>
</span><span id=__span-0-314><a id=__codelineno-0-314 name=__codelineno-0-314></a>    <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-315><a id=__codelineno-0-315 name=__codelineno-0-315></a>    <span class=n>dataset</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-316><a id=__codelineno-0-316 name=__codelineno-0-316></a>    <span class=n>solver_strategy</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-317><a id=__codelineno-0-317 name=__codelineno-0-317></a>    <span class=n>max_concurrent</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>2</span><span class=p>,</span>
</span><span id=__span-0-318><a id=__codelineno-0-318 name=__codelineno-0-318></a>    <span class=n>force</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-319><a id=__codelineno-0-319 name=__codelineno-0-319></a>    <span class=n>subset</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-320><a id=__codelineno-0-320 name=__codelineno-0-320></a>    <span class=n>check_compatibility</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-321><a id=__codelineno-0-321 name=__codelineno-0-321></a>    <span class=n>record</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-322><a id=__codelineno-0-322 name=__codelineno-0-322></a>    <span class=n>num_inference_retries</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>10</span><span class=p>,</span>
</span><span id=__span-0-323><a id=__codelineno-0-323 name=__codelineno-0-323></a>    <span class=o>**</span><span class=n>solver_args</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span>
</span><span id=__span-0-324><a id=__codelineno-0-324 name=__codelineno-0-324></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-325><a id=__codelineno-0-325 name=__codelineno-0-325></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Run benchmark on a dataset with a solver strategy.</span>
</span><span id=__span-0-326><a id=__codelineno-0-326 name=__codelineno-0-326></a>
</span><span id=__span-0-327><a id=__codelineno-0-327 name=__codelineno-0-327></a><span class=sd>    It will cache the results in the database and subsequent runs will pull the results from the cache.</span>
</span><span id=__span-0-328><a id=__codelineno-0-328 name=__codelineno-0-328></a><span class=sd>    If force is set to True, it will run the benchmark again and update the cache.</span>
</span><span id=__span-0-329><a id=__codelineno-0-329 name=__codelineno-0-329></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-330><a id=__codelineno-0-330 name=__codelineno-0-330></a>    <span class=kn>from</span><span class=w> </span><span class=nn>nearai.benchmark</span><span class=w> </span><span class=kn>import</span> <span class=n>BenchmarkExecutor</span><span class=p>,</span> <span class=n>DatasetInfo</span>
</span><span id=__span-0-331><a id=__codelineno-0-331 name=__codelineno-0-331></a>    <span class=kn>from</span><span class=w> </span><span class=nn>nearai.dataset</span><span class=w> </span><span class=kn>import</span> <span class=n>get_dataset</span><span class=p>,</span> <span class=n>load_dataset</span>
</span><span id=__span-0-332><a id=__codelineno-0-332 name=__codelineno-0-332></a>    <span class=kn>from</span><span class=w> </span><span class=nn>nearai.solvers</span><span class=w> </span><span class=kn>import</span> <span class=n>SolverScoringMethod</span><span class=p>,</span> <span class=n>SolverStrategy</span><span class=p>,</span> <span class=n>SolverStrategyRegistry</span>
</span><span id=__span-0-333><a id=__codelineno-0-333 name=__codelineno-0-333></a>
</span><span id=__span-0-334><a id=__codelineno-0-334 name=__codelineno-0-334></a>    <span class=n>CONFIG</span><span class=o>.</span><span class=n>num_inference_retries</span> <span class=o>=</span> <span class=n>num_inference_retries</span>
</span><span id=__span-0-335><a id=__codelineno-0-335 name=__codelineno-0-335></a>
</span><span id=__span-0-336><a id=__codelineno-0-336 name=__codelineno-0-336></a>    <span class=n>args</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span><span class=n>solver_args</span><span class=p>)</span>
</span><span id=__span-0-337><a id=__codelineno-0-337 name=__codelineno-0-337></a>    <span class=k>if</span> <span class=n>subset</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-338><a id=__codelineno-0-338 name=__codelineno-0-338></a>        <span class=n>args</span><span class=p>[</span><span class=s2>&quot;subset&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>subset</span>
</span><span id=__span-0-339><a id=__codelineno-0-339 name=__codelineno-0-339></a>
</span><span id=__span-0-340><a id=__codelineno-0-340 name=__codelineno-0-340></a>    <span class=n>benchmark_id</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_or_create_benchmark</span><span class=p>(</span>
</span><span id=__span-0-341><a id=__codelineno-0-341 name=__codelineno-0-341></a>        <span class=n>benchmark_name</span><span class=o>=</span><span class=n>dataset</span><span class=p>,</span>
</span><span id=__span-0-342><a id=__codelineno-0-342 name=__codelineno-0-342></a>        <span class=n>solver_name</span><span class=o>=</span><span class=n>solver_strategy</span><span class=p>,</span>
</span><span id=__span-0-343><a id=__codelineno-0-343 name=__codelineno-0-343></a>        <span class=n>args</span><span class=o>=</span><span class=n>args</span><span class=p>,</span>
</span><span id=__span-0-344><a id=__codelineno-0-344 name=__codelineno-0-344></a>        <span class=n>force</span><span class=o>=</span><span class=n>force</span><span class=p>,</span>
</span><span id=__span-0-345><a id=__codelineno-0-345 name=__codelineno-0-345></a>    <span class=p>)</span>
</span><span id=__span-0-346><a id=__codelineno-0-346 name=__codelineno-0-346></a>
</span><span id=__span-0-347><a id=__codelineno-0-347 name=__codelineno-0-347></a>    <span class=n>solver_strategy_class</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>SolverStrategy</span><span class=p>,</span> <span class=kc>None</span><span class=p>]</span> <span class=o>=</span> <span class=n>SolverStrategyRegistry</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>solver_strategy</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
</span><span id=__span-0-348><a id=__codelineno-0-348 name=__codelineno-0-348></a>    <span class=k>assert</span> <span class=p>(</span>
</span><span id=__span-0-349><a id=__codelineno-0-349 name=__codelineno-0-349></a>        <span class=n>solver_strategy_class</span>
</span><span id=__span-0-350><a id=__codelineno-0-350 name=__codelineno-0-350></a>    <span class=p>),</span> <span class=sa>f</span><span class=s2>&quot;Solver strategy </span><span class=si>{</span><span class=n>solver_strategy</span><span class=si>}</span><span class=s2> not found. Available strategies: </span><span class=si>{</span><span class=nb>list</span><span class=p>(</span><span class=n>SolverStrategyRegistry</span><span class=o>.</span><span class=n>keys</span><span class=p>())</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-351><a id=__codelineno-0-351 name=__codelineno-0-351></a>
</span><span id=__span-0-352><a id=__codelineno-0-352 name=__codelineno-0-352></a>    <span class=n>name</span> <span class=o>=</span> <span class=n>dataset</span>
</span><span id=__span-0-353><a id=__codelineno-0-353 name=__codelineno-0-353></a>    <span class=k>if</span> <span class=n>solver_strategy_class</span><span class=o>.</span><span class=n>scoring_method</span> <span class=o>==</span> <span class=n>SolverScoringMethod</span><span class=o>.</span><span class=n>Custom</span><span class=p>:</span>
</span><span id=__span-0-354><a id=__codelineno-0-354 name=__codelineno-0-354></a>        <span class=n>dataset</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>get_dataset</span><span class=p>(</span><span class=n>dataset</span><span class=p>))</span>
</span><span id=__span-0-355><a id=__codelineno-0-355 name=__codelineno-0-355></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-356><a id=__codelineno-0-356 name=__codelineno-0-356></a>        <span class=n>dataset</span> <span class=o>=</span> <span class=n>load_dataset</span><span class=p>(</span><span class=n>dataset</span><span class=p>)</span>
</span><span id=__span-0-357><a id=__codelineno-0-357 name=__codelineno-0-357></a>
</span><span id=__span-0-358><a id=__codelineno-0-358 name=__codelineno-0-358></a>    <span class=n>solver_strategy_obj</span><span class=p>:</span> <span class=n>SolverStrategy</span> <span class=o>=</span> <span class=n>solver_strategy_class</span><span class=p>(</span><span class=n>dataset_ref</span><span class=o>=</span><span class=n>dataset</span><span class=p>,</span> <span class=o>**</span><span class=n>solver_args</span><span class=p>)</span>  <span class=c1># type: ignore</span>
</span><span id=__span-0-359><a id=__codelineno-0-359 name=__codelineno-0-359></a>    <span class=k>if</span> <span class=n>check_compatibility</span><span class=p>:</span>
</span><span id=__span-0-360><a id=__codelineno-0-360 name=__codelineno-0-360></a>        <span class=k>assert</span> <span class=n>name</span> <span class=ow>in</span> <span class=n>solver_strategy_obj</span><span class=o>.</span><span class=n>compatible_datasets</span><span class=p>()</span> <span class=ow>or</span> <span class=nb>any</span><span class=p>(</span>
</span><span id=__span-0-361><a id=__codelineno-0-361 name=__codelineno-0-361></a>            <span class=nb>map</span><span class=p>(</span><span class=k>lambda</span> <span class=n>n</span><span class=p>:</span> <span class=n>n</span> <span class=ow>in</span> <span class=n>name</span><span class=p>,</span> <span class=n>solver_strategy_obj</span><span class=o>.</span><span class=n>compatible_datasets</span><span class=p>())</span>
</span><span id=__span-0-362><a id=__codelineno-0-362 name=__codelineno-0-362></a>        <span class=p>),</span> <span class=sa>f</span><span class=s2>&quot;Solver strategy </span><span class=si>{</span><span class=n>solver_strategy</span><span class=si>}</span><span class=s2> is not compatible with dataset </span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-363><a id=__codelineno-0-363 name=__codelineno-0-363></a>
</span><span id=__span-0-364><a id=__codelineno-0-364 name=__codelineno-0-364></a>    <span class=n>dest_path</span> <span class=o>=</span> <span class=n>get_registry_folder</span><span class=p>()</span> <span class=o>/</span> <span class=n>name</span>
</span><span id=__span-0-365><a id=__codelineno-0-365 name=__codelineno-0-365></a>    <span class=n>metadata_path</span> <span class=o>=</span> <span class=n>dest_path</span> <span class=o>/</span> <span class=s2>&quot;metadata.json&quot;</span>
</span><span id=__span-0-366><a id=__codelineno-0-366 name=__codelineno-0-366></a>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>metadata_path</span><span class=p>,</span> <span class=s2>&quot;r&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>file</span><span class=p>:</span>
</span><span id=__span-0-367><a id=__codelineno-0-367 name=__codelineno-0-367></a>        <span class=n>metadata</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>file</span><span class=p>)</span>
</span><span id=__span-0-368><a id=__codelineno-0-368 name=__codelineno-0-368></a>
</span><span id=__span-0-369><a id=__codelineno-0-369 name=__codelineno-0-369></a>    <span class=n>be</span> <span class=o>=</span> <span class=n>BenchmarkExecutor</span><span class=p>(</span>
</span><span id=__span-0-370><a id=__codelineno-0-370 name=__codelineno-0-370></a>        <span class=n>DatasetInfo</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>subset</span><span class=p>,</span> <span class=n>dataset</span><span class=p>,</span> <span class=n>metadata</span><span class=p>),</span> <span class=n>solver_strategy_obj</span><span class=p>,</span> <span class=n>benchmark_id</span><span class=o>=</span><span class=n>benchmark_id</span>
</span><span id=__span-0-371><a id=__codelineno-0-371 name=__codelineno-0-371></a>    <span class=p>)</span>
</span><span id=__span-0-372><a id=__codelineno-0-372 name=__codelineno-0-372></a>
</span><span id=__span-0-373><a id=__codelineno-0-373 name=__codelineno-0-373></a>    <span class=n>cpu_count</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>cpu_count</span><span class=p>()</span>
</span><span id=__span-0-374><a id=__codelineno-0-374 name=__codelineno-0-374></a>    <span class=n>max_concurrent</span> <span class=o>=</span> <span class=p>(</span><span class=n>cpu_count</span> <span class=k>if</span> <span class=n>cpu_count</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=k>else</span> <span class=mi>1</span><span class=p>)</span> <span class=k>if</span> <span class=n>max_concurrent</span> <span class=o>&lt;</span> <span class=mi>0</span> <span class=k>else</span> <span class=n>max_concurrent</span>
</span><span id=__span-0-375><a id=__codelineno-0-375 name=__codelineno-0-375></a>    <span class=n>be</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>max_concurrent</span><span class=o>=</span><span class=n>max_concurrent</span><span class=p>,</span> <span class=n>record</span><span class=o>=</span><span class=n>record</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h4 id=nearai.cli.CLI class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">CLI</span> <a href=#nearai.cli.CLI class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1118>1118</a></span>
<span class=normal><a href=#__codelineno-0-1119>1119</a></span>
<span class=normal><a href=#__codelineno-0-1120>1120</a></span>
<span class=normal><a href=#__codelineno-0-1121>1121</a></span>
<span class=normal><a href=#__codelineno-0-1122>1122</a></span>
<span class=normal><a href=#__codelineno-0-1123>1123</a></span>
<span class=normal><a href=#__codelineno-0-1124>1124</a></span>
<span class=normal><a href=#__codelineno-0-1125>1125</a></span>
<span class=normal><a href=#__codelineno-0-1126>1126</a></span>
<span class=normal><a href=#__codelineno-0-1127>1127</a></span>
<span class=normal><a href=#__codelineno-0-1128>1128</a></span>
<span class=normal><a href=#__codelineno-0-1129>1129</a></span>
<span class=normal><a href=#__codelineno-0-1130>1130</a></span>
<span class=normal><a href=#__codelineno-0-1131>1131</a></span>
<span class=normal><a href=#__codelineno-0-1132>1132</a></span>
<span class=normal><a href=#__codelineno-0-1133>1133</a></span>
<span class=normal><a href=#__codelineno-0-1134>1134</a></span>
<span class=normal><a href=#__codelineno-0-1135>1135</a></span>
<span class=normal><a href=#__codelineno-0-1136>1136</a></span>
<span class=normal><a href=#__codelineno-0-1137>1137</a></span>
<span class=normal><a href=#__codelineno-0-1138>1138</a></span>
<span class=normal><a href=#__codelineno-0-1139>1139</a></span>
<span class=normal><a href=#__codelineno-0-1140>1140</a></span>
<span class=normal><a href=#__codelineno-0-1141>1141</a></span>
<span class=normal><a href=#__codelineno-0-1142>1142</a></span>
<span class=normal><a href=#__codelineno-0-1143>1143</a></span>
<span class=normal><a href=#__codelineno-0-1144>1144</a></span>
<span class=normal><a href=#__codelineno-0-1145>1145</a></span>
<span class=normal><a href=#__codelineno-0-1146>1146</a></span>
<span class=normal><a href=#__codelineno-0-1147>1147</a></span>
<span class=normal><a href=#__codelineno-0-1148>1148</a></span>
<span class=normal><a href=#__codelineno-0-1149>1149</a></span>
<span class=normal><a href=#__codelineno-0-1150>1150</a></span>
<span class=normal><a href=#__codelineno-0-1151>1151</a></span>
<span class=normal><a href=#__codelineno-0-1152>1152</a></span>
<span class=normal><a href=#__codelineno-0-1153>1153</a></span>
<span class=normal><a href=#__codelineno-0-1154>1154</a></span>
<span class=normal><a href=#__codelineno-0-1155>1155</a></span>
<span class=normal><a href=#__codelineno-0-1156>1156</a></span>
<span class=normal><a href=#__codelineno-0-1157>1157</a></span>
<span class=normal><a href=#__codelineno-0-1158>1158</a></span>
<span class=normal><a href=#__codelineno-0-1159>1159</a></span>
<span class=normal><a href=#__codelineno-0-1160>1160</a></span>
<span class=normal><a href=#__codelineno-0-1161>1161</a></span>
<span class=normal><a href=#__codelineno-0-1162>1162</a></span>
<span class=normal><a href=#__codelineno-0-1163>1163</a></span>
<span class=normal><a href=#__codelineno-0-1164>1164</a></span>
<span class=normal><a href=#__codelineno-0-1165>1165</a></span>
<span class=normal><a href=#__codelineno-0-1166>1166</a></span>
<span class=normal><a href=#__codelineno-0-1167>1167</a></span>
<span class=normal><a href=#__codelineno-0-1168>1168</a></span>
<span class=normal><a href=#__codelineno-0-1169>1169</a></span>
<span class=normal><a href=#__codelineno-0-1170>1170</a></span>
<span class=normal><a href=#__codelineno-0-1171>1171</a></span>
<span class=normal><a href=#__codelineno-0-1172>1172</a></span>
<span class=normal><a href=#__codelineno-0-1173>1173</a></span>
<span class=normal><a href=#__codelineno-0-1174>1174</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1118><a id=__codelineno-0-1118 name=__codelineno-0-1118></a><span class=k>class</span><span class=w> </span><span class=nc>CLI</span><span class=p>:</span>
</span><span id=__span-0-1119><a id=__codelineno-0-1119 name=__codelineno-0-1119></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>  <span class=c1># noqa: D107</span>
</span><span id=__span-0-1120><a id=__codelineno-0-1120 name=__codelineno-0-1120></a>        <span class=bp>self</span><span class=o>.</span><span class=n>registry</span> <span class=o>=</span> <span class=n>RegistryCli</span><span class=p>()</span>
</span><span id=__span-0-1121><a id=__codelineno-0-1121 name=__codelineno-0-1121></a>        <span class=bp>self</span><span class=o>.</span><span class=n>login</span> <span class=o>=</span> <span class=n>LoginCLI</span><span class=p>()</span>
</span><span id=__span-0-1122><a id=__codelineno-0-1122 name=__codelineno-0-1122></a>        <span class=bp>self</span><span class=o>.</span><span class=n>logout</span> <span class=o>=</span> <span class=n>LogoutCLI</span><span class=p>()</span>
</span><span id=__span-0-1123><a id=__codelineno-0-1123 name=__codelineno-0-1123></a>        <span class=bp>self</span><span class=o>.</span><span class=n>hub</span> <span class=o>=</span> <span class=n>HubCLI</span><span class=p>()</span>
</span><span id=__span-0-1124><a id=__codelineno-0-1124 name=__codelineno-0-1124></a>        <span class=bp>self</span><span class=o>.</span><span class=n>log</span> <span class=o>=</span> <span class=n>LogCLI</span><span class=p>()</span>
</span><span id=__span-0-1125><a id=__codelineno-0-1125 name=__codelineno-0-1125></a>
</span><span id=__span-0-1126><a id=__codelineno-0-1126 name=__codelineno-0-1126></a>        <span class=bp>self</span><span class=o>.</span><span class=n>config</span> <span class=o>=</span> <span class=n>ConfigCli</span><span class=p>()</span>
</span><span id=__span-0-1127><a id=__codelineno-0-1127 name=__codelineno-0-1127></a>        <span class=bp>self</span><span class=o>.</span><span class=n>benchmark</span> <span class=o>=</span> <span class=n>BenchmarkCli</span><span class=p>()</span>
</span><span id=__span-0-1128><a id=__codelineno-0-1128 name=__codelineno-0-1128></a>        <span class=bp>self</span><span class=o>.</span><span class=n>evaluation</span> <span class=o>=</span> <span class=n>EvaluationCli</span><span class=p>()</span>
</span><span id=__span-0-1129><a id=__codelineno-0-1129 name=__codelineno-0-1129></a>        <span class=bp>self</span><span class=o>.</span><span class=n>agent</span> <span class=o>=</span> <span class=n>AgentCli</span><span class=p>()</span>
</span><span id=__span-0-1130><a id=__codelineno-0-1130 name=__codelineno-0-1130></a>        <span class=bp>self</span><span class=o>.</span><span class=n>finetune</span> <span class=o>=</span> <span class=n>FinetuneCli</span><span class=p>()</span>
</span><span id=__span-0-1131><a id=__codelineno-0-1131 name=__codelineno-0-1131></a>        <span class=bp>self</span><span class=o>.</span><span class=n>tensorboard</span> <span class=o>=</span> <span class=n>TensorboardCli</span><span class=p>()</span>
</span><span id=__span-0-1132><a id=__codelineno-0-1132 name=__codelineno-0-1132></a>        <span class=bp>self</span><span class=o>.</span><span class=n>vllm</span> <span class=o>=</span> <span class=n>VllmCli</span><span class=p>()</span>
</span><span id=__span-0-1133><a id=__codelineno-0-1133 name=__codelineno-0-1133></a>        <span class=bp>self</span><span class=o>.</span><span class=n>permission</span> <span class=o>=</span> <span class=n>PermissionCli</span><span class=p>()</span>
</span><span id=__span-0-1134><a id=__codelineno-0-1134 name=__codelineno-0-1134></a>
</span><span id=__span-0-1135><a id=__codelineno-0-1135 name=__codelineno-0-1135></a>    <span class=k>def</span><span class=w> </span><span class=nf>submit</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>path</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>worker_kind</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>WorkerKind</span><span class=o>.</span><span class=n>GPU_8_A100</span><span class=o>.</span><span class=n>value</span><span class=p>):</span>
</span><span id=__span-0-1136><a id=__codelineno-0-1136 name=__codelineno-0-1136></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Submit a task to be executed by a worker.&quot;&quot;&quot;</span>
</span><span id=__span-0-1137><a id=__codelineno-0-1137 name=__codelineno-0-1137></a>        <span class=k>if</span> <span class=n>path</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-1138><a id=__codelineno-0-1138 name=__codelineno-0-1138></a>            <span class=n>path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getcwd</span><span class=p>()</span>
</span><span id=__span-0-1139><a id=__codelineno-0-1139 name=__codelineno-0-1139></a>
</span><span id=__span-0-1140><a id=__codelineno-0-1140 name=__codelineno-0-1140></a>        <span class=n>worker_kind_t</span> <span class=o>=</span> <span class=n>WorkerKind</span><span class=p>(</span><span class=n>worker_kind</span><span class=p>)</span>
</span><span id=__span-0-1141><a id=__codelineno-0-1141 name=__codelineno-0-1141></a>
</span><span id=__span-0-1142><a id=__codelineno-0-1142 name=__codelineno-0-1142></a>        <span class=n>location</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>registry</span><span class=o>.</span><span class=n>upload</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
</span><span id=__span-0-1143><a id=__codelineno-0-1143 name=__codelineno-0-1143></a>
</span><span id=__span-0-1144><a id=__codelineno-0-1144 name=__codelineno-0-1144></a>        <span class=n>delegation_api</span> <span class=o>=</span> <span class=n>DelegationApi</span><span class=p>()</span>
</span><span id=__span-0-1145><a id=__codelineno-0-1145 name=__codelineno-0-1145></a>        <span class=n>delegation_api</span><span class=o>.</span><span class=n>delegate_v1_delegation_delegate_post</span><span class=p>(</span>
</span><span id=__span-0-1146><a id=__codelineno-0-1146 name=__codelineno-0-1146></a>            <span class=n>delegate_account_id</span><span class=o>=</span><span class=n>CONFIG</span><span class=o>.</span><span class=n>scheduler_account_id</span><span class=p>,</span>
</span><span id=__span-0-1147><a id=__codelineno-0-1147 name=__codelineno-0-1147></a>            <span class=n>expires_at</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span> <span class=o>+</span> <span class=n>timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=mi>1</span><span class=p>),</span>
</span><span id=__span-0-1148><a id=__codelineno-0-1148 name=__codelineno-0-1148></a>        <span class=p>)</span>
</span><span id=__span-0-1149><a id=__codelineno-0-1149 name=__codelineno-0-1149></a>
</span><span id=__span-0-1150><a id=__codelineno-0-1150 name=__codelineno-0-1150></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-1151><a id=__codelineno-0-1151 name=__codelineno-0-1151></a>            <span class=n>client</span> <span class=o>=</span> <span class=n>JobsApi</span><span class=p>()</span>
</span><span id=__span-0-1152><a id=__codelineno-0-1152 name=__codelineno-0-1152></a>            <span class=n>client</span><span class=o>.</span><span class=n>add_job_v1_jobs_add_job_post</span><span class=p>(</span>
</span><span id=__span-0-1153><a id=__codelineno-0-1153 name=__codelineno-0-1153></a>                <span class=n>worker_kind_t</span><span class=p>,</span>
</span><span id=__span-0-1154><a id=__codelineno-0-1154 name=__codelineno-0-1154></a>                <span class=n>BodyAddJobV1JobsAddJobPost</span><span class=p>(</span><span class=n>entry_location</span><span class=o>=</span><span class=n>location</span><span class=p>),</span>
</span><span id=__span-0-1155><a id=__codelineno-0-1155 name=__codelineno-0-1155></a>            <span class=p>)</span>
</span><span id=__span-0-1156><a id=__codelineno-0-1156 name=__codelineno-0-1156></a>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-1157><a id=__codelineno-0-1157 name=__codelineno-0-1157></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Error: &quot;</span><span class=p>,</span> <span class=n>e</span><span class=p>)</span>
</span><span id=__span-0-1158><a id=__codelineno-0-1158 name=__codelineno-0-1158></a>            <span class=n>delegation_api</span><span class=o>.</span><span class=n>revoke_delegation_v1_delegation_revoke_delegation_post</span><span class=p>(</span>
</span><span id=__span-0-1159><a id=__codelineno-0-1159 name=__codelineno-0-1159></a>                <span class=n>delegate_account_id</span><span class=o>=</span><span class=n>CONFIG</span><span class=o>.</span><span class=n>scheduler_account_id</span><span class=p>,</span>
</span><span id=__span-0-1160><a id=__codelineno-0-1160 name=__codelineno-0-1160></a>            <span class=p>)</span>
</span><span id=__span-0-1161><a id=__codelineno-0-1161 name=__codelineno-0-1161></a>
</span><span id=__span-0-1162><a id=__codelineno-0-1162 name=__codelineno-0-1162></a>    <span class=k>def</span><span class=w> </span><span class=nf>location</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-1163><a id=__codelineno-0-1163 name=__codelineno-0-1163></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Show location where nearai is installed.&quot;&quot;&quot;</span>
</span><span id=__span-0-1164><a id=__codelineno-0-1164 name=__codelineno-0-1164></a>        <span class=kn>from</span><span class=w> </span><span class=nn>nearai</span><span class=w> </span><span class=kn>import</span> <span class=n>cli_path</span>
</span><span id=__span-0-1165><a id=__codelineno-0-1165 name=__codelineno-0-1165></a>
</span><span id=__span-0-1166><a id=__codelineno-0-1166 name=__codelineno-0-1166></a>        <span class=nb>print</span><span class=p>(</span><span class=n>cli_path</span><span class=p>())</span>
</span><span id=__span-0-1167><a id=__codelineno-0-1167 name=__codelineno-0-1167></a>
</span><span id=__span-0-1168><a id=__codelineno-0-1168 name=__codelineno-0-1168></a>    <span class=k>def</span><span class=w> </span><span class=nf>version</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-0-1169><a id=__codelineno-0-1169 name=__codelineno-0-1169></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Show nearai version.&quot;&quot;&quot;</span>
</span><span id=__span-0-1170><a id=__codelineno-0-1170 name=__codelineno-0-1170></a>        <span class=nb>print</span><span class=p>(</span><span class=n>importlib</span><span class=o>.</span><span class=n>metadata</span><span class=o>.</span><span class=n>version</span><span class=p>(</span><span class=s2>&quot;nearai&quot;</span><span class=p>))</span>
</span><span id=__span-0-1171><a id=__codelineno-0-1171 name=__codelineno-0-1171></a>
</span><span id=__span-0-1172><a id=__codelineno-0-1172 name=__codelineno-0-1172></a>    <span class=k>def</span><span class=w> </span><span class=nf>task</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span><span id=__span-0-1173><a id=__codelineno-0-1173 name=__codelineno-0-1173></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;CLI command for running a single task.&quot;&quot;&quot;</span>
</span><span id=__span-0-1174><a id=__codelineno-0-1174 name=__codelineno-0-1174></a>        <span class=bp>self</span><span class=o>.</span><span class=n>agent</span><span class=o>.</span><span class=n>task_cli</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h5 id=nearai.cli.CLI.location class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">location</span> <a href=#nearai.cli.CLI.location class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>location</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Show location where nearai is installed.</p> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1162>1162</a></span>
<span class=normal><a href=#__codelineno-0-1163>1163</a></span>
<span class=normal><a href=#__codelineno-0-1164>1164</a></span>
<span class=normal><a href=#__codelineno-0-1165>1165</a></span>
<span class=normal><a href=#__codelineno-0-1166>1166</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1162><a id=__codelineno-0-1162 name=__codelineno-0-1162></a><span class=k>def</span><span class=w> </span><span class=nf>location</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-1163><a id=__codelineno-0-1163 name=__codelineno-0-1163></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Show location where nearai is installed.&quot;&quot;&quot;</span>
</span><span id=__span-0-1164><a id=__codelineno-0-1164 name=__codelineno-0-1164></a>    <span class=kn>from</span><span class=w> </span><span class=nn>nearai</span><span class=w> </span><span class=kn>import</span> <span class=n>cli_path</span>
</span><span id=__span-0-1165><a id=__codelineno-0-1165 name=__codelineno-0-1165></a>
</span><span id=__span-0-1166><a id=__codelineno-0-1166 name=__codelineno-0-1166></a>    <span class=nb>print</span><span class=p>(</span><span class=n>cli_path</span><span class=p>())</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.cli.CLI.submit class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">submit</span> <a href=#nearai.cli.CLI.submit class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>submit</span><span class=p>(</span><span class=n>path</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>worker_kind</span><span class=p>:</span> <span class=n>str</span> <span class=o>=</span> <span class=n><span title=nearai.openapi_client.api.jobs_api.WorkerKind.GPU_8_A100>GPU_8_A100</span></span><span class=o>.</span><span class=n>value</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Submit a task to be executed by a worker.</p> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1135>1135</a></span>
<span class=normal><a href=#__codelineno-0-1136>1136</a></span>
<span class=normal><a href=#__codelineno-0-1137>1137</a></span>
<span class=normal><a href=#__codelineno-0-1138>1138</a></span>
<span class=normal><a href=#__codelineno-0-1139>1139</a></span>
<span class=normal><a href=#__codelineno-0-1140>1140</a></span>
<span class=normal><a href=#__codelineno-0-1141>1141</a></span>
<span class=normal><a href=#__codelineno-0-1142>1142</a></span>
<span class=normal><a href=#__codelineno-0-1143>1143</a></span>
<span class=normal><a href=#__codelineno-0-1144>1144</a></span>
<span class=normal><a href=#__codelineno-0-1145>1145</a></span>
<span class=normal><a href=#__codelineno-0-1146>1146</a></span>
<span class=normal><a href=#__codelineno-0-1147>1147</a></span>
<span class=normal><a href=#__codelineno-0-1148>1148</a></span>
<span class=normal><a href=#__codelineno-0-1149>1149</a></span>
<span class=normal><a href=#__codelineno-0-1150>1150</a></span>
<span class=normal><a href=#__codelineno-0-1151>1151</a></span>
<span class=normal><a href=#__codelineno-0-1152>1152</a></span>
<span class=normal><a href=#__codelineno-0-1153>1153</a></span>
<span class=normal><a href=#__codelineno-0-1154>1154</a></span>
<span class=normal><a href=#__codelineno-0-1155>1155</a></span>
<span class=normal><a href=#__codelineno-0-1156>1156</a></span>
<span class=normal><a href=#__codelineno-0-1157>1157</a></span>
<span class=normal><a href=#__codelineno-0-1158>1158</a></span>
<span class=normal><a href=#__codelineno-0-1159>1159</a></span>
<span class=normal><a href=#__codelineno-0-1160>1160</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1135><a id=__codelineno-0-1135 name=__codelineno-0-1135></a><span class=k>def</span><span class=w> </span><span class=nf>submit</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>path</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>worker_kind</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>WorkerKind</span><span class=o>.</span><span class=n>GPU_8_A100</span><span class=o>.</span><span class=n>value</span><span class=p>):</span>
</span><span id=__span-0-1136><a id=__codelineno-0-1136 name=__codelineno-0-1136></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Submit a task to be executed by a worker.&quot;&quot;&quot;</span>
</span><span id=__span-0-1137><a id=__codelineno-0-1137 name=__codelineno-0-1137></a>    <span class=k>if</span> <span class=n>path</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-1138><a id=__codelineno-0-1138 name=__codelineno-0-1138></a>        <span class=n>path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getcwd</span><span class=p>()</span>
</span><span id=__span-0-1139><a id=__codelineno-0-1139 name=__codelineno-0-1139></a>
</span><span id=__span-0-1140><a id=__codelineno-0-1140 name=__codelineno-0-1140></a>    <span class=n>worker_kind_t</span> <span class=o>=</span> <span class=n>WorkerKind</span><span class=p>(</span><span class=n>worker_kind</span><span class=p>)</span>
</span><span id=__span-0-1141><a id=__codelineno-0-1141 name=__codelineno-0-1141></a>
</span><span id=__span-0-1142><a id=__codelineno-0-1142 name=__codelineno-0-1142></a>    <span class=n>location</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>registry</span><span class=o>.</span><span class=n>upload</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
</span><span id=__span-0-1143><a id=__codelineno-0-1143 name=__codelineno-0-1143></a>
</span><span id=__span-0-1144><a id=__codelineno-0-1144 name=__codelineno-0-1144></a>    <span class=n>delegation_api</span> <span class=o>=</span> <span class=n>DelegationApi</span><span class=p>()</span>
</span><span id=__span-0-1145><a id=__codelineno-0-1145 name=__codelineno-0-1145></a>    <span class=n>delegation_api</span><span class=o>.</span><span class=n>delegate_v1_delegation_delegate_post</span><span class=p>(</span>
</span><span id=__span-0-1146><a id=__codelineno-0-1146 name=__codelineno-0-1146></a>        <span class=n>delegate_account_id</span><span class=o>=</span><span class=n>CONFIG</span><span class=o>.</span><span class=n>scheduler_account_id</span><span class=p>,</span>
</span><span id=__span-0-1147><a id=__codelineno-0-1147 name=__codelineno-0-1147></a>        <span class=n>expires_at</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span> <span class=o>+</span> <span class=n>timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=mi>1</span><span class=p>),</span>
</span><span id=__span-0-1148><a id=__codelineno-0-1148 name=__codelineno-0-1148></a>    <span class=p>)</span>
</span><span id=__span-0-1149><a id=__codelineno-0-1149 name=__codelineno-0-1149></a>
</span><span id=__span-0-1150><a id=__codelineno-0-1150 name=__codelineno-0-1150></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-1151><a id=__codelineno-0-1151 name=__codelineno-0-1151></a>        <span class=n>client</span> <span class=o>=</span> <span class=n>JobsApi</span><span class=p>()</span>
</span><span id=__span-0-1152><a id=__codelineno-0-1152 name=__codelineno-0-1152></a>        <span class=n>client</span><span class=o>.</span><span class=n>add_job_v1_jobs_add_job_post</span><span class=p>(</span>
</span><span id=__span-0-1153><a id=__codelineno-0-1153 name=__codelineno-0-1153></a>            <span class=n>worker_kind_t</span><span class=p>,</span>
</span><span id=__span-0-1154><a id=__codelineno-0-1154 name=__codelineno-0-1154></a>            <span class=n>BodyAddJobV1JobsAddJobPost</span><span class=p>(</span><span class=n>entry_location</span><span class=o>=</span><span class=n>location</span><span class=p>),</span>
</span><span id=__span-0-1155><a id=__codelineno-0-1155 name=__codelineno-0-1155></a>        <span class=p>)</span>
</span><span id=__span-0-1156><a id=__codelineno-0-1156 name=__codelineno-0-1156></a>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-1157><a id=__codelineno-0-1157 name=__codelineno-0-1157></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Error: &quot;</span><span class=p>,</span> <span class=n>e</span><span class=p>)</span>
</span><span id=__span-0-1158><a id=__codelineno-0-1158 name=__codelineno-0-1158></a>        <span class=n>delegation_api</span><span class=o>.</span><span class=n>revoke_delegation_v1_delegation_revoke_delegation_post</span><span class=p>(</span>
</span><span id=__span-0-1159><a id=__codelineno-0-1159 name=__codelineno-0-1159></a>            <span class=n>delegate_account_id</span><span class=o>=</span><span class=n>CONFIG</span><span class=o>.</span><span class=n>scheduler_account_id</span><span class=p>,</span>
</span><span id=__span-0-1160><a id=__codelineno-0-1160 name=__codelineno-0-1160></a>        <span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.cli.CLI.task class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">task</span> <a href=#nearai.cli.CLI.task class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>task</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>CLI command for running a single task.</p> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1172>1172</a></span>
<span class=normal><a href=#__codelineno-0-1173>1173</a></span>
<span class=normal><a href=#__codelineno-0-1174>1174</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1172><a id=__codelineno-0-1172 name=__codelineno-0-1172></a><span class=k>def</span><span class=w> </span><span class=nf>task</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span><span id=__span-0-1173><a id=__codelineno-0-1173 name=__codelineno-0-1173></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;CLI command for running a single task.&quot;&quot;&quot;</span>
</span><span id=__span-0-1174><a id=__codelineno-0-1174 name=__codelineno-0-1174></a>    <span class=bp>self</span><span class=o>.</span><span class=n>agent</span><span class=o>.</span><span class=n>task_cli</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.cli.CLI.version class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">version</span> <a href=#nearai.cli.CLI.version class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>version</span><span class=p>()</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Show nearai version.</p> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1168>1168</a></span>
<span class=normal><a href=#__codelineno-0-1169>1169</a></span>
<span class=normal><a href=#__codelineno-0-1170>1170</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1168><a id=__codelineno-0-1168 name=__codelineno-0-1168></a><span class=k>def</span><span class=w> </span><span class=nf>version</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-0-1169><a id=__codelineno-0-1169 name=__codelineno-0-1169></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Show nearai version.&quot;&quot;&quot;</span>
</span><span id=__span-0-1170><a id=__codelineno-0-1170 name=__codelineno-0-1170></a>    <span class=nb>print</span><span class=p>(</span><span class=n>importlib</span><span class=o>.</span><span class=n>metadata</span><span class=o>.</span><span class=n>version</span><span class=p>(</span><span class=s2>&quot;nearai&quot;</span><span class=p>))</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h4 id=nearai.cli.ConfigCli class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">ConfigCli</span> <a href=#nearai.cli.ConfigCli class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-268>268</a></span>
<span class=normal><a href=#__codelineno-0-269>269</a></span>
<span class=normal><a href=#__codelineno-0-270>270</a></span>
<span class=normal><a href=#__codelineno-0-271>271</a></span>
<span class=normal><a href=#__codelineno-0-272>272</a></span>
<span class=normal><a href=#__codelineno-0-273>273</a></span>
<span class=normal><a href=#__codelineno-0-274>274</a></span>
<span class=normal><a href=#__codelineno-0-275>275</a></span>
<span class=normal><a href=#__codelineno-0-276>276</a></span>
<span class=normal><a href=#__codelineno-0-277>277</a></span>
<span class=normal><a href=#__codelineno-0-278>278</a></span>
<span class=normal><a href=#__codelineno-0-279>279</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-268><a id=__codelineno-0-268 name=__codelineno-0-268></a><span class=k>class</span><span class=w> </span><span class=nc>ConfigCli</span><span class=p>:</span>
</span><span id=__span-0-269><a id=__codelineno-0-269 name=__codelineno-0-269></a>    <span class=k>def</span><span class=w> </span><span class=nf>set</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>value</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>local</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-270><a id=__codelineno-0-270 name=__codelineno-0-270></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Add key-value pair to the config file.&quot;&quot;&quot;</span>
</span><span id=__span-0-271><a id=__codelineno-0-271 name=__codelineno-0-271></a>        <span class=n>update_config</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>value</span><span class=p>,</span> <span class=n>local</span><span class=p>)</span>
</span><span id=__span-0-272><a id=__codelineno-0-272 name=__codelineno-0-272></a>
</span><span id=__span-0-273><a id=__codelineno-0-273 name=__codelineno-0-273></a>    <span class=k>def</span><span class=w> </span><span class=nf>get</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-274><a id=__codelineno-0-274 name=__codelineno-0-274></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Get value of a key in the config file.&quot;&quot;&quot;</span>
</span><span id=__span-0-275><a id=__codelineno-0-275 name=__codelineno-0-275></a>        <span class=nb>print</span><span class=p>(</span><span class=n>CONFIG</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>key</span><span class=p>))</span>
</span><span id=__span-0-276><a id=__codelineno-0-276 name=__codelineno-0-276></a>
</span><span id=__span-0-277><a id=__codelineno-0-277 name=__codelineno-0-277></a>    <span class=k>def</span><span class=w> </span><span class=nf>show</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-278><a id=__codelineno-0-278 name=__codelineno-0-278></a>        <span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>asdict</span><span class=p>(</span><span class=n>CONFIG</span><span class=p>)</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span><span id=__span-0-279><a id=__codelineno-0-279 name=__codelineno-0-279></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>key</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>value</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h5 id=nearai.cli.ConfigCli.get class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get</span> <a href=#nearai.cli.ConfigCli.get class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>get</span><span class=p>(</span><span class=n>key</span><span class=p>:</span> <span class=n>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Get value of a key in the config file.</p> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-273>273</a></span>
<span class=normal><a href=#__codelineno-0-274>274</a></span>
<span class=normal><a href=#__codelineno-0-275>275</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-273><a id=__codelineno-0-273 name=__codelineno-0-273></a><span class=k>def</span><span class=w> </span><span class=nf>get</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-274><a id=__codelineno-0-274 name=__codelineno-0-274></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Get value of a key in the config file.&quot;&quot;&quot;</span>
</span><span id=__span-0-275><a id=__codelineno-0-275 name=__codelineno-0-275></a>    <span class=nb>print</span><span class=p>(</span><span class=n>CONFIG</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>key</span><span class=p>))</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.cli.ConfigCli.set class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">set</span> <a href=#nearai.cli.ConfigCli.set class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nb>set</span><span class=p>(</span><span class=nf>key</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>value</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>local</span><span class=p>:</span> <span class=n>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Add key-value pair to the config file.</p> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-269>269</a></span>
<span class=normal><a href=#__codelineno-0-270>270</a></span>
<span class=normal><a href=#__codelineno-0-271>271</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-269><a id=__codelineno-0-269 name=__codelineno-0-269></a><span class=k>def</span><span class=w> </span><span class=nf>set</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>value</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>local</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-270><a id=__codelineno-0-270 name=__codelineno-0-270></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Add key-value pair to the config file.&quot;&quot;&quot;</span>
</span><span id=__span-0-271><a id=__codelineno-0-271 name=__codelineno-0-271></a>    <span class=n>update_config</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>value</span><span class=p>,</span> <span class=n>local</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h4 id=nearai.cli.EvaluationCli class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">EvaluationCli</span> <a href=#nearai.cli.EvaluationCli class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-416>416</a></span>
<span class=normal><a href=#__codelineno-0-417>417</a></span>
<span class=normal><a href=#__codelineno-0-418>418</a></span>
<span class=normal><a href=#__codelineno-0-419>419</a></span>
<span class=normal><a href=#__codelineno-0-420>420</a></span>
<span class=normal><a href=#__codelineno-0-421>421</a></span>
<span class=normal><a href=#__codelineno-0-422>422</a></span>
<span class=normal><a href=#__codelineno-0-423>423</a></span>
<span class=normal><a href=#__codelineno-0-424>424</a></span>
<span class=normal><a href=#__codelineno-0-425>425</a></span>
<span class=normal><a href=#__codelineno-0-426>426</a></span>
<span class=normal><a href=#__codelineno-0-427>427</a></span>
<span class=normal><a href=#__codelineno-0-428>428</a></span>
<span class=normal><a href=#__codelineno-0-429>429</a></span>
<span class=normal><a href=#__codelineno-0-430>430</a></span>
<span class=normal><a href=#__codelineno-0-431>431</a></span>
<span class=normal><a href=#__codelineno-0-432>432</a></span>
<span class=normal><a href=#__codelineno-0-433>433</a></span>
<span class=normal><a href=#__codelineno-0-434>434</a></span>
<span class=normal><a href=#__codelineno-0-435>435</a></span>
<span class=normal><a href=#__codelineno-0-436>436</a></span>
<span class=normal><a href=#__codelineno-0-437>437</a></span>
<span class=normal><a href=#__codelineno-0-438>438</a></span>
<span class=normal><a href=#__codelineno-0-439>439</a></span>
<span class=normal><a href=#__codelineno-0-440>440</a></span>
<span class=normal><a href=#__codelineno-0-441>441</a></span>
<span class=normal><a href=#__codelineno-0-442>442</a></span>
<span class=normal><a href=#__codelineno-0-443>443</a></span>
<span class=normal><a href=#__codelineno-0-444>444</a></span>
<span class=normal><a href=#__codelineno-0-445>445</a></span>
<span class=normal><a href=#__codelineno-0-446>446</a></span>
<span class=normal><a href=#__codelineno-0-447>447</a></span>
<span class=normal><a href=#__codelineno-0-448>448</a></span>
<span class=normal><a href=#__codelineno-0-449>449</a></span>
<span class=normal><a href=#__codelineno-0-450>450</a></span>
<span class=normal><a href=#__codelineno-0-451>451</a></span>
<span class=normal><a href=#__codelineno-0-452>452</a></span>
<span class=normal><a href=#__codelineno-0-453>453</a></span>
<span class=normal><a href=#__codelineno-0-454>454</a></span>
<span class=normal><a href=#__codelineno-0-455>455</a></span>
<span class=normal><a href=#__codelineno-0-456>456</a></span>
<span class=normal><a href=#__codelineno-0-457>457</a></span>
<span class=normal><a href=#__codelineno-0-458>458</a></span>
<span class=normal><a href=#__codelineno-0-459>459</a></span>
<span class=normal><a href=#__codelineno-0-460>460</a></span>
<span class=normal><a href=#__codelineno-0-461>461</a></span>
<span class=normal><a href=#__codelineno-0-462>462</a></span>
<span class=normal><a href=#__codelineno-0-463>463</a></span>
<span class=normal><a href=#__codelineno-0-464>464</a></span>
<span class=normal><a href=#__codelineno-0-465>465</a></span>
<span class=normal><a href=#__codelineno-0-466>466</a></span>
<span class=normal><a href=#__codelineno-0-467>467</a></span>
<span class=normal><a href=#__codelineno-0-468>468</a></span>
<span class=normal><a href=#__codelineno-0-469>469</a></span>
<span class=normal><a href=#__codelineno-0-470>470</a></span>
<span class=normal><a href=#__codelineno-0-471>471</a></span>
<span class=normal><a href=#__codelineno-0-472>472</a></span>
<span class=normal><a href=#__codelineno-0-473>473</a></span>
<span class=normal><a href=#__codelineno-0-474>474</a></span>
<span class=normal><a href=#__codelineno-0-475>475</a></span>
<span class=normal><a href=#__codelineno-0-476>476</a></span>
<span class=normal><a href=#__codelineno-0-477>477</a></span>
<span class=normal><a href=#__codelineno-0-478>478</a></span>
<span class=normal><a href=#__codelineno-0-479>479</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-416><a id=__codelineno-0-416 name=__codelineno-0-416></a><span class=k>class</span><span class=w> </span><span class=nc>EvaluationCli</span><span class=p>:</span>
</span><span id=__span-0-417><a id=__codelineno-0-417 name=__codelineno-0-417></a>    <span class=k>def</span><span class=w> </span><span class=nf>table</span><span class=p>(</span>
</span><span id=__span-0-418><a id=__codelineno-0-418 name=__codelineno-0-418></a>        <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-419><a id=__codelineno-0-419 name=__codelineno-0-419></a>        <span class=n>all_key_columns</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-420><a id=__codelineno-0-420 name=__codelineno-0-420></a>        <span class=n>all_metrics</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-421><a id=__codelineno-0-421 name=__codelineno-0-421></a>        <span class=n>num_columns</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>6</span><span class=p>,</span>
</span><span id=__span-0-422><a id=__codelineno-0-422 name=__codelineno-0-422></a>        <span class=n>metric_name_max_length</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>30</span><span class=p>,</span>
</span><span id=__span-0-423><a id=__codelineno-0-423 name=__codelineno-0-423></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-424><a id=__codelineno-0-424 name=__codelineno-0-424></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Prints table of evaluations.&quot;&quot;&quot;</span>
</span><span id=__span-0-425><a id=__codelineno-0-425 name=__codelineno-0-425></a>        <span class=kn>from</span><span class=w> </span><span class=nn>nearai.evaluation</span><span class=w> </span><span class=kn>import</span> <span class=n>print_evaluation_table</span>
</span><span id=__span-0-426><a id=__codelineno-0-426 name=__codelineno-0-426></a>
</span><span id=__span-0-427><a id=__codelineno-0-427 name=__codelineno-0-427></a>        <span class=n>api</span> <span class=o>=</span> <span class=n>EvaluationApi</span><span class=p>()</span>
</span><span id=__span-0-428><a id=__codelineno-0-428 name=__codelineno-0-428></a>        <span class=n>table</span> <span class=o>=</span> <span class=n>api</span><span class=o>.</span><span class=n>table_v1_evaluation_table_get</span><span class=p>()</span>
</span><span id=__span-0-429><a id=__codelineno-0-429 name=__codelineno-0-429></a>
</span><span id=__span-0-430><a id=__codelineno-0-430 name=__codelineno-0-430></a>        <span class=n>print_evaluation_table</span><span class=p>(</span>
</span><span id=__span-0-431><a id=__codelineno-0-431 name=__codelineno-0-431></a>            <span class=n>table</span><span class=o>.</span><span class=n>rows</span><span class=p>,</span>
</span><span id=__span-0-432><a id=__codelineno-0-432 name=__codelineno-0-432></a>            <span class=n>table</span><span class=o>.</span><span class=n>columns</span><span class=p>,</span>
</span><span id=__span-0-433><a id=__codelineno-0-433 name=__codelineno-0-433></a>            <span class=n>table</span><span class=o>.</span><span class=n>important_columns</span><span class=p>,</span>
</span><span id=__span-0-434><a id=__codelineno-0-434 name=__codelineno-0-434></a>            <span class=n>all_key_columns</span><span class=p>,</span>
</span><span id=__span-0-435><a id=__codelineno-0-435 name=__codelineno-0-435></a>            <span class=n>all_metrics</span><span class=p>,</span>
</span><span id=__span-0-436><a id=__codelineno-0-436 name=__codelineno-0-436></a>            <span class=n>num_columns</span><span class=p>,</span>
</span><span id=__span-0-437><a id=__codelineno-0-437 name=__codelineno-0-437></a>            <span class=n>metric_name_max_length</span><span class=p>,</span>
</span><span id=__span-0-438><a id=__codelineno-0-438 name=__codelineno-0-438></a>        <span class=p>)</span>
</span><span id=__span-0-439><a id=__codelineno-0-439 name=__codelineno-0-439></a>
</span><span id=__span-0-440><a id=__codelineno-0-440 name=__codelineno-0-440></a>    <span class=k>def</span><span class=w> </span><span class=nf>read_solutions</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>entry</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>status</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>bool</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>verbose</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-441><a id=__codelineno-0-441 name=__codelineno-0-441></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Reads solutions.json from evaluation entry.&quot;&quot;&quot;</span>
</span><span id=__span-0-442><a id=__codelineno-0-442 name=__codelineno-0-442></a>        <span class=n>entry_path</span> <span class=o>=</span> <span class=n>registry</span><span class=o>.</span><span class=n>download</span><span class=p>(</span><span class=n>entry</span><span class=p>)</span>
</span><span id=__span-0-443><a id=__codelineno-0-443 name=__codelineno-0-443></a>        <span class=n>solutions_file</span> <span class=o>=</span> <span class=n>entry_path</span> <span class=o>/</span> <span class=s2>&quot;solutions.json&quot;</span>
</span><span id=__span-0-444><a id=__codelineno-0-444 name=__codelineno-0-444></a>
</span><span id=__span-0-445><a id=__codelineno-0-445 name=__codelineno-0-445></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>solutions_file</span><span class=o>.</span><span class=n>exists</span><span class=p>():</span>
</span><span id=__span-0-446><a id=__codelineno-0-446 name=__codelineno-0-446></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;No solutions file found for entry: </span><span class=si>{</span><span class=n>entry</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-447><a id=__codelineno-0-447 name=__codelineno-0-447></a>            <span class=k>return</span>
</span><span id=__span-0-448><a id=__codelineno-0-448 name=__codelineno-0-448></a>
</span><span id=__span-0-449><a id=__codelineno-0-449 name=__codelineno-0-449></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-450><a id=__codelineno-0-450 name=__codelineno-0-450></a>            <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>solutions_file</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-451><a id=__codelineno-0-451 name=__codelineno-0-451></a>                <span class=n>solutions</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>f</span><span class=p>)</span>
</span><span id=__span-0-452><a id=__codelineno-0-452 name=__codelineno-0-452></a>        <span class=k>except</span> <span class=n>json</span><span class=o>.</span><span class=n>JSONDecodeError</span><span class=p>:</span>
</span><span id=__span-0-453><a id=__codelineno-0-453 name=__codelineno-0-453></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error reading solutions file for entry: </span><span class=si>{</span><span class=n>entry</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-454><a id=__codelineno-0-454 name=__codelineno-0-454></a>            <span class=k>return</span>
</span><span id=__span-0-455><a id=__codelineno-0-455 name=__codelineno-0-455></a>
</span><span id=__span-0-456><a id=__codelineno-0-456 name=__codelineno-0-456></a>        <span class=c1># Filter solutions if status is specified</span>
</span><span id=__span-0-457><a id=__codelineno-0-457 name=__codelineno-0-457></a>        <span class=k>if</span> <span class=n>status</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-458><a id=__codelineno-0-458 name=__codelineno-0-458></a>            <span class=n>solutions</span> <span class=o>=</span> <span class=p>[</span><span class=n>s</span> <span class=k>for</span> <span class=n>s</span> <span class=ow>in</span> <span class=n>solutions</span> <span class=k>if</span> <span class=n>s</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;status&quot;</span><span class=p>)</span> <span class=o>==</span> <span class=n>status</span><span class=p>]</span>
</span><span id=__span-0-459><a id=__codelineno-0-459 name=__codelineno-0-459></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>solutions</span><span class=p>:</span>
</span><span id=__span-0-460><a id=__codelineno-0-460 name=__codelineno-0-460></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;No solutions found matching criteria&quot;</span><span class=p>)</span>
</span><span id=__span-0-461><a id=__codelineno-0-461 name=__codelineno-0-461></a>            <span class=k>return</span>
</span><span id=__span-0-462><a id=__codelineno-0-462 name=__codelineno-0-462></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>Found </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>solutions</span><span class=p>)</span><span class=si>}</span><span class=s2> solutions</span><span class=si>{</span><span class=s1>&#39; with status=&#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nb>str</span><span class=p>(</span><span class=n>status</span><span class=p>)</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=n>status</span><span class=w> </span><span class=ow>is</span><span class=w> </span><span class=ow>not</span><span class=w> </span><span class=kc>None</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-463><a id=__codelineno-0-463 name=__codelineno-0-463></a>
</span><span id=__span-0-464><a id=__codelineno-0-464 name=__codelineno-0-464></a>        <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>solution</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>solutions</span><span class=p>,</span> <span class=mi>1</span><span class=p>):</span>
</span><span id=__span-0-465><a id=__codelineno-0-465 name=__codelineno-0-465></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;-&quot;</span> <span class=o>*</span> <span class=mi>80</span><span class=p>)</span>
</span><span id=__span-0-466><a id=__codelineno-0-466 name=__codelineno-0-466></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>Solution </span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>solutions</span><span class=p>)</span><span class=si>}</span><span class=s2>:&quot;</span><span class=p>)</span>
</span><span id=__span-0-467><a id=__codelineno-0-467 name=__codelineno-0-467></a>            <span class=n>datum</span> <span class=o>=</span> <span class=n>solution</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;datum&quot;</span><span class=p>)</span>
</span><span id=__span-0-468><a id=__codelineno-0-468 name=__codelineno-0-468></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;datum: </span><span class=si>{</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>datum</span><span class=p>,</span><span class=w> </span><span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=n>ensure_ascii</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-469><a id=__codelineno-0-469 name=__codelineno-0-469></a>            <span class=n>status</span> <span class=o>=</span> <span class=n>solution</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;status&quot;</span><span class=p>)</span>
</span><span id=__span-0-470><a id=__codelineno-0-470 name=__codelineno-0-470></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;status: </span><span class=si>{</span><span class=n>status</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-471><a id=__codelineno-0-471 name=__codelineno-0-471></a>            <span class=n>info</span><span class=p>:</span> <span class=nb>dict</span> <span class=o>=</span> <span class=n>solution</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;info&quot;</span><span class=p>,</span> <span class=p>{})</span>
</span><span id=__span-0-472><a id=__codelineno-0-472 name=__codelineno-0-472></a>            <span class=k>if</span> <span class=ow>not</span> <span class=n>verbose</span><span class=p>:</span>
</span><span id=__span-0-473><a id=__codelineno-0-473 name=__codelineno-0-473></a>                <span class=n>info</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;verbose&quot;</span><span class=p>)</span>
</span><span id=__span-0-474><a id=__codelineno-0-474 name=__codelineno-0-474></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;info: </span><span class=si>{</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>info</span><span class=p>,</span><span class=w> </span><span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=n>ensure_ascii</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-475><a id=__codelineno-0-475 name=__codelineno-0-475></a>            <span class=k>if</span> <span class=n>i</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
</span><span id=__span-0-476><a id=__codelineno-0-476 name=__codelineno-0-476></a>                <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Enter to continue, type &#39;exit&#39; to quit.&quot;</span><span class=p>)</span>
</span><span id=__span-0-477><a id=__codelineno-0-477 name=__codelineno-0-477></a>            <span class=n>new_message</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=s2>&quot;&gt; &quot;</span><span class=p>)</span>
</span><span id=__span-0-478><a id=__codelineno-0-478 name=__codelineno-0-478></a>            <span class=k>if</span> <span class=n>new_message</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=o>==</span> <span class=s2>&quot;exit&quot;</span><span class=p>:</span>
</span><span id=__span-0-479><a id=__codelineno-0-479 name=__codelineno-0-479></a>                <span class=k>break</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h5 id=nearai.cli.EvaluationCli.read_solutions class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">read_solutions</span> <a href=#nearai.cli.EvaluationCli.read_solutions class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>read_solutions</span><span class=p>(</span><span class=n>entry</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>status</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>bool</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>verbose</span><span class=p>:</span> <span class=n>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Reads solutions.json from evaluation entry.</p> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-440>440</a></span>
<span class=normal><a href=#__codelineno-0-441>441</a></span>
<span class=normal><a href=#__codelineno-0-442>442</a></span>
<span class=normal><a href=#__codelineno-0-443>443</a></span>
<span class=normal><a href=#__codelineno-0-444>444</a></span>
<span class=normal><a href=#__codelineno-0-445>445</a></span>
<span class=normal><a href=#__codelineno-0-446>446</a></span>
<span class=normal><a href=#__codelineno-0-447>447</a></span>
<span class=normal><a href=#__codelineno-0-448>448</a></span>
<span class=normal><a href=#__codelineno-0-449>449</a></span>
<span class=normal><a href=#__codelineno-0-450>450</a></span>
<span class=normal><a href=#__codelineno-0-451>451</a></span>
<span class=normal><a href=#__codelineno-0-452>452</a></span>
<span class=normal><a href=#__codelineno-0-453>453</a></span>
<span class=normal><a href=#__codelineno-0-454>454</a></span>
<span class=normal><a href=#__codelineno-0-455>455</a></span>
<span class=normal><a href=#__codelineno-0-456>456</a></span>
<span class=normal><a href=#__codelineno-0-457>457</a></span>
<span class=normal><a href=#__codelineno-0-458>458</a></span>
<span class=normal><a href=#__codelineno-0-459>459</a></span>
<span class=normal><a href=#__codelineno-0-460>460</a></span>
<span class=normal><a href=#__codelineno-0-461>461</a></span>
<span class=normal><a href=#__codelineno-0-462>462</a></span>
<span class=normal><a href=#__codelineno-0-463>463</a></span>
<span class=normal><a href=#__codelineno-0-464>464</a></span>
<span class=normal><a href=#__codelineno-0-465>465</a></span>
<span class=normal><a href=#__codelineno-0-466>466</a></span>
<span class=normal><a href=#__codelineno-0-467>467</a></span>
<span class=normal><a href=#__codelineno-0-468>468</a></span>
<span class=normal><a href=#__codelineno-0-469>469</a></span>
<span class=normal><a href=#__codelineno-0-470>470</a></span>
<span class=normal><a href=#__codelineno-0-471>471</a></span>
<span class=normal><a href=#__codelineno-0-472>472</a></span>
<span class=normal><a href=#__codelineno-0-473>473</a></span>
<span class=normal><a href=#__codelineno-0-474>474</a></span>
<span class=normal><a href=#__codelineno-0-475>475</a></span>
<span class=normal><a href=#__codelineno-0-476>476</a></span>
<span class=normal><a href=#__codelineno-0-477>477</a></span>
<span class=normal><a href=#__codelineno-0-478>478</a></span>
<span class=normal><a href=#__codelineno-0-479>479</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-440><a id=__codelineno-0-440 name=__codelineno-0-440></a><span class=k>def</span><span class=w> </span><span class=nf>read_solutions</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>entry</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>status</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>bool</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>verbose</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-441><a id=__codelineno-0-441 name=__codelineno-0-441></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Reads solutions.json from evaluation entry.&quot;&quot;&quot;</span>
</span><span id=__span-0-442><a id=__codelineno-0-442 name=__codelineno-0-442></a>    <span class=n>entry_path</span> <span class=o>=</span> <span class=n>registry</span><span class=o>.</span><span class=n>download</span><span class=p>(</span><span class=n>entry</span><span class=p>)</span>
</span><span id=__span-0-443><a id=__codelineno-0-443 name=__codelineno-0-443></a>    <span class=n>solutions_file</span> <span class=o>=</span> <span class=n>entry_path</span> <span class=o>/</span> <span class=s2>&quot;solutions.json&quot;</span>
</span><span id=__span-0-444><a id=__codelineno-0-444 name=__codelineno-0-444></a>
</span><span id=__span-0-445><a id=__codelineno-0-445 name=__codelineno-0-445></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>solutions_file</span><span class=o>.</span><span class=n>exists</span><span class=p>():</span>
</span><span id=__span-0-446><a id=__codelineno-0-446 name=__codelineno-0-446></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;No solutions file found for entry: </span><span class=si>{</span><span class=n>entry</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-447><a id=__codelineno-0-447 name=__codelineno-0-447></a>        <span class=k>return</span>
</span><span id=__span-0-448><a id=__codelineno-0-448 name=__codelineno-0-448></a>
</span><span id=__span-0-449><a id=__codelineno-0-449 name=__codelineno-0-449></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-450><a id=__codelineno-0-450 name=__codelineno-0-450></a>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>solutions_file</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-451><a id=__codelineno-0-451 name=__codelineno-0-451></a>            <span class=n>solutions</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>f</span><span class=p>)</span>
</span><span id=__span-0-452><a id=__codelineno-0-452 name=__codelineno-0-452></a>    <span class=k>except</span> <span class=n>json</span><span class=o>.</span><span class=n>JSONDecodeError</span><span class=p>:</span>
</span><span id=__span-0-453><a id=__codelineno-0-453 name=__codelineno-0-453></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error reading solutions file for entry: </span><span class=si>{</span><span class=n>entry</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-454><a id=__codelineno-0-454 name=__codelineno-0-454></a>        <span class=k>return</span>
</span><span id=__span-0-455><a id=__codelineno-0-455 name=__codelineno-0-455></a>
</span><span id=__span-0-456><a id=__codelineno-0-456 name=__codelineno-0-456></a>    <span class=c1># Filter solutions if status is specified</span>
</span><span id=__span-0-457><a id=__codelineno-0-457 name=__codelineno-0-457></a>    <span class=k>if</span> <span class=n>status</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-458><a id=__codelineno-0-458 name=__codelineno-0-458></a>        <span class=n>solutions</span> <span class=o>=</span> <span class=p>[</span><span class=n>s</span> <span class=k>for</span> <span class=n>s</span> <span class=ow>in</span> <span class=n>solutions</span> <span class=k>if</span> <span class=n>s</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;status&quot;</span><span class=p>)</span> <span class=o>==</span> <span class=n>status</span><span class=p>]</span>
</span><span id=__span-0-459><a id=__codelineno-0-459 name=__codelineno-0-459></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>solutions</span><span class=p>:</span>
</span><span id=__span-0-460><a id=__codelineno-0-460 name=__codelineno-0-460></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;No solutions found matching criteria&quot;</span><span class=p>)</span>
</span><span id=__span-0-461><a id=__codelineno-0-461 name=__codelineno-0-461></a>        <span class=k>return</span>
</span><span id=__span-0-462><a id=__codelineno-0-462 name=__codelineno-0-462></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>Found </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>solutions</span><span class=p>)</span><span class=si>}</span><span class=s2> solutions</span><span class=si>{</span><span class=s1>&#39; with status=&#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nb>str</span><span class=p>(</span><span class=n>status</span><span class=p>)</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=n>status</span><span class=w> </span><span class=ow>is</span><span class=w> </span><span class=ow>not</span><span class=w> </span><span class=kc>None</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-463><a id=__codelineno-0-463 name=__codelineno-0-463></a>
</span><span id=__span-0-464><a id=__codelineno-0-464 name=__codelineno-0-464></a>    <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>solution</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>solutions</span><span class=p>,</span> <span class=mi>1</span><span class=p>):</span>
</span><span id=__span-0-465><a id=__codelineno-0-465 name=__codelineno-0-465></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;-&quot;</span> <span class=o>*</span> <span class=mi>80</span><span class=p>)</span>
</span><span id=__span-0-466><a id=__codelineno-0-466 name=__codelineno-0-466></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>Solution </span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>solutions</span><span class=p>)</span><span class=si>}</span><span class=s2>:&quot;</span><span class=p>)</span>
</span><span id=__span-0-467><a id=__codelineno-0-467 name=__codelineno-0-467></a>        <span class=n>datum</span> <span class=o>=</span> <span class=n>solution</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;datum&quot;</span><span class=p>)</span>
</span><span id=__span-0-468><a id=__codelineno-0-468 name=__codelineno-0-468></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;datum: </span><span class=si>{</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>datum</span><span class=p>,</span><span class=w> </span><span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=n>ensure_ascii</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-469><a id=__codelineno-0-469 name=__codelineno-0-469></a>        <span class=n>status</span> <span class=o>=</span> <span class=n>solution</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;status&quot;</span><span class=p>)</span>
</span><span id=__span-0-470><a id=__codelineno-0-470 name=__codelineno-0-470></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;status: </span><span class=si>{</span><span class=n>status</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-471><a id=__codelineno-0-471 name=__codelineno-0-471></a>        <span class=n>info</span><span class=p>:</span> <span class=nb>dict</span> <span class=o>=</span> <span class=n>solution</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;info&quot;</span><span class=p>,</span> <span class=p>{})</span>
</span><span id=__span-0-472><a id=__codelineno-0-472 name=__codelineno-0-472></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>verbose</span><span class=p>:</span>
</span><span id=__span-0-473><a id=__codelineno-0-473 name=__codelineno-0-473></a>            <span class=n>info</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;verbose&quot;</span><span class=p>)</span>
</span><span id=__span-0-474><a id=__codelineno-0-474 name=__codelineno-0-474></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;info: </span><span class=si>{</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>info</span><span class=p>,</span><span class=w> </span><span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=n>ensure_ascii</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-475><a id=__codelineno-0-475 name=__codelineno-0-475></a>        <span class=k>if</span> <span class=n>i</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
</span><span id=__span-0-476><a id=__codelineno-0-476 name=__codelineno-0-476></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Enter to continue, type &#39;exit&#39; to quit.&quot;</span><span class=p>)</span>
</span><span id=__span-0-477><a id=__codelineno-0-477 name=__codelineno-0-477></a>        <span class=n>new_message</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=s2>&quot;&gt; &quot;</span><span class=p>)</span>
</span><span id=__span-0-478><a id=__codelineno-0-478 name=__codelineno-0-478></a>        <span class=k>if</span> <span class=n>new_message</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=o>==</span> <span class=s2>&quot;exit&quot;</span><span class=p>:</span>
</span><span id=__span-0-479><a id=__codelineno-0-479 name=__codelineno-0-479></a>            <span class=k>break</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.cli.EvaluationCli.table class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">table</span> <a href=#nearai.cli.EvaluationCli.table class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>table</span><span class=p>(</span><span class=n>all_key_columns</span><span class=p>:</span> <span class=n>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span> <span class=n>all_metrics</span><span class=p>:</span> <span class=n>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span> <span class=n>num_columns</span><span class=p>:</span> <span class=n>int</span> <span class=o>=</span> <span class=mi>6</span><span class=p>,</span> <span class=n>metric_name_max_length</span><span class=p>:</span> <span class=n>int</span> <span class=o>=</span> <span class=mi>30</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Prints table of evaluations.</p> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-417>417</a></span>
<span class=normal><a href=#__codelineno-0-418>418</a></span>
<span class=normal><a href=#__codelineno-0-419>419</a></span>
<span class=normal><a href=#__codelineno-0-420>420</a></span>
<span class=normal><a href=#__codelineno-0-421>421</a></span>
<span class=normal><a href=#__codelineno-0-422>422</a></span>
<span class=normal><a href=#__codelineno-0-423>423</a></span>
<span class=normal><a href=#__codelineno-0-424>424</a></span>
<span class=normal><a href=#__codelineno-0-425>425</a></span>
<span class=normal><a href=#__codelineno-0-426>426</a></span>
<span class=normal><a href=#__codelineno-0-427>427</a></span>
<span class=normal><a href=#__codelineno-0-428>428</a></span>
<span class=normal><a href=#__codelineno-0-429>429</a></span>
<span class=normal><a href=#__codelineno-0-430>430</a></span>
<span class=normal><a href=#__codelineno-0-431>431</a></span>
<span class=normal><a href=#__codelineno-0-432>432</a></span>
<span class=normal><a href=#__codelineno-0-433>433</a></span>
<span class=normal><a href=#__codelineno-0-434>434</a></span>
<span class=normal><a href=#__codelineno-0-435>435</a></span>
<span class=normal><a href=#__codelineno-0-436>436</a></span>
<span class=normal><a href=#__codelineno-0-437>437</a></span>
<span class=normal><a href=#__codelineno-0-438>438</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-417><a id=__codelineno-0-417 name=__codelineno-0-417></a><span class=k>def</span><span class=w> </span><span class=nf>table</span><span class=p>(</span>
</span><span id=__span-0-418><a id=__codelineno-0-418 name=__codelineno-0-418></a>    <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-419><a id=__codelineno-0-419 name=__codelineno-0-419></a>    <span class=n>all_key_columns</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-420><a id=__codelineno-0-420 name=__codelineno-0-420></a>    <span class=n>all_metrics</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-421><a id=__codelineno-0-421 name=__codelineno-0-421></a>    <span class=n>num_columns</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>6</span><span class=p>,</span>
</span><span id=__span-0-422><a id=__codelineno-0-422 name=__codelineno-0-422></a>    <span class=n>metric_name_max_length</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>30</span><span class=p>,</span>
</span><span id=__span-0-423><a id=__codelineno-0-423 name=__codelineno-0-423></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-424><a id=__codelineno-0-424 name=__codelineno-0-424></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Prints table of evaluations.&quot;&quot;&quot;</span>
</span><span id=__span-0-425><a id=__codelineno-0-425 name=__codelineno-0-425></a>    <span class=kn>from</span><span class=w> </span><span class=nn>nearai.evaluation</span><span class=w> </span><span class=kn>import</span> <span class=n>print_evaluation_table</span>
</span><span id=__span-0-426><a id=__codelineno-0-426 name=__codelineno-0-426></a>
</span><span id=__span-0-427><a id=__codelineno-0-427 name=__codelineno-0-427></a>    <span class=n>api</span> <span class=o>=</span> <span class=n>EvaluationApi</span><span class=p>()</span>
</span><span id=__span-0-428><a id=__codelineno-0-428 name=__codelineno-0-428></a>    <span class=n>table</span> <span class=o>=</span> <span class=n>api</span><span class=o>.</span><span class=n>table_v1_evaluation_table_get</span><span class=p>()</span>
</span><span id=__span-0-429><a id=__codelineno-0-429 name=__codelineno-0-429></a>
</span><span id=__span-0-430><a id=__codelineno-0-430 name=__codelineno-0-430></a>    <span class=n>print_evaluation_table</span><span class=p>(</span>
</span><span id=__span-0-431><a id=__codelineno-0-431 name=__codelineno-0-431></a>        <span class=n>table</span><span class=o>.</span><span class=n>rows</span><span class=p>,</span>
</span><span id=__span-0-432><a id=__codelineno-0-432 name=__codelineno-0-432></a>        <span class=n>table</span><span class=o>.</span><span class=n>columns</span><span class=p>,</span>
</span><span id=__span-0-433><a id=__codelineno-0-433 name=__codelineno-0-433></a>        <span class=n>table</span><span class=o>.</span><span class=n>important_columns</span><span class=p>,</span>
</span><span id=__span-0-434><a id=__codelineno-0-434 name=__codelineno-0-434></a>        <span class=n>all_key_columns</span><span class=p>,</span>
</span><span id=__span-0-435><a id=__codelineno-0-435 name=__codelineno-0-435></a>        <span class=n>all_metrics</span><span class=p>,</span>
</span><span id=__span-0-436><a id=__codelineno-0-436 name=__codelineno-0-436></a>        <span class=n>num_columns</span><span class=p>,</span>
</span><span id=__span-0-437><a id=__codelineno-0-437 name=__codelineno-0-437></a>        <span class=n>metric_name_max_length</span><span class=p>,</span>
</span><span id=__span-0-438><a id=__codelineno-0-438 name=__codelineno-0-438></a>    <span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h4 id=nearai.cli.HubCLI class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">HubCLI</span> <a href=#nearai.cli.HubCLI class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1011>1011</a></span>
<span class=normal><a href=#__codelineno-0-1012>1012</a></span>
<span class=normal><a href=#__codelineno-0-1013>1013</a></span>
<span class=normal><a href=#__codelineno-0-1014>1014</a></span>
<span class=normal><a href=#__codelineno-0-1015>1015</a></span>
<span class=normal><a href=#__codelineno-0-1016>1016</a></span>
<span class=normal><a href=#__codelineno-0-1017>1017</a></span>
<span class=normal><a href=#__codelineno-0-1018>1018</a></span>
<span class=normal><a href=#__codelineno-0-1019>1019</a></span>
<span class=normal><a href=#__codelineno-0-1020>1020</a></span>
<span class=normal><a href=#__codelineno-0-1021>1021</a></span>
<span class=normal><a href=#__codelineno-0-1022>1022</a></span>
<span class=normal><a href=#__codelineno-0-1023>1023</a></span>
<span class=normal><a href=#__codelineno-0-1024>1024</a></span>
<span class=normal><a href=#__codelineno-0-1025>1025</a></span>
<span class=normal><a href=#__codelineno-0-1026>1026</a></span>
<span class=normal><a href=#__codelineno-0-1027>1027</a></span>
<span class=normal><a href=#__codelineno-0-1028>1028</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1011><a id=__codelineno-0-1011 name=__codelineno-0-1011></a><span class=k>class</span><span class=w> </span><span class=nc>HubCLI</span><span class=p>:</span>
</span><span id=__span-0-1012><a id=__codelineno-0-1012 name=__codelineno-0-1012></a>    <span class=k>def</span><span class=w> </span><span class=nf>chat</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span><span id=__span-0-1013><a id=__codelineno-0-1013 name=__codelineno-0-1013></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Chat with model from NEAR AI hub.</span>
</span><span id=__span-0-1014><a id=__codelineno-0-1014 name=__codelineno-0-1014></a>
</span><span id=__span-0-1015><a id=__codelineno-0-1015 name=__codelineno-0-1015></a><span class=sd>        Args:</span>
</span><span id=__span-0-1016><a id=__codelineno-0-1016 name=__codelineno-0-1016></a><span class=sd>        ----</span>
</span><span id=__span-0-1017><a id=__codelineno-0-1017 name=__codelineno-0-1017></a><span class=sd>            query (str): User&#39;s query to model</span>
</span><span id=__span-0-1018><a id=__codelineno-0-1018 name=__codelineno-0-1018></a><span class=sd>            endpoint (str): NEAR AI HUB&#39;s url</span>
</span><span id=__span-0-1019><a id=__codelineno-0-1019 name=__codelineno-0-1019></a><span class=sd>            model (str): Name of a model</span>
</span><span id=__span-0-1020><a id=__codelineno-0-1020 name=__codelineno-0-1020></a><span class=sd>            provider (str): Name of a provider</span>
</span><span id=__span-0-1021><a id=__codelineno-0-1021 name=__codelineno-0-1021></a><span class=sd>            info (bool): Display system info</span>
</span><span id=__span-0-1022><a id=__codelineno-0-1022 name=__codelineno-0-1022></a><span class=sd>            kwargs (Dict[str, Any]): All cli keyword arguments</span>
</span><span id=__span-0-1023><a id=__codelineno-0-1023 name=__codelineno-0-1023></a>
</span><span id=__span-0-1024><a id=__codelineno-0-1024 name=__codelineno-0-1024></a><span class=sd>        &quot;&quot;&quot;</span>
</span><span id=__span-0-1025><a id=__codelineno-0-1025 name=__codelineno-0-1025></a>        <span class=kn>from</span><span class=w> </span><span class=nn>nearai.hub</span><span class=w> </span><span class=kn>import</span> <span class=n>Hub</span>
</span><span id=__span-0-1026><a id=__codelineno-0-1026 name=__codelineno-0-1026></a>
</span><span id=__span-0-1027><a id=__codelineno-0-1027 name=__codelineno-0-1027></a>        <span class=n>hub</span> <span class=o>=</span> <span class=n>Hub</span><span class=p>(</span><span class=n>CONFIG</span><span class=p>)</span>
</span><span id=__span-0-1028><a id=__codelineno-0-1028 name=__codelineno-0-1028></a>        <span class=n>hub</span><span class=o>.</span><span class=n>chat</span><span class=p>(</span><span class=n>kwargs</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h5 id=nearai.cli.HubCLI.chat class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">chat</span> <a href=#nearai.cli.HubCLI.chat class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>chat</span><span class=p>(</span><span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Chat with model from NEAR AI hub.</p> <hr> <div class="language-text highlight"><pre><span></span><code>query (str): User&#39;s query to model
endpoint (str): NEAR AI HUB&#39;s url
model (str): Name of a model
provider (str): Name of a provider
info (bool): Display system info
kwargs (Dict[str, Any]): All cli keyword arguments
</code></pre></div> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1012>1012</a></span>
<span class=normal><a href=#__codelineno-0-1013>1013</a></span>
<span class=normal><a href=#__codelineno-0-1014>1014</a></span>
<span class=normal><a href=#__codelineno-0-1015>1015</a></span>
<span class=normal><a href=#__codelineno-0-1016>1016</a></span>
<span class=normal><a href=#__codelineno-0-1017>1017</a></span>
<span class=normal><a href=#__codelineno-0-1018>1018</a></span>
<span class=normal><a href=#__codelineno-0-1019>1019</a></span>
<span class=normal><a href=#__codelineno-0-1020>1020</a></span>
<span class=normal><a href=#__codelineno-0-1021>1021</a></span>
<span class=normal><a href=#__codelineno-0-1022>1022</a></span>
<span class=normal><a href=#__codelineno-0-1023>1023</a></span>
<span class=normal><a href=#__codelineno-0-1024>1024</a></span>
<span class=normal><a href=#__codelineno-0-1025>1025</a></span>
<span class=normal><a href=#__codelineno-0-1026>1026</a></span>
<span class=normal><a href=#__codelineno-0-1027>1027</a></span>
<span class=normal><a href=#__codelineno-0-1028>1028</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1012><a id=__codelineno-0-1012 name=__codelineno-0-1012></a><span class=k>def</span><span class=w> </span><span class=nf>chat</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span><span id=__span-0-1013><a id=__codelineno-0-1013 name=__codelineno-0-1013></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Chat with model from NEAR AI hub.</span>
</span><span id=__span-0-1014><a id=__codelineno-0-1014 name=__codelineno-0-1014></a>
</span><span id=__span-0-1015><a id=__codelineno-0-1015 name=__codelineno-0-1015></a><span class=sd>    Args:</span>
</span><span id=__span-0-1016><a id=__codelineno-0-1016 name=__codelineno-0-1016></a><span class=sd>    ----</span>
</span><span id=__span-0-1017><a id=__codelineno-0-1017 name=__codelineno-0-1017></a><span class=sd>        query (str): User&#39;s query to model</span>
</span><span id=__span-0-1018><a id=__codelineno-0-1018 name=__codelineno-0-1018></a><span class=sd>        endpoint (str): NEAR AI HUB&#39;s url</span>
</span><span id=__span-0-1019><a id=__codelineno-0-1019 name=__codelineno-0-1019></a><span class=sd>        model (str): Name of a model</span>
</span><span id=__span-0-1020><a id=__codelineno-0-1020 name=__codelineno-0-1020></a><span class=sd>        provider (str): Name of a provider</span>
</span><span id=__span-0-1021><a id=__codelineno-0-1021 name=__codelineno-0-1021></a><span class=sd>        info (bool): Display system info</span>
</span><span id=__span-0-1022><a id=__codelineno-0-1022 name=__codelineno-0-1022></a><span class=sd>        kwargs (Dict[str, Any]): All cli keyword arguments</span>
</span><span id=__span-0-1023><a id=__codelineno-0-1023 name=__codelineno-0-1023></a>
</span><span id=__span-0-1024><a id=__codelineno-0-1024 name=__codelineno-0-1024></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-1025><a id=__codelineno-0-1025 name=__codelineno-0-1025></a>    <span class=kn>from</span><span class=w> </span><span class=nn>nearai.hub</span><span class=w> </span><span class=kn>import</span> <span class=n>Hub</span>
</span><span id=__span-0-1026><a id=__codelineno-0-1026 name=__codelineno-0-1026></a>
</span><span id=__span-0-1027><a id=__codelineno-0-1027 name=__codelineno-0-1027></a>    <span class=n>hub</span> <span class=o>=</span> <span class=n>Hub</span><span class=p>(</span><span class=n>CONFIG</span><span class=p>)</span>
</span><span id=__span-0-1028><a id=__codelineno-0-1028 name=__codelineno-0-1028></a>    <span class=n>hub</span><span class=o>.</span><span class=n>chat</span><span class=p>(</span><span class=n>kwargs</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h4 id=nearai.cli.LoginCLI class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">LoginCLI</span> <a href=#nearai.cli.LoginCLI class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1045>1045</a></span>
<span class=normal><a href=#__codelineno-0-1046>1046</a></span>
<span class=normal><a href=#__codelineno-0-1047>1047</a></span>
<span class=normal><a href=#__codelineno-0-1048>1048</a></span>
<span class=normal><a href=#__codelineno-0-1049>1049</a></span>
<span class=normal><a href=#__codelineno-0-1050>1050</a></span>
<span class=normal><a href=#__codelineno-0-1051>1051</a></span>
<span class=normal><a href=#__codelineno-0-1052>1052</a></span>
<span class=normal><a href=#__codelineno-0-1053>1053</a></span>
<span class=normal><a href=#__codelineno-0-1054>1054</a></span>
<span class=normal><a href=#__codelineno-0-1055>1055</a></span>
<span class=normal><a href=#__codelineno-0-1056>1056</a></span>
<span class=normal><a href=#__codelineno-0-1057>1057</a></span>
<span class=normal><a href=#__codelineno-0-1058>1058</a></span>
<span class=normal><a href=#__codelineno-0-1059>1059</a></span>
<span class=normal><a href=#__codelineno-0-1060>1060</a></span>
<span class=normal><a href=#__codelineno-0-1061>1061</a></span>
<span class=normal><a href=#__codelineno-0-1062>1062</a></span>
<span class=normal><a href=#__codelineno-0-1063>1063</a></span>
<span class=normal><a href=#__codelineno-0-1064>1064</a></span>
<span class=normal><a href=#__codelineno-0-1065>1065</a></span>
<span class=normal><a href=#__codelineno-0-1066>1066</a></span>
<span class=normal><a href=#__codelineno-0-1067>1067</a></span>
<span class=normal><a href=#__codelineno-0-1068>1068</a></span>
<span class=normal><a href=#__codelineno-0-1069>1069</a></span>
<span class=normal><a href=#__codelineno-0-1070>1070</a></span>
<span class=normal><a href=#__codelineno-0-1071>1071</a></span>
<span class=normal><a href=#__codelineno-0-1072>1072</a></span>
<span class=normal><a href=#__codelineno-0-1073>1073</a></span>
<span class=normal><a href=#__codelineno-0-1074>1074</a></span>
<span class=normal><a href=#__codelineno-0-1075>1075</a></span>
<span class=normal><a href=#__codelineno-0-1076>1076</a></span>
<span class=normal><a href=#__codelineno-0-1077>1077</a></span>
<span class=normal><a href=#__codelineno-0-1078>1078</a></span>
<span class=normal><a href=#__codelineno-0-1079>1079</a></span>
<span class=normal><a href=#__codelineno-0-1080>1080</a></span>
<span class=normal><a href=#__codelineno-0-1081>1081</a></span>
<span class=normal><a href=#__codelineno-0-1082>1082</a></span>
<span class=normal><a href=#__codelineno-0-1083>1083</a></span>
<span class=normal><a href=#__codelineno-0-1084>1084</a></span>
<span class=normal><a href=#__codelineno-0-1085>1085</a></span>
<span class=normal><a href=#__codelineno-0-1086>1086</a></span>
<span class=normal><a href=#__codelineno-0-1087>1087</a></span>
<span class=normal><a href=#__codelineno-0-1088>1088</a></span>
<span class=normal><a href=#__codelineno-0-1089>1089</a></span>
<span class=normal><a href=#__codelineno-0-1090>1090</a></span>
<span class=normal><a href=#__codelineno-0-1091>1091</a></span>
<span class=normal><a href=#__codelineno-0-1092>1092</a></span>
<span class=normal><a href=#__codelineno-0-1093>1093</a></span>
<span class=normal><a href=#__codelineno-0-1094>1094</a></span>
<span class=normal><a href=#__codelineno-0-1095>1095</a></span>
<span class=normal><a href=#__codelineno-0-1096>1096</a></span>
<span class=normal><a href=#__codelineno-0-1097>1097</a></span>
<span class=normal><a href=#__codelineno-0-1098>1098</a></span>
<span class=normal><a href=#__codelineno-0-1099>1099</a></span>
<span class=normal><a href=#__codelineno-0-1100>1100</a></span>
<span class=normal><a href=#__codelineno-0-1101>1101</a></span>
<span class=normal><a href=#__codelineno-0-1102>1102</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1045><a id=__codelineno-0-1045 name=__codelineno-0-1045></a><span class=k>class</span><span class=w> </span><span class=nc>LoginCLI</span><span class=p>:</span>
</span><span id=__span-0-1046><a id=__codelineno-0-1046 name=__codelineno-0-1046></a>    <span class=k>def</span><span class=w> </span><span class=fm>__call__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span><span id=__span-0-1047><a id=__codelineno-0-1047 name=__codelineno-0-1047></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Login with NEAR Mainnet account.</span>
</span><span id=__span-0-1048><a id=__codelineno-0-1048 name=__codelineno-0-1048></a>
</span><span id=__span-0-1049><a id=__codelineno-0-1049 name=__codelineno-0-1049></a><span class=sd>        Args:</span>
</span><span id=__span-0-1050><a id=__codelineno-0-1050 name=__codelineno-0-1050></a><span class=sd>        ----</span>
</span><span id=__span-0-1051><a id=__codelineno-0-1051 name=__codelineno-0-1051></a><span class=sd>            remote (bool): Remote login allows signing message with NEAR Account on a remote machine</span>
</span><span id=__span-0-1052><a id=__codelineno-0-1052 name=__codelineno-0-1052></a><span class=sd>            auth_url (str): Url to the auth portal</span>
</span><span id=__span-0-1053><a id=__codelineno-0-1053 name=__codelineno-0-1053></a><span class=sd>            accountId (str): AccountId in .near-credentials folder to signMessage</span>
</span><span id=__span-0-1054><a id=__codelineno-0-1054 name=__codelineno-0-1054></a><span class=sd>            privateKey (str): Private Key to sign a message</span>
</span><span id=__span-0-1055><a id=__codelineno-0-1055 name=__codelineno-0-1055></a><span class=sd>            kwargs (Dict[str, Any]): All cli keyword arguments</span>
</span><span id=__span-0-1056><a id=__codelineno-0-1056 name=__codelineno-0-1056></a>
</span><span id=__span-0-1057><a id=__codelineno-0-1057 name=__codelineno-0-1057></a><span class=sd>        &quot;&quot;&quot;</span>
</span><span id=__span-0-1058><a id=__codelineno-0-1058 name=__codelineno-0-1058></a>        <span class=kn>from</span><span class=w> </span><span class=nn>nearai.login</span><span class=w> </span><span class=kn>import</span> <span class=n>generate_and_save_signature</span><span class=p>,</span> <span class=n>login_with_file_credentials</span><span class=p>,</span> <span class=n>login_with_near_auth</span>
</span><span id=__span-0-1059><a id=__codelineno-0-1059 name=__codelineno-0-1059></a>
</span><span id=__span-0-1060><a id=__codelineno-0-1060 name=__codelineno-0-1060></a>        <span class=n>remote</span> <span class=o>=</span> <span class=n>kwargs</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;remote&quot;</span><span class=p>,</span> <span class=kc>False</span><span class=p>)</span>
</span><span id=__span-0-1061><a id=__codelineno-0-1061 name=__codelineno-0-1061></a>        <span class=n>account_id</span> <span class=o>=</span> <span class=n>kwargs</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;accountId&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
</span><span id=__span-0-1062><a id=__codelineno-0-1062 name=__codelineno-0-1062></a>        <span class=n>private_key</span> <span class=o>=</span> <span class=n>kwargs</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;privateKey&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
</span><span id=__span-0-1063><a id=__codelineno-0-1063 name=__codelineno-0-1063></a>
</span><span id=__span-0-1064><a id=__codelineno-0-1064 name=__codelineno-0-1064></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>remote</span> <span class=ow>and</span> <span class=n>account_id</span> <span class=ow>and</span> <span class=n>private_key</span><span class=p>:</span>
</span><span id=__span-0-1065><a id=__codelineno-0-1065 name=__codelineno-0-1065></a>            <span class=n>generate_and_save_signature</span><span class=p>(</span><span class=n>account_id</span><span class=p>,</span> <span class=n>private_key</span><span class=p>)</span>
</span><span id=__span-0-1066><a id=__codelineno-0-1066 name=__codelineno-0-1066></a>        <span class=k>elif</span> <span class=ow>not</span> <span class=n>remote</span> <span class=ow>and</span> <span class=n>account_id</span><span class=p>:</span>
</span><span id=__span-0-1067><a id=__codelineno-0-1067 name=__codelineno-0-1067></a>            <span class=n>login_with_file_credentials</span><span class=p>(</span><span class=n>account_id</span><span class=p>)</span>
</span><span id=__span-0-1068><a id=__codelineno-0-1068 name=__codelineno-0-1068></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-1069><a id=__codelineno-0-1069 name=__codelineno-0-1069></a>            <span class=n>auth_url</span> <span class=o>=</span> <span class=n>kwargs</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;auth_url&quot;</span><span class=p>,</span> <span class=s2>&quot;https://auth.near.ai&quot;</span><span class=p>)</span>
</span><span id=__span-0-1070><a id=__codelineno-0-1070 name=__codelineno-0-1070></a>            <span class=n>login_with_near_auth</span><span class=p>(</span><span class=n>remote</span><span class=p>,</span> <span class=n>auth_url</span><span class=p>)</span>
</span><span id=__span-0-1071><a id=__codelineno-0-1071 name=__codelineno-0-1071></a>
</span><span id=__span-0-1072><a id=__codelineno-0-1072 name=__codelineno-0-1072></a>    <span class=k>def</span><span class=w> </span><span class=nf>status</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-0-1073><a id=__codelineno-0-1073 name=__codelineno-0-1073></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Load NEAR account authorization data.&quot;&quot;&quot;</span>
</span><span id=__span-0-1074><a id=__codelineno-0-1074 name=__codelineno-0-1074></a>        <span class=kn>from</span><span class=w> </span><span class=nn>nearai.login</span><span class=w> </span><span class=kn>import</span> <span class=n>print_login_status</span>
</span><span id=__span-0-1075><a id=__codelineno-0-1075 name=__codelineno-0-1075></a>
</span><span id=__span-0-1076><a id=__codelineno-0-1076 name=__codelineno-0-1076></a>        <span class=n>print_login_status</span><span class=p>()</span>
</span><span id=__span-0-1077><a id=__codelineno-0-1077 name=__codelineno-0-1077></a>
</span><span id=__span-0-1078><a id=__codelineno-0-1078 name=__codelineno-0-1078></a>    <span class=k>def</span><span class=w> </span><span class=nf>save</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span><span id=__span-0-1079><a id=__codelineno-0-1079 name=__codelineno-0-1079></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Save NEAR account authorization data.</span>
</span><span id=__span-0-1080><a id=__codelineno-0-1080 name=__codelineno-0-1080></a>
</span><span id=__span-0-1081><a id=__codelineno-0-1081 name=__codelineno-0-1081></a><span class=sd>        Args:</span>
</span><span id=__span-0-1082><a id=__codelineno-0-1082 name=__codelineno-0-1082></a><span class=sd>        ----</span>
</span><span id=__span-0-1083><a id=__codelineno-0-1083 name=__codelineno-0-1083></a><span class=sd>            accountId (str): Near Account</span>
</span><span id=__span-0-1084><a id=__codelineno-0-1084 name=__codelineno-0-1084></a><span class=sd>            signature (str): Signature</span>
</span><span id=__span-0-1085><a id=__codelineno-0-1085 name=__codelineno-0-1085></a><span class=sd>            publicKey (str): Public Key used to sign</span>
</span><span id=__span-0-1086><a id=__codelineno-0-1086 name=__codelineno-0-1086></a><span class=sd>            callbackUrl (str): Callback Url</span>
</span><span id=__span-0-1087><a id=__codelineno-0-1087 name=__codelineno-0-1087></a><span class=sd>            nonce (str): nonce</span>
</span><span id=__span-0-1088><a id=__codelineno-0-1088 name=__codelineno-0-1088></a><span class=sd>            kwargs (Dict[str, Any]): All cli keyword arguments</span>
</span><span id=__span-0-1089><a id=__codelineno-0-1089 name=__codelineno-0-1089></a>
</span><span id=__span-0-1090><a id=__codelineno-0-1090 name=__codelineno-0-1090></a><span class=sd>        &quot;&quot;&quot;</span>
</span><span id=__span-0-1091><a id=__codelineno-0-1091 name=__codelineno-0-1091></a>        <span class=kn>from</span><span class=w> </span><span class=nn>nearai.login</span><span class=w> </span><span class=kn>import</span> <span class=n>update_auth_config</span>
</span><span id=__span-0-1092><a id=__codelineno-0-1092 name=__codelineno-0-1092></a>
</span><span id=__span-0-1093><a id=__codelineno-0-1093 name=__codelineno-0-1093></a>        <span class=n>account_id</span> <span class=o>=</span> <span class=n>kwargs</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;accountId&quot;</span><span class=p>)</span>
</span><span id=__span-0-1094><a id=__codelineno-0-1094 name=__codelineno-0-1094></a>        <span class=n>signature</span> <span class=o>=</span> <span class=n>kwargs</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;signature&quot;</span><span class=p>)</span>
</span><span id=__span-0-1095><a id=__codelineno-0-1095 name=__codelineno-0-1095></a>        <span class=n>public_key</span> <span class=o>=</span> <span class=n>kwargs</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;publicKey&quot;</span><span class=p>)</span>
</span><span id=__span-0-1096><a id=__codelineno-0-1096 name=__codelineno-0-1096></a>        <span class=n>callback_url</span> <span class=o>=</span> <span class=n>kwargs</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;callbackUrl&quot;</span><span class=p>)</span>
</span><span id=__span-0-1097><a id=__codelineno-0-1097 name=__codelineno-0-1097></a>        <span class=n>nonce</span> <span class=o>=</span> <span class=n>kwargs</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;nonce&quot;</span><span class=p>)</span>
</span><span id=__span-0-1098><a id=__codelineno-0-1098 name=__codelineno-0-1098></a>
</span><span id=__span-0-1099><a id=__codelineno-0-1099 name=__codelineno-0-1099></a>        <span class=k>if</span> <span class=n>account_id</span> <span class=ow>and</span> <span class=n>signature</span> <span class=ow>and</span> <span class=n>public_key</span> <span class=ow>and</span> <span class=n>callback_url</span> <span class=ow>and</span> <span class=n>nonce</span><span class=p>:</span>
</span><span id=__span-0-1100><a id=__codelineno-0-1100 name=__codelineno-0-1100></a>            <span class=n>update_auth_config</span><span class=p>(</span><span class=n>account_id</span><span class=p>,</span> <span class=n>signature</span><span class=p>,</span> <span class=n>public_key</span><span class=p>,</span> <span class=n>callback_url</span><span class=p>,</span> <span class=n>nonce</span><span class=p>)</span>
</span><span id=__span-0-1101><a id=__codelineno-0-1101 name=__codelineno-0-1101></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-1102><a id=__codelineno-0-1102 name=__codelineno-0-1102></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Missing data&quot;</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h5 id=nearai.cli.LoginCLI.__call__ class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">__call__</span> <a href=#nearai.cli.LoginCLI.__call__ class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=fm>__call__</span><span class=p>(</span><span class=o>**</span><span class=nf>kwargs</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Login with NEAR Mainnet account.</p> <hr> <div class="language-text highlight"><pre><span></span><code>remote (bool): Remote login allows signing message with NEAR Account on a remote machine
auth_url (str): Url to the auth portal
accountId (str): AccountId in .near-credentials folder to signMessage
privateKey (str): Private Key to sign a message
kwargs (Dict[str, Any]): All cli keyword arguments
</code></pre></div> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1046>1046</a></span>
<span class=normal><a href=#__codelineno-0-1047>1047</a></span>
<span class=normal><a href=#__codelineno-0-1048>1048</a></span>
<span class=normal><a href=#__codelineno-0-1049>1049</a></span>
<span class=normal><a href=#__codelineno-0-1050>1050</a></span>
<span class=normal><a href=#__codelineno-0-1051>1051</a></span>
<span class=normal><a href=#__codelineno-0-1052>1052</a></span>
<span class=normal><a href=#__codelineno-0-1053>1053</a></span>
<span class=normal><a href=#__codelineno-0-1054>1054</a></span>
<span class=normal><a href=#__codelineno-0-1055>1055</a></span>
<span class=normal><a href=#__codelineno-0-1056>1056</a></span>
<span class=normal><a href=#__codelineno-0-1057>1057</a></span>
<span class=normal><a href=#__codelineno-0-1058>1058</a></span>
<span class=normal><a href=#__codelineno-0-1059>1059</a></span>
<span class=normal><a href=#__codelineno-0-1060>1060</a></span>
<span class=normal><a href=#__codelineno-0-1061>1061</a></span>
<span class=normal><a href=#__codelineno-0-1062>1062</a></span>
<span class=normal><a href=#__codelineno-0-1063>1063</a></span>
<span class=normal><a href=#__codelineno-0-1064>1064</a></span>
<span class=normal><a href=#__codelineno-0-1065>1065</a></span>
<span class=normal><a href=#__codelineno-0-1066>1066</a></span>
<span class=normal><a href=#__codelineno-0-1067>1067</a></span>
<span class=normal><a href=#__codelineno-0-1068>1068</a></span>
<span class=normal><a href=#__codelineno-0-1069>1069</a></span>
<span class=normal><a href=#__codelineno-0-1070>1070</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1046><a id=__codelineno-0-1046 name=__codelineno-0-1046></a><span class=k>def</span><span class=w> </span><span class=fm>__call__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span><span id=__span-0-1047><a id=__codelineno-0-1047 name=__codelineno-0-1047></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Login with NEAR Mainnet account.</span>
</span><span id=__span-0-1048><a id=__codelineno-0-1048 name=__codelineno-0-1048></a>
</span><span id=__span-0-1049><a id=__codelineno-0-1049 name=__codelineno-0-1049></a><span class=sd>    Args:</span>
</span><span id=__span-0-1050><a id=__codelineno-0-1050 name=__codelineno-0-1050></a><span class=sd>    ----</span>
</span><span id=__span-0-1051><a id=__codelineno-0-1051 name=__codelineno-0-1051></a><span class=sd>        remote (bool): Remote login allows signing message with NEAR Account on a remote machine</span>
</span><span id=__span-0-1052><a id=__codelineno-0-1052 name=__codelineno-0-1052></a><span class=sd>        auth_url (str): Url to the auth portal</span>
</span><span id=__span-0-1053><a id=__codelineno-0-1053 name=__codelineno-0-1053></a><span class=sd>        accountId (str): AccountId in .near-credentials folder to signMessage</span>
</span><span id=__span-0-1054><a id=__codelineno-0-1054 name=__codelineno-0-1054></a><span class=sd>        privateKey (str): Private Key to sign a message</span>
</span><span id=__span-0-1055><a id=__codelineno-0-1055 name=__codelineno-0-1055></a><span class=sd>        kwargs (Dict[str, Any]): All cli keyword arguments</span>
</span><span id=__span-0-1056><a id=__codelineno-0-1056 name=__codelineno-0-1056></a>
</span><span id=__span-0-1057><a id=__codelineno-0-1057 name=__codelineno-0-1057></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-1058><a id=__codelineno-0-1058 name=__codelineno-0-1058></a>    <span class=kn>from</span><span class=w> </span><span class=nn>nearai.login</span><span class=w> </span><span class=kn>import</span> <span class=n>generate_and_save_signature</span><span class=p>,</span> <span class=n>login_with_file_credentials</span><span class=p>,</span> <span class=n>login_with_near_auth</span>
</span><span id=__span-0-1059><a id=__codelineno-0-1059 name=__codelineno-0-1059></a>
</span><span id=__span-0-1060><a id=__codelineno-0-1060 name=__codelineno-0-1060></a>    <span class=n>remote</span> <span class=o>=</span> <span class=n>kwargs</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;remote&quot;</span><span class=p>,</span> <span class=kc>False</span><span class=p>)</span>
</span><span id=__span-0-1061><a id=__codelineno-0-1061 name=__codelineno-0-1061></a>    <span class=n>account_id</span> <span class=o>=</span> <span class=n>kwargs</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;accountId&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
</span><span id=__span-0-1062><a id=__codelineno-0-1062 name=__codelineno-0-1062></a>    <span class=n>private_key</span> <span class=o>=</span> <span class=n>kwargs</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;privateKey&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
</span><span id=__span-0-1063><a id=__codelineno-0-1063 name=__codelineno-0-1063></a>
</span><span id=__span-0-1064><a id=__codelineno-0-1064 name=__codelineno-0-1064></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>remote</span> <span class=ow>and</span> <span class=n>account_id</span> <span class=ow>and</span> <span class=n>private_key</span><span class=p>:</span>
</span><span id=__span-0-1065><a id=__codelineno-0-1065 name=__codelineno-0-1065></a>        <span class=n>generate_and_save_signature</span><span class=p>(</span><span class=n>account_id</span><span class=p>,</span> <span class=n>private_key</span><span class=p>)</span>
</span><span id=__span-0-1066><a id=__codelineno-0-1066 name=__codelineno-0-1066></a>    <span class=k>elif</span> <span class=ow>not</span> <span class=n>remote</span> <span class=ow>and</span> <span class=n>account_id</span><span class=p>:</span>
</span><span id=__span-0-1067><a id=__codelineno-0-1067 name=__codelineno-0-1067></a>        <span class=n>login_with_file_credentials</span><span class=p>(</span><span class=n>account_id</span><span class=p>)</span>
</span><span id=__span-0-1068><a id=__codelineno-0-1068 name=__codelineno-0-1068></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-1069><a id=__codelineno-0-1069 name=__codelineno-0-1069></a>        <span class=n>auth_url</span> <span class=o>=</span> <span class=n>kwargs</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;auth_url&quot;</span><span class=p>,</span> <span class=s2>&quot;https://auth.near.ai&quot;</span><span class=p>)</span>
</span><span id=__span-0-1070><a id=__codelineno-0-1070 name=__codelineno-0-1070></a>        <span class=n>login_with_near_auth</span><span class=p>(</span><span class=n>remote</span><span class=p>,</span> <span class=n>auth_url</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.cli.LoginCLI.save class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">save</span> <a href=#nearai.cli.LoginCLI.save class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>save</span><span class=p>(</span><span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Save NEAR account authorization data.</p> <hr> <div class="language-text highlight"><pre><span></span><code>accountId (str): Near Account
signature (str): Signature
publicKey (str): Public Key used to sign
callbackUrl (str): Callback Url
nonce (str): nonce
kwargs (Dict[str, Any]): All cli keyword arguments
</code></pre></div> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1078>1078</a></span>
<span class=normal><a href=#__codelineno-0-1079>1079</a></span>
<span class=normal><a href=#__codelineno-0-1080>1080</a></span>
<span class=normal><a href=#__codelineno-0-1081>1081</a></span>
<span class=normal><a href=#__codelineno-0-1082>1082</a></span>
<span class=normal><a href=#__codelineno-0-1083>1083</a></span>
<span class=normal><a href=#__codelineno-0-1084>1084</a></span>
<span class=normal><a href=#__codelineno-0-1085>1085</a></span>
<span class=normal><a href=#__codelineno-0-1086>1086</a></span>
<span class=normal><a href=#__codelineno-0-1087>1087</a></span>
<span class=normal><a href=#__codelineno-0-1088>1088</a></span>
<span class=normal><a href=#__codelineno-0-1089>1089</a></span>
<span class=normal><a href=#__codelineno-0-1090>1090</a></span>
<span class=normal><a href=#__codelineno-0-1091>1091</a></span>
<span class=normal><a href=#__codelineno-0-1092>1092</a></span>
<span class=normal><a href=#__codelineno-0-1093>1093</a></span>
<span class=normal><a href=#__codelineno-0-1094>1094</a></span>
<span class=normal><a href=#__codelineno-0-1095>1095</a></span>
<span class=normal><a href=#__codelineno-0-1096>1096</a></span>
<span class=normal><a href=#__codelineno-0-1097>1097</a></span>
<span class=normal><a href=#__codelineno-0-1098>1098</a></span>
<span class=normal><a href=#__codelineno-0-1099>1099</a></span>
<span class=normal><a href=#__codelineno-0-1100>1100</a></span>
<span class=normal><a href=#__codelineno-0-1101>1101</a></span>
<span class=normal><a href=#__codelineno-0-1102>1102</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1078><a id=__codelineno-0-1078 name=__codelineno-0-1078></a><span class=k>def</span><span class=w> </span><span class=nf>save</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span><span id=__span-0-1079><a id=__codelineno-0-1079 name=__codelineno-0-1079></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Save NEAR account authorization data.</span>
</span><span id=__span-0-1080><a id=__codelineno-0-1080 name=__codelineno-0-1080></a>
</span><span id=__span-0-1081><a id=__codelineno-0-1081 name=__codelineno-0-1081></a><span class=sd>    Args:</span>
</span><span id=__span-0-1082><a id=__codelineno-0-1082 name=__codelineno-0-1082></a><span class=sd>    ----</span>
</span><span id=__span-0-1083><a id=__codelineno-0-1083 name=__codelineno-0-1083></a><span class=sd>        accountId (str): Near Account</span>
</span><span id=__span-0-1084><a id=__codelineno-0-1084 name=__codelineno-0-1084></a><span class=sd>        signature (str): Signature</span>
</span><span id=__span-0-1085><a id=__codelineno-0-1085 name=__codelineno-0-1085></a><span class=sd>        publicKey (str): Public Key used to sign</span>
</span><span id=__span-0-1086><a id=__codelineno-0-1086 name=__codelineno-0-1086></a><span class=sd>        callbackUrl (str): Callback Url</span>
</span><span id=__span-0-1087><a id=__codelineno-0-1087 name=__codelineno-0-1087></a><span class=sd>        nonce (str): nonce</span>
</span><span id=__span-0-1088><a id=__codelineno-0-1088 name=__codelineno-0-1088></a><span class=sd>        kwargs (Dict[str, Any]): All cli keyword arguments</span>
</span><span id=__span-0-1089><a id=__codelineno-0-1089 name=__codelineno-0-1089></a>
</span><span id=__span-0-1090><a id=__codelineno-0-1090 name=__codelineno-0-1090></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-1091><a id=__codelineno-0-1091 name=__codelineno-0-1091></a>    <span class=kn>from</span><span class=w> </span><span class=nn>nearai.login</span><span class=w> </span><span class=kn>import</span> <span class=n>update_auth_config</span>
</span><span id=__span-0-1092><a id=__codelineno-0-1092 name=__codelineno-0-1092></a>
</span><span id=__span-0-1093><a id=__codelineno-0-1093 name=__codelineno-0-1093></a>    <span class=n>account_id</span> <span class=o>=</span> <span class=n>kwargs</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;accountId&quot;</span><span class=p>)</span>
</span><span id=__span-0-1094><a id=__codelineno-0-1094 name=__codelineno-0-1094></a>    <span class=n>signature</span> <span class=o>=</span> <span class=n>kwargs</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;signature&quot;</span><span class=p>)</span>
</span><span id=__span-0-1095><a id=__codelineno-0-1095 name=__codelineno-0-1095></a>    <span class=n>public_key</span> <span class=o>=</span> <span class=n>kwargs</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;publicKey&quot;</span><span class=p>)</span>
</span><span id=__span-0-1096><a id=__codelineno-0-1096 name=__codelineno-0-1096></a>    <span class=n>callback_url</span> <span class=o>=</span> <span class=n>kwargs</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;callbackUrl&quot;</span><span class=p>)</span>
</span><span id=__span-0-1097><a id=__codelineno-0-1097 name=__codelineno-0-1097></a>    <span class=n>nonce</span> <span class=o>=</span> <span class=n>kwargs</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;nonce&quot;</span><span class=p>)</span>
</span><span id=__span-0-1098><a id=__codelineno-0-1098 name=__codelineno-0-1098></a>
</span><span id=__span-0-1099><a id=__codelineno-0-1099 name=__codelineno-0-1099></a>    <span class=k>if</span> <span class=n>account_id</span> <span class=ow>and</span> <span class=n>signature</span> <span class=ow>and</span> <span class=n>public_key</span> <span class=ow>and</span> <span class=n>callback_url</span> <span class=ow>and</span> <span class=n>nonce</span><span class=p>:</span>
</span><span id=__span-0-1100><a id=__codelineno-0-1100 name=__codelineno-0-1100></a>        <span class=n>update_auth_config</span><span class=p>(</span><span class=n>account_id</span><span class=p>,</span> <span class=n>signature</span><span class=p>,</span> <span class=n>public_key</span><span class=p>,</span> <span class=n>callback_url</span><span class=p>,</span> <span class=n>nonce</span><span class=p>)</span>
</span><span id=__span-0-1101><a id=__codelineno-0-1101 name=__codelineno-0-1101></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-1102><a id=__codelineno-0-1102 name=__codelineno-0-1102></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Missing data&quot;</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.cli.LoginCLI.status class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">status</span> <a href=#nearai.cli.LoginCLI.status class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>status</span><span class=p>()</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Load NEAR account authorization data.</p> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1072>1072</a></span>
<span class=normal><a href=#__codelineno-0-1073>1073</a></span>
<span class=normal><a href=#__codelineno-0-1074>1074</a></span>
<span class=normal><a href=#__codelineno-0-1075>1075</a></span>
<span class=normal><a href=#__codelineno-0-1076>1076</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1072><a id=__codelineno-0-1072 name=__codelineno-0-1072></a><span class=k>def</span><span class=w> </span><span class=nf>status</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-0-1073><a id=__codelineno-0-1073 name=__codelineno-0-1073></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Load NEAR account authorization data.&quot;&quot;&quot;</span>
</span><span id=__span-0-1074><a id=__codelineno-0-1074 name=__codelineno-0-1074></a>    <span class=kn>from</span><span class=w> </span><span class=nn>nearai.login</span><span class=w> </span><span class=kn>import</span> <span class=n>print_login_status</span>
</span><span id=__span-0-1075><a id=__codelineno-0-1075 name=__codelineno-0-1075></a>
</span><span id=__span-0-1076><a id=__codelineno-0-1076 name=__codelineno-0-1076></a>    <span class=n>print_login_status</span><span class=p>()</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h4 id=nearai.cli.LogoutCLI class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">LogoutCLI</span> <a href=#nearai.cli.LogoutCLI class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1031>1031</a></span>
<span class=normal><a href=#__codelineno-0-1032>1032</a></span>
<span class=normal><a href=#__codelineno-0-1033>1033</a></span>
<span class=normal><a href=#__codelineno-0-1034>1034</a></span>
<span class=normal><a href=#__codelineno-0-1035>1035</a></span>
<span class=normal><a href=#__codelineno-0-1036>1036</a></span>
<span class=normal><a href=#__codelineno-0-1037>1037</a></span>
<span class=normal><a href=#__codelineno-0-1038>1038</a></span>
<span class=normal><a href=#__codelineno-0-1039>1039</a></span>
<span class=normal><a href=#__codelineno-0-1040>1040</a></span>
<span class=normal><a href=#__codelineno-0-1041>1041</a></span>
<span class=normal><a href=#__codelineno-0-1042>1042</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1031><a id=__codelineno-0-1031 name=__codelineno-0-1031></a><span class=k>class</span><span class=w> </span><span class=nc>LogoutCLI</span><span class=p>:</span>
</span><span id=__span-0-1032><a id=__codelineno-0-1032 name=__codelineno-0-1032></a>    <span class=k>def</span><span class=w> </span><span class=fm>__call__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span><span id=__span-0-1033><a id=__codelineno-0-1033 name=__codelineno-0-1033></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Clear NEAR account auth data.&quot;&quot;&quot;</span>
</span><span id=__span-0-1034><a id=__codelineno-0-1034 name=__codelineno-0-1034></a>        <span class=kn>from</span><span class=w> </span><span class=nn>nearai.config</span><span class=w> </span><span class=kn>import</span> <span class=n>load_config_file</span><span class=p>,</span> <span class=n>save_config_file</span>
</span><span id=__span-0-1035><a id=__codelineno-0-1035 name=__codelineno-0-1035></a>
</span><span id=__span-0-1036><a id=__codelineno-0-1036 name=__codelineno-0-1036></a>        <span class=n>config</span> <span class=o>=</span> <span class=n>load_config_file</span><span class=p>()</span>
</span><span id=__span-0-1037><a id=__codelineno-0-1037 name=__codelineno-0-1037></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;auth&quot;</span><span class=p>)</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>config</span><span class=p>[</span><span class=s2>&quot;auth&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;account_id&quot;</span><span class=p>):</span>
</span><span id=__span-0-1038><a id=__codelineno-0-1038 name=__codelineno-0-1038></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Auth data does not exist.&quot;</span><span class=p>)</span>
</span><span id=__span-0-1039><a id=__codelineno-0-1039 name=__codelineno-0-1039></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-1040><a id=__codelineno-0-1040 name=__codelineno-0-1040></a>            <span class=n>config</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;auth&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
</span><span id=__span-0-1041><a id=__codelineno-0-1041 name=__codelineno-0-1041></a>            <span class=n>save_config_file</span><span class=p>(</span><span class=n>config</span><span class=p>)</span>
</span><span id=__span-0-1042><a id=__codelineno-0-1042 name=__codelineno-0-1042></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Auth data removed&quot;</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h5 id=nearai.cli.LogoutCLI.__call__ class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">__call__</span> <a href=#nearai.cli.LogoutCLI.__call__ class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=fm>__call__</span><span class=p>(</span><span class=o>**</span><span class=nf>kwargs</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Clear NEAR account auth data.</p> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1032>1032</a></span>
<span class=normal><a href=#__codelineno-0-1033>1033</a></span>
<span class=normal><a href=#__codelineno-0-1034>1034</a></span>
<span class=normal><a href=#__codelineno-0-1035>1035</a></span>
<span class=normal><a href=#__codelineno-0-1036>1036</a></span>
<span class=normal><a href=#__codelineno-0-1037>1037</a></span>
<span class=normal><a href=#__codelineno-0-1038>1038</a></span>
<span class=normal><a href=#__codelineno-0-1039>1039</a></span>
<span class=normal><a href=#__codelineno-0-1040>1040</a></span>
<span class=normal><a href=#__codelineno-0-1041>1041</a></span>
<span class=normal><a href=#__codelineno-0-1042>1042</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1032><a id=__codelineno-0-1032 name=__codelineno-0-1032></a><span class=k>def</span><span class=w> </span><span class=fm>__call__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span><span id=__span-0-1033><a id=__codelineno-0-1033 name=__codelineno-0-1033></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Clear NEAR account auth data.&quot;&quot;&quot;</span>
</span><span id=__span-0-1034><a id=__codelineno-0-1034 name=__codelineno-0-1034></a>    <span class=kn>from</span><span class=w> </span><span class=nn>nearai.config</span><span class=w> </span><span class=kn>import</span> <span class=n>load_config_file</span><span class=p>,</span> <span class=n>save_config_file</span>
</span><span id=__span-0-1035><a id=__codelineno-0-1035 name=__codelineno-0-1035></a>
</span><span id=__span-0-1036><a id=__codelineno-0-1036 name=__codelineno-0-1036></a>    <span class=n>config</span> <span class=o>=</span> <span class=n>load_config_file</span><span class=p>()</span>
</span><span id=__span-0-1037><a id=__codelineno-0-1037 name=__codelineno-0-1037></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;auth&quot;</span><span class=p>)</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>config</span><span class=p>[</span><span class=s2>&quot;auth&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;account_id&quot;</span><span class=p>):</span>
</span><span id=__span-0-1038><a id=__codelineno-0-1038 name=__codelineno-0-1038></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Auth data does not exist.&quot;</span><span class=p>)</span>
</span><span id=__span-0-1039><a id=__codelineno-0-1039 name=__codelineno-0-1039></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-1040><a id=__codelineno-0-1040 name=__codelineno-0-1040></a>        <span class=n>config</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;auth&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
</span><span id=__span-0-1041><a id=__codelineno-0-1041 name=__codelineno-0-1041></a>        <span class=n>save_config_file</span><span class=p>(</span><span class=n>config</span><span class=p>)</span>
</span><span id=__span-0-1042><a id=__codelineno-0-1042 name=__codelineno-0-1042></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Auth data removed&quot;</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h4 id=nearai.cli.PermissionCli class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">PermissionCli</span> <a href=#nearai.cli.PermissionCli class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1105>1105</a></span>
<span class=normal><a href=#__codelineno-0-1106>1106</a></span>
<span class=normal><a href=#__codelineno-0-1107>1107</a></span>
<span class=normal><a href=#__codelineno-0-1108>1108</a></span>
<span class=normal><a href=#__codelineno-0-1109>1109</a></span>
<span class=normal><a href=#__codelineno-0-1110>1110</a></span>
<span class=normal><a href=#__codelineno-0-1111>1111</a></span>
<span class=normal><a href=#__codelineno-0-1112>1112</a></span>
<span class=normal><a href=#__codelineno-0-1113>1113</a></span>
<span class=normal><a href=#__codelineno-0-1114>1114</a></span>
<span class=normal><a href=#__codelineno-0-1115>1115</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1105><a id=__codelineno-0-1105 name=__codelineno-0-1105></a><span class=k>class</span><span class=w> </span><span class=nc>PermissionCli</span><span class=p>:</span>
</span><span id=__span-0-1106><a id=__codelineno-0-1106 name=__codelineno-0-1106></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>  <span class=c1># noqa: D107</span>
</span><span id=__span-0-1107><a id=__codelineno-0-1107 name=__codelineno-0-1107></a>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span> <span class=o>=</span> <span class=n>PermissionsApi</span><span class=p>()</span>
</span><span id=__span-0-1108><a id=__codelineno-0-1108 name=__codelineno-0-1108></a>
</span><span id=__span-0-1109><a id=__codelineno-0-1109 name=__codelineno-0-1109></a>    <span class=k>def</span><span class=w> </span><span class=nf>grant</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>account_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>permission</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-1110><a id=__codelineno-0-1110 name=__codelineno-0-1110></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Grant permission to an account.&quot;&quot;&quot;</span>
</span><span id=__span-0-1111><a id=__codelineno-0-1111 name=__codelineno-0-1111></a>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>grant_permission_v1_permissions_grant_permission_post</span><span class=p>(</span><span class=n>account_id</span><span class=p>,</span> <span class=n>permission</span><span class=p>)</span>
</span><span id=__span-0-1112><a id=__codelineno-0-1112 name=__codelineno-0-1112></a>
</span><span id=__span-0-1113><a id=__codelineno-0-1113 name=__codelineno-0-1113></a>    <span class=k>def</span><span class=w> </span><span class=nf>revoke</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>account_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>permission</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>):</span>
</span><span id=__span-0-1114><a id=__codelineno-0-1114 name=__codelineno-0-1114></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Revoke permission from an account. If permission is empty all permissions are revoked.&quot;&quot;&quot;</span>
</span><span id=__span-0-1115><a id=__codelineno-0-1115 name=__codelineno-0-1115></a>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>revoke_permission_v1_permissions_revoke_permission_post</span><span class=p>(</span><span class=n>account_id</span><span class=p>,</span> <span class=n>permission</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h5 id=nearai.cli.PermissionCli.grant class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">grant</span> <a href=#nearai.cli.PermissionCli.grant class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>grant</span><span class=p>(</span><span class=n>account_id</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>permission</span><span class=p>:</span> <span class=n>str</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Grant permission to an account.</p> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1109>1109</a></span>
<span class=normal><a href=#__codelineno-0-1110>1110</a></span>
<span class=normal><a href=#__codelineno-0-1111>1111</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1109><a id=__codelineno-0-1109 name=__codelineno-0-1109></a><span class=k>def</span><span class=w> </span><span class=nf>grant</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>account_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>permission</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-1110><a id=__codelineno-0-1110 name=__codelineno-0-1110></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Grant permission to an account.&quot;&quot;&quot;</span>
</span><span id=__span-0-1111><a id=__codelineno-0-1111 name=__codelineno-0-1111></a>    <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>grant_permission_v1_permissions_grant_permission_post</span><span class=p>(</span><span class=n>account_id</span><span class=p>,</span> <span class=n>permission</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.cli.PermissionCli.revoke class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">revoke</span> <a href=#nearai.cli.PermissionCli.revoke class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>revoke</span><span class=p>(</span><span class=n>account_id</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>permission</span><span class=p>:</span> <span class=n>str</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Revoke permission from an account. If permission is empty all permissions are revoked.</p> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1113>1113</a></span>
<span class=normal><a href=#__codelineno-0-1114>1114</a></span>
<span class=normal><a href=#__codelineno-0-1115>1115</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1113><a id=__codelineno-0-1113 name=__codelineno-0-1113></a><span class=k>def</span><span class=w> </span><span class=nf>revoke</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>account_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>permission</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>):</span>
</span><span id=__span-0-1114><a id=__codelineno-0-1114 name=__codelineno-0-1114></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Revoke permission from an account. If permission is empty all permissions are revoked.&quot;&quot;&quot;</span>
</span><span id=__span-0-1115><a id=__codelineno-0-1115 name=__codelineno-0-1115></a>    <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>revoke_permission_v1_permissions_revoke_permission_post</span><span class=p>(</span><span class=n>account_id</span><span class=p>,</span> <span class=n>permission</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h4 id=nearai.cli.RegistryCli class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">RegistryCli</span> <a href=#nearai.cli.RegistryCli class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-55> 55</a></span>
<span class=normal><a href=#__codelineno-0-56> 56</a></span>
<span class=normal><a href=#__codelineno-0-57> 57</a></span>
<span class=normal><a href=#__codelineno-0-58> 58</a></span>
<span class=normal><a href=#__codelineno-0-59> 59</a></span>
<span class=normal><a href=#__codelineno-0-60> 60</a></span>
<span class=normal><a href=#__codelineno-0-61> 61</a></span>
<span class=normal><a href=#__codelineno-0-62> 62</a></span>
<span class=normal><a href=#__codelineno-0-63> 63</a></span>
<span class=normal><a href=#__codelineno-0-64> 64</a></span>
<span class=normal><a href=#__codelineno-0-65> 65</a></span>
<span class=normal><a href=#__codelineno-0-66> 66</a></span>
<span class=normal><a href=#__codelineno-0-67> 67</a></span>
<span class=normal><a href=#__codelineno-0-68> 68</a></span>
<span class=normal><a href=#__codelineno-0-69> 69</a></span>
<span class=normal><a href=#__codelineno-0-70> 70</a></span>
<span class=normal><a href=#__codelineno-0-71> 71</a></span>
<span class=normal><a href=#__codelineno-0-72> 72</a></span>
<span class=normal><a href=#__codelineno-0-73> 73</a></span>
<span class=normal><a href=#__codelineno-0-74> 74</a></span>
<span class=normal><a href=#__codelineno-0-75> 75</a></span>
<span class=normal><a href=#__codelineno-0-76> 76</a></span>
<span class=normal><a href=#__codelineno-0-77> 77</a></span>
<span class=normal><a href=#__codelineno-0-78> 78</a></span>
<span class=normal><a href=#__codelineno-0-79> 79</a></span>
<span class=normal><a href=#__codelineno-0-80> 80</a></span>
<span class=normal><a href=#__codelineno-0-81> 81</a></span>
<span class=normal><a href=#__codelineno-0-82> 82</a></span>
<span class=normal><a href=#__codelineno-0-83> 83</a></span>
<span class=normal><a href=#__codelineno-0-84> 84</a></span>
<span class=normal><a href=#__codelineno-0-85> 85</a></span>
<span class=normal><a href=#__codelineno-0-86> 86</a></span>
<span class=normal><a href=#__codelineno-0-87> 87</a></span>
<span class=normal><a href=#__codelineno-0-88> 88</a></span>
<span class=normal><a href=#__codelineno-0-89> 89</a></span>
<span class=normal><a href=#__codelineno-0-90> 90</a></span>
<span class=normal><a href=#__codelineno-0-91> 91</a></span>
<span class=normal><a href=#__codelineno-0-92> 92</a></span>
<span class=normal><a href=#__codelineno-0-93> 93</a></span>
<span class=normal><a href=#__codelineno-0-94> 94</a></span>
<span class=normal><a href=#__codelineno-0-95> 95</a></span>
<span class=normal><a href=#__codelineno-0-96> 96</a></span>
<span class=normal><a href=#__codelineno-0-97> 97</a></span>
<span class=normal><a href=#__codelineno-0-98> 98</a></span>
<span class=normal><a href=#__codelineno-0-99> 99</a></span>
<span class=normal><a href=#__codelineno-0-100>100</a></span>
<span class=normal><a href=#__codelineno-0-101>101</a></span>
<span class=normal><a href=#__codelineno-0-102>102</a></span>
<span class=normal><a href=#__codelineno-0-103>103</a></span>
<span class=normal><a href=#__codelineno-0-104>104</a></span>
<span class=normal><a href=#__codelineno-0-105>105</a></span>
<span class=normal><a href=#__codelineno-0-106>106</a></span>
<span class=normal><a href=#__codelineno-0-107>107</a></span>
<span class=normal><a href=#__codelineno-0-108>108</a></span>
<span class=normal><a href=#__codelineno-0-109>109</a></span>
<span class=normal><a href=#__codelineno-0-110>110</a></span>
<span class=normal><a href=#__codelineno-0-111>111</a></span>
<span class=normal><a href=#__codelineno-0-112>112</a></span>
<span class=normal><a href=#__codelineno-0-113>113</a></span>
<span class=normal><a href=#__codelineno-0-114>114</a></span>
<span class=normal><a href=#__codelineno-0-115>115</a></span>
<span class=normal><a href=#__codelineno-0-116>116</a></span>
<span class=normal><a href=#__codelineno-0-117>117</a></span>
<span class=normal><a href=#__codelineno-0-118>118</a></span>
<span class=normal><a href=#__codelineno-0-119>119</a></span>
<span class=normal><a href=#__codelineno-0-120>120</a></span>
<span class=normal><a href=#__codelineno-0-121>121</a></span>
<span class=normal><a href=#__codelineno-0-122>122</a></span>
<span class=normal><a href=#__codelineno-0-123>123</a></span>
<span class=normal><a href=#__codelineno-0-124>124</a></span>
<span class=normal><a href=#__codelineno-0-125>125</a></span>
<span class=normal><a href=#__codelineno-0-126>126</a></span>
<span class=normal><a href=#__codelineno-0-127>127</a></span>
<span class=normal><a href=#__codelineno-0-128>128</a></span>
<span class=normal><a href=#__codelineno-0-129>129</a></span>
<span class=normal><a href=#__codelineno-0-130>130</a></span>
<span class=normal><a href=#__codelineno-0-131>131</a></span>
<span class=normal><a href=#__codelineno-0-132>132</a></span>
<span class=normal><a href=#__codelineno-0-133>133</a></span>
<span class=normal><a href=#__codelineno-0-134>134</a></span>
<span class=normal><a href=#__codelineno-0-135>135</a></span>
<span class=normal><a href=#__codelineno-0-136>136</a></span>
<span class=normal><a href=#__codelineno-0-137>137</a></span>
<span class=normal><a href=#__codelineno-0-138>138</a></span>
<span class=normal><a href=#__codelineno-0-139>139</a></span>
<span class=normal><a href=#__codelineno-0-140>140</a></span>
<span class=normal><a href=#__codelineno-0-141>141</a></span>
<span class=normal><a href=#__codelineno-0-142>142</a></span>
<span class=normal><a href=#__codelineno-0-143>143</a></span>
<span class=normal><a href=#__codelineno-0-144>144</a></span>
<span class=normal><a href=#__codelineno-0-145>145</a></span>
<span class=normal><a href=#__codelineno-0-146>146</a></span>
<span class=normal><a href=#__codelineno-0-147>147</a></span>
<span class=normal><a href=#__codelineno-0-148>148</a></span>
<span class=normal><a href=#__codelineno-0-149>149</a></span>
<span class=normal><a href=#__codelineno-0-150>150</a></span>
<span class=normal><a href=#__codelineno-0-151>151</a></span>
<span class=normal><a href=#__codelineno-0-152>152</a></span>
<span class=normal><a href=#__codelineno-0-153>153</a></span>
<span class=normal><a href=#__codelineno-0-154>154</a></span>
<span class=normal><a href=#__codelineno-0-155>155</a></span>
<span class=normal><a href=#__codelineno-0-156>156</a></span>
<span class=normal><a href=#__codelineno-0-157>157</a></span>
<span class=normal><a href=#__codelineno-0-158>158</a></span>
<span class=normal><a href=#__codelineno-0-159>159</a></span>
<span class=normal><a href=#__codelineno-0-160>160</a></span>
<span class=normal><a href=#__codelineno-0-161>161</a></span>
<span class=normal><a href=#__codelineno-0-162>162</a></span>
<span class=normal><a href=#__codelineno-0-163>163</a></span>
<span class=normal><a href=#__codelineno-0-164>164</a></span>
<span class=normal><a href=#__codelineno-0-165>165</a></span>
<span class=normal><a href=#__codelineno-0-166>166</a></span>
<span class=normal><a href=#__codelineno-0-167>167</a></span>
<span class=normal><a href=#__codelineno-0-168>168</a></span>
<span class=normal><a href=#__codelineno-0-169>169</a></span>
<span class=normal><a href=#__codelineno-0-170>170</a></span>
<span class=normal><a href=#__codelineno-0-171>171</a></span>
<span class=normal><a href=#__codelineno-0-172>172</a></span>
<span class=normal><a href=#__codelineno-0-173>173</a></span>
<span class=normal><a href=#__codelineno-0-174>174</a></span>
<span class=normal><a href=#__codelineno-0-175>175</a></span>
<span class=normal><a href=#__codelineno-0-176>176</a></span>
<span class=normal><a href=#__codelineno-0-177>177</a></span>
<span class=normal><a href=#__codelineno-0-178>178</a></span>
<span class=normal><a href=#__codelineno-0-179>179</a></span>
<span class=normal><a href=#__codelineno-0-180>180</a></span>
<span class=normal><a href=#__codelineno-0-181>181</a></span>
<span class=normal><a href=#__codelineno-0-182>182</a></span>
<span class=normal><a href=#__codelineno-0-183>183</a></span>
<span class=normal><a href=#__codelineno-0-184>184</a></span>
<span class=normal><a href=#__codelineno-0-185>185</a></span>
<span class=normal><a href=#__codelineno-0-186>186</a></span>
<span class=normal><a href=#__codelineno-0-187>187</a></span>
<span class=normal><a href=#__codelineno-0-188>188</a></span>
<span class=normal><a href=#__codelineno-0-189>189</a></span>
<span class=normal><a href=#__codelineno-0-190>190</a></span>
<span class=normal><a href=#__codelineno-0-191>191</a></span>
<span class=normal><a href=#__codelineno-0-192>192</a></span>
<span class=normal><a href=#__codelineno-0-193>193</a></span>
<span class=normal><a href=#__codelineno-0-194>194</a></span>
<span class=normal><a href=#__codelineno-0-195>195</a></span>
<span class=normal><a href=#__codelineno-0-196>196</a></span>
<span class=normal><a href=#__codelineno-0-197>197</a></span>
<span class=normal><a href=#__codelineno-0-198>198</a></span>
<span class=normal><a href=#__codelineno-0-199>199</a></span>
<span class=normal><a href=#__codelineno-0-200>200</a></span>
<span class=normal><a href=#__codelineno-0-201>201</a></span>
<span class=normal><a href=#__codelineno-0-202>202</a></span>
<span class=normal><a href=#__codelineno-0-203>203</a></span>
<span class=normal><a href=#__codelineno-0-204>204</a></span>
<span class=normal><a href=#__codelineno-0-205>205</a></span>
<span class=normal><a href=#__codelineno-0-206>206</a></span>
<span class=normal><a href=#__codelineno-0-207>207</a></span>
<span class=normal><a href=#__codelineno-0-208>208</a></span>
<span class=normal><a href=#__codelineno-0-209>209</a></span>
<span class=normal><a href=#__codelineno-0-210>210</a></span>
<span class=normal><a href=#__codelineno-0-211>211</a></span>
<span class=normal><a href=#__codelineno-0-212>212</a></span>
<span class=normal><a href=#__codelineno-0-213>213</a></span>
<span class=normal><a href=#__codelineno-0-214>214</a></span>
<span class=normal><a href=#__codelineno-0-215>215</a></span>
<span class=normal><a href=#__codelineno-0-216>216</a></span>
<span class=normal><a href=#__codelineno-0-217>217</a></span>
<span class=normal><a href=#__codelineno-0-218>218</a></span>
<span class=normal><a href=#__codelineno-0-219>219</a></span>
<span class=normal><a href=#__codelineno-0-220>220</a></span>
<span class=normal><a href=#__codelineno-0-221>221</a></span>
<span class=normal><a href=#__codelineno-0-222>222</a></span>
<span class=normal><a href=#__codelineno-0-223>223</a></span>
<span class=normal><a href=#__codelineno-0-224>224</a></span>
<span class=normal><a href=#__codelineno-0-225>225</a></span>
<span class=normal><a href=#__codelineno-0-226>226</a></span>
<span class=normal><a href=#__codelineno-0-227>227</a></span>
<span class=normal><a href=#__codelineno-0-228>228</a></span>
<span class=normal><a href=#__codelineno-0-229>229</a></span>
<span class=normal><a href=#__codelineno-0-230>230</a></span>
<span class=normal><a href=#__codelineno-0-231>231</a></span>
<span class=normal><a href=#__codelineno-0-232>232</a></span>
<span class=normal><a href=#__codelineno-0-233>233</a></span>
<span class=normal><a href=#__codelineno-0-234>234</a></span>
<span class=normal><a href=#__codelineno-0-235>235</a></span>
<span class=normal><a href=#__codelineno-0-236>236</a></span>
<span class=normal><a href=#__codelineno-0-237>237</a></span>
<span class=normal><a href=#__codelineno-0-238>238</a></span>
<span class=normal><a href=#__codelineno-0-239>239</a></span>
<span class=normal><a href=#__codelineno-0-240>240</a></span>
<span class=normal><a href=#__codelineno-0-241>241</a></span>
<span class=normal><a href=#__codelineno-0-242>242</a></span>
<span class=normal><a href=#__codelineno-0-243>243</a></span>
<span class=normal><a href=#__codelineno-0-244>244</a></span>
<span class=normal><a href=#__codelineno-0-245>245</a></span>
<span class=normal><a href=#__codelineno-0-246>246</a></span>
<span class=normal><a href=#__codelineno-0-247>247</a></span>
<span class=normal><a href=#__codelineno-0-248>248</a></span>
<span class=normal><a href=#__codelineno-0-249>249</a></span>
<span class=normal><a href=#__codelineno-0-250>250</a></span>
<span class=normal><a href=#__codelineno-0-251>251</a></span>
<span class=normal><a href=#__codelineno-0-252>252</a></span>
<span class=normal><a href=#__codelineno-0-253>253</a></span>
<span class=normal><a href=#__codelineno-0-254>254</a></span>
<span class=normal><a href=#__codelineno-0-255>255</a></span>
<span class=normal><a href=#__codelineno-0-256>256</a></span>
<span class=normal><a href=#__codelineno-0-257>257</a></span>
<span class=normal><a href=#__codelineno-0-258>258</a></span>
<span class=normal><a href=#__codelineno-0-259>259</a></span>
<span class=normal><a href=#__codelineno-0-260>260</a></span>
<span class=normal><a href=#__codelineno-0-261>261</a></span>
<span class=normal><a href=#__codelineno-0-262>262</a></span>
<span class=normal><a href=#__codelineno-0-263>263</a></span>
<span class=normal><a href=#__codelineno-0-264>264</a></span>
<span class=normal><a href=#__codelineno-0-265>265</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-55><a id=__codelineno-0-55 name=__codelineno-0-55></a><span class=k>class</span><span class=w> </span><span class=nc>RegistryCli</span><span class=p>:</span>
</span><span id=__span-0-56><a id=__codelineno-0-56 name=__codelineno-0-56></a>    <span class=k>def</span><span class=w> </span><span class=nf>info</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>entry</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-57><a id=__codelineno-0-57 name=__codelineno-0-57></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Show information about an item.&quot;&quot;&quot;</span>
</span><span id=__span-0-58><a id=__codelineno-0-58 name=__codelineno-0-58></a>        <span class=n>entry_location</span> <span class=o>=</span> <span class=n>parse_location</span><span class=p>(</span><span class=n>entry</span><span class=p>)</span>
</span><span id=__span-0-59><a id=__codelineno-0-59 name=__codelineno-0-59></a>        <span class=n>metadata</span> <span class=o>=</span> <span class=n>registry</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=n>entry_location</span><span class=p>)</span>
</span><span id=__span-0-60><a id=__codelineno-0-60 name=__codelineno-0-60></a>
</span><span id=__span-0-61><a id=__codelineno-0-61 name=__codelineno-0-61></a>        <span class=k>if</span> <span class=n>metadata</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-62><a id=__codelineno-0-62 name=__codelineno-0-62></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Entry </span><span class=si>{</span><span class=n>entry</span><span class=si>}</span><span class=s2> not found.&quot;</span><span class=p>)</span>
</span><span id=__span-0-63><a id=__codelineno-0-63 name=__codelineno-0-63></a>            <span class=k>return</span>
</span><span id=__span-0-64><a id=__codelineno-0-64 name=__codelineno-0-64></a>
</span><span id=__span-0-65><a id=__codelineno-0-65 name=__codelineno-0-65></a>        <span class=nb>print</span><span class=p>(</span><span class=n>metadata</span><span class=o>.</span><span class=n>model_dump_json</span><span class=p>(</span><span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>))</span>
</span><span id=__span-0-66><a id=__codelineno-0-66 name=__codelineno-0-66></a>        <span class=k>if</span> <span class=n>metadata</span><span class=o>.</span><span class=n>category</span> <span class=o>==</span> <span class=s2>&quot;model&quot;</span><span class=p>:</span>
</span><span id=__span-0-67><a id=__codelineno-0-67 name=__codelineno-0-67></a>            <span class=n>available_provider_matches</span> <span class=o>=</span> <span class=n>ProviderModels</span><span class=p>(</span><span class=n>CONFIG</span><span class=o>.</span><span class=n>get_client_config</span><span class=p>())</span><span class=o>.</span><span class=n>available_provider_matches</span><span class=p>(</span>
</span><span id=__span-0-68><a id=__codelineno-0-68 name=__codelineno-0-68></a>                <span class=n>NamespacedName</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=n>metadata</span><span class=o>.</span><span class=n>name</span><span class=p>,</span> <span class=n>namespace</span><span class=o>=</span><span class=n>entry_location</span><span class=o>.</span><span class=n>namespace</span><span class=p>)</span>
</span><span id=__span-0-69><a id=__codelineno-0-69 name=__codelineno-0-69></a>            <span class=p>)</span>
</span><span id=__span-0-70><a id=__codelineno-0-70 name=__codelineno-0-70></a>            <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>available_provider_matches</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span><span id=__span-0-71><a id=__codelineno-0-71 name=__codelineno-0-71></a>                <span class=n>header</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;provider&quot;</span><span class=p>,</span> <span class=s2>&quot;name&quot;</span><span class=p>]</span>
</span><span id=__span-0-72><a id=__codelineno-0-72 name=__codelineno-0-72></a>
</span><span id=__span-0-73><a id=__codelineno-0-73 name=__codelineno-0-73></a>                <span class=n>table</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-0-74><a id=__codelineno-0-74 name=__codelineno-0-74></a>                <span class=k>for</span> <span class=n>provider</span><span class=p>,</span> <span class=n>name</span> <span class=ow>in</span> <span class=n>available_provider_matches</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span><span id=__span-0-75><a id=__codelineno-0-75 name=__codelineno-0-75></a>                    <span class=n>table</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
</span><span id=__span-0-76><a id=__codelineno-0-76 name=__codelineno-0-76></a>                        <span class=p>[</span>
</span><span id=__span-0-77><a id=__codelineno-0-77 name=__codelineno-0-77></a>                            <span class=n>fill</span><span class=p>(</span><span class=n>provider</span><span class=p>),</span>
</span><span id=__span-0-78><a id=__codelineno-0-78 name=__codelineno-0-78></a>                            <span class=n>fill</span><span class=p>(</span><span class=n>name</span><span class=p>),</span>
</span><span id=__span-0-79><a id=__codelineno-0-79 name=__codelineno-0-79></a>                        <span class=p>]</span>
</span><span id=__span-0-80><a id=__codelineno-0-80 name=__codelineno-0-80></a>                    <span class=p>)</span>
</span><span id=__span-0-81><a id=__codelineno-0-81 name=__codelineno-0-81></a>                <span class=nb>print</span><span class=p>(</span><span class=n>tabulate</span><span class=p>(</span><span class=n>table</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>header</span><span class=p>,</span> <span class=n>tablefmt</span><span class=o>=</span><span class=s2>&quot;simple_grid&quot;</span><span class=p>))</span>
</span><span id=__span-0-82><a id=__codelineno-0-82 name=__codelineno-0-82></a>
</span><span id=__span-0-83><a id=__codelineno-0-83 name=__codelineno-0-83></a>    <span class=k>def</span><span class=w> </span><span class=nf>metadata_template</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>local_path</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;.&quot;</span><span class=p>,</span> <span class=n>category</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>description</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>):</span>
</span><span id=__span-0-84><a id=__codelineno-0-84 name=__codelineno-0-84></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Create a metadata template.&quot;&quot;&quot;</span>
</span><span id=__span-0-85><a id=__codelineno-0-85 name=__codelineno-0-85></a>        <span class=n>path</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=n>local_path</span><span class=p>)</span>
</span><span id=__span-0-86><a id=__codelineno-0-86 name=__codelineno-0-86></a>
</span><span id=__span-0-87><a id=__codelineno-0-87 name=__codelineno-0-87></a>        <span class=n>metadata_path</span> <span class=o>=</span> <span class=n>path</span> <span class=o>/</span> <span class=s2>&quot;metadata.json&quot;</span>
</span><span id=__span-0-88><a id=__codelineno-0-88 name=__codelineno-0-88></a>
</span><span id=__span-0-89><a id=__codelineno-0-89 name=__codelineno-0-89></a>        <span class=n>version</span> <span class=o>=</span> <span class=n>path</span><span class=o>.</span><span class=n>name</span>
</span><span id=__span-0-90><a id=__codelineno-0-90 name=__codelineno-0-90></a>        <span class=n>pattern</span> <span class=o>=</span> <span class=sa>r</span><span class=s2>&quot;^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$&quot;</span>  <span class=c1># noqa: E501</span>
</span><span id=__span-0-91><a id=__codelineno-0-91 name=__codelineno-0-91></a>        <span class=k>assert</span> <span class=n>re</span><span class=o>.</span><span class=n>match</span><span class=p>(</span><span class=n>pattern</span><span class=p>,</span> <span class=n>version</span><span class=p>),</span> <span class=sa>f</span><span class=s2>&quot;Invalid semantic version format: </span><span class=si>{</span><span class=n>version</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-92><a id=__codelineno-0-92 name=__codelineno-0-92></a>        <span class=n>name</span> <span class=o>=</span> <span class=n>path</span><span class=o>.</span><span class=n>parent</span><span class=o>.</span><span class=n>name</span>
</span><span id=__span-0-93><a id=__codelineno-0-93 name=__codelineno-0-93></a>        <span class=k>assert</span> <span class=ow>not</span> <span class=n>re</span><span class=o>.</span><span class=n>match</span><span class=p>(</span><span class=n>pattern</span><span class=p>,</span> <span class=n>name</span><span class=p>),</span> <span class=sa>f</span><span class=s2>&quot;Invalid agent name: </span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-94><a id=__codelineno-0-94 name=__codelineno-0-94></a>
</span><span id=__span-0-95><a id=__codelineno-0-95 name=__codelineno-0-95></a>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>metadata_path</span><span class=p>,</span> <span class=s2>&quot;w&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-96><a id=__codelineno-0-96 name=__codelineno-0-96></a>            <span class=n>metadata</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-97><a id=__codelineno-0-97 name=__codelineno-0-97></a>                <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=n>name</span><span class=p>,</span>
</span><span id=__span-0-98><a id=__codelineno-0-98 name=__codelineno-0-98></a>                <span class=s2>&quot;version&quot;</span><span class=p>:</span> <span class=n>version</span><span class=p>,</span>
</span><span id=__span-0-99><a id=__codelineno-0-99 name=__codelineno-0-99></a>                <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=n>description</span><span class=p>,</span>
</span><span id=__span-0-100><a id=__codelineno-0-100 name=__codelineno-0-100></a>                <span class=s2>&quot;category&quot;</span><span class=p>:</span> <span class=n>category</span><span class=p>,</span>
</span><span id=__span-0-101><a id=__codelineno-0-101 name=__codelineno-0-101></a>                <span class=s2>&quot;tags&quot;</span><span class=p>:</span> <span class=p>[],</span>
</span><span id=__span-0-102><a id=__codelineno-0-102 name=__codelineno-0-102></a>                <span class=s2>&quot;details&quot;</span><span class=p>:</span> <span class=p>{},</span>
</span><span id=__span-0-103><a id=__codelineno-0-103 name=__codelineno-0-103></a>                <span class=s2>&quot;show_entry&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-104><a id=__codelineno-0-104 name=__codelineno-0-104></a>            <span class=p>}</span>
</span><span id=__span-0-105><a id=__codelineno-0-105 name=__codelineno-0-105></a>
</span><span id=__span-0-106><a id=__codelineno-0-106 name=__codelineno-0-106></a>            <span class=k>if</span> <span class=n>category</span> <span class=o>==</span> <span class=s2>&quot;agent&quot;</span><span class=p>:</span>
</span><span id=__span-0-107><a id=__codelineno-0-107 name=__codelineno-0-107></a>                <span class=n>metadata</span><span class=p>[</span><span class=s2>&quot;details&quot;</span><span class=p>][</span><span class=s2>&quot;agent&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-0-108><a id=__codelineno-0-108 name=__codelineno-0-108></a>                <span class=n>metadata</span><span class=p>[</span><span class=s2>&quot;details&quot;</span><span class=p>][</span><span class=s2>&quot;agent&quot;</span><span class=p>][</span><span class=s2>&quot;welcome&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-109><a id=__codelineno-0-109 name=__codelineno-0-109></a>                    <span class=s2>&quot;title&quot;</span><span class=p>:</span> <span class=n>name</span><span class=p>,</span>
</span><span id=__span-0-110><a id=__codelineno-0-110 name=__codelineno-0-110></a>                    <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=n>description</span><span class=p>,</span>
</span><span id=__span-0-111><a id=__codelineno-0-111 name=__codelineno-0-111></a>                <span class=p>}</span>
</span><span id=__span-0-112><a id=__codelineno-0-112 name=__codelineno-0-112></a>                <span class=n>metadata</span><span class=p>[</span><span class=s2>&quot;details&quot;</span><span class=p>][</span><span class=s2>&quot;agent&quot;</span><span class=p>][</span><span class=s2>&quot;defaults&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-113><a id=__codelineno-0-113 name=__codelineno-0-113></a>                    <span class=s2>&quot;model&quot;</span><span class=p>:</span> <span class=n>DEFAULT_MODEL</span><span class=p>,</span>
</span><span id=__span-0-114><a id=__codelineno-0-114 name=__codelineno-0-114></a>                    <span class=s2>&quot;model_provider&quot;</span><span class=p>:</span> <span class=n>DEFAULT_PROVIDER</span><span class=p>,</span>
</span><span id=__span-0-115><a id=__codelineno-0-115 name=__codelineno-0-115></a>                    <span class=s2>&quot;model_temperature&quot;</span><span class=p>:</span> <span class=n>DEFAULT_MODEL_TEMPERATURE</span><span class=p>,</span>
</span><span id=__span-0-116><a id=__codelineno-0-116 name=__codelineno-0-116></a>                    <span class=s2>&quot;model_max_tokens&quot;</span><span class=p>:</span> <span class=n>DEFAULT_MODEL_MAX_TOKENS</span><span class=p>,</span>
</span><span id=__span-0-117><a id=__codelineno-0-117 name=__codelineno-0-117></a>                    <span class=s2>&quot;max_iterations&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span><span id=__span-0-118><a id=__codelineno-0-118 name=__codelineno-0-118></a>                <span class=p>}</span>
</span><span id=__span-0-119><a id=__codelineno-0-119 name=__codelineno-0-119></a>                <span class=n>metadata</span><span class=p>[</span><span class=s2>&quot;details&quot;</span><span class=p>][</span><span class=s2>&quot;agent&quot;</span><span class=p>][</span><span class=s2>&quot;framework&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;base&quot;</span>
</span><span id=__span-0-120><a id=__codelineno-0-120 name=__codelineno-0-120></a>
</span><span id=__span-0-121><a id=__codelineno-0-121 name=__codelineno-0-121></a>            <span class=n>json</span><span class=o>.</span><span class=n>dump</span><span class=p>(</span><span class=n>metadata</span><span class=p>,</span> <span class=n>f</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</span><span id=__span-0-122><a id=__codelineno-0-122 name=__codelineno-0-122></a>
</span><span id=__span-0-123><a id=__codelineno-0-123 name=__codelineno-0-123></a>    <span class=k>def</span><span class=w> </span><span class=nf>list</span><span class=p>(</span>
</span><span id=__span-0-124><a id=__codelineno-0-124 name=__codelineno-0-124></a>        <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-125><a id=__codelineno-0-125 name=__codelineno-0-125></a>        <span class=n>namespace</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-126><a id=__codelineno-0-126 name=__codelineno-0-126></a>        <span class=n>category</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-127><a id=__codelineno-0-127 name=__codelineno-0-127></a>        <span class=n>tags</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-128><a id=__codelineno-0-128 name=__codelineno-0-128></a>        <span class=n>total</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>32</span><span class=p>,</span>
</span><span id=__span-0-129><a id=__codelineno-0-129 name=__codelineno-0-129></a>        <span class=n>offset</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span>
</span><span id=__span-0-130><a id=__codelineno-0-130 name=__codelineno-0-130></a>        <span class=n>show_all</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-131><a id=__codelineno-0-131 name=__codelineno-0-131></a>        <span class=n>show_latest_version</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-132><a id=__codelineno-0-132 name=__codelineno-0-132></a>        <span class=n>star</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-133><a id=__codelineno-0-133 name=__codelineno-0-133></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-134><a id=__codelineno-0-134 name=__codelineno-0-134></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;List available items.&quot;&quot;&quot;</span>
</span><span id=__span-0-135><a id=__codelineno-0-135 name=__codelineno-0-135></a>        <span class=c1># Make sure tags is a comma-separated list of tags</span>
</span><span id=__span-0-136><a id=__codelineno-0-136 name=__codelineno-0-136></a>        <span class=n>tags_l</span> <span class=o>=</span> <span class=n>parse_tags</span><span class=p>(</span><span class=n>tags</span><span class=p>)</span>
</span><span id=__span-0-137><a id=__codelineno-0-137 name=__codelineno-0-137></a>        <span class=n>tags</span> <span class=o>=</span> <span class=s2>&quot;,&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>tags_l</span><span class=p>)</span>
</span><span id=__span-0-138><a id=__codelineno-0-138 name=__codelineno-0-138></a>
</span><span id=__span-0-139><a id=__codelineno-0-139 name=__codelineno-0-139></a>        <span class=n>entries</span> <span class=o>=</span> <span class=n>registry</span><span class=o>.</span><span class=n>list</span><span class=p>(</span>
</span><span id=__span-0-140><a id=__codelineno-0-140 name=__codelineno-0-140></a>            <span class=n>namespace</span><span class=o>=</span><span class=n>namespace</span><span class=p>,</span>
</span><span id=__span-0-141><a id=__codelineno-0-141 name=__codelineno-0-141></a>            <span class=n>category</span><span class=o>=</span><span class=n>category</span><span class=p>,</span>
</span><span id=__span-0-142><a id=__codelineno-0-142 name=__codelineno-0-142></a>            <span class=n>tags</span><span class=o>=</span><span class=n>tags</span><span class=p>,</span>
</span><span id=__span-0-143><a id=__codelineno-0-143 name=__codelineno-0-143></a>            <span class=n>total</span><span class=o>=</span><span class=n>total</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span>
</span><span id=__span-0-144><a id=__codelineno-0-144 name=__codelineno-0-144></a>            <span class=n>offset</span><span class=o>=</span><span class=n>offset</span><span class=p>,</span>
</span><span id=__span-0-145><a id=__codelineno-0-145 name=__codelineno-0-145></a>            <span class=n>show_all</span><span class=o>=</span><span class=n>show_all</span><span class=p>,</span>
</span><span id=__span-0-146><a id=__codelineno-0-146 name=__codelineno-0-146></a>            <span class=n>show_latest_version</span><span class=o>=</span><span class=n>show_latest_version</span><span class=p>,</span>
</span><span id=__span-0-147><a id=__codelineno-0-147 name=__codelineno-0-147></a>            <span class=n>starred_by</span><span class=o>=</span><span class=n>star</span><span class=p>,</span>
</span><span id=__span-0-148><a id=__codelineno-0-148 name=__codelineno-0-148></a>        <span class=p>)</span>
</span><span id=__span-0-149><a id=__codelineno-0-149 name=__codelineno-0-149></a>
</span><span id=__span-0-150><a id=__codelineno-0-150 name=__codelineno-0-150></a>        <span class=n>more_rows</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>entries</span><span class=p>)</span> <span class=o>&gt;</span> <span class=n>total</span>
</span><span id=__span-0-151><a id=__codelineno-0-151 name=__codelineno-0-151></a>        <span class=n>entries</span> <span class=o>=</span> <span class=n>entries</span><span class=p>[:</span><span class=n>total</span><span class=p>]</span>
</span><span id=__span-0-152><a id=__codelineno-0-152 name=__codelineno-0-152></a>
</span><span id=__span-0-153><a id=__codelineno-0-153 name=__codelineno-0-153></a>        <span class=n>header</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;entry&quot;</span><span class=p>,</span> <span class=s2>&quot;category&quot;</span><span class=p>,</span> <span class=s2>&quot;description&quot;</span><span class=p>,</span> <span class=s2>&quot;tags&quot;</span><span class=p>]</span>
</span><span id=__span-0-154><a id=__codelineno-0-154 name=__codelineno-0-154></a>
</span><span id=__span-0-155><a id=__codelineno-0-155 name=__codelineno-0-155></a>        <span class=n>table</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-0-156><a id=__codelineno-0-156 name=__codelineno-0-156></a>        <span class=k>for</span> <span class=n>entry</span> <span class=ow>in</span> <span class=n>entries</span><span class=p>:</span>
</span><span id=__span-0-157><a id=__codelineno-0-157 name=__codelineno-0-157></a>            <span class=n>table</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
</span><span id=__span-0-158><a id=__codelineno-0-158 name=__codelineno-0-158></a>                <span class=p>[</span>
</span><span id=__span-0-159><a id=__codelineno-0-159 name=__codelineno-0-159></a>                    <span class=n>fill</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>entry</span><span class=o>.</span><span class=n>namespace</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>entry</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>entry</span><span class=o>.</span><span class=n>version</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>),</span>
</span><span id=__span-0-160><a id=__codelineno-0-160 name=__codelineno-0-160></a>                    <span class=n>fill</span><span class=p>(</span><span class=n>entry</span><span class=o>.</span><span class=n>category</span><span class=p>,</span> <span class=mi>20</span><span class=p>),</span>
</span><span id=__span-0-161><a id=__codelineno-0-161 name=__codelineno-0-161></a>                    <span class=n>fill</span><span class=p>(</span><span class=n>entry</span><span class=o>.</span><span class=n>description</span><span class=p>,</span> <span class=mi>50</span><span class=p>),</span>
</span><span id=__span-0-162><a id=__codelineno-0-162 name=__codelineno-0-162></a>                    <span class=n>fill</span><span class=p>(</span><span class=s2>&quot;, &quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>entry</span><span class=o>.</span><span class=n>tags</span><span class=p>),</span> <span class=mi>20</span><span class=p>),</span>
</span><span id=__span-0-163><a id=__codelineno-0-163 name=__codelineno-0-163></a>                <span class=p>]</span>
</span><span id=__span-0-164><a id=__codelineno-0-164 name=__codelineno-0-164></a>            <span class=p>)</span>
</span><span id=__span-0-165><a id=__codelineno-0-165 name=__codelineno-0-165></a>
</span><span id=__span-0-166><a id=__codelineno-0-166 name=__codelineno-0-166></a>        <span class=k>if</span> <span class=n>more_rows</span><span class=p>:</span>
</span><span id=__span-0-167><a id=__codelineno-0-167 name=__codelineno-0-167></a>            <span class=n>table</span><span class=o>.</span><span class=n>append</span><span class=p>([</span><span class=s2>&quot;...&quot;</span><span class=p>,</span> <span class=s2>&quot;...&quot;</span><span class=p>,</span> <span class=s2>&quot;...&quot;</span><span class=p>,</span> <span class=s2>&quot;...&quot;</span><span class=p>])</span>
</span><span id=__span-0-168><a id=__codelineno-0-168 name=__codelineno-0-168></a>
</span><span id=__span-0-169><a id=__codelineno-0-169 name=__codelineno-0-169></a>        <span class=nb>print</span><span class=p>(</span><span class=n>tabulate</span><span class=p>(</span><span class=n>table</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>header</span><span class=p>,</span> <span class=n>tablefmt</span><span class=o>=</span><span class=s2>&quot;simple_grid&quot;</span><span class=p>))</span>
</span><span id=__span-0-170><a id=__codelineno-0-170 name=__codelineno-0-170></a>
</span><span id=__span-0-171><a id=__codelineno-0-171 name=__codelineno-0-171></a>        <span class=k>if</span> <span class=n>category</span> <span class=o>==</span> <span class=s2>&quot;model&quot;</span> <span class=ow>and</span> <span class=nb>len</span><span class=p>(</span><span class=n>entries</span><span class=p>)</span> <span class=o>&lt;</span> <span class=n>total</span> <span class=ow>and</span> <span class=n>namespace</span> <span class=o>==</span> <span class=s2>&quot;&quot;</span> <span class=ow>and</span> <span class=n>tags</span> <span class=o>==</span> <span class=s2>&quot;&quot;</span> <span class=ow>and</span> <span class=n>star</span> <span class=o>==</span> <span class=s2>&quot;&quot;</span><span class=p>:</span>
</span><span id=__span-0-172><a id=__codelineno-0-172 name=__codelineno-0-172></a>            <span class=n>unregistered_common_provider_models</span> <span class=o>=</span> <span class=n>ProviderModels</span><span class=p>(</span>
</span><span id=__span-0-173><a id=__codelineno-0-173 name=__codelineno-0-173></a>                <span class=n>CONFIG</span><span class=o>.</span><span class=n>get_client_config</span><span class=p>()</span>
</span><span id=__span-0-174><a id=__codelineno-0-174 name=__codelineno-0-174></a>            <span class=p>)</span><span class=o>.</span><span class=n>get_unregistered_common_provider_models</span><span class=p>(</span><span class=n>registry</span><span class=o>.</span><span class=n>dict_models</span><span class=p>())</span>
</span><span id=__span-0-175><a id=__codelineno-0-175 name=__codelineno-0-175></a>            <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>unregistered_common_provider_models</span><span class=p>):</span>
</span><span id=__span-0-176><a id=__codelineno-0-176 name=__codelineno-0-176></a>                <span class=nb>print</span><span class=p>(</span>
</span><span id=__span-0-177><a id=__codelineno-0-177 name=__codelineno-0-177></a>                    <span class=sa>f</span><span class=s2>&quot;There are unregistered common provider models: </span><span class=si>{</span><span class=n>unregistered_common_provider_models</span><span class=si>}</span><span class=s2>. Run &#39;nearai registry upload-unregistered-common-provider-models&#39; to update registry.&quot;</span>  <span class=c1># noqa: E501</span>
</span><span id=__span-0-178><a id=__codelineno-0-178 name=__codelineno-0-178></a>                <span class=p>)</span>
</span><span id=__span-0-179><a id=__codelineno-0-179 name=__codelineno-0-179></a>
</span><span id=__span-0-180><a id=__codelineno-0-180 name=__codelineno-0-180></a>    <span class=k>def</span><span class=w> </span><span class=nf>update</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>local_path</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;.&quot;</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-181><a id=__codelineno-0-181 name=__codelineno-0-181></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Update metadata of a registry item.&quot;&quot;&quot;</span>
</span><span id=__span-0-182><a id=__codelineno-0-182 name=__codelineno-0-182></a>        <span class=n>path</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=n>local_path</span><span class=p>)</span>
</span><span id=__span-0-183><a id=__codelineno-0-183 name=__codelineno-0-183></a>
</span><span id=__span-0-184><a id=__codelineno-0-184 name=__codelineno-0-184></a>        <span class=k>if</span> <span class=n>CONFIG</span><span class=o>.</span><span class=n>auth</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-185><a id=__codelineno-0-185 name=__codelineno-0-185></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Please login with `nearai login`&quot;</span><span class=p>)</span>
</span><span id=__span-0-186><a id=__codelineno-0-186 name=__codelineno-0-186></a>            <span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span><span id=__span-0-187><a id=__codelineno-0-187 name=__codelineno-0-187></a>
</span><span id=__span-0-188><a id=__codelineno-0-188 name=__codelineno-0-188></a>        <span class=n>metadata_path</span> <span class=o>=</span> <span class=n>path</span> <span class=o>/</span> <span class=s2>&quot;metadata.json&quot;</span>
</span><span id=__span-0-189><a id=__codelineno-0-189 name=__codelineno-0-189></a>        <span class=n>check_metadata</span><span class=p>(</span><span class=n>metadata_path</span><span class=p>)</span>
</span><span id=__span-0-190><a id=__codelineno-0-190 name=__codelineno-0-190></a>
</span><span id=__span-0-191><a id=__codelineno-0-191 name=__codelineno-0-191></a>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>metadata_path</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-192><a id=__codelineno-0-192 name=__codelineno-0-192></a>            <span class=n>metadata</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>f</span><span class=p>)</span>
</span><span id=__span-0-193><a id=__codelineno-0-193 name=__codelineno-0-193></a>
</span><span id=__span-0-194><a id=__codelineno-0-194 name=__codelineno-0-194></a>        <span class=n>namespace</span> <span class=o>=</span> <span class=n>CONFIG</span><span class=o>.</span><span class=n>auth</span><span class=o>.</span><span class=n>namespace</span>
</span><span id=__span-0-195><a id=__codelineno-0-195 name=__codelineno-0-195></a>
</span><span id=__span-0-196><a id=__codelineno-0-196 name=__codelineno-0-196></a>        <span class=n>entry_location</span> <span class=o>=</span> <span class=n>EntryLocation</span><span class=o>.</span><span class=n>model_validate</span><span class=p>(</span>
</span><span id=__span-0-197><a id=__codelineno-0-197 name=__codelineno-0-197></a>            <span class=nb>dict</span><span class=p>(</span>
</span><span id=__span-0-198><a id=__codelineno-0-198 name=__codelineno-0-198></a>                <span class=n>namespace</span><span class=o>=</span><span class=n>namespace</span><span class=p>,</span>
</span><span id=__span-0-199><a id=__codelineno-0-199 name=__codelineno-0-199></a>                <span class=n>name</span><span class=o>=</span><span class=n>metadata</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;name&quot;</span><span class=p>),</span>
</span><span id=__span-0-200><a id=__codelineno-0-200 name=__codelineno-0-200></a>                <span class=n>version</span><span class=o>=</span><span class=n>metadata</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;version&quot;</span><span class=p>),</span>
</span><span id=__span-0-201><a id=__codelineno-0-201 name=__codelineno-0-201></a>            <span class=p>)</span>
</span><span id=__span-0-202><a id=__codelineno-0-202 name=__codelineno-0-202></a>        <span class=p>)</span>
</span><span id=__span-0-203><a id=__codelineno-0-203 name=__codelineno-0-203></a>
</span><span id=__span-0-204><a id=__codelineno-0-204 name=__codelineno-0-204></a>        <span class=n>entry_metadata</span> <span class=o>=</span> <span class=n>EntryMetadataInput</span><span class=o>.</span><span class=n>model_validate</span><span class=p>(</span><span class=n>metadata</span><span class=p>)</span>
</span><span id=__span-0-205><a id=__codelineno-0-205 name=__codelineno-0-205></a>        <span class=n>result</span> <span class=o>=</span> <span class=n>registry</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>entry_location</span><span class=p>,</span> <span class=n>entry_metadata</span><span class=p>)</span>
</span><span id=__span-0-206><a id=__codelineno-0-206 name=__codelineno-0-206></a>        <span class=nb>print</span><span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>result</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>))</span>
</span><span id=__span-0-207><a id=__codelineno-0-207 name=__codelineno-0-207></a>
</span><span id=__span-0-208><a id=__codelineno-0-208 name=__codelineno-0-208></a>    <span class=k>def</span><span class=w> </span><span class=nf>upload_unregistered_common_provider_models</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>dry_run</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-209><a id=__codelineno-0-209 name=__codelineno-0-209></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Creates new registry items for unregistered common provider models.&quot;&quot;&quot;</span>
</span><span id=__span-0-210><a id=__codelineno-0-210 name=__codelineno-0-210></a>        <span class=n>provider_matches_list</span> <span class=o>=</span> <span class=n>ProviderModels</span><span class=p>(</span><span class=n>CONFIG</span><span class=o>.</span><span class=n>get_client_config</span><span class=p>())</span><span class=o>.</span><span class=n>get_unregistered_common_provider_models</span><span class=p>(</span>
</span><span id=__span-0-211><a id=__codelineno-0-211 name=__codelineno-0-211></a>            <span class=n>registry</span><span class=o>.</span><span class=n>dict_models</span><span class=p>()</span>
</span><span id=__span-0-212><a id=__codelineno-0-212 name=__codelineno-0-212></a>        <span class=p>)</span>
</span><span id=__span-0-213><a id=__codelineno-0-213 name=__codelineno-0-213></a>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>provider_matches_list</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span><span id=__span-0-214><a id=__codelineno-0-214 name=__codelineno-0-214></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;No new models to upload.&quot;</span><span class=p>)</span>
</span><span id=__span-0-215><a id=__codelineno-0-215 name=__codelineno-0-215></a>            <span class=k>return</span>
</span><span id=__span-0-216><a id=__codelineno-0-216 name=__codelineno-0-216></a>
</span><span id=__span-0-217><a id=__codelineno-0-217 name=__codelineno-0-217></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Going to create new registry items:&quot;</span><span class=p>)</span>
</span><span id=__span-0-218><a id=__codelineno-0-218 name=__codelineno-0-218></a>        <span class=n>header</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;entry&quot;</span><span class=p>,</span> <span class=s2>&quot;description&quot;</span><span class=p>]</span>
</span><span id=__span-0-219><a id=__codelineno-0-219 name=__codelineno-0-219></a>        <span class=n>table</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-0-220><a id=__codelineno-0-220 name=__codelineno-0-220></a>        <span class=n>paths</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-0-221><a id=__codelineno-0-221 name=__codelineno-0-221></a>        <span class=k>for</span> <span class=n>provider_matches</span> <span class=ow>in</span> <span class=n>provider_matches_list</span><span class=p>:</span>
</span><span id=__span-0-222><a id=__codelineno-0-222 name=__codelineno-0-222></a>            <span class=n>provider_model</span> <span class=o>=</span> <span class=n>provider_matches</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>DEFAULT_PROVIDER</span><span class=p>)</span> <span class=ow>or</span> <span class=nb>next</span><span class=p>(</span><span class=nb>iter</span><span class=p>(</span><span class=n>provider_matches</span><span class=o>.</span><span class=n>values</span><span class=p>()))</span>
</span><span id=__span-0-223><a id=__codelineno-0-223 name=__codelineno-0-223></a>            <span class=n>_</span><span class=p>,</span> <span class=n>model</span> <span class=o>=</span> <span class=n>get_provider_namespaced_model</span><span class=p>(</span><span class=n>provider_model</span><span class=p>)</span>
</span><span id=__span-0-224><a id=__codelineno-0-224 name=__codelineno-0-224></a>            <span class=k>assert</span> <span class=n>model</span><span class=o>.</span><span class=n>namespace</span> <span class=o>==</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-225><a id=__codelineno-0-225 name=__codelineno-0-225></a>            <span class=n>model</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=n>create_registry_name</span><span class=p>(</span><span class=n>model</span><span class=o>.</span><span class=n>name</span><span class=p>)</span>
</span><span id=__span-0-226><a id=__codelineno-0-226 name=__codelineno-0-226></a>            <span class=n>model</span><span class=o>.</span><span class=n>namespace</span> <span class=o>=</span> <span class=n>DEFAULT_NAMESPACE</span>
</span><span id=__span-0-227><a id=__codelineno-0-227 name=__codelineno-0-227></a>            <span class=n>version</span> <span class=o>=</span> <span class=s2>&quot;1.0.0&quot;</span>
</span><span id=__span-0-228><a id=__codelineno-0-228 name=__codelineno-0-228></a>            <span class=n>description</span> <span class=o>=</span> <span class=s2>&quot; &amp; &quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>provider_matches</span><span class=o>.</span><span class=n>values</span><span class=p>())</span>
</span><span id=__span-0-229><a id=__codelineno-0-229 name=__codelineno-0-229></a>            <span class=n>table</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
</span><span id=__span-0-230><a id=__codelineno-0-230 name=__codelineno-0-230></a>                <span class=p>[</span>
</span><span id=__span-0-231><a id=__codelineno-0-231 name=__codelineno-0-231></a>                    <span class=n>fill</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>model</span><span class=o>.</span><span class=n>namespace</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>model</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>version</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>),</span>
</span><span id=__span-0-232><a id=__codelineno-0-232 name=__codelineno-0-232></a>                    <span class=n>fill</span><span class=p>(</span><span class=n>description</span><span class=p>,</span> <span class=mi>50</span><span class=p>),</span>
</span><span id=__span-0-233><a id=__codelineno-0-233 name=__codelineno-0-233></a>                <span class=p>]</span>
</span><span id=__span-0-234><a id=__codelineno-0-234 name=__codelineno-0-234></a>            <span class=p>)</span>
</span><span id=__span-0-235><a id=__codelineno-0-235 name=__codelineno-0-235></a>
</span><span id=__span-0-236><a id=__codelineno-0-236 name=__codelineno-0-236></a>            <span class=n>path</span> <span class=o>=</span> <span class=n>get_registry_folder</span><span class=p>()</span> <span class=o>/</span> <span class=n>model</span><span class=o>.</span><span class=n>namespace</span> <span class=o>/</span> <span class=n>model</span><span class=o>.</span><span class=n>name</span> <span class=o>/</span> <span class=n>version</span>
</span><span id=__span-0-237><a id=__codelineno-0-237 name=__codelineno-0-237></a>            <span class=n>path</span><span class=o>.</span><span class=n>mkdir</span><span class=p>(</span><span class=n>parents</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-238><a id=__codelineno-0-238 name=__codelineno-0-238></a>            <span class=n>paths</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
</span><span id=__span-0-239><a id=__codelineno-0-239 name=__codelineno-0-239></a>            <span class=n>metadata_path</span> <span class=o>=</span> <span class=n>path</span> <span class=o>/</span> <span class=s2>&quot;metadata.json&quot;</span>
</span><span id=__span-0-240><a id=__codelineno-0-240 name=__codelineno-0-240></a>            <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>metadata_path</span><span class=p>,</span> <span class=s2>&quot;w&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-241><a id=__codelineno-0-241 name=__codelineno-0-241></a>                <span class=n>metadata</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-242><a id=__codelineno-0-242 name=__codelineno-0-242></a>                    <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=n>model</span><span class=o>.</span><span class=n>name</span><span class=p>,</span>
</span><span id=__span-0-243><a id=__codelineno-0-243 name=__codelineno-0-243></a>                    <span class=s2>&quot;version&quot;</span><span class=p>:</span> <span class=n>version</span><span class=p>,</span>
</span><span id=__span-0-244><a id=__codelineno-0-244 name=__codelineno-0-244></a>                    <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=n>description</span><span class=p>,</span>
</span><span id=__span-0-245><a id=__codelineno-0-245 name=__codelineno-0-245></a>                    <span class=s2>&quot;category&quot;</span><span class=p>:</span> <span class=s2>&quot;model&quot;</span><span class=p>,</span>
</span><span id=__span-0-246><a id=__codelineno-0-246 name=__codelineno-0-246></a>                    <span class=s2>&quot;tags&quot;</span><span class=p>:</span> <span class=p>[],</span>
</span><span id=__span-0-247><a id=__codelineno-0-247 name=__codelineno-0-247></a>                    <span class=s2>&quot;details&quot;</span><span class=p>:</span> <span class=p>{},</span>
</span><span id=__span-0-248><a id=__codelineno-0-248 name=__codelineno-0-248></a>                    <span class=s2>&quot;show_entry&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-249><a id=__codelineno-0-249 name=__codelineno-0-249></a>                <span class=p>}</span>
</span><span id=__span-0-250><a id=__codelineno-0-250 name=__codelineno-0-250></a>                <span class=n>json</span><span class=o>.</span><span class=n>dump</span><span class=p>(</span><span class=n>metadata</span><span class=p>,</span> <span class=n>f</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</span><span id=__span-0-251><a id=__codelineno-0-251 name=__codelineno-0-251></a>
</span><span id=__span-0-252><a id=__codelineno-0-252 name=__codelineno-0-252></a>        <span class=nb>print</span><span class=p>(</span><span class=n>tabulate</span><span class=p>(</span><span class=n>table</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>header</span><span class=p>,</span> <span class=n>tablefmt</span><span class=o>=</span><span class=s2>&quot;simple_grid&quot;</span><span class=p>))</span>
</span><span id=__span-0-253><a id=__codelineno-0-253 name=__codelineno-0-253></a>        <span class=k>if</span> <span class=n>dry_run</span><span class=p>:</span>
</span><span id=__span-0-254><a id=__codelineno-0-254 name=__codelineno-0-254></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Please verify, then repeat the command with --dry_run=False&quot;</span><span class=p>)</span>
</span><span id=__span-0-255><a id=__codelineno-0-255 name=__codelineno-0-255></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-256><a id=__codelineno-0-256 name=__codelineno-0-256></a>            <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>paths</span><span class=p>:</span>
</span><span id=__span-0-257><a id=__codelineno-0-257 name=__codelineno-0-257></a>                <span class=bp>self</span><span class=o>.</span><span class=n>upload</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>path</span><span class=p>))</span>
</span><span id=__span-0-258><a id=__codelineno-0-258 name=__codelineno-0-258></a>
</span><span id=__span-0-259><a id=__codelineno-0-259 name=__codelineno-0-259></a>    <span class=k>def</span><span class=w> </span><span class=nf>upload</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>local_path</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;.&quot;</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>EntryLocation</span><span class=p>:</span>
</span><span id=__span-0-260><a id=__codelineno-0-260 name=__codelineno-0-260></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Upload item to the registry.&quot;&quot;&quot;</span>
</span><span id=__span-0-261><a id=__codelineno-0-261 name=__codelineno-0-261></a>        <span class=k>return</span> <span class=n>registry</span><span class=o>.</span><span class=n>upload</span><span class=p>(</span><span class=n>Path</span><span class=p>(</span><span class=n>local_path</span><span class=p>),</span> <span class=n>show_progress</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-262><a id=__codelineno-0-262 name=__codelineno-0-262></a>
</span><span id=__span-0-263><a id=__codelineno-0-263 name=__codelineno-0-263></a>    <span class=k>def</span><span class=w> </span><span class=nf>download</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>entry_location</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>force</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-264><a id=__codelineno-0-264 name=__codelineno-0-264></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Download item.&quot;&quot;&quot;</span>
</span><span id=__span-0-265><a id=__codelineno-0-265 name=__codelineno-0-265></a>        <span class=n>registry</span><span class=o>.</span><span class=n>download</span><span class=p>(</span><span class=n>entry_location</span><span class=p>,</span> <span class=n>force</span><span class=o>=</span><span class=n>force</span><span class=p>,</span> <span class=n>show_progress</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h5 id=nearai.cli.RegistryCli.download class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">download</span> <a href=#nearai.cli.RegistryCli.download class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>download</span><span class=p>(</span><span class=n>entry_location</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>force</span><span class=p>:</span> <span class=n>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Download item.</p> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-263>263</a></span>
<span class=normal><a href=#__codelineno-0-264>264</a></span>
<span class=normal><a href=#__codelineno-0-265>265</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-263><a id=__codelineno-0-263 name=__codelineno-0-263></a><span class=k>def</span><span class=w> </span><span class=nf>download</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>entry_location</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>force</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-264><a id=__codelineno-0-264 name=__codelineno-0-264></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Download item.&quot;&quot;&quot;</span>
</span><span id=__span-0-265><a id=__codelineno-0-265 name=__codelineno-0-265></a>    <span class=n>registry</span><span class=o>.</span><span class=n>download</span><span class=p>(</span><span class=n>entry_location</span><span class=p>,</span> <span class=n>force</span><span class=o>=</span><span class=n>force</span><span class=p>,</span> <span class=n>show_progress</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.cli.RegistryCli.info class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">info</span> <a href=#nearai.cli.RegistryCli.info class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>info</span><span class=p>(</span><span class=n>entry</span><span class=p>:</span> <span class=n>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Show information about an item.</p> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-56>56</a></span>
<span class=normal><a href=#__codelineno-0-57>57</a></span>
<span class=normal><a href=#__codelineno-0-58>58</a></span>
<span class=normal><a href=#__codelineno-0-59>59</a></span>
<span class=normal><a href=#__codelineno-0-60>60</a></span>
<span class=normal><a href=#__codelineno-0-61>61</a></span>
<span class=normal><a href=#__codelineno-0-62>62</a></span>
<span class=normal><a href=#__codelineno-0-63>63</a></span>
<span class=normal><a href=#__codelineno-0-64>64</a></span>
<span class=normal><a href=#__codelineno-0-65>65</a></span>
<span class=normal><a href=#__codelineno-0-66>66</a></span>
<span class=normal><a href=#__codelineno-0-67>67</a></span>
<span class=normal><a href=#__codelineno-0-68>68</a></span>
<span class=normal><a href=#__codelineno-0-69>69</a></span>
<span class=normal><a href=#__codelineno-0-70>70</a></span>
<span class=normal><a href=#__codelineno-0-71>71</a></span>
<span class=normal><a href=#__codelineno-0-72>72</a></span>
<span class=normal><a href=#__codelineno-0-73>73</a></span>
<span class=normal><a href=#__codelineno-0-74>74</a></span>
<span class=normal><a href=#__codelineno-0-75>75</a></span>
<span class=normal><a href=#__codelineno-0-76>76</a></span>
<span class=normal><a href=#__codelineno-0-77>77</a></span>
<span class=normal><a href=#__codelineno-0-78>78</a></span>
<span class=normal><a href=#__codelineno-0-79>79</a></span>
<span class=normal><a href=#__codelineno-0-80>80</a></span>
<span class=normal><a href=#__codelineno-0-81>81</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-56><a id=__codelineno-0-56 name=__codelineno-0-56></a><span class=k>def</span><span class=w> </span><span class=nf>info</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>entry</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-57><a id=__codelineno-0-57 name=__codelineno-0-57></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Show information about an item.&quot;&quot;&quot;</span>
</span><span id=__span-0-58><a id=__codelineno-0-58 name=__codelineno-0-58></a>    <span class=n>entry_location</span> <span class=o>=</span> <span class=n>parse_location</span><span class=p>(</span><span class=n>entry</span><span class=p>)</span>
</span><span id=__span-0-59><a id=__codelineno-0-59 name=__codelineno-0-59></a>    <span class=n>metadata</span> <span class=o>=</span> <span class=n>registry</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=n>entry_location</span><span class=p>)</span>
</span><span id=__span-0-60><a id=__codelineno-0-60 name=__codelineno-0-60></a>
</span><span id=__span-0-61><a id=__codelineno-0-61 name=__codelineno-0-61></a>    <span class=k>if</span> <span class=n>metadata</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-62><a id=__codelineno-0-62 name=__codelineno-0-62></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Entry </span><span class=si>{</span><span class=n>entry</span><span class=si>}</span><span class=s2> not found.&quot;</span><span class=p>)</span>
</span><span id=__span-0-63><a id=__codelineno-0-63 name=__codelineno-0-63></a>        <span class=k>return</span>
</span><span id=__span-0-64><a id=__codelineno-0-64 name=__codelineno-0-64></a>
</span><span id=__span-0-65><a id=__codelineno-0-65 name=__codelineno-0-65></a>    <span class=nb>print</span><span class=p>(</span><span class=n>metadata</span><span class=o>.</span><span class=n>model_dump_json</span><span class=p>(</span><span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>))</span>
</span><span id=__span-0-66><a id=__codelineno-0-66 name=__codelineno-0-66></a>    <span class=k>if</span> <span class=n>metadata</span><span class=o>.</span><span class=n>category</span> <span class=o>==</span> <span class=s2>&quot;model&quot;</span><span class=p>:</span>
</span><span id=__span-0-67><a id=__codelineno-0-67 name=__codelineno-0-67></a>        <span class=n>available_provider_matches</span> <span class=o>=</span> <span class=n>ProviderModels</span><span class=p>(</span><span class=n>CONFIG</span><span class=o>.</span><span class=n>get_client_config</span><span class=p>())</span><span class=o>.</span><span class=n>available_provider_matches</span><span class=p>(</span>
</span><span id=__span-0-68><a id=__codelineno-0-68 name=__codelineno-0-68></a>            <span class=n>NamespacedName</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=n>metadata</span><span class=o>.</span><span class=n>name</span><span class=p>,</span> <span class=n>namespace</span><span class=o>=</span><span class=n>entry_location</span><span class=o>.</span><span class=n>namespace</span><span class=p>)</span>
</span><span id=__span-0-69><a id=__codelineno-0-69 name=__codelineno-0-69></a>        <span class=p>)</span>
</span><span id=__span-0-70><a id=__codelineno-0-70 name=__codelineno-0-70></a>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>available_provider_matches</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span><span id=__span-0-71><a id=__codelineno-0-71 name=__codelineno-0-71></a>            <span class=n>header</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;provider&quot;</span><span class=p>,</span> <span class=s2>&quot;name&quot;</span><span class=p>]</span>
</span><span id=__span-0-72><a id=__codelineno-0-72 name=__codelineno-0-72></a>
</span><span id=__span-0-73><a id=__codelineno-0-73 name=__codelineno-0-73></a>            <span class=n>table</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-0-74><a id=__codelineno-0-74 name=__codelineno-0-74></a>            <span class=k>for</span> <span class=n>provider</span><span class=p>,</span> <span class=n>name</span> <span class=ow>in</span> <span class=n>available_provider_matches</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span><span id=__span-0-75><a id=__codelineno-0-75 name=__codelineno-0-75></a>                <span class=n>table</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
</span><span id=__span-0-76><a id=__codelineno-0-76 name=__codelineno-0-76></a>                    <span class=p>[</span>
</span><span id=__span-0-77><a id=__codelineno-0-77 name=__codelineno-0-77></a>                        <span class=n>fill</span><span class=p>(</span><span class=n>provider</span><span class=p>),</span>
</span><span id=__span-0-78><a id=__codelineno-0-78 name=__codelineno-0-78></a>                        <span class=n>fill</span><span class=p>(</span><span class=n>name</span><span class=p>),</span>
</span><span id=__span-0-79><a id=__codelineno-0-79 name=__codelineno-0-79></a>                    <span class=p>]</span>
</span><span id=__span-0-80><a id=__codelineno-0-80 name=__codelineno-0-80></a>                <span class=p>)</span>
</span><span id=__span-0-81><a id=__codelineno-0-81 name=__codelineno-0-81></a>            <span class=nb>print</span><span class=p>(</span><span class=n>tabulate</span><span class=p>(</span><span class=n>table</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>header</span><span class=p>,</span> <span class=n>tablefmt</span><span class=o>=</span><span class=s2>&quot;simple_grid&quot;</span><span class=p>))</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.cli.RegistryCli.list class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">list</span> <a href=#nearai.cli.RegistryCli.list class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nb>list</span><span class=p>(</span><span class=nf>namespace</span><span class=p>:</span> <span class=n>str</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=n>category</span><span class=p>:</span> <span class=n>str</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=n>tags</span><span class=p>:</span> <span class=n>str</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=n>total</span><span class=p>:</span> <span class=n>int</span> <span class=o>=</span> <span class=mi>32</span><span class=p>,</span> <span class=n>offset</span><span class=p>:</span> <span class=n>int</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=n>show_all</span><span class=p>:</span> <span class=n>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span> <span class=n>show_latest_version</span><span class=p>:</span> <span class=n>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span> <span class=n>star</span><span class=p>:</span> <span class=n>str</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>List available items.</p> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-123>123</a></span>
<span class=normal><a href=#__codelineno-0-124>124</a></span>
<span class=normal><a href=#__codelineno-0-125>125</a></span>
<span class=normal><a href=#__codelineno-0-126>126</a></span>
<span class=normal><a href=#__codelineno-0-127>127</a></span>
<span class=normal><a href=#__codelineno-0-128>128</a></span>
<span class=normal><a href=#__codelineno-0-129>129</a></span>
<span class=normal><a href=#__codelineno-0-130>130</a></span>
<span class=normal><a href=#__codelineno-0-131>131</a></span>
<span class=normal><a href=#__codelineno-0-132>132</a></span>
<span class=normal><a href=#__codelineno-0-133>133</a></span>
<span class=normal><a href=#__codelineno-0-134>134</a></span>
<span class=normal><a href=#__codelineno-0-135>135</a></span>
<span class=normal><a href=#__codelineno-0-136>136</a></span>
<span class=normal><a href=#__codelineno-0-137>137</a></span>
<span class=normal><a href=#__codelineno-0-138>138</a></span>
<span class=normal><a href=#__codelineno-0-139>139</a></span>
<span class=normal><a href=#__codelineno-0-140>140</a></span>
<span class=normal><a href=#__codelineno-0-141>141</a></span>
<span class=normal><a href=#__codelineno-0-142>142</a></span>
<span class=normal><a href=#__codelineno-0-143>143</a></span>
<span class=normal><a href=#__codelineno-0-144>144</a></span>
<span class=normal><a href=#__codelineno-0-145>145</a></span>
<span class=normal><a href=#__codelineno-0-146>146</a></span>
<span class=normal><a href=#__codelineno-0-147>147</a></span>
<span class=normal><a href=#__codelineno-0-148>148</a></span>
<span class=normal><a href=#__codelineno-0-149>149</a></span>
<span class=normal><a href=#__codelineno-0-150>150</a></span>
<span class=normal><a href=#__codelineno-0-151>151</a></span>
<span class=normal><a href=#__codelineno-0-152>152</a></span>
<span class=normal><a href=#__codelineno-0-153>153</a></span>
<span class=normal><a href=#__codelineno-0-154>154</a></span>
<span class=normal><a href=#__codelineno-0-155>155</a></span>
<span class=normal><a href=#__codelineno-0-156>156</a></span>
<span class=normal><a href=#__codelineno-0-157>157</a></span>
<span class=normal><a href=#__codelineno-0-158>158</a></span>
<span class=normal><a href=#__codelineno-0-159>159</a></span>
<span class=normal><a href=#__codelineno-0-160>160</a></span>
<span class=normal><a href=#__codelineno-0-161>161</a></span>
<span class=normal><a href=#__codelineno-0-162>162</a></span>
<span class=normal><a href=#__codelineno-0-163>163</a></span>
<span class=normal><a href=#__codelineno-0-164>164</a></span>
<span class=normal><a href=#__codelineno-0-165>165</a></span>
<span class=normal><a href=#__codelineno-0-166>166</a></span>
<span class=normal><a href=#__codelineno-0-167>167</a></span>
<span class=normal><a href=#__codelineno-0-168>168</a></span>
<span class=normal><a href=#__codelineno-0-169>169</a></span>
<span class=normal><a href=#__codelineno-0-170>170</a></span>
<span class=normal><a href=#__codelineno-0-171>171</a></span>
<span class=normal><a href=#__codelineno-0-172>172</a></span>
<span class=normal><a href=#__codelineno-0-173>173</a></span>
<span class=normal><a href=#__codelineno-0-174>174</a></span>
<span class=normal><a href=#__codelineno-0-175>175</a></span>
<span class=normal><a href=#__codelineno-0-176>176</a></span>
<span class=normal><a href=#__codelineno-0-177>177</a></span>
<span class=normal><a href=#__codelineno-0-178>178</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-123><a id=__codelineno-0-123 name=__codelineno-0-123></a><span class=k>def</span><span class=w> </span><span class=nf>list</span><span class=p>(</span>
</span><span id=__span-0-124><a id=__codelineno-0-124 name=__codelineno-0-124></a>    <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-125><a id=__codelineno-0-125 name=__codelineno-0-125></a>    <span class=n>namespace</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-126><a id=__codelineno-0-126 name=__codelineno-0-126></a>    <span class=n>category</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-127><a id=__codelineno-0-127 name=__codelineno-0-127></a>    <span class=n>tags</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-128><a id=__codelineno-0-128 name=__codelineno-0-128></a>    <span class=n>total</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>32</span><span class=p>,</span>
</span><span id=__span-0-129><a id=__codelineno-0-129 name=__codelineno-0-129></a>    <span class=n>offset</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span>
</span><span id=__span-0-130><a id=__codelineno-0-130 name=__codelineno-0-130></a>    <span class=n>show_all</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-131><a id=__codelineno-0-131 name=__codelineno-0-131></a>    <span class=n>show_latest_version</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-132><a id=__codelineno-0-132 name=__codelineno-0-132></a>    <span class=n>star</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-133><a id=__codelineno-0-133 name=__codelineno-0-133></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-134><a id=__codelineno-0-134 name=__codelineno-0-134></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;List available items.&quot;&quot;&quot;</span>
</span><span id=__span-0-135><a id=__codelineno-0-135 name=__codelineno-0-135></a>    <span class=c1># Make sure tags is a comma-separated list of tags</span>
</span><span id=__span-0-136><a id=__codelineno-0-136 name=__codelineno-0-136></a>    <span class=n>tags_l</span> <span class=o>=</span> <span class=n>parse_tags</span><span class=p>(</span><span class=n>tags</span><span class=p>)</span>
</span><span id=__span-0-137><a id=__codelineno-0-137 name=__codelineno-0-137></a>    <span class=n>tags</span> <span class=o>=</span> <span class=s2>&quot;,&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>tags_l</span><span class=p>)</span>
</span><span id=__span-0-138><a id=__codelineno-0-138 name=__codelineno-0-138></a>
</span><span id=__span-0-139><a id=__codelineno-0-139 name=__codelineno-0-139></a>    <span class=n>entries</span> <span class=o>=</span> <span class=n>registry</span><span class=o>.</span><span class=n>list</span><span class=p>(</span>
</span><span id=__span-0-140><a id=__codelineno-0-140 name=__codelineno-0-140></a>        <span class=n>namespace</span><span class=o>=</span><span class=n>namespace</span><span class=p>,</span>
</span><span id=__span-0-141><a id=__codelineno-0-141 name=__codelineno-0-141></a>        <span class=n>category</span><span class=o>=</span><span class=n>category</span><span class=p>,</span>
</span><span id=__span-0-142><a id=__codelineno-0-142 name=__codelineno-0-142></a>        <span class=n>tags</span><span class=o>=</span><span class=n>tags</span><span class=p>,</span>
</span><span id=__span-0-143><a id=__codelineno-0-143 name=__codelineno-0-143></a>        <span class=n>total</span><span class=o>=</span><span class=n>total</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span>
</span><span id=__span-0-144><a id=__codelineno-0-144 name=__codelineno-0-144></a>        <span class=n>offset</span><span class=o>=</span><span class=n>offset</span><span class=p>,</span>
</span><span id=__span-0-145><a id=__codelineno-0-145 name=__codelineno-0-145></a>        <span class=n>show_all</span><span class=o>=</span><span class=n>show_all</span><span class=p>,</span>
</span><span id=__span-0-146><a id=__codelineno-0-146 name=__codelineno-0-146></a>        <span class=n>show_latest_version</span><span class=o>=</span><span class=n>show_latest_version</span><span class=p>,</span>
</span><span id=__span-0-147><a id=__codelineno-0-147 name=__codelineno-0-147></a>        <span class=n>starred_by</span><span class=o>=</span><span class=n>star</span><span class=p>,</span>
</span><span id=__span-0-148><a id=__codelineno-0-148 name=__codelineno-0-148></a>    <span class=p>)</span>
</span><span id=__span-0-149><a id=__codelineno-0-149 name=__codelineno-0-149></a>
</span><span id=__span-0-150><a id=__codelineno-0-150 name=__codelineno-0-150></a>    <span class=n>more_rows</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>entries</span><span class=p>)</span> <span class=o>&gt;</span> <span class=n>total</span>
</span><span id=__span-0-151><a id=__codelineno-0-151 name=__codelineno-0-151></a>    <span class=n>entries</span> <span class=o>=</span> <span class=n>entries</span><span class=p>[:</span><span class=n>total</span><span class=p>]</span>
</span><span id=__span-0-152><a id=__codelineno-0-152 name=__codelineno-0-152></a>
</span><span id=__span-0-153><a id=__codelineno-0-153 name=__codelineno-0-153></a>    <span class=n>header</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;entry&quot;</span><span class=p>,</span> <span class=s2>&quot;category&quot;</span><span class=p>,</span> <span class=s2>&quot;description&quot;</span><span class=p>,</span> <span class=s2>&quot;tags&quot;</span><span class=p>]</span>
</span><span id=__span-0-154><a id=__codelineno-0-154 name=__codelineno-0-154></a>
</span><span id=__span-0-155><a id=__codelineno-0-155 name=__codelineno-0-155></a>    <span class=n>table</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-0-156><a id=__codelineno-0-156 name=__codelineno-0-156></a>    <span class=k>for</span> <span class=n>entry</span> <span class=ow>in</span> <span class=n>entries</span><span class=p>:</span>
</span><span id=__span-0-157><a id=__codelineno-0-157 name=__codelineno-0-157></a>        <span class=n>table</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
</span><span id=__span-0-158><a id=__codelineno-0-158 name=__codelineno-0-158></a>            <span class=p>[</span>
</span><span id=__span-0-159><a id=__codelineno-0-159 name=__codelineno-0-159></a>                <span class=n>fill</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>entry</span><span class=o>.</span><span class=n>namespace</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>entry</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>entry</span><span class=o>.</span><span class=n>version</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>),</span>
</span><span id=__span-0-160><a id=__codelineno-0-160 name=__codelineno-0-160></a>                <span class=n>fill</span><span class=p>(</span><span class=n>entry</span><span class=o>.</span><span class=n>category</span><span class=p>,</span> <span class=mi>20</span><span class=p>),</span>
</span><span id=__span-0-161><a id=__codelineno-0-161 name=__codelineno-0-161></a>                <span class=n>fill</span><span class=p>(</span><span class=n>entry</span><span class=o>.</span><span class=n>description</span><span class=p>,</span> <span class=mi>50</span><span class=p>),</span>
</span><span id=__span-0-162><a id=__codelineno-0-162 name=__codelineno-0-162></a>                <span class=n>fill</span><span class=p>(</span><span class=s2>&quot;, &quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>entry</span><span class=o>.</span><span class=n>tags</span><span class=p>),</span> <span class=mi>20</span><span class=p>),</span>
</span><span id=__span-0-163><a id=__codelineno-0-163 name=__codelineno-0-163></a>            <span class=p>]</span>
</span><span id=__span-0-164><a id=__codelineno-0-164 name=__codelineno-0-164></a>        <span class=p>)</span>
</span><span id=__span-0-165><a id=__codelineno-0-165 name=__codelineno-0-165></a>
</span><span id=__span-0-166><a id=__codelineno-0-166 name=__codelineno-0-166></a>    <span class=k>if</span> <span class=n>more_rows</span><span class=p>:</span>
</span><span id=__span-0-167><a id=__codelineno-0-167 name=__codelineno-0-167></a>        <span class=n>table</span><span class=o>.</span><span class=n>append</span><span class=p>([</span><span class=s2>&quot;...&quot;</span><span class=p>,</span> <span class=s2>&quot;...&quot;</span><span class=p>,</span> <span class=s2>&quot;...&quot;</span><span class=p>,</span> <span class=s2>&quot;...&quot;</span><span class=p>])</span>
</span><span id=__span-0-168><a id=__codelineno-0-168 name=__codelineno-0-168></a>
</span><span id=__span-0-169><a id=__codelineno-0-169 name=__codelineno-0-169></a>    <span class=nb>print</span><span class=p>(</span><span class=n>tabulate</span><span class=p>(</span><span class=n>table</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>header</span><span class=p>,</span> <span class=n>tablefmt</span><span class=o>=</span><span class=s2>&quot;simple_grid&quot;</span><span class=p>))</span>
</span><span id=__span-0-170><a id=__codelineno-0-170 name=__codelineno-0-170></a>
</span><span id=__span-0-171><a id=__codelineno-0-171 name=__codelineno-0-171></a>    <span class=k>if</span> <span class=n>category</span> <span class=o>==</span> <span class=s2>&quot;model&quot;</span> <span class=ow>and</span> <span class=nb>len</span><span class=p>(</span><span class=n>entries</span><span class=p>)</span> <span class=o>&lt;</span> <span class=n>total</span> <span class=ow>and</span> <span class=n>namespace</span> <span class=o>==</span> <span class=s2>&quot;&quot;</span> <span class=ow>and</span> <span class=n>tags</span> <span class=o>==</span> <span class=s2>&quot;&quot;</span> <span class=ow>and</span> <span class=n>star</span> <span class=o>==</span> <span class=s2>&quot;&quot;</span><span class=p>:</span>
</span><span id=__span-0-172><a id=__codelineno-0-172 name=__codelineno-0-172></a>        <span class=n>unregistered_common_provider_models</span> <span class=o>=</span> <span class=n>ProviderModels</span><span class=p>(</span>
</span><span id=__span-0-173><a id=__codelineno-0-173 name=__codelineno-0-173></a>            <span class=n>CONFIG</span><span class=o>.</span><span class=n>get_client_config</span><span class=p>()</span>
</span><span id=__span-0-174><a id=__codelineno-0-174 name=__codelineno-0-174></a>        <span class=p>)</span><span class=o>.</span><span class=n>get_unregistered_common_provider_models</span><span class=p>(</span><span class=n>registry</span><span class=o>.</span><span class=n>dict_models</span><span class=p>())</span>
</span><span id=__span-0-175><a id=__codelineno-0-175 name=__codelineno-0-175></a>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>unregistered_common_provider_models</span><span class=p>):</span>
</span><span id=__span-0-176><a id=__codelineno-0-176 name=__codelineno-0-176></a>            <span class=nb>print</span><span class=p>(</span>
</span><span id=__span-0-177><a id=__codelineno-0-177 name=__codelineno-0-177></a>                <span class=sa>f</span><span class=s2>&quot;There are unregistered common provider models: </span><span class=si>{</span><span class=n>unregistered_common_provider_models</span><span class=si>}</span><span class=s2>. Run &#39;nearai registry upload-unregistered-common-provider-models&#39; to update registry.&quot;</span>  <span class=c1># noqa: E501</span>
</span><span id=__span-0-178><a id=__codelineno-0-178 name=__codelineno-0-178></a>            <span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.cli.RegistryCli.metadata_template class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">metadata_template</span> <a href=#nearai.cli.RegistryCli.metadata_template class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>metadata_template</span><span class=p>(</span><span class=n>local_path</span><span class=p>:</span> <span class=n>str</span> <span class=o>=</span> <span class=s1>&#39;.&#39;</span><span class=p>,</span> <span class=n>category</span><span class=p>:</span> <span class=n>str</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=n>description</span><span class=p>:</span> <span class=n>str</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Create a metadata template.</p> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-83> 83</a></span>
<span class=normal><a href=#__codelineno-0-84> 84</a></span>
<span class=normal><a href=#__codelineno-0-85> 85</a></span>
<span class=normal><a href=#__codelineno-0-86> 86</a></span>
<span class=normal><a href=#__codelineno-0-87> 87</a></span>
<span class=normal><a href=#__codelineno-0-88> 88</a></span>
<span class=normal><a href=#__codelineno-0-89> 89</a></span>
<span class=normal><a href=#__codelineno-0-90> 90</a></span>
<span class=normal><a href=#__codelineno-0-91> 91</a></span>
<span class=normal><a href=#__codelineno-0-92> 92</a></span>
<span class=normal><a href=#__codelineno-0-93> 93</a></span>
<span class=normal><a href=#__codelineno-0-94> 94</a></span>
<span class=normal><a href=#__codelineno-0-95> 95</a></span>
<span class=normal><a href=#__codelineno-0-96> 96</a></span>
<span class=normal><a href=#__codelineno-0-97> 97</a></span>
<span class=normal><a href=#__codelineno-0-98> 98</a></span>
<span class=normal><a href=#__codelineno-0-99> 99</a></span>
<span class=normal><a href=#__codelineno-0-100>100</a></span>
<span class=normal><a href=#__codelineno-0-101>101</a></span>
<span class=normal><a href=#__codelineno-0-102>102</a></span>
<span class=normal><a href=#__codelineno-0-103>103</a></span>
<span class=normal><a href=#__codelineno-0-104>104</a></span>
<span class=normal><a href=#__codelineno-0-105>105</a></span>
<span class=normal><a href=#__codelineno-0-106>106</a></span>
<span class=normal><a href=#__codelineno-0-107>107</a></span>
<span class=normal><a href=#__codelineno-0-108>108</a></span>
<span class=normal><a href=#__codelineno-0-109>109</a></span>
<span class=normal><a href=#__codelineno-0-110>110</a></span>
<span class=normal><a href=#__codelineno-0-111>111</a></span>
<span class=normal><a href=#__codelineno-0-112>112</a></span>
<span class=normal><a href=#__codelineno-0-113>113</a></span>
<span class=normal><a href=#__codelineno-0-114>114</a></span>
<span class=normal><a href=#__codelineno-0-115>115</a></span>
<span class=normal><a href=#__codelineno-0-116>116</a></span>
<span class=normal><a href=#__codelineno-0-117>117</a></span>
<span class=normal><a href=#__codelineno-0-118>118</a></span>
<span class=normal><a href=#__codelineno-0-119>119</a></span>
<span class=normal><a href=#__codelineno-0-120>120</a></span>
<span class=normal><a href=#__codelineno-0-121>121</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-83><a id=__codelineno-0-83 name=__codelineno-0-83></a><span class=k>def</span><span class=w> </span><span class=nf>metadata_template</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>local_path</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;.&quot;</span><span class=p>,</span> <span class=n>category</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>description</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>):</span>
</span><span id=__span-0-84><a id=__codelineno-0-84 name=__codelineno-0-84></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Create a metadata template.&quot;&quot;&quot;</span>
</span><span id=__span-0-85><a id=__codelineno-0-85 name=__codelineno-0-85></a>    <span class=n>path</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=n>local_path</span><span class=p>)</span>
</span><span id=__span-0-86><a id=__codelineno-0-86 name=__codelineno-0-86></a>
</span><span id=__span-0-87><a id=__codelineno-0-87 name=__codelineno-0-87></a>    <span class=n>metadata_path</span> <span class=o>=</span> <span class=n>path</span> <span class=o>/</span> <span class=s2>&quot;metadata.json&quot;</span>
</span><span id=__span-0-88><a id=__codelineno-0-88 name=__codelineno-0-88></a>
</span><span id=__span-0-89><a id=__codelineno-0-89 name=__codelineno-0-89></a>    <span class=n>version</span> <span class=o>=</span> <span class=n>path</span><span class=o>.</span><span class=n>name</span>
</span><span id=__span-0-90><a id=__codelineno-0-90 name=__codelineno-0-90></a>    <span class=n>pattern</span> <span class=o>=</span> <span class=sa>r</span><span class=s2>&quot;^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$&quot;</span>  <span class=c1># noqa: E501</span>
</span><span id=__span-0-91><a id=__codelineno-0-91 name=__codelineno-0-91></a>    <span class=k>assert</span> <span class=n>re</span><span class=o>.</span><span class=n>match</span><span class=p>(</span><span class=n>pattern</span><span class=p>,</span> <span class=n>version</span><span class=p>),</span> <span class=sa>f</span><span class=s2>&quot;Invalid semantic version format: </span><span class=si>{</span><span class=n>version</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-92><a id=__codelineno-0-92 name=__codelineno-0-92></a>    <span class=n>name</span> <span class=o>=</span> <span class=n>path</span><span class=o>.</span><span class=n>parent</span><span class=o>.</span><span class=n>name</span>
</span><span id=__span-0-93><a id=__codelineno-0-93 name=__codelineno-0-93></a>    <span class=k>assert</span> <span class=ow>not</span> <span class=n>re</span><span class=o>.</span><span class=n>match</span><span class=p>(</span><span class=n>pattern</span><span class=p>,</span> <span class=n>name</span><span class=p>),</span> <span class=sa>f</span><span class=s2>&quot;Invalid agent name: </span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-94><a id=__codelineno-0-94 name=__codelineno-0-94></a>
</span><span id=__span-0-95><a id=__codelineno-0-95 name=__codelineno-0-95></a>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>metadata_path</span><span class=p>,</span> <span class=s2>&quot;w&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-96><a id=__codelineno-0-96 name=__codelineno-0-96></a>        <span class=n>metadata</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-97><a id=__codelineno-0-97 name=__codelineno-0-97></a>            <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=n>name</span><span class=p>,</span>
</span><span id=__span-0-98><a id=__codelineno-0-98 name=__codelineno-0-98></a>            <span class=s2>&quot;version&quot;</span><span class=p>:</span> <span class=n>version</span><span class=p>,</span>
</span><span id=__span-0-99><a id=__codelineno-0-99 name=__codelineno-0-99></a>            <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=n>description</span><span class=p>,</span>
</span><span id=__span-0-100><a id=__codelineno-0-100 name=__codelineno-0-100></a>            <span class=s2>&quot;category&quot;</span><span class=p>:</span> <span class=n>category</span><span class=p>,</span>
</span><span id=__span-0-101><a id=__codelineno-0-101 name=__codelineno-0-101></a>            <span class=s2>&quot;tags&quot;</span><span class=p>:</span> <span class=p>[],</span>
</span><span id=__span-0-102><a id=__codelineno-0-102 name=__codelineno-0-102></a>            <span class=s2>&quot;details&quot;</span><span class=p>:</span> <span class=p>{},</span>
</span><span id=__span-0-103><a id=__codelineno-0-103 name=__codelineno-0-103></a>            <span class=s2>&quot;show_entry&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-104><a id=__codelineno-0-104 name=__codelineno-0-104></a>        <span class=p>}</span>
</span><span id=__span-0-105><a id=__codelineno-0-105 name=__codelineno-0-105></a>
</span><span id=__span-0-106><a id=__codelineno-0-106 name=__codelineno-0-106></a>        <span class=k>if</span> <span class=n>category</span> <span class=o>==</span> <span class=s2>&quot;agent&quot;</span><span class=p>:</span>
</span><span id=__span-0-107><a id=__codelineno-0-107 name=__codelineno-0-107></a>            <span class=n>metadata</span><span class=p>[</span><span class=s2>&quot;details&quot;</span><span class=p>][</span><span class=s2>&quot;agent&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-0-108><a id=__codelineno-0-108 name=__codelineno-0-108></a>            <span class=n>metadata</span><span class=p>[</span><span class=s2>&quot;details&quot;</span><span class=p>][</span><span class=s2>&quot;agent&quot;</span><span class=p>][</span><span class=s2>&quot;welcome&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-109><a id=__codelineno-0-109 name=__codelineno-0-109></a>                <span class=s2>&quot;title&quot;</span><span class=p>:</span> <span class=n>name</span><span class=p>,</span>
</span><span id=__span-0-110><a id=__codelineno-0-110 name=__codelineno-0-110></a>                <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=n>description</span><span class=p>,</span>
</span><span id=__span-0-111><a id=__codelineno-0-111 name=__codelineno-0-111></a>            <span class=p>}</span>
</span><span id=__span-0-112><a id=__codelineno-0-112 name=__codelineno-0-112></a>            <span class=n>metadata</span><span class=p>[</span><span class=s2>&quot;details&quot;</span><span class=p>][</span><span class=s2>&quot;agent&quot;</span><span class=p>][</span><span class=s2>&quot;defaults&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-113><a id=__codelineno-0-113 name=__codelineno-0-113></a>                <span class=s2>&quot;model&quot;</span><span class=p>:</span> <span class=n>DEFAULT_MODEL</span><span class=p>,</span>
</span><span id=__span-0-114><a id=__codelineno-0-114 name=__codelineno-0-114></a>                <span class=s2>&quot;model_provider&quot;</span><span class=p>:</span> <span class=n>DEFAULT_PROVIDER</span><span class=p>,</span>
</span><span id=__span-0-115><a id=__codelineno-0-115 name=__codelineno-0-115></a>                <span class=s2>&quot;model_temperature&quot;</span><span class=p>:</span> <span class=n>DEFAULT_MODEL_TEMPERATURE</span><span class=p>,</span>
</span><span id=__span-0-116><a id=__codelineno-0-116 name=__codelineno-0-116></a>                <span class=s2>&quot;model_max_tokens&quot;</span><span class=p>:</span> <span class=n>DEFAULT_MODEL_MAX_TOKENS</span><span class=p>,</span>
</span><span id=__span-0-117><a id=__codelineno-0-117 name=__codelineno-0-117></a>                <span class=s2>&quot;max_iterations&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span><span id=__span-0-118><a id=__codelineno-0-118 name=__codelineno-0-118></a>            <span class=p>}</span>
</span><span id=__span-0-119><a id=__codelineno-0-119 name=__codelineno-0-119></a>            <span class=n>metadata</span><span class=p>[</span><span class=s2>&quot;details&quot;</span><span class=p>][</span><span class=s2>&quot;agent&quot;</span><span class=p>][</span><span class=s2>&quot;framework&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;base&quot;</span>
</span><span id=__span-0-120><a id=__codelineno-0-120 name=__codelineno-0-120></a>
</span><span id=__span-0-121><a id=__codelineno-0-121 name=__codelineno-0-121></a>        <span class=n>json</span><span class=o>.</span><span class=n>dump</span><span class=p>(</span><span class=n>metadata</span><span class=p>,</span> <span class=n>f</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.cli.RegistryCli.update class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">update</span> <a href=#nearai.cli.RegistryCli.update class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>update</span><span class=p>(</span><span class=n>local_path</span><span class=p>:</span> <span class=n>str</span> <span class=o>=</span> <span class=s1>&#39;.&#39;</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Update metadata of a registry item.</p> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-180>180</a></span>
<span class=normal><a href=#__codelineno-0-181>181</a></span>
<span class=normal><a href=#__codelineno-0-182>182</a></span>
<span class=normal><a href=#__codelineno-0-183>183</a></span>
<span class=normal><a href=#__codelineno-0-184>184</a></span>
<span class=normal><a href=#__codelineno-0-185>185</a></span>
<span class=normal><a href=#__codelineno-0-186>186</a></span>
<span class=normal><a href=#__codelineno-0-187>187</a></span>
<span class=normal><a href=#__codelineno-0-188>188</a></span>
<span class=normal><a href=#__codelineno-0-189>189</a></span>
<span class=normal><a href=#__codelineno-0-190>190</a></span>
<span class=normal><a href=#__codelineno-0-191>191</a></span>
<span class=normal><a href=#__codelineno-0-192>192</a></span>
<span class=normal><a href=#__codelineno-0-193>193</a></span>
<span class=normal><a href=#__codelineno-0-194>194</a></span>
<span class=normal><a href=#__codelineno-0-195>195</a></span>
<span class=normal><a href=#__codelineno-0-196>196</a></span>
<span class=normal><a href=#__codelineno-0-197>197</a></span>
<span class=normal><a href=#__codelineno-0-198>198</a></span>
<span class=normal><a href=#__codelineno-0-199>199</a></span>
<span class=normal><a href=#__codelineno-0-200>200</a></span>
<span class=normal><a href=#__codelineno-0-201>201</a></span>
<span class=normal><a href=#__codelineno-0-202>202</a></span>
<span class=normal><a href=#__codelineno-0-203>203</a></span>
<span class=normal><a href=#__codelineno-0-204>204</a></span>
<span class=normal><a href=#__codelineno-0-205>205</a></span>
<span class=normal><a href=#__codelineno-0-206>206</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-180><a id=__codelineno-0-180 name=__codelineno-0-180></a><span class=k>def</span><span class=w> </span><span class=nf>update</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>local_path</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;.&quot;</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-181><a id=__codelineno-0-181 name=__codelineno-0-181></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Update metadata of a registry item.&quot;&quot;&quot;</span>
</span><span id=__span-0-182><a id=__codelineno-0-182 name=__codelineno-0-182></a>    <span class=n>path</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=n>local_path</span><span class=p>)</span>
</span><span id=__span-0-183><a id=__codelineno-0-183 name=__codelineno-0-183></a>
</span><span id=__span-0-184><a id=__codelineno-0-184 name=__codelineno-0-184></a>    <span class=k>if</span> <span class=n>CONFIG</span><span class=o>.</span><span class=n>auth</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-185><a id=__codelineno-0-185 name=__codelineno-0-185></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Please login with `nearai login`&quot;</span><span class=p>)</span>
</span><span id=__span-0-186><a id=__codelineno-0-186 name=__codelineno-0-186></a>        <span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span><span id=__span-0-187><a id=__codelineno-0-187 name=__codelineno-0-187></a>
</span><span id=__span-0-188><a id=__codelineno-0-188 name=__codelineno-0-188></a>    <span class=n>metadata_path</span> <span class=o>=</span> <span class=n>path</span> <span class=o>/</span> <span class=s2>&quot;metadata.json&quot;</span>
</span><span id=__span-0-189><a id=__codelineno-0-189 name=__codelineno-0-189></a>    <span class=n>check_metadata</span><span class=p>(</span><span class=n>metadata_path</span><span class=p>)</span>
</span><span id=__span-0-190><a id=__codelineno-0-190 name=__codelineno-0-190></a>
</span><span id=__span-0-191><a id=__codelineno-0-191 name=__codelineno-0-191></a>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>metadata_path</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-192><a id=__codelineno-0-192 name=__codelineno-0-192></a>        <span class=n>metadata</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>f</span><span class=p>)</span>
</span><span id=__span-0-193><a id=__codelineno-0-193 name=__codelineno-0-193></a>
</span><span id=__span-0-194><a id=__codelineno-0-194 name=__codelineno-0-194></a>    <span class=n>namespace</span> <span class=o>=</span> <span class=n>CONFIG</span><span class=o>.</span><span class=n>auth</span><span class=o>.</span><span class=n>namespace</span>
</span><span id=__span-0-195><a id=__codelineno-0-195 name=__codelineno-0-195></a>
</span><span id=__span-0-196><a id=__codelineno-0-196 name=__codelineno-0-196></a>    <span class=n>entry_location</span> <span class=o>=</span> <span class=n>EntryLocation</span><span class=o>.</span><span class=n>model_validate</span><span class=p>(</span>
</span><span id=__span-0-197><a id=__codelineno-0-197 name=__codelineno-0-197></a>        <span class=nb>dict</span><span class=p>(</span>
</span><span id=__span-0-198><a id=__codelineno-0-198 name=__codelineno-0-198></a>            <span class=n>namespace</span><span class=o>=</span><span class=n>namespace</span><span class=p>,</span>
</span><span id=__span-0-199><a id=__codelineno-0-199 name=__codelineno-0-199></a>            <span class=n>name</span><span class=o>=</span><span class=n>metadata</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;name&quot;</span><span class=p>),</span>
</span><span id=__span-0-200><a id=__codelineno-0-200 name=__codelineno-0-200></a>            <span class=n>version</span><span class=o>=</span><span class=n>metadata</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;version&quot;</span><span class=p>),</span>
</span><span id=__span-0-201><a id=__codelineno-0-201 name=__codelineno-0-201></a>        <span class=p>)</span>
</span><span id=__span-0-202><a id=__codelineno-0-202 name=__codelineno-0-202></a>    <span class=p>)</span>
</span><span id=__span-0-203><a id=__codelineno-0-203 name=__codelineno-0-203></a>
</span><span id=__span-0-204><a id=__codelineno-0-204 name=__codelineno-0-204></a>    <span class=n>entry_metadata</span> <span class=o>=</span> <span class=n>EntryMetadataInput</span><span class=o>.</span><span class=n>model_validate</span><span class=p>(</span><span class=n>metadata</span><span class=p>)</span>
</span><span id=__span-0-205><a id=__codelineno-0-205 name=__codelineno-0-205></a>    <span class=n>result</span> <span class=o>=</span> <span class=n>registry</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>entry_location</span><span class=p>,</span> <span class=n>entry_metadata</span><span class=p>)</span>
</span><span id=__span-0-206><a id=__codelineno-0-206 name=__codelineno-0-206></a>    <span class=nb>print</span><span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>result</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>))</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.cli.RegistryCli.upload class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">upload</span> <a href=#nearai.cli.RegistryCli.upload class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>upload</span><span class=p>(</span><span class=n>local_path</span><span class=p>:</span> <span class=n>str</span> <span class=o>=</span> <span class=s1>&#39;.&#39;</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><a class="autorefs autorefs-internal" title=nearai.openapi_client.EntryLocation href=#nearai.EntryLocation>EntryLocation</a></span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Upload item to the registry.</p> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-259>259</a></span>
<span class=normal><a href=#__codelineno-0-260>260</a></span>
<span class=normal><a href=#__codelineno-0-261>261</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-259><a id=__codelineno-0-259 name=__codelineno-0-259></a><span class=k>def</span><span class=w> </span><span class=nf>upload</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>local_path</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;.&quot;</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>EntryLocation</span><span class=p>:</span>
</span><span id=__span-0-260><a id=__codelineno-0-260 name=__codelineno-0-260></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Upload item to the registry.&quot;&quot;&quot;</span>
</span><span id=__span-0-261><a id=__codelineno-0-261 name=__codelineno-0-261></a>    <span class=k>return</span> <span class=n>registry</span><span class=o>.</span><span class=n>upload</span><span class=p>(</span><span class=n>Path</span><span class=p>(</span><span class=n>local_path</span><span class=p>),</span> <span class=n>show_progress</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.cli.RegistryCli.upload_unregistered_common_provider_models class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">upload_unregistered_common_provider_models</span> <a href=#nearai.cli.RegistryCli.upload_unregistered_common_provider_models class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>upload_unregistered_common_provider_models</span><span class=p>(</span><span class=n>dry_run</span><span class=p>:</span> <span class=n>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Creates new registry items for unregistered common provider models.</p> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-208>208</a></span>
<span class=normal><a href=#__codelineno-0-209>209</a></span>
<span class=normal><a href=#__codelineno-0-210>210</a></span>
<span class=normal><a href=#__codelineno-0-211>211</a></span>
<span class=normal><a href=#__codelineno-0-212>212</a></span>
<span class=normal><a href=#__codelineno-0-213>213</a></span>
<span class=normal><a href=#__codelineno-0-214>214</a></span>
<span class=normal><a href=#__codelineno-0-215>215</a></span>
<span class=normal><a href=#__codelineno-0-216>216</a></span>
<span class=normal><a href=#__codelineno-0-217>217</a></span>
<span class=normal><a href=#__codelineno-0-218>218</a></span>
<span class=normal><a href=#__codelineno-0-219>219</a></span>
<span class=normal><a href=#__codelineno-0-220>220</a></span>
<span class=normal><a href=#__codelineno-0-221>221</a></span>
<span class=normal><a href=#__codelineno-0-222>222</a></span>
<span class=normal><a href=#__codelineno-0-223>223</a></span>
<span class=normal><a href=#__codelineno-0-224>224</a></span>
<span class=normal><a href=#__codelineno-0-225>225</a></span>
<span class=normal><a href=#__codelineno-0-226>226</a></span>
<span class=normal><a href=#__codelineno-0-227>227</a></span>
<span class=normal><a href=#__codelineno-0-228>228</a></span>
<span class=normal><a href=#__codelineno-0-229>229</a></span>
<span class=normal><a href=#__codelineno-0-230>230</a></span>
<span class=normal><a href=#__codelineno-0-231>231</a></span>
<span class=normal><a href=#__codelineno-0-232>232</a></span>
<span class=normal><a href=#__codelineno-0-233>233</a></span>
<span class=normal><a href=#__codelineno-0-234>234</a></span>
<span class=normal><a href=#__codelineno-0-235>235</a></span>
<span class=normal><a href=#__codelineno-0-236>236</a></span>
<span class=normal><a href=#__codelineno-0-237>237</a></span>
<span class=normal><a href=#__codelineno-0-238>238</a></span>
<span class=normal><a href=#__codelineno-0-239>239</a></span>
<span class=normal><a href=#__codelineno-0-240>240</a></span>
<span class=normal><a href=#__codelineno-0-241>241</a></span>
<span class=normal><a href=#__codelineno-0-242>242</a></span>
<span class=normal><a href=#__codelineno-0-243>243</a></span>
<span class=normal><a href=#__codelineno-0-244>244</a></span>
<span class=normal><a href=#__codelineno-0-245>245</a></span>
<span class=normal><a href=#__codelineno-0-246>246</a></span>
<span class=normal><a href=#__codelineno-0-247>247</a></span>
<span class=normal><a href=#__codelineno-0-248>248</a></span>
<span class=normal><a href=#__codelineno-0-249>249</a></span>
<span class=normal><a href=#__codelineno-0-250>250</a></span>
<span class=normal><a href=#__codelineno-0-251>251</a></span>
<span class=normal><a href=#__codelineno-0-252>252</a></span>
<span class=normal><a href=#__codelineno-0-253>253</a></span>
<span class=normal><a href=#__codelineno-0-254>254</a></span>
<span class=normal><a href=#__codelineno-0-255>255</a></span>
<span class=normal><a href=#__codelineno-0-256>256</a></span>
<span class=normal><a href=#__codelineno-0-257>257</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-208><a id=__codelineno-0-208 name=__codelineno-0-208></a><span class=k>def</span><span class=w> </span><span class=nf>upload_unregistered_common_provider_models</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>dry_run</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-209><a id=__codelineno-0-209 name=__codelineno-0-209></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Creates new registry items for unregistered common provider models.&quot;&quot;&quot;</span>
</span><span id=__span-0-210><a id=__codelineno-0-210 name=__codelineno-0-210></a>    <span class=n>provider_matches_list</span> <span class=o>=</span> <span class=n>ProviderModels</span><span class=p>(</span><span class=n>CONFIG</span><span class=o>.</span><span class=n>get_client_config</span><span class=p>())</span><span class=o>.</span><span class=n>get_unregistered_common_provider_models</span><span class=p>(</span>
</span><span id=__span-0-211><a id=__codelineno-0-211 name=__codelineno-0-211></a>        <span class=n>registry</span><span class=o>.</span><span class=n>dict_models</span><span class=p>()</span>
</span><span id=__span-0-212><a id=__codelineno-0-212 name=__codelineno-0-212></a>    <span class=p>)</span>
</span><span id=__span-0-213><a id=__codelineno-0-213 name=__codelineno-0-213></a>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>provider_matches_list</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span><span id=__span-0-214><a id=__codelineno-0-214 name=__codelineno-0-214></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;No new models to upload.&quot;</span><span class=p>)</span>
</span><span id=__span-0-215><a id=__codelineno-0-215 name=__codelineno-0-215></a>        <span class=k>return</span>
</span><span id=__span-0-216><a id=__codelineno-0-216 name=__codelineno-0-216></a>
</span><span id=__span-0-217><a id=__codelineno-0-217 name=__codelineno-0-217></a>    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Going to create new registry items:&quot;</span><span class=p>)</span>
</span><span id=__span-0-218><a id=__codelineno-0-218 name=__codelineno-0-218></a>    <span class=n>header</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;entry&quot;</span><span class=p>,</span> <span class=s2>&quot;description&quot;</span><span class=p>]</span>
</span><span id=__span-0-219><a id=__codelineno-0-219 name=__codelineno-0-219></a>    <span class=n>table</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-0-220><a id=__codelineno-0-220 name=__codelineno-0-220></a>    <span class=n>paths</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-0-221><a id=__codelineno-0-221 name=__codelineno-0-221></a>    <span class=k>for</span> <span class=n>provider_matches</span> <span class=ow>in</span> <span class=n>provider_matches_list</span><span class=p>:</span>
</span><span id=__span-0-222><a id=__codelineno-0-222 name=__codelineno-0-222></a>        <span class=n>provider_model</span> <span class=o>=</span> <span class=n>provider_matches</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>DEFAULT_PROVIDER</span><span class=p>)</span> <span class=ow>or</span> <span class=nb>next</span><span class=p>(</span><span class=nb>iter</span><span class=p>(</span><span class=n>provider_matches</span><span class=o>.</span><span class=n>values</span><span class=p>()))</span>
</span><span id=__span-0-223><a id=__codelineno-0-223 name=__codelineno-0-223></a>        <span class=n>_</span><span class=p>,</span> <span class=n>model</span> <span class=o>=</span> <span class=n>get_provider_namespaced_model</span><span class=p>(</span><span class=n>provider_model</span><span class=p>)</span>
</span><span id=__span-0-224><a id=__codelineno-0-224 name=__codelineno-0-224></a>        <span class=k>assert</span> <span class=n>model</span><span class=o>.</span><span class=n>namespace</span> <span class=o>==</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-225><a id=__codelineno-0-225 name=__codelineno-0-225></a>        <span class=n>model</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=n>create_registry_name</span><span class=p>(</span><span class=n>model</span><span class=o>.</span><span class=n>name</span><span class=p>)</span>
</span><span id=__span-0-226><a id=__codelineno-0-226 name=__codelineno-0-226></a>        <span class=n>model</span><span class=o>.</span><span class=n>namespace</span> <span class=o>=</span> <span class=n>DEFAULT_NAMESPACE</span>
</span><span id=__span-0-227><a id=__codelineno-0-227 name=__codelineno-0-227></a>        <span class=n>version</span> <span class=o>=</span> <span class=s2>&quot;1.0.0&quot;</span>
</span><span id=__span-0-228><a id=__codelineno-0-228 name=__codelineno-0-228></a>        <span class=n>description</span> <span class=o>=</span> <span class=s2>&quot; &amp; &quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>provider_matches</span><span class=o>.</span><span class=n>values</span><span class=p>())</span>
</span><span id=__span-0-229><a id=__codelineno-0-229 name=__codelineno-0-229></a>        <span class=n>table</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
</span><span id=__span-0-230><a id=__codelineno-0-230 name=__codelineno-0-230></a>            <span class=p>[</span>
</span><span id=__span-0-231><a id=__codelineno-0-231 name=__codelineno-0-231></a>                <span class=n>fill</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>model</span><span class=o>.</span><span class=n>namespace</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>model</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>version</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>),</span>
</span><span id=__span-0-232><a id=__codelineno-0-232 name=__codelineno-0-232></a>                <span class=n>fill</span><span class=p>(</span><span class=n>description</span><span class=p>,</span> <span class=mi>50</span><span class=p>),</span>
</span><span id=__span-0-233><a id=__codelineno-0-233 name=__codelineno-0-233></a>            <span class=p>]</span>
</span><span id=__span-0-234><a id=__codelineno-0-234 name=__codelineno-0-234></a>        <span class=p>)</span>
</span><span id=__span-0-235><a id=__codelineno-0-235 name=__codelineno-0-235></a>
</span><span id=__span-0-236><a id=__codelineno-0-236 name=__codelineno-0-236></a>        <span class=n>path</span> <span class=o>=</span> <span class=n>get_registry_folder</span><span class=p>()</span> <span class=o>/</span> <span class=n>model</span><span class=o>.</span><span class=n>namespace</span> <span class=o>/</span> <span class=n>model</span><span class=o>.</span><span class=n>name</span> <span class=o>/</span> <span class=n>version</span>
</span><span id=__span-0-237><a id=__codelineno-0-237 name=__codelineno-0-237></a>        <span class=n>path</span><span class=o>.</span><span class=n>mkdir</span><span class=p>(</span><span class=n>parents</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-238><a id=__codelineno-0-238 name=__codelineno-0-238></a>        <span class=n>paths</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
</span><span id=__span-0-239><a id=__codelineno-0-239 name=__codelineno-0-239></a>        <span class=n>metadata_path</span> <span class=o>=</span> <span class=n>path</span> <span class=o>/</span> <span class=s2>&quot;metadata.json&quot;</span>
</span><span id=__span-0-240><a id=__codelineno-0-240 name=__codelineno-0-240></a>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>metadata_path</span><span class=p>,</span> <span class=s2>&quot;w&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-241><a id=__codelineno-0-241 name=__codelineno-0-241></a>            <span class=n>metadata</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-242><a id=__codelineno-0-242 name=__codelineno-0-242></a>                <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=n>model</span><span class=o>.</span><span class=n>name</span><span class=p>,</span>
</span><span id=__span-0-243><a id=__codelineno-0-243 name=__codelineno-0-243></a>                <span class=s2>&quot;version&quot;</span><span class=p>:</span> <span class=n>version</span><span class=p>,</span>
</span><span id=__span-0-244><a id=__codelineno-0-244 name=__codelineno-0-244></a>                <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=n>description</span><span class=p>,</span>
</span><span id=__span-0-245><a id=__codelineno-0-245 name=__codelineno-0-245></a>                <span class=s2>&quot;category&quot;</span><span class=p>:</span> <span class=s2>&quot;model&quot;</span><span class=p>,</span>
</span><span id=__span-0-246><a id=__codelineno-0-246 name=__codelineno-0-246></a>                <span class=s2>&quot;tags&quot;</span><span class=p>:</span> <span class=p>[],</span>
</span><span id=__span-0-247><a id=__codelineno-0-247 name=__codelineno-0-247></a>                <span class=s2>&quot;details&quot;</span><span class=p>:</span> <span class=p>{},</span>
</span><span id=__span-0-248><a id=__codelineno-0-248 name=__codelineno-0-248></a>                <span class=s2>&quot;show_entry&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-249><a id=__codelineno-0-249 name=__codelineno-0-249></a>            <span class=p>}</span>
</span><span id=__span-0-250><a id=__codelineno-0-250 name=__codelineno-0-250></a>            <span class=n>json</span><span class=o>.</span><span class=n>dump</span><span class=p>(</span><span class=n>metadata</span><span class=p>,</span> <span class=n>f</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</span><span id=__span-0-251><a id=__codelineno-0-251 name=__codelineno-0-251></a>
</span><span id=__span-0-252><a id=__codelineno-0-252 name=__codelineno-0-252></a>    <span class=nb>print</span><span class=p>(</span><span class=n>tabulate</span><span class=p>(</span><span class=n>table</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>header</span><span class=p>,</span> <span class=n>tablefmt</span><span class=o>=</span><span class=s2>&quot;simple_grid&quot;</span><span class=p>))</span>
</span><span id=__span-0-253><a id=__codelineno-0-253 name=__codelineno-0-253></a>    <span class=k>if</span> <span class=n>dry_run</span><span class=p>:</span>
</span><span id=__span-0-254><a id=__codelineno-0-254 name=__codelineno-0-254></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Please verify, then repeat the command with --dry_run=False&quot;</span><span class=p>)</span>
</span><span id=__span-0-255><a id=__codelineno-0-255 name=__codelineno-0-255></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-256><a id=__codelineno-0-256 name=__codelineno-0-256></a>        <span class=k>for</span> <span class=n>path</span> <span class=ow>in</span> <span class=n>paths</span><span class=p>:</span>
</span><span id=__span-0-257><a id=__codelineno-0-257 name=__codelineno-0-257></a>            <span class=bp>self</span><span class=o>.</span><span class=n>upload</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>path</span><span class=p>))</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-function"> <h4 id=nearai.cli.assert_user_auth class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">assert_user_auth</span> <a href=#nearai.cli.assert_user_auth class=headerlink title="Permanent link">&para;</a></h4> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>assert_user_auth</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Ensure the user is authenticated.</p> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1192>1192</a></span>
<span class=normal><a href=#__codelineno-0-1193>1193</a></span>
<span class=normal><a href=#__codelineno-0-1194>1194</a></span>
<span class=normal><a href=#__codelineno-0-1195>1195</a></span>
<span class=normal><a href=#__codelineno-0-1196>1196</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1192><a id=__codelineno-0-1192 name=__codelineno-0-1192></a><span class=k>def</span><span class=w> </span><span class=nf>assert_user_auth</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-1193><a id=__codelineno-0-1193 name=__codelineno-0-1193></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Ensure the user is authenticated.&quot;&quot;&quot;</span>
</span><span id=__span-0-1194><a id=__codelineno-0-1194 name=__codelineno-0-1194></a>    <span class=k>if</span> <span class=n>CONFIG</span><span class=o>.</span><span class=n>auth</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-1195><a id=__codelineno-0-1195 name=__codelineno-0-1195></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Please login with `nearai login` first&quot;</span><span class=p>)</span>
</span><span id=__span-0-1196><a id=__codelineno-0-1196 name=__codelineno-0-1196></a>        <span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=nearai.cli.check_update class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">check_update</span> <a href=#nearai.cli.check_update class=headerlink title="Permanent link">&para;</a></h4> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>check_update</span><span class=p>()</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Check if there is a new version of nearai CLI available.</p> <details class=quote> <summary>Source code in <code>nearai/cli.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1177>1177</a></span>
<span class=normal><a href=#__codelineno-0-1178>1178</a></span>
<span class=normal><a href=#__codelineno-0-1179>1179</a></span>
<span class=normal><a href=#__codelineno-0-1180>1180</a></span>
<span class=normal><a href=#__codelineno-0-1181>1181</a></span>
<span class=normal><a href=#__codelineno-0-1182>1182</a></span>
<span class=normal><a href=#__codelineno-0-1183>1183</a></span>
<span class=normal><a href=#__codelineno-0-1184>1184</a></span>
<span class=normal><a href=#__codelineno-0-1185>1185</a></span>
<span class=normal><a href=#__codelineno-0-1186>1186</a></span>
<span class=normal><a href=#__codelineno-0-1187>1187</a></span>
<span class=normal><a href=#__codelineno-0-1188>1188</a></span>
<span class=normal><a href=#__codelineno-0-1189>1189</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1177><a id=__codelineno-0-1177 name=__codelineno-0-1177></a><span class=k>def</span><span class=w> </span><span class=nf>check_update</span><span class=p>():</span>
</span><span id=__span-0-1178><a id=__codelineno-0-1178 name=__codelineno-0-1178></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Check if there is a new version of nearai CLI available.&quot;&quot;&quot;</span>
</span><span id=__span-0-1179><a id=__codelineno-0-1179 name=__codelineno-0-1179></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-1180><a id=__codelineno-0-1180 name=__codelineno-0-1180></a>        <span class=n>api</span> <span class=o>=</span> <span class=n>DefaultApi</span><span class=p>()</span>
</span><span id=__span-0-1181><a id=__codelineno-0-1181 name=__codelineno-0-1181></a>        <span class=n>latest</span> <span class=o>=</span> <span class=n>api</span><span class=o>.</span><span class=n>version_v1_version_get</span><span class=p>()</span>
</span><span id=__span-0-1182><a id=__codelineno-0-1182 name=__codelineno-0-1182></a>        <span class=n>current</span> <span class=o>=</span> <span class=n>importlib</span><span class=o>.</span><span class=n>metadata</span><span class=o>.</span><span class=n>version</span><span class=p>(</span><span class=s2>&quot;nearai&quot;</span><span class=p>)</span>
</span><span id=__span-0-1183><a id=__codelineno-0-1183 name=__codelineno-0-1183></a>
</span><span id=__span-0-1184><a id=__codelineno-0-1184 name=__codelineno-0-1184></a>        <span class=k>if</span> <span class=n>latest</span> <span class=o>!=</span> <span class=n>current</span><span class=p>:</span>
</span><span id=__span-0-1185><a id=__codelineno-0-1185 name=__codelineno-0-1185></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;New version of nearai CLI available: </span><span class=si>{</span><span class=n>latest</span><span class=si>}</span><span class=s2>. Current version: </span><span class=si>{</span><span class=n>current</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-1186><a id=__codelineno-0-1186 name=__codelineno-0-1186></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Run `pip install --upgrade nearai` to update.&quot;</span><span class=p>)</span>
</span><span id=__span-0-1187><a id=__codelineno-0-1187 name=__codelineno-0-1187></a>
</span><span id=__span-0-1188><a id=__codelineno-0-1188 name=__codelineno-0-1188></a>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>_</span><span class=p>:</span>
</span><span id=__span-0-1189><a id=__codelineno-0-1189 name=__codelineno-0-1189></a>        <span class=k>pass</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-module"> <h3 id=nearai.cli_helpers class="doc doc-heading"> <span class="doc doc-object-name doc-module-name">cli_helpers</span> <a href=#nearai.cli_helpers class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h4 id=nearai.cli_helpers.display_agents_in_columns class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">display_agents_in_columns</span> <a href=#nearai.cli_helpers.display_agents_in_columns class=headerlink title="Permanent link">&para;</a></h4> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>display_agents_in_columns</span><span class=p>(</span><span class=n>agents</span><span class=p>:</span> <span class=n>list</span><span class=p>[</span><span class=n><span title=pathlib.Path>Path</span></span><span class=p>])</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Display agents in a rich table format.</p> <hr> <div class="language-text highlight"><pre><span></span><code>agents: List of Path objects pointing to agent locations (pre-sorted)
</code></pre></div> <details class=quote> <summary>Source code in <code>nearai/cli_helpers.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-8> 8</a></span>
<span class=normal><a href=#__codelineno-0-9> 9</a></span>
<span class=normal><a href=#__codelineno-0-10>10</a></span>
<span class=normal><a href=#__codelineno-0-11>11</a></span>
<span class=normal><a href=#__codelineno-0-12>12</a></span>
<span class=normal><a href=#__codelineno-0-13>13</a></span>
<span class=normal><a href=#__codelineno-0-14>14</a></span>
<span class=normal><a href=#__codelineno-0-15>15</a></span>
<span class=normal><a href=#__codelineno-0-16>16</a></span>
<span class=normal><a href=#__codelineno-0-17>17</a></span>
<span class=normal><a href=#__codelineno-0-18>18</a></span>
<span class=normal><a href=#__codelineno-0-19>19</a></span>
<span class=normal><a href=#__codelineno-0-20>20</a></span>
<span class=normal><a href=#__codelineno-0-21>21</a></span>
<span class=normal><a href=#__codelineno-0-22>22</a></span>
<span class=normal><a href=#__codelineno-0-23>23</a></span>
<span class=normal><a href=#__codelineno-0-24>24</a></span>
<span class=normal><a href=#__codelineno-0-25>25</a></span>
<span class=normal><a href=#__codelineno-0-26>26</a></span>
<span class=normal><a href=#__codelineno-0-27>27</a></span>
<span class=normal><a href=#__codelineno-0-28>28</a></span>
<span class=normal><a href=#__codelineno-0-29>29</a></span>
<span class=normal><a href=#__codelineno-0-30>30</a></span>
<span class=normal><a href=#__codelineno-0-31>31</a></span>
<span class=normal><a href=#__codelineno-0-32>32</a></span>
<span class=normal><a href=#__codelineno-0-33>33</a></span>
<span class=normal><a href=#__codelineno-0-34>34</a></span>
<span class=normal><a href=#__codelineno-0-35>35</a></span>
<span class=normal><a href=#__codelineno-0-36>36</a></span>
<span class=normal><a href=#__codelineno-0-37>37</a></span>
<span class=normal><a href=#__codelineno-0-38>38</a></span>
<span class=normal><a href=#__codelineno-0-39>39</a></span>
<span class=normal><a href=#__codelineno-0-40>40</a></span>
<span class=normal><a href=#__codelineno-0-41>41</a></span>
<span class=normal><a href=#__codelineno-0-42>42</a></span>
<span class=normal><a href=#__codelineno-0-43>43</a></span>
<span class=normal><a href=#__codelineno-0-44>44</a></span>
<span class=normal><a href=#__codelineno-0-45>45</a></span>
<span class=normal><a href=#__codelineno-0-46>46</a></span>
<span class=normal><a href=#__codelineno-0-47>47</a></span>
<span class=normal><a href=#__codelineno-0-48>48</a></span>
<span class=normal><a href=#__codelineno-0-49>49</a></span>
<span class=normal><a href=#__codelineno-0-50>50</a></span>
<span class=normal><a href=#__codelineno-0-51>51</a></span>
<span class=normal><a href=#__codelineno-0-52>52</a></span>
<span class=normal><a href=#__codelineno-0-53>53</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8></a><span class=k>def</span><span class=w> </span><span class=nf>display_agents_in_columns</span><span class=p>(</span><span class=n>agents</span><span class=p>:</span> <span class=nb>list</span><span class=p>[</span><span class=n>Path</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Display agents in a rich table format.</span>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10></a>
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11></a><span class=sd>    Args:</span>
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12></a><span class=sd>    ----</span>
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13></a><span class=sd>        agents: List of Path objects pointing to agent locations (pre-sorted)</span>
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14></a>
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-16><a id=__codelineno-0-16 name=__codelineno-0-16></a>    <span class=c1># Create table</span>
</span><span id=__span-0-17><a id=__codelineno-0-17 name=__codelineno-0-17></a>    <span class=n>table</span> <span class=o>=</span> <span class=n>Table</span><span class=p>(</span><span class=n>title</span><span class=o>=</span><span class=s2>&quot;Available Agents&quot;</span><span class=p>,</span> <span class=n>show_header</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>header_style</span><span class=o>=</span><span class=s2>&quot;bold&quot;</span><span class=p>,</span> <span class=n>show_lines</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>expand</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-18><a id=__codelineno-0-18 name=__codelineno-0-18></a>
</span><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19></a>    <span class=c1># Add columns</span>
</span><span id=__span-0-20><a id=__codelineno-0-20 name=__codelineno-0-20></a>    <span class=n>table</span><span class=o>.</span><span class=n>add_column</span><span class=p>(</span><span class=s2>&quot;#&quot;</span><span class=p>,</span> <span class=n>style</span><span class=o>=</span><span class=s2>&quot;bold&quot;</span><span class=p>,</span> <span class=n>width</span><span class=o>=</span><span class=mi>4</span><span class=p>)</span>
</span><span id=__span-0-21><a id=__codelineno-0-21 name=__codelineno-0-21></a>    <span class=n>table</span><span class=o>.</span><span class=n>add_column</span><span class=p>(</span><span class=s2>&quot;Namespace&quot;</span><span class=p>,</span> <span class=n>style</span><span class=o>=</span><span class=s2>&quot;blue&quot;</span><span class=p>)</span>
</span><span id=__span-0-22><a id=__codelineno-0-22 name=__codelineno-0-22></a>    <span class=n>table</span><span class=o>.</span><span class=n>add_column</span><span class=p>(</span><span class=s2>&quot;Agent Name&quot;</span><span class=p>,</span> <span class=n>style</span><span class=o>=</span><span class=s2>&quot;cyan&quot;</span><span class=p>)</span>
</span><span id=__span-0-23><a id=__codelineno-0-23 name=__codelineno-0-23></a>    <span class=n>table</span><span class=o>.</span><span class=n>add_column</span><span class=p>(</span><span class=s2>&quot;Version&quot;</span><span class=p>,</span> <span class=n>style</span><span class=o>=</span><span class=s2>&quot;green&quot;</span><span class=p>)</span>
</span><span id=__span-0-24><a id=__codelineno-0-24 name=__codelineno-0-24></a>    <span class=n>table</span><span class=o>.</span><span class=n>add_column</span><span class=p>(</span><span class=s2>&quot;Description&quot;</span><span class=p>,</span> <span class=n>style</span><span class=o>=</span><span class=s2>&quot;white&quot;</span><span class=p>)</span>
</span><span id=__span-0-25><a id=__codelineno-0-25 name=__codelineno-0-25></a>    <span class=n>table</span><span class=o>.</span><span class=n>add_column</span><span class=p>(</span><span class=s2>&quot;Tags&quot;</span><span class=p>,</span> <span class=n>style</span><span class=o>=</span><span class=s2>&quot;yellow&quot;</span><span class=p>)</span>
</span><span id=__span-0-26><a id=__codelineno-0-26 name=__codelineno-0-26></a>
</span><span id=__span-0-27><a id=__codelineno-0-27 name=__codelineno-0-27></a>    <span class=c1># Add rows</span>
</span><span id=__span-0-28><a id=__codelineno-0-28 name=__codelineno-0-28></a>    <span class=k>for</span> <span class=n>idx</span><span class=p>,</span> <span class=n>agent_path</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>agents</span><span class=p>,</span> <span class=mi>1</span><span class=p>):</span>
</span><span id=__span-0-29><a id=__codelineno-0-29 name=__codelineno-0-29></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-30><a id=__codelineno-0-30 name=__codelineno-0-30></a>            <span class=c1># Read metadata for additional info</span>
</span><span id=__span-0-31><a id=__codelineno-0-31 name=__codelineno-0-31></a>            <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>agent_path</span> <span class=o>/</span> <span class=s2>&quot;metadata.json&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-32><a id=__codelineno-0-32 name=__codelineno-0-32></a>                <span class=n>metadata</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>f</span><span class=p>)</span>
</span><span id=__span-0-33><a id=__codelineno-0-33 name=__codelineno-0-33></a>                <span class=n>description</span> <span class=o>=</span> <span class=n>metadata</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;description&quot;</span><span class=p>,</span> <span class=s2>&quot;No description&quot;</span><span class=p>)</span>
</span><span id=__span-0-34><a id=__codelineno-0-34 name=__codelineno-0-34></a>                <span class=n>tags</span> <span class=o>=</span> <span class=n>metadata</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;tags&quot;</span><span class=p>,</span> <span class=p>[])</span>
</span><span id=__span-0-35><a id=__codelineno-0-35 name=__codelineno-0-35></a>        <span class=k>except</span> <span class=p>(</span><span class=ne>FileNotFoundError</span><span class=p>,</span> <span class=n>json</span><span class=o>.</span><span class=n>JSONDecodeError</span><span class=p>):</span>
</span><span id=__span-0-36><a id=__codelineno-0-36 name=__codelineno-0-36></a>            <span class=n>description</span> <span class=o>=</span> <span class=s2>&quot;Unable to load metadata&quot;</span>
</span><span id=__span-0-37><a id=__codelineno-0-37 name=__codelineno-0-37></a>            <span class=n>tags</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-0-38><a id=__codelineno-0-38 name=__codelineno-0-38></a>
</span><span id=__span-0-39><a id=__codelineno-0-39 name=__codelineno-0-39></a>        <span class=c1># Add row to table with separated path components</span>
</span><span id=__span-0-40><a id=__codelineno-0-40 name=__codelineno-0-40></a>        <span class=n>table</span><span class=o>.</span><span class=n>add_row</span><span class=p>(</span>
</span><span id=__span-0-41><a id=__codelineno-0-41 name=__codelineno-0-41></a>            <span class=nb>str</span><span class=p>(</span><span class=n>idx</span><span class=p>),</span>
</span><span id=__span-0-42><a id=__codelineno-0-42 name=__codelineno-0-42></a>            <span class=n>agent_path</span><span class=o>.</span><span class=n>parts</span><span class=p>[</span><span class=o>-</span><span class=mi>3</span><span class=p>],</span>  <span class=c1># namespace</span>
</span><span id=__span-0-43><a id=__codelineno-0-43 name=__codelineno-0-43></a>            <span class=n>agent_path</span><span class=o>.</span><span class=n>parts</span><span class=p>[</span><span class=o>-</span><span class=mi>2</span><span class=p>],</span>  <span class=c1># agent name</span>
</span><span id=__span-0-44><a id=__codelineno-0-44 name=__codelineno-0-44></a>            <span class=n>agent_path</span><span class=o>.</span><span class=n>parts</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>],</span>  <span class=c1># version</span>
</span><span id=__span-0-45><a id=__codelineno-0-45 name=__codelineno-0-45></a>            <span class=n>description</span><span class=p>,</span>
</span><span id=__span-0-46><a id=__codelineno-0-46 name=__codelineno-0-46></a>            <span class=s2>&quot;, &quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>tags</span><span class=p>)</span> <span class=k>if</span> <span class=n>tags</span> <span class=k>else</span> <span class=s2>&quot;—&quot;</span><span class=p>,</span>
</span><span id=__span-0-47><a id=__codelineno-0-47 name=__codelineno-0-47></a>        <span class=p>)</span>
</span><span id=__span-0-48><a id=__codelineno-0-48 name=__codelineno-0-48></a>
</span><span id=__span-0-49><a id=__codelineno-0-49 name=__codelineno-0-49></a>    <span class=c1># Display table</span>
</span><span id=__span-0-50><a id=__codelineno-0-50 name=__codelineno-0-50></a>    <span class=n>console</span> <span class=o>=</span> <span class=n>Console</span><span class=p>()</span>
</span><span id=__span-0-51><a id=__codelineno-0-51 name=__codelineno-0-51></a>    <span class=n>console</span><span class=o>.</span><span class=n>print</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-52><a id=__codelineno-0-52 name=__codelineno-0-52></a>    <span class=n>console</span><span class=o>.</span><span class=n>print</span><span class=p>(</span><span class=n>table</span><span class=p>)</span>
</span><span id=__span-0-53><a id=__codelineno-0-53 name=__codelineno-0-53></a>    <span class=n>console</span><span class=o>.</span><span class=n>print</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-module"> <h3 id=nearai.config class="doc doc-heading"> <span class="doc doc-object-name doc-module-name">config</span> <a href=#nearai.config class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h4 id=nearai.config.Config class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">Config</span> <a href=#nearai.config.Config class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=pydantic.BaseModel>BaseModel</span></code></p> <details class=quote> <summary>Source code in <code>nearai/config.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-89> 89</a></span>
<span class=normal><a href=#__codelineno-0-90> 90</a></span>
<span class=normal><a href=#__codelineno-0-91> 91</a></span>
<span class=normal><a href=#__codelineno-0-92> 92</a></span>
<span class=normal><a href=#__codelineno-0-93> 93</a></span>
<span class=normal><a href=#__codelineno-0-94> 94</a></span>
<span class=normal><a href=#__codelineno-0-95> 95</a></span>
<span class=normal><a href=#__codelineno-0-96> 96</a></span>
<span class=normal><a href=#__codelineno-0-97> 97</a></span>
<span class=normal><a href=#__codelineno-0-98> 98</a></span>
<span class=normal><a href=#__codelineno-0-99> 99</a></span>
<span class=normal><a href=#__codelineno-0-100>100</a></span>
<span class=normal><a href=#__codelineno-0-101>101</a></span>
<span class=normal><a href=#__codelineno-0-102>102</a></span>
<span class=normal><a href=#__codelineno-0-103>103</a></span>
<span class=normal><a href=#__codelineno-0-104>104</a></span>
<span class=normal><a href=#__codelineno-0-105>105</a></span>
<span class=normal><a href=#__codelineno-0-106>106</a></span>
<span class=normal><a href=#__codelineno-0-107>107</a></span>
<span class=normal><a href=#__codelineno-0-108>108</a></span>
<span class=normal><a href=#__codelineno-0-109>109</a></span>
<span class=normal><a href=#__codelineno-0-110>110</a></span>
<span class=normal><a href=#__codelineno-0-111>111</a></span>
<span class=normal><a href=#__codelineno-0-112>112</a></span>
<span class=normal><a href=#__codelineno-0-113>113</a></span>
<span class=normal><a href=#__codelineno-0-114>114</a></span>
<span class=normal><a href=#__codelineno-0-115>115</a></span>
<span class=normal><a href=#__codelineno-0-116>116</a></span>
<span class=normal><a href=#__codelineno-0-117>117</a></span>
<span class=normal><a href=#__codelineno-0-118>118</a></span>
<span class=normal><a href=#__codelineno-0-119>119</a></span>
<span class=normal><a href=#__codelineno-0-120>120</a></span>
<span class=normal><a href=#__codelineno-0-121>121</a></span>
<span class=normal><a href=#__codelineno-0-122>122</a></span>
<span class=normal><a href=#__codelineno-0-123>123</a></span>
<span class=normal><a href=#__codelineno-0-124>124</a></span>
<span class=normal><a href=#__codelineno-0-125>125</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-89><a id=__codelineno-0-89 name=__codelineno-0-89></a><span class=k>class</span><span class=w> </span><span class=nc>Config</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span><span id=__span-0-90><a id=__codelineno-0-90 name=__codelineno-0-90></a>    <span class=n>origin</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-91><a id=__codelineno-0-91 name=__codelineno-0-91></a>    <span class=n>api_url</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;https://api.near.ai&quot;</span>
</span><span id=__span-0-92><a id=__codelineno-0-92 name=__codelineno-0-92></a>    <span class=n>inference_url</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;http://localhost:5000/v1/&quot;</span>
</span><span id=__span-0-93><a id=__codelineno-0-93 name=__codelineno-0-93></a>    <span class=n>inference_api_key</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;n/a&quot;</span>
</span><span id=__span-0-94><a id=__codelineno-0-94 name=__codelineno-0-94></a>    <span class=n>scheduler_account_id</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;nearaischeduler.near&quot;</span>
</span><span id=__span-0-95><a id=__codelineno-0-95 name=__codelineno-0-95></a>    <span class=n>nearai_hub</span><span class=p>:</span> <span class=n>NearAiHubConfig</span> <span class=o>=</span> <span class=n>NearAiHubConfig</span><span class=p>()</span>
</span><span id=__span-0-96><a id=__codelineno-0-96 name=__codelineno-0-96></a>    <span class=n>confirm_commands</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span>
</span><span id=__span-0-97><a id=__codelineno-0-97 name=__codelineno-0-97></a>    <span class=n>auth</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>AuthData</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-98><a id=__codelineno-0-98 name=__codelineno-0-98></a>    <span class=n>num_inference_retries</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>1</span>
</span><span id=__span-0-99><a id=__codelineno-0-99 name=__codelineno-0-99></a>
</span><span id=__span-0-100><a id=__codelineno-0-100 name=__codelineno-0-100></a>    <span class=k>def</span><span class=w> </span><span class=nf>update_with</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>extra_config</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=n>map_key</span><span class=p>:</span> <span class=n>Callable</span><span class=p>[[</span><span class=nb>str</span><span class=p>],</span> <span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=s2>&quot;Config&quot;</span><span class=p>:</span>
</span><span id=__span-0-101><a id=__codelineno-0-101 name=__codelineno-0-101></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Update the config with the given dictionary.&quot;&quot;&quot;</span>
</span><span id=__span-0-102><a id=__codelineno-0-102 name=__codelineno-0-102></a>        <span class=n>dict_repr</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>model_dump</span><span class=p>()</span>
</span><span id=__span-0-103><a id=__codelineno-0-103 name=__codelineno-0-103></a>        <span class=n>keys</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=nb>map</span><span class=p>(</span><span class=n>map_key</span><span class=p>,</span> <span class=n>dict_repr</span><span class=o>.</span><span class=n>keys</span><span class=p>()))</span>
</span><span id=__span-0-104><a id=__codelineno-0-104 name=__codelineno-0-104></a>
</span><span id=__span-0-105><a id=__codelineno-0-105 name=__codelineno-0-105></a>        <span class=k>for</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>keys</span><span class=p>:</span>
</span><span id=__span-0-106><a id=__codelineno-0-106 name=__codelineno-0-106></a>            <span class=n>value</span> <span class=o>=</span> <span class=n>extra_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
</span><span id=__span-0-107><a id=__codelineno-0-107 name=__codelineno-0-107></a>
</span><span id=__span-0-108><a id=__codelineno-0-108 name=__codelineno-0-108></a>            <span class=k>if</span> <span class=n>value</span><span class=p>:</span>
</span><span id=__span-0-109><a id=__codelineno-0-109 name=__codelineno-0-109></a>                <span class=c1># This will skip empty values, even if they are set in the `extra_config`</span>
</span><span id=__span-0-110><a id=__codelineno-0-110 name=__codelineno-0-110></a>                <span class=n>dict_repr</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=n>value</span>
</span><span id=__span-0-111><a id=__codelineno-0-111 name=__codelineno-0-111></a>
</span><span id=__span-0-112><a id=__codelineno-0-112 name=__codelineno-0-112></a>        <span class=k>return</span> <span class=n>Config</span><span class=o>.</span><span class=n>model_validate</span><span class=p>(</span><span class=n>dict_repr</span><span class=p>)</span>
</span><span id=__span-0-113><a id=__codelineno-0-113 name=__codelineno-0-113></a>
</span><span id=__span-0-114><a id=__codelineno-0-114 name=__codelineno-0-114></a>    <span class=k>def</span><span class=w> </span><span class=nf>get</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>default</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Any</span><span class=p>]:</span>
</span><span id=__span-0-115><a id=__codelineno-0-115 name=__codelineno-0-115></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Get the value of a key in the config if it exists.&quot;&quot;&quot;</span>
</span><span id=__span-0-116><a id=__codelineno-0-116 name=__codelineno-0-116></a>        <span class=k>return</span> <span class=nb>getattr</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>default</span><span class=p>)</span>
</span><span id=__span-0-117><a id=__codelineno-0-117 name=__codelineno-0-117></a>
</span><span id=__span-0-118><a id=__codelineno-0-118 name=__codelineno-0-118></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_client_config</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>ClientConfig</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-119><a id=__codelineno-0-119 name=__codelineno-0-119></a>        <span class=k>return</span> <span class=n>ClientConfig</span><span class=p>(</span>
</span><span id=__span-0-120><a id=__codelineno-0-120 name=__codelineno-0-120></a>            <span class=n>base_url</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>nearai_hub</span><span class=o>.</span><span class=n>base_url</span><span class=p>,</span>
</span><span id=__span-0-121><a id=__codelineno-0-121 name=__codelineno-0-121></a>            <span class=n>auth</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>auth</span><span class=p>,</span>
</span><span id=__span-0-122><a id=__codelineno-0-122 name=__codelineno-0-122></a>            <span class=n>custom_llm_provider</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>nearai_hub</span><span class=o>.</span><span class=n>custom_llm_provider</span><span class=p>,</span>
</span><span id=__span-0-123><a id=__codelineno-0-123 name=__codelineno-0-123></a>            <span class=n>default_provider</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>nearai_hub</span><span class=o>.</span><span class=n>default_provider</span><span class=p>,</span>
</span><span id=__span-0-124><a id=__codelineno-0-124 name=__codelineno-0-124></a>            <span class=n>num_inference_retries</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>num_inference_retries</span><span class=p>,</span>
</span><span id=__span-0-125><a id=__codelineno-0-125 name=__codelineno-0-125></a>        <span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h5 id=nearai.config.Config.get class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get</span> <a href=#nearai.config.Config.get class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>get</span><span class=p>(</span><span class=n>key</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>default</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n><span title=typing.Any>Any</span></span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n><span title=typing.Any>Any</span></span><span class=p>]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Get the value of a key in the config if it exists.</p> <details class=quote> <summary>Source code in <code>nearai/config.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-114>114</a></span>
<span class=normal><a href=#__codelineno-0-115>115</a></span>
<span class=normal><a href=#__codelineno-0-116>116</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-114><a id=__codelineno-0-114 name=__codelineno-0-114></a><span class=k>def</span><span class=w> </span><span class=nf>get</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>default</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Any</span><span class=p>]:</span>
</span><span id=__span-0-115><a id=__codelineno-0-115 name=__codelineno-0-115></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Get the value of a key in the config if it exists.&quot;&quot;&quot;</span>
</span><span id=__span-0-116><a id=__codelineno-0-116 name=__codelineno-0-116></a>    <span class=k>return</span> <span class=nb>getattr</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>default</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.config.Config.update_with class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">update_with</span> <a href=#nearai.config.Config.update_with class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>update_with</span><span class=p>(</span><span class=n>extra_config</span><span class=p>:</span> <span class=n><span title=typing.Dict>Dict</span></span><span class=p>[</span><span class=n>str</span><span class=p>,</span> <span class=n><span title=typing.Any>Any</span></span><span class=p>],</span> <span class=n>map_key</span><span class=p>:</span> <span class=n><span title=typing.Callable>Callable</span></span><span class=p>[[</span><span class=n>str</span><span class=p>],</span> <span class=n>str</span><span class=p>]</span> <span class=o>=</span> <span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><a class="autorefs autorefs-internal" title=nearai.config.Config href=#nearai.config.Config>Config</a></span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Update the config with the given dictionary.</p> <details class=quote> <summary>Source code in <code>nearai/config.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-100>100</a></span>
<span class=normal><a href=#__codelineno-0-101>101</a></span>
<span class=normal><a href=#__codelineno-0-102>102</a></span>
<span class=normal><a href=#__codelineno-0-103>103</a></span>
<span class=normal><a href=#__codelineno-0-104>104</a></span>
<span class=normal><a href=#__codelineno-0-105>105</a></span>
<span class=normal><a href=#__codelineno-0-106>106</a></span>
<span class=normal><a href=#__codelineno-0-107>107</a></span>
<span class=normal><a href=#__codelineno-0-108>108</a></span>
<span class=normal><a href=#__codelineno-0-109>109</a></span>
<span class=normal><a href=#__codelineno-0-110>110</a></span>
<span class=normal><a href=#__codelineno-0-111>111</a></span>
<span class=normal><a href=#__codelineno-0-112>112</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-100><a id=__codelineno-0-100 name=__codelineno-0-100></a><span class=k>def</span><span class=w> </span><span class=nf>update_with</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>extra_config</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=n>map_key</span><span class=p>:</span> <span class=n>Callable</span><span class=p>[[</span><span class=nb>str</span><span class=p>],</span> <span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=s2>&quot;Config&quot;</span><span class=p>:</span>
</span><span id=__span-0-101><a id=__codelineno-0-101 name=__codelineno-0-101></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Update the config with the given dictionary.&quot;&quot;&quot;</span>
</span><span id=__span-0-102><a id=__codelineno-0-102 name=__codelineno-0-102></a>    <span class=n>dict_repr</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>model_dump</span><span class=p>()</span>
</span><span id=__span-0-103><a id=__codelineno-0-103 name=__codelineno-0-103></a>    <span class=n>keys</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=nb>map</span><span class=p>(</span><span class=n>map_key</span><span class=p>,</span> <span class=n>dict_repr</span><span class=o>.</span><span class=n>keys</span><span class=p>()))</span>
</span><span id=__span-0-104><a id=__codelineno-0-104 name=__codelineno-0-104></a>
</span><span id=__span-0-105><a id=__codelineno-0-105 name=__codelineno-0-105></a>    <span class=k>for</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>keys</span><span class=p>:</span>
</span><span id=__span-0-106><a id=__codelineno-0-106 name=__codelineno-0-106></a>        <span class=n>value</span> <span class=o>=</span> <span class=n>extra_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
</span><span id=__span-0-107><a id=__codelineno-0-107 name=__codelineno-0-107></a>
</span><span id=__span-0-108><a id=__codelineno-0-108 name=__codelineno-0-108></a>        <span class=k>if</span> <span class=n>value</span><span class=p>:</span>
</span><span id=__span-0-109><a id=__codelineno-0-109 name=__codelineno-0-109></a>            <span class=c1># This will skip empty values, even if they are set in the `extra_config`</span>
</span><span id=__span-0-110><a id=__codelineno-0-110 name=__codelineno-0-110></a>            <span class=n>dict_repr</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=n>value</span>
</span><span id=__span-0-111><a id=__codelineno-0-111 name=__codelineno-0-111></a>
</span><span id=__span-0-112><a id=__codelineno-0-112 name=__codelineno-0-112></a>    <span class=k>return</span> <span class=n>Config</span><span class=o>.</span><span class=n>model_validate</span><span class=p>(</span><span class=n>dict_repr</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h4 id=nearai.config.NearAiHubConfig class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">NearAiHubConfig</span> <a href=#nearai.config.NearAiHubConfig class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=pydantic.BaseModel>BaseModel</span></code></p> <p>NearAiHub Config.</p> <p>login_with_near (Optional[bool]): Indicates whether to attempt login using Near Auth.</p> <p>api_key (Optional[str]): The API key to use if Near Auth is not being utilized</p> <p>base_url (Optional[str]): NEAR AI Hub url</p> <p>default_provider (Optional[str]): Default provider name</p> <p>default_model (Optional[str]): Default model name</p> <p>custom_llm_provider (Optional[str]): provider to be used by litellm proxy</p> <details class=quote> <summary>Source code in <code>nearai/config.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-65>65</a></span>
<span class=normal><a href=#__codelineno-0-66>66</a></span>
<span class=normal><a href=#__codelineno-0-67>67</a></span>
<span class=normal><a href=#__codelineno-0-68>68</a></span>
<span class=normal><a href=#__codelineno-0-69>69</a></span>
<span class=normal><a href=#__codelineno-0-70>70</a></span>
<span class=normal><a href=#__codelineno-0-71>71</a></span>
<span class=normal><a href=#__codelineno-0-72>72</a></span>
<span class=normal><a href=#__codelineno-0-73>73</a></span>
<span class=normal><a href=#__codelineno-0-74>74</a></span>
<span class=normal><a href=#__codelineno-0-75>75</a></span>
<span class=normal><a href=#__codelineno-0-76>76</a></span>
<span class=normal><a href=#__codelineno-0-77>77</a></span>
<span class=normal><a href=#__codelineno-0-78>78</a></span>
<span class=normal><a href=#__codelineno-0-79>79</a></span>
<span class=normal><a href=#__codelineno-0-80>80</a></span>
<span class=normal><a href=#__codelineno-0-81>81</a></span>
<span class=normal><a href=#__codelineno-0-82>82</a></span>
<span class=normal><a href=#__codelineno-0-83>83</a></span>
<span class=normal><a href=#__codelineno-0-84>84</a></span>
<span class=normal><a href=#__codelineno-0-85>85</a></span>
<span class=normal><a href=#__codelineno-0-86>86</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-65><a id=__codelineno-0-65 name=__codelineno-0-65></a><span class=k>class</span><span class=w> </span><span class=nc>NearAiHubConfig</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span><span id=__span-0-66><a id=__codelineno-0-66 name=__codelineno-0-66></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;NearAiHub Config.</span>
</span><span id=__span-0-67><a id=__codelineno-0-67 name=__codelineno-0-67></a>
</span><span id=__span-0-68><a id=__codelineno-0-68 name=__codelineno-0-68></a><span class=sd>    login_with_near (Optional[bool]): Indicates whether to attempt login using Near Auth.</span>
</span><span id=__span-0-69><a id=__codelineno-0-69 name=__codelineno-0-69></a>
</span><span id=__span-0-70><a id=__codelineno-0-70 name=__codelineno-0-70></a><span class=sd>    api_key (Optional[str]): The API key to use if Near Auth is not being utilized</span>
</span><span id=__span-0-71><a id=__codelineno-0-71 name=__codelineno-0-71></a>
</span><span id=__span-0-72><a id=__codelineno-0-72 name=__codelineno-0-72></a><span class=sd>    base_url (Optional[str]): NEAR AI Hub url</span>
</span><span id=__span-0-73><a id=__codelineno-0-73 name=__codelineno-0-73></a>
</span><span id=__span-0-74><a id=__codelineno-0-74 name=__codelineno-0-74></a><span class=sd>    default_provider (Optional[str]): Default provider name</span>
</span><span id=__span-0-75><a id=__codelineno-0-75 name=__codelineno-0-75></a>
</span><span id=__span-0-76><a id=__codelineno-0-76 name=__codelineno-0-76></a><span class=sd>    default_model (Optional[str]): Default model name</span>
</span><span id=__span-0-77><a id=__codelineno-0-77 name=__codelineno-0-77></a>
</span><span id=__span-0-78><a id=__codelineno-0-78 name=__codelineno-0-78></a><span class=sd>    custom_llm_provider (Optional[str]): provider to be used by litellm proxy</span>
</span><span id=__span-0-79><a id=__codelineno-0-79 name=__codelineno-0-79></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-80><a id=__codelineno-0-80 name=__codelineno-0-80></a>
</span><span id=__span-0-81><a id=__codelineno-0-81 name=__codelineno-0-81></a>    <span class=n>base_url</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;https://api.near.ai/v1&quot;</span>
</span><span id=__span-0-82><a id=__codelineno-0-82 name=__codelineno-0-82></a>    <span class=n>default_provider</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>DEFAULT_PROVIDER</span>
</span><span id=__span-0-83><a id=__codelineno-0-83 name=__codelineno-0-83></a>    <span class=n>default_model</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>DEFAULT_PROVIDER_MODEL</span>
</span><span id=__span-0-84><a id=__codelineno-0-84 name=__codelineno-0-84></a>    <span class=n>custom_llm_provider</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;openai&quot;</span>
</span><span id=__span-0-85><a id=__codelineno-0-85 name=__codelineno-0-85></a>    <span class=n>login_with_near</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>bool</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>
</span><span id=__span-0-86><a id=__codelineno-0-86 name=__codelineno-0-86></a>    <span class=n>api_key</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> </div> </div> </div> <div class="doc doc-object doc-module"> <h3 id=nearai.dataset class="doc doc-heading"> <span class="doc doc-object-name doc-module-name">dataset</span> <a href=#nearai.dataset class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h4 id=nearai.dataset.get_dataset class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_dataset</span> <a href=#nearai.dataset.get_dataset class=headerlink title="Permanent link">&para;</a></h4> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>get_dataset</span><span class=p>(</span><span class=n>name</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>verbose</span><span class=p>:</span> <span class=n>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=pathlib.Path>Path</span></span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Download the dataset from the registry and download it locally if it hasn't been downloaded yet.</p> <p>:param name: The name of the entry to download the dataset. The format should be namespace/name/version. :return: The path to the downloaded dataset</p> <details class=quote> <summary>Source code in <code>nearai/dataset.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-9> 9</a></span>
<span class=normal><a href=#__codelineno-0-10>10</a></span>
<span class=normal><a href=#__codelineno-0-11>11</a></span>
<span class=normal><a href=#__codelineno-0-12>12</a></span>
<span class=normal><a href=#__codelineno-0-13>13</a></span>
<span class=normal><a href=#__codelineno-0-14>14</a></span>
<span class=normal><a href=#__codelineno-0-15>15</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9></a><span class=k>def</span><span class=w> </span><span class=nf>get_dataset</span><span class=p>(</span><span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>verbose</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Path</span><span class=p>:</span>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Download the dataset from the registry and download it locally if it hasn&#39;t been downloaded yet.</span>
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11></a>
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12></a><span class=sd>    :param name: The name of the entry to download the dataset. The format should be namespace/name/version.</span>
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13></a><span class=sd>    :return: The path to the downloaded dataset</span>
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15></a>    <span class=k>return</span> <span class=n>registry</span><span class=o>.</span><span class=n>download</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>verbose</span><span class=o>=</span><span class=n>verbose</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=nearai.dataset.load_dataset class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">load_dataset</span> <a href=#nearai.dataset.load_dataset class=headerlink title="Permanent link">&para;</a></h4> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>load_dataset</span><span class=p>(</span><span class=n>alias_or_name</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>verbose</span><span class=p>:</span> <span class=n>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=typing.Union>Union</span></span><span class=p>[</span><span class=n><span title=datasets.Dataset>Dataset</span></span><span class=p>,</span> <span class=n><span title=datasets.DatasetDict>DatasetDict</span></span><span class=p>]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Load a dataset from the registry.</p> <details class=quote> <summary>Source code in <code>nearai/dataset.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-18>18</a></span>
<span class=normal><a href=#__codelineno-0-19>19</a></span>
<span class=normal><a href=#__codelineno-0-20>20</a></span>
<span class=normal><a href=#__codelineno-0-21>21</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-18><a id=__codelineno-0-18 name=__codelineno-0-18></a><span class=k>def</span><span class=w> </span><span class=nf>load_dataset</span><span class=p>(</span><span class=n>alias_or_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>verbose</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span><span class=n>Dataset</span><span class=p>,</span> <span class=n>DatasetDict</span><span class=p>]:</span>
</span><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Load a dataset from the registry.&quot;&quot;&quot;</span>
</span><span id=__span-0-20><a id=__codelineno-0-20 name=__codelineno-0-20></a>    <span class=n>path</span> <span class=o>=</span> <span class=n>get_dataset</span><span class=p>(</span><span class=n>alias_or_name</span><span class=p>,</span> <span class=n>verbose</span><span class=o>=</span><span class=n>verbose</span><span class=p>)</span>
</span><span id=__span-0-21><a id=__codelineno-0-21 name=__codelineno-0-21></a>    <span class=k>return</span> <span class=n>load_from_disk</span><span class=p>(</span><span class=n>path</span><span class=o>.</span><span class=n>as_posix</span><span class=p>())</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-module"> <h3 id=nearai.delegation class="doc doc-heading"> <span class="doc doc-object-name doc-module-name">delegation</span> <a href=#nearai.delegation class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h4 id=nearai.delegation.OnBehalfOf class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">OnBehalfOf</span> <a href=#nearai.delegation.OnBehalfOf class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p>Create a context manager that allows you to delegate actions to another account.</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=k>with</span> <span class=n>OnBehalfOf</span><span class=p>(</span><span class=s2>&quot;scheduler.ai&quot;</span><span class=p>):</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>    <span class=c1># Upload is done on behalf of scheduler.ai</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>    <span class=c1># If delegation permission is not granted, this will raise an exception</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>    <span class=n>registry</span><span class=o>.</span><span class=n>upload</span><span class=p>()</span>
</span></code></pre></div> <details class=quote> <summary>Source code in <code>nearai/delegation.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-9> 9</a></span>
<span class=normal><a href=#__codelineno-0-10>10</a></span>
<span class=normal><a href=#__codelineno-0-11>11</a></span>
<span class=normal><a href=#__codelineno-0-12>12</a></span>
<span class=normal><a href=#__codelineno-0-13>13</a></span>
<span class=normal><a href=#__codelineno-0-14>14</a></span>
<span class=normal><a href=#__codelineno-0-15>15</a></span>
<span class=normal><a href=#__codelineno-0-16>16</a></span>
<span class=normal><a href=#__codelineno-0-17>17</a></span>
<span class=normal><a href=#__codelineno-0-18>18</a></span>
<span class=normal><a href=#__codelineno-0-19>19</a></span>
<span class=normal><a href=#__codelineno-0-20>20</a></span>
<span class=normal><a href=#__codelineno-0-21>21</a></span>
<span class=normal><a href=#__codelineno-0-22>22</a></span>
<span class=normal><a href=#__codelineno-0-23>23</a></span>
<span class=normal><a href=#__codelineno-0-24>24</a></span>
<span class=normal><a href=#__codelineno-0-25>25</a></span>
<span class=normal><a href=#__codelineno-0-26>26</a></span>
<span class=normal><a href=#__codelineno-0-27>27</a></span>
<span class=normal><a href=#__codelineno-0-28>28</a></span>
<span class=normal><a href=#__codelineno-0-29>29</a></span>
<span class=normal><a href=#__codelineno-0-30>30</a></span>
<span class=normal><a href=#__codelineno-0-31>31</a></span>
<span class=normal><a href=#__codelineno-0-32>32</a></span>
<span class=normal><a href=#__codelineno-0-33>33</a></span>
<span class=normal><a href=#__codelineno-0-34>34</a></span>
<span class=normal><a href=#__codelineno-0-35>35</a></span>
<span class=normal><a href=#__codelineno-0-36>36</a></span>
<span class=normal><a href=#__codelineno-0-37>37</a></span>
<span class=normal><a href=#__codelineno-0-38>38</a></span>
<span class=normal><a href=#__codelineno-0-39>39</a></span>
<span class=normal><a href=#__codelineno-0-40>40</a></span>
<span class=normal><a href=#__codelineno-0-41>41</a></span>
<span class=normal><a href=#__codelineno-0-42>42</a></span>
<span class=normal><a href=#__codelineno-0-43>43</a></span>
<span class=normal><a href=#__codelineno-0-44>44</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9></a><span class=k>class</span><span class=w> </span><span class=nc>OnBehalfOf</span><span class=p>:</span>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Create a context manager that allows you to delegate actions to another account.</span>
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11></a>
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12></a><span class=sd>    ```python</span>
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13></a><span class=sd>    with OnBehalfOf(&quot;scheduler.ai&quot;):</span>
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14></a><span class=sd>        # Upload is done on behalf of scheduler.ai</span>
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15></a><span class=sd>        # If delegation permission is not granted, this will raise an exception</span>
</span><span id=__span-0-16><a id=__codelineno-0-16 name=__codelineno-0-16></a><span class=sd>        registry.upload()</span>
</span><span id=__span-0-17><a id=__codelineno-0-17 name=__codelineno-0-17></a><span class=sd>    ```</span>
</span><span id=__span-0-18><a id=__codelineno-0-18 name=__codelineno-0-18></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19></a>
</span><span id=__span-0-20><a id=__codelineno-0-20 name=__codelineno-0-20></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>on_behalf_of</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-21><a id=__codelineno-0-21 name=__codelineno-0-21></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Context manager that creates a scope where all actions are done on behalf of another account.&quot;&quot;&quot;</span>
</span><span id=__span-0-22><a id=__codelineno-0-22 name=__codelineno-0-22></a>        <span class=bp>self</span><span class=o>.</span><span class=n>target_on_behalf_of</span> <span class=o>=</span> <span class=n>on_behalf_of</span>
</span><span id=__span-0-23><a id=__codelineno-0-23 name=__codelineno-0-23></a>        <span class=bp>self</span><span class=o>.</span><span class=n>original_access_token</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-24><a id=__codelineno-0-24 name=__codelineno-0-24></a>
</span><span id=__span-0-25><a id=__codelineno-0-25 name=__codelineno-0-25></a>    <span class=k>def</span><span class=w> </span><span class=fm>__enter__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-0-26><a id=__codelineno-0-26 name=__codelineno-0-26></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Set the default client to the account we are acting on behalf of.&quot;&quot;&quot;</span>
</span><span id=__span-0-27><a id=__codelineno-0-27 name=__codelineno-0-27></a>        <span class=n>default_client</span> <span class=o>=</span> <span class=n>ApiClient</span><span class=o>.</span><span class=n>get_default</span><span class=p>()</span>
</span><span id=__span-0-28><a id=__codelineno-0-28 name=__codelineno-0-28></a>        <span class=bp>self</span><span class=o>.</span><span class=n>original_access_token</span> <span class=o>=</span> <span class=n>default_client</span><span class=o>.</span><span class=n>configuration</span><span class=o>.</span><span class=n>access_token</span>
</span><span id=__span-0-29><a id=__codelineno-0-29 name=__codelineno-0-29></a>
</span><span id=__span-0-30><a id=__codelineno-0-30 name=__codelineno-0-30></a>        <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>original_access_token</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-31><a id=__codelineno-0-31 name=__codelineno-0-31></a>            <span class=k>return</span>
</span><span id=__span-0-32><a id=__codelineno-0-32 name=__codelineno-0-32></a>
</span><span id=__span-0-33><a id=__codelineno-0-33 name=__codelineno-0-33></a>        <span class=k>assert</span> <span class=bp>self</span><span class=o>.</span><span class=n>original_access_token</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&quot;Bearer &quot;</span><span class=p>)</span>
</span><span id=__span-0-34><a id=__codelineno-0-34 name=__codelineno-0-34></a>        <span class=n>auth</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>original_access_token</span><span class=p>[</span><span class=nb>len</span><span class=p>(</span><span class=s2>&quot;Bearer &quot;</span><span class=p>)</span> <span class=p>:]</span>
</span><span id=__span-0-35><a id=__codelineno-0-35 name=__codelineno-0-35></a>        <span class=n>auth_data</span> <span class=o>=</span> <span class=n>AuthData</span><span class=o>.</span><span class=n>model_validate_json</span><span class=p>(</span><span class=n>auth</span><span class=p>)</span>
</span><span id=__span-0-36><a id=__codelineno-0-36 name=__codelineno-0-36></a>        <span class=n>auth_data</span><span class=o>.</span><span class=n>on_behalf_of</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>target_on_behalf_of</span>
</span><span id=__span-0-37><a id=__codelineno-0-37 name=__codelineno-0-37></a>        <span class=n>new_access_token</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;Bearer </span><span class=si>{</span><span class=n>auth_data</span><span class=o>.</span><span class=n>generate_bearer_token</span><span class=p>()</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-38><a id=__codelineno-0-38 name=__codelineno-0-38></a>        <span class=n>default_client</span><span class=o>.</span><span class=n>configuration</span><span class=o>.</span><span class=n>access_token</span> <span class=o>=</span> <span class=n>new_access_token</span>
</span><span id=__span-0-39><a id=__codelineno-0-39 name=__codelineno-0-39></a>
</span><span id=__span-0-40><a id=__codelineno-0-40 name=__codelineno-0-40></a>    <span class=k>def</span><span class=w> </span><span class=fm>__exit__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>exc_type</span><span class=p>,</span> <span class=n>exc_val</span><span class=p>,</span> <span class=n>exc_tb</span><span class=p>):</span>
</span><span id=__span-0-41><a id=__codelineno-0-41 name=__codelineno-0-41></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Reset the default client to the original account.&quot;&quot;&quot;</span>
</span><span id=__span-0-42><a id=__codelineno-0-42 name=__codelineno-0-42></a>        <span class=n>default_client</span> <span class=o>=</span> <span class=n>ApiClient</span><span class=o>.</span><span class=n>get_default</span><span class=p>()</span>
</span><span id=__span-0-43><a id=__codelineno-0-43 name=__codelineno-0-43></a>        <span class=n>default_client</span><span class=o>.</span><span class=n>configuration</span><span class=o>.</span><span class=n>access_token</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>original_access_token</span>
</span><span id=__span-0-44><a id=__codelineno-0-44 name=__codelineno-0-44></a>        <span class=bp>self</span><span class=o>.</span><span class=n>original_access_token</span> <span class=o>=</span> <span class=kc>None</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h5 id=nearai.delegation.OnBehalfOf.__enter__ class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">__enter__</span> <a href=#nearai.delegation.OnBehalfOf.__enter__ class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=fm>__enter__</span><span class=p>()</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Set the default client to the account we are acting on behalf of.</p> <details class=quote> <summary>Source code in <code>nearai/delegation.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-25>25</a></span>
<span class=normal><a href=#__codelineno-0-26>26</a></span>
<span class=normal><a href=#__codelineno-0-27>27</a></span>
<span class=normal><a href=#__codelineno-0-28>28</a></span>
<span class=normal><a href=#__codelineno-0-29>29</a></span>
<span class=normal><a href=#__codelineno-0-30>30</a></span>
<span class=normal><a href=#__codelineno-0-31>31</a></span>
<span class=normal><a href=#__codelineno-0-32>32</a></span>
<span class=normal><a href=#__codelineno-0-33>33</a></span>
<span class=normal><a href=#__codelineno-0-34>34</a></span>
<span class=normal><a href=#__codelineno-0-35>35</a></span>
<span class=normal><a href=#__codelineno-0-36>36</a></span>
<span class=normal><a href=#__codelineno-0-37>37</a></span>
<span class=normal><a href=#__codelineno-0-38>38</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-25><a id=__codelineno-0-25 name=__codelineno-0-25></a><span class=k>def</span><span class=w> </span><span class=fm>__enter__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-0-26><a id=__codelineno-0-26 name=__codelineno-0-26></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Set the default client to the account we are acting on behalf of.&quot;&quot;&quot;</span>
</span><span id=__span-0-27><a id=__codelineno-0-27 name=__codelineno-0-27></a>    <span class=n>default_client</span> <span class=o>=</span> <span class=n>ApiClient</span><span class=o>.</span><span class=n>get_default</span><span class=p>()</span>
</span><span id=__span-0-28><a id=__codelineno-0-28 name=__codelineno-0-28></a>    <span class=bp>self</span><span class=o>.</span><span class=n>original_access_token</span> <span class=o>=</span> <span class=n>default_client</span><span class=o>.</span><span class=n>configuration</span><span class=o>.</span><span class=n>access_token</span>
</span><span id=__span-0-29><a id=__codelineno-0-29 name=__codelineno-0-29></a>
</span><span id=__span-0-30><a id=__codelineno-0-30 name=__codelineno-0-30></a>    <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>original_access_token</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-31><a id=__codelineno-0-31 name=__codelineno-0-31></a>        <span class=k>return</span>
</span><span id=__span-0-32><a id=__codelineno-0-32 name=__codelineno-0-32></a>
</span><span id=__span-0-33><a id=__codelineno-0-33 name=__codelineno-0-33></a>    <span class=k>assert</span> <span class=bp>self</span><span class=o>.</span><span class=n>original_access_token</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&quot;Bearer &quot;</span><span class=p>)</span>
</span><span id=__span-0-34><a id=__codelineno-0-34 name=__codelineno-0-34></a>    <span class=n>auth</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>original_access_token</span><span class=p>[</span><span class=nb>len</span><span class=p>(</span><span class=s2>&quot;Bearer &quot;</span><span class=p>)</span> <span class=p>:]</span>
</span><span id=__span-0-35><a id=__codelineno-0-35 name=__codelineno-0-35></a>    <span class=n>auth_data</span> <span class=o>=</span> <span class=n>AuthData</span><span class=o>.</span><span class=n>model_validate_json</span><span class=p>(</span><span class=n>auth</span><span class=p>)</span>
</span><span id=__span-0-36><a id=__codelineno-0-36 name=__codelineno-0-36></a>    <span class=n>auth_data</span><span class=o>.</span><span class=n>on_behalf_of</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>target_on_behalf_of</span>
</span><span id=__span-0-37><a id=__codelineno-0-37 name=__codelineno-0-37></a>    <span class=n>new_access_token</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;Bearer </span><span class=si>{</span><span class=n>auth_data</span><span class=o>.</span><span class=n>generate_bearer_token</span><span class=p>()</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-38><a id=__codelineno-0-38 name=__codelineno-0-38></a>    <span class=n>default_client</span><span class=o>.</span><span class=n>configuration</span><span class=o>.</span><span class=n>access_token</span> <span class=o>=</span> <span class=n>new_access_token</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.delegation.OnBehalfOf.__exit__ class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">__exit__</span> <a href=#nearai.delegation.OnBehalfOf.__exit__ class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=fm>__exit__</span><span class=p>(</span><span class=nf>exc_type</span><span class=p>,</span> <span class=n>exc_val</span><span class=p>,</span> <span class=n>exc_tb</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Reset the default client to the original account.</p> <details class=quote> <summary>Source code in <code>nearai/delegation.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-40>40</a></span>
<span class=normal><a href=#__codelineno-0-41>41</a></span>
<span class=normal><a href=#__codelineno-0-42>42</a></span>
<span class=normal><a href=#__codelineno-0-43>43</a></span>
<span class=normal><a href=#__codelineno-0-44>44</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-40><a id=__codelineno-0-40 name=__codelineno-0-40></a><span class=k>def</span><span class=w> </span><span class=fm>__exit__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>exc_type</span><span class=p>,</span> <span class=n>exc_val</span><span class=p>,</span> <span class=n>exc_tb</span><span class=p>):</span>
</span><span id=__span-0-41><a id=__codelineno-0-41 name=__codelineno-0-41></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Reset the default client to the original account.&quot;&quot;&quot;</span>
</span><span id=__span-0-42><a id=__codelineno-0-42 name=__codelineno-0-42></a>    <span class=n>default_client</span> <span class=o>=</span> <span class=n>ApiClient</span><span class=o>.</span><span class=n>get_default</span><span class=p>()</span>
</span><span id=__span-0-43><a id=__codelineno-0-43 name=__codelineno-0-43></a>    <span class=n>default_client</span><span class=o>.</span><span class=n>configuration</span><span class=o>.</span><span class=n>access_token</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>original_access_token</span>
</span><span id=__span-0-44><a id=__codelineno-0-44 name=__codelineno-0-44></a>    <span class=bp>self</span><span class=o>.</span><span class=n>original_access_token</span> <span class=o>=</span> <span class=kc>None</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.delegation.OnBehalfOf.__init__ class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">__init__</span> <a href=#nearai.delegation.OnBehalfOf.__init__ class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=fm>__init__</span><span class=p>(</span><span class=nf>on_behalf_of</span><span class=p>:</span> <span class=n>str</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Context manager that creates a scope where all actions are done on behalf of another account.</p> <details class=quote> <summary>Source code in <code>nearai/delegation.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-20>20</a></span>
<span class=normal><a href=#__codelineno-0-21>21</a></span>
<span class=normal><a href=#__codelineno-0-22>22</a></span>
<span class=normal><a href=#__codelineno-0-23>23</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-20><a id=__codelineno-0-20 name=__codelineno-0-20></a><span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>on_behalf_of</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-21><a id=__codelineno-0-21 name=__codelineno-0-21></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Context manager that creates a scope where all actions are done on behalf of another account.&quot;&quot;&quot;</span>
</span><span id=__span-0-22><a id=__codelineno-0-22 name=__codelineno-0-22></a>    <span class=bp>self</span><span class=o>.</span><span class=n>target_on_behalf_of</span> <span class=o>=</span> <span class=n>on_behalf_of</span>
</span><span id=__span-0-23><a id=__codelineno-0-23 name=__codelineno-0-23></a>    <span class=bp>self</span><span class=o>.</span><span class=n>original_access_token</span> <span class=o>=</span> <span class=kc>None</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-function"> <h4 id=nearai.delegation.check_on_behalf_of class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">check_on_behalf_of</span> <a href=#nearai.delegation.check_on_behalf_of class=headerlink title="Permanent link">&para;</a></h4> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>check_on_behalf_of</span><span class=p>()</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Check if the request is being made on behalf of another account.</p> <details class=quote> <summary>Source code in <code>nearai/delegation.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-47>47</a></span>
<span class=normal><a href=#__codelineno-0-48>48</a></span>
<span class=normal><a href=#__codelineno-0-49>49</a></span>
<span class=normal><a href=#__codelineno-0-50>50</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-47><a id=__codelineno-0-47 name=__codelineno-0-47></a><span class=k>def</span><span class=w> </span><span class=nf>check_on_behalf_of</span><span class=p>():</span>
</span><span id=__span-0-48><a id=__codelineno-0-48 name=__codelineno-0-48></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Check if the request is being made on behalf of another account.&quot;&quot;&quot;</span>
</span><span id=__span-0-49><a id=__codelineno-0-49 name=__codelineno-0-49></a>    <span class=n>api</span> <span class=o>=</span> <span class=n>DelegationApi</span><span class=p>()</span>
</span><span id=__span-0-50><a id=__codelineno-0-50 name=__codelineno-0-50></a>    <span class=k>return</span> <span class=n>api</span><span class=o>.</span><span class=n>api_client</span><span class=o>.</span><span class=n>configuration</span><span class=o>.</span><span class=n>access_token</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=nearai.delegation.revoke_delegation class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">revoke_delegation</span> <a href=#nearai.delegation.revoke_delegation class=headerlink title="Permanent link">&para;</a></h4> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>revoke_delegation</span><span class=p>(</span><span class=n>delegate_account_id</span><span class=p>:</span> <span class=n>str</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Revoke delegation to a specific account.</p> <details class=quote> <summary>Source code in <code>nearai/delegation.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-63>63</a></span>
<span class=normal><a href=#__codelineno-0-64>64</a></span>
<span class=normal><a href=#__codelineno-0-65>65</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-63><a id=__codelineno-0-63 name=__codelineno-0-63></a><span class=k>def</span><span class=w> </span><span class=nf>revoke_delegation</span><span class=p>(</span><span class=n>delegate_account_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-64><a id=__codelineno-0-64 name=__codelineno-0-64></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Revoke delegation to a specific account.&quot;&quot;&quot;</span>
</span><span id=__span-0-65><a id=__codelineno-0-65 name=__codelineno-0-65></a>    <span class=n>DelegationApi</span><span class=p>()</span><span class=o>.</span><span class=n>revoke_delegation_v1_delegation_revoke_delegation_post</span><span class=p>(</span><span class=n>delegate_account_id</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-module"> <h3 id=nearai.evaluation class="doc doc-heading"> <span class="doc doc-object-name doc-module-name">evaluation</span> <a href=#nearai.evaluation class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h4 id=nearai.evaluation._print_metrics_tables class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">_print_metrics_tables</span> <a href=#nearai.evaluation._print_metrics_tables class=headerlink title="Permanent link">&para;</a></h4> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>_print_metrics_tables</span><span class=p>(</span><span class=n>rows</span><span class=p>:</span> <span class=n><span title=typing.List>List</span></span><span class=p>[</span><span class=n><span title=typing.Dict>Dict</span></span><span class=p>[</span><span class=n>str</span><span class=p>,</span> <span class=n>str</span><span class=p>]],</span> <span class=n>metric_names</span><span class=p>:</span> <span class=n><span title=typing.List>List</span></span><span class=p>[</span><span class=n>str</span><span class=p>],</span> <span class=n>num_columns</span><span class=p>:</span> <span class=n>int</span><span class=p>,</span> <span class=n>all_key_columns</span><span class=p>:</span> <span class=n>bool</span><span class=p>,</span> <span class=n>metric_name_max_length</span><span class=p>:</span> <span class=n>int</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Builds table(s) and prints them.</p> <details class=quote> <summary>Source code in <code>nearai/evaluation.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-186>186</a></span>
<span class=normal><a href=#__codelineno-0-187>187</a></span>
<span class=normal><a href=#__codelineno-0-188>188</a></span>
<span class=normal><a href=#__codelineno-0-189>189</a></span>
<span class=normal><a href=#__codelineno-0-190>190</a></span>
<span class=normal><a href=#__codelineno-0-191>191</a></span>
<span class=normal><a href=#__codelineno-0-192>192</a></span>
<span class=normal><a href=#__codelineno-0-193>193</a></span>
<span class=normal><a href=#__codelineno-0-194>194</a></span>
<span class=normal><a href=#__codelineno-0-195>195</a></span>
<span class=normal><a href=#__codelineno-0-196>196</a></span>
<span class=normal><a href=#__codelineno-0-197>197</a></span>
<span class=normal><a href=#__codelineno-0-198>198</a></span>
<span class=normal><a href=#__codelineno-0-199>199</a></span>
<span class=normal><a href=#__codelineno-0-200>200</a></span>
<span class=normal><a href=#__codelineno-0-201>201</a></span>
<span class=normal><a href=#__codelineno-0-202>202</a></span>
<span class=normal><a href=#__codelineno-0-203>203</a></span>
<span class=normal><a href=#__codelineno-0-204>204</a></span>
<span class=normal><a href=#__codelineno-0-205>205</a></span>
<span class=normal><a href=#__codelineno-0-206>206</a></span>
<span class=normal><a href=#__codelineno-0-207>207</a></span>
<span class=normal><a href=#__codelineno-0-208>208</a></span>
<span class=normal><a href=#__codelineno-0-209>209</a></span>
<span class=normal><a href=#__codelineno-0-210>210</a></span>
<span class=normal><a href=#__codelineno-0-211>211</a></span>
<span class=normal><a href=#__codelineno-0-212>212</a></span>
<span class=normal><a href=#__codelineno-0-213>213</a></span>
<span class=normal><a href=#__codelineno-0-214>214</a></span>
<span class=normal><a href=#__codelineno-0-215>215</a></span>
<span class=normal><a href=#__codelineno-0-216>216</a></span>
<span class=normal><a href=#__codelineno-0-217>217</a></span>
<span class=normal><a href=#__codelineno-0-218>218</a></span>
<span class=normal><a href=#__codelineno-0-219>219</a></span>
<span class=normal><a href=#__codelineno-0-220>220</a></span>
<span class=normal><a href=#__codelineno-0-221>221</a></span>
<span class=normal><a href=#__codelineno-0-222>222</a></span>
<span class=normal><a href=#__codelineno-0-223>223</a></span>
<span class=normal><a href=#__codelineno-0-224>224</a></span>
<span class=normal><a href=#__codelineno-0-225>225</a></span>
<span class=normal><a href=#__codelineno-0-226>226</a></span>
<span class=normal><a href=#__codelineno-0-227>227</a></span>
<span class=normal><a href=#__codelineno-0-228>228</a></span>
<span class=normal><a href=#__codelineno-0-229>229</a></span>
<span class=normal><a href=#__codelineno-0-230>230</a></span>
<span class=normal><a href=#__codelineno-0-231>231</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-186><a id=__codelineno-0-186 name=__codelineno-0-186></a><span class=k>def</span><span class=w> </span><span class=nf>_print_metrics_tables</span><span class=p>(</span>
</span><span id=__span-0-187><a id=__codelineno-0-187 name=__codelineno-0-187></a>    <span class=n>rows</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]],</span>
</span><span id=__span-0-188><a id=__codelineno-0-188 name=__codelineno-0-188></a>    <span class=n>metric_names</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>],</span>
</span><span id=__span-0-189><a id=__codelineno-0-189 name=__codelineno-0-189></a>    <span class=n>num_columns</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
</span><span id=__span-0-190><a id=__codelineno-0-190 name=__codelineno-0-190></a>    <span class=n>all_key_columns</span><span class=p>:</span> <span class=nb>bool</span><span class=p>,</span>
</span><span id=__span-0-191><a id=__codelineno-0-191 name=__codelineno-0-191></a>    <span class=n>metric_name_max_length</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
</span><span id=__span-0-192><a id=__codelineno-0-192 name=__codelineno-0-192></a><span class=p>):</span>
</span><span id=__span-0-193><a id=__codelineno-0-193 name=__codelineno-0-193></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Builds table(s) and prints them.&quot;&quot;&quot;</span>
</span><span id=__span-0-194><a id=__codelineno-0-194 name=__codelineno-0-194></a>    <span class=c1># Shorten metric names</span>
</span><span id=__span-0-195><a id=__codelineno-0-195 name=__codelineno-0-195></a>    <span class=n>short_metric_names</span> <span class=o>=</span> <span class=p>[</span><span class=n>_shorten_metric_name</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>metric_name_max_length</span><span class=p>)</span> <span class=k>for</span> <span class=n>name</span> <span class=ow>in</span> <span class=n>metric_names</span><span class=p>]</span>
</span><span id=__span-0-196><a id=__codelineno-0-196 name=__codelineno-0-196></a>
</span><span id=__span-0-197><a id=__codelineno-0-197 name=__codelineno-0-197></a>    <span class=c1># Prepare the base header and rows</span>
</span><span id=__span-0-198><a id=__codelineno-0-198 name=__codelineno-0-198></a>    <span class=n>base_header</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;model&quot;</span><span class=p>,</span> <span class=s2>&quot;agent&quot;</span><span class=p>]</span>
</span><span id=__span-0-199><a id=__codelineno-0-199 name=__codelineno-0-199></a>    <span class=k>if</span> <span class=n>all_key_columns</span><span class=p>:</span>
</span><span id=__span-0-200><a id=__codelineno-0-200 name=__codelineno-0-200></a>        <span class=n>base_header</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span><span class=s2>&quot;namespace&quot;</span><span class=p>,</span> <span class=s2>&quot;version&quot;</span><span class=p>,</span> <span class=s2>&quot;provider&quot;</span><span class=p>])</span>
</span><span id=__span-0-201><a id=__codelineno-0-201 name=__codelineno-0-201></a>
</span><span id=__span-0-202><a id=__codelineno-0-202 name=__codelineno-0-202></a>    <span class=n>base_rows</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-0-203><a id=__codelineno-0-203 name=__codelineno-0-203></a>    <span class=k>for</span> <span class=n>row</span> <span class=ow>in</span> <span class=n>rows</span><span class=p>:</span>
</span><span id=__span-0-204><a id=__codelineno-0-204 name=__codelineno-0-204></a>        <span class=n>base_row</span> <span class=o>=</span> <span class=p>[</span><span class=n>fill</span><span class=p>(</span><span class=n>row</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;model&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)),</span> <span class=n>fill</span><span class=p>(</span><span class=n>row</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;agent&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>))]</span>
</span><span id=__span-0-205><a id=__codelineno-0-205 name=__codelineno-0-205></a>        <span class=n>namespace</span> <span class=o>=</span> <span class=n>row</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;namespace&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span>
</span><span id=__span-0-206><a id=__codelineno-0-206 name=__codelineno-0-206></a>        <span class=n>version</span> <span class=o>=</span> <span class=n>row</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;version&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span>
</span><span id=__span-0-207><a id=__codelineno-0-207 name=__codelineno-0-207></a>        <span class=n>provider</span> <span class=o>=</span> <span class=n>row</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;provider&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span>
</span><span id=__span-0-208><a id=__codelineno-0-208 name=__codelineno-0-208></a>        <span class=k>if</span> <span class=n>all_key_columns</span><span class=p>:</span>
</span><span id=__span-0-209><a id=__codelineno-0-209 name=__codelineno-0-209></a>            <span class=n>base_row</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span><span class=n>fill</span><span class=p>(</span><span class=n>namespace</span><span class=p>),</span> <span class=n>fill</span><span class=p>(</span><span class=n>version</span><span class=p>),</span> <span class=n>fill</span><span class=p>(</span><span class=n>provider</span><span class=p>)])</span>
</span><span id=__span-0-210><a id=__codelineno-0-210 name=__codelineno-0-210></a>        <span class=n>base_rows</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>base_row</span><span class=p>,</span> <span class=n>row</span><span class=p>))</span>
</span><span id=__span-0-211><a id=__codelineno-0-211 name=__codelineno-0-211></a>
</span><span id=__span-0-212><a id=__codelineno-0-212 name=__codelineno-0-212></a>    <span class=n>n_metrics_per_table</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>num_columns</span> <span class=o>-</span> <span class=nb>len</span><span class=p>(</span><span class=n>base_header</span><span class=p>))</span>
</span><span id=__span-0-213><a id=__codelineno-0-213 name=__codelineno-0-213></a>    <span class=c1># Split metrics into groups</span>
</span><span id=__span-0-214><a id=__codelineno-0-214 name=__codelineno-0-214></a>    <span class=n>metric_groups</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span>
</span><span id=__span-0-215><a id=__codelineno-0-215 name=__codelineno-0-215></a>        <span class=nb>zip</span><span class=p>(</span>
</span><span id=__span-0-216><a id=__codelineno-0-216 name=__codelineno-0-216></a>            <span class=p>[</span>
</span><span id=__span-0-217><a id=__codelineno-0-217 name=__codelineno-0-217></a>                <span class=n>short_metric_names</span><span class=p>[</span><span class=n>i</span> <span class=p>:</span> <span class=n>i</span> <span class=o>+</span> <span class=n>n_metrics_per_table</span><span class=p>]</span>
</span><span id=__span-0-218><a id=__codelineno-0-218 name=__codelineno-0-218></a>                <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>short_metric_names</span><span class=p>),</span> <span class=n>n_metrics_per_table</span><span class=p>)</span>
</span><span id=__span-0-219><a id=__codelineno-0-219 name=__codelineno-0-219></a>            <span class=p>],</span>
</span><span id=__span-0-220><a id=__codelineno-0-220 name=__codelineno-0-220></a>            <span class=p>[</span><span class=n>metric_names</span><span class=p>[</span><span class=n>i</span> <span class=p>:</span> <span class=n>i</span> <span class=o>+</span> <span class=n>n_metrics_per_table</span><span class=p>]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>metric_names</span><span class=p>),</span> <span class=n>n_metrics_per_table</span><span class=p>)],</span>
</span><span id=__span-0-221><a id=__codelineno-0-221 name=__codelineno-0-221></a>        <span class=p>)</span>
</span><span id=__span-0-222><a id=__codelineno-0-222 name=__codelineno-0-222></a>    <span class=p>)</span>
</span><span id=__span-0-223><a id=__codelineno-0-223 name=__codelineno-0-223></a>
</span><span id=__span-0-224><a id=__codelineno-0-224 name=__codelineno-0-224></a>    <span class=c1># Print tables</span>
</span><span id=__span-0-225><a id=__codelineno-0-225 name=__codelineno-0-225></a>    <span class=k>for</span> <span class=n>short_group</span><span class=p>,</span> <span class=n>full_group</span> <span class=ow>in</span> <span class=n>metric_groups</span><span class=p>:</span>
</span><span id=__span-0-226><a id=__codelineno-0-226 name=__codelineno-0-226></a>        <span class=n>header</span> <span class=o>=</span> <span class=n>base_header</span> <span class=o>+</span> <span class=n>short_group</span>
</span><span id=__span-0-227><a id=__codelineno-0-227 name=__codelineno-0-227></a>        <span class=n>table</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-0-228><a id=__codelineno-0-228 name=__codelineno-0-228></a>        <span class=k>for</span> <span class=n>base_row</span><span class=p>,</span> <span class=n>row_metrics</span> <span class=ow>in</span> <span class=n>base_rows</span><span class=p>:</span>
</span><span id=__span-0-229><a id=__codelineno-0-229 name=__codelineno-0-229></a>            <span class=n>table_row</span> <span class=o>=</span> <span class=n>base_row</span> <span class=o>+</span> <span class=p>[</span><span class=n>fill</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>row_metrics</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>metric</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)))</span> <span class=k>for</span> <span class=n>metric</span> <span class=ow>in</span> <span class=n>full_group</span><span class=p>]</span>
</span><span id=__span-0-230><a id=__codelineno-0-230 name=__codelineno-0-230></a>            <span class=n>table</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>table_row</span><span class=p>)</span>
</span><span id=__span-0-231><a id=__codelineno-0-231 name=__codelineno-0-231></a>        <span class=nb>print</span><span class=p>(</span><span class=n>tabulate</span><span class=p>(</span><span class=n>table</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>header</span><span class=p>,</span> <span class=n>tablefmt</span><span class=o>=</span><span class=s2>&quot;simple_grid&quot;</span><span class=p>))</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=nearai.evaluation._shorten_metric_name class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">_shorten_metric_name</span> <a href=#nearai.evaluation._shorten_metric_name class=headerlink title="Permanent link">&para;</a></h4> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>_shorten_metric_name</span><span class=p>(</span><span class=n>name</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>max_length</span><span class=p>:</span> <span class=n>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>str</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Shortens metric name if needed.</p> <details class=quote> <summary>Source code in <code>nearai/evaluation.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-176>176</a></span>
<span class=normal><a href=#__codelineno-0-177>177</a></span>
<span class=normal><a href=#__codelineno-0-178>178</a></span>
<span class=normal><a href=#__codelineno-0-179>179</a></span>
<span class=normal><a href=#__codelineno-0-180>180</a></span>
<span class=normal><a href=#__codelineno-0-181>181</a></span>
<span class=normal><a href=#__codelineno-0-182>182</a></span>
<span class=normal><a href=#__codelineno-0-183>183</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-176><a id=__codelineno-0-176 name=__codelineno-0-176></a><span class=k>def</span><span class=w> </span><span class=nf>_shorten_metric_name</span><span class=p>(</span><span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>max_length</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-0-177><a id=__codelineno-0-177 name=__codelineno-0-177></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Shortens metric name if needed.&quot;&quot;&quot;</span>
</span><span id=__span-0-178><a id=__codelineno-0-178 name=__codelineno-0-178></a>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>name</span><span class=p>)</span> <span class=o>&lt;=</span> <span class=n>max_length</span><span class=p>:</span>
</span><span id=__span-0-179><a id=__codelineno-0-179 name=__codelineno-0-179></a>        <span class=k>return</span> <span class=n>name</span>
</span><span id=__span-0-180><a id=__codelineno-0-180 name=__codelineno-0-180></a>    <span class=n>keep</span> <span class=o>=</span> <span class=n>max_length</span> <span class=o>-</span> <span class=mi>2</span>  <span class=c1># 2 dots</span>
</span><span id=__span-0-181><a id=__codelineno-0-181 name=__codelineno-0-181></a>    <span class=n>beginning</span> <span class=o>=</span> <span class=n>keep</span> <span class=o>//</span> <span class=mi>3</span>
</span><span id=__span-0-182><a id=__codelineno-0-182 name=__codelineno-0-182></a>    <span class=n>ending</span> <span class=o>=</span> <span class=n>keep</span> <span class=o>-</span> <span class=n>beginning</span>
</span><span id=__span-0-183><a id=__codelineno-0-183 name=__codelineno-0-183></a>    <span class=k>return</span> <span class=n>name</span><span class=p>[:</span><span class=n>beginning</span><span class=p>]</span> <span class=o>+</span> <span class=s2>&quot;..&quot;</span> <span class=o>+</span> <span class=n>name</span><span class=p>[</span><span class=o>-</span><span class=n>ending</span><span class=p>:]</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=nearai.evaluation.load_benchmark_entry_info class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">load_benchmark_entry_info</span> <a href=#nearai.evaluation.load_benchmark_entry_info class=headerlink title="Permanent link">&para;</a></h4> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>load_benchmark_entry_info</span><span class=p>(</span><span class=n>info</span><span class=p>:</span> <span class=n>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=typing.Any>Any</span></span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Deserializes benchmark info entry from db data.</p> <details class=quote> <summary>Source code in <code>nearai/evaluation.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-16>16</a></span>
<span class=normal><a href=#__codelineno-0-17>17</a></span>
<span class=normal><a href=#__codelineno-0-18>18</a></span>
<span class=normal><a href=#__codelineno-0-19>19</a></span>
<span class=normal><a href=#__codelineno-0-20>20</a></span>
<span class=normal><a href=#__codelineno-0-21>21</a></span>
<span class=normal><a href=#__codelineno-0-22>22</a></span>
<span class=normal><a href=#__codelineno-0-23>23</a></span>
<span class=normal><a href=#__codelineno-0-24>24</a></span>
<span class=normal><a href=#__codelineno-0-25>25</a></span>
<span class=normal><a href=#__codelineno-0-26>26</a></span>
<span class=normal><a href=#__codelineno-0-27>27</a></span>
<span class=normal><a href=#__codelineno-0-28>28</a></span>
<span class=normal><a href=#__codelineno-0-29>29</a></span>
<span class=normal><a href=#__codelineno-0-30>30</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-16><a id=__codelineno-0-16 name=__codelineno-0-16></a><span class=k>def</span><span class=w> </span><span class=nf>load_benchmark_entry_info</span><span class=p>(</span><span class=n>info</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Any</span><span class=p>:</span>
</span><span id=__span-0-17><a id=__codelineno-0-17 name=__codelineno-0-17></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Deserializes benchmark info entry from db data.&quot;&quot;&quot;</span>
</span><span id=__span-0-18><a id=__codelineno-0-18 name=__codelineno-0-18></a>    <span class=n>first_decode</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>info</span><span class=p>)</span>
</span><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-20><a id=__codelineno-0-20 name=__codelineno-0-20></a>        <span class=n>second_decode</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>first_decode</span><span class=p>)</span>
</span><span id=__span-0-21><a id=__codelineno-0-21 name=__codelineno-0-21></a>        <span class=k>return</span> <span class=n>second_decode</span>
</span><span id=__span-0-22><a id=__codelineno-0-22 name=__codelineno-0-22></a>    <span class=k>except</span> <span class=n>json</span><span class=o>.</span><span class=n>JSONDecodeError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-23><a id=__codelineno-0-23 name=__codelineno-0-23></a>        <span class=k>if</span> <span class=s2>&quot;Unterminated string&quot;</span> <span class=ow>in</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>):</span>
</span><span id=__span-0-24><a id=__codelineno-0-24 name=__codelineno-0-24></a>            <span class=n>last_brace</span> <span class=o>=</span> <span class=n>first_decode</span><span class=o>.</span><span class=n>rfind</span><span class=p>(</span><span class=s2>&quot;}&quot;</span><span class=p>)</span>
</span><span id=__span-0-25><a id=__codelineno-0-25 name=__codelineno-0-25></a>            <span class=k>if</span> <span class=n>last_brace</span> <span class=o>!=</span> <span class=o>-</span><span class=mi>1</span><span class=p>:</span>
</span><span id=__span-0-26><a id=__codelineno-0-26 name=__codelineno-0-26></a>                <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-27><a id=__codelineno-0-27 name=__codelineno-0-27></a>                    <span class=k>return</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>first_decode</span><span class=p>[:</span> <span class=n>last_brace</span> <span class=o>+</span> <span class=mi>1</span><span class=p>])</span>
</span><span id=__span-0-28><a id=__codelineno-0-28 name=__codelineno-0-28></a>                <span class=k>except</span> <span class=n>json</span><span class=o>.</span><span class=n>JSONDecodeError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-29><a id=__codelineno-0-29 name=__codelineno-0-29></a>                    <span class=k>pass</span>
</span><span id=__span-0-30><a id=__codelineno-0-30 name=__codelineno-0-30></a>    <span class=k>return</span> <span class=n>first_decode</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=nearai.evaluation.print_evaluation_table class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">print_evaluation_table</span> <a href=#nearai.evaluation.print_evaluation_table class=headerlink title="Permanent link">&para;</a></h4> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>print_evaluation_table</span><span class=p>(</span><span class=n>rows</span><span class=p>:</span> <span class=n><span title=typing.List>List</span></span><span class=p>[</span><span class=n><span title=typing.Dict>Dict</span></span><span class=p>[</span><span class=n>str</span><span class=p>,</span> <span class=n>str</span><span class=p>]],</span> <span class=n>columns</span><span class=p>:</span> <span class=n><span title=typing.List>List</span></span><span class=p>[</span><span class=n>str</span><span class=p>],</span> <span class=n>important_columns</span><span class=p>:</span> <span class=n><span title=typing.List>List</span></span><span class=p>[</span><span class=n>str</span><span class=p>],</span> <span class=n>all_key_columns</span><span class=p>:</span> <span class=n>bool</span><span class=p>,</span> <span class=n>all_metrics</span><span class=p>:</span> <span class=n>bool</span><span class=p>,</span> <span class=n>num_columns</span><span class=p>:</span> <span class=n>int</span><span class=p>,</span> <span class=n>metric_name_max_length</span><span class=p>:</span> <span class=n>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Prints table of evaluations.</p> <details class=quote> <summary>Source code in <code>nearai/evaluation.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-162>162</a></span>
<span class=normal><a href=#__codelineno-0-163>163</a></span>
<span class=normal><a href=#__codelineno-0-164>164</a></span>
<span class=normal><a href=#__codelineno-0-165>165</a></span>
<span class=normal><a href=#__codelineno-0-166>166</a></span>
<span class=normal><a href=#__codelineno-0-167>167</a></span>
<span class=normal><a href=#__codelineno-0-168>168</a></span>
<span class=normal><a href=#__codelineno-0-169>169</a></span>
<span class=normal><a href=#__codelineno-0-170>170</a></span>
<span class=normal><a href=#__codelineno-0-171>171</a></span>
<span class=normal><a href=#__codelineno-0-172>172</a></span>
<span class=normal><a href=#__codelineno-0-173>173</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-162><a id=__codelineno-0-162 name=__codelineno-0-162></a><span class=k>def</span><span class=w> </span><span class=nf>print_evaluation_table</span><span class=p>(</span>
</span><span id=__span-0-163><a id=__codelineno-0-163 name=__codelineno-0-163></a>    <span class=n>rows</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]],</span>
</span><span id=__span-0-164><a id=__codelineno-0-164 name=__codelineno-0-164></a>    <span class=n>columns</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>],</span>
</span><span id=__span-0-165><a id=__codelineno-0-165 name=__codelineno-0-165></a>    <span class=n>important_columns</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>],</span>
</span><span id=__span-0-166><a id=__codelineno-0-166 name=__codelineno-0-166></a>    <span class=n>all_key_columns</span><span class=p>:</span> <span class=nb>bool</span><span class=p>,</span>
</span><span id=__span-0-167><a id=__codelineno-0-167 name=__codelineno-0-167></a>    <span class=n>all_metrics</span><span class=p>:</span> <span class=nb>bool</span><span class=p>,</span>
</span><span id=__span-0-168><a id=__codelineno-0-168 name=__codelineno-0-168></a>    <span class=n>num_columns</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
</span><span id=__span-0-169><a id=__codelineno-0-169 name=__codelineno-0-169></a>    <span class=n>metric_name_max_length</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
</span><span id=__span-0-170><a id=__codelineno-0-170 name=__codelineno-0-170></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-171><a id=__codelineno-0-171 name=__codelineno-0-171></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Prints table of evaluations.&quot;&quot;&quot;</span>
</span><span id=__span-0-172><a id=__codelineno-0-172 name=__codelineno-0-172></a>    <span class=n>metric_names</span> <span class=o>=</span> <span class=n>columns</span><span class=p>[</span><span class=mi>5</span><span class=p>:]</span> <span class=k>if</span> <span class=n>all_metrics</span> <span class=k>else</span> <span class=n>important_columns</span><span class=p>[</span><span class=mi>2</span><span class=p>:]</span>
</span><span id=__span-0-173><a id=__codelineno-0-173 name=__codelineno-0-173></a>    <span class=n>_print_metrics_tables</span><span class=p>(</span><span class=n>rows</span><span class=p>,</span> <span class=n>metric_names</span><span class=p>,</span> <span class=n>num_columns</span><span class=p>,</span> <span class=n>all_key_columns</span><span class=p>,</span> <span class=n>metric_name_max_length</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=nearai.evaluation.record_evaluation_metrics class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">record_evaluation_metrics</span> <a href=#nearai.evaluation.record_evaluation_metrics class=headerlink title="Permanent link">&para;</a></h4> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>record_evaluation_metrics</span><span class=p>(</span><span class=n>solver_strategy</span><span class=p>:</span> <span class=n><a class="autorefs autorefs-internal" title=nearai.solvers.SolverStrategy href=#nearai.solvers.SolverStrategy>SolverStrategy</a></span><span class=p>,</span> <span class=n>benchmark_id</span><span class=p>:</span> <span class=n>int</span><span class=p>,</span> <span class=n>data_tasks</span><span class=p>:</span> <span class=n><span title=typing.Union>Union</span></span><span class=p>[</span><span class=n><span title=datasets.Dataset>Dataset</span></span><span class=p>,</span> <span class=n><span title=typing.List>List</span></span><span class=p>[</span><span class=n>dict</span><span class=p>]],</span> <span class=n>metrics</span><span class=p>:</span> <span class=n><span title=typing.Dict>Dict</span></span><span class=p>[</span><span class=n>str</span><span class=p>,</span> <span class=n><span title=typing.Any>Any</span></span><span class=p>],</span> <span class=n>prepend_evaluation_name</span><span class=p>:</span> <span class=n>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Uploads evaluation metrics into registry.</p> <details class=quote> <summary>Source code in <code>nearai/evaluation.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-45>45</a></span>
<span class=normal><a href=#__codelineno-0-46>46</a></span>
<span class=normal><a href=#__codelineno-0-47>47</a></span>
<span class=normal><a href=#__codelineno-0-48>48</a></span>
<span class=normal><a href=#__codelineno-0-49>49</a></span>
<span class=normal><a href=#__codelineno-0-50>50</a></span>
<span class=normal><a href=#__codelineno-0-51>51</a></span>
<span class=normal><a href=#__codelineno-0-52>52</a></span>
<span class=normal><a href=#__codelineno-0-53>53</a></span>
<span class=normal><a href=#__codelineno-0-54>54</a></span>
<span class=normal><a href=#__codelineno-0-55>55</a></span>
<span class=normal><a href=#__codelineno-0-56>56</a></span>
<span class=normal><a href=#__codelineno-0-57>57</a></span>
<span class=normal><a href=#__codelineno-0-58>58</a></span>
<span class=normal><a href=#__codelineno-0-59>59</a></span>
<span class=normal><a href=#__codelineno-0-60>60</a></span>
<span class=normal><a href=#__codelineno-0-61>61</a></span>
<span class=normal><a href=#__codelineno-0-62>62</a></span>
<span class=normal><a href=#__codelineno-0-63>63</a></span>
<span class=normal><a href=#__codelineno-0-64>64</a></span>
<span class=normal><a href=#__codelineno-0-65>65</a></span>
<span class=normal><a href=#__codelineno-0-66>66</a></span>
<span class=normal><a href=#__codelineno-0-67>67</a></span>
<span class=normal><a href=#__codelineno-0-68>68</a></span>
<span class=normal><a href=#__codelineno-0-69>69</a></span>
<span class=normal><a href=#__codelineno-0-70>70</a></span>
<span class=normal><a href=#__codelineno-0-71>71</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-45><a id=__codelineno-0-45 name=__codelineno-0-45></a><span class=k>def</span><span class=w> </span><span class=nf>record_evaluation_metrics</span><span class=p>(</span>
</span><span id=__span-0-46><a id=__codelineno-0-46 name=__codelineno-0-46></a>    <span class=n>solver_strategy</span><span class=p>:</span> <span class=n>SolverStrategy</span><span class=p>,</span>
</span><span id=__span-0-47><a id=__codelineno-0-47 name=__codelineno-0-47></a>    <span class=n>benchmark_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
</span><span id=__span-0-48><a id=__codelineno-0-48 name=__codelineno-0-48></a>    <span class=n>data_tasks</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Dataset</span><span class=p>,</span> <span class=n>List</span><span class=p>[</span><span class=nb>dict</span><span class=p>]],</span>
</span><span id=__span-0-49><a id=__codelineno-0-49 name=__codelineno-0-49></a>    <span class=n>metrics</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span>
</span><span id=__span-0-50><a id=__codelineno-0-50 name=__codelineno-0-50></a>    <span class=n>prepend_evaluation_name</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-51><a id=__codelineno-0-51 name=__codelineno-0-51></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-52><a id=__codelineno-0-52 name=__codelineno-0-52></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Uploads evaluation metrics into registry.&quot;&quot;&quot;</span>
</span><span id=__span-0-53><a id=__codelineno-0-53 name=__codelineno-0-53></a>    <span class=n>evaluation_name</span> <span class=o>=</span> <span class=n>solver_strategy</span><span class=o>.</span><span class=n>evaluation_name</span><span class=p>()</span>
</span><span id=__span-0-54><a id=__codelineno-0-54 name=__codelineno-0-54></a>    <span class=n>model</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-55><a id=__codelineno-0-55 name=__codelineno-0-55></a>    <span class=n>agent</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-56><a id=__codelineno-0-56 name=__codelineno-0-56></a>    <span class=n>version</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-57><a id=__codelineno-0-57 name=__codelineno-0-57></a>    <span class=n>model</span> <span class=o>=</span> <span class=n>solver_strategy</span><span class=o>.</span><span class=n>model_name</span>
</span><span id=__span-0-58><a id=__codelineno-0-58 name=__codelineno-0-58></a>    <span class=n>agent</span> <span class=o>=</span> <span class=n>solver_strategy</span><span class=o>.</span><span class=n>agent_name</span><span class=p>()</span>
</span><span id=__span-0-59><a id=__codelineno-0-59 name=__codelineno-0-59></a>    <span class=n>version</span> <span class=o>=</span> <span class=n>solver_strategy</span><span class=o>.</span><span class=n>agent_version</span><span class=p>()</span>
</span><span id=__span-0-60><a id=__codelineno-0-60 name=__codelineno-0-60></a>
</span><span id=__span-0-61><a id=__codelineno-0-61 name=__codelineno-0-61></a>    <span class=n>upload_evaluation</span><span class=p>(</span>
</span><span id=__span-0-62><a id=__codelineno-0-62 name=__codelineno-0-62></a>        <span class=n>evaluation_name</span><span class=p>,</span>
</span><span id=__span-0-63><a id=__codelineno-0-63 name=__codelineno-0-63></a>        <span class=n>benchmark_id</span><span class=p>,</span>
</span><span id=__span-0-64><a id=__codelineno-0-64 name=__codelineno-0-64></a>        <span class=n>data_tasks</span><span class=p>,</span>
</span><span id=__span-0-65><a id=__codelineno-0-65 name=__codelineno-0-65></a>        <span class=n>metrics</span> <span class=k>if</span> <span class=ow>not</span> <span class=n>prepend_evaluation_name</span> <span class=k>else</span> <span class=n>_prepend_name_to_metrics</span><span class=p>(</span><span class=n>evaluation_name</span><span class=p>,</span> <span class=n>metrics</span><span class=p>),</span>
</span><span id=__span-0-66><a id=__codelineno-0-66 name=__codelineno-0-66></a>        <span class=n>model</span><span class=p>,</span>
</span><span id=__span-0-67><a id=__codelineno-0-67 name=__codelineno-0-67></a>        <span class=n>agent</span><span class=p>,</span>
</span><span id=__span-0-68><a id=__codelineno-0-68 name=__codelineno-0-68></a>        <span class=n>solver_strategy</span><span class=o>.</span><span class=n>evaluated_entry_namespace</span><span class=p>(),</span>
</span><span id=__span-0-69><a id=__codelineno-0-69 name=__codelineno-0-69></a>        <span class=n>version</span><span class=p>,</span>
</span><span id=__span-0-70><a id=__codelineno-0-70 name=__codelineno-0-70></a>        <span class=n>solver_strategy</span><span class=o>.</span><span class=n>model_provider</span><span class=p>(),</span>
</span><span id=__span-0-71><a id=__codelineno-0-71 name=__codelineno-0-71></a>    <span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=nearai.evaluation.record_single_score_evaluation class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">record_single_score_evaluation</span> <a href=#nearai.evaluation.record_single_score_evaluation class=headerlink title="Permanent link">&para;</a></h4> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>record_single_score_evaluation</span><span class=p>(</span><span class=n>solver_strategy</span><span class=p>:</span> <span class=n><a class="autorefs autorefs-internal" title=nearai.solvers.SolverStrategy href=#nearai.solvers.SolverStrategy>SolverStrategy</a></span><span class=p>,</span> <span class=n>benchmark_id</span><span class=p>:</span> <span class=n>int</span><span class=p>,</span> <span class=n>data_tasks</span><span class=p>:</span> <span class=n><span title=typing.Union>Union</span></span><span class=p>[</span><span class=n><span title=datasets.Dataset>Dataset</span></span><span class=p>,</span> <span class=n><span title=typing.List>List</span></span><span class=p>[</span><span class=n>dict</span><span class=p>]],</span> <span class=n>score</span><span class=p>:</span> <span class=n>float</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Uploads single score evaluation into registry.</p> <details class=quote> <summary>Source code in <code>nearai/evaluation.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-33>33</a></span>
<span class=normal><a href=#__codelineno-0-34>34</a></span>
<span class=normal><a href=#__codelineno-0-35>35</a></span>
<span class=normal><a href=#__codelineno-0-36>36</a></span>
<span class=normal><a href=#__codelineno-0-37>37</a></span>
<span class=normal><a href=#__codelineno-0-38>38</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-33><a id=__codelineno-0-33 name=__codelineno-0-33></a><span class=k>def</span><span class=w> </span><span class=nf>record_single_score_evaluation</span><span class=p>(</span>
</span><span id=__span-0-34><a id=__codelineno-0-34 name=__codelineno-0-34></a>    <span class=n>solver_strategy</span><span class=p>:</span> <span class=n>SolverStrategy</span><span class=p>,</span> <span class=n>benchmark_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>data_tasks</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Dataset</span><span class=p>,</span> <span class=n>List</span><span class=p>[</span><span class=nb>dict</span><span class=p>]],</span> <span class=n>score</span><span class=p>:</span> <span class=nb>float</span>
</span><span id=__span-0-35><a id=__codelineno-0-35 name=__codelineno-0-35></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-36><a id=__codelineno-0-36 name=__codelineno-0-36></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Uploads single score evaluation into registry.&quot;&quot;&quot;</span>
</span><span id=__span-0-37><a id=__codelineno-0-37 name=__codelineno-0-37></a>    <span class=n>evaluation_name</span> <span class=o>=</span> <span class=n>solver_strategy</span><span class=o>.</span><span class=n>evaluation_name</span><span class=p>()</span>
</span><span id=__span-0-38><a id=__codelineno-0-38 name=__codelineno-0-38></a>    <span class=n>record_evaluation_metrics</span><span class=p>(</span><span class=n>solver_strategy</span><span class=p>,</span> <span class=n>benchmark_id</span><span class=p>,</span> <span class=n>data_tasks</span><span class=p>,</span> <span class=p>{</span><span class=n>evaluation_name</span><span class=p>:</span> <span class=n>score</span><span class=p>},</span> <span class=kc>False</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=nearai.evaluation.upload_evaluation class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">upload_evaluation</span> <a href=#nearai.evaluation.upload_evaluation class=headerlink title="Permanent link">&para;</a></h4> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>upload_evaluation</span><span class=p>(</span><span class=n>evaluation_name</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>benchmark_id</span><span class=p>:</span> <span class=n>int</span><span class=p>,</span> <span class=n>data_tasks</span><span class=p>:</span> <span class=n><span title=typing.Union>Union</span></span><span class=p>[</span><span class=n><span title=datasets.Dataset>Dataset</span></span><span class=p>,</span> <span class=n><span title=typing.List>List</span></span><span class=p>[</span><span class=n>dict</span><span class=p>]],</span> <span class=n>metrics</span><span class=p>:</span> <span class=n><span title=typing.Dict>Dict</span></span><span class=p>[</span><span class=n>str</span><span class=p>,</span> <span class=n><span title=typing.Any>Any</span></span><span class=p>],</span> <span class=n>model</span><span class=p>:</span> <span class=n>str</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=n>agent</span><span class=p>:</span> <span class=n>str</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=n>namespace</span><span class=p>:</span> <span class=n>str</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=n>version</span><span class=p>:</span> <span class=n>str</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=n>provider</span><span class=p>:</span> <span class=n>str</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Uploads evaluation into registry.</p> <p><code>evaluation_name</code>: a unique name for (benchmark, solver) tuple, e.g. "mbpp" or "live_bench" or "mmlu-5-shot". <code>metrics</code>: metrics from evaluation. <code>model</code>: model that was used. <code>agent</code>: agent that was evaluated, in any. <code>namespace</code>: namespace of evaluated agent or evaluated model. <code>version</code>: version of evaluated agent or evaluated model. <code>provider</code>: provider of model used; pass <code>local</code> if running locally.</p> <details class=quote> <summary>Source code in <code>nearai/evaluation.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-74> 74</a></span>
<span class=normal><a href=#__codelineno-0-75> 75</a></span>
<span class=normal><a href=#__codelineno-0-76> 76</a></span>
<span class=normal><a href=#__codelineno-0-77> 77</a></span>
<span class=normal><a href=#__codelineno-0-78> 78</a></span>
<span class=normal><a href=#__codelineno-0-79> 79</a></span>
<span class=normal><a href=#__codelineno-0-80> 80</a></span>
<span class=normal><a href=#__codelineno-0-81> 81</a></span>
<span class=normal><a href=#__codelineno-0-82> 82</a></span>
<span class=normal><a href=#__codelineno-0-83> 83</a></span>
<span class=normal><a href=#__codelineno-0-84> 84</a></span>
<span class=normal><a href=#__codelineno-0-85> 85</a></span>
<span class=normal><a href=#__codelineno-0-86> 86</a></span>
<span class=normal><a href=#__codelineno-0-87> 87</a></span>
<span class=normal><a href=#__codelineno-0-88> 88</a></span>
<span class=normal><a href=#__codelineno-0-89> 89</a></span>
<span class=normal><a href=#__codelineno-0-90> 90</a></span>
<span class=normal><a href=#__codelineno-0-91> 91</a></span>
<span class=normal><a href=#__codelineno-0-92> 92</a></span>
<span class=normal><a href=#__codelineno-0-93> 93</a></span>
<span class=normal><a href=#__codelineno-0-94> 94</a></span>
<span class=normal><a href=#__codelineno-0-95> 95</a></span>
<span class=normal><a href=#__codelineno-0-96> 96</a></span>
<span class=normal><a href=#__codelineno-0-97> 97</a></span>
<span class=normal><a href=#__codelineno-0-98> 98</a></span>
<span class=normal><a href=#__codelineno-0-99> 99</a></span>
<span class=normal><a href=#__codelineno-0-100>100</a></span>
<span class=normal><a href=#__codelineno-0-101>101</a></span>
<span class=normal><a href=#__codelineno-0-102>102</a></span>
<span class=normal><a href=#__codelineno-0-103>103</a></span>
<span class=normal><a href=#__codelineno-0-104>104</a></span>
<span class=normal><a href=#__codelineno-0-105>105</a></span>
<span class=normal><a href=#__codelineno-0-106>106</a></span>
<span class=normal><a href=#__codelineno-0-107>107</a></span>
<span class=normal><a href=#__codelineno-0-108>108</a></span>
<span class=normal><a href=#__codelineno-0-109>109</a></span>
<span class=normal><a href=#__codelineno-0-110>110</a></span>
<span class=normal><a href=#__codelineno-0-111>111</a></span>
<span class=normal><a href=#__codelineno-0-112>112</a></span>
<span class=normal><a href=#__codelineno-0-113>113</a></span>
<span class=normal><a href=#__codelineno-0-114>114</a></span>
<span class=normal><a href=#__codelineno-0-115>115</a></span>
<span class=normal><a href=#__codelineno-0-116>116</a></span>
<span class=normal><a href=#__codelineno-0-117>117</a></span>
<span class=normal><a href=#__codelineno-0-118>118</a></span>
<span class=normal><a href=#__codelineno-0-119>119</a></span>
<span class=normal><a href=#__codelineno-0-120>120</a></span>
<span class=normal><a href=#__codelineno-0-121>121</a></span>
<span class=normal><a href=#__codelineno-0-122>122</a></span>
<span class=normal><a href=#__codelineno-0-123>123</a></span>
<span class=normal><a href=#__codelineno-0-124>124</a></span>
<span class=normal><a href=#__codelineno-0-125>125</a></span>
<span class=normal><a href=#__codelineno-0-126>126</a></span>
<span class=normal><a href=#__codelineno-0-127>127</a></span>
<span class=normal><a href=#__codelineno-0-128>128</a></span>
<span class=normal><a href=#__codelineno-0-129>129</a></span>
<span class=normal><a href=#__codelineno-0-130>130</a></span>
<span class=normal><a href=#__codelineno-0-131>131</a></span>
<span class=normal><a href=#__codelineno-0-132>132</a></span>
<span class=normal><a href=#__codelineno-0-133>133</a></span>
<span class=normal><a href=#__codelineno-0-134>134</a></span>
<span class=normal><a href=#__codelineno-0-135>135</a></span>
<span class=normal><a href=#__codelineno-0-136>136</a></span>
<span class=normal><a href=#__codelineno-0-137>137</a></span>
<span class=normal><a href=#__codelineno-0-138>138</a></span>
<span class=normal><a href=#__codelineno-0-139>139</a></span>
<span class=normal><a href=#__codelineno-0-140>140</a></span>
<span class=normal><a href=#__codelineno-0-141>141</a></span>
<span class=normal><a href=#__codelineno-0-142>142</a></span>
<span class=normal><a href=#__codelineno-0-143>143</a></span>
<span class=normal><a href=#__codelineno-0-144>144</a></span>
<span class=normal><a href=#__codelineno-0-145>145</a></span>
<span class=normal><a href=#__codelineno-0-146>146</a></span>
<span class=normal><a href=#__codelineno-0-147>147</a></span>
<span class=normal><a href=#__codelineno-0-148>148</a></span>
<span class=normal><a href=#__codelineno-0-149>149</a></span>
<span class=normal><a href=#__codelineno-0-150>150</a></span>
<span class=normal><a href=#__codelineno-0-151>151</a></span>
<span class=normal><a href=#__codelineno-0-152>152</a></span>
<span class=normal><a href=#__codelineno-0-153>153</a></span>
<span class=normal><a href=#__codelineno-0-154>154</a></span>
<span class=normal><a href=#__codelineno-0-155>155</a></span>
<span class=normal><a href=#__codelineno-0-156>156</a></span>
<span class=normal><a href=#__codelineno-0-157>157</a></span>
<span class=normal><a href=#__codelineno-0-158>158</a></span>
<span class=normal><a href=#__codelineno-0-159>159</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-74><a id=__codelineno-0-74 name=__codelineno-0-74></a><span class=k>def</span><span class=w> </span><span class=nf>upload_evaluation</span><span class=p>(</span>
</span><span id=__span-0-75><a id=__codelineno-0-75 name=__codelineno-0-75></a>    <span class=n>evaluation_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-76><a id=__codelineno-0-76 name=__codelineno-0-76></a>    <span class=n>benchmark_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
</span><span id=__span-0-77><a id=__codelineno-0-77 name=__codelineno-0-77></a>    <span class=n>data_tasks</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Dataset</span><span class=p>,</span> <span class=n>List</span><span class=p>[</span><span class=nb>dict</span><span class=p>]],</span>
</span><span id=__span-0-78><a id=__codelineno-0-78 name=__codelineno-0-78></a>    <span class=n>metrics</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span>
</span><span id=__span-0-79><a id=__codelineno-0-79 name=__codelineno-0-79></a>    <span class=n>model</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-80><a id=__codelineno-0-80 name=__codelineno-0-80></a>    <span class=n>agent</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-81><a id=__codelineno-0-81 name=__codelineno-0-81></a>    <span class=n>namespace</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-82><a id=__codelineno-0-82 name=__codelineno-0-82></a>    <span class=n>version</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-83><a id=__codelineno-0-83 name=__codelineno-0-83></a>    <span class=n>provider</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-84><a id=__codelineno-0-84 name=__codelineno-0-84></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-85><a id=__codelineno-0-85 name=__codelineno-0-85></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Uploads evaluation into registry.</span>
</span><span id=__span-0-86><a id=__codelineno-0-86 name=__codelineno-0-86></a>
</span><span id=__span-0-87><a id=__codelineno-0-87 name=__codelineno-0-87></a><span class=sd>    `evaluation_name`: a unique name for (benchmark, solver) tuple, e.g. &quot;mbpp&quot; or &quot;live_bench&quot; or &quot;mmlu-5-shot&quot;.</span>
</span><span id=__span-0-88><a id=__codelineno-0-88 name=__codelineno-0-88></a><span class=sd>    `metrics`: metrics from evaluation.</span>
</span><span id=__span-0-89><a id=__codelineno-0-89 name=__codelineno-0-89></a><span class=sd>    `model`: model that was used.</span>
</span><span id=__span-0-90><a id=__codelineno-0-90 name=__codelineno-0-90></a><span class=sd>    `agent`: agent that was evaluated, in any.</span>
</span><span id=__span-0-91><a id=__codelineno-0-91 name=__codelineno-0-91></a><span class=sd>    `namespace`: namespace of evaluated agent or evaluated model.</span>
</span><span id=__span-0-92><a id=__codelineno-0-92 name=__codelineno-0-92></a><span class=sd>    `version`: version of evaluated agent or evaluated model.</span>
</span><span id=__span-0-93><a id=__codelineno-0-93 name=__codelineno-0-93></a><span class=sd>    `provider`: provider of model used; pass `local` if running locally.</span>
</span><span id=__span-0-94><a id=__codelineno-0-94 name=__codelineno-0-94></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-95><a id=__codelineno-0-95 name=__codelineno-0-95></a>    <span class=n>key</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;evaluation_</span><span class=si>{</span><span class=n>evaluation_name</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-96><a id=__codelineno-0-96 name=__codelineno-0-96></a>    <span class=n>metrics</span><span class=p>[</span><span class=n>EVALUATED_ENTRY_METADATA</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-0-97><a id=__codelineno-0-97 name=__codelineno-0-97></a>    <span class=k>if</span> <span class=n>agent</span> <span class=o>!=</span> <span class=s2>&quot;&quot;</span><span class=p>:</span>
</span><span id=__span-0-98><a id=__codelineno-0-98 name=__codelineno-0-98></a>        <span class=n>metrics</span><span class=p>[</span><span class=n>EVALUATED_ENTRY_METADATA</span><span class=p>][</span><span class=s2>&quot;agent&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>agent</span>
</span><span id=__span-0-99><a id=__codelineno-0-99 name=__codelineno-0-99></a>        <span class=n>key</span> <span class=o>+=</span> <span class=sa>f</span><span class=s2>&quot;_agent_</span><span class=si>{</span><span class=n>agent</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-100><a id=__codelineno-0-100 name=__codelineno-0-100></a>    <span class=k>if</span> <span class=n>model</span> <span class=o>!=</span> <span class=s2>&quot;&quot;</span><span class=p>:</span>
</span><span id=__span-0-101><a id=__codelineno-0-101 name=__codelineno-0-101></a>        <span class=n>metrics</span><span class=p>[</span><span class=n>EVALUATED_ENTRY_METADATA</span><span class=p>][</span><span class=s2>&quot;model&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>model</span>
</span><span id=__span-0-102><a id=__codelineno-0-102 name=__codelineno-0-102></a>        <span class=n>key</span> <span class=o>+=</span> <span class=sa>f</span><span class=s2>&quot;_model_</span><span class=si>{</span><span class=n>model</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-103><a id=__codelineno-0-103 name=__codelineno-0-103></a>    <span class=k>if</span> <span class=n>namespace</span> <span class=o>!=</span> <span class=s2>&quot;&quot;</span><span class=p>:</span>
</span><span id=__span-0-104><a id=__codelineno-0-104 name=__codelineno-0-104></a>        <span class=n>metrics</span><span class=p>[</span><span class=n>EVALUATED_ENTRY_METADATA</span><span class=p>][</span><span class=s2>&quot;namespace&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>namespace</span>
</span><span id=__span-0-105><a id=__codelineno-0-105 name=__codelineno-0-105></a>        <span class=n>key</span> <span class=o>+=</span> <span class=sa>f</span><span class=s2>&quot;_namespace_</span><span class=si>{</span><span class=n>namespace</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-106><a id=__codelineno-0-106 name=__codelineno-0-106></a>    <span class=k>if</span> <span class=n>version</span> <span class=o>!=</span> <span class=s2>&quot;&quot;</span><span class=p>:</span>
</span><span id=__span-0-107><a id=__codelineno-0-107 name=__codelineno-0-107></a>        <span class=n>metrics</span><span class=p>[</span><span class=n>EVALUATED_ENTRY_METADATA</span><span class=p>][</span><span class=s2>&quot;version&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>version</span>
</span><span id=__span-0-108><a id=__codelineno-0-108 name=__codelineno-0-108></a>        <span class=n>key</span> <span class=o>+=</span> <span class=sa>f</span><span class=s2>&quot;_version_</span><span class=si>{</span><span class=n>version</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-109><a id=__codelineno-0-109 name=__codelineno-0-109></a>    <span class=k>if</span> <span class=n>provider</span> <span class=o>!=</span> <span class=s2>&quot;&quot;</span><span class=p>:</span>
</span><span id=__span-0-110><a id=__codelineno-0-110 name=__codelineno-0-110></a>        <span class=n>metrics</span><span class=p>[</span><span class=n>EVALUATED_ENTRY_METADATA</span><span class=p>][</span><span class=s2>&quot;provider&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>provider</span>
</span><span id=__span-0-111><a id=__codelineno-0-111 name=__codelineno-0-111></a>        <span class=n>key</span> <span class=o>+=</span> <span class=sa>f</span><span class=s2>&quot;_provider_</span><span class=si>{</span><span class=n>provider</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-112><a id=__codelineno-0-112 name=__codelineno-0-112></a>
</span><span id=__span-0-113><a id=__codelineno-0-113 name=__codelineno-0-113></a>    <span class=n>entry_path</span> <span class=o>=</span> <span class=n>get_registry_folder</span><span class=p>()</span> <span class=o>/</span> <span class=n>key</span>
</span><span id=__span-0-114><a id=__codelineno-0-114 name=__codelineno-0-114></a>    <span class=c1># Create folder entry_path if not present</span>
</span><span id=__span-0-115><a id=__codelineno-0-115 name=__codelineno-0-115></a>    <span class=n>entry_path</span><span class=o>.</span><span class=n>mkdir</span><span class=p>(</span><span class=n>parents</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-116><a id=__codelineno-0-116 name=__codelineno-0-116></a>    <span class=c1># Write file metrics.json inside</span>
</span><span id=__span-0-117><a id=__codelineno-0-117 name=__codelineno-0-117></a>    <span class=n>metrics_file</span> <span class=o>=</span> <span class=n>entry_path</span> <span class=o>/</span> <span class=s2>&quot;metrics.json&quot;</span>
</span><span id=__span-0-118><a id=__codelineno-0-118 name=__codelineno-0-118></a>    <span class=k>with</span> <span class=n>metrics_file</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=s2>&quot;w&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-119><a id=__codelineno-0-119 name=__codelineno-0-119></a>        <span class=n>json</span><span class=o>.</span><span class=n>dump</span><span class=p>(</span><span class=n>metrics</span><span class=p>,</span> <span class=n>f</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</span><span id=__span-0-120><a id=__codelineno-0-120 name=__codelineno-0-120></a>
</span><span id=__span-0-121><a id=__codelineno-0-121 name=__codelineno-0-121></a>    <span class=c1># Get solutions from cache in benchmark.py</span>
</span><span id=__span-0-122><a id=__codelineno-0-122 name=__codelineno-0-122></a>    <span class=n>cache</span> <span class=o>=</span> <span class=n>BenchmarkApi</span><span class=p>()</span><span class=o>.</span><span class=n>get_benchmark_result_v1_benchmark_get_result_get</span><span class=p>(</span><span class=n>benchmark_id</span><span class=p>)</span>
</span><span id=__span-0-123><a id=__codelineno-0-123 name=__codelineno-0-123></a>    <span class=n>solutions</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-0-124><a id=__codelineno-0-124 name=__codelineno-0-124></a>    <span class=k>for</span> <span class=n>result</span> <span class=ow>in</span> <span class=n>cache</span><span class=p>:</span>
</span><span id=__span-0-125><a id=__codelineno-0-125 name=__codelineno-0-125></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-126><a id=__codelineno-0-126 name=__codelineno-0-126></a>            <span class=n>solution</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-127><a id=__codelineno-0-127 name=__codelineno-0-127></a>                <span class=s2>&quot;datum&quot;</span><span class=p>:</span> <span class=n>data_tasks</span><span class=p>[</span><span class=n>result</span><span class=o>.</span><span class=n>index</span><span class=p>],</span>
</span><span id=__span-0-128><a id=__codelineno-0-128 name=__codelineno-0-128></a>                <span class=s2>&quot;status&quot;</span><span class=p>:</span> <span class=n>result</span><span class=o>.</span><span class=n>solved</span><span class=p>,</span>
</span><span id=__span-0-129><a id=__codelineno-0-129 name=__codelineno-0-129></a>                <span class=s2>&quot;info&quot;</span><span class=p>:</span> <span class=n>load_benchmark_entry_info</span><span class=p>(</span><span class=n>result</span><span class=o>.</span><span class=n>info</span><span class=p>)</span> <span class=k>if</span> <span class=n>result</span><span class=o>.</span><span class=n>info</span> <span class=k>else</span> <span class=p>{},</span>
</span><span id=__span-0-130><a id=__codelineno-0-130 name=__codelineno-0-130></a>            <span class=p>}</span>
</span><span id=__span-0-131><a id=__codelineno-0-131 name=__codelineno-0-131></a>            <span class=n>solutions</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>solution</span><span class=p>)</span>
</span><span id=__span-0-132><a id=__codelineno-0-132 name=__codelineno-0-132></a>        <span class=k>except</span> <span class=p>(</span><span class=ne>AttributeError</span><span class=p>,</span> <span class=n>json</span><span class=o>.</span><span class=n>JSONDecodeError</span><span class=p>,</span> <span class=ne>TypeError</span><span class=p>)</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-133><a id=__codelineno-0-133 name=__codelineno-0-133></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Exception while creating solutions data: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>.&quot;</span><span class=p>)</span>
</span><span id=__span-0-134><a id=__codelineno-0-134 name=__codelineno-0-134></a>            <span class=c1># Skip entries that can&#39;t be properly formatted</span>
</span><span id=__span-0-135><a id=__codelineno-0-135 name=__codelineno-0-135></a>            <span class=k>continue</span>
</span><span id=__span-0-136><a id=__codelineno-0-136 name=__codelineno-0-136></a>
</span><span id=__span-0-137><a id=__codelineno-0-137 name=__codelineno-0-137></a>    <span class=c1># Write solutions file</span>
</span><span id=__span-0-138><a id=__codelineno-0-138 name=__codelineno-0-138></a>    <span class=n>solutions_file</span> <span class=o>=</span> <span class=n>entry_path</span> <span class=o>/</span> <span class=s2>&quot;solutions.json&quot;</span>
</span><span id=__span-0-139><a id=__codelineno-0-139 name=__codelineno-0-139></a>    <span class=k>with</span> <span class=n>solutions_file</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=s2>&quot;w&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-140><a id=__codelineno-0-140 name=__codelineno-0-140></a>        <span class=n>json</span><span class=o>.</span><span class=n>dump</span><span class=p>(</span><span class=n>solutions</span><span class=p>,</span> <span class=n>f</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</span><span id=__span-0-141><a id=__codelineno-0-141 name=__codelineno-0-141></a>
</span><span id=__span-0-142><a id=__codelineno-0-142 name=__codelineno-0-142></a>    <span class=n>metadata_path</span> <span class=o>=</span> <span class=n>entry_path</span> <span class=o>/</span> <span class=s2>&quot;metadata.json&quot;</span>
</span><span id=__span-0-143><a id=__codelineno-0-143 name=__codelineno-0-143></a>    <span class=c1># TODO(#273): Currently that will not update existing evaluation.</span>
</span><span id=__span-0-144><a id=__codelineno-0-144 name=__codelineno-0-144></a>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>metadata_path</span><span class=p>,</span> <span class=s2>&quot;w&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-145><a id=__codelineno-0-145 name=__codelineno-0-145></a>        <span class=n>json</span><span class=o>.</span><span class=n>dump</span><span class=p>(</span>
</span><span id=__span-0-146><a id=__codelineno-0-146 name=__codelineno-0-146></a>            <span class=p>{</span>
</span><span id=__span-0-147><a id=__codelineno-0-147 name=__codelineno-0-147></a>                <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=n>key</span><span class=p>,</span>
</span><span id=__span-0-148><a id=__codelineno-0-148 name=__codelineno-0-148></a>                <span class=s2>&quot;version&quot;</span><span class=p>:</span> <span class=s2>&quot;0.1.0&quot;</span><span class=p>,</span>
</span><span id=__span-0-149><a id=__codelineno-0-149 name=__codelineno-0-149></a>                <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-150><a id=__codelineno-0-150 name=__codelineno-0-150></a>                <span class=s2>&quot;category&quot;</span><span class=p>:</span> <span class=s2>&quot;evaluation&quot;</span><span class=p>,</span>
</span><span id=__span-0-151><a id=__codelineno-0-151 name=__codelineno-0-151></a>                <span class=s2>&quot;tags&quot;</span><span class=p>:</span> <span class=p>[],</span>
</span><span id=__span-0-152><a id=__codelineno-0-152 name=__codelineno-0-152></a>                <span class=s2>&quot;details&quot;</span><span class=p>:</span> <span class=p>{},</span>
</span><span id=__span-0-153><a id=__codelineno-0-153 name=__codelineno-0-153></a>                <span class=s2>&quot;show_entry&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-154><a id=__codelineno-0-154 name=__codelineno-0-154></a>            <span class=p>},</span>
</span><span id=__span-0-155><a id=__codelineno-0-155 name=__codelineno-0-155></a>            <span class=n>f</span><span class=p>,</span>
</span><span id=__span-0-156><a id=__codelineno-0-156 name=__codelineno-0-156></a>            <span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>
</span><span id=__span-0-157><a id=__codelineno-0-157 name=__codelineno-0-157></a>        <span class=p>)</span>
</span><span id=__span-0-158><a id=__codelineno-0-158 name=__codelineno-0-158></a>
</span><span id=__span-0-159><a id=__codelineno-0-159 name=__codelineno-0-159></a>    <span class=n>registry</span><span class=o>.</span><span class=n>upload</span><span class=p>(</span><span class=n>Path</span><span class=p>(</span><span class=n>entry_path</span><span class=p>),</span> <span class=n>show_progress</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-module"> <h3 id=nearai.finetune class="doc doc-heading"> <span class="doc doc-object-name doc-module-name">finetune</span> <a href=#nearai.finetune class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h4 id=nearai.finetune.FinetuneCli class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">FinetuneCli</span> <a href=#nearai.finetune.FinetuneCli class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <details class=quote> <summary>Source code in <code>nearai/finetune/__init__.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-19> 19</a></span>
<span class=normal><a href=#__codelineno-0-20> 20</a></span>
<span class=normal><a href=#__codelineno-0-21> 21</a></span>
<span class=normal><a href=#__codelineno-0-22> 22</a></span>
<span class=normal><a href=#__codelineno-0-23> 23</a></span>
<span class=normal><a href=#__codelineno-0-24> 24</a></span>
<span class=normal><a href=#__codelineno-0-25> 25</a></span>
<span class=normal><a href=#__codelineno-0-26> 26</a></span>
<span class=normal><a href=#__codelineno-0-27> 27</a></span>
<span class=normal><a href=#__codelineno-0-28> 28</a></span>
<span class=normal><a href=#__codelineno-0-29> 29</a></span>
<span class=normal><a href=#__codelineno-0-30> 30</a></span>
<span class=normal><a href=#__codelineno-0-31> 31</a></span>
<span class=normal><a href=#__codelineno-0-32> 32</a></span>
<span class=normal><a href=#__codelineno-0-33> 33</a></span>
<span class=normal><a href=#__codelineno-0-34> 34</a></span>
<span class=normal><a href=#__codelineno-0-35> 35</a></span>
<span class=normal><a href=#__codelineno-0-36> 36</a></span>
<span class=normal><a href=#__codelineno-0-37> 37</a></span>
<span class=normal><a href=#__codelineno-0-38> 38</a></span>
<span class=normal><a href=#__codelineno-0-39> 39</a></span>
<span class=normal><a href=#__codelineno-0-40> 40</a></span>
<span class=normal><a href=#__codelineno-0-41> 41</a></span>
<span class=normal><a href=#__codelineno-0-42> 42</a></span>
<span class=normal><a href=#__codelineno-0-43> 43</a></span>
<span class=normal><a href=#__codelineno-0-44> 44</a></span>
<span class=normal><a href=#__codelineno-0-45> 45</a></span>
<span class=normal><a href=#__codelineno-0-46> 46</a></span>
<span class=normal><a href=#__codelineno-0-47> 47</a></span>
<span class=normal><a href=#__codelineno-0-48> 48</a></span>
<span class=normal><a href=#__codelineno-0-49> 49</a></span>
<span class=normal><a href=#__codelineno-0-50> 50</a></span>
<span class=normal><a href=#__codelineno-0-51> 51</a></span>
<span class=normal><a href=#__codelineno-0-52> 52</a></span>
<span class=normal><a href=#__codelineno-0-53> 53</a></span>
<span class=normal><a href=#__codelineno-0-54> 54</a></span>
<span class=normal><a href=#__codelineno-0-55> 55</a></span>
<span class=normal><a href=#__codelineno-0-56> 56</a></span>
<span class=normal><a href=#__codelineno-0-57> 57</a></span>
<span class=normal><a href=#__codelineno-0-58> 58</a></span>
<span class=normal><a href=#__codelineno-0-59> 59</a></span>
<span class=normal><a href=#__codelineno-0-60> 60</a></span>
<span class=normal><a href=#__codelineno-0-61> 61</a></span>
<span class=normal><a href=#__codelineno-0-62> 62</a></span>
<span class=normal><a href=#__codelineno-0-63> 63</a></span>
<span class=normal><a href=#__codelineno-0-64> 64</a></span>
<span class=normal><a href=#__codelineno-0-65> 65</a></span>
<span class=normal><a href=#__codelineno-0-66> 66</a></span>
<span class=normal><a href=#__codelineno-0-67> 67</a></span>
<span class=normal><a href=#__codelineno-0-68> 68</a></span>
<span class=normal><a href=#__codelineno-0-69> 69</a></span>
<span class=normal><a href=#__codelineno-0-70> 70</a></span>
<span class=normal><a href=#__codelineno-0-71> 71</a></span>
<span class=normal><a href=#__codelineno-0-72> 72</a></span>
<span class=normal><a href=#__codelineno-0-73> 73</a></span>
<span class=normal><a href=#__codelineno-0-74> 74</a></span>
<span class=normal><a href=#__codelineno-0-75> 75</a></span>
<span class=normal><a href=#__codelineno-0-76> 76</a></span>
<span class=normal><a href=#__codelineno-0-77> 77</a></span>
<span class=normal><a href=#__codelineno-0-78> 78</a></span>
<span class=normal><a href=#__codelineno-0-79> 79</a></span>
<span class=normal><a href=#__codelineno-0-80> 80</a></span>
<span class=normal><a href=#__codelineno-0-81> 81</a></span>
<span class=normal><a href=#__codelineno-0-82> 82</a></span>
<span class=normal><a href=#__codelineno-0-83> 83</a></span>
<span class=normal><a href=#__codelineno-0-84> 84</a></span>
<span class=normal><a href=#__codelineno-0-85> 85</a></span>
<span class=normal><a href=#__codelineno-0-86> 86</a></span>
<span class=normal><a href=#__codelineno-0-87> 87</a></span>
<span class=normal><a href=#__codelineno-0-88> 88</a></span>
<span class=normal><a href=#__codelineno-0-89> 89</a></span>
<span class=normal><a href=#__codelineno-0-90> 90</a></span>
<span class=normal><a href=#__codelineno-0-91> 91</a></span>
<span class=normal><a href=#__codelineno-0-92> 92</a></span>
<span class=normal><a href=#__codelineno-0-93> 93</a></span>
<span class=normal><a href=#__codelineno-0-94> 94</a></span>
<span class=normal><a href=#__codelineno-0-95> 95</a></span>
<span class=normal><a href=#__codelineno-0-96> 96</a></span>
<span class=normal><a href=#__codelineno-0-97> 97</a></span>
<span class=normal><a href=#__codelineno-0-98> 98</a></span>
<span class=normal><a href=#__codelineno-0-99> 99</a></span>
<span class=normal><a href=#__codelineno-0-100>100</a></span>
<span class=normal><a href=#__codelineno-0-101>101</a></span>
<span class=normal><a href=#__codelineno-0-102>102</a></span>
<span class=normal><a href=#__codelineno-0-103>103</a></span>
<span class=normal><a href=#__codelineno-0-104>104</a></span>
<span class=normal><a href=#__codelineno-0-105>105</a></span>
<span class=normal><a href=#__codelineno-0-106>106</a></span>
<span class=normal><a href=#__codelineno-0-107>107</a></span>
<span class=normal><a href=#__codelineno-0-108>108</a></span>
<span class=normal><a href=#__codelineno-0-109>109</a></span>
<span class=normal><a href=#__codelineno-0-110>110</a></span>
<span class=normal><a href=#__codelineno-0-111>111</a></span>
<span class=normal><a href=#__codelineno-0-112>112</a></span>
<span class=normal><a href=#__codelineno-0-113>113</a></span>
<span class=normal><a href=#__codelineno-0-114>114</a></span>
<span class=normal><a href=#__codelineno-0-115>115</a></span>
<span class=normal><a href=#__codelineno-0-116>116</a></span>
<span class=normal><a href=#__codelineno-0-117>117</a></span>
<span class=normal><a href=#__codelineno-0-118>118</a></span>
<span class=normal><a href=#__codelineno-0-119>119</a></span>
<span class=normal><a href=#__codelineno-0-120>120</a></span>
<span class=normal><a href=#__codelineno-0-121>121</a></span>
<span class=normal><a href=#__codelineno-0-122>122</a></span>
<span class=normal><a href=#__codelineno-0-123>123</a></span>
<span class=normal><a href=#__codelineno-0-124>124</a></span>
<span class=normal><a href=#__codelineno-0-125>125</a></span>
<span class=normal><a href=#__codelineno-0-126>126</a></span>
<span class=normal><a href=#__codelineno-0-127>127</a></span>
<span class=normal><a href=#__codelineno-0-128>128</a></span>
<span class=normal><a href=#__codelineno-0-129>129</a></span>
<span class=normal><a href=#__codelineno-0-130>130</a></span>
<span class=normal><a href=#__codelineno-0-131>131</a></span>
<span class=normal><a href=#__codelineno-0-132>132</a></span>
<span class=normal><a href=#__codelineno-0-133>133</a></span>
<span class=normal><a href=#__codelineno-0-134>134</a></span>
<span class=normal><a href=#__codelineno-0-135>135</a></span>
<span class=normal><a href=#__codelineno-0-136>136</a></span>
<span class=normal><a href=#__codelineno-0-137>137</a></span>
<span class=normal><a href=#__codelineno-0-138>138</a></span>
<span class=normal><a href=#__codelineno-0-139>139</a></span>
<span class=normal><a href=#__codelineno-0-140>140</a></span>
<span class=normal><a href=#__codelineno-0-141>141</a></span>
<span class=normal><a href=#__codelineno-0-142>142</a></span>
<span class=normal><a href=#__codelineno-0-143>143</a></span>
<span class=normal><a href=#__codelineno-0-144>144</a></span>
<span class=normal><a href=#__codelineno-0-145>145</a></span>
<span class=normal><a href=#__codelineno-0-146>146</a></span>
<span class=normal><a href=#__codelineno-0-147>147</a></span>
<span class=normal><a href=#__codelineno-0-148>148</a></span>
<span class=normal><a href=#__codelineno-0-149>149</a></span>
<span class=normal><a href=#__codelineno-0-150>150</a></span>
<span class=normal><a href=#__codelineno-0-151>151</a></span>
<span class=normal><a href=#__codelineno-0-152>152</a></span>
<span class=normal><a href=#__codelineno-0-153>153</a></span>
<span class=normal><a href=#__codelineno-0-154>154</a></span>
<span class=normal><a href=#__codelineno-0-155>155</a></span>
<span class=normal><a href=#__codelineno-0-156>156</a></span>
<span class=normal><a href=#__codelineno-0-157>157</a></span>
<span class=normal><a href=#__codelineno-0-158>158</a></span>
<span class=normal><a href=#__codelineno-0-159>159</a></span>
<span class=normal><a href=#__codelineno-0-160>160</a></span>
<span class=normal><a href=#__codelineno-0-161>161</a></span>
<span class=normal><a href=#__codelineno-0-162>162</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19></a><span class=k>class</span><span class=w> </span><span class=nc>FinetuneCli</span><span class=p>:</span>
</span><span id=__span-0-20><a id=__codelineno-0-20 name=__codelineno-0-20></a>    <span class=k>def</span><span class=w> </span><span class=nf>start</span><span class=p>(</span>
</span><span id=__span-0-21><a id=__codelineno-0-21 name=__codelineno-0-21></a>        <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-22><a id=__codelineno-0-22 name=__codelineno-0-22></a>        <span class=n>model</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-23><a id=__codelineno-0-23 name=__codelineno-0-23></a>        <span class=n>tokenizer</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-24><a id=__codelineno-0-24 name=__codelineno-0-24></a>        <span class=n>dataset</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-25><a id=__codelineno-0-25 name=__codelineno-0-25></a>        <span class=n>num_procs</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
</span><span id=__span-0-26><a id=__codelineno-0-26 name=__codelineno-0-26></a>        <span class=nb>format</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-27><a id=__codelineno-0-27 name=__codelineno-0-27></a>        <span class=n>upload_checkpoint</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-28><a id=__codelineno-0-28 name=__codelineno-0-28></a>        <span class=n>num_nodes</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>1</span><span class=p>,</span>
</span><span id=__span-0-29><a id=__codelineno-0-29 name=__codelineno-0-29></a>        <span class=n>job_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-30><a id=__codelineno-0-30 name=__codelineno-0-30></a>        <span class=n>checkpoint</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-31><a id=__codelineno-0-31 name=__codelineno-0-31></a>        <span class=o>**</span><span class=n>dataset_kwargs</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span>
</span><span id=__span-0-32><a id=__codelineno-0-32 name=__codelineno-0-32></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-33><a id=__codelineno-0-33 name=__codelineno-0-33></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Start a finetuning job on the current node.</span>
</span><span id=__span-0-34><a id=__codelineno-0-34 name=__codelineno-0-34></a>
</span><span id=__span-0-35><a id=__codelineno-0-35 name=__codelineno-0-35></a><span class=sd>        Args:</span>
</span><span id=__span-0-36><a id=__codelineno-0-36 name=__codelineno-0-36></a><span class=sd>        ----</span>
</span><span id=__span-0-37><a id=__codelineno-0-37 name=__codelineno-0-37></a><span class=sd>            model: Name of a model in the registry. Base model to finetune.</span>
</span><span id=__span-0-38><a id=__codelineno-0-38 name=__codelineno-0-38></a><span class=sd>            tokenizer: Name of a tokenizer in the registry. Using tokenizer.model format.</span>
</span><span id=__span-0-39><a id=__codelineno-0-39 name=__codelineno-0-39></a><span class=sd>            dataset: Name of a dataset in the registry.</span>
</span><span id=__span-0-40><a id=__codelineno-0-40 name=__codelineno-0-40></a><span class=sd>            num_procs: Number of GPUs to use for training</span>
</span><span id=__span-0-41><a id=__codelineno-0-41 name=__codelineno-0-41></a><span class=sd>            format: Name of the configuration file to use. For example llama3-70b, llama3-8b. Valid options are in etc/finetune.</span>
</span><span id=__span-0-42><a id=__codelineno-0-42 name=__codelineno-0-42></a><span class=sd>            upload_checkpoint: Whether to upload the checkpoint to the registry. Default is True.</span>
</span><span id=__span-0-43><a id=__codelineno-0-43 name=__codelineno-0-43></a><span class=sd>            num_nodes: Number of nodes to use for training. Default is 1.</span>
</span><span id=__span-0-44><a id=__codelineno-0-44 name=__codelineno-0-44></a><span class=sd>            job_id: Unique identifier for the job. Default is None.</span>
</span><span id=__span-0-45><a id=__codelineno-0-45 name=__codelineno-0-45></a><span class=sd>            checkpoint: Name of the model checkpoint to start from. Default is None.</span>
</span><span id=__span-0-46><a id=__codelineno-0-46 name=__codelineno-0-46></a><span class=sd>            dataset_kwargs: Additional keyword arguments to pass to the dataset constructor.</span>
</span><span id=__span-0-47><a id=__codelineno-0-47 name=__codelineno-0-47></a>
</span><span id=__span-0-48><a id=__codelineno-0-48 name=__codelineno-0-48></a><span class=sd>        &quot;&quot;&quot;</span>  <span class=c1># noqa: E501</span>
</span><span id=__span-0-49><a id=__codelineno-0-49 name=__codelineno-0-49></a>        <span class=kn>from</span><span class=w> </span><span class=nn>nearai.dataset</span><span class=w> </span><span class=kn>import</span> <span class=n>get_dataset</span>
</span><span id=__span-0-50><a id=__codelineno-0-50 name=__codelineno-0-50></a>
</span><span id=__span-0-51><a id=__codelineno-0-51 name=__codelineno-0-51></a>        <span class=k>assert</span> <span class=n>num_nodes</span> <span class=o>&gt;=</span> <span class=mi>1</span>
</span><span id=__span-0-52><a id=__codelineno-0-52 name=__codelineno-0-52></a>
</span><span id=__span-0-53><a id=__codelineno-0-53 name=__codelineno-0-53></a>        <span class=c1># Prepare job id folder</span>
</span><span id=__span-0-54><a id=__codelineno-0-54 name=__codelineno-0-54></a>        <span class=k>if</span> <span class=n>job_id</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-55><a id=__codelineno-0-55 name=__codelineno-0-55></a>            <span class=n>job_id</span> <span class=o>=</span> <span class=s2>&quot;job&quot;</span>
</span><span id=__span-0-56><a id=__codelineno-0-56 name=__codelineno-0-56></a>        <span class=n>job_id</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>job_id</span><span class=si>}</span><span class=s2>-</span><span class=si>{</span><span class=n>timestamp</span><span class=p>()</span><span class=si>}</span><span class=s2>-</span><span class=si>{</span><span class=n>randint</span><span class=p>(</span><span class=mi>10</span><span class=o>**</span><span class=mi>8</span><span class=p>,</span><span class=w> </span><span class=mi>10</span><span class=o>**</span><span class=mi>9</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-57><a id=__codelineno-0-57 name=__codelineno-0-57></a>        <span class=n>job_folder</span> <span class=o>=</span> <span class=n>DATA_FOLDER</span> <span class=o>/</span> <span class=s2>&quot;finetune&quot;</span> <span class=o>/</span> <span class=n>job_id</span>
</span><span id=__span-0-58><a id=__codelineno-0-58 name=__codelineno-0-58></a>        <span class=n>job_folder</span><span class=o>.</span><span class=n>mkdir</span><span class=p>(</span><span class=n>parents</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-59><a id=__codelineno-0-59 name=__codelineno-0-59></a>
</span><span id=__span-0-60><a id=__codelineno-0-60 name=__codelineno-0-60></a>        <span class=c1># Either use the provided config file template or load one predefined one</span>
</span><span id=__span-0-61><a id=__codelineno-0-61 name=__codelineno-0-61></a>        <span class=k>if</span> <span class=n>Path</span><span class=p>(</span><span class=nb>format</span><span class=p>)</span><span class=o>.</span><span class=n>exists</span><span class=p>():</span>
</span><span id=__span-0-62><a id=__codelineno-0-62 name=__codelineno-0-62></a>            <span class=n>config_template_path</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=nb>format</span><span class=p>)</span>
</span><span id=__span-0-63><a id=__codelineno-0-63 name=__codelineno-0-63></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-64><a id=__codelineno-0-64 name=__codelineno-0-64></a>            <span class=n>configs</span> <span class=o>=</span> <span class=n>ETC_FOLDER</span> <span class=o>/</span> <span class=s2>&quot;finetune&quot;</span>
</span><span id=__span-0-65><a id=__codelineno-0-65 name=__codelineno-0-65></a>            <span class=n>config_template_path</span> <span class=o>=</span> <span class=n>configs</span> <span class=o>/</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=nb>format</span><span class=si>}</span><span class=s2>.yml&quot;</span>
</span><span id=__span-0-66><a id=__codelineno-0-66 name=__codelineno-0-66></a>
</span><span id=__span-0-67><a id=__codelineno-0-67 name=__codelineno-0-67></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>config_template_path</span><span class=o>.</span><span class=n>exists</span><span class=p>():</span>
</span><span id=__span-0-68><a id=__codelineno-0-68 name=__codelineno-0-68></a>            <span class=k>raise</span> <span class=ne>FileNotFoundError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Config file not found: </span><span class=si>{</span><span class=n>config_template_path</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-69><a id=__codelineno-0-69 name=__codelineno-0-69></a>
</span><span id=__span-0-70><a id=__codelineno-0-70 name=__codelineno-0-70></a>        <span class=n>CONFIG_TEMPLATE</span> <span class=o>=</span> <span class=n>config_template_path</span><span class=o>.</span><span class=n>read_text</span><span class=p>()</span>  <span class=c1># noqa: N806</span>
</span><span id=__span-0-71><a id=__codelineno-0-71 name=__codelineno-0-71></a>
</span><span id=__span-0-72><a id=__codelineno-0-72 name=__codelineno-0-72></a>        <span class=c1># Download model</span>
</span><span id=__span-0-73><a id=__codelineno-0-73 name=__codelineno-0-73></a>        <span class=n>model_path</span> <span class=o>=</span> <span class=n>get_model</span><span class=p>(</span><span class=n>model</span><span class=p>)</span>
</span><span id=__span-0-74><a id=__codelineno-0-74 name=__codelineno-0-74></a>
</span><span id=__span-0-75><a id=__codelineno-0-75 name=__codelineno-0-75></a>        <span class=c1># Download tokenizer</span>
</span><span id=__span-0-76><a id=__codelineno-0-76 name=__codelineno-0-76></a>        <span class=n>tokenizer_path</span> <span class=o>=</span> <span class=n>registry</span><span class=o>.</span><span class=n>download</span><span class=p>(</span><span class=n>tokenizer</span><span class=p>)</span> <span class=o>/</span> <span class=s2>&quot;tokenizer.model&quot;</span>
</span><span id=__span-0-77><a id=__codelineno-0-77 name=__codelineno-0-77></a>        <span class=k>assert</span> <span class=n>tokenizer_path</span><span class=o>.</span><span class=n>exists</span><span class=p>(),</span> <span class=sa>f</span><span class=s2>&quot;tokenizer.model not found in </span><span class=si>{</span><span class=n>tokenizer_path</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-78><a id=__codelineno-0-78 name=__codelineno-0-78></a>
</span><span id=__span-0-79><a id=__codelineno-0-79 name=__codelineno-0-79></a>        <span class=c1># Download checkpoint if any</span>
</span><span id=__span-0-80><a id=__codelineno-0-80 name=__codelineno-0-80></a>        <span class=n>checkpoint_path</span> <span class=o>=</span> <span class=n>get_model</span><span class=p>(</span><span class=n>checkpoint</span><span class=p>)</span> <span class=k>if</span> <span class=n>checkpoint</span> <span class=k>else</span> <span class=s2>&quot;null&quot;</span>
</span><span id=__span-0-81><a id=__codelineno-0-81 name=__codelineno-0-81></a>        <span class=n>resume_checkpoint</span> <span class=o>=</span> <span class=n>checkpoint_path</span> <span class=o>!=</span> <span class=s2>&quot;null&quot;</span>
</span><span id=__span-0-82><a id=__codelineno-0-82 name=__codelineno-0-82></a>
</span><span id=__span-0-83><a id=__codelineno-0-83 name=__codelineno-0-83></a>        <span class=c1># Download dataset</span>
</span><span id=__span-0-84><a id=__codelineno-0-84 name=__codelineno-0-84></a>        <span class=n>dataset_path</span> <span class=o>=</span> <span class=n>get_dataset</span><span class=p>(</span><span class=n>dataset</span><span class=p>)</span>
</span><span id=__span-0-85><a id=__codelineno-0-85 name=__codelineno-0-85></a>
</span><span id=__span-0-86><a id=__codelineno-0-86 name=__codelineno-0-86></a>        <span class=c1># Set up output directories</span>
</span><span id=__span-0-87><a id=__codelineno-0-87 name=__codelineno-0-87></a>        <span class=n>checkpoint_output_dir</span> <span class=o>=</span> <span class=n>job_folder</span> <span class=o>/</span> <span class=s2>&quot;checkpoint_output&quot;</span>
</span><span id=__span-0-88><a id=__codelineno-0-88 name=__codelineno-0-88></a>        <span class=n>logging_output_dir</span> <span class=o>=</span> <span class=n>job_folder</span> <span class=o>/</span> <span class=s2>&quot;logs&quot;</span>
</span><span id=__span-0-89><a id=__codelineno-0-89 name=__codelineno-0-89></a>        <span class=n>logging_output_dir</span><span class=o>.</span><span class=n>mkdir</span><span class=p>(</span><span class=n>parents</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-90><a id=__codelineno-0-90 name=__codelineno-0-90></a>
</span><span id=__span-0-91><a id=__codelineno-0-91 name=__codelineno-0-91></a>        <span class=c1># Prepare config file</span>
</span><span id=__span-0-92><a id=__codelineno-0-92 name=__codelineno-0-92></a>        <span class=n>dataset_args_dict</span> <span class=o>=</span> <span class=n>deepcopy</span><span class=p>(</span><span class=n>dataset_kwargs</span><span class=p>)</span>
</span><span id=__span-0-93><a id=__codelineno-0-93 name=__codelineno-0-93></a>
</span><span id=__span-0-94><a id=__codelineno-0-94 name=__codelineno-0-94></a>        <span class=n>dataset_args_dict</span><span class=p>[</span><span class=s2>&quot;_component_&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>dataset_args_dict</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;method&quot;</span><span class=p>)</span>
</span><span id=__span-0-95><a id=__codelineno-0-95 name=__codelineno-0-95></a>        <span class=n>dataset_args_dict</span><span class=p>[</span><span class=s2>&quot;source&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>dataset_path</span><span class=o>.</span><span class=n>absolute</span><span class=p>())</span>
</span><span id=__span-0-96><a id=__codelineno-0-96 name=__codelineno-0-96></a>        <span class=n>dataset_args</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;  </span><span class=si>{</span><span class=n>key</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>value</span><span class=si>}</span><span class=s2>&quot;</span> <span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>dataset_args_dict</span><span class=o>.</span><span class=n>items</span><span class=p>())</span>
</span><span id=__span-0-97><a id=__codelineno-0-97 name=__codelineno-0-97></a>
</span><span id=__span-0-98><a id=__codelineno-0-98 name=__codelineno-0-98></a>        <span class=n>config</span> <span class=o>=</span> <span class=n>job_folder</span> <span class=o>/</span> <span class=s2>&quot;config.yaml&quot;</span>
</span><span id=__span-0-99><a id=__codelineno-0-99 name=__codelineno-0-99></a>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>config</span><span class=p>,</span> <span class=s2>&quot;w&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-100><a id=__codelineno-0-100 name=__codelineno-0-100></a>            <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span>
</span><span id=__span-0-101><a id=__codelineno-0-101 name=__codelineno-0-101></a>                <span class=n>CONFIG_TEMPLATE</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
</span><span id=__span-0-102><a id=__codelineno-0-102 name=__codelineno-0-102></a>                    <span class=n>TOKENIZER</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>tokenizer_path</span><span class=p>),</span>
</span><span id=__span-0-103><a id=__codelineno-0-103 name=__codelineno-0-103></a>                    <span class=n>MODEL</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>model_path</span><span class=p>),</span>
</span><span id=__span-0-104><a id=__codelineno-0-104 name=__codelineno-0-104></a>                    <span class=n>RECIPE_CHECKPOINT</span><span class=o>=</span><span class=n>checkpoint_path</span><span class=p>,</span>
</span><span id=__span-0-105><a id=__codelineno-0-105 name=__codelineno-0-105></a>                    <span class=n>RESUME_FROM_CHECKPOINT</span><span class=o>=</span><span class=n>resume_checkpoint</span><span class=p>,</span>
</span><span id=__span-0-106><a id=__codelineno-0-106 name=__codelineno-0-106></a>                    <span class=n>CHECKPOINT_OUTPUT_DIR</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>checkpoint_output_dir</span><span class=p>),</span>
</span><span id=__span-0-107><a id=__codelineno-0-107 name=__codelineno-0-107></a>                    <span class=n>DATASET_ARGS</span><span class=o>=</span><span class=n>dataset_args</span><span class=p>,</span>
</span><span id=__span-0-108><a id=__codelineno-0-108 name=__codelineno-0-108></a>                    <span class=n>LOGGING_OUTPUT_DIR</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>logging_output_dir</span><span class=p>),</span>
</span><span id=__span-0-109><a id=__codelineno-0-109 name=__codelineno-0-109></a>                <span class=p>)</span>
</span><span id=__span-0-110><a id=__codelineno-0-110 name=__codelineno-0-110></a>            <span class=p>)</span>
</span><span id=__span-0-111><a id=__codelineno-0-111 name=__codelineno-0-111></a>
</span><span id=__span-0-112><a id=__codelineno-0-112 name=__codelineno-0-112></a>        <span class=c1># Spawn background thread to read logs and push to database</span>
</span><span id=__span-0-113><a id=__codelineno-0-113 name=__codelineno-0-113></a>        <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>find_new_logs_background</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=n>logging_output_dir</span><span class=p>,</span> <span class=n>job_id</span><span class=p>))</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span><span id=__span-0-114><a id=__codelineno-0-114 name=__codelineno-0-114></a>
</span><span id=__span-0-115><a id=__codelineno-0-115 name=__codelineno-0-115></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Starting job at&quot;</span><span class=p>,</span> <span class=n>job_folder</span><span class=p>)</span>
</span><span id=__span-0-116><a id=__codelineno-0-116 name=__codelineno-0-116></a>        <span class=k>if</span> <span class=n>num_nodes</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
</span><span id=__span-0-117><a id=__codelineno-0-117 name=__codelineno-0-117></a>            <span class=n>run</span><span class=p>(</span>
</span><span id=__span-0-118><a id=__codelineno-0-118 name=__codelineno-0-118></a>                <span class=p>[</span>
</span><span id=__span-0-119><a id=__codelineno-0-119 name=__codelineno-0-119></a>                    <span class=s2>&quot;tune&quot;</span><span class=p>,</span>
</span><span id=__span-0-120><a id=__codelineno-0-120 name=__codelineno-0-120></a>                    <span class=s2>&quot;run&quot;</span><span class=p>,</span>
</span><span id=__span-0-121><a id=__codelineno-0-121 name=__codelineno-0-121></a>                    <span class=s2>&quot;--nproc_per_node&quot;</span><span class=p>,</span>
</span><span id=__span-0-122><a id=__codelineno-0-122 name=__codelineno-0-122></a>                    <span class=nb>str</span><span class=p>(</span><span class=n>num_procs</span><span class=p>),</span>
</span><span id=__span-0-123><a id=__codelineno-0-123 name=__codelineno-0-123></a>                    <span class=s2>&quot;lora_finetune_distributed&quot;</span><span class=p>,</span>
</span><span id=__span-0-124><a id=__codelineno-0-124 name=__codelineno-0-124></a>                    <span class=s2>&quot;--config&quot;</span><span class=p>,</span>
</span><span id=__span-0-125><a id=__codelineno-0-125 name=__codelineno-0-125></a>                    <span class=nb>str</span><span class=p>(</span><span class=n>config</span><span class=p>),</span>
</span><span id=__span-0-126><a id=__codelineno-0-126 name=__codelineno-0-126></a>                <span class=p>]</span>
</span><span id=__span-0-127><a id=__codelineno-0-127 name=__codelineno-0-127></a>            <span class=p>)</span>
</span><span id=__span-0-128><a id=__codelineno-0-128 name=__codelineno-0-128></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-129><a id=__codelineno-0-129 name=__codelineno-0-129></a>            <span class=c1># Fetch rank and master addr from environment variables</span>
</span><span id=__span-0-130><a id=__codelineno-0-130 name=__codelineno-0-130></a>            <span class=k>raise</span> <span class=ne>NotImplementedError</span><span class=p>()</span>
</span><span id=__span-0-131><a id=__codelineno-0-131 name=__codelineno-0-131></a>
</span><span id=__span-0-132><a id=__codelineno-0-132 name=__codelineno-0-132></a>        <span class=k>global</span> <span class=n>BACKGROUND_PROCESS</span>
</span><span id=__span-0-133><a id=__codelineno-0-133 name=__codelineno-0-133></a>        <span class=n>BACKGROUND_PROCESS</span> <span class=o>=</span> <span class=kc>False</span>
</span><span id=__span-0-134><a id=__codelineno-0-134 name=__codelineno-0-134></a>
</span><span id=__span-0-135><a id=__codelineno-0-135 name=__codelineno-0-135></a>        <span class=k>if</span> <span class=n>upload_checkpoint</span><span class=p>:</span>
</span><span id=__span-0-136><a id=__codelineno-0-136 name=__codelineno-0-136></a>            <span class=n>registry</span><span class=o>.</span><span class=n>upload</span><span class=p>(</span>
</span><span id=__span-0-137><a id=__codelineno-0-137 name=__codelineno-0-137></a>                <span class=n>job_folder</span><span class=p>,</span>
</span><span id=__span-0-138><a id=__codelineno-0-138 name=__codelineno-0-138></a>                <span class=n>EntryMetadata</span><span class=o>.</span><span class=n>from_dict</span><span class=p>(</span>
</span><span id=__span-0-139><a id=__codelineno-0-139 name=__codelineno-0-139></a>                    <span class=p>{</span>
</span><span id=__span-0-140><a id=__codelineno-0-140 name=__codelineno-0-140></a>                        <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;finetune-</span><span class=si>{</span><span class=n>job_id</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-0-141><a id=__codelineno-0-141 name=__codelineno-0-141></a>                        <span class=s2>&quot;version&quot;</span><span class=p>:</span> <span class=s2>&quot;0.0.1&quot;</span><span class=p>,</span>
</span><span id=__span-0-142><a id=__codelineno-0-142 name=__codelineno-0-142></a>                        <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;Finetuned checkpoint from base mode </span><span class=si>{</span><span class=n>model</span><span class=si>}</span><span class=s2> using dataset </span><span class=si>{</span><span class=n>dataset</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-0-143><a id=__codelineno-0-143 name=__codelineno-0-143></a>                        <span class=s2>&quot;category&quot;</span><span class=p>:</span> <span class=s2>&quot;finetune&quot;</span><span class=p>,</span>
</span><span id=__span-0-144><a id=__codelineno-0-144 name=__codelineno-0-144></a>                        <span class=s2>&quot;tags&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;finetune&quot;</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&quot;base-model-</span><span class=si>{</span><span class=n>model</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&quot;base-dataset-</span><span class=si>{</span><span class=n>dataset</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>],</span>
</span><span id=__span-0-145><a id=__codelineno-0-145 name=__codelineno-0-145></a>                        <span class=s2>&quot;details&quot;</span><span class=p>:</span> <span class=nb>dict</span><span class=p>(</span>
</span><span id=__span-0-146><a id=__codelineno-0-146 name=__codelineno-0-146></a>                            <span class=n>model</span><span class=o>=</span><span class=n>model</span><span class=p>,</span>
</span><span id=__span-0-147><a id=__codelineno-0-147 name=__codelineno-0-147></a>                            <span class=n>tokenizer</span><span class=o>=</span><span class=n>tokenizer</span><span class=p>,</span>
</span><span id=__span-0-148><a id=__codelineno-0-148 name=__codelineno-0-148></a>                            <span class=n>dataset</span><span class=o>=</span><span class=n>dataset</span><span class=p>,</span>
</span><span id=__span-0-149><a id=__codelineno-0-149 name=__codelineno-0-149></a>                            <span class=n>num_procs</span><span class=o>=</span><span class=n>num_procs</span><span class=p>,</span>
</span><span id=__span-0-150><a id=__codelineno-0-150 name=__codelineno-0-150></a>                            <span class=nb>format</span><span class=o>=</span><span class=nb>format</span><span class=p>,</span>
</span><span id=__span-0-151><a id=__codelineno-0-151 name=__codelineno-0-151></a>                            <span class=n>num_nodes</span><span class=o>=</span><span class=n>num_nodes</span><span class=p>,</span>
</span><span id=__span-0-152><a id=__codelineno-0-152 name=__codelineno-0-152></a>                            <span class=n>checkpoint</span><span class=o>=</span><span class=n>checkpoint</span><span class=p>,</span>
</span><span id=__span-0-153><a id=__codelineno-0-153 name=__codelineno-0-153></a>                            <span class=o>**</span><span class=n>dataset_kwargs</span><span class=p>,</span>
</span><span id=__span-0-154><a id=__codelineno-0-154 name=__codelineno-0-154></a>                        <span class=p>),</span>
</span><span id=__span-0-155><a id=__codelineno-0-155 name=__codelineno-0-155></a>                        <span class=s2>&quot;show_entry&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-156><a id=__codelineno-0-156 name=__codelineno-0-156></a>                    <span class=p>}</span>
</span><span id=__span-0-157><a id=__codelineno-0-157 name=__codelineno-0-157></a>                <span class=p>),</span>
</span><span id=__span-0-158><a id=__codelineno-0-158 name=__codelineno-0-158></a>                <span class=n>show_progress</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-159><a id=__codelineno-0-159 name=__codelineno-0-159></a>            <span class=p>)</span>
</span><span id=__span-0-160><a id=__codelineno-0-160 name=__codelineno-0-160></a>
</span><span id=__span-0-161><a id=__codelineno-0-161 name=__codelineno-0-161></a>    <span class=k>def</span><span class=w> </span><span class=nf>inspect</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>job_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-162><a id=__codelineno-0-162 name=__codelineno-0-162></a>        <span class=k>raise</span> <span class=ne>NotImplementedError</span><span class=p>()</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h5 id=nearai.finetune.FinetuneCli.start class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">start</span> <a href=#nearai.finetune.FinetuneCli.start class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>start</span><span class=p>(</span><span class=n>model</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>tokenizer</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>dataset</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>num_procs</span><span class=p>:</span> <span class=n>int</span><span class=p>,</span> <span class=nb>format</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>upload_checkpoint</span><span class=p>:</span> <span class=n>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span> <span class=n>num_nodes</span><span class=p>:</span> <span class=n>int</span> <span class=o>=</span> <span class=mi>1</span><span class=p>,</span> <span class=n>job_id</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>checkpoint</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=o>**</span><span class=n>dataset_kwargs</span><span class=p>:</span> <span class=n><span title=typing.Any>Any</span></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Start a finetuning job on the current node.</p> <hr> <div class="language-text highlight"><pre><span></span><code>model: Name of a model in the registry. Base model to finetune.
tokenizer: Name of a tokenizer in the registry. Using tokenizer.model format.
dataset: Name of a dataset in the registry.
num_procs: Number of GPUs to use for training
format: Name of the configuration file to use. For example llama3-70b, llama3-8b. Valid options are in etc/finetune.
upload_checkpoint: Whether to upload the checkpoint to the registry. Default is True.
num_nodes: Number of nodes to use for training. Default is 1.
job_id: Unique identifier for the job. Default is None.
checkpoint: Name of the model checkpoint to start from. Default is None.
dataset_kwargs: Additional keyword arguments to pass to the dataset constructor.
</code></pre></div> <details class=quote> <summary>Source code in <code>nearai/finetune/__init__.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-20> 20</a></span>
<span class=normal><a href=#__codelineno-0-21> 21</a></span>
<span class=normal><a href=#__codelineno-0-22> 22</a></span>
<span class=normal><a href=#__codelineno-0-23> 23</a></span>
<span class=normal><a href=#__codelineno-0-24> 24</a></span>
<span class=normal><a href=#__codelineno-0-25> 25</a></span>
<span class=normal><a href=#__codelineno-0-26> 26</a></span>
<span class=normal><a href=#__codelineno-0-27> 27</a></span>
<span class=normal><a href=#__codelineno-0-28> 28</a></span>
<span class=normal><a href=#__codelineno-0-29> 29</a></span>
<span class=normal><a href=#__codelineno-0-30> 30</a></span>
<span class=normal><a href=#__codelineno-0-31> 31</a></span>
<span class=normal><a href=#__codelineno-0-32> 32</a></span>
<span class=normal><a href=#__codelineno-0-33> 33</a></span>
<span class=normal><a href=#__codelineno-0-34> 34</a></span>
<span class=normal><a href=#__codelineno-0-35> 35</a></span>
<span class=normal><a href=#__codelineno-0-36> 36</a></span>
<span class=normal><a href=#__codelineno-0-37> 37</a></span>
<span class=normal><a href=#__codelineno-0-38> 38</a></span>
<span class=normal><a href=#__codelineno-0-39> 39</a></span>
<span class=normal><a href=#__codelineno-0-40> 40</a></span>
<span class=normal><a href=#__codelineno-0-41> 41</a></span>
<span class=normal><a href=#__codelineno-0-42> 42</a></span>
<span class=normal><a href=#__codelineno-0-43> 43</a></span>
<span class=normal><a href=#__codelineno-0-44> 44</a></span>
<span class=normal><a href=#__codelineno-0-45> 45</a></span>
<span class=normal><a href=#__codelineno-0-46> 46</a></span>
<span class=normal><a href=#__codelineno-0-47> 47</a></span>
<span class=normal><a href=#__codelineno-0-48> 48</a></span>
<span class=normal><a href=#__codelineno-0-49> 49</a></span>
<span class=normal><a href=#__codelineno-0-50> 50</a></span>
<span class=normal><a href=#__codelineno-0-51> 51</a></span>
<span class=normal><a href=#__codelineno-0-52> 52</a></span>
<span class=normal><a href=#__codelineno-0-53> 53</a></span>
<span class=normal><a href=#__codelineno-0-54> 54</a></span>
<span class=normal><a href=#__codelineno-0-55> 55</a></span>
<span class=normal><a href=#__codelineno-0-56> 56</a></span>
<span class=normal><a href=#__codelineno-0-57> 57</a></span>
<span class=normal><a href=#__codelineno-0-58> 58</a></span>
<span class=normal><a href=#__codelineno-0-59> 59</a></span>
<span class=normal><a href=#__codelineno-0-60> 60</a></span>
<span class=normal><a href=#__codelineno-0-61> 61</a></span>
<span class=normal><a href=#__codelineno-0-62> 62</a></span>
<span class=normal><a href=#__codelineno-0-63> 63</a></span>
<span class=normal><a href=#__codelineno-0-64> 64</a></span>
<span class=normal><a href=#__codelineno-0-65> 65</a></span>
<span class=normal><a href=#__codelineno-0-66> 66</a></span>
<span class=normal><a href=#__codelineno-0-67> 67</a></span>
<span class=normal><a href=#__codelineno-0-68> 68</a></span>
<span class=normal><a href=#__codelineno-0-69> 69</a></span>
<span class=normal><a href=#__codelineno-0-70> 70</a></span>
<span class=normal><a href=#__codelineno-0-71> 71</a></span>
<span class=normal><a href=#__codelineno-0-72> 72</a></span>
<span class=normal><a href=#__codelineno-0-73> 73</a></span>
<span class=normal><a href=#__codelineno-0-74> 74</a></span>
<span class=normal><a href=#__codelineno-0-75> 75</a></span>
<span class=normal><a href=#__codelineno-0-76> 76</a></span>
<span class=normal><a href=#__codelineno-0-77> 77</a></span>
<span class=normal><a href=#__codelineno-0-78> 78</a></span>
<span class=normal><a href=#__codelineno-0-79> 79</a></span>
<span class=normal><a href=#__codelineno-0-80> 80</a></span>
<span class=normal><a href=#__codelineno-0-81> 81</a></span>
<span class=normal><a href=#__codelineno-0-82> 82</a></span>
<span class=normal><a href=#__codelineno-0-83> 83</a></span>
<span class=normal><a href=#__codelineno-0-84> 84</a></span>
<span class=normal><a href=#__codelineno-0-85> 85</a></span>
<span class=normal><a href=#__codelineno-0-86> 86</a></span>
<span class=normal><a href=#__codelineno-0-87> 87</a></span>
<span class=normal><a href=#__codelineno-0-88> 88</a></span>
<span class=normal><a href=#__codelineno-0-89> 89</a></span>
<span class=normal><a href=#__codelineno-0-90> 90</a></span>
<span class=normal><a href=#__codelineno-0-91> 91</a></span>
<span class=normal><a href=#__codelineno-0-92> 92</a></span>
<span class=normal><a href=#__codelineno-0-93> 93</a></span>
<span class=normal><a href=#__codelineno-0-94> 94</a></span>
<span class=normal><a href=#__codelineno-0-95> 95</a></span>
<span class=normal><a href=#__codelineno-0-96> 96</a></span>
<span class=normal><a href=#__codelineno-0-97> 97</a></span>
<span class=normal><a href=#__codelineno-0-98> 98</a></span>
<span class=normal><a href=#__codelineno-0-99> 99</a></span>
<span class=normal><a href=#__codelineno-0-100>100</a></span>
<span class=normal><a href=#__codelineno-0-101>101</a></span>
<span class=normal><a href=#__codelineno-0-102>102</a></span>
<span class=normal><a href=#__codelineno-0-103>103</a></span>
<span class=normal><a href=#__codelineno-0-104>104</a></span>
<span class=normal><a href=#__codelineno-0-105>105</a></span>
<span class=normal><a href=#__codelineno-0-106>106</a></span>
<span class=normal><a href=#__codelineno-0-107>107</a></span>
<span class=normal><a href=#__codelineno-0-108>108</a></span>
<span class=normal><a href=#__codelineno-0-109>109</a></span>
<span class=normal><a href=#__codelineno-0-110>110</a></span>
<span class=normal><a href=#__codelineno-0-111>111</a></span>
<span class=normal><a href=#__codelineno-0-112>112</a></span>
<span class=normal><a href=#__codelineno-0-113>113</a></span>
<span class=normal><a href=#__codelineno-0-114>114</a></span>
<span class=normal><a href=#__codelineno-0-115>115</a></span>
<span class=normal><a href=#__codelineno-0-116>116</a></span>
<span class=normal><a href=#__codelineno-0-117>117</a></span>
<span class=normal><a href=#__codelineno-0-118>118</a></span>
<span class=normal><a href=#__codelineno-0-119>119</a></span>
<span class=normal><a href=#__codelineno-0-120>120</a></span>
<span class=normal><a href=#__codelineno-0-121>121</a></span>
<span class=normal><a href=#__codelineno-0-122>122</a></span>
<span class=normal><a href=#__codelineno-0-123>123</a></span>
<span class=normal><a href=#__codelineno-0-124>124</a></span>
<span class=normal><a href=#__codelineno-0-125>125</a></span>
<span class=normal><a href=#__codelineno-0-126>126</a></span>
<span class=normal><a href=#__codelineno-0-127>127</a></span>
<span class=normal><a href=#__codelineno-0-128>128</a></span>
<span class=normal><a href=#__codelineno-0-129>129</a></span>
<span class=normal><a href=#__codelineno-0-130>130</a></span>
<span class=normal><a href=#__codelineno-0-131>131</a></span>
<span class=normal><a href=#__codelineno-0-132>132</a></span>
<span class=normal><a href=#__codelineno-0-133>133</a></span>
<span class=normal><a href=#__codelineno-0-134>134</a></span>
<span class=normal><a href=#__codelineno-0-135>135</a></span>
<span class=normal><a href=#__codelineno-0-136>136</a></span>
<span class=normal><a href=#__codelineno-0-137>137</a></span>
<span class=normal><a href=#__codelineno-0-138>138</a></span>
<span class=normal><a href=#__codelineno-0-139>139</a></span>
<span class=normal><a href=#__codelineno-0-140>140</a></span>
<span class=normal><a href=#__codelineno-0-141>141</a></span>
<span class=normal><a href=#__codelineno-0-142>142</a></span>
<span class=normal><a href=#__codelineno-0-143>143</a></span>
<span class=normal><a href=#__codelineno-0-144>144</a></span>
<span class=normal><a href=#__codelineno-0-145>145</a></span>
<span class=normal><a href=#__codelineno-0-146>146</a></span>
<span class=normal><a href=#__codelineno-0-147>147</a></span>
<span class=normal><a href=#__codelineno-0-148>148</a></span>
<span class=normal><a href=#__codelineno-0-149>149</a></span>
<span class=normal><a href=#__codelineno-0-150>150</a></span>
<span class=normal><a href=#__codelineno-0-151>151</a></span>
<span class=normal><a href=#__codelineno-0-152>152</a></span>
<span class=normal><a href=#__codelineno-0-153>153</a></span>
<span class=normal><a href=#__codelineno-0-154>154</a></span>
<span class=normal><a href=#__codelineno-0-155>155</a></span>
<span class=normal><a href=#__codelineno-0-156>156</a></span>
<span class=normal><a href=#__codelineno-0-157>157</a></span>
<span class=normal><a href=#__codelineno-0-158>158</a></span>
<span class=normal><a href=#__codelineno-0-159>159</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-20><a id=__codelineno-0-20 name=__codelineno-0-20></a><span class=k>def</span><span class=w> </span><span class=nf>start</span><span class=p>(</span>
</span><span id=__span-0-21><a id=__codelineno-0-21 name=__codelineno-0-21></a>    <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-22><a id=__codelineno-0-22 name=__codelineno-0-22></a>    <span class=n>model</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-23><a id=__codelineno-0-23 name=__codelineno-0-23></a>    <span class=n>tokenizer</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-24><a id=__codelineno-0-24 name=__codelineno-0-24></a>    <span class=n>dataset</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-25><a id=__codelineno-0-25 name=__codelineno-0-25></a>    <span class=n>num_procs</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
</span><span id=__span-0-26><a id=__codelineno-0-26 name=__codelineno-0-26></a>    <span class=nb>format</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-27><a id=__codelineno-0-27 name=__codelineno-0-27></a>    <span class=n>upload_checkpoint</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-28><a id=__codelineno-0-28 name=__codelineno-0-28></a>    <span class=n>num_nodes</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>1</span><span class=p>,</span>
</span><span id=__span-0-29><a id=__codelineno-0-29 name=__codelineno-0-29></a>    <span class=n>job_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-30><a id=__codelineno-0-30 name=__codelineno-0-30></a>    <span class=n>checkpoint</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-31><a id=__codelineno-0-31 name=__codelineno-0-31></a>    <span class=o>**</span><span class=n>dataset_kwargs</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span>
</span><span id=__span-0-32><a id=__codelineno-0-32 name=__codelineno-0-32></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-33><a id=__codelineno-0-33 name=__codelineno-0-33></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Start a finetuning job on the current node.</span>
</span><span id=__span-0-34><a id=__codelineno-0-34 name=__codelineno-0-34></a>
</span><span id=__span-0-35><a id=__codelineno-0-35 name=__codelineno-0-35></a><span class=sd>    Args:</span>
</span><span id=__span-0-36><a id=__codelineno-0-36 name=__codelineno-0-36></a><span class=sd>    ----</span>
</span><span id=__span-0-37><a id=__codelineno-0-37 name=__codelineno-0-37></a><span class=sd>        model: Name of a model in the registry. Base model to finetune.</span>
</span><span id=__span-0-38><a id=__codelineno-0-38 name=__codelineno-0-38></a><span class=sd>        tokenizer: Name of a tokenizer in the registry. Using tokenizer.model format.</span>
</span><span id=__span-0-39><a id=__codelineno-0-39 name=__codelineno-0-39></a><span class=sd>        dataset: Name of a dataset in the registry.</span>
</span><span id=__span-0-40><a id=__codelineno-0-40 name=__codelineno-0-40></a><span class=sd>        num_procs: Number of GPUs to use for training</span>
</span><span id=__span-0-41><a id=__codelineno-0-41 name=__codelineno-0-41></a><span class=sd>        format: Name of the configuration file to use. For example llama3-70b, llama3-8b. Valid options are in etc/finetune.</span>
</span><span id=__span-0-42><a id=__codelineno-0-42 name=__codelineno-0-42></a><span class=sd>        upload_checkpoint: Whether to upload the checkpoint to the registry. Default is True.</span>
</span><span id=__span-0-43><a id=__codelineno-0-43 name=__codelineno-0-43></a><span class=sd>        num_nodes: Number of nodes to use for training. Default is 1.</span>
</span><span id=__span-0-44><a id=__codelineno-0-44 name=__codelineno-0-44></a><span class=sd>        job_id: Unique identifier for the job. Default is None.</span>
</span><span id=__span-0-45><a id=__codelineno-0-45 name=__codelineno-0-45></a><span class=sd>        checkpoint: Name of the model checkpoint to start from. Default is None.</span>
</span><span id=__span-0-46><a id=__codelineno-0-46 name=__codelineno-0-46></a><span class=sd>        dataset_kwargs: Additional keyword arguments to pass to the dataset constructor.</span>
</span><span id=__span-0-47><a id=__codelineno-0-47 name=__codelineno-0-47></a>
</span><span id=__span-0-48><a id=__codelineno-0-48 name=__codelineno-0-48></a><span class=sd>    &quot;&quot;&quot;</span>  <span class=c1># noqa: E501</span>
</span><span id=__span-0-49><a id=__codelineno-0-49 name=__codelineno-0-49></a>    <span class=kn>from</span><span class=w> </span><span class=nn>nearai.dataset</span><span class=w> </span><span class=kn>import</span> <span class=n>get_dataset</span>
</span><span id=__span-0-50><a id=__codelineno-0-50 name=__codelineno-0-50></a>
</span><span id=__span-0-51><a id=__codelineno-0-51 name=__codelineno-0-51></a>    <span class=k>assert</span> <span class=n>num_nodes</span> <span class=o>&gt;=</span> <span class=mi>1</span>
</span><span id=__span-0-52><a id=__codelineno-0-52 name=__codelineno-0-52></a>
</span><span id=__span-0-53><a id=__codelineno-0-53 name=__codelineno-0-53></a>    <span class=c1># Prepare job id folder</span>
</span><span id=__span-0-54><a id=__codelineno-0-54 name=__codelineno-0-54></a>    <span class=k>if</span> <span class=n>job_id</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-55><a id=__codelineno-0-55 name=__codelineno-0-55></a>        <span class=n>job_id</span> <span class=o>=</span> <span class=s2>&quot;job&quot;</span>
</span><span id=__span-0-56><a id=__codelineno-0-56 name=__codelineno-0-56></a>    <span class=n>job_id</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>job_id</span><span class=si>}</span><span class=s2>-</span><span class=si>{</span><span class=n>timestamp</span><span class=p>()</span><span class=si>}</span><span class=s2>-</span><span class=si>{</span><span class=n>randint</span><span class=p>(</span><span class=mi>10</span><span class=o>**</span><span class=mi>8</span><span class=p>,</span><span class=w> </span><span class=mi>10</span><span class=o>**</span><span class=mi>9</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-57><a id=__codelineno-0-57 name=__codelineno-0-57></a>    <span class=n>job_folder</span> <span class=o>=</span> <span class=n>DATA_FOLDER</span> <span class=o>/</span> <span class=s2>&quot;finetune&quot;</span> <span class=o>/</span> <span class=n>job_id</span>
</span><span id=__span-0-58><a id=__codelineno-0-58 name=__codelineno-0-58></a>    <span class=n>job_folder</span><span class=o>.</span><span class=n>mkdir</span><span class=p>(</span><span class=n>parents</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-59><a id=__codelineno-0-59 name=__codelineno-0-59></a>
</span><span id=__span-0-60><a id=__codelineno-0-60 name=__codelineno-0-60></a>    <span class=c1># Either use the provided config file template or load one predefined one</span>
</span><span id=__span-0-61><a id=__codelineno-0-61 name=__codelineno-0-61></a>    <span class=k>if</span> <span class=n>Path</span><span class=p>(</span><span class=nb>format</span><span class=p>)</span><span class=o>.</span><span class=n>exists</span><span class=p>():</span>
</span><span id=__span-0-62><a id=__codelineno-0-62 name=__codelineno-0-62></a>        <span class=n>config_template_path</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=nb>format</span><span class=p>)</span>
</span><span id=__span-0-63><a id=__codelineno-0-63 name=__codelineno-0-63></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-64><a id=__codelineno-0-64 name=__codelineno-0-64></a>        <span class=n>configs</span> <span class=o>=</span> <span class=n>ETC_FOLDER</span> <span class=o>/</span> <span class=s2>&quot;finetune&quot;</span>
</span><span id=__span-0-65><a id=__codelineno-0-65 name=__codelineno-0-65></a>        <span class=n>config_template_path</span> <span class=o>=</span> <span class=n>configs</span> <span class=o>/</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=nb>format</span><span class=si>}</span><span class=s2>.yml&quot;</span>
</span><span id=__span-0-66><a id=__codelineno-0-66 name=__codelineno-0-66></a>
</span><span id=__span-0-67><a id=__codelineno-0-67 name=__codelineno-0-67></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>config_template_path</span><span class=o>.</span><span class=n>exists</span><span class=p>():</span>
</span><span id=__span-0-68><a id=__codelineno-0-68 name=__codelineno-0-68></a>        <span class=k>raise</span> <span class=ne>FileNotFoundError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Config file not found: </span><span class=si>{</span><span class=n>config_template_path</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-69><a id=__codelineno-0-69 name=__codelineno-0-69></a>
</span><span id=__span-0-70><a id=__codelineno-0-70 name=__codelineno-0-70></a>    <span class=n>CONFIG_TEMPLATE</span> <span class=o>=</span> <span class=n>config_template_path</span><span class=o>.</span><span class=n>read_text</span><span class=p>()</span>  <span class=c1># noqa: N806</span>
</span><span id=__span-0-71><a id=__codelineno-0-71 name=__codelineno-0-71></a>
</span><span id=__span-0-72><a id=__codelineno-0-72 name=__codelineno-0-72></a>    <span class=c1># Download model</span>
</span><span id=__span-0-73><a id=__codelineno-0-73 name=__codelineno-0-73></a>    <span class=n>model_path</span> <span class=o>=</span> <span class=n>get_model</span><span class=p>(</span><span class=n>model</span><span class=p>)</span>
</span><span id=__span-0-74><a id=__codelineno-0-74 name=__codelineno-0-74></a>
</span><span id=__span-0-75><a id=__codelineno-0-75 name=__codelineno-0-75></a>    <span class=c1># Download tokenizer</span>
</span><span id=__span-0-76><a id=__codelineno-0-76 name=__codelineno-0-76></a>    <span class=n>tokenizer_path</span> <span class=o>=</span> <span class=n>registry</span><span class=o>.</span><span class=n>download</span><span class=p>(</span><span class=n>tokenizer</span><span class=p>)</span> <span class=o>/</span> <span class=s2>&quot;tokenizer.model&quot;</span>
</span><span id=__span-0-77><a id=__codelineno-0-77 name=__codelineno-0-77></a>    <span class=k>assert</span> <span class=n>tokenizer_path</span><span class=o>.</span><span class=n>exists</span><span class=p>(),</span> <span class=sa>f</span><span class=s2>&quot;tokenizer.model not found in </span><span class=si>{</span><span class=n>tokenizer_path</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-78><a id=__codelineno-0-78 name=__codelineno-0-78></a>
</span><span id=__span-0-79><a id=__codelineno-0-79 name=__codelineno-0-79></a>    <span class=c1># Download checkpoint if any</span>
</span><span id=__span-0-80><a id=__codelineno-0-80 name=__codelineno-0-80></a>    <span class=n>checkpoint_path</span> <span class=o>=</span> <span class=n>get_model</span><span class=p>(</span><span class=n>checkpoint</span><span class=p>)</span> <span class=k>if</span> <span class=n>checkpoint</span> <span class=k>else</span> <span class=s2>&quot;null&quot;</span>
</span><span id=__span-0-81><a id=__codelineno-0-81 name=__codelineno-0-81></a>    <span class=n>resume_checkpoint</span> <span class=o>=</span> <span class=n>checkpoint_path</span> <span class=o>!=</span> <span class=s2>&quot;null&quot;</span>
</span><span id=__span-0-82><a id=__codelineno-0-82 name=__codelineno-0-82></a>
</span><span id=__span-0-83><a id=__codelineno-0-83 name=__codelineno-0-83></a>    <span class=c1># Download dataset</span>
</span><span id=__span-0-84><a id=__codelineno-0-84 name=__codelineno-0-84></a>    <span class=n>dataset_path</span> <span class=o>=</span> <span class=n>get_dataset</span><span class=p>(</span><span class=n>dataset</span><span class=p>)</span>
</span><span id=__span-0-85><a id=__codelineno-0-85 name=__codelineno-0-85></a>
</span><span id=__span-0-86><a id=__codelineno-0-86 name=__codelineno-0-86></a>    <span class=c1># Set up output directories</span>
</span><span id=__span-0-87><a id=__codelineno-0-87 name=__codelineno-0-87></a>    <span class=n>checkpoint_output_dir</span> <span class=o>=</span> <span class=n>job_folder</span> <span class=o>/</span> <span class=s2>&quot;checkpoint_output&quot;</span>
</span><span id=__span-0-88><a id=__codelineno-0-88 name=__codelineno-0-88></a>    <span class=n>logging_output_dir</span> <span class=o>=</span> <span class=n>job_folder</span> <span class=o>/</span> <span class=s2>&quot;logs&quot;</span>
</span><span id=__span-0-89><a id=__codelineno-0-89 name=__codelineno-0-89></a>    <span class=n>logging_output_dir</span><span class=o>.</span><span class=n>mkdir</span><span class=p>(</span><span class=n>parents</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-90><a id=__codelineno-0-90 name=__codelineno-0-90></a>
</span><span id=__span-0-91><a id=__codelineno-0-91 name=__codelineno-0-91></a>    <span class=c1># Prepare config file</span>
</span><span id=__span-0-92><a id=__codelineno-0-92 name=__codelineno-0-92></a>    <span class=n>dataset_args_dict</span> <span class=o>=</span> <span class=n>deepcopy</span><span class=p>(</span><span class=n>dataset_kwargs</span><span class=p>)</span>
</span><span id=__span-0-93><a id=__codelineno-0-93 name=__codelineno-0-93></a>
</span><span id=__span-0-94><a id=__codelineno-0-94 name=__codelineno-0-94></a>    <span class=n>dataset_args_dict</span><span class=p>[</span><span class=s2>&quot;_component_&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>dataset_args_dict</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;method&quot;</span><span class=p>)</span>
</span><span id=__span-0-95><a id=__codelineno-0-95 name=__codelineno-0-95></a>    <span class=n>dataset_args_dict</span><span class=p>[</span><span class=s2>&quot;source&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>dataset_path</span><span class=o>.</span><span class=n>absolute</span><span class=p>())</span>
</span><span id=__span-0-96><a id=__codelineno-0-96 name=__codelineno-0-96></a>    <span class=n>dataset_args</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;  </span><span class=si>{</span><span class=n>key</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>value</span><span class=si>}</span><span class=s2>&quot;</span> <span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>dataset_args_dict</span><span class=o>.</span><span class=n>items</span><span class=p>())</span>
</span><span id=__span-0-97><a id=__codelineno-0-97 name=__codelineno-0-97></a>
</span><span id=__span-0-98><a id=__codelineno-0-98 name=__codelineno-0-98></a>    <span class=n>config</span> <span class=o>=</span> <span class=n>job_folder</span> <span class=o>/</span> <span class=s2>&quot;config.yaml&quot;</span>
</span><span id=__span-0-99><a id=__codelineno-0-99 name=__codelineno-0-99></a>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>config</span><span class=p>,</span> <span class=s2>&quot;w&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-100><a id=__codelineno-0-100 name=__codelineno-0-100></a>        <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span>
</span><span id=__span-0-101><a id=__codelineno-0-101 name=__codelineno-0-101></a>            <span class=n>CONFIG_TEMPLATE</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
</span><span id=__span-0-102><a id=__codelineno-0-102 name=__codelineno-0-102></a>                <span class=n>TOKENIZER</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>tokenizer_path</span><span class=p>),</span>
</span><span id=__span-0-103><a id=__codelineno-0-103 name=__codelineno-0-103></a>                <span class=n>MODEL</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>model_path</span><span class=p>),</span>
</span><span id=__span-0-104><a id=__codelineno-0-104 name=__codelineno-0-104></a>                <span class=n>RECIPE_CHECKPOINT</span><span class=o>=</span><span class=n>checkpoint_path</span><span class=p>,</span>
</span><span id=__span-0-105><a id=__codelineno-0-105 name=__codelineno-0-105></a>                <span class=n>RESUME_FROM_CHECKPOINT</span><span class=o>=</span><span class=n>resume_checkpoint</span><span class=p>,</span>
</span><span id=__span-0-106><a id=__codelineno-0-106 name=__codelineno-0-106></a>                <span class=n>CHECKPOINT_OUTPUT_DIR</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>checkpoint_output_dir</span><span class=p>),</span>
</span><span id=__span-0-107><a id=__codelineno-0-107 name=__codelineno-0-107></a>                <span class=n>DATASET_ARGS</span><span class=o>=</span><span class=n>dataset_args</span><span class=p>,</span>
</span><span id=__span-0-108><a id=__codelineno-0-108 name=__codelineno-0-108></a>                <span class=n>LOGGING_OUTPUT_DIR</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>logging_output_dir</span><span class=p>),</span>
</span><span id=__span-0-109><a id=__codelineno-0-109 name=__codelineno-0-109></a>            <span class=p>)</span>
</span><span id=__span-0-110><a id=__codelineno-0-110 name=__codelineno-0-110></a>        <span class=p>)</span>
</span><span id=__span-0-111><a id=__codelineno-0-111 name=__codelineno-0-111></a>
</span><span id=__span-0-112><a id=__codelineno-0-112 name=__codelineno-0-112></a>    <span class=c1># Spawn background thread to read logs and push to database</span>
</span><span id=__span-0-113><a id=__codelineno-0-113 name=__codelineno-0-113></a>    <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>find_new_logs_background</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=n>logging_output_dir</span><span class=p>,</span> <span class=n>job_id</span><span class=p>))</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span><span id=__span-0-114><a id=__codelineno-0-114 name=__codelineno-0-114></a>
</span><span id=__span-0-115><a id=__codelineno-0-115 name=__codelineno-0-115></a>    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Starting job at&quot;</span><span class=p>,</span> <span class=n>job_folder</span><span class=p>)</span>
</span><span id=__span-0-116><a id=__codelineno-0-116 name=__codelineno-0-116></a>    <span class=k>if</span> <span class=n>num_nodes</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
</span><span id=__span-0-117><a id=__codelineno-0-117 name=__codelineno-0-117></a>        <span class=n>run</span><span class=p>(</span>
</span><span id=__span-0-118><a id=__codelineno-0-118 name=__codelineno-0-118></a>            <span class=p>[</span>
</span><span id=__span-0-119><a id=__codelineno-0-119 name=__codelineno-0-119></a>                <span class=s2>&quot;tune&quot;</span><span class=p>,</span>
</span><span id=__span-0-120><a id=__codelineno-0-120 name=__codelineno-0-120></a>                <span class=s2>&quot;run&quot;</span><span class=p>,</span>
</span><span id=__span-0-121><a id=__codelineno-0-121 name=__codelineno-0-121></a>                <span class=s2>&quot;--nproc_per_node&quot;</span><span class=p>,</span>
</span><span id=__span-0-122><a id=__codelineno-0-122 name=__codelineno-0-122></a>                <span class=nb>str</span><span class=p>(</span><span class=n>num_procs</span><span class=p>),</span>
</span><span id=__span-0-123><a id=__codelineno-0-123 name=__codelineno-0-123></a>                <span class=s2>&quot;lora_finetune_distributed&quot;</span><span class=p>,</span>
</span><span id=__span-0-124><a id=__codelineno-0-124 name=__codelineno-0-124></a>                <span class=s2>&quot;--config&quot;</span><span class=p>,</span>
</span><span id=__span-0-125><a id=__codelineno-0-125 name=__codelineno-0-125></a>                <span class=nb>str</span><span class=p>(</span><span class=n>config</span><span class=p>),</span>
</span><span id=__span-0-126><a id=__codelineno-0-126 name=__codelineno-0-126></a>            <span class=p>]</span>
</span><span id=__span-0-127><a id=__codelineno-0-127 name=__codelineno-0-127></a>        <span class=p>)</span>
</span><span id=__span-0-128><a id=__codelineno-0-128 name=__codelineno-0-128></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-129><a id=__codelineno-0-129 name=__codelineno-0-129></a>        <span class=c1># Fetch rank and master addr from environment variables</span>
</span><span id=__span-0-130><a id=__codelineno-0-130 name=__codelineno-0-130></a>        <span class=k>raise</span> <span class=ne>NotImplementedError</span><span class=p>()</span>
</span><span id=__span-0-131><a id=__codelineno-0-131 name=__codelineno-0-131></a>
</span><span id=__span-0-132><a id=__codelineno-0-132 name=__codelineno-0-132></a>    <span class=k>global</span> <span class=n>BACKGROUND_PROCESS</span>
</span><span id=__span-0-133><a id=__codelineno-0-133 name=__codelineno-0-133></a>    <span class=n>BACKGROUND_PROCESS</span> <span class=o>=</span> <span class=kc>False</span>
</span><span id=__span-0-134><a id=__codelineno-0-134 name=__codelineno-0-134></a>
</span><span id=__span-0-135><a id=__codelineno-0-135 name=__codelineno-0-135></a>    <span class=k>if</span> <span class=n>upload_checkpoint</span><span class=p>:</span>
</span><span id=__span-0-136><a id=__codelineno-0-136 name=__codelineno-0-136></a>        <span class=n>registry</span><span class=o>.</span><span class=n>upload</span><span class=p>(</span>
</span><span id=__span-0-137><a id=__codelineno-0-137 name=__codelineno-0-137></a>            <span class=n>job_folder</span><span class=p>,</span>
</span><span id=__span-0-138><a id=__codelineno-0-138 name=__codelineno-0-138></a>            <span class=n>EntryMetadata</span><span class=o>.</span><span class=n>from_dict</span><span class=p>(</span>
</span><span id=__span-0-139><a id=__codelineno-0-139 name=__codelineno-0-139></a>                <span class=p>{</span>
</span><span id=__span-0-140><a id=__codelineno-0-140 name=__codelineno-0-140></a>                    <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;finetune-</span><span class=si>{</span><span class=n>job_id</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-0-141><a id=__codelineno-0-141 name=__codelineno-0-141></a>                    <span class=s2>&quot;version&quot;</span><span class=p>:</span> <span class=s2>&quot;0.0.1&quot;</span><span class=p>,</span>
</span><span id=__span-0-142><a id=__codelineno-0-142 name=__codelineno-0-142></a>                    <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;Finetuned checkpoint from base mode </span><span class=si>{</span><span class=n>model</span><span class=si>}</span><span class=s2> using dataset </span><span class=si>{</span><span class=n>dataset</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-0-143><a id=__codelineno-0-143 name=__codelineno-0-143></a>                    <span class=s2>&quot;category&quot;</span><span class=p>:</span> <span class=s2>&quot;finetune&quot;</span><span class=p>,</span>
</span><span id=__span-0-144><a id=__codelineno-0-144 name=__codelineno-0-144></a>                    <span class=s2>&quot;tags&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;finetune&quot;</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&quot;base-model-</span><span class=si>{</span><span class=n>model</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&quot;base-dataset-</span><span class=si>{</span><span class=n>dataset</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>],</span>
</span><span id=__span-0-145><a id=__codelineno-0-145 name=__codelineno-0-145></a>                    <span class=s2>&quot;details&quot;</span><span class=p>:</span> <span class=nb>dict</span><span class=p>(</span>
</span><span id=__span-0-146><a id=__codelineno-0-146 name=__codelineno-0-146></a>                        <span class=n>model</span><span class=o>=</span><span class=n>model</span><span class=p>,</span>
</span><span id=__span-0-147><a id=__codelineno-0-147 name=__codelineno-0-147></a>                        <span class=n>tokenizer</span><span class=o>=</span><span class=n>tokenizer</span><span class=p>,</span>
</span><span id=__span-0-148><a id=__codelineno-0-148 name=__codelineno-0-148></a>                        <span class=n>dataset</span><span class=o>=</span><span class=n>dataset</span><span class=p>,</span>
</span><span id=__span-0-149><a id=__codelineno-0-149 name=__codelineno-0-149></a>                        <span class=n>num_procs</span><span class=o>=</span><span class=n>num_procs</span><span class=p>,</span>
</span><span id=__span-0-150><a id=__codelineno-0-150 name=__codelineno-0-150></a>                        <span class=nb>format</span><span class=o>=</span><span class=nb>format</span><span class=p>,</span>
</span><span id=__span-0-151><a id=__codelineno-0-151 name=__codelineno-0-151></a>                        <span class=n>num_nodes</span><span class=o>=</span><span class=n>num_nodes</span><span class=p>,</span>
</span><span id=__span-0-152><a id=__codelineno-0-152 name=__codelineno-0-152></a>                        <span class=n>checkpoint</span><span class=o>=</span><span class=n>checkpoint</span><span class=p>,</span>
</span><span id=__span-0-153><a id=__codelineno-0-153 name=__codelineno-0-153></a>                        <span class=o>**</span><span class=n>dataset_kwargs</span><span class=p>,</span>
</span><span id=__span-0-154><a id=__codelineno-0-154 name=__codelineno-0-154></a>                    <span class=p>),</span>
</span><span id=__span-0-155><a id=__codelineno-0-155 name=__codelineno-0-155></a>                    <span class=s2>&quot;show_entry&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-156><a id=__codelineno-0-156 name=__codelineno-0-156></a>                <span class=p>}</span>
</span><span id=__span-0-157><a id=__codelineno-0-157 name=__codelineno-0-157></a>            <span class=p>),</span>
</span><span id=__span-0-158><a id=__codelineno-0-158 name=__codelineno-0-158></a>            <span class=n>show_progress</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-159><a id=__codelineno-0-159 name=__codelineno-0-159></a>        <span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-function"> <h4 id=nearai.finetune.parse_line class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">parse_line</span> <a href=#nearai.finetune.parse_line class=headerlink title="Permanent link">&para;</a></h4> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>parse_line</span><span class=p>(</span><span class=n>line</span><span class=p>:</span> <span class=n>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=typing.Tuple>Tuple</span></span><span class=p>[</span><span class=n>int</span><span class=p>,</span> <span class=n>dict</span><span class=p>[</span><span class=n>str</span><span class=p>,</span> <span class=n>float</span><span class=p>]]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Example of line to be parsed.</p> <p>Step 33 | loss:1.5400923490524292 lr:9.9e-05 tokens_per_second_per_gpu:101.22285588141214</p> <details class=quote> <summary>Source code in <code>nearai/finetune/__init__.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-169>169</a></span>
<span class=normal><a href=#__codelineno-0-170>170</a></span>
<span class=normal><a href=#__codelineno-0-171>171</a></span>
<span class=normal><a href=#__codelineno-0-172>172</a></span>
<span class=normal><a href=#__codelineno-0-173>173</a></span>
<span class=normal><a href=#__codelineno-0-174>174</a></span>
<span class=normal><a href=#__codelineno-0-175>175</a></span>
<span class=normal><a href=#__codelineno-0-176>176</a></span>
<span class=normal><a href=#__codelineno-0-177>177</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-169><a id=__codelineno-0-169 name=__codelineno-0-169></a><span class=k>def</span><span class=w> </span><span class=nf>parse_line</span><span class=p>(</span><span class=n>line</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>float</span><span class=p>]]:</span>
</span><span id=__span-0-170><a id=__codelineno-0-170 name=__codelineno-0-170></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Example of line to be parsed.</span>
</span><span id=__span-0-171><a id=__codelineno-0-171 name=__codelineno-0-171></a>
</span><span id=__span-0-172><a id=__codelineno-0-172 name=__codelineno-0-172></a><span class=sd>    Step 33 | loss:1.5400923490524292 lr:9.9e-05 tokens_per_second_per_gpu:101.22285588141214</span>
</span><span id=__span-0-173><a id=__codelineno-0-173 name=__codelineno-0-173></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-174><a id=__codelineno-0-174 name=__codelineno-0-174></a>    <span class=n>step_raw</span><span class=p>,</span> <span class=n>metrics_raw</span> <span class=o>=</span> <span class=nb>map</span><span class=p>(</span><span class=nb>str</span><span class=o>.</span><span class=n>strip</span><span class=p>,</span> <span class=n>line</span><span class=o>.</span><span class=n>strip</span><span class=p>(</span><span class=s2>&quot; </span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;|&quot;</span><span class=p>))</span>
</span><span id=__span-0-175><a id=__codelineno-0-175 name=__codelineno-0-175></a>    <span class=n>step</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>step_raw</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot; &quot;</span><span class=p>)[</span><span class=o>-</span><span class=mi>1</span><span class=p>])</span>
</span><span id=__span-0-176><a id=__codelineno-0-176 name=__codelineno-0-176></a>    <span class=n>metrics</span> <span class=o>=</span> <span class=p>{</span><span class=n>metric</span><span class=p>[</span><span class=mi>0</span><span class=p>]:</span> <span class=nb>float</span><span class=p>(</span><span class=n>metric</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span> <span class=k>for</span> <span class=n>metric</span> <span class=ow>in</span> <span class=nb>map</span><span class=p>(</span><span class=k>lambda</span> <span class=n>metric</span><span class=p>:</span> <span class=n>metric</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;:&quot;</span><span class=p>),</span> <span class=n>metrics_raw</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot; &quot;</span><span class=p>))}</span>
</span><span id=__span-0-177><a id=__codelineno-0-177 name=__codelineno-0-177></a>    <span class=k>return</span> <span class=n>step</span><span class=p>,</span> <span class=n>metrics</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-module"> <h4 id=nearai.finetune.text_completion class="doc doc-heading"> <span class="doc doc-object-name doc-module-name">text_completion</span> <a href=#nearai.finetune.text_completion class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h5 id=nearai.finetune.text_completion.TextCompletionDataset class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">TextCompletionDataset</span> <a href=#nearai.finetune.text_completion.TextCompletionDataset class=headerlink title="Permanent link">&para;</a></h5> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=torch.utils.data.Dataset>Dataset</span></code></p> <p>Freeform dataset for any unstructured text corpus. Quickly load any dataset from Hugging Face or local disk and tokenize it for your model.</p> <hr> <div class="language-text highlight"><pre><span></span><code>tokenizer (BaseTokenizer): Tokenizer used to encode data. Tokenize must implement an ``encode`` and ``decode`` method.
source (str): path string of dataset, anything supported by Hugging Face&#39;s ``load_dataset``
    (https://huggingface.co/docs/datasets/en/package_reference/loading_methods#datasets.load_dataset.path)
column (str): name of column in the sample that contains the text data. This is typically required
    for Hugging Face datasets or tabular data. For local datasets with a single column, use the default &quot;text&quot;,
    which is what is assigned by Hugging Face datasets when loaded into memory. Default is &quot;text&quot;.
max_seq_len (Optional[int]): Maximum number of tokens in the returned input and label token id lists.
    Default is None, disabling truncation. We recommend setting this to the highest you can fit in memory
    and is supported by the model. For example, llama2-7B supports up to 4096 for sequence length.
**load_dataset_kwargs (Dict[str, Any]): additional keyword arguments to pass to ``load_dataset``.
</code></pre></div> <details class=quote> <summary>Source code in <code>nearai/finetune/text_completion.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-33>33</a></span>
<span class=normal><a href=#__codelineno-0-34>34</a></span>
<span class=normal><a href=#__codelineno-0-35>35</a></span>
<span class=normal><a href=#__codelineno-0-36>36</a></span>
<span class=normal><a href=#__codelineno-0-37>37</a></span>
<span class=normal><a href=#__codelineno-0-38>38</a></span>
<span class=normal><a href=#__codelineno-0-39>39</a></span>
<span class=normal><a href=#__codelineno-0-40>40</a></span>
<span class=normal><a href=#__codelineno-0-41>41</a></span>
<span class=normal><a href=#__codelineno-0-42>42</a></span>
<span class=normal><a href=#__codelineno-0-43>43</a></span>
<span class=normal><a href=#__codelineno-0-44>44</a></span>
<span class=normal><a href=#__codelineno-0-45>45</a></span>
<span class=normal><a href=#__codelineno-0-46>46</a></span>
<span class=normal><a href=#__codelineno-0-47>47</a></span>
<span class=normal><a href=#__codelineno-0-48>48</a></span>
<span class=normal><a href=#__codelineno-0-49>49</a></span>
<span class=normal><a href=#__codelineno-0-50>50</a></span>
<span class=normal><a href=#__codelineno-0-51>51</a></span>
<span class=normal><a href=#__codelineno-0-52>52</a></span>
<span class=normal><a href=#__codelineno-0-53>53</a></span>
<span class=normal><a href=#__codelineno-0-54>54</a></span>
<span class=normal><a href=#__codelineno-0-55>55</a></span>
<span class=normal><a href=#__codelineno-0-56>56</a></span>
<span class=normal><a href=#__codelineno-0-57>57</a></span>
<span class=normal><a href=#__codelineno-0-58>58</a></span>
<span class=normal><a href=#__codelineno-0-59>59</a></span>
<span class=normal><a href=#__codelineno-0-60>60</a></span>
<span class=normal><a href=#__codelineno-0-61>61</a></span>
<span class=normal><a href=#__codelineno-0-62>62</a></span>
<span class=normal><a href=#__codelineno-0-63>63</a></span>
<span class=normal><a href=#__codelineno-0-64>64</a></span>
<span class=normal><a href=#__codelineno-0-65>65</a></span>
<span class=normal><a href=#__codelineno-0-66>66</a></span>
<span class=normal><a href=#__codelineno-0-67>67</a></span>
<span class=normal><a href=#__codelineno-0-68>68</a></span>
<span class=normal><a href=#__codelineno-0-69>69</a></span>
<span class=normal><a href=#__codelineno-0-70>70</a></span>
<span class=normal><a href=#__codelineno-0-71>71</a></span>
<span class=normal><a href=#__codelineno-0-72>72</a></span>
<span class=normal><a href=#__codelineno-0-73>73</a></span>
<span class=normal><a href=#__codelineno-0-74>74</a></span>
<span class=normal><a href=#__codelineno-0-75>75</a></span>
<span class=normal><a href=#__codelineno-0-76>76</a></span>
<span class=normal><a href=#__codelineno-0-77>77</a></span>
<span class=normal><a href=#__codelineno-0-78>78</a></span>
<span class=normal><a href=#__codelineno-0-79>79</a></span>
<span class=normal><a href=#__codelineno-0-80>80</a></span>
<span class=normal><a href=#__codelineno-0-81>81</a></span>
<span class=normal><a href=#__codelineno-0-82>82</a></span>
<span class=normal><a href=#__codelineno-0-83>83</a></span>
<span class=normal><a href=#__codelineno-0-84>84</a></span>
<span class=normal><a href=#__codelineno-0-85>85</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-33><a id=__codelineno-0-33 name=__codelineno-0-33></a><span class=k>class</span><span class=w> </span><span class=nc>TextCompletionDataset</span><span class=p>(</span><span class=n>Dataset</span><span class=p>):</span>
</span><span id=__span-0-34><a id=__codelineno-0-34 name=__codelineno-0-34></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Freeform dataset for any unstructured text corpus. Quickly load any dataset from Hugging Face or local disk and tokenize it for your model.</span>
</span><span id=__span-0-35><a id=__codelineno-0-35 name=__codelineno-0-35></a>
</span><span id=__span-0-36><a id=__codelineno-0-36 name=__codelineno-0-36></a><span class=sd>    Args:</span>
</span><span id=__span-0-37><a id=__codelineno-0-37 name=__codelineno-0-37></a><span class=sd>    ----</span>
</span><span id=__span-0-38><a id=__codelineno-0-38 name=__codelineno-0-38></a><span class=sd>        tokenizer (BaseTokenizer): Tokenizer used to encode data. Tokenize must implement an ``encode`` and ``decode`` method.</span>
</span><span id=__span-0-39><a id=__codelineno-0-39 name=__codelineno-0-39></a><span class=sd>        source (str): path string of dataset, anything supported by Hugging Face&#39;s ``load_dataset``</span>
</span><span id=__span-0-40><a id=__codelineno-0-40 name=__codelineno-0-40></a><span class=sd>            (https://huggingface.co/docs/datasets/en/package_reference/loading_methods#datasets.load_dataset.path)</span>
</span><span id=__span-0-41><a id=__codelineno-0-41 name=__codelineno-0-41></a><span class=sd>        column (str): name of column in the sample that contains the text data. This is typically required</span>
</span><span id=__span-0-42><a id=__codelineno-0-42 name=__codelineno-0-42></a><span class=sd>            for Hugging Face datasets or tabular data. For local datasets with a single column, use the default &quot;text&quot;,</span>
</span><span id=__span-0-43><a id=__codelineno-0-43 name=__codelineno-0-43></a><span class=sd>            which is what is assigned by Hugging Face datasets when loaded into memory. Default is &quot;text&quot;.</span>
</span><span id=__span-0-44><a id=__codelineno-0-44 name=__codelineno-0-44></a><span class=sd>        max_seq_len (Optional[int]): Maximum number of tokens in the returned input and label token id lists.</span>
</span><span id=__span-0-45><a id=__codelineno-0-45 name=__codelineno-0-45></a><span class=sd>            Default is None, disabling truncation. We recommend setting this to the highest you can fit in memory</span>
</span><span id=__span-0-46><a id=__codelineno-0-46 name=__codelineno-0-46></a><span class=sd>            and is supported by the model. For example, llama2-7B supports up to 4096 for sequence length.</span>
</span><span id=__span-0-47><a id=__codelineno-0-47 name=__codelineno-0-47></a><span class=sd>        **load_dataset_kwargs (Dict[str, Any]): additional keyword arguments to pass to ``load_dataset``.</span>
</span><span id=__span-0-48><a id=__codelineno-0-48 name=__codelineno-0-48></a>
</span><span id=__span-0-49><a id=__codelineno-0-49 name=__codelineno-0-49></a><span class=sd>    &quot;&quot;&quot;</span>  <span class=c1># noqa: E501</span>
</span><span id=__span-0-50><a id=__codelineno-0-50 name=__codelineno-0-50></a>
</span><span id=__span-0-51><a id=__codelineno-0-51 name=__codelineno-0-51></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span>  <span class=c1># noqa: D107</span>
</span><span id=__span-0-52><a id=__codelineno-0-52 name=__codelineno-0-52></a>        <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-53><a id=__codelineno-0-53 name=__codelineno-0-53></a>        <span class=n>tokenizer</span><span class=p>:</span> <span class=n>BaseTokenizer</span><span class=p>,</span>
</span><span id=__span-0-54><a id=__codelineno-0-54 name=__codelineno-0-54></a>        <span class=n>source</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-55><a id=__codelineno-0-55 name=__codelineno-0-55></a>        <span class=n>column</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;text&quot;</span><span class=p>,</span>
</span><span id=__span-0-56><a id=__codelineno-0-56 name=__codelineno-0-56></a>        <span class=n>split</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-57><a id=__codelineno-0-57 name=__codelineno-0-57></a>        <span class=n>max_seq_len</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-58><a id=__codelineno-0-58 name=__codelineno-0-58></a>        <span class=o>**</span><span class=n>load_dataset_kwargs</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span>
</span><span id=__span-0-59><a id=__codelineno-0-59 name=__codelineno-0-59></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-60><a id=__codelineno-0-60 name=__codelineno-0-60></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_tokenizer</span> <span class=o>=</span> <span class=n>tokenizer</span>
</span><span id=__span-0-61><a id=__codelineno-0-61 name=__codelineno-0-61></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_data</span> <span class=o>=</span> <span class=n>load_from_disk</span><span class=p>(</span><span class=n>source</span><span class=p>,</span> <span class=o>**</span><span class=n>load_dataset_kwargs</span><span class=p>)</span>
</span><span id=__span-0-62><a id=__codelineno-0-62 name=__codelineno-0-62></a>        <span class=k>if</span> <span class=n>split</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-63><a id=__codelineno-0-63 name=__codelineno-0-63></a>            <span class=bp>self</span><span class=o>.</span><span class=n>_data</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_data</span><span class=p>[</span><span class=n>split</span><span class=p>]</span>
</span><span id=__span-0-64><a id=__codelineno-0-64 name=__codelineno-0-64></a>        <span class=bp>self</span><span class=o>.</span><span class=n>max_seq_len</span> <span class=o>=</span> <span class=n>max_seq_len</span>
</span><span id=__span-0-65><a id=__codelineno-0-65 name=__codelineno-0-65></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_column</span> <span class=o>=</span> <span class=n>column</span>
</span><span id=__span-0-66><a id=__codelineno-0-66 name=__codelineno-0-66></a>
</span><span id=__span-0-67><a id=__codelineno-0-67 name=__codelineno-0-67></a>    <span class=k>def</span><span class=w> </span><span class=fm>__len__</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span>  <span class=c1># noqa: D105</span>
</span><span id=__span-0-68><a id=__codelineno-0-68 name=__codelineno-0-68></a>        <span class=k>return</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_data</span><span class=p>)</span>
</span><span id=__span-0-69><a id=__codelineno-0-69 name=__codelineno-0-69></a>
</span><span id=__span-0-70><a id=__codelineno-0-70 name=__codelineno-0-70></a>    <span class=k>def</span><span class=w> </span><span class=fm>__getitem__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>index</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>List</span><span class=p>[</span><span class=nb>int</span><span class=p>]]:</span>  <span class=c1># noqa: D105</span>
</span><span id=__span-0-71><a id=__codelineno-0-71 name=__codelineno-0-71></a>        <span class=n>sample</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_data</span><span class=p>[</span><span class=n>index</span><span class=p>]</span>
</span><span id=__span-0-72><a id=__codelineno-0-72 name=__codelineno-0-72></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_prepare_sample</span><span class=p>(</span><span class=n>sample</span><span class=p>)</span>
</span><span id=__span-0-73><a id=__codelineno-0-73 name=__codelineno-0-73></a>
</span><span id=__span-0-74><a id=__codelineno-0-74 name=__codelineno-0-74></a>    <span class=k>def</span><span class=w> </span><span class=nf>_prepare_sample</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>sample</span><span class=p>:</span> <span class=n>Mapping</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>List</span><span class=p>[</span><span class=nb>int</span><span class=p>]]:</span>
</span><span id=__span-0-75><a id=__codelineno-0-75 name=__codelineno-0-75></a>        <span class=n>prompt</span> <span class=o>=</span> <span class=n>sample</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>_column</span><span class=p>]</span>
</span><span id=__span-0-76><a id=__codelineno-0-76 name=__codelineno-0-76></a>        <span class=n>tokens</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_tokenizer</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=n>text</span><span class=o>=</span><span class=n>prompt</span><span class=p>,</span> <span class=n>add_bos</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>add_eos</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-77><a id=__codelineno-0-77 name=__codelineno-0-77></a>
</span><span id=__span-0-78><a id=__codelineno-0-78 name=__codelineno-0-78></a>        <span class=c1># Truncate if needed, but don&#39;t coerce EOS id</span>
</span><span id=__span-0-79><a id=__codelineno-0-79 name=__codelineno-0-79></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>max_seq_len</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-80><a id=__codelineno-0-80 name=__codelineno-0-80></a>            <span class=n>tokens</span> <span class=o>=</span> <span class=n>truncate</span><span class=p>(</span><span class=n>tokens</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>max_seq_len</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span>
</span><span id=__span-0-81><a id=__codelineno-0-81 name=__codelineno-0-81></a>
</span><span id=__span-0-82><a id=__codelineno-0-82 name=__codelineno-0-82></a>        <span class=c1># No need to offset labels by 1 - happens in the recipe</span>
</span><span id=__span-0-83><a id=__codelineno-0-83 name=__codelineno-0-83></a>        <span class=n>labels</span> <span class=o>=</span> <span class=n>tokens</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
</span><span id=__span-0-84><a id=__codelineno-0-84 name=__codelineno-0-84></a>
</span><span id=__span-0-85><a id=__codelineno-0-85 name=__codelineno-0-85></a>        <span class=k>return</span> <span class=p>{</span><span class=s2>&quot;tokens&quot;</span><span class=p>:</span> <span class=n>tokens</span><span class=p>,</span> <span class=s2>&quot;labels&quot;</span><span class=p>:</span> <span class=n>labels</span><span class=p>}</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.finetune.text_completion.truncate class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">truncate</span> <a href=#nearai.finetune.text_completion.truncate class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>truncate</span><span class=p>(</span><span class=n>tokens</span><span class=p>:</span> <span class=n><span title=typing.List>List</span></span><span class=p>[</span><span class=n><span title=typing.Any>Any</span></span><span class=p>],</span> <span class=n>max_seq_len</span><span class=p>:</span> <span class=n>int</span><span class=p>,</span> <span class=n>eos_id</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n><span title=typing.Any>Any</span></span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=typing.List>List</span></span><span class=p>[</span><span class=n><span title=typing.Any>Any</span></span><span class=p>]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Truncate a list of tokens to a maximum length. If eos_id is provided, the last token will be replaced with eos_id.</p> <hr> <div class="language-text highlight"><pre><span></span><code>tokens (List[Any]): list of tokens to truncate
max_seq_len (int): maximum length of the list
eos_id (Optional[Any]): token to replace the last token with. If None, the
    last token will not be replaced. Default is None.
</code></pre></div> <hr> <div class="language-text highlight"><pre><span></span><code>List[Any]: truncated list of tokens
</code></pre></div> <details class=quote> <summary>Source code in <code>nearai/finetune/text_completion.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-8> 8</a></span>
<span class=normal><a href=#__codelineno-0-9> 9</a></span>
<span class=normal><a href=#__codelineno-0-10>10</a></span>
<span class=normal><a href=#__codelineno-0-11>11</a></span>
<span class=normal><a href=#__codelineno-0-12>12</a></span>
<span class=normal><a href=#__codelineno-0-13>13</a></span>
<span class=normal><a href=#__codelineno-0-14>14</a></span>
<span class=normal><a href=#__codelineno-0-15>15</a></span>
<span class=normal><a href=#__codelineno-0-16>16</a></span>
<span class=normal><a href=#__codelineno-0-17>17</a></span>
<span class=normal><a href=#__codelineno-0-18>18</a></span>
<span class=normal><a href=#__codelineno-0-19>19</a></span>
<span class=normal><a href=#__codelineno-0-20>20</a></span>
<span class=normal><a href=#__codelineno-0-21>21</a></span>
<span class=normal><a href=#__codelineno-0-22>22</a></span>
<span class=normal><a href=#__codelineno-0-23>23</a></span>
<span class=normal><a href=#__codelineno-0-24>24</a></span>
<span class=normal><a href=#__codelineno-0-25>25</a></span>
<span class=normal><a href=#__codelineno-0-26>26</a></span>
<span class=normal><a href=#__codelineno-0-27>27</a></span>
<span class=normal><a href=#__codelineno-0-28>28</a></span>
<span class=normal><a href=#__codelineno-0-29>29</a></span>
<span class=normal><a href=#__codelineno-0-30>30</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8></a><span class=k>def</span><span class=w> </span><span class=nf>truncate</span><span class=p>(</span>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9></a>    <span class=n>tokens</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Any</span><span class=p>],</span>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10></a>    <span class=n>max_seq_len</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11></a>    <span class=n>eos_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Any</span><span class=p>]:</span>
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Truncate a list of tokens to a maximum length. If eos_id is provided, the last token will be replaced with eos_id.</span>
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14></a>
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15></a><span class=sd>    Args:</span>
</span><span id=__span-0-16><a id=__codelineno-0-16 name=__codelineno-0-16></a><span class=sd>    ----</span>
</span><span id=__span-0-17><a id=__codelineno-0-17 name=__codelineno-0-17></a><span class=sd>        tokens (List[Any]): list of tokens to truncate</span>
</span><span id=__span-0-18><a id=__codelineno-0-18 name=__codelineno-0-18></a><span class=sd>        max_seq_len (int): maximum length of the list</span>
</span><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19></a><span class=sd>        eos_id (Optional[Any]): token to replace the last token with. If None, the</span>
</span><span id=__span-0-20><a id=__codelineno-0-20 name=__codelineno-0-20></a><span class=sd>            last token will not be replaced. Default is None.</span>
</span><span id=__span-0-21><a id=__codelineno-0-21 name=__codelineno-0-21></a>
</span><span id=__span-0-22><a id=__codelineno-0-22 name=__codelineno-0-22></a><span class=sd>    Returns:</span>
</span><span id=__span-0-23><a id=__codelineno-0-23 name=__codelineno-0-23></a><span class=sd>    -------</span>
</span><span id=__span-0-24><a id=__codelineno-0-24 name=__codelineno-0-24></a><span class=sd>        List[Any]: truncated list of tokens</span>
</span><span id=__span-0-25><a id=__codelineno-0-25 name=__codelineno-0-25></a>
</span><span id=__span-0-26><a id=__codelineno-0-26 name=__codelineno-0-26></a><span class=sd>    &quot;&quot;&quot;</span>  <span class=c1># noqa: E501</span>
</span><span id=__span-0-27><a id=__codelineno-0-27 name=__codelineno-0-27></a>    <span class=n>tokens_truncated</span> <span class=o>=</span> <span class=n>tokens</span><span class=p>[:</span><span class=n>max_seq_len</span><span class=p>]</span>
</span><span id=__span-0-28><a id=__codelineno-0-28 name=__codelineno-0-28></a>    <span class=k>if</span> <span class=n>eos_id</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=ow>and</span> <span class=n>tokens_truncated</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>!=</span> <span class=n>eos_id</span><span class=p>:</span>
</span><span id=__span-0-29><a id=__codelineno-0-29 name=__codelineno-0-29></a>        <span class=n>tokens_truncated</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>eos_id</span>
</span><span id=__span-0-30><a id=__codelineno-0-30 name=__codelineno-0-30></a>    <span class=k>return</span> <span class=n>tokens_truncated</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> </div> </div> </div> <div class="doc doc-object doc-module"> <h3 id=nearai.hub class="doc doc-heading"> <span class="doc doc-object-name doc-module-name">hub</span> <a href=#nearai.hub class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h4 id=nearai.hub.Hub class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">Hub</span> <a href=#nearai.hub.Hub class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code>object</code></p> <details class=quote> <summary>Source code in <code>nearai/hub.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-8> 8</a></span>
<span class=normal><a href=#__codelineno-0-9> 9</a></span>
<span class=normal><a href=#__codelineno-0-10>10</a></span>
<span class=normal><a href=#__codelineno-0-11>11</a></span>
<span class=normal><a href=#__codelineno-0-12>12</a></span>
<span class=normal><a href=#__codelineno-0-13>13</a></span>
<span class=normal><a href=#__codelineno-0-14>14</a></span>
<span class=normal><a href=#__codelineno-0-15>15</a></span>
<span class=normal><a href=#__codelineno-0-16>16</a></span>
<span class=normal><a href=#__codelineno-0-17>17</a></span>
<span class=normal><a href=#__codelineno-0-18>18</a></span>
<span class=normal><a href=#__codelineno-0-19>19</a></span>
<span class=normal><a href=#__codelineno-0-20>20</a></span>
<span class=normal><a href=#__codelineno-0-21>21</a></span>
<span class=normal><a href=#__codelineno-0-22>22</a></span>
<span class=normal><a href=#__codelineno-0-23>23</a></span>
<span class=normal><a href=#__codelineno-0-24>24</a></span>
<span class=normal><a href=#__codelineno-0-25>25</a></span>
<span class=normal><a href=#__codelineno-0-26>26</a></span>
<span class=normal><a href=#__codelineno-0-27>27</a></span>
<span class=normal><a href=#__codelineno-0-28>28</a></span>
<span class=normal><a href=#__codelineno-0-29>29</a></span>
<span class=normal><a href=#__codelineno-0-30>30</a></span>
<span class=normal><a href=#__codelineno-0-31>31</a></span>
<span class=normal><a href=#__codelineno-0-32>32</a></span>
<span class=normal><a href=#__codelineno-0-33>33</a></span>
<span class=normal><a href=#__codelineno-0-34>34</a></span>
<span class=normal><a href=#__codelineno-0-35>35</a></span>
<span class=normal><a href=#__codelineno-0-36>36</a></span>
<span class=normal><a href=#__codelineno-0-37>37</a></span>
<span class=normal><a href=#__codelineno-0-38>38</a></span>
<span class=normal><a href=#__codelineno-0-39>39</a></span>
<span class=normal><a href=#__codelineno-0-40>40</a></span>
<span class=normal><a href=#__codelineno-0-41>41</a></span>
<span class=normal><a href=#__codelineno-0-42>42</a></span>
<span class=normal><a href=#__codelineno-0-43>43</a></span>
<span class=normal><a href=#__codelineno-0-44>44</a></span>
<span class=normal><a href=#__codelineno-0-45>45</a></span>
<span class=normal><a href=#__codelineno-0-46>46</a></span>
<span class=normal><a href=#__codelineno-0-47>47</a></span>
<span class=normal><a href=#__codelineno-0-48>48</a></span>
<span class=normal><a href=#__codelineno-0-49>49</a></span>
<span class=normal><a href=#__codelineno-0-50>50</a></span>
<span class=normal><a href=#__codelineno-0-51>51</a></span>
<span class=normal><a href=#__codelineno-0-52>52</a></span>
<span class=normal><a href=#__codelineno-0-53>53</a></span>
<span class=normal><a href=#__codelineno-0-54>54</a></span>
<span class=normal><a href=#__codelineno-0-55>55</a></span>
<span class=normal><a href=#__codelineno-0-56>56</a></span>
<span class=normal><a href=#__codelineno-0-57>57</a></span>
<span class=normal><a href=#__codelineno-0-58>58</a></span>
<span class=normal><a href=#__codelineno-0-59>59</a></span>
<span class=normal><a href=#__codelineno-0-60>60</a></span>
<span class=normal><a href=#__codelineno-0-61>61</a></span>
<span class=normal><a href=#__codelineno-0-62>62</a></span>
<span class=normal><a href=#__codelineno-0-63>63</a></span>
<span class=normal><a href=#__codelineno-0-64>64</a></span>
<span class=normal><a href=#__codelineno-0-65>65</a></span>
<span class=normal><a href=#__codelineno-0-66>66</a></span>
<span class=normal><a href=#__codelineno-0-67>67</a></span>
<span class=normal><a href=#__codelineno-0-68>68</a></span>
<span class=normal><a href=#__codelineno-0-69>69</a></span>
<span class=normal><a href=#__codelineno-0-70>70</a></span>
<span class=normal><a href=#__codelineno-0-71>71</a></span>
<span class=normal><a href=#__codelineno-0-72>72</a></span>
<span class=normal><a href=#__codelineno-0-73>73</a></span>
<span class=normal><a href=#__codelineno-0-74>74</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8></a><span class=k>class</span><span class=w> </span><span class=nc>Hub</span><span class=p>(</span><span class=nb>object</span><span class=p>):</span>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>config</span><span class=p>:</span> <span class=n>Config</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Initializes the Hub class with the given configuration.&quot;&quot;&quot;</span>
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11></a>        <span class=bp>self</span><span class=o>.</span><span class=n>info</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12></a>        <span class=bp>self</span><span class=o>.</span><span class=n>provider</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13></a>        <span class=bp>self</span><span class=o>.</span><span class=n>model</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14></a>        <span class=bp>self</span><span class=o>.</span><span class=n>endpoint</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15></a>        <span class=bp>self</span><span class=o>.</span><span class=n>query</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-16><a id=__codelineno-0-16 name=__codelineno-0-16></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_config</span> <span class=o>=</span> <span class=n>config</span>
</span><span id=__span-0-17><a id=__codelineno-0-17 name=__codelineno-0-17></a>
</span><span id=__span-0-18><a id=__codelineno-0-18 name=__codelineno-0-18></a>    <span class=k>def</span><span class=w> </span><span class=nf>parse_hub_chat_params</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>kwargs</span><span class=p>):</span>
</span><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Parses and sets instance attributes from the given keyword arguments, using default values if needed.&quot;&quot;&quot;</span>
</span><span id=__span-0-20><a id=__codelineno-0-20 name=__codelineno-0-20></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>nearai_hub</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-21><a id=__codelineno-0-21 name=__codelineno-0-21></a>            <span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>nearai_hub</span> <span class=o>=</span> <span class=n>NearAiHubConfig</span><span class=p>()</span>
</span><span id=__span-0-22><a id=__codelineno-0-22 name=__codelineno-0-22></a>
</span><span id=__span-0-23><a id=__codelineno-0-23 name=__codelineno-0-23></a>        <span class=bp>self</span><span class=o>.</span><span class=n>query</span> <span class=o>=</span> <span class=n>kwargs</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;query&quot;</span><span class=p>)</span>
</span><span id=__span-0-24><a id=__codelineno-0-24 name=__codelineno-0-24></a>        <span class=bp>self</span><span class=o>.</span><span class=n>endpoint</span> <span class=o>=</span> <span class=n>kwargs</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;endpoint&quot;</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>nearai_hub</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>/chat/completions&quot;</span><span class=p>)</span>
</span><span id=__span-0-25><a id=__codelineno-0-25 name=__codelineno-0-25></a>        <span class=bp>self</span><span class=o>.</span><span class=n>model</span> <span class=o>=</span> <span class=n>kwargs</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;model&quot;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>nearai_hub</span><span class=o>.</span><span class=n>default_model</span><span class=p>)</span>
</span><span id=__span-0-26><a id=__codelineno-0-26 name=__codelineno-0-26></a>        <span class=bp>self</span><span class=o>.</span><span class=n>provider</span> <span class=o>=</span> <span class=n>kwargs</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;provider&quot;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>nearai_hub</span><span class=o>.</span><span class=n>default_provider</span><span class=p>)</span>
</span><span id=__span-0-27><a id=__codelineno-0-27 name=__codelineno-0-27></a>        <span class=bp>self</span><span class=o>.</span><span class=n>info</span> <span class=o>=</span> <span class=n>kwargs</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;info&quot;</span><span class=p>,</span> <span class=kc>False</span><span class=p>)</span>
</span><span id=__span-0-28><a id=__codelineno-0-28 name=__codelineno-0-28></a>
</span><span id=__span-0-29><a id=__codelineno-0-29 name=__codelineno-0-29></a>    <span class=k>def</span><span class=w> </span><span class=nf>chat</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>kwargs</span><span class=p>):</span>
</span><span id=__span-0-30><a id=__codelineno-0-30 name=__codelineno-0-30></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Processes a chat request by sending parameters to the NEAR AI Hub and printing the response.&quot;&quot;&quot;</span>
</span><span id=__span-0-31><a id=__codelineno-0-31 name=__codelineno-0-31></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-32><a id=__codelineno-0-32 name=__codelineno-0-32></a>            <span class=bp>self</span><span class=o>.</span><span class=n>parse_hub_chat_params</span><span class=p>(</span><span class=n>kwargs</span><span class=p>)</span>
</span><span id=__span-0-33><a id=__codelineno-0-33 name=__codelineno-0-33></a>
</span><span id=__span-0-34><a id=__codelineno-0-34 name=__codelineno-0-34></a>            <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>query</span><span class=p>:</span>
</span><span id=__span-0-35><a id=__codelineno-0-35 name=__codelineno-0-35></a>                <span class=k>return</span> <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Error: &#39;query&#39; is required for the `hub chat` command.&quot;</span><span class=p>)</span>
</span><span id=__span-0-36><a id=__codelineno-0-36 name=__codelineno-0-36></a>
</span><span id=__span-0-37><a id=__codelineno-0-37 name=__codelineno-0-37></a>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>nearai_hub</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-38><a id=__codelineno-0-38 name=__codelineno-0-38></a>                <span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>nearai_hub</span> <span class=o>=</span> <span class=n>NearAiHubConfig</span><span class=p>()</span>
</span><span id=__span-0-39><a id=__codelineno-0-39 name=__codelineno-0-39></a>
</span><span id=__span-0-40><a id=__codelineno-0-40 name=__codelineno-0-40></a>            <span class=n>data</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-41><a id=__codelineno-0-41 name=__codelineno-0-41></a>                <span class=s2>&quot;max_tokens&quot;</span><span class=p>:</span> <span class=mi>256</span><span class=p>,</span>
</span><span id=__span-0-42><a id=__codelineno-0-42 name=__codelineno-0-42></a>                <span class=s2>&quot;temperature&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span><span id=__span-0-43><a id=__codelineno-0-43 name=__codelineno-0-43></a>                <span class=s2>&quot;frequency_penalty&quot;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span><span id=__span-0-44><a id=__codelineno-0-44 name=__codelineno-0-44></a>                <span class=s2>&quot;n&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span><span id=__span-0-45><a id=__codelineno-0-45 name=__codelineno-0-45></a>                <span class=s2>&quot;messages&quot;</span><span class=p>:</span> <span class=p>[{</span><span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;user&quot;</span><span class=p>,</span> <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>query</span><span class=p>)}],</span>
</span><span id=__span-0-46><a id=__codelineno-0-46 name=__codelineno-0-46></a>                <span class=s2>&quot;model&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>model</span><span class=p>,</span>
</span><span id=__span-0-47><a id=__codelineno-0-47 name=__codelineno-0-47></a>            <span class=p>}</span>
</span><span id=__span-0-48><a id=__codelineno-0-48 name=__codelineno-0-48></a>
</span><span id=__span-0-49><a id=__codelineno-0-49 name=__codelineno-0-49></a>            <span class=n>auth</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>auth</span>
</span><span id=__span-0-50><a id=__codelineno-0-50 name=__codelineno-0-50></a>
</span><span id=__span-0-51><a id=__codelineno-0-51 name=__codelineno-0-51></a>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>nearai_hub</span><span class=o>.</span><span class=n>login_with_near</span><span class=p>:</span>
</span><span id=__span-0-52><a id=__codelineno-0-52 name=__codelineno-0-52></a>                <span class=n>bearer_token</span> <span class=o>=</span> <span class=n>auth</span><span class=o>.</span><span class=n>generate_bearer_token</span><span class=p>()</span>
</span><span id=__span-0-53><a id=__codelineno-0-53 name=__codelineno-0-53></a>                <span class=n>headers</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;Content-Type&quot;</span><span class=p>:</span> <span class=s2>&quot;application/json&quot;</span><span class=p>,</span> <span class=s2>&quot;Authorization&quot;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;Bearer </span><span class=si>{</span><span class=n>bearer_token</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>}</span>
</span><span id=__span-0-54><a id=__codelineno-0-54 name=__codelineno-0-54></a>
</span><span id=__span-0-55><a id=__codelineno-0-55 name=__codelineno-0-55></a>                <span class=n>data</span><span class=p>[</span><span class=s2>&quot;provider&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>provider</span>
</span><span id=__span-0-56><a id=__codelineno-0-56 name=__codelineno-0-56></a>            <span class=k>elif</span> <span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>nearai_hub</span><span class=o>.</span><span class=n>api_key</span><span class=p>:</span>
</span><span id=__span-0-57><a id=__codelineno-0-57 name=__codelineno-0-57></a>                <span class=n>headers</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-58><a id=__codelineno-0-58 name=__codelineno-0-58></a>                    <span class=s2>&quot;Content-Type&quot;</span><span class=p>:</span> <span class=s2>&quot;application/json&quot;</span><span class=p>,</span>
</span><span id=__span-0-59><a id=__codelineno-0-59 name=__codelineno-0-59></a>                    <span class=s2>&quot;Authorization&quot;</span><span class=p>:</span> <span class=s2>&quot;Bearer </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>nearai_hub</span><span class=o>.</span><span class=n>api_key</span><span class=p>),</span>
</span><span id=__span-0-60><a id=__codelineno-0-60 name=__codelineno-0-60></a>                <span class=p>}</span>
</span><span id=__span-0-61><a id=__codelineno-0-61 name=__codelineno-0-61></a>            <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-62><a id=__codelineno-0-62 name=__codelineno-0-62></a>                <span class=k>return</span> <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Illegal NEAR AI Hub Config&quot;</span><span class=p>)</span>
</span><span id=__span-0-63><a id=__codelineno-0-63 name=__codelineno-0-63></a>
</span><span id=__span-0-64><a id=__codelineno-0-64 name=__codelineno-0-64></a>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>info</span><span class=p>:</span>
</span><span id=__span-0-65><a id=__codelineno-0-65 name=__codelineno-0-65></a>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Requesting hub using NEAR Account </span><span class=si>{</span><span class=n>auth</span><span class=o>.</span><span class=n>account_id</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-66><a id=__codelineno-0-66 name=__codelineno-0-66></a>
</span><span id=__span-0-67><a id=__codelineno-0-67 name=__codelineno-0-67></a>            <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>endpoint</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>data</span><span class=p>))</span>
</span><span id=__span-0-68><a id=__codelineno-0-68 name=__codelineno-0-68></a>
</span><span id=__span-0-69><a id=__codelineno-0-69 name=__codelineno-0-69></a>            <span class=n>completion</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span><span id=__span-0-70><a id=__codelineno-0-70 name=__codelineno-0-70></a>
</span><span id=__span-0-71><a id=__codelineno-0-71 name=__codelineno-0-71></a>            <span class=nb>print</span><span class=p>(</span><span class=n>completion</span><span class=p>[</span><span class=s2>&quot;choices&quot;</span><span class=p>][</span><span class=mi>0</span><span class=p>][</span><span class=s2>&quot;message&quot;</span><span class=p>][</span><span class=s2>&quot;content&quot;</span><span class=p>])</span>
</span><span id=__span-0-72><a id=__codelineno-0-72 name=__codelineno-0-72></a>
</span><span id=__span-0-73><a id=__codelineno-0-73 name=__codelineno-0-73></a>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-74><a id=__codelineno-0-74 name=__codelineno-0-74></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Request failed: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h5 id=nearai.hub.Hub.__init__ class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">__init__</span> <a href=#nearai.hub.Hub.__init__ class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=fm>__init__</span><span class=p>(</span><span class=nf>config</span><span class=p>:</span> <span class=n><a class="autorefs autorefs-internal" title=nearai.config.Config href=#nearai.config.Config>Config</a></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Initializes the Hub class with the given configuration.</p> <details class=quote> <summary>Source code in <code>nearai/hub.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-9> 9</a></span>
<span class=normal><a href=#__codelineno-0-10>10</a></span>
<span class=normal><a href=#__codelineno-0-11>11</a></span>
<span class=normal><a href=#__codelineno-0-12>12</a></span>
<span class=normal><a href=#__codelineno-0-13>13</a></span>
<span class=normal><a href=#__codelineno-0-14>14</a></span>
<span class=normal><a href=#__codelineno-0-15>15</a></span>
<span class=normal><a href=#__codelineno-0-16>16</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9></a><span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>config</span><span class=p>:</span> <span class=n>Config</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Initializes the Hub class with the given configuration.&quot;&quot;&quot;</span>
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11></a>    <span class=bp>self</span><span class=o>.</span><span class=n>info</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12></a>    <span class=bp>self</span><span class=o>.</span><span class=n>provider</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13></a>    <span class=bp>self</span><span class=o>.</span><span class=n>model</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14></a>    <span class=bp>self</span><span class=o>.</span><span class=n>endpoint</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15></a>    <span class=bp>self</span><span class=o>.</span><span class=n>query</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-16><a id=__codelineno-0-16 name=__codelineno-0-16></a>    <span class=bp>self</span><span class=o>.</span><span class=n>_config</span> <span class=o>=</span> <span class=n>config</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.hub.Hub.chat class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">chat</span> <a href=#nearai.hub.Hub.chat class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>chat</span><span class=p>(</span><span class=n>kwargs</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Processes a chat request by sending parameters to the NEAR AI Hub and printing the response.</p> <details class=quote> <summary>Source code in <code>nearai/hub.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-29>29</a></span>
<span class=normal><a href=#__codelineno-0-30>30</a></span>
<span class=normal><a href=#__codelineno-0-31>31</a></span>
<span class=normal><a href=#__codelineno-0-32>32</a></span>
<span class=normal><a href=#__codelineno-0-33>33</a></span>
<span class=normal><a href=#__codelineno-0-34>34</a></span>
<span class=normal><a href=#__codelineno-0-35>35</a></span>
<span class=normal><a href=#__codelineno-0-36>36</a></span>
<span class=normal><a href=#__codelineno-0-37>37</a></span>
<span class=normal><a href=#__codelineno-0-38>38</a></span>
<span class=normal><a href=#__codelineno-0-39>39</a></span>
<span class=normal><a href=#__codelineno-0-40>40</a></span>
<span class=normal><a href=#__codelineno-0-41>41</a></span>
<span class=normal><a href=#__codelineno-0-42>42</a></span>
<span class=normal><a href=#__codelineno-0-43>43</a></span>
<span class=normal><a href=#__codelineno-0-44>44</a></span>
<span class=normal><a href=#__codelineno-0-45>45</a></span>
<span class=normal><a href=#__codelineno-0-46>46</a></span>
<span class=normal><a href=#__codelineno-0-47>47</a></span>
<span class=normal><a href=#__codelineno-0-48>48</a></span>
<span class=normal><a href=#__codelineno-0-49>49</a></span>
<span class=normal><a href=#__codelineno-0-50>50</a></span>
<span class=normal><a href=#__codelineno-0-51>51</a></span>
<span class=normal><a href=#__codelineno-0-52>52</a></span>
<span class=normal><a href=#__codelineno-0-53>53</a></span>
<span class=normal><a href=#__codelineno-0-54>54</a></span>
<span class=normal><a href=#__codelineno-0-55>55</a></span>
<span class=normal><a href=#__codelineno-0-56>56</a></span>
<span class=normal><a href=#__codelineno-0-57>57</a></span>
<span class=normal><a href=#__codelineno-0-58>58</a></span>
<span class=normal><a href=#__codelineno-0-59>59</a></span>
<span class=normal><a href=#__codelineno-0-60>60</a></span>
<span class=normal><a href=#__codelineno-0-61>61</a></span>
<span class=normal><a href=#__codelineno-0-62>62</a></span>
<span class=normal><a href=#__codelineno-0-63>63</a></span>
<span class=normal><a href=#__codelineno-0-64>64</a></span>
<span class=normal><a href=#__codelineno-0-65>65</a></span>
<span class=normal><a href=#__codelineno-0-66>66</a></span>
<span class=normal><a href=#__codelineno-0-67>67</a></span>
<span class=normal><a href=#__codelineno-0-68>68</a></span>
<span class=normal><a href=#__codelineno-0-69>69</a></span>
<span class=normal><a href=#__codelineno-0-70>70</a></span>
<span class=normal><a href=#__codelineno-0-71>71</a></span>
<span class=normal><a href=#__codelineno-0-72>72</a></span>
<span class=normal><a href=#__codelineno-0-73>73</a></span>
<span class=normal><a href=#__codelineno-0-74>74</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-29><a id=__codelineno-0-29 name=__codelineno-0-29></a><span class=k>def</span><span class=w> </span><span class=nf>chat</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>kwargs</span><span class=p>):</span>
</span><span id=__span-0-30><a id=__codelineno-0-30 name=__codelineno-0-30></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Processes a chat request by sending parameters to the NEAR AI Hub and printing the response.&quot;&quot;&quot;</span>
</span><span id=__span-0-31><a id=__codelineno-0-31 name=__codelineno-0-31></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-32><a id=__codelineno-0-32 name=__codelineno-0-32></a>        <span class=bp>self</span><span class=o>.</span><span class=n>parse_hub_chat_params</span><span class=p>(</span><span class=n>kwargs</span><span class=p>)</span>
</span><span id=__span-0-33><a id=__codelineno-0-33 name=__codelineno-0-33></a>
</span><span id=__span-0-34><a id=__codelineno-0-34 name=__codelineno-0-34></a>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>query</span><span class=p>:</span>
</span><span id=__span-0-35><a id=__codelineno-0-35 name=__codelineno-0-35></a>            <span class=k>return</span> <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Error: &#39;query&#39; is required for the `hub chat` command.&quot;</span><span class=p>)</span>
</span><span id=__span-0-36><a id=__codelineno-0-36 name=__codelineno-0-36></a>
</span><span id=__span-0-37><a id=__codelineno-0-37 name=__codelineno-0-37></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>nearai_hub</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-38><a id=__codelineno-0-38 name=__codelineno-0-38></a>            <span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>nearai_hub</span> <span class=o>=</span> <span class=n>NearAiHubConfig</span><span class=p>()</span>
</span><span id=__span-0-39><a id=__codelineno-0-39 name=__codelineno-0-39></a>
</span><span id=__span-0-40><a id=__codelineno-0-40 name=__codelineno-0-40></a>        <span class=n>data</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-41><a id=__codelineno-0-41 name=__codelineno-0-41></a>            <span class=s2>&quot;max_tokens&quot;</span><span class=p>:</span> <span class=mi>256</span><span class=p>,</span>
</span><span id=__span-0-42><a id=__codelineno-0-42 name=__codelineno-0-42></a>            <span class=s2>&quot;temperature&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span><span id=__span-0-43><a id=__codelineno-0-43 name=__codelineno-0-43></a>            <span class=s2>&quot;frequency_penalty&quot;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span><span id=__span-0-44><a id=__codelineno-0-44 name=__codelineno-0-44></a>            <span class=s2>&quot;n&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span><span id=__span-0-45><a id=__codelineno-0-45 name=__codelineno-0-45></a>            <span class=s2>&quot;messages&quot;</span><span class=p>:</span> <span class=p>[{</span><span class=s2>&quot;role&quot;</span><span class=p>:</span> <span class=s2>&quot;user&quot;</span><span class=p>,</span> <span class=s2>&quot;content&quot;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>query</span><span class=p>)}],</span>
</span><span id=__span-0-46><a id=__codelineno-0-46 name=__codelineno-0-46></a>            <span class=s2>&quot;model&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>model</span><span class=p>,</span>
</span><span id=__span-0-47><a id=__codelineno-0-47 name=__codelineno-0-47></a>        <span class=p>}</span>
</span><span id=__span-0-48><a id=__codelineno-0-48 name=__codelineno-0-48></a>
</span><span id=__span-0-49><a id=__codelineno-0-49 name=__codelineno-0-49></a>        <span class=n>auth</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>auth</span>
</span><span id=__span-0-50><a id=__codelineno-0-50 name=__codelineno-0-50></a>
</span><span id=__span-0-51><a id=__codelineno-0-51 name=__codelineno-0-51></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>nearai_hub</span><span class=o>.</span><span class=n>login_with_near</span><span class=p>:</span>
</span><span id=__span-0-52><a id=__codelineno-0-52 name=__codelineno-0-52></a>            <span class=n>bearer_token</span> <span class=o>=</span> <span class=n>auth</span><span class=o>.</span><span class=n>generate_bearer_token</span><span class=p>()</span>
</span><span id=__span-0-53><a id=__codelineno-0-53 name=__codelineno-0-53></a>            <span class=n>headers</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;Content-Type&quot;</span><span class=p>:</span> <span class=s2>&quot;application/json&quot;</span><span class=p>,</span> <span class=s2>&quot;Authorization&quot;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;Bearer </span><span class=si>{</span><span class=n>bearer_token</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>}</span>
</span><span id=__span-0-54><a id=__codelineno-0-54 name=__codelineno-0-54></a>
</span><span id=__span-0-55><a id=__codelineno-0-55 name=__codelineno-0-55></a>            <span class=n>data</span><span class=p>[</span><span class=s2>&quot;provider&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>provider</span>
</span><span id=__span-0-56><a id=__codelineno-0-56 name=__codelineno-0-56></a>        <span class=k>elif</span> <span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>nearai_hub</span><span class=o>.</span><span class=n>api_key</span><span class=p>:</span>
</span><span id=__span-0-57><a id=__codelineno-0-57 name=__codelineno-0-57></a>            <span class=n>headers</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-58><a id=__codelineno-0-58 name=__codelineno-0-58></a>                <span class=s2>&quot;Content-Type&quot;</span><span class=p>:</span> <span class=s2>&quot;application/json&quot;</span><span class=p>,</span>
</span><span id=__span-0-59><a id=__codelineno-0-59 name=__codelineno-0-59></a>                <span class=s2>&quot;Authorization&quot;</span><span class=p>:</span> <span class=s2>&quot;Bearer </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>nearai_hub</span><span class=o>.</span><span class=n>api_key</span><span class=p>),</span>
</span><span id=__span-0-60><a id=__codelineno-0-60 name=__codelineno-0-60></a>            <span class=p>}</span>
</span><span id=__span-0-61><a id=__codelineno-0-61 name=__codelineno-0-61></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-62><a id=__codelineno-0-62 name=__codelineno-0-62></a>            <span class=k>return</span> <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Illegal NEAR AI Hub Config&quot;</span><span class=p>)</span>
</span><span id=__span-0-63><a id=__codelineno-0-63 name=__codelineno-0-63></a>
</span><span id=__span-0-64><a id=__codelineno-0-64 name=__codelineno-0-64></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>info</span><span class=p>:</span>
</span><span id=__span-0-65><a id=__codelineno-0-65 name=__codelineno-0-65></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Requesting hub using NEAR Account </span><span class=si>{</span><span class=n>auth</span><span class=o>.</span><span class=n>account_id</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-66><a id=__codelineno-0-66 name=__codelineno-0-66></a>
</span><span id=__span-0-67><a id=__codelineno-0-67 name=__codelineno-0-67></a>        <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>endpoint</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>data</span><span class=p>))</span>
</span><span id=__span-0-68><a id=__codelineno-0-68 name=__codelineno-0-68></a>
</span><span id=__span-0-69><a id=__codelineno-0-69 name=__codelineno-0-69></a>        <span class=n>completion</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span><span id=__span-0-70><a id=__codelineno-0-70 name=__codelineno-0-70></a>
</span><span id=__span-0-71><a id=__codelineno-0-71 name=__codelineno-0-71></a>        <span class=nb>print</span><span class=p>(</span><span class=n>completion</span><span class=p>[</span><span class=s2>&quot;choices&quot;</span><span class=p>][</span><span class=mi>0</span><span class=p>][</span><span class=s2>&quot;message&quot;</span><span class=p>][</span><span class=s2>&quot;content&quot;</span><span class=p>])</span>
</span><span id=__span-0-72><a id=__codelineno-0-72 name=__codelineno-0-72></a>
</span><span id=__span-0-73><a id=__codelineno-0-73 name=__codelineno-0-73></a>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-74><a id=__codelineno-0-74 name=__codelineno-0-74></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Request failed: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.hub.Hub.parse_hub_chat_params class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">parse_hub_chat_params</span> <a href=#nearai.hub.Hub.parse_hub_chat_params class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>parse_hub_chat_params</span><span class=p>(</span><span class=n>kwargs</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Parses and sets instance attributes from the given keyword arguments, using default values if needed.</p> <details class=quote> <summary>Source code in <code>nearai/hub.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-18>18</a></span>
<span class=normal><a href=#__codelineno-0-19>19</a></span>
<span class=normal><a href=#__codelineno-0-20>20</a></span>
<span class=normal><a href=#__codelineno-0-21>21</a></span>
<span class=normal><a href=#__codelineno-0-22>22</a></span>
<span class=normal><a href=#__codelineno-0-23>23</a></span>
<span class=normal><a href=#__codelineno-0-24>24</a></span>
<span class=normal><a href=#__codelineno-0-25>25</a></span>
<span class=normal><a href=#__codelineno-0-26>26</a></span>
<span class=normal><a href=#__codelineno-0-27>27</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-18><a id=__codelineno-0-18 name=__codelineno-0-18></a><span class=k>def</span><span class=w> </span><span class=nf>parse_hub_chat_params</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>kwargs</span><span class=p>):</span>
</span><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Parses and sets instance attributes from the given keyword arguments, using default values if needed.&quot;&quot;&quot;</span>
</span><span id=__span-0-20><a id=__codelineno-0-20 name=__codelineno-0-20></a>    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>nearai_hub</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-21><a id=__codelineno-0-21 name=__codelineno-0-21></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>nearai_hub</span> <span class=o>=</span> <span class=n>NearAiHubConfig</span><span class=p>()</span>
</span><span id=__span-0-22><a id=__codelineno-0-22 name=__codelineno-0-22></a>
</span><span id=__span-0-23><a id=__codelineno-0-23 name=__codelineno-0-23></a>    <span class=bp>self</span><span class=o>.</span><span class=n>query</span> <span class=o>=</span> <span class=n>kwargs</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;query&quot;</span><span class=p>)</span>
</span><span id=__span-0-24><a id=__codelineno-0-24 name=__codelineno-0-24></a>    <span class=bp>self</span><span class=o>.</span><span class=n>endpoint</span> <span class=o>=</span> <span class=n>kwargs</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;endpoint&quot;</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>nearai_hub</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>/chat/completions&quot;</span><span class=p>)</span>
</span><span id=__span-0-25><a id=__codelineno-0-25 name=__codelineno-0-25></a>    <span class=bp>self</span><span class=o>.</span><span class=n>model</span> <span class=o>=</span> <span class=n>kwargs</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;model&quot;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>nearai_hub</span><span class=o>.</span><span class=n>default_model</span><span class=p>)</span>
</span><span id=__span-0-26><a id=__codelineno-0-26 name=__codelineno-0-26></a>    <span class=bp>self</span><span class=o>.</span><span class=n>provider</span> <span class=o>=</span> <span class=n>kwargs</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;provider&quot;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>nearai_hub</span><span class=o>.</span><span class=n>default_provider</span><span class=p>)</span>
</span><span id=__span-0-27><a id=__codelineno-0-27 name=__codelineno-0-27></a>    <span class=bp>self</span><span class=o>.</span><span class=n>info</span> <span class=o>=</span> <span class=n>kwargs</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;info&quot;</span><span class=p>,</span> <span class=kc>False</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> </div> </div> </div> <div class="doc doc-object doc-module"> <h3 id=nearai.lib class="doc doc-heading"> <span class="doc doc-object-name doc-module-name">lib</span> <a href=#nearai.lib class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h4 id=nearai.lib.parse_location class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">parse_location</span> <a href=#nearai.lib.parse_location class=headerlink title="Permanent link">&para;</a></h4> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>parse_location</span><span class=p>(</span><span class=n>entry_location</span><span class=p>:</span> <span class=n>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><a class="autorefs autorefs-internal" title=nearai.openapi_client.models.entry_location.EntryLocation href=#nearai.EntryLocation>EntryLocation</a></span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Create a EntryLocation from a string in the format namespace/name/version.</p> <details class=quote> <summary>Source code in <code>nearai/lib.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-13>13</a></span>
<span class=normal><a href=#__codelineno-0-14>14</a></span>
<span class=normal><a href=#__codelineno-0-15>15</a></span>
<span class=normal><a href=#__codelineno-0-16>16</a></span>
<span class=normal><a href=#__codelineno-0-17>17</a></span>
<span class=normal><a href=#__codelineno-0-18>18</a></span>
<span class=normal><a href=#__codelineno-0-19>19</a></span>
<span class=normal><a href=#__codelineno-0-20>20</a></span>
<span class=normal><a href=#__codelineno-0-21>21</a></span>
<span class=normal><a href=#__codelineno-0-22>22</a></span>
<span class=normal><a href=#__codelineno-0-23>23</a></span>
<span class=normal><a href=#__codelineno-0-24>24</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13></a><span class=k>def</span><span class=w> </span><span class=nf>parse_location</span><span class=p>(</span><span class=n>entry_location</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>EntryLocation</span><span class=p>:</span>
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Create a EntryLocation from a string in the format namespace/name/version.&quot;&quot;&quot;</span>
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15></a>    <span class=n>match</span> <span class=o>=</span> <span class=n>entry_location_pattern</span><span class=o>.</span><span class=n>match</span><span class=p>(</span><span class=n>entry_location</span><span class=p>)</span>
</span><span id=__span-0-16><a id=__codelineno-0-16 name=__codelineno-0-16></a>
</span><span id=__span-0-17><a id=__codelineno-0-17 name=__codelineno-0-17></a>    <span class=k>if</span> <span class=n>match</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-18><a id=__codelineno-0-18 name=__codelineno-0-18></a>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Invalid entry format: </span><span class=si>{</span><span class=n>entry_location</span><span class=si>}</span><span class=s2>. Should have the format &lt;namespace&gt;/&lt;name&gt;/&lt;version&gt;&quot;</span><span class=p>)</span>
</span><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19></a>
</span><span id=__span-0-20><a id=__codelineno-0-20 name=__codelineno-0-20></a>    <span class=k>return</span> <span class=n>EntryLocation</span><span class=p>(</span>
</span><span id=__span-0-21><a id=__codelineno-0-21 name=__codelineno-0-21></a>        <span class=n>namespace</span><span class=o>=</span><span class=n>match</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=s2>&quot;namespace&quot;</span><span class=p>),</span>
</span><span id=__span-0-22><a id=__codelineno-0-22 name=__codelineno-0-22></a>        <span class=n>name</span><span class=o>=</span><span class=n>match</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=s2>&quot;name&quot;</span><span class=p>),</span>
</span><span id=__span-0-23><a id=__codelineno-0-23 name=__codelineno-0-23></a>        <span class=n>version</span><span class=o>=</span><span class=n>match</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=s2>&quot;version&quot;</span><span class=p>),</span>
</span><span id=__span-0-24><a id=__codelineno-0-24 name=__codelineno-0-24></a>    <span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-module"> <h3 id=nearai.login class="doc doc-heading"> <span class="doc doc-object-name doc-module-name">login</span> <a href=#nearai.login class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h4 id=nearai.login.AuthHandler class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">AuthHandler</span> <a href=#nearai.login.AuthHandler class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=http.server.SimpleHTTPRequestHandler>SimpleHTTPRequestHandler</span></code></p> <details class=quote> <summary>Source code in <code>nearai/login.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-72> 72</a></span>
<span class=normal><a href=#__codelineno-0-73> 73</a></span>
<span class=normal><a href=#__codelineno-0-74> 74</a></span>
<span class=normal><a href=#__codelineno-0-75> 75</a></span>
<span class=normal><a href=#__codelineno-0-76> 76</a></span>
<span class=normal><a href=#__codelineno-0-77> 77</a></span>
<span class=normal><a href=#__codelineno-0-78> 78</a></span>
<span class=normal><a href=#__codelineno-0-79> 79</a></span>
<span class=normal><a href=#__codelineno-0-80> 80</a></span>
<span class=normal><a href=#__codelineno-0-81> 81</a></span>
<span class=normal><a href=#__codelineno-0-82> 82</a></span>
<span class=normal><a href=#__codelineno-0-83> 83</a></span>
<span class=normal><a href=#__codelineno-0-84> 84</a></span>
<span class=normal><a href=#__codelineno-0-85> 85</a></span>
<span class=normal><a href=#__codelineno-0-86> 86</a></span>
<span class=normal><a href=#__codelineno-0-87> 87</a></span>
<span class=normal><a href=#__codelineno-0-88> 88</a></span>
<span class=normal><a href=#__codelineno-0-89> 89</a></span>
<span class=normal><a href=#__codelineno-0-90> 90</a></span>
<span class=normal><a href=#__codelineno-0-91> 91</a></span>
<span class=normal><a href=#__codelineno-0-92> 92</a></span>
<span class=normal><a href=#__codelineno-0-93> 93</a></span>
<span class=normal><a href=#__codelineno-0-94> 94</a></span>
<span class=normal><a href=#__codelineno-0-95> 95</a></span>
<span class=normal><a href=#__codelineno-0-96> 96</a></span>
<span class=normal><a href=#__codelineno-0-97> 97</a></span>
<span class=normal><a href=#__codelineno-0-98> 98</a></span>
<span class=normal><a href=#__codelineno-0-99> 99</a></span>
<span class=normal><a href=#__codelineno-0-100>100</a></span>
<span class=normal><a href=#__codelineno-0-101>101</a></span>
<span class=normal><a href=#__codelineno-0-102>102</a></span>
<span class=normal><a href=#__codelineno-0-103>103</a></span>
<span class=normal><a href=#__codelineno-0-104>104</a></span>
<span class=normal><a href=#__codelineno-0-105>105</a></span>
<span class=normal><a href=#__codelineno-0-106>106</a></span>
<span class=normal><a href=#__codelineno-0-107>107</a></span>
<span class=normal><a href=#__codelineno-0-108>108</a></span>
<span class=normal><a href=#__codelineno-0-109>109</a></span>
<span class=normal><a href=#__codelineno-0-110>110</a></span>
<span class=normal><a href=#__codelineno-0-111>111</a></span>
<span class=normal><a href=#__codelineno-0-112>112</a></span>
<span class=normal><a href=#__codelineno-0-113>113</a></span>
<span class=normal><a href=#__codelineno-0-114>114</a></span>
<span class=normal><a href=#__codelineno-0-115>115</a></span>
<span class=normal><a href=#__codelineno-0-116>116</a></span>
<span class=normal><a href=#__codelineno-0-117>117</a></span>
<span class=normal><a href=#__codelineno-0-118>118</a></span>
<span class=normal><a href=#__codelineno-0-119>119</a></span>
<span class=normal><a href=#__codelineno-0-120>120</a></span>
<span class=normal><a href=#__codelineno-0-121>121</a></span>
<span class=normal><a href=#__codelineno-0-122>122</a></span>
<span class=normal><a href=#__codelineno-0-123>123</a></span>
<span class=normal><a href=#__codelineno-0-124>124</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-72><a id=__codelineno-0-72 name=__codelineno-0-72></a><span class=k>class</span><span class=w> </span><span class=nc>AuthHandler</span><span class=p>(</span><span class=n>http</span><span class=o>.</span><span class=n>server</span><span class=o>.</span><span class=n>SimpleHTTPRequestHandler</span><span class=p>):</span>
</span><span id=__span-0-73><a id=__codelineno-0-73 name=__codelineno-0-73></a>    <span class=k>def</span><span class=w> </span><span class=nf>log_message</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=nb>format</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>):</span>
</span><span id=__span-0-74><a id=__codelineno-0-74 name=__codelineno-0-74></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Webserver logging method.&quot;&quot;&quot;</span>
</span><span id=__span-0-75><a id=__codelineno-0-75 name=__codelineno-0-75></a>        <span class=k>pass</span>  <span class=c1># Override to suppress logging</span>
</span><span id=__span-0-76><a id=__codelineno-0-76 name=__codelineno-0-76></a>
</span><span id=__span-0-77><a id=__codelineno-0-77 name=__codelineno-0-77></a>    <span class=k>def</span><span class=w> </span><span class=nf>do_GET</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>  <span class=c1># noqa: N802</span>
</span><span id=__span-0-78><a id=__codelineno-0-78 name=__codelineno-0-78></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Webserver GET method.&quot;&quot;&quot;</span>
</span><span id=__span-0-79><a id=__codelineno-0-79 name=__codelineno-0-79></a>        <span class=k>global</span> <span class=n>NONCE</span><span class=p>,</span> <span class=n>PORT</span>
</span><span id=__span-0-80><a id=__codelineno-0-80 name=__codelineno-0-80></a>
</span><span id=__span-0-81><a id=__codelineno-0-81 name=__codelineno-0-81></a>        <span class=n>script_path</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=vm>__file__</span><span class=p>)</span><span class=o>.</span><span class=n>resolve</span><span class=p>()</span>
</span><span id=__span-0-82><a id=__codelineno-0-82 name=__codelineno-0-82></a>        <span class=n>assets_folder</span> <span class=o>=</span> <span class=n>script_path</span><span class=o>.</span><span class=n>parent</span> <span class=o>/</span> <span class=s2>&quot;assets&quot;</span>
</span><span id=__span-0-83><a id=__codelineno-0-83 name=__codelineno-0-83></a>
</span><span id=__span-0-84><a id=__codelineno-0-84 name=__codelineno-0-84></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&quot;/capture&quot;</span><span class=p>):</span>
</span><span id=__span-0-85><a id=__codelineno-0-85 name=__codelineno-0-85></a>            <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>assets_folder</span><span class=p>,</span> <span class=s2>&quot;auth_capture.html&quot;</span><span class=p>),</span> <span class=s2>&quot;r&quot;</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s2>&quot;utf-8&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>file</span><span class=p>:</span>
</span><span id=__span-0-86><a id=__codelineno-0-86 name=__codelineno-0-86></a>                <span class=n>content</span> <span class=o>=</span> <span class=n>file</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span><span id=__span-0-87><a id=__codelineno-0-87 name=__codelineno-0-87></a>            <span class=bp>self</span><span class=o>.</span><span class=n>send_response</span><span class=p>(</span><span class=mi>200</span><span class=p>)</span>
</span><span id=__span-0-88><a id=__codelineno-0-88 name=__codelineno-0-88></a>            <span class=bp>self</span><span class=o>.</span><span class=n>send_header</span><span class=p>(</span><span class=s2>&quot;Content-type&quot;</span><span class=p>,</span> <span class=s2>&quot;text/html&quot;</span><span class=p>)</span>
</span><span id=__span-0-89><a id=__codelineno-0-89 name=__codelineno-0-89></a>            <span class=bp>self</span><span class=o>.</span><span class=n>end_headers</span><span class=p>()</span>
</span><span id=__span-0-90><a id=__codelineno-0-90 name=__codelineno-0-90></a>            <span class=bp>self</span><span class=o>.</span><span class=n>wfile</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>content</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s2>&quot;utf-8&quot;</span><span class=p>))</span>
</span><span id=__span-0-91><a id=__codelineno-0-91 name=__codelineno-0-91></a>
</span><span id=__span-0-92><a id=__codelineno-0-92 name=__codelineno-0-92></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&quot;/auth&quot;</span><span class=p>):</span>
</span><span id=__span-0-93><a id=__codelineno-0-93 name=__codelineno-0-93></a>            <span class=n>parsed_url</span> <span class=o>=</span> <span class=n>urlparse</span><span class=o>.</span><span class=n>urlparse</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>path</span><span class=p>)</span>
</span><span id=__span-0-94><a id=__codelineno-0-94 name=__codelineno-0-94></a>            <span class=n>fragment</span> <span class=o>=</span> <span class=n>parsed_url</span><span class=o>.</span><span class=n>query</span>
</span><span id=__span-0-95><a id=__codelineno-0-95 name=__codelineno-0-95></a>            <span class=n>params</span> <span class=o>=</span> <span class=n>urlparse</span><span class=o>.</span><span class=n>parse_qs</span><span class=p>(</span><span class=n>fragment</span><span class=p>)</span>
</span><span id=__span-0-96><a id=__codelineno-0-96 name=__codelineno-0-96></a>
</span><span id=__span-0-97><a id=__codelineno-0-97 name=__codelineno-0-97></a>            <span class=n>required_params</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;accountId&quot;</span><span class=p>,</span> <span class=s2>&quot;signature&quot;</span><span class=p>,</span> <span class=s2>&quot;publicKey&quot;</span><span class=p>]</span>
</span><span id=__span-0-98><a id=__codelineno-0-98 name=__codelineno-0-98></a>
</span><span id=__span-0-99><a id=__codelineno-0-99 name=__codelineno-0-99></a>            <span class=k>if</span> <span class=nb>all</span><span class=p>(</span><span class=n>param</span> <span class=ow>in</span> <span class=n>params</span> <span class=k>for</span> <span class=n>param</span> <span class=ow>in</span> <span class=n>required_params</span><span class=p>):</span>
</span><span id=__span-0-100><a id=__codelineno-0-100 name=__codelineno-0-100></a>                <span class=n>update_auth_config</span><span class=p>(</span>
</span><span id=__span-0-101><a id=__codelineno-0-101 name=__codelineno-0-101></a>                    <span class=n>params</span><span class=p>[</span><span class=s2>&quot;accountId&quot;</span><span class=p>][</span><span class=mi>0</span><span class=p>],</span>
</span><span id=__span-0-102><a id=__codelineno-0-102 name=__codelineno-0-102></a>                    <span class=n>params</span><span class=p>[</span><span class=s2>&quot;signature&quot;</span><span class=p>][</span><span class=mi>0</span><span class=p>],</span>
</span><span id=__span-0-103><a id=__codelineno-0-103 name=__codelineno-0-103></a>                    <span class=n>params</span><span class=p>[</span><span class=s2>&quot;publicKey&quot;</span><span class=p>][</span><span class=mi>0</span><span class=p>],</span>
</span><span id=__span-0-104><a id=__codelineno-0-104 name=__codelineno-0-104></a>                    <span class=n>callback_url</span><span class=o>=</span><span class=n>generate_callback_url</span><span class=p>(</span><span class=n>PORT</span><span class=p>),</span>
</span><span id=__span-0-105><a id=__codelineno-0-105 name=__codelineno-0-105></a>                    <span class=n>nonce</span><span class=o>=</span><span class=n>NONCE</span><span class=p>,</span>
</span><span id=__span-0-106><a id=__codelineno-0-106 name=__codelineno-0-106></a>                <span class=p>)</span>
</span><span id=__span-0-107><a id=__codelineno-0-107 name=__codelineno-0-107></a>            <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-108><a id=__codelineno-0-108 name=__codelineno-0-108></a>                <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Required parameters not found&quot;</span><span class=p>)</span>
</span><span id=__span-0-109><a id=__codelineno-0-109 name=__codelineno-0-109></a>
</span><span id=__span-0-110><a id=__codelineno-0-110 name=__codelineno-0-110></a>            <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>assets_folder</span><span class=p>,</span> <span class=s2>&quot;auth_complete.html&quot;</span><span class=p>),</span> <span class=s2>&quot;r&quot;</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s2>&quot;utf-8&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>file</span><span class=p>:</span>
</span><span id=__span-0-111><a id=__codelineno-0-111 name=__codelineno-0-111></a>                <span class=n>content</span> <span class=o>=</span> <span class=n>file</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span><span id=__span-0-112><a id=__codelineno-0-112 name=__codelineno-0-112></a>            <span class=bp>self</span><span class=o>.</span><span class=n>send_response</span><span class=p>(</span><span class=mi>200</span><span class=p>)</span>
</span><span id=__span-0-113><a id=__codelineno-0-113 name=__codelineno-0-113></a>            <span class=bp>self</span><span class=o>.</span><span class=n>send_header</span><span class=p>(</span><span class=s2>&quot;Content-type&quot;</span><span class=p>,</span> <span class=s2>&quot;text/html&quot;</span><span class=p>)</span>
</span><span id=__span-0-114><a id=__codelineno-0-114 name=__codelineno-0-114></a>            <span class=bp>self</span><span class=o>.</span><span class=n>end_headers</span><span class=p>()</span>
</span><span id=__span-0-115><a id=__codelineno-0-115 name=__codelineno-0-115></a>            <span class=bp>self</span><span class=o>.</span><span class=n>wfile</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>content</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s2>&quot;utf-8&quot;</span><span class=p>))</span>
</span><span id=__span-0-116><a id=__codelineno-0-116 name=__codelineno-0-116></a>
</span><span id=__span-0-117><a id=__codelineno-0-117 name=__codelineno-0-117></a>            <span class=c1># Give the server some time to read the response before shutting it down</span>
</span><span id=__span-0-118><a id=__codelineno-0-118 name=__codelineno-0-118></a>            <span class=k>def</span><span class=w> </span><span class=nf>shutdown_server</span><span class=p>():</span>
</span><span id=__span-0-119><a id=__codelineno-0-119 name=__codelineno-0-119></a>                <span class=k>global</span> <span class=n>httpd</span>
</span><span id=__span-0-120><a id=__codelineno-0-120 name=__codelineno-0-120></a>                <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>  <span class=c1># Wait 2 seconds before shutting down</span>
</span><span id=__span-0-121><a id=__codelineno-0-121 name=__codelineno-0-121></a>                <span class=k>if</span> <span class=n>httpd</span><span class=p>:</span>
</span><span id=__span-0-122><a id=__codelineno-0-122 name=__codelineno-0-122></a>                    <span class=n>httpd</span><span class=o>.</span><span class=n>shutdown</span><span class=p>()</span>
</span><span id=__span-0-123><a id=__codelineno-0-123 name=__codelineno-0-123></a>
</span><span id=__span-0-124><a id=__codelineno-0-124 name=__codelineno-0-124></a>            <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>shutdown_server</span><span class=p>)</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h5 id=nearai.login.AuthHandler.do_GET class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">do_GET</span> <a href=#nearai.login.AuthHandler.do_GET class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>do_GET</span><span class=p>()</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Webserver GET method.</p> <details class=quote> <summary>Source code in <code>nearai/login.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-77> 77</a></span>
<span class=normal><a href=#__codelineno-0-78> 78</a></span>
<span class=normal><a href=#__codelineno-0-79> 79</a></span>
<span class=normal><a href=#__codelineno-0-80> 80</a></span>
<span class=normal><a href=#__codelineno-0-81> 81</a></span>
<span class=normal><a href=#__codelineno-0-82> 82</a></span>
<span class=normal><a href=#__codelineno-0-83> 83</a></span>
<span class=normal><a href=#__codelineno-0-84> 84</a></span>
<span class=normal><a href=#__codelineno-0-85> 85</a></span>
<span class=normal><a href=#__codelineno-0-86> 86</a></span>
<span class=normal><a href=#__codelineno-0-87> 87</a></span>
<span class=normal><a href=#__codelineno-0-88> 88</a></span>
<span class=normal><a href=#__codelineno-0-89> 89</a></span>
<span class=normal><a href=#__codelineno-0-90> 90</a></span>
<span class=normal><a href=#__codelineno-0-91> 91</a></span>
<span class=normal><a href=#__codelineno-0-92> 92</a></span>
<span class=normal><a href=#__codelineno-0-93> 93</a></span>
<span class=normal><a href=#__codelineno-0-94> 94</a></span>
<span class=normal><a href=#__codelineno-0-95> 95</a></span>
<span class=normal><a href=#__codelineno-0-96> 96</a></span>
<span class=normal><a href=#__codelineno-0-97> 97</a></span>
<span class=normal><a href=#__codelineno-0-98> 98</a></span>
<span class=normal><a href=#__codelineno-0-99> 99</a></span>
<span class=normal><a href=#__codelineno-0-100>100</a></span>
<span class=normal><a href=#__codelineno-0-101>101</a></span>
<span class=normal><a href=#__codelineno-0-102>102</a></span>
<span class=normal><a href=#__codelineno-0-103>103</a></span>
<span class=normal><a href=#__codelineno-0-104>104</a></span>
<span class=normal><a href=#__codelineno-0-105>105</a></span>
<span class=normal><a href=#__codelineno-0-106>106</a></span>
<span class=normal><a href=#__codelineno-0-107>107</a></span>
<span class=normal><a href=#__codelineno-0-108>108</a></span>
<span class=normal><a href=#__codelineno-0-109>109</a></span>
<span class=normal><a href=#__codelineno-0-110>110</a></span>
<span class=normal><a href=#__codelineno-0-111>111</a></span>
<span class=normal><a href=#__codelineno-0-112>112</a></span>
<span class=normal><a href=#__codelineno-0-113>113</a></span>
<span class=normal><a href=#__codelineno-0-114>114</a></span>
<span class=normal><a href=#__codelineno-0-115>115</a></span>
<span class=normal><a href=#__codelineno-0-116>116</a></span>
<span class=normal><a href=#__codelineno-0-117>117</a></span>
<span class=normal><a href=#__codelineno-0-118>118</a></span>
<span class=normal><a href=#__codelineno-0-119>119</a></span>
<span class=normal><a href=#__codelineno-0-120>120</a></span>
<span class=normal><a href=#__codelineno-0-121>121</a></span>
<span class=normal><a href=#__codelineno-0-122>122</a></span>
<span class=normal><a href=#__codelineno-0-123>123</a></span>
<span class=normal><a href=#__codelineno-0-124>124</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-77><a id=__codelineno-0-77 name=__codelineno-0-77></a><span class=k>def</span><span class=w> </span><span class=nf>do_GET</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>  <span class=c1># noqa: N802</span>
</span><span id=__span-0-78><a id=__codelineno-0-78 name=__codelineno-0-78></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Webserver GET method.&quot;&quot;&quot;</span>
</span><span id=__span-0-79><a id=__codelineno-0-79 name=__codelineno-0-79></a>    <span class=k>global</span> <span class=n>NONCE</span><span class=p>,</span> <span class=n>PORT</span>
</span><span id=__span-0-80><a id=__codelineno-0-80 name=__codelineno-0-80></a>
</span><span id=__span-0-81><a id=__codelineno-0-81 name=__codelineno-0-81></a>    <span class=n>script_path</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=vm>__file__</span><span class=p>)</span><span class=o>.</span><span class=n>resolve</span><span class=p>()</span>
</span><span id=__span-0-82><a id=__codelineno-0-82 name=__codelineno-0-82></a>    <span class=n>assets_folder</span> <span class=o>=</span> <span class=n>script_path</span><span class=o>.</span><span class=n>parent</span> <span class=o>/</span> <span class=s2>&quot;assets&quot;</span>
</span><span id=__span-0-83><a id=__codelineno-0-83 name=__codelineno-0-83></a>
</span><span id=__span-0-84><a id=__codelineno-0-84 name=__codelineno-0-84></a>    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&quot;/capture&quot;</span><span class=p>):</span>
</span><span id=__span-0-85><a id=__codelineno-0-85 name=__codelineno-0-85></a>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>assets_folder</span><span class=p>,</span> <span class=s2>&quot;auth_capture.html&quot;</span><span class=p>),</span> <span class=s2>&quot;r&quot;</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s2>&quot;utf-8&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>file</span><span class=p>:</span>
</span><span id=__span-0-86><a id=__codelineno-0-86 name=__codelineno-0-86></a>            <span class=n>content</span> <span class=o>=</span> <span class=n>file</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span><span id=__span-0-87><a id=__codelineno-0-87 name=__codelineno-0-87></a>        <span class=bp>self</span><span class=o>.</span><span class=n>send_response</span><span class=p>(</span><span class=mi>200</span><span class=p>)</span>
</span><span id=__span-0-88><a id=__codelineno-0-88 name=__codelineno-0-88></a>        <span class=bp>self</span><span class=o>.</span><span class=n>send_header</span><span class=p>(</span><span class=s2>&quot;Content-type&quot;</span><span class=p>,</span> <span class=s2>&quot;text/html&quot;</span><span class=p>)</span>
</span><span id=__span-0-89><a id=__codelineno-0-89 name=__codelineno-0-89></a>        <span class=bp>self</span><span class=o>.</span><span class=n>end_headers</span><span class=p>()</span>
</span><span id=__span-0-90><a id=__codelineno-0-90 name=__codelineno-0-90></a>        <span class=bp>self</span><span class=o>.</span><span class=n>wfile</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>content</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s2>&quot;utf-8&quot;</span><span class=p>))</span>
</span><span id=__span-0-91><a id=__codelineno-0-91 name=__codelineno-0-91></a>
</span><span id=__span-0-92><a id=__codelineno-0-92 name=__codelineno-0-92></a>    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&quot;/auth&quot;</span><span class=p>):</span>
</span><span id=__span-0-93><a id=__codelineno-0-93 name=__codelineno-0-93></a>        <span class=n>parsed_url</span> <span class=o>=</span> <span class=n>urlparse</span><span class=o>.</span><span class=n>urlparse</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>path</span><span class=p>)</span>
</span><span id=__span-0-94><a id=__codelineno-0-94 name=__codelineno-0-94></a>        <span class=n>fragment</span> <span class=o>=</span> <span class=n>parsed_url</span><span class=o>.</span><span class=n>query</span>
</span><span id=__span-0-95><a id=__codelineno-0-95 name=__codelineno-0-95></a>        <span class=n>params</span> <span class=o>=</span> <span class=n>urlparse</span><span class=o>.</span><span class=n>parse_qs</span><span class=p>(</span><span class=n>fragment</span><span class=p>)</span>
</span><span id=__span-0-96><a id=__codelineno-0-96 name=__codelineno-0-96></a>
</span><span id=__span-0-97><a id=__codelineno-0-97 name=__codelineno-0-97></a>        <span class=n>required_params</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;accountId&quot;</span><span class=p>,</span> <span class=s2>&quot;signature&quot;</span><span class=p>,</span> <span class=s2>&quot;publicKey&quot;</span><span class=p>]</span>
</span><span id=__span-0-98><a id=__codelineno-0-98 name=__codelineno-0-98></a>
</span><span id=__span-0-99><a id=__codelineno-0-99 name=__codelineno-0-99></a>        <span class=k>if</span> <span class=nb>all</span><span class=p>(</span><span class=n>param</span> <span class=ow>in</span> <span class=n>params</span> <span class=k>for</span> <span class=n>param</span> <span class=ow>in</span> <span class=n>required_params</span><span class=p>):</span>
</span><span id=__span-0-100><a id=__codelineno-0-100 name=__codelineno-0-100></a>            <span class=n>update_auth_config</span><span class=p>(</span>
</span><span id=__span-0-101><a id=__codelineno-0-101 name=__codelineno-0-101></a>                <span class=n>params</span><span class=p>[</span><span class=s2>&quot;accountId&quot;</span><span class=p>][</span><span class=mi>0</span><span class=p>],</span>
</span><span id=__span-0-102><a id=__codelineno-0-102 name=__codelineno-0-102></a>                <span class=n>params</span><span class=p>[</span><span class=s2>&quot;signature&quot;</span><span class=p>][</span><span class=mi>0</span><span class=p>],</span>
</span><span id=__span-0-103><a id=__codelineno-0-103 name=__codelineno-0-103></a>                <span class=n>params</span><span class=p>[</span><span class=s2>&quot;publicKey&quot;</span><span class=p>][</span><span class=mi>0</span><span class=p>],</span>
</span><span id=__span-0-104><a id=__codelineno-0-104 name=__codelineno-0-104></a>                <span class=n>callback_url</span><span class=o>=</span><span class=n>generate_callback_url</span><span class=p>(</span><span class=n>PORT</span><span class=p>),</span>
</span><span id=__span-0-105><a id=__codelineno-0-105 name=__codelineno-0-105></a>                <span class=n>nonce</span><span class=o>=</span><span class=n>NONCE</span><span class=p>,</span>
</span><span id=__span-0-106><a id=__codelineno-0-106 name=__codelineno-0-106></a>            <span class=p>)</span>
</span><span id=__span-0-107><a id=__codelineno-0-107 name=__codelineno-0-107></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-108><a id=__codelineno-0-108 name=__codelineno-0-108></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Required parameters not found&quot;</span><span class=p>)</span>
</span><span id=__span-0-109><a id=__codelineno-0-109 name=__codelineno-0-109></a>
</span><span id=__span-0-110><a id=__codelineno-0-110 name=__codelineno-0-110></a>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>assets_folder</span><span class=p>,</span> <span class=s2>&quot;auth_complete.html&quot;</span><span class=p>),</span> <span class=s2>&quot;r&quot;</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s2>&quot;utf-8&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>file</span><span class=p>:</span>
</span><span id=__span-0-111><a id=__codelineno-0-111 name=__codelineno-0-111></a>            <span class=n>content</span> <span class=o>=</span> <span class=n>file</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span><span id=__span-0-112><a id=__codelineno-0-112 name=__codelineno-0-112></a>        <span class=bp>self</span><span class=o>.</span><span class=n>send_response</span><span class=p>(</span><span class=mi>200</span><span class=p>)</span>
</span><span id=__span-0-113><a id=__codelineno-0-113 name=__codelineno-0-113></a>        <span class=bp>self</span><span class=o>.</span><span class=n>send_header</span><span class=p>(</span><span class=s2>&quot;Content-type&quot;</span><span class=p>,</span> <span class=s2>&quot;text/html&quot;</span><span class=p>)</span>
</span><span id=__span-0-114><a id=__codelineno-0-114 name=__codelineno-0-114></a>        <span class=bp>self</span><span class=o>.</span><span class=n>end_headers</span><span class=p>()</span>
</span><span id=__span-0-115><a id=__codelineno-0-115 name=__codelineno-0-115></a>        <span class=bp>self</span><span class=o>.</span><span class=n>wfile</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>content</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s2>&quot;utf-8&quot;</span><span class=p>))</span>
</span><span id=__span-0-116><a id=__codelineno-0-116 name=__codelineno-0-116></a>
</span><span id=__span-0-117><a id=__codelineno-0-117 name=__codelineno-0-117></a>        <span class=c1># Give the server some time to read the response before shutting it down</span>
</span><span id=__span-0-118><a id=__codelineno-0-118 name=__codelineno-0-118></a>        <span class=k>def</span><span class=w> </span><span class=nf>shutdown_server</span><span class=p>():</span>
</span><span id=__span-0-119><a id=__codelineno-0-119 name=__codelineno-0-119></a>            <span class=k>global</span> <span class=n>httpd</span>
</span><span id=__span-0-120><a id=__codelineno-0-120 name=__codelineno-0-120></a>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>  <span class=c1># Wait 2 seconds before shutting down</span>
</span><span id=__span-0-121><a id=__codelineno-0-121 name=__codelineno-0-121></a>            <span class=k>if</span> <span class=n>httpd</span><span class=p>:</span>
</span><span id=__span-0-122><a id=__codelineno-0-122 name=__codelineno-0-122></a>                <span class=n>httpd</span><span class=o>.</span><span class=n>shutdown</span><span class=p>()</span>
</span><span id=__span-0-123><a id=__codelineno-0-123 name=__codelineno-0-123></a>
</span><span id=__span-0-124><a id=__codelineno-0-124 name=__codelineno-0-124></a>        <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>shutdown_server</span><span class=p>)</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.login.AuthHandler.log_message class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">log_message</span> <a href=#nearai.login.AuthHandler.log_message class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>log_message</span><span class=p>(</span><span class=nb>format</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Webserver logging method.</p> <details class=quote> <summary>Source code in <code>nearai/login.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-73>73</a></span>
<span class=normal><a href=#__codelineno-0-74>74</a></span>
<span class=normal><a href=#__codelineno-0-75>75</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-73><a id=__codelineno-0-73 name=__codelineno-0-73></a><span class=k>def</span><span class=w> </span><span class=nf>log_message</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=nb>format</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>):</span>
</span><span id=__span-0-74><a id=__codelineno-0-74 name=__codelineno-0-74></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Webserver logging method.&quot;&quot;&quot;</span>
</span><span id=__span-0-75><a id=__codelineno-0-75 name=__codelineno-0-75></a>    <span class=k>pass</span>  <span class=c1># Override to suppress logging</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-function"> <h4 id=nearai.login.find_open_port class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">find_open_port</span> <a href=#nearai.login.find_open_port class=headerlink title="Permanent link">&para;</a></h4> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>find_open_port</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n>int</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Finds and returns an open port number by binding to a free port on the local machine.</p> <details class=quote> <summary>Source code in <code>nearai/login.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-127>127</a></span>
<span class=normal><a href=#__codelineno-0-128>128</a></span>
<span class=normal><a href=#__codelineno-0-129>129</a></span>
<span class=normal><a href=#__codelineno-0-130>130</a></span>
<span class=normal><a href=#__codelineno-0-131>131</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-127><a id=__codelineno-0-127 name=__codelineno-0-127></a><span class=k>def</span><span class=w> </span><span class=nf>find_open_port</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span>
</span><span id=__span-0-128><a id=__codelineno-0-128 name=__codelineno-0-128></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Finds and returns an open port number by binding to a free port on the local machine.&quot;&quot;&quot;</span>
</span><span id=__span-0-129><a id=__codelineno-0-129 name=__codelineno-0-129></a>    <span class=k>with</span> <span class=n>socket</span><span class=o>.</span><span class=n>socket</span><span class=p>(</span><span class=n>socket</span><span class=o>.</span><span class=n>AF_INET</span><span class=p>,</span> <span class=n>socket</span><span class=o>.</span><span class=n>SOCK_STREAM</span><span class=p>)</span> <span class=k>as</span> <span class=n>s</span><span class=p>:</span>
</span><span id=__span-0-130><a id=__codelineno-0-130 name=__codelineno-0-130></a>        <span class=n>s</span><span class=o>.</span><span class=n>bind</span><span class=p>((</span><span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=mi>0</span><span class=p>))</span>
</span><span id=__span-0-131><a id=__codelineno-0-131 name=__codelineno-0-131></a>        <span class=k>return</span> <span class=n>s</span><span class=o>.</span><span class=n>getsockname</span><span class=p>()[</span><span class=mi>1</span><span class=p>]</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=nearai.login.generate_and_save_signature class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">generate_and_save_signature</span> <a href=#nearai.login.generate_and_save_signature class=headerlink title="Permanent link">&para;</a></h4> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>generate_and_save_signature</span><span class=p>(</span><span class=n>account_id</span><span class=p>,</span> <span class=n>private_key</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Generates a signature for the given account ID and private key, then updates the auth configuration.</p> <details class=quote> <summary>Source code in <code>nearai/login.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-149>149</a></span>
<span class=normal><a href=#__codelineno-0-150>150</a></span>
<span class=normal><a href=#__codelineno-0-151>151</a></span>
<span class=normal><a href=#__codelineno-0-152>152</a></span>
<span class=normal><a href=#__codelineno-0-153>153</a></span>
<span class=normal><a href=#__codelineno-0-154>154</a></span>
<span class=normal><a href=#__codelineno-0-155>155</a></span>
<span class=normal><a href=#__codelineno-0-156>156</a></span>
<span class=normal><a href=#__codelineno-0-157>157</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-149><a id=__codelineno-0-149 name=__codelineno-0-149></a><span class=k>def</span><span class=w> </span><span class=nf>generate_and_save_signature</span><span class=p>(</span><span class=n>account_id</span><span class=p>,</span> <span class=n>private_key</span><span class=p>):</span>
</span><span id=__span-0-150><a id=__codelineno-0-150 name=__codelineno-0-150></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Generates a signature for the given account ID and private key, then updates the auth configuration.&quot;&quot;&quot;</span>
</span><span id=__span-0-151><a id=__codelineno-0-151 name=__codelineno-0-151></a>    <span class=n>nonce</span> <span class=o>=</span> <span class=n>generate_nonce</span><span class=p>()</span>
</span><span id=__span-0-152><a id=__codelineno-0-152 name=__codelineno-0-152></a>    <span class=n>payload</span> <span class=o>=</span> <span class=n>near</span><span class=o>.</span><span class=n>Payload</span><span class=p>(</span><span class=n>MESSAGE</span><span class=p>,</span> <span class=n>nonce</span><span class=p>,</span> <span class=n>RECIPIENT</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span>
</span><span id=__span-0-153><a id=__codelineno-0-153 name=__codelineno-0-153></a>
</span><span id=__span-0-154><a id=__codelineno-0-154 name=__codelineno-0-154></a>    <span class=n>signature</span><span class=p>,</span> <span class=n>public_key</span> <span class=o>=</span> <span class=n>near</span><span class=o>.</span><span class=n>create_signature</span><span class=p>(</span><span class=n>private_key</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span><span id=__span-0-155><a id=__codelineno-0-155 name=__codelineno-0-155></a>
</span><span id=__span-0-156><a id=__codelineno-0-156 name=__codelineno-0-156></a>    <span class=k>if</span> <span class=n>update_auth_config</span><span class=p>(</span><span class=n>account_id</span><span class=p>,</span> <span class=n>signature</span><span class=p>,</span> <span class=n>public_key</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>nonce</span><span class=p>):</span>
</span><span id=__span-0-157><a id=__codelineno-0-157 name=__codelineno-0-157></a>        <span class=n>print_login_status</span><span class=p>()</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=nearai.login.generate_callback_url class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">generate_callback_url</span> <a href=#nearai.login.generate_callback_url class=headerlink title="Permanent link">&para;</a></h4> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>generate_callback_url</span><span class=p>(</span><span class=n>port</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Generates a callback URL using the specified port number.</p> <details class=quote> <summary>Source code in <code>nearai/login.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-134>134</a></span>
<span class=normal><a href=#__codelineno-0-135>135</a></span>
<span class=normal><a href=#__codelineno-0-136>136</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-134><a id=__codelineno-0-134 name=__codelineno-0-134></a><span class=k>def</span><span class=w> </span><span class=nf>generate_callback_url</span><span class=p>(</span><span class=n>port</span><span class=p>):</span>
</span><span id=__span-0-135><a id=__codelineno-0-135 name=__codelineno-0-135></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Generates a callback URL using the specified port number.&quot;&quot;&quot;</span>
</span><span id=__span-0-136><a id=__codelineno-0-136 name=__codelineno-0-136></a>    <span class=k>return</span> <span class=sa>f</span><span class=s2>&quot;http://localhost:</span><span class=si>{</span><span class=n>port</span><span class=si>}</span><span class=s2>/capture&quot;</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=nearai.login.generate_nonce class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">generate_nonce</span> <a href=#nearai.login.generate_nonce class=headerlink title="Permanent link">&para;</a></h4> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>generate_nonce</span><span class=p>()</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Generates a nonce based on the current time in milliseconds.</p> <details class=quote> <summary>Source code in <code>nearai/login.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-144>144</a></span>
<span class=normal><a href=#__codelineno-0-145>145</a></span>
<span class=normal><a href=#__codelineno-0-146>146</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-144><a id=__codelineno-0-144 name=__codelineno-0-144></a><span class=k>def</span><span class=w> </span><span class=nf>generate_nonce</span><span class=p>():</span>
</span><span id=__span-0-145><a id=__codelineno-0-145 name=__codelineno-0-145></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Generates a nonce based on the current time in milliseconds.&quot;&quot;&quot;</span>
</span><span id=__span-0-146><a id=__codelineno-0-146 name=__codelineno-0-146></a>    <span class=k>return</span> <span class=nb>str</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>))</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=nearai.login.login_with_file_credentials class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">login_with_file_credentials</span> <a href=#nearai.login.login_with_file_credentials class=headerlink title="Permanent link">&para;</a></h4> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>login_with_file_credentials</span><span class=p>(</span><span class=n>account_id</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Logs in using credentials from a file for the specified account ID, generating and saving a signature.</p> <details class=quote> <summary>Source code in <code>nearai/login.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-160>160</a></span>
<span class=normal><a href=#__codelineno-0-161>161</a></span>
<span class=normal><a href=#__codelineno-0-162>162</a></span>
<span class=normal><a href=#__codelineno-0-163>163</a></span>
<span class=normal><a href=#__codelineno-0-164>164</a></span>
<span class=normal><a href=#__codelineno-0-165>165</a></span>
<span class=normal><a href=#__codelineno-0-166>166</a></span>
<span class=normal><a href=#__codelineno-0-167>167</a></span>
<span class=normal><a href=#__codelineno-0-168>168</a></span>
<span class=normal><a href=#__codelineno-0-169>169</a></span>
<span class=normal><a href=#__codelineno-0-170>170</a></span>
<span class=normal><a href=#__codelineno-0-171>171</a></span>
<span class=normal><a href=#__codelineno-0-172>172</a></span>
<span class=normal><a href=#__codelineno-0-173>173</a></span>
<span class=normal><a href=#__codelineno-0-174>174</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-160><a id=__codelineno-0-160 name=__codelineno-0-160></a><span class=k>def</span><span class=w> </span><span class=nf>login_with_file_credentials</span><span class=p>(</span><span class=n>account_id</span><span class=p>):</span>
</span><span id=__span-0-161><a id=__codelineno-0-161 name=__codelineno-0-161></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Logs in using credentials from a file for the specified account ID, generating and saving a signature.&quot;&quot;&quot;</span>
</span><span id=__span-0-162><a id=__codelineno-0-162 name=__codelineno-0-162></a>    <span class=n>file_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>expanduser</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=s2>&quot;~/.near-credentials/&quot;</span><span class=p>,</span> <span class=s2>&quot;mainnet&quot;</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>account_id</span><span class=si>}</span><span class=s2>.json&quot;</span><span class=p>))</span>
</span><span id=__span-0-163><a id=__codelineno-0-163 name=__codelineno-0-163></a>
</span><span id=__span-0-164><a id=__codelineno-0-164 name=__codelineno-0-164></a>    <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>file_path</span><span class=p>):</span>
</span><span id=__span-0-165><a id=__codelineno-0-165 name=__codelineno-0-165></a>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=s2>&quot;r&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>file</span><span class=p>:</span>
</span><span id=__span-0-166><a id=__codelineno-0-166 name=__codelineno-0-166></a>            <span class=n>content</span> <span class=o>=</span> <span class=n>file</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span><span id=__span-0-167><a id=__codelineno-0-167 name=__codelineno-0-167></a>            <span class=n>account_data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>
</span><span id=__span-0-168><a id=__codelineno-0-168 name=__codelineno-0-168></a>            <span class=n>private_key</span> <span class=o>=</span> <span class=n>account_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;private_key&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
</span><span id=__span-0-169><a id=__codelineno-0-169 name=__codelineno-0-169></a>            <span class=k>if</span> <span class=ow>not</span> <span class=n>private_key</span><span class=p>:</span>
</span><span id=__span-0-170><a id=__codelineno-0-170 name=__codelineno-0-170></a>                <span class=k>return</span> <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Private key is missing for </span><span class=si>{</span><span class=n>account_id</span><span class=si>}</span><span class=s2> on mainnet&quot;</span><span class=p>)</span>
</span><span id=__span-0-171><a id=__codelineno-0-171 name=__codelineno-0-171></a>            <span class=n>generate_and_save_signature</span><span class=p>(</span><span class=n>account_id</span><span class=p>,</span> <span class=n>account_data</span><span class=p>[</span><span class=s2>&quot;private_key&quot;</span><span class=p>])</span>
</span><span id=__span-0-172><a id=__codelineno-0-172 name=__codelineno-0-172></a>
</span><span id=__span-0-173><a id=__codelineno-0-173 name=__codelineno-0-173></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-174><a id=__codelineno-0-174 name=__codelineno-0-174></a>        <span class=k>return</span> <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Account data is missing for </span><span class=si>{</span><span class=n>account_id</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=nearai.login.login_with_near_auth class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">login_with_near_auth</span> <a href=#nearai.login.login_with_near_auth class=headerlink title="Permanent link">&para;</a></h4> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>login_with_near_auth</span><span class=p>(</span><span class=n>remote</span><span class=p>,</span> <span class=n>auth_url</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Initiates the login process using NEAR authentication, either starting a local server to handle the callback or providing a URL for remote authentication.</p> <details class=quote> <summary>Source code in <code>nearai/login.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-177>177</a></span>
<span class=normal><a href=#__codelineno-0-178>178</a></span>
<span class=normal><a href=#__codelineno-0-179>179</a></span>
<span class=normal><a href=#__codelineno-0-180>180</a></span>
<span class=normal><a href=#__codelineno-0-181>181</a></span>
<span class=normal><a href=#__codelineno-0-182>182</a></span>
<span class=normal><a href=#__codelineno-0-183>183</a></span>
<span class=normal><a href=#__codelineno-0-184>184</a></span>
<span class=normal><a href=#__codelineno-0-185>185</a></span>
<span class=normal><a href=#__codelineno-0-186>186</a></span>
<span class=normal><a href=#__codelineno-0-187>187</a></span>
<span class=normal><a href=#__codelineno-0-188>188</a></span>
<span class=normal><a href=#__codelineno-0-189>189</a></span>
<span class=normal><a href=#__codelineno-0-190>190</a></span>
<span class=normal><a href=#__codelineno-0-191>191</a></span>
<span class=normal><a href=#__codelineno-0-192>192</a></span>
<span class=normal><a href=#__codelineno-0-193>193</a></span>
<span class=normal><a href=#__codelineno-0-194>194</a></span>
<span class=normal><a href=#__codelineno-0-195>195</a></span>
<span class=normal><a href=#__codelineno-0-196>196</a></span>
<span class=normal><a href=#__codelineno-0-197>197</a></span>
<span class=normal><a href=#__codelineno-0-198>198</a></span>
<span class=normal><a href=#__codelineno-0-199>199</a></span>
<span class=normal><a href=#__codelineno-0-200>200</a></span>
<span class=normal><a href=#__codelineno-0-201>201</a></span>
<span class=normal><a href=#__codelineno-0-202>202</a></span>
<span class=normal><a href=#__codelineno-0-203>203</a></span>
<span class=normal><a href=#__codelineno-0-204>204</a></span>
<span class=normal><a href=#__codelineno-0-205>205</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-177><a id=__codelineno-0-177 name=__codelineno-0-177></a><span class=k>def</span><span class=w> </span><span class=nf>login_with_near_auth</span><span class=p>(</span><span class=n>remote</span><span class=p>,</span> <span class=n>auth_url</span><span class=p>):</span>
</span><span id=__span-0-178><a id=__codelineno-0-178 name=__codelineno-0-178></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Initiates the login process using NEAR authentication, either starting a local server to handle the callback or providing a URL for remote authentication.&quot;&quot;&quot;</span>  <span class=c1># noqa: E501</span>
</span><span id=__span-0-179><a id=__codelineno-0-179 name=__codelineno-0-179></a>    <span class=k>global</span> <span class=n>NONCE</span><span class=p>,</span> <span class=n>PORT</span>
</span><span id=__span-0-180><a id=__codelineno-0-180 name=__codelineno-0-180></a>    <span class=n>NONCE</span> <span class=o>=</span> <span class=n>generate_nonce</span><span class=p>()</span>
</span><span id=__span-0-181><a id=__codelineno-0-181 name=__codelineno-0-181></a>
</span><span id=__span-0-182><a id=__codelineno-0-182 name=__codelineno-0-182></a>    <span class=n>params</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-183><a id=__codelineno-0-183 name=__codelineno-0-183></a>        <span class=s2>&quot;message&quot;</span><span class=p>:</span> <span class=n>MESSAGE</span><span class=p>,</span>
</span><span id=__span-0-184><a id=__codelineno-0-184 name=__codelineno-0-184></a>        <span class=s2>&quot;nonce&quot;</span><span class=p>:</span> <span class=n>NONCE</span><span class=p>,</span>
</span><span id=__span-0-185><a id=__codelineno-0-185 name=__codelineno-0-185></a>        <span class=s2>&quot;recipient&quot;</span><span class=p>:</span> <span class=n>RECIPIENT</span><span class=p>,</span>
</span><span id=__span-0-186><a id=__codelineno-0-186 name=__codelineno-0-186></a>    <span class=p>}</span>
</span><span id=__span-0-187><a id=__codelineno-0-187 name=__codelineno-0-187></a>
</span><span id=__span-0-188><a id=__codelineno-0-188 name=__codelineno-0-188></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>remote</span><span class=p>:</span>
</span><span id=__span-0-189><a id=__codelineno-0-189 name=__codelineno-0-189></a>        <span class=n>PORT</span> <span class=o>=</span> <span class=n>find_open_port</span><span class=p>()</span>
</span><span id=__span-0-190><a id=__codelineno-0-190 name=__codelineno-0-190></a>
</span><span id=__span-0-191><a id=__codelineno-0-191 name=__codelineno-0-191></a>        <span class=k>global</span> <span class=n>httpd</span>
</span><span id=__span-0-192><a id=__codelineno-0-192 name=__codelineno-0-192></a>        <span class=k>with</span> <span class=n>socketserver</span><span class=o>.</span><span class=n>TCPServer</span><span class=p>((</span><span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>PORT</span><span class=p>),</span> <span class=n>AuthHandler</span><span class=p>)</span> <span class=k>as</span> <span class=n>httpd</span><span class=p>:</span>
</span><span id=__span-0-193><a id=__codelineno-0-193 name=__codelineno-0-193></a>            <span class=n>params</span><span class=p>[</span><span class=s2>&quot;callbackUrl&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;http://localhost:</span><span class=si>{</span><span class=n>PORT</span><span class=si>}</span><span class=s2>/capture&quot;</span>
</span><span id=__span-0-194><a id=__codelineno-0-194 name=__codelineno-0-194></a>
</span><span id=__span-0-195><a id=__codelineno-0-195 name=__codelineno-0-195></a>            <span class=n>encoded_params</span> <span class=o>=</span> <span class=n>urlparse</span><span class=o>.</span><span class=n>urlencode</span><span class=p>(</span><span class=n>params</span><span class=p>)</span>
</span><span id=__span-0-196><a id=__codelineno-0-196 name=__codelineno-0-196></a>
</span><span id=__span-0-197><a id=__codelineno-0-197 name=__codelineno-0-197></a>            <span class=n>print_url_message</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>auth_url</span><span class=si>}</span><span class=s2>?</span><span class=si>{</span><span class=n>encoded_params</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-198><a id=__codelineno-0-198 name=__codelineno-0-198></a>
</span><span id=__span-0-199><a id=__codelineno-0-199 name=__codelineno-0-199></a>            <span class=n>httpd</span><span class=o>.</span><span class=n>serve_forever</span><span class=p>()</span>
</span><span id=__span-0-200><a id=__codelineno-0-200 name=__codelineno-0-200></a>
</span><span id=__span-0-201><a id=__codelineno-0-201 name=__codelineno-0-201></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-202><a id=__codelineno-0-202 name=__codelineno-0-202></a>        <span class=n>encoded_params</span> <span class=o>=</span> <span class=n>urlparse</span><span class=o>.</span><span class=n>urlencode</span><span class=p>(</span><span class=n>params</span><span class=p>)</span>
</span><span id=__span-0-203><a id=__codelineno-0-203 name=__codelineno-0-203></a>
</span><span id=__span-0-204><a id=__codelineno-0-204 name=__codelineno-0-204></a>        <span class=n>print_url_message</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>auth_url</span><span class=si>}</span><span class=s2>?</span><span class=si>{</span><span class=n>encoded_params</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-205><a id=__codelineno-0-205 name=__codelineno-0-205></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;After visiting the URL, follow the instructions to save your auth signature&quot;</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=nearai.login.print_login_status class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">print_login_status</span> <a href=#nearai.login.print_login_status class=headerlink title="Permanent link">&para;</a></h4> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>print_login_status</span><span class=p>()</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Prints the current authentication status if available in the config file.</p> <details class=quote> <summary>Source code in <code>nearai/login.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-58>58</a></span>
<span class=normal><a href=#__codelineno-0-59>59</a></span>
<span class=normal><a href=#__codelineno-0-60>60</a></span>
<span class=normal><a href=#__codelineno-0-61>61</a></span>
<span class=normal><a href=#__codelineno-0-62>62</a></span>
<span class=normal><a href=#__codelineno-0-63>63</a></span>
<span class=normal><a href=#__codelineno-0-64>64</a></span>
<span class=normal><a href=#__codelineno-0-65>65</a></span>
<span class=normal><a href=#__codelineno-0-66>66</a></span>
<span class=normal><a href=#__codelineno-0-67>67</a></span>
<span class=normal><a href=#__codelineno-0-68>68</a></span>
<span class=normal><a href=#__codelineno-0-69>69</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-58><a id=__codelineno-0-58 name=__codelineno-0-58></a><span class=k>def</span><span class=w> </span><span class=nf>print_login_status</span><span class=p>():</span>
</span><span id=__span-0-59><a id=__codelineno-0-59 name=__codelineno-0-59></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Prints the current authentication status if available in the config file.&quot;&quot;&quot;</span>
</span><span id=__span-0-60><a id=__codelineno-0-60 name=__codelineno-0-60></a>    <span class=n>config</span> <span class=o>=</span> <span class=n>load_config_file</span><span class=p>()</span>
</span><span id=__span-0-61><a id=__codelineno-0-61 name=__codelineno-0-61></a>    <span class=k>if</span> <span class=n>config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;auth&quot;</span><span class=p>)</span> <span class=ow>and</span> <span class=n>config</span><span class=p>[</span><span class=s2>&quot;auth&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;account_id&quot;</span><span class=p>):</span>
</span><span id=__span-0-62><a id=__codelineno-0-62 name=__codelineno-0-62></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;Auth data for: </span><span class=si>{</span><span class=n>config</span><span class=p>[</span><span class=s2>&quot;auth&quot;</span><span class=p>][</span><span class=s2>&quot;account_id&quot;</span><span class=p>]</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span><span id=__span-0-63><a id=__codelineno-0-63 name=__codelineno-0-63></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;signature: </span><span class=si>{</span><span class=n>config</span><span class=p>[</span><span class=s2>&quot;auth&quot;</span><span class=p>][</span><span class=s2>&quot;signature&quot;</span><span class=p>]</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span><span id=__span-0-64><a id=__codelineno-0-64 name=__codelineno-0-64></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;public_key: </span><span class=si>{</span><span class=n>config</span><span class=p>[</span><span class=s2>&quot;auth&quot;</span><span class=p>][</span><span class=s2>&quot;public_key&quot;</span><span class=p>]</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span><span id=__span-0-65><a id=__codelineno-0-65 name=__codelineno-0-65></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;nonce: </span><span class=si>{</span><span class=n>config</span><span class=p>[</span><span class=s2>&quot;auth&quot;</span><span class=p>][</span><span class=s2>&quot;nonce&quot;</span><span class=p>]</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span><span id=__span-0-66><a id=__codelineno-0-66 name=__codelineno-0-66></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;message: </span><span class=si>{</span><span class=n>config</span><span class=p>[</span><span class=s2>&quot;auth&quot;</span><span class=p>][</span><span class=s2>&quot;message&quot;</span><span class=p>]</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span><span id=__span-0-67><a id=__codelineno-0-67 name=__codelineno-0-67></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;recipient: </span><span class=si>{</span><span class=n>config</span><span class=p>[</span><span class=s2>&quot;auth&quot;</span><span class=p>][</span><span class=s2>&quot;recipient&quot;</span><span class=p>]</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span><span id=__span-0-68><a id=__codelineno-0-68 name=__codelineno-0-68></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-69><a id=__codelineno-0-69 name=__codelineno-0-69></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Near auth details not found&quot;</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=nearai.login.print_url_message class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">print_url_message</span> <a href=#nearai.login.print_url_message class=headerlink title="Permanent link">&para;</a></h4> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>print_url_message</span><span class=p>(</span><span class=n>url</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Prints a message instructing the user to visit the given URL to complete the login process.</p> <details class=quote> <summary>Source code in <code>nearai/login.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-139>139</a></span>
<span class=normal><a href=#__codelineno-0-140>140</a></span>
<span class=normal><a href=#__codelineno-0-141>141</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-139><a id=__codelineno-0-139 name=__codelineno-0-139></a><span class=k>def</span><span class=w> </span><span class=nf>print_url_message</span><span class=p>(</span><span class=n>url</span><span class=p>):</span>
</span><span id=__span-0-140><a id=__codelineno-0-140 name=__codelineno-0-140></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Prints a message instructing the user to visit the given URL to complete the login process.&quot;&quot;&quot;</span>
</span><span id=__span-0-141><a id=__codelineno-0-141 name=__codelineno-0-141></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Please visit the following URL to complete the login process: </span><span class=si>{</span><span class=n>url</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=nearai.login.update_auth_config class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">update_auth_config</span> <a href=#nearai.login.update_auth_config class=headerlink title="Permanent link">&para;</a></h4> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>update_auth_config</span><span class=p>(</span><span class=n>account_id</span><span class=p>,</span> <span class=n>signature</span><span class=p>,</span> <span class=n>public_key</span><span class=p>,</span> <span class=n>callback_url</span><span class=p>,</span> <span class=n>nonce</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Update authentication configuration if the provided signature is valid.</p> <details class=quote> <summary>Source code in <code>nearai/login.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-23>23</a></span>
<span class=normal><a href=#__codelineno-0-24>24</a></span>
<span class=normal><a href=#__codelineno-0-25>25</a></span>
<span class=normal><a href=#__codelineno-0-26>26</a></span>
<span class=normal><a href=#__codelineno-0-27>27</a></span>
<span class=normal><a href=#__codelineno-0-28>28</a></span>
<span class=normal><a href=#__codelineno-0-29>29</a></span>
<span class=normal><a href=#__codelineno-0-30>30</a></span>
<span class=normal><a href=#__codelineno-0-31>31</a></span>
<span class=normal><a href=#__codelineno-0-32>32</a></span>
<span class=normal><a href=#__codelineno-0-33>33</a></span>
<span class=normal><a href=#__codelineno-0-34>34</a></span>
<span class=normal><a href=#__codelineno-0-35>35</a></span>
<span class=normal><a href=#__codelineno-0-36>36</a></span>
<span class=normal><a href=#__codelineno-0-37>37</a></span>
<span class=normal><a href=#__codelineno-0-38>38</a></span>
<span class=normal><a href=#__codelineno-0-39>39</a></span>
<span class=normal><a href=#__codelineno-0-40>40</a></span>
<span class=normal><a href=#__codelineno-0-41>41</a></span>
<span class=normal><a href=#__codelineno-0-42>42</a></span>
<span class=normal><a href=#__codelineno-0-43>43</a></span>
<span class=normal><a href=#__codelineno-0-44>44</a></span>
<span class=normal><a href=#__codelineno-0-45>45</a></span>
<span class=normal><a href=#__codelineno-0-46>46</a></span>
<span class=normal><a href=#__codelineno-0-47>47</a></span>
<span class=normal><a href=#__codelineno-0-48>48</a></span>
<span class=normal><a href=#__codelineno-0-49>49</a></span>
<span class=normal><a href=#__codelineno-0-50>50</a></span>
<span class=normal><a href=#__codelineno-0-51>51</a></span>
<span class=normal><a href=#__codelineno-0-52>52</a></span>
<span class=normal><a href=#__codelineno-0-53>53</a></span>
<span class=normal><a href=#__codelineno-0-54>54</a></span>
<span class=normal><a href=#__codelineno-0-55>55</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-23><a id=__codelineno-0-23 name=__codelineno-0-23></a><span class=k>def</span><span class=w> </span><span class=nf>update_auth_config</span><span class=p>(</span><span class=n>account_id</span><span class=p>,</span> <span class=n>signature</span><span class=p>,</span> <span class=n>public_key</span><span class=p>,</span> <span class=n>callback_url</span><span class=p>,</span> <span class=n>nonce</span><span class=p>):</span>
</span><span id=__span-0-24><a id=__codelineno-0-24 name=__codelineno-0-24></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Update authentication configuration if the provided signature is valid.&quot;&quot;&quot;</span>
</span><span id=__span-0-25><a id=__codelineno-0-25 name=__codelineno-0-25></a>    <span class=k>if</span> <span class=n>near</span><span class=o>.</span><span class=n>verify_signed_message</span><span class=p>(</span>
</span><span id=__span-0-26><a id=__codelineno-0-26 name=__codelineno-0-26></a>        <span class=n>account_id</span><span class=p>,</span>
</span><span id=__span-0-27><a id=__codelineno-0-27 name=__codelineno-0-27></a>        <span class=n>public_key</span><span class=p>,</span>
</span><span id=__span-0-28><a id=__codelineno-0-28 name=__codelineno-0-28></a>        <span class=n>signature</span><span class=p>,</span>
</span><span id=__span-0-29><a id=__codelineno-0-29 name=__codelineno-0-29></a>        <span class=n>MESSAGE</span><span class=p>,</span>
</span><span id=__span-0-30><a id=__codelineno-0-30 name=__codelineno-0-30></a>        <span class=n>nonce</span><span class=p>,</span>
</span><span id=__span-0-31><a id=__codelineno-0-31 name=__codelineno-0-31></a>        <span class=n>RECIPIENT</span><span class=p>,</span>
</span><span id=__span-0-32><a id=__codelineno-0-32 name=__codelineno-0-32></a>        <span class=n>callback_url</span><span class=p>,</span>
</span><span id=__span-0-33><a id=__codelineno-0-33 name=__codelineno-0-33></a>    <span class=p>):</span>
</span><span id=__span-0-34><a id=__codelineno-0-34 name=__codelineno-0-34></a>        <span class=n>config</span> <span class=o>=</span> <span class=n>load_config_file</span><span class=p>()</span>
</span><span id=__span-0-35><a id=__codelineno-0-35 name=__codelineno-0-35></a>
</span><span id=__span-0-36><a id=__codelineno-0-36 name=__codelineno-0-36></a>        <span class=n>auth</span> <span class=o>=</span> <span class=n>AuthData</span><span class=o>.</span><span class=n>model_validate</span><span class=p>(</span>
</span><span id=__span-0-37><a id=__codelineno-0-37 name=__codelineno-0-37></a>            <span class=p>{</span>
</span><span id=__span-0-38><a id=__codelineno-0-38 name=__codelineno-0-38></a>                <span class=s2>&quot;account_id&quot;</span><span class=p>:</span> <span class=n>account_id</span><span class=p>,</span>
</span><span id=__span-0-39><a id=__codelineno-0-39 name=__codelineno-0-39></a>                <span class=s2>&quot;signature&quot;</span><span class=p>:</span> <span class=n>signature</span><span class=p>,</span>
</span><span id=__span-0-40><a id=__codelineno-0-40 name=__codelineno-0-40></a>                <span class=s2>&quot;public_key&quot;</span><span class=p>:</span> <span class=n>public_key</span><span class=p>,</span>
</span><span id=__span-0-41><a id=__codelineno-0-41 name=__codelineno-0-41></a>                <span class=s2>&quot;callback_url&quot;</span><span class=p>:</span> <span class=n>callback_url</span><span class=p>,</span>
</span><span id=__span-0-42><a id=__codelineno-0-42 name=__codelineno-0-42></a>                <span class=s2>&quot;nonce&quot;</span><span class=p>:</span> <span class=n>nonce</span><span class=p>,</span>
</span><span id=__span-0-43><a id=__codelineno-0-43 name=__codelineno-0-43></a>                <span class=s2>&quot;recipient&quot;</span><span class=p>:</span> <span class=n>RECIPIENT</span><span class=p>,</span>
</span><span id=__span-0-44><a id=__codelineno-0-44 name=__codelineno-0-44></a>                <span class=s2>&quot;message&quot;</span><span class=p>:</span> <span class=n>MESSAGE</span><span class=p>,</span>
</span><span id=__span-0-45><a id=__codelineno-0-45 name=__codelineno-0-45></a>            <span class=p>}</span>
</span><span id=__span-0-46><a id=__codelineno-0-46 name=__codelineno-0-46></a>        <span class=p>)</span>
</span><span id=__span-0-47><a id=__codelineno-0-47 name=__codelineno-0-47></a>
</span><span id=__span-0-48><a id=__codelineno-0-48 name=__codelineno-0-48></a>        <span class=n>config</span><span class=p>[</span><span class=s2>&quot;auth&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>auth</span><span class=o>.</span><span class=n>model_dump</span><span class=p>()</span>
</span><span id=__span-0-49><a id=__codelineno-0-49 name=__codelineno-0-49></a>        <span class=n>save_config_file</span><span class=p>(</span><span class=n>config</span><span class=p>)</span>
</span><span id=__span-0-50><a id=__codelineno-0-50 name=__codelineno-0-50></a>
</span><span id=__span-0-51><a id=__codelineno-0-51 name=__codelineno-0-51></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Auth data has been successfully saved! You are now logged in with account ID: </span><span class=si>{</span><span class=n>account_id</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-52><a id=__codelineno-0-52 name=__codelineno-0-52></a>        <span class=k>return</span> <span class=kc>True</span>
</span><span id=__span-0-53><a id=__codelineno-0-53 name=__codelineno-0-53></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-54><a id=__codelineno-0-54 name=__codelineno-0-54></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Signature verification failed. Abort&quot;</span><span class=p>)</span>
</span><span id=__span-0-55><a id=__codelineno-0-55 name=__codelineno-0-55></a>        <span class=k>return</span> <span class=kc>False</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-module"> <h3 id=nearai.model class="doc doc-heading"> <span class="doc doc-object-name doc-module-name">model</span> <a href=#nearai.model class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h4 id=nearai.model.get_model class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_model</span> <a href=#nearai.model.get_model class=headerlink title="Permanent link">&para;</a></h4> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>get_model</span><span class=p>(</span><span class=n>name</span><span class=p>:</span> <span class=n>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=pathlib.Path>Path</span></span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Download the model from the registry and download it locally if it hasn't been downloaded yet.</p> <p>:param name: The name of the entry to download the model. The format should be namespace/name/version. :return: The path to the downloaded model</p> <details class=quote> <summary>Source code in <code>nearai/model.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-6> 6</a></span>
<span class=normal><a href=#__codelineno-0-7> 7</a></span>
<span class=normal><a href=#__codelineno-0-8> 8</a></span>
<span class=normal><a href=#__codelineno-0-9> 9</a></span>
<span class=normal><a href=#__codelineno-0-10>10</a></span>
<span class=normal><a href=#__codelineno-0-11>11</a></span>
<span class=normal><a href=#__codelineno-0-12>12</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6></a><span class=k>def</span><span class=w> </span><span class=nf>get_model</span><span class=p>(</span><span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Path</span><span class=p>:</span>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Download the model from the registry and download it locally if it hasn&#39;t been downloaded yet.</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8></a>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9></a><span class=sd>    :param name: The name of the entry to download the model. The format should be namespace/name/version.</span>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10></a><span class=sd>    :return: The path to the downloaded model</span>
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12></a>    <span class=k>return</span> <span class=n>registry</span><span class=o>.</span><span class=n>download</span><span class=p>(</span><span class=n>name</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-module"> <h3 id=nearai.registry class="doc doc-heading"> <span class="doc doc-object-name doc-module-name">registry</span> <a href=#nearai.registry class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h4 id=nearai.registry.Registry class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">Registry</span> <a href=#nearai.registry.Registry class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <details class=quote> <summary>Source code in <code>nearai/registry.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-55> 55</a></span>
<span class=normal><a href=#__codelineno-0-56> 56</a></span>
<span class=normal><a href=#__codelineno-0-57> 57</a></span>
<span class=normal><a href=#__codelineno-0-58> 58</a></span>
<span class=normal><a href=#__codelineno-0-59> 59</a></span>
<span class=normal><a href=#__codelineno-0-60> 60</a></span>
<span class=normal><a href=#__codelineno-0-61> 61</a></span>
<span class=normal><a href=#__codelineno-0-62> 62</a></span>
<span class=normal><a href=#__codelineno-0-63> 63</a></span>
<span class=normal><a href=#__codelineno-0-64> 64</a></span>
<span class=normal><a href=#__codelineno-0-65> 65</a></span>
<span class=normal><a href=#__codelineno-0-66> 66</a></span>
<span class=normal><a href=#__codelineno-0-67> 67</a></span>
<span class=normal><a href=#__codelineno-0-68> 68</a></span>
<span class=normal><a href=#__codelineno-0-69> 69</a></span>
<span class=normal><a href=#__codelineno-0-70> 70</a></span>
<span class=normal><a href=#__codelineno-0-71> 71</a></span>
<span class=normal><a href=#__codelineno-0-72> 72</a></span>
<span class=normal><a href=#__codelineno-0-73> 73</a></span>
<span class=normal><a href=#__codelineno-0-74> 74</a></span>
<span class=normal><a href=#__codelineno-0-75> 75</a></span>
<span class=normal><a href=#__codelineno-0-76> 76</a></span>
<span class=normal><a href=#__codelineno-0-77> 77</a></span>
<span class=normal><a href=#__codelineno-0-78> 78</a></span>
<span class=normal><a href=#__codelineno-0-79> 79</a></span>
<span class=normal><a href=#__codelineno-0-80> 80</a></span>
<span class=normal><a href=#__codelineno-0-81> 81</a></span>
<span class=normal><a href=#__codelineno-0-82> 82</a></span>
<span class=normal><a href=#__codelineno-0-83> 83</a></span>
<span class=normal><a href=#__codelineno-0-84> 84</a></span>
<span class=normal><a href=#__codelineno-0-85> 85</a></span>
<span class=normal><a href=#__codelineno-0-86> 86</a></span>
<span class=normal><a href=#__codelineno-0-87> 87</a></span>
<span class=normal><a href=#__codelineno-0-88> 88</a></span>
<span class=normal><a href=#__codelineno-0-89> 89</a></span>
<span class=normal><a href=#__codelineno-0-90> 90</a></span>
<span class=normal><a href=#__codelineno-0-91> 91</a></span>
<span class=normal><a href=#__codelineno-0-92> 92</a></span>
<span class=normal><a href=#__codelineno-0-93> 93</a></span>
<span class=normal><a href=#__codelineno-0-94> 94</a></span>
<span class=normal><a href=#__codelineno-0-95> 95</a></span>
<span class=normal><a href=#__codelineno-0-96> 96</a></span>
<span class=normal><a href=#__codelineno-0-97> 97</a></span>
<span class=normal><a href=#__codelineno-0-98> 98</a></span>
<span class=normal><a href=#__codelineno-0-99> 99</a></span>
<span class=normal><a href=#__codelineno-0-100>100</a></span>
<span class=normal><a href=#__codelineno-0-101>101</a></span>
<span class=normal><a href=#__codelineno-0-102>102</a></span>
<span class=normal><a href=#__codelineno-0-103>103</a></span>
<span class=normal><a href=#__codelineno-0-104>104</a></span>
<span class=normal><a href=#__codelineno-0-105>105</a></span>
<span class=normal><a href=#__codelineno-0-106>106</a></span>
<span class=normal><a href=#__codelineno-0-107>107</a></span>
<span class=normal><a href=#__codelineno-0-108>108</a></span>
<span class=normal><a href=#__codelineno-0-109>109</a></span>
<span class=normal><a href=#__codelineno-0-110>110</a></span>
<span class=normal><a href=#__codelineno-0-111>111</a></span>
<span class=normal><a href=#__codelineno-0-112>112</a></span>
<span class=normal><a href=#__codelineno-0-113>113</a></span>
<span class=normal><a href=#__codelineno-0-114>114</a></span>
<span class=normal><a href=#__codelineno-0-115>115</a></span>
<span class=normal><a href=#__codelineno-0-116>116</a></span>
<span class=normal><a href=#__codelineno-0-117>117</a></span>
<span class=normal><a href=#__codelineno-0-118>118</a></span>
<span class=normal><a href=#__codelineno-0-119>119</a></span>
<span class=normal><a href=#__codelineno-0-120>120</a></span>
<span class=normal><a href=#__codelineno-0-121>121</a></span>
<span class=normal><a href=#__codelineno-0-122>122</a></span>
<span class=normal><a href=#__codelineno-0-123>123</a></span>
<span class=normal><a href=#__codelineno-0-124>124</a></span>
<span class=normal><a href=#__codelineno-0-125>125</a></span>
<span class=normal><a href=#__codelineno-0-126>126</a></span>
<span class=normal><a href=#__codelineno-0-127>127</a></span>
<span class=normal><a href=#__codelineno-0-128>128</a></span>
<span class=normal><a href=#__codelineno-0-129>129</a></span>
<span class=normal><a href=#__codelineno-0-130>130</a></span>
<span class=normal><a href=#__codelineno-0-131>131</a></span>
<span class=normal><a href=#__codelineno-0-132>132</a></span>
<span class=normal><a href=#__codelineno-0-133>133</a></span>
<span class=normal><a href=#__codelineno-0-134>134</a></span>
<span class=normal><a href=#__codelineno-0-135>135</a></span>
<span class=normal><a href=#__codelineno-0-136>136</a></span>
<span class=normal><a href=#__codelineno-0-137>137</a></span>
<span class=normal><a href=#__codelineno-0-138>138</a></span>
<span class=normal><a href=#__codelineno-0-139>139</a></span>
<span class=normal><a href=#__codelineno-0-140>140</a></span>
<span class=normal><a href=#__codelineno-0-141>141</a></span>
<span class=normal><a href=#__codelineno-0-142>142</a></span>
<span class=normal><a href=#__codelineno-0-143>143</a></span>
<span class=normal><a href=#__codelineno-0-144>144</a></span>
<span class=normal><a href=#__codelineno-0-145>145</a></span>
<span class=normal><a href=#__codelineno-0-146>146</a></span>
<span class=normal><a href=#__codelineno-0-147>147</a></span>
<span class=normal><a href=#__codelineno-0-148>148</a></span>
<span class=normal><a href=#__codelineno-0-149>149</a></span>
<span class=normal><a href=#__codelineno-0-150>150</a></span>
<span class=normal><a href=#__codelineno-0-151>151</a></span>
<span class=normal><a href=#__codelineno-0-152>152</a></span>
<span class=normal><a href=#__codelineno-0-153>153</a></span>
<span class=normal><a href=#__codelineno-0-154>154</a></span>
<span class=normal><a href=#__codelineno-0-155>155</a></span>
<span class=normal><a href=#__codelineno-0-156>156</a></span>
<span class=normal><a href=#__codelineno-0-157>157</a></span>
<span class=normal><a href=#__codelineno-0-158>158</a></span>
<span class=normal><a href=#__codelineno-0-159>159</a></span>
<span class=normal><a href=#__codelineno-0-160>160</a></span>
<span class=normal><a href=#__codelineno-0-161>161</a></span>
<span class=normal><a href=#__codelineno-0-162>162</a></span>
<span class=normal><a href=#__codelineno-0-163>163</a></span>
<span class=normal><a href=#__codelineno-0-164>164</a></span>
<span class=normal><a href=#__codelineno-0-165>165</a></span>
<span class=normal><a href=#__codelineno-0-166>166</a></span>
<span class=normal><a href=#__codelineno-0-167>167</a></span>
<span class=normal><a href=#__codelineno-0-168>168</a></span>
<span class=normal><a href=#__codelineno-0-169>169</a></span>
<span class=normal><a href=#__codelineno-0-170>170</a></span>
<span class=normal><a href=#__codelineno-0-171>171</a></span>
<span class=normal><a href=#__codelineno-0-172>172</a></span>
<span class=normal><a href=#__codelineno-0-173>173</a></span>
<span class=normal><a href=#__codelineno-0-174>174</a></span>
<span class=normal><a href=#__codelineno-0-175>175</a></span>
<span class=normal><a href=#__codelineno-0-176>176</a></span>
<span class=normal><a href=#__codelineno-0-177>177</a></span>
<span class=normal><a href=#__codelineno-0-178>178</a></span>
<span class=normal><a href=#__codelineno-0-179>179</a></span>
<span class=normal><a href=#__codelineno-0-180>180</a></span>
<span class=normal><a href=#__codelineno-0-181>181</a></span>
<span class=normal><a href=#__codelineno-0-182>182</a></span>
<span class=normal><a href=#__codelineno-0-183>183</a></span>
<span class=normal><a href=#__codelineno-0-184>184</a></span>
<span class=normal><a href=#__codelineno-0-185>185</a></span>
<span class=normal><a href=#__codelineno-0-186>186</a></span>
<span class=normal><a href=#__codelineno-0-187>187</a></span>
<span class=normal><a href=#__codelineno-0-188>188</a></span>
<span class=normal><a href=#__codelineno-0-189>189</a></span>
<span class=normal><a href=#__codelineno-0-190>190</a></span>
<span class=normal><a href=#__codelineno-0-191>191</a></span>
<span class=normal><a href=#__codelineno-0-192>192</a></span>
<span class=normal><a href=#__codelineno-0-193>193</a></span>
<span class=normal><a href=#__codelineno-0-194>194</a></span>
<span class=normal><a href=#__codelineno-0-195>195</a></span>
<span class=normal><a href=#__codelineno-0-196>196</a></span>
<span class=normal><a href=#__codelineno-0-197>197</a></span>
<span class=normal><a href=#__codelineno-0-198>198</a></span>
<span class=normal><a href=#__codelineno-0-199>199</a></span>
<span class=normal><a href=#__codelineno-0-200>200</a></span>
<span class=normal><a href=#__codelineno-0-201>201</a></span>
<span class=normal><a href=#__codelineno-0-202>202</a></span>
<span class=normal><a href=#__codelineno-0-203>203</a></span>
<span class=normal><a href=#__codelineno-0-204>204</a></span>
<span class=normal><a href=#__codelineno-0-205>205</a></span>
<span class=normal><a href=#__codelineno-0-206>206</a></span>
<span class=normal><a href=#__codelineno-0-207>207</a></span>
<span class=normal><a href=#__codelineno-0-208>208</a></span>
<span class=normal><a href=#__codelineno-0-209>209</a></span>
<span class=normal><a href=#__codelineno-0-210>210</a></span>
<span class=normal><a href=#__codelineno-0-211>211</a></span>
<span class=normal><a href=#__codelineno-0-212>212</a></span>
<span class=normal><a href=#__codelineno-0-213>213</a></span>
<span class=normal><a href=#__codelineno-0-214>214</a></span>
<span class=normal><a href=#__codelineno-0-215>215</a></span>
<span class=normal><a href=#__codelineno-0-216>216</a></span>
<span class=normal><a href=#__codelineno-0-217>217</a></span>
<span class=normal><a href=#__codelineno-0-218>218</a></span>
<span class=normal><a href=#__codelineno-0-219>219</a></span>
<span class=normal><a href=#__codelineno-0-220>220</a></span>
<span class=normal><a href=#__codelineno-0-221>221</a></span>
<span class=normal><a href=#__codelineno-0-222>222</a></span>
<span class=normal><a href=#__codelineno-0-223>223</a></span>
<span class=normal><a href=#__codelineno-0-224>224</a></span>
<span class=normal><a href=#__codelineno-0-225>225</a></span>
<span class=normal><a href=#__codelineno-0-226>226</a></span>
<span class=normal><a href=#__codelineno-0-227>227</a></span>
<span class=normal><a href=#__codelineno-0-228>228</a></span>
<span class=normal><a href=#__codelineno-0-229>229</a></span>
<span class=normal><a href=#__codelineno-0-230>230</a></span>
<span class=normal><a href=#__codelineno-0-231>231</a></span>
<span class=normal><a href=#__codelineno-0-232>232</a></span>
<span class=normal><a href=#__codelineno-0-233>233</a></span>
<span class=normal><a href=#__codelineno-0-234>234</a></span>
<span class=normal><a href=#__codelineno-0-235>235</a></span>
<span class=normal><a href=#__codelineno-0-236>236</a></span>
<span class=normal><a href=#__codelineno-0-237>237</a></span>
<span class=normal><a href=#__codelineno-0-238>238</a></span>
<span class=normal><a href=#__codelineno-0-239>239</a></span>
<span class=normal><a href=#__codelineno-0-240>240</a></span>
<span class=normal><a href=#__codelineno-0-241>241</a></span>
<span class=normal><a href=#__codelineno-0-242>242</a></span>
<span class=normal><a href=#__codelineno-0-243>243</a></span>
<span class=normal><a href=#__codelineno-0-244>244</a></span>
<span class=normal><a href=#__codelineno-0-245>245</a></span>
<span class=normal><a href=#__codelineno-0-246>246</a></span>
<span class=normal><a href=#__codelineno-0-247>247</a></span>
<span class=normal><a href=#__codelineno-0-248>248</a></span>
<span class=normal><a href=#__codelineno-0-249>249</a></span>
<span class=normal><a href=#__codelineno-0-250>250</a></span>
<span class=normal><a href=#__codelineno-0-251>251</a></span>
<span class=normal><a href=#__codelineno-0-252>252</a></span>
<span class=normal><a href=#__codelineno-0-253>253</a></span>
<span class=normal><a href=#__codelineno-0-254>254</a></span>
<span class=normal><a href=#__codelineno-0-255>255</a></span>
<span class=normal><a href=#__codelineno-0-256>256</a></span>
<span class=normal><a href=#__codelineno-0-257>257</a></span>
<span class=normal><a href=#__codelineno-0-258>258</a></span>
<span class=normal><a href=#__codelineno-0-259>259</a></span>
<span class=normal><a href=#__codelineno-0-260>260</a></span>
<span class=normal><a href=#__codelineno-0-261>261</a></span>
<span class=normal><a href=#__codelineno-0-262>262</a></span>
<span class=normal><a href=#__codelineno-0-263>263</a></span>
<span class=normal><a href=#__codelineno-0-264>264</a></span>
<span class=normal><a href=#__codelineno-0-265>265</a></span>
<span class=normal><a href=#__codelineno-0-266>266</a></span>
<span class=normal><a href=#__codelineno-0-267>267</a></span>
<span class=normal><a href=#__codelineno-0-268>268</a></span>
<span class=normal><a href=#__codelineno-0-269>269</a></span>
<span class=normal><a href=#__codelineno-0-270>270</a></span>
<span class=normal><a href=#__codelineno-0-271>271</a></span>
<span class=normal><a href=#__codelineno-0-272>272</a></span>
<span class=normal><a href=#__codelineno-0-273>273</a></span>
<span class=normal><a href=#__codelineno-0-274>274</a></span>
<span class=normal><a href=#__codelineno-0-275>275</a></span>
<span class=normal><a href=#__codelineno-0-276>276</a></span>
<span class=normal><a href=#__codelineno-0-277>277</a></span>
<span class=normal><a href=#__codelineno-0-278>278</a></span>
<span class=normal><a href=#__codelineno-0-279>279</a></span>
<span class=normal><a href=#__codelineno-0-280>280</a></span>
<span class=normal><a href=#__codelineno-0-281>281</a></span>
<span class=normal><a href=#__codelineno-0-282>282</a></span>
<span class=normal><a href=#__codelineno-0-283>283</a></span>
<span class=normal><a href=#__codelineno-0-284>284</a></span>
<span class=normal><a href=#__codelineno-0-285>285</a></span>
<span class=normal><a href=#__codelineno-0-286>286</a></span>
<span class=normal><a href=#__codelineno-0-287>287</a></span>
<span class=normal><a href=#__codelineno-0-288>288</a></span>
<span class=normal><a href=#__codelineno-0-289>289</a></span>
<span class=normal><a href=#__codelineno-0-290>290</a></span>
<span class=normal><a href=#__codelineno-0-291>291</a></span>
<span class=normal><a href=#__codelineno-0-292>292</a></span>
<span class=normal><a href=#__codelineno-0-293>293</a></span>
<span class=normal><a href=#__codelineno-0-294>294</a></span>
<span class=normal><a href=#__codelineno-0-295>295</a></span>
<span class=normal><a href=#__codelineno-0-296>296</a></span>
<span class=normal><a href=#__codelineno-0-297>297</a></span>
<span class=normal><a href=#__codelineno-0-298>298</a></span>
<span class=normal><a href=#__codelineno-0-299>299</a></span>
<span class=normal><a href=#__codelineno-0-300>300</a></span>
<span class=normal><a href=#__codelineno-0-301>301</a></span>
<span class=normal><a href=#__codelineno-0-302>302</a></span>
<span class=normal><a href=#__codelineno-0-303>303</a></span>
<span class=normal><a href=#__codelineno-0-304>304</a></span>
<span class=normal><a href=#__codelineno-0-305>305</a></span>
<span class=normal><a href=#__codelineno-0-306>306</a></span>
<span class=normal><a href=#__codelineno-0-307>307</a></span>
<span class=normal><a href=#__codelineno-0-308>308</a></span>
<span class=normal><a href=#__codelineno-0-309>309</a></span>
<span class=normal><a href=#__codelineno-0-310>310</a></span>
<span class=normal><a href=#__codelineno-0-311>311</a></span>
<span class=normal><a href=#__codelineno-0-312>312</a></span>
<span class=normal><a href=#__codelineno-0-313>313</a></span>
<span class=normal><a href=#__codelineno-0-314>314</a></span>
<span class=normal><a href=#__codelineno-0-315>315</a></span>
<span class=normal><a href=#__codelineno-0-316>316</a></span>
<span class=normal><a href=#__codelineno-0-317>317</a></span>
<span class=normal><a href=#__codelineno-0-318>318</a></span>
<span class=normal><a href=#__codelineno-0-319>319</a></span>
<span class=normal><a href=#__codelineno-0-320>320</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-55><a id=__codelineno-0-55 name=__codelineno-0-55></a><span class=k>class</span><span class=w> </span><span class=nc>Registry</span><span class=p>:</span>
</span><span id=__span-0-56><a id=__codelineno-0-56 name=__codelineno-0-56></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-0-57><a id=__codelineno-0-57 name=__codelineno-0-57></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Create Registry object to interact with the registry programmatically.&quot;&quot;&quot;</span>
</span><span id=__span-0-58><a id=__codelineno-0-58 name=__codelineno-0-58></a>        <span class=bp>self</span><span class=o>.</span><span class=n>download_folder</span> <span class=o>=</span> <span class=n>DATA_FOLDER</span> <span class=o>/</span> <span class=s2>&quot;registry&quot;</span>
</span><span id=__span-0-59><a id=__codelineno-0-59 name=__codelineno-0-59></a>        <span class=bp>self</span><span class=o>.</span><span class=n>api</span> <span class=o>=</span> <span class=n>RegistryApi</span><span class=p>()</span>
</span><span id=__span-0-60><a id=__codelineno-0-60 name=__codelineno-0-60></a>
</span><span id=__span-0-61><a id=__codelineno-0-61 name=__codelineno-0-61></a>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>download_folder</span><span class=o>.</span><span class=n>exists</span><span class=p>():</span>
</span><span id=__span-0-62><a id=__codelineno-0-62 name=__codelineno-0-62></a>            <span class=bp>self</span><span class=o>.</span><span class=n>download_folder</span><span class=o>.</span><span class=n>mkdir</span><span class=p>(</span><span class=n>parents</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-63><a id=__codelineno-0-63 name=__codelineno-0-63></a>
</span><span id=__span-0-64><a id=__codelineno-0-64 name=__codelineno-0-64></a>    <span class=k>def</span><span class=w> </span><span class=nf>update</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>entry_location</span><span class=p>:</span> <span class=n>EntryLocation</span><span class=p>,</span> <span class=n>metadata</span><span class=p>:</span> <span class=n>EntryMetadataInput</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span><span id=__span-0-65><a id=__codelineno-0-65 name=__codelineno-0-65></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Update metadata of a entry in the registry.&quot;&quot;&quot;</span>
</span><span id=__span-0-66><a id=__codelineno-0-66 name=__codelineno-0-66></a>        <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>api</span><span class=o>.</span><span class=n>upload_metadata_v1_registry_upload_metadata_post</span><span class=p>(</span>
</span><span id=__span-0-67><a id=__codelineno-0-67 name=__codelineno-0-67></a>            <span class=n>BodyUploadMetadataV1RegistryUploadMetadataPost</span><span class=p>(</span><span class=n>metadata</span><span class=o>=</span><span class=n>metadata</span><span class=p>,</span> <span class=n>entry_location</span><span class=o>=</span><span class=n>entry_location</span><span class=p>)</span>
</span><span id=__span-0-68><a id=__codelineno-0-68 name=__codelineno-0-68></a>        <span class=p>)</span>
</span><span id=__span-0-69><a id=__codelineno-0-69 name=__codelineno-0-69></a>        <span class=k>return</span> <span class=n>result</span>
</span><span id=__span-0-70><a id=__codelineno-0-70 name=__codelineno-0-70></a>
</span><span id=__span-0-71><a id=__codelineno-0-71 name=__codelineno-0-71></a>    <span class=k>def</span><span class=w> </span><span class=nf>info</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>entry_location</span><span class=p>:</span> <span class=n>EntryLocation</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>EntryMetadata</span><span class=p>]:</span>
</span><span id=__span-0-72><a id=__codelineno-0-72 name=__codelineno-0-72></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Get metadata of a entry in the registry.&quot;&quot;&quot;</span>
</span><span id=__span-0-73><a id=__codelineno-0-73 name=__codelineno-0-73></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-74><a id=__codelineno-0-74 name=__codelineno-0-74></a>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>api</span><span class=o>.</span><span class=n>download_metadata_v1_registry_download_metadata_post</span><span class=p>(</span>
</span><span id=__span-0-75><a id=__codelineno-0-75 name=__codelineno-0-75></a>                <span class=n>BodyDownloadMetadataV1RegistryDownloadMetadataPost</span><span class=o>.</span><span class=n>from_dict</span><span class=p>(</span><span class=nb>dict</span><span class=p>(</span><span class=n>entry_location</span><span class=o>=</span><span class=n>entry_location</span><span class=p>))</span>
</span><span id=__span-0-76><a id=__codelineno-0-76 name=__codelineno-0-76></a>            <span class=p>)</span>
</span><span id=__span-0-77><a id=__codelineno-0-77 name=__codelineno-0-77></a>        <span class=k>except</span> <span class=n>NotFoundException</span><span class=p>:</span>
</span><span id=__span-0-78><a id=__codelineno-0-78 name=__codelineno-0-78></a>            <span class=k>return</span> <span class=kc>None</span>
</span><span id=__span-0-79><a id=__codelineno-0-79 name=__codelineno-0-79></a>
</span><span id=__span-0-80><a id=__codelineno-0-80 name=__codelineno-0-80></a>    <span class=k>def</span><span class=w> </span><span class=nf>upload_file</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>entry_location</span><span class=p>:</span> <span class=n>EntryLocation</span><span class=p>,</span> <span class=n>local_path</span><span class=p>:</span> <span class=n>Path</span><span class=p>,</span> <span class=n>path</span><span class=p>:</span> <span class=n>Path</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span><span id=__span-0-81><a id=__codelineno-0-81 name=__codelineno-0-81></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Upload a file to the registry.&quot;&quot;&quot;</span>
</span><span id=__span-0-82><a id=__codelineno-0-82 name=__codelineno-0-82></a>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>local_path</span><span class=p>,</span> <span class=s2>&quot;rb&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>file</span><span class=p>:</span>
</span><span id=__span-0-83><a id=__codelineno-0-83 name=__codelineno-0-83></a>            <span class=n>data</span> <span class=o>=</span> <span class=n>file</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span><span id=__span-0-84><a id=__codelineno-0-84 name=__codelineno-0-84></a>
</span><span id=__span-0-85><a id=__codelineno-0-85 name=__codelineno-0-85></a>            <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-86><a id=__codelineno-0-86 name=__codelineno-0-86></a>                <span class=bp>self</span><span class=o>.</span><span class=n>api</span><span class=o>.</span><span class=n>upload_file_v1_registry_upload_file_post</span><span class=p>(</span>
</span><span id=__span-0-87><a id=__codelineno-0-87 name=__codelineno-0-87></a>                    <span class=n>path</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>path</span><span class=p>),</span>
</span><span id=__span-0-88><a id=__codelineno-0-88 name=__codelineno-0-88></a>                    <span class=n>file</span><span class=o>=</span><span class=n>data</span><span class=p>,</span>
</span><span id=__span-0-89><a id=__codelineno-0-89 name=__codelineno-0-89></a>                    <span class=n>namespace</span><span class=o>=</span><span class=n>entry_location</span><span class=o>.</span><span class=n>namespace</span><span class=p>,</span>
</span><span id=__span-0-90><a id=__codelineno-0-90 name=__codelineno-0-90></a>                    <span class=n>name</span><span class=o>=</span><span class=n>entry_location</span><span class=o>.</span><span class=n>name</span><span class=p>,</span>
</span><span id=__span-0-91><a id=__codelineno-0-91 name=__codelineno-0-91></a>                    <span class=n>version</span><span class=o>=</span><span class=n>entry_location</span><span class=o>.</span><span class=n>version</span><span class=p>,</span>
</span><span id=__span-0-92><a id=__codelineno-0-92 name=__codelineno-0-92></a>                <span class=p>)</span>
</span><span id=__span-0-93><a id=__codelineno-0-93 name=__codelineno-0-93></a>                <span class=k>return</span> <span class=kc>True</span>
</span><span id=__span-0-94><a id=__codelineno-0-94 name=__codelineno-0-94></a>            <span class=k>except</span> <span class=n>BadRequestException</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-95><a id=__codelineno-0-95 name=__codelineno-0-95></a>                <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>e</span><span class=o>.</span><span class=n>body</span><span class=p>,</span> <span class=nb>str</span><span class=p>)</span> <span class=ow>and</span> <span class=s2>&quot;already exists&quot;</span> <span class=ow>in</span> <span class=n>e</span><span class=o>.</span><span class=n>body</span><span class=p>:</span>
</span><span id=__span-0-96><a id=__codelineno-0-96 name=__codelineno-0-96></a>                    <span class=k>return</span> <span class=kc>False</span>
</span><span id=__span-0-97><a id=__codelineno-0-97 name=__codelineno-0-97></a>
</span><span id=__span-0-98><a id=__codelineno-0-98 name=__codelineno-0-98></a>                <span class=k>raise</span> <span class=n>e</span>
</span><span id=__span-0-99><a id=__codelineno-0-99 name=__codelineno-0-99></a>
</span><span id=__span-0-100><a id=__codelineno-0-100 name=__codelineno-0-100></a>    <span class=k>def</span><span class=w> </span><span class=nf>download_file</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>entry_location</span><span class=p>:</span> <span class=n>EntryLocation</span><span class=p>,</span> <span class=n>path</span><span class=p>:</span> <span class=n>Path</span><span class=p>,</span> <span class=n>local_path</span><span class=p>:</span> <span class=n>Path</span><span class=p>):</span>
</span><span id=__span-0-101><a id=__codelineno-0-101 name=__codelineno-0-101></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Download a file from the registry.&quot;&quot;&quot;</span>
</span><span id=__span-0-102><a id=__codelineno-0-102 name=__codelineno-0-102></a>        <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>api</span><span class=o>.</span><span class=n>download_file_v1_registry_download_file_post_without_preload_content</span><span class=p>(</span>
</span><span id=__span-0-103><a id=__codelineno-0-103 name=__codelineno-0-103></a>            <span class=n>BodyDownloadFileV1RegistryDownloadFilePost</span><span class=o>.</span><span class=n>from_dict</span><span class=p>(</span>
</span><span id=__span-0-104><a id=__codelineno-0-104 name=__codelineno-0-104></a>                <span class=nb>dict</span><span class=p>(</span>
</span><span id=__span-0-105><a id=__codelineno-0-105 name=__codelineno-0-105></a>                    <span class=n>entry_location</span><span class=o>=</span><span class=n>entry_location</span><span class=p>,</span>
</span><span id=__span-0-106><a id=__codelineno-0-106 name=__codelineno-0-106></a>                    <span class=n>path</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>path</span><span class=p>),</span>
</span><span id=__span-0-107><a id=__codelineno-0-107 name=__codelineno-0-107></a>                <span class=p>)</span>
</span><span id=__span-0-108><a id=__codelineno-0-108 name=__codelineno-0-108></a>            <span class=p>)</span>
</span><span id=__span-0-109><a id=__codelineno-0-109 name=__codelineno-0-109></a>        <span class=p>)</span>
</span><span id=__span-0-110><a id=__codelineno-0-110 name=__codelineno-0-110></a>
</span><span id=__span-0-111><a id=__codelineno-0-111 name=__codelineno-0-111></a>        <span class=n>local_path</span><span class=o>.</span><span class=n>parent</span><span class=o>.</span><span class=n>mkdir</span><span class=p>(</span><span class=n>parents</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-112><a id=__codelineno-0-112 name=__codelineno-0-112></a>
</span><span id=__span-0-113><a id=__codelineno-0-113 name=__codelineno-0-113></a>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>local_path</span><span class=p>,</span> <span class=s2>&quot;wb&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-114><a id=__codelineno-0-114 name=__codelineno-0-114></a>            <span class=n>copyfileobj</span><span class=p>(</span><span class=n>result</span><span class=p>,</span> <span class=n>f</span><span class=p>)</span>
</span><span id=__span-0-115><a id=__codelineno-0-115 name=__codelineno-0-115></a>
</span><span id=__span-0-116><a id=__codelineno-0-116 name=__codelineno-0-116></a>    <span class=k>def</span><span class=w> </span><span class=nf>download</span><span class=p>(</span>
</span><span id=__span-0-117><a id=__codelineno-0-117 name=__codelineno-0-117></a>        <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-118><a id=__codelineno-0-118 name=__codelineno-0-118></a>        <span class=n>entry_location</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>EntryLocation</span><span class=p>],</span>
</span><span id=__span-0-119><a id=__codelineno-0-119 name=__codelineno-0-119></a>        <span class=n>force</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-120><a id=__codelineno-0-120 name=__codelineno-0-120></a>        <span class=n>show_progress</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-121><a id=__codelineno-0-121 name=__codelineno-0-121></a>        <span class=n>verbose</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-122><a id=__codelineno-0-122 name=__codelineno-0-122></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Path</span><span class=p>:</span>
</span><span id=__span-0-123><a id=__codelineno-0-123 name=__codelineno-0-123></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Download entry from the registry locally.&quot;&quot;&quot;</span>
</span><span id=__span-0-124><a id=__codelineno-0-124 name=__codelineno-0-124></a>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>entry_location</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-125><a id=__codelineno-0-125 name=__codelineno-0-125></a>            <span class=n>entry_location</span> <span class=o>=</span> <span class=n>parse_location</span><span class=p>(</span><span class=n>entry_location</span><span class=p>)</span>
</span><span id=__span-0-126><a id=__codelineno-0-126 name=__codelineno-0-126></a>
</span><span id=__span-0-127><a id=__codelineno-0-127 name=__codelineno-0-127></a>        <span class=n>download_path</span> <span class=o>=</span> <span class=n>get_registry_folder</span><span class=p>()</span> <span class=o>/</span> <span class=n>entry_location</span><span class=o>.</span><span class=n>namespace</span> <span class=o>/</span> <span class=n>entry_location</span><span class=o>.</span><span class=n>name</span> <span class=o>/</span> <span class=n>entry_location</span><span class=o>.</span><span class=n>version</span>
</span><span id=__span-0-128><a id=__codelineno-0-128 name=__codelineno-0-128></a>
</span><span id=__span-0-129><a id=__codelineno-0-129 name=__codelineno-0-129></a>        <span class=k>if</span> <span class=n>download_path</span><span class=o>.</span><span class=n>exists</span><span class=p>():</span>
</span><span id=__span-0-130><a id=__codelineno-0-130 name=__codelineno-0-130></a>            <span class=k>if</span> <span class=ow>not</span> <span class=n>force</span><span class=p>:</span>
</span><span id=__span-0-131><a id=__codelineno-0-131 name=__codelineno-0-131></a>                <span class=k>if</span> <span class=n>verbose</span><span class=p>:</span>
</span><span id=__span-0-132><a id=__codelineno-0-132 name=__codelineno-0-132></a>                    <span class=nb>print</span><span class=p>(</span>
</span><span id=__span-0-133><a id=__codelineno-0-133 name=__codelineno-0-133></a>                        <span class=sa>f</span><span class=s2>&quot;Entry </span><span class=si>{</span><span class=n>entry_location</span><span class=si>}</span><span class=s2> already exists at </span><span class=si>{</span><span class=n>download_path</span><span class=si>}</span><span class=s2>. Use --force to overwrite the entry.&quot;</span>
</span><span id=__span-0-134><a id=__codelineno-0-134 name=__codelineno-0-134></a>                    <span class=p>)</span>
</span><span id=__span-0-135><a id=__codelineno-0-135 name=__codelineno-0-135></a>                <span class=k>return</span> <span class=n>download_path</span>
</span><span id=__span-0-136><a id=__codelineno-0-136 name=__codelineno-0-136></a>
</span><span id=__span-0-137><a id=__codelineno-0-137 name=__codelineno-0-137></a>        <span class=n>files</span> <span class=o>=</span> <span class=n>registry</span><span class=o>.</span><span class=n>list_files</span><span class=p>(</span><span class=n>entry_location</span><span class=p>)</span>
</span><span id=__span-0-138><a id=__codelineno-0-138 name=__codelineno-0-138></a>
</span><span id=__span-0-139><a id=__codelineno-0-139 name=__codelineno-0-139></a>        <span class=n>download_path</span><span class=o>.</span><span class=n>mkdir</span><span class=p>(</span><span class=n>parents</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-140><a id=__codelineno-0-140 name=__codelineno-0-140></a>
</span><span id=__span-0-141><a id=__codelineno-0-141 name=__codelineno-0-141></a>        <span class=n>metadata</span> <span class=o>=</span> <span class=n>registry</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=n>entry_location</span><span class=p>)</span>
</span><span id=__span-0-142><a id=__codelineno-0-142 name=__codelineno-0-142></a>
</span><span id=__span-0-143><a id=__codelineno-0-143 name=__codelineno-0-143></a>        <span class=k>if</span> <span class=n>metadata</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-144><a id=__codelineno-0-144 name=__codelineno-0-144></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Entry </span><span class=si>{</span><span class=n>entry_location</span><span class=si>}</span><span class=s2> not found.&quot;</span><span class=p>)</span>
</span><span id=__span-0-145><a id=__codelineno-0-145 name=__codelineno-0-145></a>
</span><span id=__span-0-146><a id=__codelineno-0-146 name=__codelineno-0-146></a>        <span class=n>metadata_path</span> <span class=o>=</span> <span class=n>download_path</span> <span class=o>/</span> <span class=s2>&quot;metadata.json&quot;</span>
</span><span id=__span-0-147><a id=__codelineno-0-147 name=__codelineno-0-147></a>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>metadata_path</span><span class=p>,</span> <span class=s2>&quot;w&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-148><a id=__codelineno-0-148 name=__codelineno-0-148></a>            <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>metadata</span><span class=o>.</span><span class=n>model_dump_json</span><span class=p>(</span><span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>))</span>
</span><span id=__span-0-149><a id=__codelineno-0-149 name=__codelineno-0-149></a>
</span><span id=__span-0-150><a id=__codelineno-0-150 name=__codelineno-0-150></a>        <span class=k>for</span> <span class=n>file</span> <span class=ow>in</span> <span class=p>(</span><span class=n>pbar</span> <span class=o>:=</span> <span class=n>tqdm</span><span class=p>(</span><span class=n>files</span><span class=p>,</span> <span class=n>disable</span><span class=o>=</span><span class=ow>not</span> <span class=n>show_progress</span><span class=p>)):</span>
</span><span id=__span-0-151><a id=__codelineno-0-151 name=__codelineno-0-151></a>            <span class=n>pbar</span><span class=o>.</span><span class=n>set_description</span><span class=p>(</span><span class=n>file</span><span class=p>)</span>
</span><span id=__span-0-152><a id=__codelineno-0-152 name=__codelineno-0-152></a>            <span class=n>registry</span><span class=o>.</span><span class=n>download_file</span><span class=p>(</span><span class=n>entry_location</span><span class=p>,</span> <span class=n>file</span><span class=p>,</span> <span class=n>download_path</span> <span class=o>/</span> <span class=n>file</span><span class=p>)</span>
</span><span id=__span-0-153><a id=__codelineno-0-153 name=__codelineno-0-153></a>
</span><span id=__span-0-154><a id=__codelineno-0-154 name=__codelineno-0-154></a>        <span class=k>return</span> <span class=n>download_path</span>
</span><span id=__span-0-155><a id=__codelineno-0-155 name=__codelineno-0-155></a>
</span><span id=__span-0-156><a id=__codelineno-0-156 name=__codelineno-0-156></a>    <span class=k>def</span><span class=w> </span><span class=nf>upload</span><span class=p>(</span>
</span><span id=__span-0-157><a id=__codelineno-0-157 name=__codelineno-0-157></a>        <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-158><a id=__codelineno-0-158 name=__codelineno-0-158></a>        <span class=n>local_path</span><span class=p>:</span> <span class=n>Path</span><span class=p>,</span>
</span><span id=__span-0-159><a id=__codelineno-0-159 name=__codelineno-0-159></a>        <span class=n>metadata</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>EntryMetadata</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-160><a id=__codelineno-0-160 name=__codelineno-0-160></a>        <span class=n>show_progress</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-161><a id=__codelineno-0-161 name=__codelineno-0-161></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>EntryLocation</span><span class=p>:</span>
</span><span id=__span-0-162><a id=__codelineno-0-162 name=__codelineno-0-162></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Upload entry to the registry.</span>
</span><span id=__span-0-163><a id=__codelineno-0-163 name=__codelineno-0-163></a>
</span><span id=__span-0-164><a id=__codelineno-0-164 name=__codelineno-0-164></a><span class=sd>        If metadata is provided it will overwrite the metadata in the directory,</span>
</span><span id=__span-0-165><a id=__codelineno-0-165 name=__codelineno-0-165></a><span class=sd>        otherwise it will use the metadata.json found on the root of the directory.</span>
</span><span id=__span-0-166><a id=__codelineno-0-166 name=__codelineno-0-166></a><span class=sd>        &quot;&quot;&quot;</span>
</span><span id=__span-0-167><a id=__codelineno-0-167 name=__codelineno-0-167></a>        <span class=n>path</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=n>local_path</span><span class=p>)</span><span class=o>.</span><span class=n>absolute</span><span class=p>()</span>
</span><span id=__span-0-168><a id=__codelineno-0-168 name=__codelineno-0-168></a>
</span><span id=__span-0-169><a id=__codelineno-0-169 name=__codelineno-0-169></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>():</span>
</span><span id=__span-0-170><a id=__codelineno-0-170 name=__codelineno-0-170></a>            <span class=c1># try path in local registry if original path not exists</span>
</span><span id=__span-0-171><a id=__codelineno-0-171 name=__codelineno-0-171></a>            <span class=n>path</span> <span class=o>=</span> <span class=n>get_registry_folder</span><span class=p>()</span> <span class=o>/</span> <span class=n>local_path</span>
</span><span id=__span-0-172><a id=__codelineno-0-172 name=__codelineno-0-172></a>
</span><span id=__span-0-173><a id=__codelineno-0-173 name=__codelineno-0-173></a>        <span class=k>if</span> <span class=n>CONFIG</span><span class=o>.</span><span class=n>auth</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-174><a id=__codelineno-0-174 name=__codelineno-0-174></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Please login with `nearai login`&quot;</span><span class=p>)</span>
</span><span id=__span-0-175><a id=__codelineno-0-175 name=__codelineno-0-175></a>            <span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span><span id=__span-0-176><a id=__codelineno-0-176 name=__codelineno-0-176></a>
</span><span id=__span-0-177><a id=__codelineno-0-177 name=__codelineno-0-177></a>        <span class=n>metadata_path</span> <span class=o>=</span> <span class=n>path</span> <span class=o>/</span> <span class=s2>&quot;metadata.json&quot;</span>
</span><span id=__span-0-178><a id=__codelineno-0-178 name=__codelineno-0-178></a>
</span><span id=__span-0-179><a id=__codelineno-0-179 name=__codelineno-0-179></a>        <span class=k>if</span> <span class=n>metadata</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-180><a id=__codelineno-0-180 name=__codelineno-0-180></a>            <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>metadata_path</span><span class=p>,</span> <span class=s2>&quot;w&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-181><a id=__codelineno-0-181 name=__codelineno-0-181></a>                <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>metadata</span><span class=o>.</span><span class=n>model_dump_json</span><span class=p>(</span><span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>))</span>
</span><span id=__span-0-182><a id=__codelineno-0-182 name=__codelineno-0-182></a>
</span><span id=__span-0-183><a id=__codelineno-0-183 name=__codelineno-0-183></a>        <span class=n>check_metadata</span><span class=p>(</span><span class=n>metadata_path</span><span class=p>)</span>
</span><span id=__span-0-184><a id=__codelineno-0-184 name=__codelineno-0-184></a>
</span><span id=__span-0-185><a id=__codelineno-0-185 name=__codelineno-0-185></a>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>metadata_path</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-186><a id=__codelineno-0-186 name=__codelineno-0-186></a>            <span class=n>plain_metadata</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>f</span><span class=p>)</span>
</span><span id=__span-0-187><a id=__codelineno-0-187 name=__codelineno-0-187></a>
</span><span id=__span-0-188><a id=__codelineno-0-188 name=__codelineno-0-188></a>        <span class=n>namespace</span> <span class=o>=</span> <span class=n>get_namespace</span><span class=p>(</span><span class=n>local_path</span><span class=p>)</span>
</span><span id=__span-0-189><a id=__codelineno-0-189 name=__codelineno-0-189></a>        <span class=n>name</span> <span class=o>=</span> <span class=n>plain_metadata</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;name&quot;</span><span class=p>)</span>
</span><span id=__span-0-190><a id=__codelineno-0-190 name=__codelineno-0-190></a>
</span><span id=__span-0-191><a id=__codelineno-0-191 name=__codelineno-0-191></a>        <span class=n>entry_location</span> <span class=o>=</span> <span class=n>EntryLocation</span><span class=o>.</span><span class=n>model_validate</span><span class=p>(</span>
</span><span id=__span-0-192><a id=__codelineno-0-192 name=__codelineno-0-192></a>            <span class=nb>dict</span><span class=p>(</span>
</span><span id=__span-0-193><a id=__codelineno-0-193 name=__codelineno-0-193></a>                <span class=n>namespace</span><span class=o>=</span><span class=n>namespace</span><span class=p>,</span>
</span><span id=__span-0-194><a id=__codelineno-0-194 name=__codelineno-0-194></a>                <span class=n>name</span><span class=o>=</span><span class=n>name</span><span class=p>,</span>
</span><span id=__span-0-195><a id=__codelineno-0-195 name=__codelineno-0-195></a>                <span class=n>version</span><span class=o>=</span><span class=n>plain_metadata</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;version&quot;</span><span class=p>),</span>
</span><span id=__span-0-196><a id=__codelineno-0-196 name=__codelineno-0-196></a>            <span class=p>)</span>
</span><span id=__span-0-197><a id=__codelineno-0-197 name=__codelineno-0-197></a>        <span class=p>)</span>
</span><span id=__span-0-198><a id=__codelineno-0-198 name=__codelineno-0-198></a>
</span><span id=__span-0-199><a id=__codelineno-0-199 name=__codelineno-0-199></a>        <span class=n>entry_metadata</span> <span class=o>=</span> <span class=n>EntryMetadataInput</span><span class=o>.</span><span class=n>model_validate</span><span class=p>(</span><span class=n>plain_metadata</span><span class=p>)</span>
</span><span id=__span-0-200><a id=__codelineno-0-200 name=__codelineno-0-200></a>        <span class=n>source</span> <span class=o>=</span> <span class=n>entry_metadata</span><span class=o>.</span><span class=n>details</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;_source&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
</span><span id=__span-0-201><a id=__codelineno-0-201 name=__codelineno-0-201></a>
</span><span id=__span-0-202><a id=__codelineno-0-202 name=__codelineno-0-202></a>        <span class=k>if</span> <span class=n>source</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-203><a id=__codelineno-0-203 name=__codelineno-0-203></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Only default source is allowed, found: </span><span class=si>{</span><span class=n>source</span><span class=si>}</span><span class=s2>. Remove details._source from metadata.&quot;</span><span class=p>)</span>
</span><span id=__span-0-204><a id=__codelineno-0-204 name=__codelineno-0-204></a>            <span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span><span id=__span-0-205><a id=__codelineno-0-205 name=__codelineno-0-205></a>
</span><span id=__span-0-206><a id=__codelineno-0-206 name=__codelineno-0-206></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=n>entry_location</span><span class=p>)</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-207><a id=__codelineno-0-207 name=__codelineno-0-207></a>            <span class=c1># New entry location. Check for similar names in registry.</span>
</span><span id=__span-0-208><a id=__codelineno-0-208 name=__codelineno-0-208></a>            <span class=n>entries</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>list_all_visible</span><span class=p>()</span>
</span><span id=__span-0-209><a id=__codelineno-0-209 name=__codelineno-0-209></a>            <span class=n>canonical_namespace</span> <span class=o>=</span> <span class=n>get_canonical_name</span><span class=p>(</span><span class=n>namespace</span><span class=p>)</span>
</span><span id=__span-0-210><a id=__codelineno-0-210 name=__codelineno-0-210></a>            <span class=n>canonical_name</span> <span class=o>=</span> <span class=n>get_canonical_name</span><span class=p>(</span><span class=n>name</span><span class=p>)</span>
</span><span id=__span-0-211><a id=__codelineno-0-211 name=__codelineno-0-211></a>
</span><span id=__span-0-212><a id=__codelineno-0-212 name=__codelineno-0-212></a>            <span class=k>for</span> <span class=n>entry</span> <span class=ow>in</span> <span class=n>entries</span><span class=p>:</span>
</span><span id=__span-0-213><a id=__codelineno-0-213 name=__codelineno-0-213></a>                <span class=k>if</span> <span class=n>entry</span><span class=o>.</span><span class=n>name</span> <span class=o>==</span> <span class=n>name</span> <span class=ow>and</span> <span class=n>entry</span><span class=o>.</span><span class=n>namespace</span> <span class=o>==</span> <span class=n>namespace</span><span class=p>:</span>
</span><span id=__span-0-214><a id=__codelineno-0-214 name=__codelineno-0-214></a>                    <span class=k>break</span>
</span><span id=__span-0-215><a id=__codelineno-0-215 name=__codelineno-0-215></a>                <span class=k>if</span> <span class=p>(</span>
</span><span id=__span-0-216><a id=__codelineno-0-216 name=__codelineno-0-216></a>                    <span class=n>get_canonical_name</span><span class=p>(</span><span class=n>entry</span><span class=o>.</span><span class=n>name</span><span class=p>)</span> <span class=o>==</span> <span class=n>canonical_name</span>
</span><span id=__span-0-217><a id=__codelineno-0-217 name=__codelineno-0-217></a>                    <span class=ow>and</span> <span class=n>get_canonical_name</span><span class=p>(</span><span class=n>entry</span><span class=o>.</span><span class=n>namespace</span><span class=p>)</span> <span class=o>==</span> <span class=n>canonical_namespace</span>
</span><span id=__span-0-218><a id=__codelineno-0-218 name=__codelineno-0-218></a>                <span class=p>):</span>
</span><span id=__span-0-219><a id=__codelineno-0-219 name=__codelineno-0-219></a>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;A registry item with a similar name already exists: </span><span class=si>{</span><span class=n>entry</span><span class=o>.</span><span class=n>namespace</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>entry</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-220><a id=__codelineno-0-220 name=__codelineno-0-220></a>                    <span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span><span id=__span-0-221><a id=__codelineno-0-221 name=__codelineno-0-221></a>
</span><span id=__span-0-222><a id=__codelineno-0-222 name=__codelineno-0-222></a>        <span class=n>registry</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>entry_location</span><span class=p>,</span> <span class=n>entry_metadata</span><span class=p>)</span>
</span><span id=__span-0-223><a id=__codelineno-0-223 name=__codelineno-0-223></a>
</span><span id=__span-0-224><a id=__codelineno-0-224 name=__codelineno-0-224></a>        <span class=n>all_files</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-0-225><a id=__codelineno-0-225 name=__codelineno-0-225></a>        <span class=n>total_size</span> <span class=o>=</span> <span class=mi>0</span>
</span><span id=__span-0-226><a id=__codelineno-0-226 name=__codelineno-0-226></a>
</span><span id=__span-0-227><a id=__codelineno-0-227 name=__codelineno-0-227></a>        <span class=c1># Traverse all files in the directory `path`</span>
</span><span id=__span-0-228><a id=__codelineno-0-228 name=__codelineno-0-228></a>        <span class=k>for</span> <span class=n>file</span> <span class=ow>in</span> <span class=n>path</span><span class=o>.</span><span class=n>rglob</span><span class=p>(</span><span class=s2>&quot;*&quot;</span><span class=p>):</span>
</span><span id=__span-0-229><a id=__codelineno-0-229 name=__codelineno-0-229></a>            <span class=k>if</span> <span class=ow>not</span> <span class=n>file</span><span class=o>.</span><span class=n>is_file</span><span class=p>():</span>
</span><span id=__span-0-230><a id=__codelineno-0-230 name=__codelineno-0-230></a>                <span class=k>continue</span>
</span><span id=__span-0-231><a id=__codelineno-0-231 name=__codelineno-0-231></a>
</span><span id=__span-0-232><a id=__codelineno-0-232 name=__codelineno-0-232></a>            <span class=n>relative</span> <span class=o>=</span> <span class=n>file</span><span class=o>.</span><span class=n>relative_to</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
</span><span id=__span-0-233><a id=__codelineno-0-233 name=__codelineno-0-233></a>
</span><span id=__span-0-234><a id=__codelineno-0-234 name=__codelineno-0-234></a>            <span class=c1># Don&#39;t upload metadata file.</span>
</span><span id=__span-0-235><a id=__codelineno-0-235 name=__codelineno-0-235></a>            <span class=k>if</span> <span class=n>file</span> <span class=o>==</span> <span class=n>metadata_path</span><span class=p>:</span>
</span><span id=__span-0-236><a id=__codelineno-0-236 name=__codelineno-0-236></a>                <span class=k>continue</span>
</span><span id=__span-0-237><a id=__codelineno-0-237 name=__codelineno-0-237></a>
</span><span id=__span-0-238><a id=__codelineno-0-238 name=__codelineno-0-238></a>            <span class=c1># Don&#39;t upload backup files.</span>
</span><span id=__span-0-239><a id=__codelineno-0-239 name=__codelineno-0-239></a>            <span class=k>if</span> <span class=n>file</span><span class=o>.</span><span class=n>name</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=s2>&quot;~&quot;</span><span class=p>):</span>
</span><span id=__span-0-240><a id=__codelineno-0-240 name=__codelineno-0-240></a>                <span class=k>continue</span>
</span><span id=__span-0-241><a id=__codelineno-0-241 name=__codelineno-0-241></a>
</span><span id=__span-0-242><a id=__codelineno-0-242 name=__codelineno-0-242></a>            <span class=c1># Don&#39;t upload configuration files.</span>
</span><span id=__span-0-243><a id=__codelineno-0-243 name=__codelineno-0-243></a>            <span class=k>if</span> <span class=n>relative</span><span class=o>.</span><span class=n>parts</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&quot;.nearai&quot;</span><span class=p>:</span>
</span><span id=__span-0-244><a id=__codelineno-0-244 name=__codelineno-0-244></a>                <span class=k>continue</span>
</span><span id=__span-0-245><a id=__codelineno-0-245 name=__codelineno-0-245></a>
</span><span id=__span-0-246><a id=__codelineno-0-246 name=__codelineno-0-246></a>            <span class=n>size</span> <span class=o>=</span> <span class=n>file</span><span class=o>.</span><span class=n>stat</span><span class=p>()</span><span class=o>.</span><span class=n>st_size</span>
</span><span id=__span-0-247><a id=__codelineno-0-247 name=__codelineno-0-247></a>            <span class=n>total_size</span> <span class=o>+=</span> <span class=n>size</span>
</span><span id=__span-0-248><a id=__codelineno-0-248 name=__codelineno-0-248></a>
</span><span id=__span-0-249><a id=__codelineno-0-249 name=__codelineno-0-249></a>            <span class=n>all_files</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>file</span><span class=p>,</span> <span class=n>relative</span><span class=p>,</span> <span class=n>size</span><span class=p>))</span>
</span><span id=__span-0-250><a id=__codelineno-0-250 name=__codelineno-0-250></a>
</span><span id=__span-0-251><a id=__codelineno-0-251 name=__codelineno-0-251></a>        <span class=n>pbar</span> <span class=o>=</span> <span class=n>tqdm</span><span class=p>(</span><span class=n>total</span><span class=o>=</span><span class=n>total_size</span><span class=p>,</span> <span class=n>unit</span><span class=o>=</span><span class=s2>&quot;B&quot;</span><span class=p>,</span> <span class=n>unit_scale</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>disable</span><span class=o>=</span><span class=ow>not</span> <span class=n>show_progress</span><span class=p>)</span>
</span><span id=__span-0-252><a id=__codelineno-0-252 name=__codelineno-0-252></a>        <span class=k>for</span> <span class=n>file</span><span class=p>,</span> <span class=n>relative</span><span class=p>,</span> <span class=n>size</span> <span class=ow>in</span> <span class=n>all_files</span><span class=p>:</span>
</span><span id=__span-0-253><a id=__codelineno-0-253 name=__codelineno-0-253></a>            <span class=k>if</span> <span class=s2>&quot;__pycache__&quot;</span> <span class=ow>in</span> <span class=n>relative</span><span class=o>.</span><span class=n>parts</span><span class=p>:</span>
</span><span id=__span-0-254><a id=__codelineno-0-254 name=__codelineno-0-254></a>                <span class=k>continue</span>
</span><span id=__span-0-255><a id=__codelineno-0-255 name=__codelineno-0-255></a>            <span class=n>registry</span><span class=o>.</span><span class=n>upload_file</span><span class=p>(</span><span class=n>entry_location</span><span class=p>,</span> <span class=n>file</span><span class=p>,</span> <span class=n>relative</span><span class=p>)</span>
</span><span id=__span-0-256><a id=__codelineno-0-256 name=__codelineno-0-256></a>            <span class=n>pbar</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>size</span><span class=p>)</span>
</span><span id=__span-0-257><a id=__codelineno-0-257 name=__codelineno-0-257></a>
</span><span id=__span-0-258><a id=__codelineno-0-258 name=__codelineno-0-258></a>        <span class=k>return</span> <span class=n>entry_location</span>
</span><span id=__span-0-259><a id=__codelineno-0-259 name=__codelineno-0-259></a>
</span><span id=__span-0-260><a id=__codelineno-0-260 name=__codelineno-0-260></a>    <span class=k>def</span><span class=w> </span><span class=nf>list_files</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>entry_location</span><span class=p>:</span> <span class=n>EntryLocation</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
</span><span id=__span-0-261><a id=__codelineno-0-261 name=__codelineno-0-261></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;List files in from an entry in the registry.</span>
</span><span id=__span-0-262><a id=__codelineno-0-262 name=__codelineno-0-262></a>
</span><span id=__span-0-263><a id=__codelineno-0-263 name=__codelineno-0-263></a><span class=sd>        Return the relative paths to all files with respect to the root of the entry.</span>
</span><span id=__span-0-264><a id=__codelineno-0-264 name=__codelineno-0-264></a><span class=sd>        &quot;&quot;&quot;</span>
</span><span id=__span-0-265><a id=__codelineno-0-265 name=__codelineno-0-265></a>        <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>api</span><span class=o>.</span><span class=n>list_files_v1_registry_list_files_post</span><span class=p>(</span>
</span><span id=__span-0-266><a id=__codelineno-0-266 name=__codelineno-0-266></a>            <span class=n>BodyListFilesV1RegistryListFilesPost</span><span class=o>.</span><span class=n>from_dict</span><span class=p>(</span><span class=nb>dict</span><span class=p>(</span><span class=n>entry_location</span><span class=o>=</span><span class=n>entry_location</span><span class=p>))</span>
</span><span id=__span-0-267><a id=__codelineno-0-267 name=__codelineno-0-267></a>        <span class=p>)</span>
</span><span id=__span-0-268><a id=__codelineno-0-268 name=__codelineno-0-268></a>        <span class=k>return</span> <span class=p>[</span><span class=n>file</span><span class=o>.</span><span class=n>filename</span> <span class=k>for</span> <span class=n>file</span> <span class=ow>in</span> <span class=n>result</span><span class=p>]</span>
</span><span id=__span-0-269><a id=__codelineno-0-269 name=__codelineno-0-269></a>
</span><span id=__span-0-270><a id=__codelineno-0-270 name=__codelineno-0-270></a>    <span class=k>def</span><span class=w> </span><span class=nf>list</span><span class=p>(</span>
</span><span id=__span-0-271><a id=__codelineno-0-271 name=__codelineno-0-271></a>        <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-272><a id=__codelineno-0-272 name=__codelineno-0-272></a>        <span class=n>namespace</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-273><a id=__codelineno-0-273 name=__codelineno-0-273></a>        <span class=n>category</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-274><a id=__codelineno-0-274 name=__codelineno-0-274></a>        <span class=n>tags</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-275><a id=__codelineno-0-275 name=__codelineno-0-275></a>        <span class=n>total</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
</span><span id=__span-0-276><a id=__codelineno-0-276 name=__codelineno-0-276></a>        <span class=n>offset</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
</span><span id=__span-0-277><a id=__codelineno-0-277 name=__codelineno-0-277></a>        <span class=n>show_all</span><span class=p>:</span> <span class=nb>bool</span><span class=p>,</span>
</span><span id=__span-0-278><a id=__codelineno-0-278 name=__codelineno-0-278></a>        <span class=n>show_latest_version</span><span class=p>:</span> <span class=nb>bool</span><span class=p>,</span>
</span><span id=__span-0-279><a id=__codelineno-0-279 name=__codelineno-0-279></a>        <span class=n>starred_by</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-280><a id=__codelineno-0-280 name=__codelineno-0-280></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>EntryInformation</span><span class=p>]:</span>
</span><span id=__span-0-281><a id=__codelineno-0-281 name=__codelineno-0-281></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;List and filter entries in the registry.&quot;&quot;&quot;</span>
</span><span id=__span-0-282><a id=__codelineno-0-282 name=__codelineno-0-282></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>api</span><span class=o>.</span><span class=n>list_entries_v1_registry_list_entries_post</span><span class=p>(</span>
</span><span id=__span-0-283><a id=__codelineno-0-283 name=__codelineno-0-283></a>            <span class=n>namespace</span><span class=o>=</span><span class=n>namespace</span><span class=p>,</span>
</span><span id=__span-0-284><a id=__codelineno-0-284 name=__codelineno-0-284></a>            <span class=n>category</span><span class=o>=</span><span class=n>category</span><span class=p>,</span>
</span><span id=__span-0-285><a id=__codelineno-0-285 name=__codelineno-0-285></a>            <span class=n>tags</span><span class=o>=</span><span class=n>tags</span><span class=p>,</span>
</span><span id=__span-0-286><a id=__codelineno-0-286 name=__codelineno-0-286></a>            <span class=n>total</span><span class=o>=</span><span class=n>total</span><span class=p>,</span>
</span><span id=__span-0-287><a id=__codelineno-0-287 name=__codelineno-0-287></a>            <span class=n>offset</span><span class=o>=</span><span class=n>offset</span><span class=p>,</span>
</span><span id=__span-0-288><a id=__codelineno-0-288 name=__codelineno-0-288></a>            <span class=n>show_hidden</span><span class=o>=</span><span class=n>show_all</span><span class=p>,</span>
</span><span id=__span-0-289><a id=__codelineno-0-289 name=__codelineno-0-289></a>            <span class=n>show_latest_version</span><span class=o>=</span><span class=n>show_latest_version</span><span class=p>,</span>
</span><span id=__span-0-290><a id=__codelineno-0-290 name=__codelineno-0-290></a>            <span class=n>starred_by</span><span class=o>=</span><span class=n>starred_by</span><span class=p>,</span>
</span><span id=__span-0-291><a id=__codelineno-0-291 name=__codelineno-0-291></a>        <span class=p>)</span>
</span><span id=__span-0-292><a id=__codelineno-0-292 name=__codelineno-0-292></a>
</span><span id=__span-0-293><a id=__codelineno-0-293 name=__codelineno-0-293></a>    <span class=k>def</span><span class=w> </span><span class=nf>list_all_visible</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>category</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>EntryInformation</span><span class=p>]:</span>
</span><span id=__span-0-294><a id=__codelineno-0-294 name=__codelineno-0-294></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;List all visible entries.&quot;&quot;&quot;</span>
</span><span id=__span-0-295><a id=__codelineno-0-295 name=__codelineno-0-295></a>        <span class=n>total</span> <span class=o>=</span> <span class=mi>10000</span>
</span><span id=__span-0-296><a id=__codelineno-0-296 name=__codelineno-0-296></a>        <span class=n>entries</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>list</span><span class=p>(</span>
</span><span id=__span-0-297><a id=__codelineno-0-297 name=__codelineno-0-297></a>            <span class=n>namespace</span><span class=o>=</span><span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-298><a id=__codelineno-0-298 name=__codelineno-0-298></a>            <span class=n>category</span><span class=o>=</span><span class=n>category</span><span class=p>,</span>
</span><span id=__span-0-299><a id=__codelineno-0-299 name=__codelineno-0-299></a>            <span class=n>tags</span><span class=o>=</span><span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-300><a id=__codelineno-0-300 name=__codelineno-0-300></a>            <span class=n>total</span><span class=o>=</span><span class=n>total</span><span class=p>,</span>
</span><span id=__span-0-301><a id=__codelineno-0-301 name=__codelineno-0-301></a>            <span class=n>offset</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
</span><span id=__span-0-302><a id=__codelineno-0-302 name=__codelineno-0-302></a>            <span class=n>show_all</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-303><a id=__codelineno-0-303 name=__codelineno-0-303></a>            <span class=n>show_latest_version</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-304><a id=__codelineno-0-304 name=__codelineno-0-304></a>        <span class=p>)</span>
</span><span id=__span-0-305><a id=__codelineno-0-305 name=__codelineno-0-305></a>        <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>entries</span><span class=p>)</span> <span class=o>&lt;</span> <span class=n>total</span>
</span><span id=__span-0-306><a id=__codelineno-0-306 name=__codelineno-0-306></a>        <span class=k>return</span> <span class=n>entries</span>
</span><span id=__span-0-307><a id=__codelineno-0-307 name=__codelineno-0-307></a>
</span><span id=__span-0-308><a id=__codelineno-0-308 name=__codelineno-0-308></a>    <span class=k>def</span><span class=w> </span><span class=nf>dict_models</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=n>NamespacedName</span><span class=p>,</span> <span class=n>NamespacedName</span><span class=p>]:</span>
</span><span id=__span-0-309><a id=__codelineno-0-309 name=__codelineno-0-309></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns a mapping canonical-&gt;name.&quot;&quot;&quot;</span>
</span><span id=__span-0-310><a id=__codelineno-0-310 name=__codelineno-0-310></a>        <span class=n>entries</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>list_all_visible</span><span class=p>(</span><span class=n>category</span><span class=o>=</span><span class=s2>&quot;model&quot;</span><span class=p>)</span>
</span><span id=__span-0-311><a id=__codelineno-0-311 name=__codelineno-0-311></a>        <span class=n>result</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=n>NamespacedName</span><span class=p>,</span> <span class=n>NamespacedName</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-0-312><a id=__codelineno-0-312 name=__codelineno-0-312></a>        <span class=k>for</span> <span class=n>entry</span> <span class=ow>in</span> <span class=n>entries</span><span class=p>:</span>
</span><span id=__span-0-313><a id=__codelineno-0-313 name=__codelineno-0-313></a>            <span class=n>namespaced_name</span> <span class=o>=</span> <span class=n>NamespacedName</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=n>entry</span><span class=o>.</span><span class=n>name</span><span class=p>,</span> <span class=n>namespace</span><span class=o>=</span><span class=n>entry</span><span class=o>.</span><span class=n>namespace</span><span class=p>)</span>
</span><span id=__span-0-314><a id=__codelineno-0-314 name=__codelineno-0-314></a>            <span class=n>canonical_namespaced_name</span> <span class=o>=</span> <span class=n>namespaced_name</span><span class=o>.</span><span class=n>canonical</span><span class=p>()</span>
</span><span id=__span-0-315><a id=__codelineno-0-315 name=__codelineno-0-315></a>            <span class=k>if</span> <span class=n>canonical_namespaced_name</span> <span class=ow>in</span> <span class=n>result</span><span class=p>:</span>
</span><span id=__span-0-316><a id=__codelineno-0-316 name=__codelineno-0-316></a>                <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
</span><span id=__span-0-317><a id=__codelineno-0-317 name=__codelineno-0-317></a>                    <span class=sa>f</span><span class=s2>&quot;Duplicate registry entry for model </span><span class=si>{</span><span class=n>namespaced_name</span><span class=si>}</span><span class=s2>, canonical </span><span class=si>{</span><span class=n>canonical_namespaced_name</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-318><a id=__codelineno-0-318 name=__codelineno-0-318></a>                <span class=p>)</span>
</span><span id=__span-0-319><a id=__codelineno-0-319 name=__codelineno-0-319></a>            <span class=n>result</span><span class=p>[</span><span class=n>canonical_namespaced_name</span><span class=p>]</span> <span class=o>=</span> <span class=n>namespaced_name</span>
</span><span id=__span-0-320><a id=__codelineno-0-320 name=__codelineno-0-320></a>        <span class=k>return</span> <span class=n>result</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h5 id=nearai.registry.Registry.__init__ class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">__init__</span> <a href=#nearai.registry.Registry.__init__ class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=fm>__init__</span><span class=p>()</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Create Registry object to interact with the registry programmatically.</p> <details class=quote> <summary>Source code in <code>nearai/registry.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-56>56</a></span>
<span class=normal><a href=#__codelineno-0-57>57</a></span>
<span class=normal><a href=#__codelineno-0-58>58</a></span>
<span class=normal><a href=#__codelineno-0-59>59</a></span>
<span class=normal><a href=#__codelineno-0-60>60</a></span>
<span class=normal><a href=#__codelineno-0-61>61</a></span>
<span class=normal><a href=#__codelineno-0-62>62</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-56><a id=__codelineno-0-56 name=__codelineno-0-56></a><span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-0-57><a id=__codelineno-0-57 name=__codelineno-0-57></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Create Registry object to interact with the registry programmatically.&quot;&quot;&quot;</span>
</span><span id=__span-0-58><a id=__codelineno-0-58 name=__codelineno-0-58></a>    <span class=bp>self</span><span class=o>.</span><span class=n>download_folder</span> <span class=o>=</span> <span class=n>DATA_FOLDER</span> <span class=o>/</span> <span class=s2>&quot;registry&quot;</span>
</span><span id=__span-0-59><a id=__codelineno-0-59 name=__codelineno-0-59></a>    <span class=bp>self</span><span class=o>.</span><span class=n>api</span> <span class=o>=</span> <span class=n>RegistryApi</span><span class=p>()</span>
</span><span id=__span-0-60><a id=__codelineno-0-60 name=__codelineno-0-60></a>
</span><span id=__span-0-61><a id=__codelineno-0-61 name=__codelineno-0-61></a>    <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>download_folder</span><span class=o>.</span><span class=n>exists</span><span class=p>():</span>
</span><span id=__span-0-62><a id=__codelineno-0-62 name=__codelineno-0-62></a>        <span class=bp>self</span><span class=o>.</span><span class=n>download_folder</span><span class=o>.</span><span class=n>mkdir</span><span class=p>(</span><span class=n>parents</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.registry.Registry.dict_models class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">dict_models</span> <a href=#nearai.registry.Registry.dict_models class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>dict_models</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n><span title=typing.Dict>Dict</span></span><span class=p>[</span><span class=n><a class="autorefs autorefs-internal" title=nearai.shared.naming.NamespacedName href=#nearai.shared.naming.NamespacedName>NamespacedName</a></span><span class=p>,</span> <span class=n><a class="autorefs autorefs-internal" title=nearai.shared.naming.NamespacedName href=#nearai.shared.naming.NamespacedName>NamespacedName</a></span><span class=p>]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Returns a mapping canonical-&gt;name.</p> <details class=quote> <summary>Source code in <code>nearai/registry.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-308>308</a></span>
<span class=normal><a href=#__codelineno-0-309>309</a></span>
<span class=normal><a href=#__codelineno-0-310>310</a></span>
<span class=normal><a href=#__codelineno-0-311>311</a></span>
<span class=normal><a href=#__codelineno-0-312>312</a></span>
<span class=normal><a href=#__codelineno-0-313>313</a></span>
<span class=normal><a href=#__codelineno-0-314>314</a></span>
<span class=normal><a href=#__codelineno-0-315>315</a></span>
<span class=normal><a href=#__codelineno-0-316>316</a></span>
<span class=normal><a href=#__codelineno-0-317>317</a></span>
<span class=normal><a href=#__codelineno-0-318>318</a></span>
<span class=normal><a href=#__codelineno-0-319>319</a></span>
<span class=normal><a href=#__codelineno-0-320>320</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-308><a id=__codelineno-0-308 name=__codelineno-0-308></a><span class=k>def</span><span class=w> </span><span class=nf>dict_models</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=n>NamespacedName</span><span class=p>,</span> <span class=n>NamespacedName</span><span class=p>]:</span>
</span><span id=__span-0-309><a id=__codelineno-0-309 name=__codelineno-0-309></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns a mapping canonical-&gt;name.&quot;&quot;&quot;</span>
</span><span id=__span-0-310><a id=__codelineno-0-310 name=__codelineno-0-310></a>    <span class=n>entries</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>list_all_visible</span><span class=p>(</span><span class=n>category</span><span class=o>=</span><span class=s2>&quot;model&quot;</span><span class=p>)</span>
</span><span id=__span-0-311><a id=__codelineno-0-311 name=__codelineno-0-311></a>    <span class=n>result</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=n>NamespacedName</span><span class=p>,</span> <span class=n>NamespacedName</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-0-312><a id=__codelineno-0-312 name=__codelineno-0-312></a>    <span class=k>for</span> <span class=n>entry</span> <span class=ow>in</span> <span class=n>entries</span><span class=p>:</span>
</span><span id=__span-0-313><a id=__codelineno-0-313 name=__codelineno-0-313></a>        <span class=n>namespaced_name</span> <span class=o>=</span> <span class=n>NamespacedName</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=n>entry</span><span class=o>.</span><span class=n>name</span><span class=p>,</span> <span class=n>namespace</span><span class=o>=</span><span class=n>entry</span><span class=o>.</span><span class=n>namespace</span><span class=p>)</span>
</span><span id=__span-0-314><a id=__codelineno-0-314 name=__codelineno-0-314></a>        <span class=n>canonical_namespaced_name</span> <span class=o>=</span> <span class=n>namespaced_name</span><span class=o>.</span><span class=n>canonical</span><span class=p>()</span>
</span><span id=__span-0-315><a id=__codelineno-0-315 name=__codelineno-0-315></a>        <span class=k>if</span> <span class=n>canonical_namespaced_name</span> <span class=ow>in</span> <span class=n>result</span><span class=p>:</span>
</span><span id=__span-0-316><a id=__codelineno-0-316 name=__codelineno-0-316></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
</span><span id=__span-0-317><a id=__codelineno-0-317 name=__codelineno-0-317></a>                <span class=sa>f</span><span class=s2>&quot;Duplicate registry entry for model </span><span class=si>{</span><span class=n>namespaced_name</span><span class=si>}</span><span class=s2>, canonical </span><span class=si>{</span><span class=n>canonical_namespaced_name</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-318><a id=__codelineno-0-318 name=__codelineno-0-318></a>            <span class=p>)</span>
</span><span id=__span-0-319><a id=__codelineno-0-319 name=__codelineno-0-319></a>        <span class=n>result</span><span class=p>[</span><span class=n>canonical_namespaced_name</span><span class=p>]</span> <span class=o>=</span> <span class=n>namespaced_name</span>
</span><span id=__span-0-320><a id=__codelineno-0-320 name=__codelineno-0-320></a>    <span class=k>return</span> <span class=n>result</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.registry.Registry.download class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">download</span> <a href=#nearai.registry.Registry.download class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>download</span><span class=p>(</span><span class=n>entry_location</span><span class=p>:</span> <span class=n><span title=typing.Union>Union</span></span><span class=p>[</span><span class=n>str</span><span class=p>,</span> <span class=n><a class="autorefs autorefs-internal" title=nearai.openapi_client.EntryLocation href=#nearai.EntryLocation>EntryLocation</a></span><span class=p>],</span> <span class=n>force</span><span class=p>:</span> <span class=n>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span> <span class=n>show_progress</span><span class=p>:</span> <span class=n>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span> <span class=n>verbose</span><span class=p>:</span> <span class=n>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=pathlib.Path>Path</span></span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Download entry from the registry locally.</p> <details class=quote> <summary>Source code in <code>nearai/registry.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-116>116</a></span>
<span class=normal><a href=#__codelineno-0-117>117</a></span>
<span class=normal><a href=#__codelineno-0-118>118</a></span>
<span class=normal><a href=#__codelineno-0-119>119</a></span>
<span class=normal><a href=#__codelineno-0-120>120</a></span>
<span class=normal><a href=#__codelineno-0-121>121</a></span>
<span class=normal><a href=#__codelineno-0-122>122</a></span>
<span class=normal><a href=#__codelineno-0-123>123</a></span>
<span class=normal><a href=#__codelineno-0-124>124</a></span>
<span class=normal><a href=#__codelineno-0-125>125</a></span>
<span class=normal><a href=#__codelineno-0-126>126</a></span>
<span class=normal><a href=#__codelineno-0-127>127</a></span>
<span class=normal><a href=#__codelineno-0-128>128</a></span>
<span class=normal><a href=#__codelineno-0-129>129</a></span>
<span class=normal><a href=#__codelineno-0-130>130</a></span>
<span class=normal><a href=#__codelineno-0-131>131</a></span>
<span class=normal><a href=#__codelineno-0-132>132</a></span>
<span class=normal><a href=#__codelineno-0-133>133</a></span>
<span class=normal><a href=#__codelineno-0-134>134</a></span>
<span class=normal><a href=#__codelineno-0-135>135</a></span>
<span class=normal><a href=#__codelineno-0-136>136</a></span>
<span class=normal><a href=#__codelineno-0-137>137</a></span>
<span class=normal><a href=#__codelineno-0-138>138</a></span>
<span class=normal><a href=#__codelineno-0-139>139</a></span>
<span class=normal><a href=#__codelineno-0-140>140</a></span>
<span class=normal><a href=#__codelineno-0-141>141</a></span>
<span class=normal><a href=#__codelineno-0-142>142</a></span>
<span class=normal><a href=#__codelineno-0-143>143</a></span>
<span class=normal><a href=#__codelineno-0-144>144</a></span>
<span class=normal><a href=#__codelineno-0-145>145</a></span>
<span class=normal><a href=#__codelineno-0-146>146</a></span>
<span class=normal><a href=#__codelineno-0-147>147</a></span>
<span class=normal><a href=#__codelineno-0-148>148</a></span>
<span class=normal><a href=#__codelineno-0-149>149</a></span>
<span class=normal><a href=#__codelineno-0-150>150</a></span>
<span class=normal><a href=#__codelineno-0-151>151</a></span>
<span class=normal><a href=#__codelineno-0-152>152</a></span>
<span class=normal><a href=#__codelineno-0-153>153</a></span>
<span class=normal><a href=#__codelineno-0-154>154</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-116><a id=__codelineno-0-116 name=__codelineno-0-116></a><span class=k>def</span><span class=w> </span><span class=nf>download</span><span class=p>(</span>
</span><span id=__span-0-117><a id=__codelineno-0-117 name=__codelineno-0-117></a>    <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-118><a id=__codelineno-0-118 name=__codelineno-0-118></a>    <span class=n>entry_location</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>EntryLocation</span><span class=p>],</span>
</span><span id=__span-0-119><a id=__codelineno-0-119 name=__codelineno-0-119></a>    <span class=n>force</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-120><a id=__codelineno-0-120 name=__codelineno-0-120></a>    <span class=n>show_progress</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-121><a id=__codelineno-0-121 name=__codelineno-0-121></a>    <span class=n>verbose</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-122><a id=__codelineno-0-122 name=__codelineno-0-122></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Path</span><span class=p>:</span>
</span><span id=__span-0-123><a id=__codelineno-0-123 name=__codelineno-0-123></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Download entry from the registry locally.&quot;&quot;&quot;</span>
</span><span id=__span-0-124><a id=__codelineno-0-124 name=__codelineno-0-124></a>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>entry_location</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-125><a id=__codelineno-0-125 name=__codelineno-0-125></a>        <span class=n>entry_location</span> <span class=o>=</span> <span class=n>parse_location</span><span class=p>(</span><span class=n>entry_location</span><span class=p>)</span>
</span><span id=__span-0-126><a id=__codelineno-0-126 name=__codelineno-0-126></a>
</span><span id=__span-0-127><a id=__codelineno-0-127 name=__codelineno-0-127></a>    <span class=n>download_path</span> <span class=o>=</span> <span class=n>get_registry_folder</span><span class=p>()</span> <span class=o>/</span> <span class=n>entry_location</span><span class=o>.</span><span class=n>namespace</span> <span class=o>/</span> <span class=n>entry_location</span><span class=o>.</span><span class=n>name</span> <span class=o>/</span> <span class=n>entry_location</span><span class=o>.</span><span class=n>version</span>
</span><span id=__span-0-128><a id=__codelineno-0-128 name=__codelineno-0-128></a>
</span><span id=__span-0-129><a id=__codelineno-0-129 name=__codelineno-0-129></a>    <span class=k>if</span> <span class=n>download_path</span><span class=o>.</span><span class=n>exists</span><span class=p>():</span>
</span><span id=__span-0-130><a id=__codelineno-0-130 name=__codelineno-0-130></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>force</span><span class=p>:</span>
</span><span id=__span-0-131><a id=__codelineno-0-131 name=__codelineno-0-131></a>            <span class=k>if</span> <span class=n>verbose</span><span class=p>:</span>
</span><span id=__span-0-132><a id=__codelineno-0-132 name=__codelineno-0-132></a>                <span class=nb>print</span><span class=p>(</span>
</span><span id=__span-0-133><a id=__codelineno-0-133 name=__codelineno-0-133></a>                    <span class=sa>f</span><span class=s2>&quot;Entry </span><span class=si>{</span><span class=n>entry_location</span><span class=si>}</span><span class=s2> already exists at </span><span class=si>{</span><span class=n>download_path</span><span class=si>}</span><span class=s2>. Use --force to overwrite the entry.&quot;</span>
</span><span id=__span-0-134><a id=__codelineno-0-134 name=__codelineno-0-134></a>                <span class=p>)</span>
</span><span id=__span-0-135><a id=__codelineno-0-135 name=__codelineno-0-135></a>            <span class=k>return</span> <span class=n>download_path</span>
</span><span id=__span-0-136><a id=__codelineno-0-136 name=__codelineno-0-136></a>
</span><span id=__span-0-137><a id=__codelineno-0-137 name=__codelineno-0-137></a>    <span class=n>files</span> <span class=o>=</span> <span class=n>registry</span><span class=o>.</span><span class=n>list_files</span><span class=p>(</span><span class=n>entry_location</span><span class=p>)</span>
</span><span id=__span-0-138><a id=__codelineno-0-138 name=__codelineno-0-138></a>
</span><span id=__span-0-139><a id=__codelineno-0-139 name=__codelineno-0-139></a>    <span class=n>download_path</span><span class=o>.</span><span class=n>mkdir</span><span class=p>(</span><span class=n>parents</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-140><a id=__codelineno-0-140 name=__codelineno-0-140></a>
</span><span id=__span-0-141><a id=__codelineno-0-141 name=__codelineno-0-141></a>    <span class=n>metadata</span> <span class=o>=</span> <span class=n>registry</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=n>entry_location</span><span class=p>)</span>
</span><span id=__span-0-142><a id=__codelineno-0-142 name=__codelineno-0-142></a>
</span><span id=__span-0-143><a id=__codelineno-0-143 name=__codelineno-0-143></a>    <span class=k>if</span> <span class=n>metadata</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-144><a id=__codelineno-0-144 name=__codelineno-0-144></a>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Entry </span><span class=si>{</span><span class=n>entry_location</span><span class=si>}</span><span class=s2> not found.&quot;</span><span class=p>)</span>
</span><span id=__span-0-145><a id=__codelineno-0-145 name=__codelineno-0-145></a>
</span><span id=__span-0-146><a id=__codelineno-0-146 name=__codelineno-0-146></a>    <span class=n>metadata_path</span> <span class=o>=</span> <span class=n>download_path</span> <span class=o>/</span> <span class=s2>&quot;metadata.json&quot;</span>
</span><span id=__span-0-147><a id=__codelineno-0-147 name=__codelineno-0-147></a>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>metadata_path</span><span class=p>,</span> <span class=s2>&quot;w&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-148><a id=__codelineno-0-148 name=__codelineno-0-148></a>        <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>metadata</span><span class=o>.</span><span class=n>model_dump_json</span><span class=p>(</span><span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>))</span>
</span><span id=__span-0-149><a id=__codelineno-0-149 name=__codelineno-0-149></a>
</span><span id=__span-0-150><a id=__codelineno-0-150 name=__codelineno-0-150></a>    <span class=k>for</span> <span class=n>file</span> <span class=ow>in</span> <span class=p>(</span><span class=n>pbar</span> <span class=o>:=</span> <span class=n>tqdm</span><span class=p>(</span><span class=n>files</span><span class=p>,</span> <span class=n>disable</span><span class=o>=</span><span class=ow>not</span> <span class=n>show_progress</span><span class=p>)):</span>
</span><span id=__span-0-151><a id=__codelineno-0-151 name=__codelineno-0-151></a>        <span class=n>pbar</span><span class=o>.</span><span class=n>set_description</span><span class=p>(</span><span class=n>file</span><span class=p>)</span>
</span><span id=__span-0-152><a id=__codelineno-0-152 name=__codelineno-0-152></a>        <span class=n>registry</span><span class=o>.</span><span class=n>download_file</span><span class=p>(</span><span class=n>entry_location</span><span class=p>,</span> <span class=n>file</span><span class=p>,</span> <span class=n>download_path</span> <span class=o>/</span> <span class=n>file</span><span class=p>)</span>
</span><span id=__span-0-153><a id=__codelineno-0-153 name=__codelineno-0-153></a>
</span><span id=__span-0-154><a id=__codelineno-0-154 name=__codelineno-0-154></a>    <span class=k>return</span> <span class=n>download_path</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.registry.Registry.download_file class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">download_file</span> <a href=#nearai.registry.Registry.download_file class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>download_file</span><span class=p>(</span><span class=n>entry_location</span><span class=p>:</span> <span class=n><a class="autorefs autorefs-internal" title=nearai.openapi_client.EntryLocation href=#nearai.EntryLocation>EntryLocation</a></span><span class=p>,</span> <span class=n>path</span><span class=p>:</span> <span class=n><span title=pathlib.Path>Path</span></span><span class=p>,</span> <span class=n>local_path</span><span class=p>:</span> <span class=n><span title=pathlib.Path>Path</span></span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Download a file from the registry.</p> <details class=quote> <summary>Source code in <code>nearai/registry.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-100>100</a></span>
<span class=normal><a href=#__codelineno-0-101>101</a></span>
<span class=normal><a href=#__codelineno-0-102>102</a></span>
<span class=normal><a href=#__codelineno-0-103>103</a></span>
<span class=normal><a href=#__codelineno-0-104>104</a></span>
<span class=normal><a href=#__codelineno-0-105>105</a></span>
<span class=normal><a href=#__codelineno-0-106>106</a></span>
<span class=normal><a href=#__codelineno-0-107>107</a></span>
<span class=normal><a href=#__codelineno-0-108>108</a></span>
<span class=normal><a href=#__codelineno-0-109>109</a></span>
<span class=normal><a href=#__codelineno-0-110>110</a></span>
<span class=normal><a href=#__codelineno-0-111>111</a></span>
<span class=normal><a href=#__codelineno-0-112>112</a></span>
<span class=normal><a href=#__codelineno-0-113>113</a></span>
<span class=normal><a href=#__codelineno-0-114>114</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-100><a id=__codelineno-0-100 name=__codelineno-0-100></a><span class=k>def</span><span class=w> </span><span class=nf>download_file</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>entry_location</span><span class=p>:</span> <span class=n>EntryLocation</span><span class=p>,</span> <span class=n>path</span><span class=p>:</span> <span class=n>Path</span><span class=p>,</span> <span class=n>local_path</span><span class=p>:</span> <span class=n>Path</span><span class=p>):</span>
</span><span id=__span-0-101><a id=__codelineno-0-101 name=__codelineno-0-101></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Download a file from the registry.&quot;&quot;&quot;</span>
</span><span id=__span-0-102><a id=__codelineno-0-102 name=__codelineno-0-102></a>    <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>api</span><span class=o>.</span><span class=n>download_file_v1_registry_download_file_post_without_preload_content</span><span class=p>(</span>
</span><span id=__span-0-103><a id=__codelineno-0-103 name=__codelineno-0-103></a>        <span class=n>BodyDownloadFileV1RegistryDownloadFilePost</span><span class=o>.</span><span class=n>from_dict</span><span class=p>(</span>
</span><span id=__span-0-104><a id=__codelineno-0-104 name=__codelineno-0-104></a>            <span class=nb>dict</span><span class=p>(</span>
</span><span id=__span-0-105><a id=__codelineno-0-105 name=__codelineno-0-105></a>                <span class=n>entry_location</span><span class=o>=</span><span class=n>entry_location</span><span class=p>,</span>
</span><span id=__span-0-106><a id=__codelineno-0-106 name=__codelineno-0-106></a>                <span class=n>path</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>path</span><span class=p>),</span>
</span><span id=__span-0-107><a id=__codelineno-0-107 name=__codelineno-0-107></a>            <span class=p>)</span>
</span><span id=__span-0-108><a id=__codelineno-0-108 name=__codelineno-0-108></a>        <span class=p>)</span>
</span><span id=__span-0-109><a id=__codelineno-0-109 name=__codelineno-0-109></a>    <span class=p>)</span>
</span><span id=__span-0-110><a id=__codelineno-0-110 name=__codelineno-0-110></a>
</span><span id=__span-0-111><a id=__codelineno-0-111 name=__codelineno-0-111></a>    <span class=n>local_path</span><span class=o>.</span><span class=n>parent</span><span class=o>.</span><span class=n>mkdir</span><span class=p>(</span><span class=n>parents</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-112><a id=__codelineno-0-112 name=__codelineno-0-112></a>
</span><span id=__span-0-113><a id=__codelineno-0-113 name=__codelineno-0-113></a>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>local_path</span><span class=p>,</span> <span class=s2>&quot;wb&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-114><a id=__codelineno-0-114 name=__codelineno-0-114></a>        <span class=n>copyfileobj</span><span class=p>(</span><span class=n>result</span><span class=p>,</span> <span class=n>f</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.registry.Registry.info class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">info</span> <a href=#nearai.registry.Registry.info class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>info</span><span class=p>(</span><span class=n>entry_location</span><span class=p>:</span> <span class=n><a class="autorefs autorefs-internal" title=nearai.openapi_client.EntryLocation href=#nearai.EntryLocation>EntryLocation</a></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n><span title=nearai.openapi_client.EntryMetadata>EntryMetadata</span></span><span class=p>]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Get metadata of a entry in the registry.</p> <details class=quote> <summary>Source code in <code>nearai/registry.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-71>71</a></span>
<span class=normal><a href=#__codelineno-0-72>72</a></span>
<span class=normal><a href=#__codelineno-0-73>73</a></span>
<span class=normal><a href=#__codelineno-0-74>74</a></span>
<span class=normal><a href=#__codelineno-0-75>75</a></span>
<span class=normal><a href=#__codelineno-0-76>76</a></span>
<span class=normal><a href=#__codelineno-0-77>77</a></span>
<span class=normal><a href=#__codelineno-0-78>78</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-71><a id=__codelineno-0-71 name=__codelineno-0-71></a><span class=k>def</span><span class=w> </span><span class=nf>info</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>entry_location</span><span class=p>:</span> <span class=n>EntryLocation</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>EntryMetadata</span><span class=p>]:</span>
</span><span id=__span-0-72><a id=__codelineno-0-72 name=__codelineno-0-72></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Get metadata of a entry in the registry.&quot;&quot;&quot;</span>
</span><span id=__span-0-73><a id=__codelineno-0-73 name=__codelineno-0-73></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-74><a id=__codelineno-0-74 name=__codelineno-0-74></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>api</span><span class=o>.</span><span class=n>download_metadata_v1_registry_download_metadata_post</span><span class=p>(</span>
</span><span id=__span-0-75><a id=__codelineno-0-75 name=__codelineno-0-75></a>            <span class=n>BodyDownloadMetadataV1RegistryDownloadMetadataPost</span><span class=o>.</span><span class=n>from_dict</span><span class=p>(</span><span class=nb>dict</span><span class=p>(</span><span class=n>entry_location</span><span class=o>=</span><span class=n>entry_location</span><span class=p>))</span>
</span><span id=__span-0-76><a id=__codelineno-0-76 name=__codelineno-0-76></a>        <span class=p>)</span>
</span><span id=__span-0-77><a id=__codelineno-0-77 name=__codelineno-0-77></a>    <span class=k>except</span> <span class=n>NotFoundException</span><span class=p>:</span>
</span><span id=__span-0-78><a id=__codelineno-0-78 name=__codelineno-0-78></a>        <span class=k>return</span> <span class=kc>None</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.registry.Registry.list class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">list</span> <a href=#nearai.registry.Registry.list class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nb>list</span><span class=p>(</span><span class=nf>namespace</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>category</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>tags</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>total</span><span class=p>:</span> <span class=n>int</span><span class=p>,</span> <span class=n>offset</span><span class=p>:</span> <span class=n>int</span><span class=p>,</span> <span class=n>show_all</span><span class=p>:</span> <span class=n>bool</span><span class=p>,</span> <span class=n>show_latest_version</span><span class=p>:</span> <span class=n>bool</span><span class=p>,</span> <span class=n>starred_by</span><span class=p>:</span> <span class=n>str</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=typing.List>List</span></span><span class=p>[</span><span class=n><span title=nearai.openapi_client.EntryInformation>EntryInformation</span></span><span class=p>]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>List and filter entries in the registry.</p> <details class=quote> <summary>Source code in <code>nearai/registry.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-270>270</a></span>
<span class=normal><a href=#__codelineno-0-271>271</a></span>
<span class=normal><a href=#__codelineno-0-272>272</a></span>
<span class=normal><a href=#__codelineno-0-273>273</a></span>
<span class=normal><a href=#__codelineno-0-274>274</a></span>
<span class=normal><a href=#__codelineno-0-275>275</a></span>
<span class=normal><a href=#__codelineno-0-276>276</a></span>
<span class=normal><a href=#__codelineno-0-277>277</a></span>
<span class=normal><a href=#__codelineno-0-278>278</a></span>
<span class=normal><a href=#__codelineno-0-279>279</a></span>
<span class=normal><a href=#__codelineno-0-280>280</a></span>
<span class=normal><a href=#__codelineno-0-281>281</a></span>
<span class=normal><a href=#__codelineno-0-282>282</a></span>
<span class=normal><a href=#__codelineno-0-283>283</a></span>
<span class=normal><a href=#__codelineno-0-284>284</a></span>
<span class=normal><a href=#__codelineno-0-285>285</a></span>
<span class=normal><a href=#__codelineno-0-286>286</a></span>
<span class=normal><a href=#__codelineno-0-287>287</a></span>
<span class=normal><a href=#__codelineno-0-288>288</a></span>
<span class=normal><a href=#__codelineno-0-289>289</a></span>
<span class=normal><a href=#__codelineno-0-290>290</a></span>
<span class=normal><a href=#__codelineno-0-291>291</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-270><a id=__codelineno-0-270 name=__codelineno-0-270></a><span class=k>def</span><span class=w> </span><span class=nf>list</span><span class=p>(</span>
</span><span id=__span-0-271><a id=__codelineno-0-271 name=__codelineno-0-271></a>    <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-272><a id=__codelineno-0-272 name=__codelineno-0-272></a>    <span class=n>namespace</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-273><a id=__codelineno-0-273 name=__codelineno-0-273></a>    <span class=n>category</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-274><a id=__codelineno-0-274 name=__codelineno-0-274></a>    <span class=n>tags</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-275><a id=__codelineno-0-275 name=__codelineno-0-275></a>    <span class=n>total</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
</span><span id=__span-0-276><a id=__codelineno-0-276 name=__codelineno-0-276></a>    <span class=n>offset</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
</span><span id=__span-0-277><a id=__codelineno-0-277 name=__codelineno-0-277></a>    <span class=n>show_all</span><span class=p>:</span> <span class=nb>bool</span><span class=p>,</span>
</span><span id=__span-0-278><a id=__codelineno-0-278 name=__codelineno-0-278></a>    <span class=n>show_latest_version</span><span class=p>:</span> <span class=nb>bool</span><span class=p>,</span>
</span><span id=__span-0-279><a id=__codelineno-0-279 name=__codelineno-0-279></a>    <span class=n>starred_by</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-280><a id=__codelineno-0-280 name=__codelineno-0-280></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>EntryInformation</span><span class=p>]:</span>
</span><span id=__span-0-281><a id=__codelineno-0-281 name=__codelineno-0-281></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;List and filter entries in the registry.&quot;&quot;&quot;</span>
</span><span id=__span-0-282><a id=__codelineno-0-282 name=__codelineno-0-282></a>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>api</span><span class=o>.</span><span class=n>list_entries_v1_registry_list_entries_post</span><span class=p>(</span>
</span><span id=__span-0-283><a id=__codelineno-0-283 name=__codelineno-0-283></a>        <span class=n>namespace</span><span class=o>=</span><span class=n>namespace</span><span class=p>,</span>
</span><span id=__span-0-284><a id=__codelineno-0-284 name=__codelineno-0-284></a>        <span class=n>category</span><span class=o>=</span><span class=n>category</span><span class=p>,</span>
</span><span id=__span-0-285><a id=__codelineno-0-285 name=__codelineno-0-285></a>        <span class=n>tags</span><span class=o>=</span><span class=n>tags</span><span class=p>,</span>
</span><span id=__span-0-286><a id=__codelineno-0-286 name=__codelineno-0-286></a>        <span class=n>total</span><span class=o>=</span><span class=n>total</span><span class=p>,</span>
</span><span id=__span-0-287><a id=__codelineno-0-287 name=__codelineno-0-287></a>        <span class=n>offset</span><span class=o>=</span><span class=n>offset</span><span class=p>,</span>
</span><span id=__span-0-288><a id=__codelineno-0-288 name=__codelineno-0-288></a>        <span class=n>show_hidden</span><span class=o>=</span><span class=n>show_all</span><span class=p>,</span>
</span><span id=__span-0-289><a id=__codelineno-0-289 name=__codelineno-0-289></a>        <span class=n>show_latest_version</span><span class=o>=</span><span class=n>show_latest_version</span><span class=p>,</span>
</span><span id=__span-0-290><a id=__codelineno-0-290 name=__codelineno-0-290></a>        <span class=n>starred_by</span><span class=o>=</span><span class=n>starred_by</span><span class=p>,</span>
</span><span id=__span-0-291><a id=__codelineno-0-291 name=__codelineno-0-291></a>    <span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.registry.Registry.list_all_visible class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">list_all_visible</span> <a href=#nearai.registry.Registry.list_all_visible class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>list_all_visible</span><span class=p>(</span><span class=n>category</span><span class=p>:</span> <span class=n>str</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=typing.List>List</span></span><span class=p>[</span><span class=n><span title=nearai.openapi_client.EntryInformation>EntryInformation</span></span><span class=p>]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>List all visible entries.</p> <details class=quote> <summary>Source code in <code>nearai/registry.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-293>293</a></span>
<span class=normal><a href=#__codelineno-0-294>294</a></span>
<span class=normal><a href=#__codelineno-0-295>295</a></span>
<span class=normal><a href=#__codelineno-0-296>296</a></span>
<span class=normal><a href=#__codelineno-0-297>297</a></span>
<span class=normal><a href=#__codelineno-0-298>298</a></span>
<span class=normal><a href=#__codelineno-0-299>299</a></span>
<span class=normal><a href=#__codelineno-0-300>300</a></span>
<span class=normal><a href=#__codelineno-0-301>301</a></span>
<span class=normal><a href=#__codelineno-0-302>302</a></span>
<span class=normal><a href=#__codelineno-0-303>303</a></span>
<span class=normal><a href=#__codelineno-0-304>304</a></span>
<span class=normal><a href=#__codelineno-0-305>305</a></span>
<span class=normal><a href=#__codelineno-0-306>306</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-293><a id=__codelineno-0-293 name=__codelineno-0-293></a><span class=k>def</span><span class=w> </span><span class=nf>list_all_visible</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>category</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>EntryInformation</span><span class=p>]:</span>
</span><span id=__span-0-294><a id=__codelineno-0-294 name=__codelineno-0-294></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;List all visible entries.&quot;&quot;&quot;</span>
</span><span id=__span-0-295><a id=__codelineno-0-295 name=__codelineno-0-295></a>    <span class=n>total</span> <span class=o>=</span> <span class=mi>10000</span>
</span><span id=__span-0-296><a id=__codelineno-0-296 name=__codelineno-0-296></a>    <span class=n>entries</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>list</span><span class=p>(</span>
</span><span id=__span-0-297><a id=__codelineno-0-297 name=__codelineno-0-297></a>        <span class=n>namespace</span><span class=o>=</span><span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-298><a id=__codelineno-0-298 name=__codelineno-0-298></a>        <span class=n>category</span><span class=o>=</span><span class=n>category</span><span class=p>,</span>
</span><span id=__span-0-299><a id=__codelineno-0-299 name=__codelineno-0-299></a>        <span class=n>tags</span><span class=o>=</span><span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-300><a id=__codelineno-0-300 name=__codelineno-0-300></a>        <span class=n>total</span><span class=o>=</span><span class=n>total</span><span class=p>,</span>
</span><span id=__span-0-301><a id=__codelineno-0-301 name=__codelineno-0-301></a>        <span class=n>offset</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
</span><span id=__span-0-302><a id=__codelineno-0-302 name=__codelineno-0-302></a>        <span class=n>show_all</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-303><a id=__codelineno-0-303 name=__codelineno-0-303></a>        <span class=n>show_latest_version</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-304><a id=__codelineno-0-304 name=__codelineno-0-304></a>    <span class=p>)</span>
</span><span id=__span-0-305><a id=__codelineno-0-305 name=__codelineno-0-305></a>    <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>entries</span><span class=p>)</span> <span class=o>&lt;</span> <span class=n>total</span>
</span><span id=__span-0-306><a id=__codelineno-0-306 name=__codelineno-0-306></a>    <span class=k>return</span> <span class=n>entries</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.registry.Registry.list_files class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">list_files</span> <a href=#nearai.registry.Registry.list_files class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>list_files</span><span class=p>(</span><span class=n>entry_location</span><span class=p>:</span> <span class=n><a class="autorefs autorefs-internal" title=nearai.openapi_client.EntryLocation href=#nearai.EntryLocation>EntryLocation</a></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=typing.List>List</span></span><span class=p>[</span><span class=n>str</span><span class=p>]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>List files in from an entry in the registry.</p> <p>Return the relative paths to all files with respect to the root of the entry.</p> <details class=quote> <summary>Source code in <code>nearai/registry.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-260>260</a></span>
<span class=normal><a href=#__codelineno-0-261>261</a></span>
<span class=normal><a href=#__codelineno-0-262>262</a></span>
<span class=normal><a href=#__codelineno-0-263>263</a></span>
<span class=normal><a href=#__codelineno-0-264>264</a></span>
<span class=normal><a href=#__codelineno-0-265>265</a></span>
<span class=normal><a href=#__codelineno-0-266>266</a></span>
<span class=normal><a href=#__codelineno-0-267>267</a></span>
<span class=normal><a href=#__codelineno-0-268>268</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-260><a id=__codelineno-0-260 name=__codelineno-0-260></a><span class=k>def</span><span class=w> </span><span class=nf>list_files</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>entry_location</span><span class=p>:</span> <span class=n>EntryLocation</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
</span><span id=__span-0-261><a id=__codelineno-0-261 name=__codelineno-0-261></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;List files in from an entry in the registry.</span>
</span><span id=__span-0-262><a id=__codelineno-0-262 name=__codelineno-0-262></a>
</span><span id=__span-0-263><a id=__codelineno-0-263 name=__codelineno-0-263></a><span class=sd>    Return the relative paths to all files with respect to the root of the entry.</span>
</span><span id=__span-0-264><a id=__codelineno-0-264 name=__codelineno-0-264></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-265><a id=__codelineno-0-265 name=__codelineno-0-265></a>    <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>api</span><span class=o>.</span><span class=n>list_files_v1_registry_list_files_post</span><span class=p>(</span>
</span><span id=__span-0-266><a id=__codelineno-0-266 name=__codelineno-0-266></a>        <span class=n>BodyListFilesV1RegistryListFilesPost</span><span class=o>.</span><span class=n>from_dict</span><span class=p>(</span><span class=nb>dict</span><span class=p>(</span><span class=n>entry_location</span><span class=o>=</span><span class=n>entry_location</span><span class=p>))</span>
</span><span id=__span-0-267><a id=__codelineno-0-267 name=__codelineno-0-267></a>    <span class=p>)</span>
</span><span id=__span-0-268><a id=__codelineno-0-268 name=__codelineno-0-268></a>    <span class=k>return</span> <span class=p>[</span><span class=n>file</span><span class=o>.</span><span class=n>filename</span> <span class=k>for</span> <span class=n>file</span> <span class=ow>in</span> <span class=n>result</span><span class=p>]</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.registry.Registry.update class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">update</span> <a href=#nearai.registry.Registry.update class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>update</span><span class=p>(</span><span class=n>entry_location</span><span class=p>:</span> <span class=n><a class="autorefs autorefs-internal" title=nearai.openapi_client.EntryLocation href=#nearai.EntryLocation>EntryLocation</a></span><span class=p>,</span> <span class=n>metadata</span><span class=p>:</span> <span class=n><span title=nearai.openapi_client.EntryMetadataInput>EntryMetadataInput</span></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=typing.Dict>Dict</span></span><span class=p>[</span><span class=n>str</span><span class=p>,</span> <span class=n><span title=typing.Any>Any</span></span><span class=p>]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Update metadata of a entry in the registry.</p> <details class=quote> <summary>Source code in <code>nearai/registry.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-64>64</a></span>
<span class=normal><a href=#__codelineno-0-65>65</a></span>
<span class=normal><a href=#__codelineno-0-66>66</a></span>
<span class=normal><a href=#__codelineno-0-67>67</a></span>
<span class=normal><a href=#__codelineno-0-68>68</a></span>
<span class=normal><a href=#__codelineno-0-69>69</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-64><a id=__codelineno-0-64 name=__codelineno-0-64></a><span class=k>def</span><span class=w> </span><span class=nf>update</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>entry_location</span><span class=p>:</span> <span class=n>EntryLocation</span><span class=p>,</span> <span class=n>metadata</span><span class=p>:</span> <span class=n>EntryMetadataInput</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span><span id=__span-0-65><a id=__codelineno-0-65 name=__codelineno-0-65></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Update metadata of a entry in the registry.&quot;&quot;&quot;</span>
</span><span id=__span-0-66><a id=__codelineno-0-66 name=__codelineno-0-66></a>    <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>api</span><span class=o>.</span><span class=n>upload_metadata_v1_registry_upload_metadata_post</span><span class=p>(</span>
</span><span id=__span-0-67><a id=__codelineno-0-67 name=__codelineno-0-67></a>        <span class=n>BodyUploadMetadataV1RegistryUploadMetadataPost</span><span class=p>(</span><span class=n>metadata</span><span class=o>=</span><span class=n>metadata</span><span class=p>,</span> <span class=n>entry_location</span><span class=o>=</span><span class=n>entry_location</span><span class=p>)</span>
</span><span id=__span-0-68><a id=__codelineno-0-68 name=__codelineno-0-68></a>    <span class=p>)</span>
</span><span id=__span-0-69><a id=__codelineno-0-69 name=__codelineno-0-69></a>    <span class=k>return</span> <span class=n>result</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.registry.Registry.upload class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">upload</span> <a href=#nearai.registry.Registry.upload class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>upload</span><span class=p>(</span><span class=n>local_path</span><span class=p>:</span> <span class=n><span title=pathlib.Path>Path</span></span><span class=p>,</span> <span class=n>metadata</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n><span title=nearai.openapi_client.EntryMetadata>EntryMetadata</span></span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>show_progress</span><span class=p>:</span> <span class=n>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><a class="autorefs autorefs-internal" title=nearai.openapi_client.EntryLocation href=#nearai.EntryLocation>EntryLocation</a></span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Upload entry to the registry.</p> <p>If metadata is provided it will overwrite the metadata in the directory, otherwise it will use the metadata.json found on the root of the directory.</p> <details class=quote> <summary>Source code in <code>nearai/registry.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-156>156</a></span>
<span class=normal><a href=#__codelineno-0-157>157</a></span>
<span class=normal><a href=#__codelineno-0-158>158</a></span>
<span class=normal><a href=#__codelineno-0-159>159</a></span>
<span class=normal><a href=#__codelineno-0-160>160</a></span>
<span class=normal><a href=#__codelineno-0-161>161</a></span>
<span class=normal><a href=#__codelineno-0-162>162</a></span>
<span class=normal><a href=#__codelineno-0-163>163</a></span>
<span class=normal><a href=#__codelineno-0-164>164</a></span>
<span class=normal><a href=#__codelineno-0-165>165</a></span>
<span class=normal><a href=#__codelineno-0-166>166</a></span>
<span class=normal><a href=#__codelineno-0-167>167</a></span>
<span class=normal><a href=#__codelineno-0-168>168</a></span>
<span class=normal><a href=#__codelineno-0-169>169</a></span>
<span class=normal><a href=#__codelineno-0-170>170</a></span>
<span class=normal><a href=#__codelineno-0-171>171</a></span>
<span class=normal><a href=#__codelineno-0-172>172</a></span>
<span class=normal><a href=#__codelineno-0-173>173</a></span>
<span class=normal><a href=#__codelineno-0-174>174</a></span>
<span class=normal><a href=#__codelineno-0-175>175</a></span>
<span class=normal><a href=#__codelineno-0-176>176</a></span>
<span class=normal><a href=#__codelineno-0-177>177</a></span>
<span class=normal><a href=#__codelineno-0-178>178</a></span>
<span class=normal><a href=#__codelineno-0-179>179</a></span>
<span class=normal><a href=#__codelineno-0-180>180</a></span>
<span class=normal><a href=#__codelineno-0-181>181</a></span>
<span class=normal><a href=#__codelineno-0-182>182</a></span>
<span class=normal><a href=#__codelineno-0-183>183</a></span>
<span class=normal><a href=#__codelineno-0-184>184</a></span>
<span class=normal><a href=#__codelineno-0-185>185</a></span>
<span class=normal><a href=#__codelineno-0-186>186</a></span>
<span class=normal><a href=#__codelineno-0-187>187</a></span>
<span class=normal><a href=#__codelineno-0-188>188</a></span>
<span class=normal><a href=#__codelineno-0-189>189</a></span>
<span class=normal><a href=#__codelineno-0-190>190</a></span>
<span class=normal><a href=#__codelineno-0-191>191</a></span>
<span class=normal><a href=#__codelineno-0-192>192</a></span>
<span class=normal><a href=#__codelineno-0-193>193</a></span>
<span class=normal><a href=#__codelineno-0-194>194</a></span>
<span class=normal><a href=#__codelineno-0-195>195</a></span>
<span class=normal><a href=#__codelineno-0-196>196</a></span>
<span class=normal><a href=#__codelineno-0-197>197</a></span>
<span class=normal><a href=#__codelineno-0-198>198</a></span>
<span class=normal><a href=#__codelineno-0-199>199</a></span>
<span class=normal><a href=#__codelineno-0-200>200</a></span>
<span class=normal><a href=#__codelineno-0-201>201</a></span>
<span class=normal><a href=#__codelineno-0-202>202</a></span>
<span class=normal><a href=#__codelineno-0-203>203</a></span>
<span class=normal><a href=#__codelineno-0-204>204</a></span>
<span class=normal><a href=#__codelineno-0-205>205</a></span>
<span class=normal><a href=#__codelineno-0-206>206</a></span>
<span class=normal><a href=#__codelineno-0-207>207</a></span>
<span class=normal><a href=#__codelineno-0-208>208</a></span>
<span class=normal><a href=#__codelineno-0-209>209</a></span>
<span class=normal><a href=#__codelineno-0-210>210</a></span>
<span class=normal><a href=#__codelineno-0-211>211</a></span>
<span class=normal><a href=#__codelineno-0-212>212</a></span>
<span class=normal><a href=#__codelineno-0-213>213</a></span>
<span class=normal><a href=#__codelineno-0-214>214</a></span>
<span class=normal><a href=#__codelineno-0-215>215</a></span>
<span class=normal><a href=#__codelineno-0-216>216</a></span>
<span class=normal><a href=#__codelineno-0-217>217</a></span>
<span class=normal><a href=#__codelineno-0-218>218</a></span>
<span class=normal><a href=#__codelineno-0-219>219</a></span>
<span class=normal><a href=#__codelineno-0-220>220</a></span>
<span class=normal><a href=#__codelineno-0-221>221</a></span>
<span class=normal><a href=#__codelineno-0-222>222</a></span>
<span class=normal><a href=#__codelineno-0-223>223</a></span>
<span class=normal><a href=#__codelineno-0-224>224</a></span>
<span class=normal><a href=#__codelineno-0-225>225</a></span>
<span class=normal><a href=#__codelineno-0-226>226</a></span>
<span class=normal><a href=#__codelineno-0-227>227</a></span>
<span class=normal><a href=#__codelineno-0-228>228</a></span>
<span class=normal><a href=#__codelineno-0-229>229</a></span>
<span class=normal><a href=#__codelineno-0-230>230</a></span>
<span class=normal><a href=#__codelineno-0-231>231</a></span>
<span class=normal><a href=#__codelineno-0-232>232</a></span>
<span class=normal><a href=#__codelineno-0-233>233</a></span>
<span class=normal><a href=#__codelineno-0-234>234</a></span>
<span class=normal><a href=#__codelineno-0-235>235</a></span>
<span class=normal><a href=#__codelineno-0-236>236</a></span>
<span class=normal><a href=#__codelineno-0-237>237</a></span>
<span class=normal><a href=#__codelineno-0-238>238</a></span>
<span class=normal><a href=#__codelineno-0-239>239</a></span>
<span class=normal><a href=#__codelineno-0-240>240</a></span>
<span class=normal><a href=#__codelineno-0-241>241</a></span>
<span class=normal><a href=#__codelineno-0-242>242</a></span>
<span class=normal><a href=#__codelineno-0-243>243</a></span>
<span class=normal><a href=#__codelineno-0-244>244</a></span>
<span class=normal><a href=#__codelineno-0-245>245</a></span>
<span class=normal><a href=#__codelineno-0-246>246</a></span>
<span class=normal><a href=#__codelineno-0-247>247</a></span>
<span class=normal><a href=#__codelineno-0-248>248</a></span>
<span class=normal><a href=#__codelineno-0-249>249</a></span>
<span class=normal><a href=#__codelineno-0-250>250</a></span>
<span class=normal><a href=#__codelineno-0-251>251</a></span>
<span class=normal><a href=#__codelineno-0-252>252</a></span>
<span class=normal><a href=#__codelineno-0-253>253</a></span>
<span class=normal><a href=#__codelineno-0-254>254</a></span>
<span class=normal><a href=#__codelineno-0-255>255</a></span>
<span class=normal><a href=#__codelineno-0-256>256</a></span>
<span class=normal><a href=#__codelineno-0-257>257</a></span>
<span class=normal><a href=#__codelineno-0-258>258</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-156><a id=__codelineno-0-156 name=__codelineno-0-156></a><span class=k>def</span><span class=w> </span><span class=nf>upload</span><span class=p>(</span>
</span><span id=__span-0-157><a id=__codelineno-0-157 name=__codelineno-0-157></a>    <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-158><a id=__codelineno-0-158 name=__codelineno-0-158></a>    <span class=n>local_path</span><span class=p>:</span> <span class=n>Path</span><span class=p>,</span>
</span><span id=__span-0-159><a id=__codelineno-0-159 name=__codelineno-0-159></a>    <span class=n>metadata</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>EntryMetadata</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-160><a id=__codelineno-0-160 name=__codelineno-0-160></a>    <span class=n>show_progress</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-161><a id=__codelineno-0-161 name=__codelineno-0-161></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>EntryLocation</span><span class=p>:</span>
</span><span id=__span-0-162><a id=__codelineno-0-162 name=__codelineno-0-162></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Upload entry to the registry.</span>
</span><span id=__span-0-163><a id=__codelineno-0-163 name=__codelineno-0-163></a>
</span><span id=__span-0-164><a id=__codelineno-0-164 name=__codelineno-0-164></a><span class=sd>    If metadata is provided it will overwrite the metadata in the directory,</span>
</span><span id=__span-0-165><a id=__codelineno-0-165 name=__codelineno-0-165></a><span class=sd>    otherwise it will use the metadata.json found on the root of the directory.</span>
</span><span id=__span-0-166><a id=__codelineno-0-166 name=__codelineno-0-166></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-167><a id=__codelineno-0-167 name=__codelineno-0-167></a>    <span class=n>path</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=n>local_path</span><span class=p>)</span><span class=o>.</span><span class=n>absolute</span><span class=p>()</span>
</span><span id=__span-0-168><a id=__codelineno-0-168 name=__codelineno-0-168></a>
</span><span id=__span-0-169><a id=__codelineno-0-169 name=__codelineno-0-169></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>():</span>
</span><span id=__span-0-170><a id=__codelineno-0-170 name=__codelineno-0-170></a>        <span class=c1># try path in local registry if original path not exists</span>
</span><span id=__span-0-171><a id=__codelineno-0-171 name=__codelineno-0-171></a>        <span class=n>path</span> <span class=o>=</span> <span class=n>get_registry_folder</span><span class=p>()</span> <span class=o>/</span> <span class=n>local_path</span>
</span><span id=__span-0-172><a id=__codelineno-0-172 name=__codelineno-0-172></a>
</span><span id=__span-0-173><a id=__codelineno-0-173 name=__codelineno-0-173></a>    <span class=k>if</span> <span class=n>CONFIG</span><span class=o>.</span><span class=n>auth</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-174><a id=__codelineno-0-174 name=__codelineno-0-174></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Please login with `nearai login`&quot;</span><span class=p>)</span>
</span><span id=__span-0-175><a id=__codelineno-0-175 name=__codelineno-0-175></a>        <span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span><span id=__span-0-176><a id=__codelineno-0-176 name=__codelineno-0-176></a>
</span><span id=__span-0-177><a id=__codelineno-0-177 name=__codelineno-0-177></a>    <span class=n>metadata_path</span> <span class=o>=</span> <span class=n>path</span> <span class=o>/</span> <span class=s2>&quot;metadata.json&quot;</span>
</span><span id=__span-0-178><a id=__codelineno-0-178 name=__codelineno-0-178></a>
</span><span id=__span-0-179><a id=__codelineno-0-179 name=__codelineno-0-179></a>    <span class=k>if</span> <span class=n>metadata</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-180><a id=__codelineno-0-180 name=__codelineno-0-180></a>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>metadata_path</span><span class=p>,</span> <span class=s2>&quot;w&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-181><a id=__codelineno-0-181 name=__codelineno-0-181></a>            <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>metadata</span><span class=o>.</span><span class=n>model_dump_json</span><span class=p>(</span><span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>))</span>
</span><span id=__span-0-182><a id=__codelineno-0-182 name=__codelineno-0-182></a>
</span><span id=__span-0-183><a id=__codelineno-0-183 name=__codelineno-0-183></a>    <span class=n>check_metadata</span><span class=p>(</span><span class=n>metadata_path</span><span class=p>)</span>
</span><span id=__span-0-184><a id=__codelineno-0-184 name=__codelineno-0-184></a>
</span><span id=__span-0-185><a id=__codelineno-0-185 name=__codelineno-0-185></a>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>metadata_path</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-186><a id=__codelineno-0-186 name=__codelineno-0-186></a>        <span class=n>plain_metadata</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>f</span><span class=p>)</span>
</span><span id=__span-0-187><a id=__codelineno-0-187 name=__codelineno-0-187></a>
</span><span id=__span-0-188><a id=__codelineno-0-188 name=__codelineno-0-188></a>    <span class=n>namespace</span> <span class=o>=</span> <span class=n>get_namespace</span><span class=p>(</span><span class=n>local_path</span><span class=p>)</span>
</span><span id=__span-0-189><a id=__codelineno-0-189 name=__codelineno-0-189></a>    <span class=n>name</span> <span class=o>=</span> <span class=n>plain_metadata</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;name&quot;</span><span class=p>)</span>
</span><span id=__span-0-190><a id=__codelineno-0-190 name=__codelineno-0-190></a>
</span><span id=__span-0-191><a id=__codelineno-0-191 name=__codelineno-0-191></a>    <span class=n>entry_location</span> <span class=o>=</span> <span class=n>EntryLocation</span><span class=o>.</span><span class=n>model_validate</span><span class=p>(</span>
</span><span id=__span-0-192><a id=__codelineno-0-192 name=__codelineno-0-192></a>        <span class=nb>dict</span><span class=p>(</span>
</span><span id=__span-0-193><a id=__codelineno-0-193 name=__codelineno-0-193></a>            <span class=n>namespace</span><span class=o>=</span><span class=n>namespace</span><span class=p>,</span>
</span><span id=__span-0-194><a id=__codelineno-0-194 name=__codelineno-0-194></a>            <span class=n>name</span><span class=o>=</span><span class=n>name</span><span class=p>,</span>
</span><span id=__span-0-195><a id=__codelineno-0-195 name=__codelineno-0-195></a>            <span class=n>version</span><span class=o>=</span><span class=n>plain_metadata</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=s2>&quot;version&quot;</span><span class=p>),</span>
</span><span id=__span-0-196><a id=__codelineno-0-196 name=__codelineno-0-196></a>        <span class=p>)</span>
</span><span id=__span-0-197><a id=__codelineno-0-197 name=__codelineno-0-197></a>    <span class=p>)</span>
</span><span id=__span-0-198><a id=__codelineno-0-198 name=__codelineno-0-198></a>
</span><span id=__span-0-199><a id=__codelineno-0-199 name=__codelineno-0-199></a>    <span class=n>entry_metadata</span> <span class=o>=</span> <span class=n>EntryMetadataInput</span><span class=o>.</span><span class=n>model_validate</span><span class=p>(</span><span class=n>plain_metadata</span><span class=p>)</span>
</span><span id=__span-0-200><a id=__codelineno-0-200 name=__codelineno-0-200></a>    <span class=n>source</span> <span class=o>=</span> <span class=n>entry_metadata</span><span class=o>.</span><span class=n>details</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;_source&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
</span><span id=__span-0-201><a id=__codelineno-0-201 name=__codelineno-0-201></a>
</span><span id=__span-0-202><a id=__codelineno-0-202 name=__codelineno-0-202></a>    <span class=k>if</span> <span class=n>source</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-203><a id=__codelineno-0-203 name=__codelineno-0-203></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Only default source is allowed, found: </span><span class=si>{</span><span class=n>source</span><span class=si>}</span><span class=s2>. Remove details._source from metadata.&quot;</span><span class=p>)</span>
</span><span id=__span-0-204><a id=__codelineno-0-204 name=__codelineno-0-204></a>        <span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span><span id=__span-0-205><a id=__codelineno-0-205 name=__codelineno-0-205></a>
</span><span id=__span-0-206><a id=__codelineno-0-206 name=__codelineno-0-206></a>    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=n>entry_location</span><span class=p>)</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-207><a id=__codelineno-0-207 name=__codelineno-0-207></a>        <span class=c1># New entry location. Check for similar names in registry.</span>
</span><span id=__span-0-208><a id=__codelineno-0-208 name=__codelineno-0-208></a>        <span class=n>entries</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>list_all_visible</span><span class=p>()</span>
</span><span id=__span-0-209><a id=__codelineno-0-209 name=__codelineno-0-209></a>        <span class=n>canonical_namespace</span> <span class=o>=</span> <span class=n>get_canonical_name</span><span class=p>(</span><span class=n>namespace</span><span class=p>)</span>
</span><span id=__span-0-210><a id=__codelineno-0-210 name=__codelineno-0-210></a>        <span class=n>canonical_name</span> <span class=o>=</span> <span class=n>get_canonical_name</span><span class=p>(</span><span class=n>name</span><span class=p>)</span>
</span><span id=__span-0-211><a id=__codelineno-0-211 name=__codelineno-0-211></a>
</span><span id=__span-0-212><a id=__codelineno-0-212 name=__codelineno-0-212></a>        <span class=k>for</span> <span class=n>entry</span> <span class=ow>in</span> <span class=n>entries</span><span class=p>:</span>
</span><span id=__span-0-213><a id=__codelineno-0-213 name=__codelineno-0-213></a>            <span class=k>if</span> <span class=n>entry</span><span class=o>.</span><span class=n>name</span> <span class=o>==</span> <span class=n>name</span> <span class=ow>and</span> <span class=n>entry</span><span class=o>.</span><span class=n>namespace</span> <span class=o>==</span> <span class=n>namespace</span><span class=p>:</span>
</span><span id=__span-0-214><a id=__codelineno-0-214 name=__codelineno-0-214></a>                <span class=k>break</span>
</span><span id=__span-0-215><a id=__codelineno-0-215 name=__codelineno-0-215></a>            <span class=k>if</span> <span class=p>(</span>
</span><span id=__span-0-216><a id=__codelineno-0-216 name=__codelineno-0-216></a>                <span class=n>get_canonical_name</span><span class=p>(</span><span class=n>entry</span><span class=o>.</span><span class=n>name</span><span class=p>)</span> <span class=o>==</span> <span class=n>canonical_name</span>
</span><span id=__span-0-217><a id=__codelineno-0-217 name=__codelineno-0-217></a>                <span class=ow>and</span> <span class=n>get_canonical_name</span><span class=p>(</span><span class=n>entry</span><span class=o>.</span><span class=n>namespace</span><span class=p>)</span> <span class=o>==</span> <span class=n>canonical_namespace</span>
</span><span id=__span-0-218><a id=__codelineno-0-218 name=__codelineno-0-218></a>            <span class=p>):</span>
</span><span id=__span-0-219><a id=__codelineno-0-219 name=__codelineno-0-219></a>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;A registry item with a similar name already exists: </span><span class=si>{</span><span class=n>entry</span><span class=o>.</span><span class=n>namespace</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>entry</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-220><a id=__codelineno-0-220 name=__codelineno-0-220></a>                <span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span><span id=__span-0-221><a id=__codelineno-0-221 name=__codelineno-0-221></a>
</span><span id=__span-0-222><a id=__codelineno-0-222 name=__codelineno-0-222></a>    <span class=n>registry</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>entry_location</span><span class=p>,</span> <span class=n>entry_metadata</span><span class=p>)</span>
</span><span id=__span-0-223><a id=__codelineno-0-223 name=__codelineno-0-223></a>
</span><span id=__span-0-224><a id=__codelineno-0-224 name=__codelineno-0-224></a>    <span class=n>all_files</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-0-225><a id=__codelineno-0-225 name=__codelineno-0-225></a>    <span class=n>total_size</span> <span class=o>=</span> <span class=mi>0</span>
</span><span id=__span-0-226><a id=__codelineno-0-226 name=__codelineno-0-226></a>
</span><span id=__span-0-227><a id=__codelineno-0-227 name=__codelineno-0-227></a>    <span class=c1># Traverse all files in the directory `path`</span>
</span><span id=__span-0-228><a id=__codelineno-0-228 name=__codelineno-0-228></a>    <span class=k>for</span> <span class=n>file</span> <span class=ow>in</span> <span class=n>path</span><span class=o>.</span><span class=n>rglob</span><span class=p>(</span><span class=s2>&quot;*&quot;</span><span class=p>):</span>
</span><span id=__span-0-229><a id=__codelineno-0-229 name=__codelineno-0-229></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>file</span><span class=o>.</span><span class=n>is_file</span><span class=p>():</span>
</span><span id=__span-0-230><a id=__codelineno-0-230 name=__codelineno-0-230></a>            <span class=k>continue</span>
</span><span id=__span-0-231><a id=__codelineno-0-231 name=__codelineno-0-231></a>
</span><span id=__span-0-232><a id=__codelineno-0-232 name=__codelineno-0-232></a>        <span class=n>relative</span> <span class=o>=</span> <span class=n>file</span><span class=o>.</span><span class=n>relative_to</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
</span><span id=__span-0-233><a id=__codelineno-0-233 name=__codelineno-0-233></a>
</span><span id=__span-0-234><a id=__codelineno-0-234 name=__codelineno-0-234></a>        <span class=c1># Don&#39;t upload metadata file.</span>
</span><span id=__span-0-235><a id=__codelineno-0-235 name=__codelineno-0-235></a>        <span class=k>if</span> <span class=n>file</span> <span class=o>==</span> <span class=n>metadata_path</span><span class=p>:</span>
</span><span id=__span-0-236><a id=__codelineno-0-236 name=__codelineno-0-236></a>            <span class=k>continue</span>
</span><span id=__span-0-237><a id=__codelineno-0-237 name=__codelineno-0-237></a>
</span><span id=__span-0-238><a id=__codelineno-0-238 name=__codelineno-0-238></a>        <span class=c1># Don&#39;t upload backup files.</span>
</span><span id=__span-0-239><a id=__codelineno-0-239 name=__codelineno-0-239></a>        <span class=k>if</span> <span class=n>file</span><span class=o>.</span><span class=n>name</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=s2>&quot;~&quot;</span><span class=p>):</span>
</span><span id=__span-0-240><a id=__codelineno-0-240 name=__codelineno-0-240></a>            <span class=k>continue</span>
</span><span id=__span-0-241><a id=__codelineno-0-241 name=__codelineno-0-241></a>
</span><span id=__span-0-242><a id=__codelineno-0-242 name=__codelineno-0-242></a>        <span class=c1># Don&#39;t upload configuration files.</span>
</span><span id=__span-0-243><a id=__codelineno-0-243 name=__codelineno-0-243></a>        <span class=k>if</span> <span class=n>relative</span><span class=o>.</span><span class=n>parts</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&quot;.nearai&quot;</span><span class=p>:</span>
</span><span id=__span-0-244><a id=__codelineno-0-244 name=__codelineno-0-244></a>            <span class=k>continue</span>
</span><span id=__span-0-245><a id=__codelineno-0-245 name=__codelineno-0-245></a>
</span><span id=__span-0-246><a id=__codelineno-0-246 name=__codelineno-0-246></a>        <span class=n>size</span> <span class=o>=</span> <span class=n>file</span><span class=o>.</span><span class=n>stat</span><span class=p>()</span><span class=o>.</span><span class=n>st_size</span>
</span><span id=__span-0-247><a id=__codelineno-0-247 name=__codelineno-0-247></a>        <span class=n>total_size</span> <span class=o>+=</span> <span class=n>size</span>
</span><span id=__span-0-248><a id=__codelineno-0-248 name=__codelineno-0-248></a>
</span><span id=__span-0-249><a id=__codelineno-0-249 name=__codelineno-0-249></a>        <span class=n>all_files</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>file</span><span class=p>,</span> <span class=n>relative</span><span class=p>,</span> <span class=n>size</span><span class=p>))</span>
</span><span id=__span-0-250><a id=__codelineno-0-250 name=__codelineno-0-250></a>
</span><span id=__span-0-251><a id=__codelineno-0-251 name=__codelineno-0-251></a>    <span class=n>pbar</span> <span class=o>=</span> <span class=n>tqdm</span><span class=p>(</span><span class=n>total</span><span class=o>=</span><span class=n>total_size</span><span class=p>,</span> <span class=n>unit</span><span class=o>=</span><span class=s2>&quot;B&quot;</span><span class=p>,</span> <span class=n>unit_scale</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>disable</span><span class=o>=</span><span class=ow>not</span> <span class=n>show_progress</span><span class=p>)</span>
</span><span id=__span-0-252><a id=__codelineno-0-252 name=__codelineno-0-252></a>    <span class=k>for</span> <span class=n>file</span><span class=p>,</span> <span class=n>relative</span><span class=p>,</span> <span class=n>size</span> <span class=ow>in</span> <span class=n>all_files</span><span class=p>:</span>
</span><span id=__span-0-253><a id=__codelineno-0-253 name=__codelineno-0-253></a>        <span class=k>if</span> <span class=s2>&quot;__pycache__&quot;</span> <span class=ow>in</span> <span class=n>relative</span><span class=o>.</span><span class=n>parts</span><span class=p>:</span>
</span><span id=__span-0-254><a id=__codelineno-0-254 name=__codelineno-0-254></a>            <span class=k>continue</span>
</span><span id=__span-0-255><a id=__codelineno-0-255 name=__codelineno-0-255></a>        <span class=n>registry</span><span class=o>.</span><span class=n>upload_file</span><span class=p>(</span><span class=n>entry_location</span><span class=p>,</span> <span class=n>file</span><span class=p>,</span> <span class=n>relative</span><span class=p>)</span>
</span><span id=__span-0-256><a id=__codelineno-0-256 name=__codelineno-0-256></a>        <span class=n>pbar</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>size</span><span class=p>)</span>
</span><span id=__span-0-257><a id=__codelineno-0-257 name=__codelineno-0-257></a>
</span><span id=__span-0-258><a id=__codelineno-0-258 name=__codelineno-0-258></a>    <span class=k>return</span> <span class=n>entry_location</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.registry.Registry.upload_file class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">upload_file</span> <a href=#nearai.registry.Registry.upload_file class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>upload_file</span><span class=p>(</span><span class=n>entry_location</span><span class=p>:</span> <span class=n><a class="autorefs autorefs-internal" title=nearai.openapi_client.EntryLocation href=#nearai.EntryLocation>EntryLocation</a></span><span class=p>,</span> <span class=n>local_path</span><span class=p>:</span> <span class=n><span title=pathlib.Path>Path</span></span><span class=p>,</span> <span class=n>path</span><span class=p>:</span> <span class=n><span title=pathlib.Path>Path</span></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>bool</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Upload a file to the registry.</p> <details class=quote> <summary>Source code in <code>nearai/registry.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-80>80</a></span>
<span class=normal><a href=#__codelineno-0-81>81</a></span>
<span class=normal><a href=#__codelineno-0-82>82</a></span>
<span class=normal><a href=#__codelineno-0-83>83</a></span>
<span class=normal><a href=#__codelineno-0-84>84</a></span>
<span class=normal><a href=#__codelineno-0-85>85</a></span>
<span class=normal><a href=#__codelineno-0-86>86</a></span>
<span class=normal><a href=#__codelineno-0-87>87</a></span>
<span class=normal><a href=#__codelineno-0-88>88</a></span>
<span class=normal><a href=#__codelineno-0-89>89</a></span>
<span class=normal><a href=#__codelineno-0-90>90</a></span>
<span class=normal><a href=#__codelineno-0-91>91</a></span>
<span class=normal><a href=#__codelineno-0-92>92</a></span>
<span class=normal><a href=#__codelineno-0-93>93</a></span>
<span class=normal><a href=#__codelineno-0-94>94</a></span>
<span class=normal><a href=#__codelineno-0-95>95</a></span>
<span class=normal><a href=#__codelineno-0-96>96</a></span>
<span class=normal><a href=#__codelineno-0-97>97</a></span>
<span class=normal><a href=#__codelineno-0-98>98</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-80><a id=__codelineno-0-80 name=__codelineno-0-80></a><span class=k>def</span><span class=w> </span><span class=nf>upload_file</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>entry_location</span><span class=p>:</span> <span class=n>EntryLocation</span><span class=p>,</span> <span class=n>local_path</span><span class=p>:</span> <span class=n>Path</span><span class=p>,</span> <span class=n>path</span><span class=p>:</span> <span class=n>Path</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span><span id=__span-0-81><a id=__codelineno-0-81 name=__codelineno-0-81></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Upload a file to the registry.&quot;&quot;&quot;</span>
</span><span id=__span-0-82><a id=__codelineno-0-82 name=__codelineno-0-82></a>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>local_path</span><span class=p>,</span> <span class=s2>&quot;rb&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>file</span><span class=p>:</span>
</span><span id=__span-0-83><a id=__codelineno-0-83 name=__codelineno-0-83></a>        <span class=n>data</span> <span class=o>=</span> <span class=n>file</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span><span id=__span-0-84><a id=__codelineno-0-84 name=__codelineno-0-84></a>
</span><span id=__span-0-85><a id=__codelineno-0-85 name=__codelineno-0-85></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-86><a id=__codelineno-0-86 name=__codelineno-0-86></a>            <span class=bp>self</span><span class=o>.</span><span class=n>api</span><span class=o>.</span><span class=n>upload_file_v1_registry_upload_file_post</span><span class=p>(</span>
</span><span id=__span-0-87><a id=__codelineno-0-87 name=__codelineno-0-87></a>                <span class=n>path</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>path</span><span class=p>),</span>
</span><span id=__span-0-88><a id=__codelineno-0-88 name=__codelineno-0-88></a>                <span class=n>file</span><span class=o>=</span><span class=n>data</span><span class=p>,</span>
</span><span id=__span-0-89><a id=__codelineno-0-89 name=__codelineno-0-89></a>                <span class=n>namespace</span><span class=o>=</span><span class=n>entry_location</span><span class=o>.</span><span class=n>namespace</span><span class=p>,</span>
</span><span id=__span-0-90><a id=__codelineno-0-90 name=__codelineno-0-90></a>                <span class=n>name</span><span class=o>=</span><span class=n>entry_location</span><span class=o>.</span><span class=n>name</span><span class=p>,</span>
</span><span id=__span-0-91><a id=__codelineno-0-91 name=__codelineno-0-91></a>                <span class=n>version</span><span class=o>=</span><span class=n>entry_location</span><span class=o>.</span><span class=n>version</span><span class=p>,</span>
</span><span id=__span-0-92><a id=__codelineno-0-92 name=__codelineno-0-92></a>            <span class=p>)</span>
</span><span id=__span-0-93><a id=__codelineno-0-93 name=__codelineno-0-93></a>            <span class=k>return</span> <span class=kc>True</span>
</span><span id=__span-0-94><a id=__codelineno-0-94 name=__codelineno-0-94></a>        <span class=k>except</span> <span class=n>BadRequestException</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-95><a id=__codelineno-0-95 name=__codelineno-0-95></a>            <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>e</span><span class=o>.</span><span class=n>body</span><span class=p>,</span> <span class=nb>str</span><span class=p>)</span> <span class=ow>and</span> <span class=s2>&quot;already exists&quot;</span> <span class=ow>in</span> <span class=n>e</span><span class=o>.</span><span class=n>body</span><span class=p>:</span>
</span><span id=__span-0-96><a id=__codelineno-0-96 name=__codelineno-0-96></a>                <span class=k>return</span> <span class=kc>False</span>
</span><span id=__span-0-97><a id=__codelineno-0-97 name=__codelineno-0-97></a>
</span><span id=__span-0-98><a id=__codelineno-0-98 name=__codelineno-0-98></a>            <span class=k>raise</span> <span class=n>e</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-function"> <h4 id=nearai.registry.get_namespace class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_namespace</span> <a href=#nearai.registry.get_namespace class=headerlink title="Permanent link">&para;</a></h4> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>get_namespace</span><span class=p>(</span><span class=n>local_path</span><span class=p>:</span> <span class=n><span title=pathlib.Path>Path</span></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>str</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Returns namespace of an item or user namespace.</p> <details class=quote> <summary>Source code in <code>nearai/registry.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-32>32</a></span>
<span class=normal><a href=#__codelineno-0-33>33</a></span>
<span class=normal><a href=#__codelineno-0-34>34</a></span>
<span class=normal><a href=#__codelineno-0-35>35</a></span>
<span class=normal><a href=#__codelineno-0-36>36</a></span>
<span class=normal><a href=#__codelineno-0-37>37</a></span>
<span class=normal><a href=#__codelineno-0-38>38</a></span>
<span class=normal><a href=#__codelineno-0-39>39</a></span>
<span class=normal><a href=#__codelineno-0-40>40</a></span>
<span class=normal><a href=#__codelineno-0-41>41</a></span>
<span class=normal><a href=#__codelineno-0-42>42</a></span>
<span class=normal><a href=#__codelineno-0-43>43</a></span>
<span class=normal><a href=#__codelineno-0-44>44</a></span>
<span class=normal><a href=#__codelineno-0-45>45</a></span>
<span class=normal><a href=#__codelineno-0-46>46</a></span>
<span class=normal><a href=#__codelineno-0-47>47</a></span>
<span class=normal><a href=#__codelineno-0-48>48</a></span>
<span class=normal><a href=#__codelineno-0-49>49</a></span>
<span class=normal><a href=#__codelineno-0-50>50</a></span>
<span class=normal><a href=#__codelineno-0-51>51</a></span>
<span class=normal><a href=#__codelineno-0-52>52</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-32><a id=__codelineno-0-32 name=__codelineno-0-32></a><span class=k>def</span><span class=w> </span><span class=nf>get_namespace</span><span class=p>(</span><span class=n>local_path</span><span class=p>:</span> <span class=n>Path</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-0-33><a id=__codelineno-0-33 name=__codelineno-0-33></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns namespace of an item or user namespace.&quot;&quot;&quot;</span>
</span><span id=__span-0-34><a id=__codelineno-0-34 name=__codelineno-0-34></a>    <span class=n>registry_folder</span> <span class=o>=</span> <span class=n>get_registry_folder</span><span class=p>()</span>
</span><span id=__span-0-35><a id=__codelineno-0-35 name=__codelineno-0-35></a>
</span><span id=__span-0-36><a id=__codelineno-0-36 name=__codelineno-0-36></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-37><a id=__codelineno-0-37 name=__codelineno-0-37></a>        <span class=c1># Check if the path matches the expected structure</span>
</span><span id=__span-0-38><a id=__codelineno-0-38 name=__codelineno-0-38></a>        <span class=n>relative_path</span> <span class=o>=</span> <span class=n>local_path</span><span class=o>.</span><span class=n>relative_to</span><span class=p>(</span><span class=n>registry_folder</span><span class=p>)</span>
</span><span id=__span-0-39><a id=__codelineno-0-39 name=__codelineno-0-39></a>        <span class=n>parts</span> <span class=o>=</span> <span class=n>relative_path</span><span class=o>.</span><span class=n>parts</span>
</span><span id=__span-0-40><a id=__codelineno-0-40 name=__codelineno-0-40></a>
</span><span id=__span-0-41><a id=__codelineno-0-41 name=__codelineno-0-41></a>        <span class=c1># If the path has 3 parts (namespace, item_name, version),</span>
</span><span id=__span-0-42><a id=__codelineno-0-42 name=__codelineno-0-42></a>        <span class=c1># return the first part as the namespace</span>
</span><span id=__span-0-43><a id=__codelineno-0-43 name=__codelineno-0-43></a>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>parts</span><span class=p>)</span> <span class=o>==</span> <span class=mi>3</span><span class=p>:</span>
</span><span id=__span-0-44><a id=__codelineno-0-44 name=__codelineno-0-44></a>            <span class=k>return</span> <span class=nb>str</span><span class=p>(</span><span class=n>parts</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span><span id=__span-0-45><a id=__codelineno-0-45 name=__codelineno-0-45></a>    <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
</span><span id=__span-0-46><a id=__codelineno-0-46 name=__codelineno-0-46></a>        <span class=c1># relative_to() raises ValueError if local_path is not relative to registry_folder</span>
</span><span id=__span-0-47><a id=__codelineno-0-47 name=__codelineno-0-47></a>        <span class=k>pass</span>
</span><span id=__span-0-48><a id=__codelineno-0-48 name=__codelineno-0-48></a>
</span><span id=__span-0-49><a id=__codelineno-0-49 name=__codelineno-0-49></a>    <span class=c1># If we couldn&#39;t extract a namespace from the path, return the default</span>
</span><span id=__span-0-50><a id=__codelineno-0-50 name=__codelineno-0-50></a>    <span class=k>if</span> <span class=n>CONFIG</span><span class=o>.</span><span class=n>auth</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-51><a id=__codelineno-0-51 name=__codelineno-0-51></a>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;AuthData is None&quot;</span><span class=p>)</span>
</span><span id=__span-0-52><a id=__codelineno-0-52 name=__codelineno-0-52></a>    <span class=k>return</span> <span class=n>CONFIG</span><span class=o>.</span><span class=n>auth</span><span class=o>.</span><span class=n>namespace</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h4 id=nearai.registry.get_registry_folder class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_registry_folder</span> <a href=#nearai.registry.get_registry_folder class=headerlink title="Permanent link">&para;</a></h4> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>get_registry_folder</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n><span title=pathlib.Path>Path</span></span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Path to local registry.</p> <details class=quote> <summary>Source code in <code>nearai/registry.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-27>27</a></span>
<span class=normal><a href=#__codelineno-0-28>28</a></span>
<span class=normal><a href=#__codelineno-0-29>29</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-27><a id=__codelineno-0-27 name=__codelineno-0-27></a><span class=k>def</span><span class=w> </span><span class=nf>get_registry_folder</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n>Path</span><span class=p>:</span>
</span><span id=__span-0-28><a id=__codelineno-0-28 name=__codelineno-0-28></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Path to local registry.&quot;&quot;&quot;</span>
</span><span id=__span-0-29><a id=__codelineno-0-29 name=__codelineno-0-29></a>    <span class=k>return</span> <span class=n>DATA_FOLDER</span> <span class=o>/</span> <span class=n>REGISTRY_FOLDER</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-module"> <h3 id=nearai.shared class="doc doc-heading"> <span class="doc doc-object-name doc-module-name">shared</span> <a href=#nearai.shared class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <div class="doc doc-children"> <div class="doc doc-object doc-module"> <h4 id=nearai.shared.auth_data class="doc doc-heading"> <span class="doc doc-object-name doc-module-name">auth_data</span> <a href=#nearai.shared.auth_data class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h5 id=nearai.shared.auth_data.AuthData class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">AuthData</span> <a href=#nearai.shared.auth_data.AuthData class=headerlink title="Permanent link">&para;</a></h5> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=pydantic.BaseModel>BaseModel</span></code></p> <details class=quote> <summary>Source code in <code>nearai/shared/auth_data.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-7> 7</a></span>
<span class=normal><a href=#__codelineno-0-8> 8</a></span>
<span class=normal><a href=#__codelineno-0-9> 9</a></span>
<span class=normal><a href=#__codelineno-0-10>10</a></span>
<span class=normal><a href=#__codelineno-0-11>11</a></span>
<span class=normal><a href=#__codelineno-0-12>12</a></span>
<span class=normal><a href=#__codelineno-0-13>13</a></span>
<span class=normal><a href=#__codelineno-0-14>14</a></span>
<span class=normal><a href=#__codelineno-0-15>15</a></span>
<span class=normal><a href=#__codelineno-0-16>16</a></span>
<span class=normal><a href=#__codelineno-0-17>17</a></span>
<span class=normal><a href=#__codelineno-0-18>18</a></span>
<span class=normal><a href=#__codelineno-0-19>19</a></span>
<span class=normal><a href=#__codelineno-0-20>20</a></span>
<span class=normal><a href=#__codelineno-0-21>21</a></span>
<span class=normal><a href=#__codelineno-0-22>22</a></span>
<span class=normal><a href=#__codelineno-0-23>23</a></span>
<span class=normal><a href=#__codelineno-0-24>24</a></span>
<span class=normal><a href=#__codelineno-0-25>25</a></span>
<span class=normal><a href=#__codelineno-0-26>26</a></span>
<span class=normal><a href=#__codelineno-0-27>27</a></span>
<span class=normal><a href=#__codelineno-0-28>28</a></span>
<span class=normal><a href=#__codelineno-0-29>29</a></span>
<span class=normal><a href=#__codelineno-0-30>30</a></span>
<span class=normal><a href=#__codelineno-0-31>31</a></span>
<span class=normal><a href=#__codelineno-0-32>32</a></span>
<span class=normal><a href=#__codelineno-0-33>33</a></span>
<span class=normal><a href=#__codelineno-0-34>34</a></span>
<span class=normal><a href=#__codelineno-0-35>35</a></span>
<span class=normal><a href=#__codelineno-0-36>36</a></span>
<span class=normal><a href=#__codelineno-0-37>37</a></span>
<span class=normal><a href=#__codelineno-0-38>38</a></span>
<span class=normal><a href=#__codelineno-0-39>39</a></span>
<span class=normal><a href=#__codelineno-0-40>40</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7></a><span class=k>class</span><span class=w> </span><span class=nc>AuthData</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8></a>    <span class=n>account_id</span><span class=p>:</span> <span class=nb>str</span>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9></a>    <span class=n>signature</span><span class=p>:</span> <span class=nb>str</span>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10></a>    <span class=n>public_key</span><span class=p>:</span> <span class=nb>str</span>
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11></a>    <span class=n>callback_url</span><span class=p>:</span> <span class=nb>str</span>
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12></a>    <span class=n>nonce</span><span class=p>:</span> <span class=nb>str</span>
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13></a>    <span class=n>recipient</span><span class=p>:</span> <span class=nb>str</span>
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14></a>    <span class=n>message</span><span class=p>:</span> <span class=nb>str</span>
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15></a>    <span class=n>on_behalf_of</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-16><a id=__codelineno-0-16 name=__codelineno-0-16></a>
</span><span id=__span-0-17><a id=__codelineno-0-17 name=__codelineno-0-17></a>    <span class=k>def</span><span class=w> </span><span class=nf>generate_bearer_token</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-0-18><a id=__codelineno-0-18 name=__codelineno-0-18></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Generates a JSON-encoded bearer token containing authentication data.&quot;&quot;&quot;</span>
</span><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19></a>        <span class=n>required_keys</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;account_id&quot;</span><span class=p>,</span> <span class=s2>&quot;public_key&quot;</span><span class=p>,</span> <span class=s2>&quot;signature&quot;</span><span class=p>,</span> <span class=s2>&quot;callback_url&quot;</span><span class=p>,</span> <span class=s2>&quot;message&quot;</span><span class=p>,</span> <span class=s2>&quot;nonce&quot;</span><span class=p>,</span> <span class=s2>&quot;recipient&quot;</span><span class=p>}</span>
</span><span id=__span-0-20><a id=__codelineno-0-20 name=__codelineno-0-20></a>
</span><span id=__span-0-21><a id=__codelineno-0-21 name=__codelineno-0-21></a>        <span class=k>for</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>required_keys</span><span class=p>:</span>
</span><span id=__span-0-22><a id=__codelineno-0-22 name=__codelineno-0-22></a>            <span class=k>if</span> <span class=nb>getattr</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-23><a id=__codelineno-0-23 name=__codelineno-0-23></a>                <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Missing required auth data: </span><span class=si>{</span><span class=n>key</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-24><a id=__codelineno-0-24 name=__codelineno-0-24></a>
</span><span id=__span-0-25><a id=__codelineno-0-25 name=__codelineno-0-25></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>on_behalf_of</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-26><a id=__codelineno-0-26 name=__codelineno-0-26></a>            <span class=n>required_keys</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=s2>&quot;on_behalf_of&quot;</span><span class=p>)</span>
</span><span id=__span-0-27><a id=__codelineno-0-27 name=__codelineno-0-27></a>
</span><span id=__span-0-28><a id=__codelineno-0-28 name=__codelineno-0-28></a>        <span class=n>bearer_data</span> <span class=o>=</span> <span class=p>{</span><span class=n>key</span><span class=p>:</span> <span class=nb>getattr</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span> <span class=k>for</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>required_keys</span><span class=p>}</span>
</span><span id=__span-0-29><a id=__codelineno-0-29 name=__codelineno-0-29></a>
</span><span id=__span-0-30><a id=__codelineno-0-30 name=__codelineno-0-30></a>        <span class=k>return</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>bearer_data</span><span class=p>)</span>
</span><span id=__span-0-31><a id=__codelineno-0-31 name=__codelineno-0-31></a>
</span><span id=__span-0-32><a id=__codelineno-0-32 name=__codelineno-0-32></a>    <span class=nd>@property</span>
</span><span id=__span-0-33><a id=__codelineno-0-33 name=__codelineno-0-33></a>    <span class=k>def</span><span class=w> </span><span class=nf>namespace</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-0-34><a id=__codelineno-0-34 name=__codelineno-0-34></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Get the account ID for the auth data.</span>
</span><span id=__span-0-35><a id=__codelineno-0-35 name=__codelineno-0-35></a>
</span><span id=__span-0-36><a id=__codelineno-0-36 name=__codelineno-0-36></a><span class=sd>        In case you are running a request on behalf of another account, this will return the account ID of the account.</span>
</span><span id=__span-0-37><a id=__codelineno-0-37 name=__codelineno-0-37></a><span class=sd>        &quot;&quot;&quot;</span>
</span><span id=__span-0-38><a id=__codelineno-0-38 name=__codelineno-0-38></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>on_behalf_of</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-39><a id=__codelineno-0-39 name=__codelineno-0-39></a>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>on_behalf_of</span>
</span><span id=__span-0-40><a id=__codelineno-0-40 name=__codelineno-0-40></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>account_id</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-attribute"> <h6 id=nearai.shared.auth_data.AuthData.namespace class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">namespace</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> <a href=#nearai.shared.auth_data.AuthData.namespace class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=n>namespace</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Get the account ID for the auth data.</p> <p>In case you are running a request on behalf of another account, this will return the account ID of the account.</p> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.auth_data.AuthData.generate_bearer_token class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">generate_bearer_token</span> <a href=#nearai.shared.auth_data.AuthData.generate_bearer_token class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>generate_bearer_token</span><span class=p>()</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Generates a JSON-encoded bearer token containing authentication data.</p> <details class=quote> <summary>Source code in <code>nearai/shared/auth_data.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-17>17</a></span>
<span class=normal><a href=#__codelineno-0-18>18</a></span>
<span class=normal><a href=#__codelineno-0-19>19</a></span>
<span class=normal><a href=#__codelineno-0-20>20</a></span>
<span class=normal><a href=#__codelineno-0-21>21</a></span>
<span class=normal><a href=#__codelineno-0-22>22</a></span>
<span class=normal><a href=#__codelineno-0-23>23</a></span>
<span class=normal><a href=#__codelineno-0-24>24</a></span>
<span class=normal><a href=#__codelineno-0-25>25</a></span>
<span class=normal><a href=#__codelineno-0-26>26</a></span>
<span class=normal><a href=#__codelineno-0-27>27</a></span>
<span class=normal><a href=#__codelineno-0-28>28</a></span>
<span class=normal><a href=#__codelineno-0-29>29</a></span>
<span class=normal><a href=#__codelineno-0-30>30</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-17><a id=__codelineno-0-17 name=__codelineno-0-17></a><span class=k>def</span><span class=w> </span><span class=nf>generate_bearer_token</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-0-18><a id=__codelineno-0-18 name=__codelineno-0-18></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Generates a JSON-encoded bearer token containing authentication data.&quot;&quot;&quot;</span>
</span><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19></a>    <span class=n>required_keys</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;account_id&quot;</span><span class=p>,</span> <span class=s2>&quot;public_key&quot;</span><span class=p>,</span> <span class=s2>&quot;signature&quot;</span><span class=p>,</span> <span class=s2>&quot;callback_url&quot;</span><span class=p>,</span> <span class=s2>&quot;message&quot;</span><span class=p>,</span> <span class=s2>&quot;nonce&quot;</span><span class=p>,</span> <span class=s2>&quot;recipient&quot;</span><span class=p>}</span>
</span><span id=__span-0-20><a id=__codelineno-0-20 name=__codelineno-0-20></a>
</span><span id=__span-0-21><a id=__codelineno-0-21 name=__codelineno-0-21></a>    <span class=k>for</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>required_keys</span><span class=p>:</span>
</span><span id=__span-0-22><a id=__codelineno-0-22 name=__codelineno-0-22></a>        <span class=k>if</span> <span class=nb>getattr</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-23><a id=__codelineno-0-23 name=__codelineno-0-23></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Missing required auth data: </span><span class=si>{</span><span class=n>key</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-24><a id=__codelineno-0-24 name=__codelineno-0-24></a>
</span><span id=__span-0-25><a id=__codelineno-0-25 name=__codelineno-0-25></a>    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>on_behalf_of</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-26><a id=__codelineno-0-26 name=__codelineno-0-26></a>        <span class=n>required_keys</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=s2>&quot;on_behalf_of&quot;</span><span class=p>)</span>
</span><span id=__span-0-27><a id=__codelineno-0-27 name=__codelineno-0-27></a>
</span><span id=__span-0-28><a id=__codelineno-0-28 name=__codelineno-0-28></a>    <span class=n>bearer_data</span> <span class=o>=</span> <span class=p>{</span><span class=n>key</span><span class=p>:</span> <span class=nb>getattr</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span> <span class=k>for</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>required_keys</span><span class=p>}</span>
</span><span id=__span-0-29><a id=__codelineno-0-29 name=__codelineno-0-29></a>
</span><span id=__span-0-30><a id=__codelineno-0-30 name=__codelineno-0-30></a>    <span class=k>return</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>bearer_data</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> </div> </div> </div> <div class="doc doc-object doc-module"> <h4 id=nearai.shared.cache class="doc doc-heading"> <span class="doc doc-object-name doc-module-name">cache</span> <a href=#nearai.shared.cache class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h5 id=nearai.shared.cache.mem_cache_with_timeout class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">mem_cache_with_timeout</span> <a href=#nearai.shared.cache.mem_cache_with_timeout class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>mem_cache_with_timeout</span><span class=p>(</span><span class=n>timeout</span><span class=p>:</span> <span class=n>int</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Decorator to cache function results for a specified timeout period.</p> <details class=quote> <summary>Source code in <code>nearai/shared/cache.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-5> 5</a></span>
<span class=normal><a href=#__codelineno-0-6> 6</a></span>
<span class=normal><a href=#__codelineno-0-7> 7</a></span>
<span class=normal><a href=#__codelineno-0-8> 8</a></span>
<span class=normal><a href=#__codelineno-0-9> 9</a></span>
<span class=normal><a href=#__codelineno-0-10>10</a></span>
<span class=normal><a href=#__codelineno-0-11>11</a></span>
<span class=normal><a href=#__codelineno-0-12>12</a></span>
<span class=normal><a href=#__codelineno-0-13>13</a></span>
<span class=normal><a href=#__codelineno-0-14>14</a></span>
<span class=normal><a href=#__codelineno-0-15>15</a></span>
<span class=normal><a href=#__codelineno-0-16>16</a></span>
<span class=normal><a href=#__codelineno-0-17>17</a></span>
<span class=normal><a href=#__codelineno-0-18>18</a></span>
<span class=normal><a href=#__codelineno-0-19>19</a></span>
<span class=normal><a href=#__codelineno-0-20>20</a></span>
<span class=normal><a href=#__codelineno-0-21>21</a></span>
<span class=normal><a href=#__codelineno-0-22>22</a></span>
<span class=normal><a href=#__codelineno-0-23>23</a></span>
<span class=normal><a href=#__codelineno-0-24>24</a></span>
<span class=normal><a href=#__codelineno-0-25>25</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5></a><span class=k>def</span><span class=w> </span><span class=nf>mem_cache_with_timeout</span><span class=p>(</span><span class=n>timeout</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Decorator to cache function results for a specified timeout period.&quot;&quot;&quot;</span>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7></a>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8></a>    <span class=k>def</span><span class=w> </span><span class=nf>decorator</span><span class=p>(</span><span class=n>func</span><span class=p>):</span>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9></a>        <span class=n>cache</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10></a>
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11></a>        <span class=nd>@wraps</span><span class=p>(</span><span class=n>func</span><span class=p>)</span>
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12></a>        <span class=k>def</span><span class=w> </span><span class=nf>wrapper</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13></a>            <span class=n>now</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14></a>            <span class=n>key</span> <span class=o>=</span> <span class=p>(</span><span class=n>args</span><span class=p>,</span> <span class=nb>frozenset</span><span class=p>(</span><span class=n>kwargs</span><span class=o>.</span><span class=n>items</span><span class=p>()))</span>
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15></a>            <span class=k>if</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>cache</span><span class=p>:</span>
</span><span id=__span-0-16><a id=__codelineno-0-16 name=__codelineno-0-16></a>                <span class=n>result</span><span class=p>,</span> <span class=n>timestamp</span> <span class=o>=</span> <span class=n>cache</span><span class=p>[</span><span class=n>key</span><span class=p>]</span>
</span><span id=__span-0-17><a id=__codelineno-0-17 name=__codelineno-0-17></a>                <span class=k>if</span> <span class=n>now</span> <span class=o>-</span> <span class=n>timestamp</span> <span class=o>&lt;</span> <span class=n>timeout</span><span class=p>:</span>
</span><span id=__span-0-18><a id=__codelineno-0-18 name=__codelineno-0-18></a>                    <span class=k>return</span> <span class=n>result</span>
</span><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19></a>            <span class=n>result</span> <span class=o>=</span> <span class=n>func</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span><span id=__span-0-20><a id=__codelineno-0-20 name=__codelineno-0-20></a>            <span class=n>cache</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>result</span><span class=p>,</span> <span class=n>now</span><span class=p>)</span>
</span><span id=__span-0-21><a id=__codelineno-0-21 name=__codelineno-0-21></a>            <span class=k>return</span> <span class=n>result</span>
</span><span id=__span-0-22><a id=__codelineno-0-22 name=__codelineno-0-22></a>
</span><span id=__span-0-23><a id=__codelineno-0-23 name=__codelineno-0-23></a>        <span class=k>return</span> <span class=n>wrapper</span>
</span><span id=__span-0-24><a id=__codelineno-0-24 name=__codelineno-0-24></a>
</span><span id=__span-0-25><a id=__codelineno-0-25 name=__codelineno-0-25></a>    <span class=k>return</span> <span class=n>decorator</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-module"> <h4 id=nearai.shared.client_config class="doc doc-heading"> <span class="doc doc-object-name doc-module-name">client_config</span> <a href=#nearai.shared.client_config class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h5 id=nearai.shared.client_config.ClientConfig class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">ClientConfig</span> <a href=#nearai.shared.client_config.ClientConfig class=headerlink title="Permanent link">&para;</a></h5> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=pydantic.BaseModel>BaseModel</span></code></p> <details class=quote> <summary>Source code in <code>nearai/shared/client_config.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-21>21</a></span>
<span class=normal><a href=#__codelineno-0-22>22</a></span>
<span class=normal><a href=#__codelineno-0-23>23</a></span>
<span class=normal><a href=#__codelineno-0-24>24</a></span>
<span class=normal><a href=#__codelineno-0-25>25</a></span>
<span class=normal><a href=#__codelineno-0-26>26</a></span>
<span class=normal><a href=#__codelineno-0-27>27</a></span>
<span class=normal><a href=#__codelineno-0-28>28</a></span>
<span class=normal><a href=#__codelineno-0-29>29</a></span>
<span class=normal><a href=#__codelineno-0-30>30</a></span>
<span class=normal><a href=#__codelineno-0-31>31</a></span>
<span class=normal><a href=#__codelineno-0-32>32</a></span>
<span class=normal><a href=#__codelineno-0-33>33</a></span>
<span class=normal><a href=#__codelineno-0-34>34</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-21><a id=__codelineno-0-21 name=__codelineno-0-21></a><span class=k>class</span><span class=w> </span><span class=nc>ClientConfig</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span><span id=__span-0-22><a id=__codelineno-0-22 name=__codelineno-0-22></a>    <span class=n>base_url</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;https://api.near.ai/v1&quot;</span>
</span><span id=__span-0-23><a id=__codelineno-0-23 name=__codelineno-0-23></a>    <span class=n>custom_llm_provider</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;openai&quot;</span>
</span><span id=__span-0-24><a id=__codelineno-0-24 name=__codelineno-0-24></a>    <span class=n>auth</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>AuthData</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-25><a id=__codelineno-0-25 name=__codelineno-0-25></a>    <span class=n>default_provider</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>  <span class=c1># future: remove in favor of api decision</span>
</span><span id=__span-0-26><a id=__codelineno-0-26 name=__codelineno-0-26></a>    <span class=n>num_inference_retries</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>1</span>
</span><span id=__span-0-27><a id=__codelineno-0-27 name=__codelineno-0-27></a>
</span><span id=__span-0-28><a id=__codelineno-0-28 name=__codelineno-0-28></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_hub_client</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-0-29><a id=__codelineno-0-29 name=__codelineno-0-29></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Get the hub client.&quot;&quot;&quot;</span>
</span><span id=__span-0-30><a id=__codelineno-0-30 name=__codelineno-0-30></a>        <span class=n>signature</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;Bearer </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>auth</span><span class=o>.</span><span class=n>model_dump_json</span><span class=p>()</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-31><a id=__codelineno-0-31 name=__codelineno-0-31></a>        <span class=n>base_url</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>base_url</span>
</span><span id=__span-0-32><a id=__codelineno-0-32 name=__codelineno-0-32></a>        <span class=k>return</span> <span class=n>openai</span><span class=o>.</span><span class=n>OpenAI</span><span class=p>(</span>
</span><span id=__span-0-33><a id=__codelineno-0-33 name=__codelineno-0-33></a>            <span class=n>base_url</span><span class=o>=</span><span class=n>base_url</span><span class=p>,</span> <span class=n>api_key</span><span class=o>=</span><span class=n>signature</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=n>DEFAULT_TIMEOUT</span><span class=p>,</span> <span class=n>max_retries</span><span class=o>=</span><span class=n>DEFAULT_MAX_RETRIES</span>
</span><span id=__span-0-34><a id=__codelineno-0-34 name=__codelineno-0-34></a>        <span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.client_config.ClientConfig.get_hub_client class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_hub_client</span> <a href=#nearai.shared.client_config.ClientConfig.get_hub_client class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>get_hub_client</span><span class=p>()</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Get the hub client.</p> <details class=quote> <summary>Source code in <code>nearai/shared/client_config.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-28>28</a></span>
<span class=normal><a href=#__codelineno-0-29>29</a></span>
<span class=normal><a href=#__codelineno-0-30>30</a></span>
<span class=normal><a href=#__codelineno-0-31>31</a></span>
<span class=normal><a href=#__codelineno-0-32>32</a></span>
<span class=normal><a href=#__codelineno-0-33>33</a></span>
<span class=normal><a href=#__codelineno-0-34>34</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-28><a id=__codelineno-0-28 name=__codelineno-0-28></a><span class=k>def</span><span class=w> </span><span class=nf>get_hub_client</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-0-29><a id=__codelineno-0-29 name=__codelineno-0-29></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Get the hub client.&quot;&quot;&quot;</span>
</span><span id=__span-0-30><a id=__codelineno-0-30 name=__codelineno-0-30></a>    <span class=n>signature</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;Bearer </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>auth</span><span class=o>.</span><span class=n>model_dump_json</span><span class=p>()</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-31><a id=__codelineno-0-31 name=__codelineno-0-31></a>    <span class=n>base_url</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>base_url</span>
</span><span id=__span-0-32><a id=__codelineno-0-32 name=__codelineno-0-32></a>    <span class=k>return</span> <span class=n>openai</span><span class=o>.</span><span class=n>OpenAI</span><span class=p>(</span>
</span><span id=__span-0-33><a id=__codelineno-0-33 name=__codelineno-0-33></a>        <span class=n>base_url</span><span class=o>=</span><span class=n>base_url</span><span class=p>,</span> <span class=n>api_key</span><span class=o>=</span><span class=n>signature</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=n>DEFAULT_TIMEOUT</span><span class=p>,</span> <span class=n>max_retries</span><span class=o>=</span><span class=n>DEFAULT_MAX_RETRIES</span>
</span><span id=__span-0-34><a id=__codelineno-0-34 name=__codelineno-0-34></a>    <span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> </div> </div> </div> <div class="doc doc-object doc-module"> <h4 id=nearai.shared.inference_client class="doc doc-heading"> <span class="doc doc-object-name doc-module-name">inference_client</span> <a href=#nearai.shared.inference_client class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h5 id=nearai.shared.inference_client.InferenceClient class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">InferenceClient</span> <a href=#nearai.shared.inference_client.InferenceClient class=headerlink title="Permanent link">&para;</a></h5> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code>object</code></p> <details class=quote> <summary>Source code in <code>nearai/shared/inference_client.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-40> 40</a></span>
<span class=normal><a href=#__codelineno-0-41> 41</a></span>
<span class=normal><a href=#__codelineno-0-42> 42</a></span>
<span class=normal><a href=#__codelineno-0-43> 43</a></span>
<span class=normal><a href=#__codelineno-0-44> 44</a></span>
<span class=normal><a href=#__codelineno-0-45> 45</a></span>
<span class=normal><a href=#__codelineno-0-46> 46</a></span>
<span class=normal><a href=#__codelineno-0-47> 47</a></span>
<span class=normal><a href=#__codelineno-0-48> 48</a></span>
<span class=normal><a href=#__codelineno-0-49> 49</a></span>
<span class=normal><a href=#__codelineno-0-50> 50</a></span>
<span class=normal><a href=#__codelineno-0-51> 51</a></span>
<span class=normal><a href=#__codelineno-0-52> 52</a></span>
<span class=normal><a href=#__codelineno-0-53> 53</a></span>
<span class=normal><a href=#__codelineno-0-54> 54</a></span>
<span class=normal><a href=#__codelineno-0-55> 55</a></span>
<span class=normal><a href=#__codelineno-0-56> 56</a></span>
<span class=normal><a href=#__codelineno-0-57> 57</a></span>
<span class=normal><a href=#__codelineno-0-58> 58</a></span>
<span class=normal><a href=#__codelineno-0-59> 59</a></span>
<span class=normal><a href=#__codelineno-0-60> 60</a></span>
<span class=normal><a href=#__codelineno-0-61> 61</a></span>
<span class=normal><a href=#__codelineno-0-62> 62</a></span>
<span class=normal><a href=#__codelineno-0-63> 63</a></span>
<span class=normal><a href=#__codelineno-0-64> 64</a></span>
<span class=normal><a href=#__codelineno-0-65> 65</a></span>
<span class=normal><a href=#__codelineno-0-66> 66</a></span>
<span class=normal><a href=#__codelineno-0-67> 67</a></span>
<span class=normal><a href=#__codelineno-0-68> 68</a></span>
<span class=normal><a href=#__codelineno-0-69> 69</a></span>
<span class=normal><a href=#__codelineno-0-70> 70</a></span>
<span class=normal><a href=#__codelineno-0-71> 71</a></span>
<span class=normal><a href=#__codelineno-0-72> 72</a></span>
<span class=normal><a href=#__codelineno-0-73> 73</a></span>
<span class=normal><a href=#__codelineno-0-74> 74</a></span>
<span class=normal><a href=#__codelineno-0-75> 75</a></span>
<span class=normal><a href=#__codelineno-0-76> 76</a></span>
<span class=normal><a href=#__codelineno-0-77> 77</a></span>
<span class=normal><a href=#__codelineno-0-78> 78</a></span>
<span class=normal><a href=#__codelineno-0-79> 79</a></span>
<span class=normal><a href=#__codelineno-0-80> 80</a></span>
<span class=normal><a href=#__codelineno-0-81> 81</a></span>
<span class=normal><a href=#__codelineno-0-82> 82</a></span>
<span class=normal><a href=#__codelineno-0-83> 83</a></span>
<span class=normal><a href=#__codelineno-0-84> 84</a></span>
<span class=normal><a href=#__codelineno-0-85> 85</a></span>
<span class=normal><a href=#__codelineno-0-86> 86</a></span>
<span class=normal><a href=#__codelineno-0-87> 87</a></span>
<span class=normal><a href=#__codelineno-0-88> 88</a></span>
<span class=normal><a href=#__codelineno-0-89> 89</a></span>
<span class=normal><a href=#__codelineno-0-90> 90</a></span>
<span class=normal><a href=#__codelineno-0-91> 91</a></span>
<span class=normal><a href=#__codelineno-0-92> 92</a></span>
<span class=normal><a href=#__codelineno-0-93> 93</a></span>
<span class=normal><a href=#__codelineno-0-94> 94</a></span>
<span class=normal><a href=#__codelineno-0-95> 95</a></span>
<span class=normal><a href=#__codelineno-0-96> 96</a></span>
<span class=normal><a href=#__codelineno-0-97> 97</a></span>
<span class=normal><a href=#__codelineno-0-98> 98</a></span>
<span class=normal><a href=#__codelineno-0-99> 99</a></span>
<span class=normal><a href=#__codelineno-0-100>100</a></span>
<span class=normal><a href=#__codelineno-0-101>101</a></span>
<span class=normal><a href=#__codelineno-0-102>102</a></span>
<span class=normal><a href=#__codelineno-0-103>103</a></span>
<span class=normal><a href=#__codelineno-0-104>104</a></span>
<span class=normal><a href=#__codelineno-0-105>105</a></span>
<span class=normal><a href=#__codelineno-0-106>106</a></span>
<span class=normal><a href=#__codelineno-0-107>107</a></span>
<span class=normal><a href=#__codelineno-0-108>108</a></span>
<span class=normal><a href=#__codelineno-0-109>109</a></span>
<span class=normal><a href=#__codelineno-0-110>110</a></span>
<span class=normal><a href=#__codelineno-0-111>111</a></span>
<span class=normal><a href=#__codelineno-0-112>112</a></span>
<span class=normal><a href=#__codelineno-0-113>113</a></span>
<span class=normal><a href=#__codelineno-0-114>114</a></span>
<span class=normal><a href=#__codelineno-0-115>115</a></span>
<span class=normal><a href=#__codelineno-0-116>116</a></span>
<span class=normal><a href=#__codelineno-0-117>117</a></span>
<span class=normal><a href=#__codelineno-0-118>118</a></span>
<span class=normal><a href=#__codelineno-0-119>119</a></span>
<span class=normal><a href=#__codelineno-0-120>120</a></span>
<span class=normal><a href=#__codelineno-0-121>121</a></span>
<span class=normal><a href=#__codelineno-0-122>122</a></span>
<span class=normal><a href=#__codelineno-0-123>123</a></span>
<span class=normal><a href=#__codelineno-0-124>124</a></span>
<span class=normal><a href=#__codelineno-0-125>125</a></span>
<span class=normal><a href=#__codelineno-0-126>126</a></span>
<span class=normal><a href=#__codelineno-0-127>127</a></span>
<span class=normal><a href=#__codelineno-0-128>128</a></span>
<span class=normal><a href=#__codelineno-0-129>129</a></span>
<span class=normal><a href=#__codelineno-0-130>130</a></span>
<span class=normal><a href=#__codelineno-0-131>131</a></span>
<span class=normal><a href=#__codelineno-0-132>132</a></span>
<span class=normal><a href=#__codelineno-0-133>133</a></span>
<span class=normal><a href=#__codelineno-0-134>134</a></span>
<span class=normal><a href=#__codelineno-0-135>135</a></span>
<span class=normal><a href=#__codelineno-0-136>136</a></span>
<span class=normal><a href=#__codelineno-0-137>137</a></span>
<span class=normal><a href=#__codelineno-0-138>138</a></span>
<span class=normal><a href=#__codelineno-0-139>139</a></span>
<span class=normal><a href=#__codelineno-0-140>140</a></span>
<span class=normal><a href=#__codelineno-0-141>141</a></span>
<span class=normal><a href=#__codelineno-0-142>142</a></span>
<span class=normal><a href=#__codelineno-0-143>143</a></span>
<span class=normal><a href=#__codelineno-0-144>144</a></span>
<span class=normal><a href=#__codelineno-0-145>145</a></span>
<span class=normal><a href=#__codelineno-0-146>146</a></span>
<span class=normal><a href=#__codelineno-0-147>147</a></span>
<span class=normal><a href=#__codelineno-0-148>148</a></span>
<span class=normal><a href=#__codelineno-0-149>149</a></span>
<span class=normal><a href=#__codelineno-0-150>150</a></span>
<span class=normal><a href=#__codelineno-0-151>151</a></span>
<span class=normal><a href=#__codelineno-0-152>152</a></span>
<span class=normal><a href=#__codelineno-0-153>153</a></span>
<span class=normal><a href=#__codelineno-0-154>154</a></span>
<span class=normal><a href=#__codelineno-0-155>155</a></span>
<span class=normal><a href=#__codelineno-0-156>156</a></span>
<span class=normal><a href=#__codelineno-0-157>157</a></span>
<span class=normal><a href=#__codelineno-0-158>158</a></span>
<span class=normal><a href=#__codelineno-0-159>159</a></span>
<span class=normal><a href=#__codelineno-0-160>160</a></span>
<span class=normal><a href=#__codelineno-0-161>161</a></span>
<span class=normal><a href=#__codelineno-0-162>162</a></span>
<span class=normal><a href=#__codelineno-0-163>163</a></span>
<span class=normal><a href=#__codelineno-0-164>164</a></span>
<span class=normal><a href=#__codelineno-0-165>165</a></span>
<span class=normal><a href=#__codelineno-0-166>166</a></span>
<span class=normal><a href=#__codelineno-0-167>167</a></span>
<span class=normal><a href=#__codelineno-0-168>168</a></span>
<span class=normal><a href=#__codelineno-0-169>169</a></span>
<span class=normal><a href=#__codelineno-0-170>170</a></span>
<span class=normal><a href=#__codelineno-0-171>171</a></span>
<span class=normal><a href=#__codelineno-0-172>172</a></span>
<span class=normal><a href=#__codelineno-0-173>173</a></span>
<span class=normal><a href=#__codelineno-0-174>174</a></span>
<span class=normal><a href=#__codelineno-0-175>175</a></span>
<span class=normal><a href=#__codelineno-0-176>176</a></span>
<span class=normal><a href=#__codelineno-0-177>177</a></span>
<span class=normal><a href=#__codelineno-0-178>178</a></span>
<span class=normal><a href=#__codelineno-0-179>179</a></span>
<span class=normal><a href=#__codelineno-0-180>180</a></span>
<span class=normal><a href=#__codelineno-0-181>181</a></span>
<span class=normal><a href=#__codelineno-0-182>182</a></span>
<span class=normal><a href=#__codelineno-0-183>183</a></span>
<span class=normal><a href=#__codelineno-0-184>184</a></span>
<span class=normal><a href=#__codelineno-0-185>185</a></span>
<span class=normal><a href=#__codelineno-0-186>186</a></span>
<span class=normal><a href=#__codelineno-0-187>187</a></span>
<span class=normal><a href=#__codelineno-0-188>188</a></span>
<span class=normal><a href=#__codelineno-0-189>189</a></span>
<span class=normal><a href=#__codelineno-0-190>190</a></span>
<span class=normal><a href=#__codelineno-0-191>191</a></span>
<span class=normal><a href=#__codelineno-0-192>192</a></span>
<span class=normal><a href=#__codelineno-0-193>193</a></span>
<span class=normal><a href=#__codelineno-0-194>194</a></span>
<span class=normal><a href=#__codelineno-0-195>195</a></span>
<span class=normal><a href=#__codelineno-0-196>196</a></span>
<span class=normal><a href=#__codelineno-0-197>197</a></span>
<span class=normal><a href=#__codelineno-0-198>198</a></span>
<span class=normal><a href=#__codelineno-0-199>199</a></span>
<span class=normal><a href=#__codelineno-0-200>200</a></span>
<span class=normal><a href=#__codelineno-0-201>201</a></span>
<span class=normal><a href=#__codelineno-0-202>202</a></span>
<span class=normal><a href=#__codelineno-0-203>203</a></span>
<span class=normal><a href=#__codelineno-0-204>204</a></span>
<span class=normal><a href=#__codelineno-0-205>205</a></span>
<span class=normal><a href=#__codelineno-0-206>206</a></span>
<span class=normal><a href=#__codelineno-0-207>207</a></span>
<span class=normal><a href=#__codelineno-0-208>208</a></span>
<span class=normal><a href=#__codelineno-0-209>209</a></span>
<span class=normal><a href=#__codelineno-0-210>210</a></span>
<span class=normal><a href=#__codelineno-0-211>211</a></span>
<span class=normal><a href=#__codelineno-0-212>212</a></span>
<span class=normal><a href=#__codelineno-0-213>213</a></span>
<span class=normal><a href=#__codelineno-0-214>214</a></span>
<span class=normal><a href=#__codelineno-0-215>215</a></span>
<span class=normal><a href=#__codelineno-0-216>216</a></span>
<span class=normal><a href=#__codelineno-0-217>217</a></span>
<span class=normal><a href=#__codelineno-0-218>218</a></span>
<span class=normal><a href=#__codelineno-0-219>219</a></span>
<span class=normal><a href=#__codelineno-0-220>220</a></span>
<span class=normal><a href=#__codelineno-0-221>221</a></span>
<span class=normal><a href=#__codelineno-0-222>222</a></span>
<span class=normal><a href=#__codelineno-0-223>223</a></span>
<span class=normal><a href=#__codelineno-0-224>224</a></span>
<span class=normal><a href=#__codelineno-0-225>225</a></span>
<span class=normal><a href=#__codelineno-0-226>226</a></span>
<span class=normal><a href=#__codelineno-0-227>227</a></span>
<span class=normal><a href=#__codelineno-0-228>228</a></span>
<span class=normal><a href=#__codelineno-0-229>229</a></span>
<span class=normal><a href=#__codelineno-0-230>230</a></span>
<span class=normal><a href=#__codelineno-0-231>231</a></span>
<span class=normal><a href=#__codelineno-0-232>232</a></span>
<span class=normal><a href=#__codelineno-0-233>233</a></span>
<span class=normal><a href=#__codelineno-0-234>234</a></span>
<span class=normal><a href=#__codelineno-0-235>235</a></span>
<span class=normal><a href=#__codelineno-0-236>236</a></span>
<span class=normal><a href=#__codelineno-0-237>237</a></span>
<span class=normal><a href=#__codelineno-0-238>238</a></span>
<span class=normal><a href=#__codelineno-0-239>239</a></span>
<span class=normal><a href=#__codelineno-0-240>240</a></span>
<span class=normal><a href=#__codelineno-0-241>241</a></span>
<span class=normal><a href=#__codelineno-0-242>242</a></span>
<span class=normal><a href=#__codelineno-0-243>243</a></span>
<span class=normal><a href=#__codelineno-0-244>244</a></span>
<span class=normal><a href=#__codelineno-0-245>245</a></span>
<span class=normal><a href=#__codelineno-0-246>246</a></span>
<span class=normal><a href=#__codelineno-0-247>247</a></span>
<span class=normal><a href=#__codelineno-0-248>248</a></span>
<span class=normal><a href=#__codelineno-0-249>249</a></span>
<span class=normal><a href=#__codelineno-0-250>250</a></span>
<span class=normal><a href=#__codelineno-0-251>251</a></span>
<span class=normal><a href=#__codelineno-0-252>252</a></span>
<span class=normal><a href=#__codelineno-0-253>253</a></span>
<span class=normal><a href=#__codelineno-0-254>254</a></span>
<span class=normal><a href=#__codelineno-0-255>255</a></span>
<span class=normal><a href=#__codelineno-0-256>256</a></span>
<span class=normal><a href=#__codelineno-0-257>257</a></span>
<span class=normal><a href=#__codelineno-0-258>258</a></span>
<span class=normal><a href=#__codelineno-0-259>259</a></span>
<span class=normal><a href=#__codelineno-0-260>260</a></span>
<span class=normal><a href=#__codelineno-0-261>261</a></span>
<span class=normal><a href=#__codelineno-0-262>262</a></span>
<span class=normal><a href=#__codelineno-0-263>263</a></span>
<span class=normal><a href=#__codelineno-0-264>264</a></span>
<span class=normal><a href=#__codelineno-0-265>265</a></span>
<span class=normal><a href=#__codelineno-0-266>266</a></span>
<span class=normal><a href=#__codelineno-0-267>267</a></span>
<span class=normal><a href=#__codelineno-0-268>268</a></span>
<span class=normal><a href=#__codelineno-0-269>269</a></span>
<span class=normal><a href=#__codelineno-0-270>270</a></span>
<span class=normal><a href=#__codelineno-0-271>271</a></span>
<span class=normal><a href=#__codelineno-0-272>272</a></span>
<span class=normal><a href=#__codelineno-0-273>273</a></span>
<span class=normal><a href=#__codelineno-0-274>274</a></span>
<span class=normal><a href=#__codelineno-0-275>275</a></span>
<span class=normal><a href=#__codelineno-0-276>276</a></span>
<span class=normal><a href=#__codelineno-0-277>277</a></span>
<span class=normal><a href=#__codelineno-0-278>278</a></span>
<span class=normal><a href=#__codelineno-0-279>279</a></span>
<span class=normal><a href=#__codelineno-0-280>280</a></span>
<span class=normal><a href=#__codelineno-0-281>281</a></span>
<span class=normal><a href=#__codelineno-0-282>282</a></span>
<span class=normal><a href=#__codelineno-0-283>283</a></span>
<span class=normal><a href=#__codelineno-0-284>284</a></span>
<span class=normal><a href=#__codelineno-0-285>285</a></span>
<span class=normal><a href=#__codelineno-0-286>286</a></span>
<span class=normal><a href=#__codelineno-0-287>287</a></span>
<span class=normal><a href=#__codelineno-0-288>288</a></span>
<span class=normal><a href=#__codelineno-0-289>289</a></span>
<span class=normal><a href=#__codelineno-0-290>290</a></span>
<span class=normal><a href=#__codelineno-0-291>291</a></span>
<span class=normal><a href=#__codelineno-0-292>292</a></span>
<span class=normal><a href=#__codelineno-0-293>293</a></span>
<span class=normal><a href=#__codelineno-0-294>294</a></span>
<span class=normal><a href=#__codelineno-0-295>295</a></span>
<span class=normal><a href=#__codelineno-0-296>296</a></span>
<span class=normal><a href=#__codelineno-0-297>297</a></span>
<span class=normal><a href=#__codelineno-0-298>298</a></span>
<span class=normal><a href=#__codelineno-0-299>299</a></span>
<span class=normal><a href=#__codelineno-0-300>300</a></span>
<span class=normal><a href=#__codelineno-0-301>301</a></span>
<span class=normal><a href=#__codelineno-0-302>302</a></span>
<span class=normal><a href=#__codelineno-0-303>303</a></span>
<span class=normal><a href=#__codelineno-0-304>304</a></span>
<span class=normal><a href=#__codelineno-0-305>305</a></span>
<span class=normal><a href=#__codelineno-0-306>306</a></span>
<span class=normal><a href=#__codelineno-0-307>307</a></span>
<span class=normal><a href=#__codelineno-0-308>308</a></span>
<span class=normal><a href=#__codelineno-0-309>309</a></span>
<span class=normal><a href=#__codelineno-0-310>310</a></span>
<span class=normal><a href=#__codelineno-0-311>311</a></span>
<span class=normal><a href=#__codelineno-0-312>312</a></span>
<span class=normal><a href=#__codelineno-0-313>313</a></span>
<span class=normal><a href=#__codelineno-0-314>314</a></span>
<span class=normal><a href=#__codelineno-0-315>315</a></span>
<span class=normal><a href=#__codelineno-0-316>316</a></span>
<span class=normal><a href=#__codelineno-0-317>317</a></span>
<span class=normal><a href=#__codelineno-0-318>318</a></span>
<span class=normal><a href=#__codelineno-0-319>319</a></span>
<span class=normal><a href=#__codelineno-0-320>320</a></span>
<span class=normal><a href=#__codelineno-0-321>321</a></span>
<span class=normal><a href=#__codelineno-0-322>322</a></span>
<span class=normal><a href=#__codelineno-0-323>323</a></span>
<span class=normal><a href=#__codelineno-0-324>324</a></span>
<span class=normal><a href=#__codelineno-0-325>325</a></span>
<span class=normal><a href=#__codelineno-0-326>326</a></span>
<span class=normal><a href=#__codelineno-0-327>327</a></span>
<span class=normal><a href=#__codelineno-0-328>328</a></span>
<span class=normal><a href=#__codelineno-0-329>329</a></span>
<span class=normal><a href=#__codelineno-0-330>330</a></span>
<span class=normal><a href=#__codelineno-0-331>331</a></span>
<span class=normal><a href=#__codelineno-0-332>332</a></span>
<span class=normal><a href=#__codelineno-0-333>333</a></span>
<span class=normal><a href=#__codelineno-0-334>334</a></span>
<span class=normal><a href=#__codelineno-0-335>335</a></span>
<span class=normal><a href=#__codelineno-0-336>336</a></span>
<span class=normal><a href=#__codelineno-0-337>337</a></span>
<span class=normal><a href=#__codelineno-0-338>338</a></span>
<span class=normal><a href=#__codelineno-0-339>339</a></span>
<span class=normal><a href=#__codelineno-0-340>340</a></span>
<span class=normal><a href=#__codelineno-0-341>341</a></span>
<span class=normal><a href=#__codelineno-0-342>342</a></span>
<span class=normal><a href=#__codelineno-0-343>343</a></span>
<span class=normal><a href=#__codelineno-0-344>344</a></span>
<span class=normal><a href=#__codelineno-0-345>345</a></span>
<span class=normal><a href=#__codelineno-0-346>346</a></span>
<span class=normal><a href=#__codelineno-0-347>347</a></span>
<span class=normal><a href=#__codelineno-0-348>348</a></span>
<span class=normal><a href=#__codelineno-0-349>349</a></span>
<span class=normal><a href=#__codelineno-0-350>350</a></span>
<span class=normal><a href=#__codelineno-0-351>351</a></span>
<span class=normal><a href=#__codelineno-0-352>352</a></span>
<span class=normal><a href=#__codelineno-0-353>353</a></span>
<span class=normal><a href=#__codelineno-0-354>354</a></span>
<span class=normal><a href=#__codelineno-0-355>355</a></span>
<span class=normal><a href=#__codelineno-0-356>356</a></span>
<span class=normal><a href=#__codelineno-0-357>357</a></span>
<span class=normal><a href=#__codelineno-0-358>358</a></span>
<span class=normal><a href=#__codelineno-0-359>359</a></span>
<span class=normal><a href=#__codelineno-0-360>360</a></span>
<span class=normal><a href=#__codelineno-0-361>361</a></span>
<span class=normal><a href=#__codelineno-0-362>362</a></span>
<span class=normal><a href=#__codelineno-0-363>363</a></span>
<span class=normal><a href=#__codelineno-0-364>364</a></span>
<span class=normal><a href=#__codelineno-0-365>365</a></span>
<span class=normal><a href=#__codelineno-0-366>366</a></span>
<span class=normal><a href=#__codelineno-0-367>367</a></span>
<span class=normal><a href=#__codelineno-0-368>368</a></span>
<span class=normal><a href=#__codelineno-0-369>369</a></span>
<span class=normal><a href=#__codelineno-0-370>370</a></span>
<span class=normal><a href=#__codelineno-0-371>371</a></span>
<span class=normal><a href=#__codelineno-0-372>372</a></span>
<span class=normal><a href=#__codelineno-0-373>373</a></span>
<span class=normal><a href=#__codelineno-0-374>374</a></span>
<span class=normal><a href=#__codelineno-0-375>375</a></span>
<span class=normal><a href=#__codelineno-0-376>376</a></span>
<span class=normal><a href=#__codelineno-0-377>377</a></span>
<span class=normal><a href=#__codelineno-0-378>378</a></span>
<span class=normal><a href=#__codelineno-0-379>379</a></span>
<span class=normal><a href=#__codelineno-0-380>380</a></span>
<span class=normal><a href=#__codelineno-0-381>381</a></span>
<span class=normal><a href=#__codelineno-0-382>382</a></span>
<span class=normal><a href=#__codelineno-0-383>383</a></span>
<span class=normal><a href=#__codelineno-0-384>384</a></span>
<span class=normal><a href=#__codelineno-0-385>385</a></span>
<span class=normal><a href=#__codelineno-0-386>386</a></span>
<span class=normal><a href=#__codelineno-0-387>387</a></span>
<span class=normal><a href=#__codelineno-0-388>388</a></span>
<span class=normal><a href=#__codelineno-0-389>389</a></span>
<span class=normal><a href=#__codelineno-0-390>390</a></span>
<span class=normal><a href=#__codelineno-0-391>391</a></span>
<span class=normal><a href=#__codelineno-0-392>392</a></span>
<span class=normal><a href=#__codelineno-0-393>393</a></span>
<span class=normal><a href=#__codelineno-0-394>394</a></span>
<span class=normal><a href=#__codelineno-0-395>395</a></span>
<span class=normal><a href=#__codelineno-0-396>396</a></span>
<span class=normal><a href=#__codelineno-0-397>397</a></span>
<span class=normal><a href=#__codelineno-0-398>398</a></span>
<span class=normal><a href=#__codelineno-0-399>399</a></span>
<span class=normal><a href=#__codelineno-0-400>400</a></span>
<span class=normal><a href=#__codelineno-0-401>401</a></span>
<span class=normal><a href=#__codelineno-0-402>402</a></span>
<span class=normal><a href=#__codelineno-0-403>403</a></span>
<span class=normal><a href=#__codelineno-0-404>404</a></span>
<span class=normal><a href=#__codelineno-0-405>405</a></span>
<span class=normal><a href=#__codelineno-0-406>406</a></span>
<span class=normal><a href=#__codelineno-0-407>407</a></span>
<span class=normal><a href=#__codelineno-0-408>408</a></span>
<span class=normal><a href=#__codelineno-0-409>409</a></span>
<span class=normal><a href=#__codelineno-0-410>410</a></span>
<span class=normal><a href=#__codelineno-0-411>411</a></span>
<span class=normal><a href=#__codelineno-0-412>412</a></span>
<span class=normal><a href=#__codelineno-0-413>413</a></span>
<span class=normal><a href=#__codelineno-0-414>414</a></span>
<span class=normal><a href=#__codelineno-0-415>415</a></span>
<span class=normal><a href=#__codelineno-0-416>416</a></span>
<span class=normal><a href=#__codelineno-0-417>417</a></span>
<span class=normal><a href=#__codelineno-0-418>418</a></span>
<span class=normal><a href=#__codelineno-0-419>419</a></span>
<span class=normal><a href=#__codelineno-0-420>420</a></span>
<span class=normal><a href=#__codelineno-0-421>421</a></span>
<span class=normal><a href=#__codelineno-0-422>422</a></span>
<span class=normal><a href=#__codelineno-0-423>423</a></span>
<span class=normal><a href=#__codelineno-0-424>424</a></span>
<span class=normal><a href=#__codelineno-0-425>425</a></span>
<span class=normal><a href=#__codelineno-0-426>426</a></span>
<span class=normal><a href=#__codelineno-0-427>427</a></span>
<span class=normal><a href=#__codelineno-0-428>428</a></span>
<span class=normal><a href=#__codelineno-0-429>429</a></span>
<span class=normal><a href=#__codelineno-0-430>430</a></span>
<span class=normal><a href=#__codelineno-0-431>431</a></span>
<span class=normal><a href=#__codelineno-0-432>432</a></span>
<span class=normal><a href=#__codelineno-0-433>433</a></span>
<span class=normal><a href=#__codelineno-0-434>434</a></span>
<span class=normal><a href=#__codelineno-0-435>435</a></span>
<span class=normal><a href=#__codelineno-0-436>436</a></span>
<span class=normal><a href=#__codelineno-0-437>437</a></span>
<span class=normal><a href=#__codelineno-0-438>438</a></span>
<span class=normal><a href=#__codelineno-0-439>439</a></span>
<span class=normal><a href=#__codelineno-0-440>440</a></span>
<span class=normal><a href=#__codelineno-0-441>441</a></span>
<span class=normal><a href=#__codelineno-0-442>442</a></span>
<span class=normal><a href=#__codelineno-0-443>443</a></span>
<span class=normal><a href=#__codelineno-0-444>444</a></span>
<span class=normal><a href=#__codelineno-0-445>445</a></span>
<span class=normal><a href=#__codelineno-0-446>446</a></span>
<span class=normal><a href=#__codelineno-0-447>447</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-40><a id=__codelineno-0-40 name=__codelineno-0-40></a><span class=k>class</span><span class=w> </span><span class=nc>InferenceClient</span><span class=p>(</span><span class=nb>object</span><span class=p>):</span>
</span><span id=__span-0-41><a id=__codelineno-0-41 name=__codelineno-0-41></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>config</span><span class=p>:</span> <span class=n>ClientConfig</span><span class=p>,</span> <span class=n>runner_api_key</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>agent_identifier</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>  <span class=c1># noqa: D107</span>
</span><span id=__span-0-42><a id=__codelineno-0-42 name=__codelineno-0-42></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_config</span> <span class=o>=</span> <span class=n>config</span>
</span><span id=__span-0-43><a id=__codelineno-0-43 name=__codelineno-0-43></a>        <span class=bp>self</span><span class=o>.</span><span class=n>runner_api_key</span> <span class=o>=</span> <span class=n>runner_api_key</span>
</span><span id=__span-0-44><a id=__codelineno-0-44 name=__codelineno-0-44></a>        <span class=bp>self</span><span class=o>.</span><span class=n>agent_identifier</span> <span class=o>=</span> <span class=n>agent_identifier</span>
</span><span id=__span-0-45><a id=__codelineno-0-45 name=__codelineno-0-45></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_auth</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-46><a id=__codelineno-0-46 name=__codelineno-0-46></a>        <span class=bp>self</span><span class=o>.</span><span class=n>generate_auth_for_current_agent</span><span class=p>(</span><span class=n>config</span><span class=p>,</span> <span class=n>agent_identifier</span><span class=p>)</span>
</span><span id=__span-0-47><a id=__codelineno-0-47 name=__codelineno-0-47></a>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span> <span class=o>=</span> <span class=n>openai</span><span class=o>.</span><span class=n>OpenAI</span><span class=p>(</span><span class=n>base_url</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>base_url</span><span class=p>,</span> <span class=n>api_key</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_auth</span><span class=p>)</span>
</span><span id=__span-0-48><a id=__codelineno-0-48 name=__codelineno-0-48></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_provider_models</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>ProviderModels</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-49><a id=__codelineno-0-49 name=__codelineno-0-49></a>
</span><span id=__span-0-50><a id=__codelineno-0-50 name=__codelineno-0-50></a>    <span class=k>def</span><span class=w> </span><span class=nf>generate_auth_for_current_agent</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>config</span><span class=p>,</span> <span class=n>agent_identifier</span><span class=p>):</span>
</span><span id=__span-0-51><a id=__codelineno-0-51 name=__codelineno-0-51></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Regenerate auth for the current agent.&quot;&quot;&quot;</span>
</span><span id=__span-0-52><a id=__codelineno-0-52 name=__codelineno-0-52></a>        <span class=bp>self</span><span class=o>.</span><span class=n>agent_identifier</span> <span class=o>=</span> <span class=n>agent_identifier</span>
</span><span id=__span-0-53><a id=__codelineno-0-53 name=__codelineno-0-53></a>        <span class=k>if</span> <span class=n>config</span><span class=o>.</span><span class=n>auth</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-54><a id=__codelineno-0-54 name=__codelineno-0-54></a>            <span class=n>auth_bearer_token</span> <span class=o>=</span> <span class=n>config</span><span class=o>.</span><span class=n>auth</span><span class=o>.</span><span class=n>generate_bearer_token</span><span class=p>()</span>
</span><span id=__span-0-55><a id=__codelineno-0-55 name=__codelineno-0-55></a>            <span class=n>new_token</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>auth_bearer_token</span><span class=p>)</span>
</span><span id=__span-0-56><a id=__codelineno-0-56 name=__codelineno-0-56></a>            <span class=n>new_token</span><span class=p>[</span><span class=s2>&quot;runner_data&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>({</span><span class=s2>&quot;agent&quot;</span><span class=p>:</span> <span class=n>agent_identifier</span><span class=p>,</span> <span class=s2>&quot;runner_api_key&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>runner_api_key</span><span class=p>})</span>
</span><span id=__span-0-57><a id=__codelineno-0-57 name=__codelineno-0-57></a>            <span class=n>auth_bearer_token</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>new_token</span><span class=p>)</span>
</span><span id=__span-0-58><a id=__codelineno-0-58 name=__codelineno-0-58></a>            <span class=bp>self</span><span class=o>.</span><span class=n>_auth</span> <span class=o>=</span> <span class=n>auth_bearer_token</span>
</span><span id=__span-0-59><a id=__codelineno-0-59 name=__codelineno-0-59></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-60><a id=__codelineno-0-60 name=__codelineno-0-60></a>            <span class=bp>self</span><span class=o>.</span><span class=n>_auth</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-61><a id=__codelineno-0-61 name=__codelineno-0-61></a>
</span><span id=__span-0-62><a id=__codelineno-0-62 name=__codelineno-0-62></a>    <span class=c1># This makes sense in the CLI where we don&#39;t mind doing this request and caching it.</span>
</span><span id=__span-0-63><a id=__codelineno-0-63 name=__codelineno-0-63></a>    <span class=c1># In the aws_runner this is an extra request every time we run.</span>
</span><span id=__span-0-64><a id=__codelineno-0-64 name=__codelineno-0-64></a>    <span class=c1># TODO(#233): add a choice of a provider model in aws_runner, and then this step can be skipped.</span>
</span><span id=__span-0-65><a id=__codelineno-0-65 name=__codelineno-0-65></a>    <span class=nd>@cached_property</span>
</span><span id=__span-0-66><a id=__codelineno-0-66 name=__codelineno-0-66></a>    <span class=k>def</span><span class=w> </span><span class=nf>provider_models</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>ProviderModels</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-67><a id=__codelineno-0-67 name=__codelineno-0-67></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_provider_models</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-68><a id=__codelineno-0-68 name=__codelineno-0-68></a>            <span class=bp>self</span><span class=o>.</span><span class=n>_provider_models</span> <span class=o>=</span> <span class=n>ProviderModels</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=p>)</span>
</span><span id=__span-0-69><a id=__codelineno-0-69 name=__codelineno-0-69></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_provider_models</span>
</span><span id=__span-0-70><a id=__codelineno-0-70 name=__codelineno-0-70></a>
</span><span id=__span-0-71><a id=__codelineno-0-71 name=__codelineno-0-71></a>    <span class=k>def</span><span class=w> </span><span class=nf>set_provider_models</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>provider_models</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>ProviderModels</span><span class=p>]):</span>
</span><span id=__span-0-72><a id=__codelineno-0-72 name=__codelineno-0-72></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Set provider models. Used by external caching.&quot;&quot;&quot;</span>
</span><span id=__span-0-73><a id=__codelineno-0-73 name=__codelineno-0-73></a>        <span class=k>if</span> <span class=n>provider_models</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-74><a id=__codelineno-0-74 name=__codelineno-0-74></a>            <span class=bp>self</span><span class=o>.</span><span class=n>_provider_models</span> <span class=o>=</span> <span class=n>ProviderModels</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=p>)</span>
</span><span id=__span-0-75><a id=__codelineno-0-75 name=__codelineno-0-75></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-76><a id=__codelineno-0-76 name=__codelineno-0-76></a>            <span class=bp>self</span><span class=o>.</span><span class=n>_provider_models</span> <span class=o>=</span> <span class=n>provider_models</span>
</span><span id=__span-0-77><a id=__codelineno-0-77 name=__codelineno-0-77></a>
</span><span id=__span-0-78><a id=__codelineno-0-78 name=__codelineno-0-78></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_agent_public_key</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>agent_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-0-79><a id=__codelineno-0-79 name=__codelineno-0-79></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Request agent public key.&quot;&quot;&quot;</span>
</span><span id=__span-0-80><a id=__codelineno-0-80 name=__codelineno-0-80></a>        <span class=n>headers</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-81><a id=__codelineno-0-81 name=__codelineno-0-81></a>            <span class=s2>&quot;Content-Type&quot;</span><span class=p>:</span> <span class=s2>&quot;application/json&quot;</span><span class=p>,</span>
</span><span id=__span-0-82><a id=__codelineno-0-82 name=__codelineno-0-82></a>        <span class=p>}</span>
</span><span id=__span-0-83><a id=__codelineno-0-83 name=__codelineno-0-83></a>
</span><span id=__span-0-84><a id=__codelineno-0-84 name=__codelineno-0-84></a>        <span class=n>data</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;agent_name&quot;</span><span class=p>:</span> <span class=n>agent_name</span><span class=p>}</span>
</span><span id=__span-0-85><a id=__codelineno-0-85 name=__codelineno-0-85></a>
</span><span id=__span-0-86><a id=__codelineno-0-86 name=__codelineno-0-86></a>        <span class=n>endpoint</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>/get_agent_public_key&quot;</span>
</span><span id=__span-0-87><a id=__codelineno-0-87 name=__codelineno-0-87></a>
</span><span id=__span-0-88><a id=__codelineno-0-88 name=__codelineno-0-88></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-89><a id=__codelineno-0-89 name=__codelineno-0-89></a>            <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>endpoint</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>,</span> <span class=n>params</span><span class=o>=</span><span class=n>data</span><span class=p>)</span>
</span><span id=__span-0-90><a id=__codelineno-0-90 name=__codelineno-0-90></a>            <span class=n>response</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
</span><span id=__span-0-91><a id=__codelineno-0-91 name=__codelineno-0-91></a>            <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span><span id=__span-0-92><a id=__codelineno-0-92 name=__codelineno-0-92></a>        <span class=k>except</span> <span class=n>requests</span><span class=o>.</span><span class=n>RequestException</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-93><a id=__codelineno-0-93 name=__codelineno-0-93></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Failed to get agent public key: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span> <span class=kn>from</span><span class=w> </span><span class=kc>None</span>
</span><span id=__span-0-94><a id=__codelineno-0-94 name=__codelineno-0-94></a>
</span><span id=__span-0-95><a id=__codelineno-0-95 name=__codelineno-0-95></a>    <span class=k>def</span><span class=w> </span><span class=nf>completions</span><span class=p>(</span>
</span><span id=__span-0-96><a id=__codelineno-0-96 name=__codelineno-0-96></a>        <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-97><a id=__codelineno-0-97 name=__codelineno-0-97></a>        <span class=n>model</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-98><a id=__codelineno-0-98 name=__codelineno-0-98></a>        <span class=n>messages</span><span class=p>:</span> <span class=n>Iterable</span><span class=p>[</span><span class=n>ChatCompletionMessageParam</span><span class=p>],</span>
</span><span id=__span-0-99><a id=__codelineno-0-99 name=__codelineno-0-99></a>        <span class=n>stream</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-100><a id=__codelineno-0-100 name=__codelineno-0-100></a>        <span class=n>temperature</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>float</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-101><a id=__codelineno-0-101 name=__codelineno-0-101></a>        <span class=n>max_tokens</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-102><a id=__codelineno-0-102 name=__codelineno-0-102></a>        <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span>
</span><span id=__span-0-103><a id=__codelineno-0-103 name=__codelineno-0-103></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span><span class=n>ModelResponse</span><span class=p>,</span> <span class=n>CustomStreamWrapper</span><span class=p>]:</span>
</span><span id=__span-0-104><a id=__codelineno-0-104 name=__codelineno-0-104></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Takes a `model` and `messages` and returns completions.</span>
</span><span id=__span-0-105><a id=__codelineno-0-105 name=__codelineno-0-105></a>
</span><span id=__span-0-106><a id=__codelineno-0-106 name=__codelineno-0-106></a><span class=sd>        `model` can be:</span>
</span><span id=__span-0-107><a id=__codelineno-0-107 name=__codelineno-0-107></a><span class=sd>        1. full path `provider::model_full_path`.</span>
</span><span id=__span-0-108><a id=__codelineno-0-108 name=__codelineno-0-108></a><span class=sd>        2. `model_short_name`. Default provider will be used.</span>
</span><span id=__span-0-109><a id=__codelineno-0-109 name=__codelineno-0-109></a><span class=sd>        &quot;&quot;&quot;</span>
</span><span id=__span-0-110><a id=__codelineno-0-110 name=__codelineno-0-110></a>        <span class=n>provider</span><span class=p>,</span> <span class=n>model</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>provider_models</span><span class=o>.</span><span class=n>match_provider_model</span><span class=p>(</span><span class=n>model</span><span class=p>)</span>
</span><span id=__span-0-111><a id=__codelineno-0-111 name=__codelineno-0-111></a>
</span><span id=__span-0-112><a id=__codelineno-0-112 name=__codelineno-0-112></a>        <span class=k>if</span> <span class=n>temperature</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-113><a id=__codelineno-0-113 name=__codelineno-0-113></a>            <span class=n>temperature</span> <span class=o>=</span> <span class=n>DEFAULT_MODEL_TEMPERATURE</span>
</span><span id=__span-0-114><a id=__codelineno-0-114 name=__codelineno-0-114></a>
</span><span id=__span-0-115><a id=__codelineno-0-115 name=__codelineno-0-115></a>        <span class=k>if</span> <span class=n>max_tokens</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-116><a id=__codelineno-0-116 name=__codelineno-0-116></a>            <span class=n>max_tokens</span> <span class=o>=</span> <span class=n>DEFAULT_MODEL_MAX_TOKENS</span>
</span><span id=__span-0-117><a id=__codelineno-0-117 name=__codelineno-0-117></a>
</span><span id=__span-0-118><a id=__codelineno-0-118 name=__codelineno-0-118></a>        <span class=c1># NOTE(#246): this is to disable &quot;Provider List&quot; messages.</span>
</span><span id=__span-0-119><a id=__codelineno-0-119 name=__codelineno-0-119></a>        <span class=n>litellm</span><span class=o>.</span><span class=n>suppress_debug_info</span> <span class=o>=</span> <span class=kc>True</span>
</span><span id=__span-0-120><a id=__codelineno-0-120 name=__codelineno-0-120></a>
</span><span id=__span-0-121><a id=__codelineno-0-121 name=__codelineno-0-121></a>        <span class=c1># lite_llm uses the openai.request_timeout to set the timeout for the request of &quot;openai&quot; custom provider</span>
</span><span id=__span-0-122><a id=__codelineno-0-122 name=__codelineno-0-122></a>        <span class=n>openai</span><span class=o>.</span><span class=n>timeout</span> <span class=o>=</span> <span class=n>DEFAULT_TIMEOUT</span>
</span><span id=__span-0-123><a id=__codelineno-0-123 name=__codelineno-0-123></a>        <span class=n>openai</span><span class=o>.</span><span class=n>max_retries</span> <span class=o>=</span> <span class=n>DEFAULT_MAX_RETRIES</span>
</span><span id=__span-0-124><a id=__codelineno-0-124 name=__codelineno-0-124></a>
</span><span id=__span-0-125><a id=__codelineno-0-125 name=__codelineno-0-125></a>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>num_inference_retries</span><span class=p>):</span>
</span><span id=__span-0-126><a id=__codelineno-0-126 name=__codelineno-0-126></a>            <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-127><a id=__codelineno-0-127 name=__codelineno-0-127></a>                <span class=n>result</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>ModelResponse</span><span class=p>,</span> <span class=n>CustomStreamWrapper</span><span class=p>]</span> <span class=o>=</span> <span class=n>litellm_completion</span><span class=p>(</span>
</span><span id=__span-0-128><a id=__codelineno-0-128 name=__codelineno-0-128></a>                    <span class=n>model</span><span class=p>,</span>
</span><span id=__span-0-129><a id=__codelineno-0-129 name=__codelineno-0-129></a>                    <span class=n>messages</span><span class=p>,</span>
</span><span id=__span-0-130><a id=__codelineno-0-130 name=__codelineno-0-130></a>                    <span class=n>stream</span><span class=o>=</span><span class=n>stream</span><span class=p>,</span>
</span><span id=__span-0-131><a id=__codelineno-0-131 name=__codelineno-0-131></a>                    <span class=n>custom_llm_provider</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>custom_llm_provider</span><span class=p>,</span>
</span><span id=__span-0-132><a id=__codelineno-0-132 name=__codelineno-0-132></a>                    <span class=n>input_cost_per_token</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
</span><span id=__span-0-133><a id=__codelineno-0-133 name=__codelineno-0-133></a>                    <span class=n>output_cost_per_token</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
</span><span id=__span-0-134><a id=__codelineno-0-134 name=__codelineno-0-134></a>                    <span class=n>temperature</span><span class=o>=</span><span class=n>temperature</span><span class=p>,</span>
</span><span id=__span-0-135><a id=__codelineno-0-135 name=__codelineno-0-135></a>                    <span class=n>max_tokens</span><span class=o>=</span><span class=n>max_tokens</span><span class=p>,</span>
</span><span id=__span-0-136><a id=__codelineno-0-136 name=__codelineno-0-136></a>                    <span class=n>base_url</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>base_url</span><span class=p>,</span>
</span><span id=__span-0-137><a id=__codelineno-0-137 name=__codelineno-0-137></a>                    <span class=n>provider</span><span class=o>=</span><span class=n>provider</span><span class=p>,</span>
</span><span id=__span-0-138><a id=__codelineno-0-138 name=__codelineno-0-138></a>                    <span class=n>api_key</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_auth</span><span class=p>,</span>
</span><span id=__span-0-139><a id=__codelineno-0-139 name=__codelineno-0-139></a>                    <span class=n>timeout</span><span class=o>=</span><span class=n>DEFAULT_TIMEOUT</span><span class=p>,</span>
</span><span id=__span-0-140><a id=__codelineno-0-140 name=__codelineno-0-140></a>                    <span class=n>request_timeout</span><span class=o>=</span><span class=n>DEFAULT_TIMEOUT</span><span class=p>,</span>
</span><span id=__span-0-141><a id=__codelineno-0-141 name=__codelineno-0-141></a>                    <span class=n>num_retries</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span>
</span><span id=__span-0-142><a id=__codelineno-0-142 name=__codelineno-0-142></a>                    <span class=o>**</span><span class=n>kwargs</span><span class=p>,</span>
</span><span id=__span-0-143><a id=__codelineno-0-143 name=__codelineno-0-143></a>                <span class=p>)</span>
</span><span id=__span-0-144><a id=__codelineno-0-144 name=__codelineno-0-144></a>                <span class=k>break</span>
</span><span id=__span-0-145><a id=__codelineno-0-145 name=__codelineno-0-145></a>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-146><a id=__codelineno-0-146 name=__codelineno-0-146></a>                <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Completions exception:&quot;</span><span class=p>,</span> <span class=n>e</span><span class=p>)</span>
</span><span id=__span-0-147><a id=__codelineno-0-147 name=__codelineno-0-147></a>                <span class=k>if</span> <span class=n>i</span> <span class=o>==</span> <span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>num_inference_retries</span> <span class=o>-</span> <span class=mi>1</span><span class=p>:</span>
</span><span id=__span-0-148><a id=__codelineno-0-148 name=__codelineno-0-148></a>                    <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Bad request: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span> <span class=kn>from</span><span class=w> </span><span class=kc>None</span>
</span><span id=__span-0-149><a id=__codelineno-0-149 name=__codelineno-0-149></a>                <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-150><a id=__codelineno-0-150 name=__codelineno-0-150></a>                    <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Retrying...&quot;</span><span class=p>)</span>
</span><span id=__span-0-151><a id=__codelineno-0-151 name=__codelineno-0-151></a>
</span><span id=__span-0-152><a id=__codelineno-0-152 name=__codelineno-0-152></a>        <span class=k>return</span> <span class=n>result</span>
</span><span id=__span-0-153><a id=__codelineno-0-153 name=__codelineno-0-153></a>
</span><span id=__span-0-154><a id=__codelineno-0-154 name=__codelineno-0-154></a>    <span class=k>def</span><span class=w> </span><span class=nf>query_vector_store</span><span class=p>(</span>
</span><span id=__span-0-155><a id=__codelineno-0-155 name=__codelineno-0-155></a>        <span class=bp>self</span><span class=p>,</span> <span class=n>vector_store_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>query</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>full_files</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span>
</span><span id=__span-0-156><a id=__codelineno-0-156 name=__codelineno-0-156></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=n>SimilaritySearch</span><span class=p>],</span> <span class=n>List</span><span class=p>[</span><span class=n>SimilaritySearchFile</span><span class=p>]]:</span>
</span><span id=__span-0-157><a id=__codelineno-0-157 name=__codelineno-0-157></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Query a vector store.&quot;&quot;&quot;</span>
</span><span id=__span-0-158><a id=__codelineno-0-158 name=__codelineno-0-158></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_config</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-159><a id=__codelineno-0-159 name=__codelineno-0-159></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Missing NEAR AI Hub config&quot;</span><span class=p>)</span>
</span><span id=__span-0-160><a id=__codelineno-0-160 name=__codelineno-0-160></a>
</span><span id=__span-0-161><a id=__codelineno-0-161 name=__codelineno-0-161></a>        <span class=n>auth_bearer_token</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_auth</span>
</span><span id=__span-0-162><a id=__codelineno-0-162 name=__codelineno-0-162></a>
</span><span id=__span-0-163><a id=__codelineno-0-163 name=__codelineno-0-163></a>        <span class=n>headers</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-164><a id=__codelineno-0-164 name=__codelineno-0-164></a>            <span class=s2>&quot;Content-Type&quot;</span><span class=p>:</span> <span class=s2>&quot;application/json&quot;</span><span class=p>,</span>
</span><span id=__span-0-165><a id=__codelineno-0-165 name=__codelineno-0-165></a>            <span class=s2>&quot;Authorization&quot;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;Bearer </span><span class=si>{</span><span class=n>auth_bearer_token</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-0-166><a id=__codelineno-0-166 name=__codelineno-0-166></a>        <span class=p>}</span>
</span><span id=__span-0-167><a id=__codelineno-0-167 name=__codelineno-0-167></a>
</span><span id=__span-0-168><a id=__codelineno-0-168 name=__codelineno-0-168></a>        <span class=n>data</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;query&quot;</span><span class=p>:</span> <span class=n>query</span><span class=p>,</span> <span class=s2>&quot;full_files&quot;</span><span class=p>:</span> <span class=n>full_files</span><span class=p>}</span>
</span><span id=__span-0-169><a id=__codelineno-0-169 name=__codelineno-0-169></a>
</span><span id=__span-0-170><a id=__codelineno-0-170 name=__codelineno-0-170></a>        <span class=n>endpoint</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>/vector_stores/</span><span class=si>{</span><span class=n>vector_store_id</span><span class=si>}</span><span class=s2>/search&quot;</span>
</span><span id=__span-0-171><a id=__codelineno-0-171 name=__codelineno-0-171></a>
</span><span id=__span-0-172><a id=__codelineno-0-172 name=__codelineno-0-172></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-173><a id=__codelineno-0-173 name=__codelineno-0-173></a>            <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>endpoint</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>,</span> <span class=n>json</span><span class=o>=</span><span class=n>data</span><span class=p>)</span>
</span><span id=__span-0-174><a id=__codelineno-0-174 name=__codelineno-0-174></a>            <span class=n>response</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
</span><span id=__span-0-175><a id=__codelineno-0-175 name=__codelineno-0-175></a>            <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span><span id=__span-0-176><a id=__codelineno-0-176 name=__codelineno-0-176></a>        <span class=k>except</span> <span class=n>requests</span><span class=o>.</span><span class=n>RequestException</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-177><a id=__codelineno-0-177 name=__codelineno-0-177></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error querying vector store: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span> <span class=kn>from</span><span class=w> </span><span class=kc>None</span>
</span><span id=__span-0-178><a id=__codelineno-0-178 name=__codelineno-0-178></a>
</span><span id=__span-0-179><a id=__codelineno-0-179 name=__codelineno-0-179></a>    <span class=k>def</span><span class=w> </span><span class=nf>upload_file</span><span class=p>(</span>
</span><span id=__span-0-180><a id=__codelineno-0-180 name=__codelineno-0-180></a>        <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-181><a id=__codelineno-0-181 name=__codelineno-0-181></a>        <span class=n>file_content</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-182><a id=__codelineno-0-182 name=__codelineno-0-182></a>        <span class=n>purpose</span><span class=p>:</span> <span class=n>Literal</span><span class=p>[</span><span class=s2>&quot;assistants&quot;</span><span class=p>,</span> <span class=s2>&quot;batch&quot;</span><span class=p>,</span> <span class=s2>&quot;fine-tune&quot;</span><span class=p>,</span> <span class=s2>&quot;vision&quot;</span><span class=p>],</span>
</span><span id=__span-0-183><a id=__codelineno-0-183 name=__codelineno-0-183></a>        <span class=n>encoding</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;utf-8&quot;</span><span class=p>,</span>
</span><span id=__span-0-184><a id=__codelineno-0-184 name=__codelineno-0-184></a>        <span class=n>file_name</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;file.txt&quot;</span><span class=p>,</span>
</span><span id=__span-0-185><a id=__codelineno-0-185 name=__codelineno-0-185></a>        <span class=n>file_type</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;text/plain&quot;</span><span class=p>,</span>
</span><span id=__span-0-186><a id=__codelineno-0-186 name=__codelineno-0-186></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>FileObject</span><span class=p>]:</span>
</span><span id=__span-0-187><a id=__codelineno-0-187 name=__codelineno-0-187></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Uploads a file.&quot;&quot;&quot;</span>
</span><span id=__span-0-188><a id=__codelineno-0-188 name=__codelineno-0-188></a>        <span class=n>client</span> <span class=o>=</span> <span class=n>openai</span><span class=o>.</span><span class=n>OpenAI</span><span class=p>(</span><span class=n>base_url</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>base_url</span><span class=p>,</span> <span class=n>api_key</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_auth</span><span class=p>)</span>
</span><span id=__span-0-189><a id=__codelineno-0-189 name=__codelineno-0-189></a>        <span class=k>if</span> <span class=n>file_content</span><span class=p>:</span>
</span><span id=__span-0-190><a id=__codelineno-0-190 name=__codelineno-0-190></a>            <span class=n>file_data</span> <span class=o>=</span> <span class=n>io</span><span class=o>.</span><span class=n>BytesIO</span><span class=p>(</span><span class=n>file_content</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=n>encoding</span> <span class=ow>or</span> <span class=s2>&quot;utf-8&quot;</span><span class=p>))</span>
</span><span id=__span-0-191><a id=__codelineno-0-191 name=__codelineno-0-191></a>            <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>files</span><span class=o>.</span><span class=n>create</span><span class=p>(</span><span class=n>file</span><span class=o>=</span><span class=p>(</span><span class=n>file_name</span><span class=p>,</span> <span class=n>file_data</span><span class=p>,</span> <span class=n>file_type</span><span class=p>),</span> <span class=n>purpose</span><span class=o>=</span><span class=n>purpose</span><span class=p>)</span>
</span><span id=__span-0-192><a id=__codelineno-0-192 name=__codelineno-0-192></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-193><a id=__codelineno-0-193 name=__codelineno-0-193></a>            <span class=k>return</span> <span class=kc>None</span>
</span><span id=__span-0-194><a id=__codelineno-0-194 name=__codelineno-0-194></a>
</span><span id=__span-0-195><a id=__codelineno-0-195 name=__codelineno-0-195></a>    <span class=k>def</span><span class=w> </span><span class=nf>remove_file</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>file_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-196><a id=__codelineno-0-196 name=__codelineno-0-196></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Removes a file.&quot;&quot;&quot;</span>
</span><span id=__span-0-197><a id=__codelineno-0-197 name=__codelineno-0-197></a>        <span class=n>client</span> <span class=o>=</span> <span class=n>openai</span><span class=o>.</span><span class=n>OpenAI</span><span class=p>(</span><span class=n>base_url</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>base_url</span><span class=p>,</span> <span class=n>api_key</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_auth</span><span class=p>)</span>
</span><span id=__span-0-198><a id=__codelineno-0-198 name=__codelineno-0-198></a>        <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>files</span><span class=o>.</span><span class=n>delete</span><span class=p>(</span><span class=n>file_id</span><span class=o>=</span><span class=n>file_id</span><span class=p>)</span>
</span><span id=__span-0-199><a id=__codelineno-0-199 name=__codelineno-0-199></a>
</span><span id=__span-0-200><a id=__codelineno-0-200 name=__codelineno-0-200></a>    <span class=k>def</span><span class=w> </span><span class=nf>add_file_to_vector_store</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>vector_store_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>file_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>VectorStoreFile</span><span class=p>:</span>
</span><span id=__span-0-201><a id=__codelineno-0-201 name=__codelineno-0-201></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Adds a file to vector store.&quot;&quot;&quot;</span>
</span><span id=__span-0-202><a id=__codelineno-0-202 name=__codelineno-0-202></a>        <span class=n>client</span> <span class=o>=</span> <span class=n>openai</span><span class=o>.</span><span class=n>OpenAI</span><span class=p>(</span><span class=n>base_url</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>base_url</span><span class=p>,</span> <span class=n>api_key</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_auth</span><span class=p>)</span>
</span><span id=__span-0-203><a id=__codelineno-0-203 name=__codelineno-0-203></a>        <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>vector_stores</span><span class=o>.</span><span class=n>files</span><span class=o>.</span><span class=n>create</span><span class=p>(</span><span class=n>vector_store_id</span><span class=o>=</span><span class=n>vector_store_id</span><span class=p>,</span> <span class=n>file_id</span><span class=o>=</span><span class=n>file_id</span><span class=p>)</span>
</span><span id=__span-0-204><a id=__codelineno-0-204 name=__codelineno-0-204></a>
</span><span id=__span-0-205><a id=__codelineno-0-205 name=__codelineno-0-205></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_vector_store_files</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>vector_store_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=n>VectorStoreFile</span><span class=p>]]:</span>
</span><span id=__span-0-206><a id=__codelineno-0-206 name=__codelineno-0-206></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Adds a file to vector store.&quot;&quot;&quot;</span>
</span><span id=__span-0-207><a id=__codelineno-0-207 name=__codelineno-0-207></a>        <span class=n>client</span> <span class=o>=</span> <span class=n>openai</span><span class=o>.</span><span class=n>OpenAI</span><span class=p>(</span><span class=n>base_url</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>base_url</span><span class=p>,</span> <span class=n>api_key</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_auth</span><span class=p>)</span>
</span><span id=__span-0-208><a id=__codelineno-0-208 name=__codelineno-0-208></a>        <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>vector_stores</span><span class=o>.</span><span class=n>files</span><span class=o>.</span><span class=n>list</span><span class=p>(</span><span class=n>vector_store_id</span><span class=o>=</span><span class=n>vector_store_id</span><span class=p>)</span><span class=o>.</span><span class=n>data</span>
</span><span id=__span-0-209><a id=__codelineno-0-209 name=__codelineno-0-209></a>
</span><span id=__span-0-210><a id=__codelineno-0-210 name=__codelineno-0-210></a>    <span class=k>def</span><span class=w> </span><span class=nf>create_vector_store_from_source</span><span class=p>(</span>
</span><span id=__span-0-211><a id=__codelineno-0-211 name=__codelineno-0-211></a>        <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-212><a id=__codelineno-0-212 name=__codelineno-0-212></a>        <span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-213><a id=__codelineno-0-213 name=__codelineno-0-213></a>        <span class=n>source</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>GitHubSource</span><span class=p>,</span> <span class=n>GitLabSource</span><span class=p>],</span>
</span><span id=__span-0-214><a id=__codelineno-0-214 name=__codelineno-0-214></a>        <span class=n>source_auth</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-215><a id=__codelineno-0-215 name=__codelineno-0-215></a>        <span class=n>chunking_strategy</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>ChunkingStrategy</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-216><a id=__codelineno-0-216 name=__codelineno-0-216></a>        <span class=n>expires_after</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>ExpiresAfter</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-217><a id=__codelineno-0-217 name=__codelineno-0-217></a>        <span class=n>metadata</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-218><a id=__codelineno-0-218 name=__codelineno-0-218></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>VectorStore</span><span class=p>:</span>
</span><span id=__span-0-219><a id=__codelineno-0-219 name=__codelineno-0-219></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Creates a vector store from the given source.</span>
</span><span id=__span-0-220><a id=__codelineno-0-220 name=__codelineno-0-220></a>
</span><span id=__span-0-221><a id=__codelineno-0-221 name=__codelineno-0-221></a><span class=sd>        Args:</span>
</span><span id=__span-0-222><a id=__codelineno-0-222 name=__codelineno-0-222></a><span class=sd>        ----</span>
</span><span id=__span-0-223><a id=__codelineno-0-223 name=__codelineno-0-223></a><span class=sd>            name (str): The name of the vector store.</span>
</span><span id=__span-0-224><a id=__codelineno-0-224 name=__codelineno-0-224></a><span class=sd>            source (Union[GitHubSource, GitLabSource]): The source from which to create the vector store.</span>
</span><span id=__span-0-225><a id=__codelineno-0-225 name=__codelineno-0-225></a><span class=sd>            source_auth (Optional[str]): The source authentication token.</span>
</span><span id=__span-0-226><a id=__codelineno-0-226 name=__codelineno-0-226></a><span class=sd>            chunking_strategy (Optional[ChunkingStrategy]): The chunking strategy to use.</span>
</span><span id=__span-0-227><a id=__codelineno-0-227 name=__codelineno-0-227></a><span class=sd>            expires_after (Optional[ExpiresAfter]): The expiration policy.</span>
</span><span id=__span-0-228><a id=__codelineno-0-228 name=__codelineno-0-228></a><span class=sd>            metadata (Optional[Dict[str, str]]): Additional metadata.</span>
</span><span id=__span-0-229><a id=__codelineno-0-229 name=__codelineno-0-229></a>
</span><span id=__span-0-230><a id=__codelineno-0-230 name=__codelineno-0-230></a><span class=sd>        Returns:</span>
</span><span id=__span-0-231><a id=__codelineno-0-231 name=__codelineno-0-231></a><span class=sd>        -------</span>
</span><span id=__span-0-232><a id=__codelineno-0-232 name=__codelineno-0-232></a><span class=sd>            VectorStore: The created vector store.</span>
</span><span id=__span-0-233><a id=__codelineno-0-233 name=__codelineno-0-233></a>
</span><span id=__span-0-234><a id=__codelineno-0-234 name=__codelineno-0-234></a><span class=sd>        &quot;&quot;&quot;</span>
</span><span id=__span-0-235><a id=__codelineno-0-235 name=__codelineno-0-235></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Creating vector store from source: </span><span class=si>{</span><span class=n>source</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-236><a id=__codelineno-0-236 name=__codelineno-0-236></a>        <span class=n>headers</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-237><a id=__codelineno-0-237 name=__codelineno-0-237></a>            <span class=s2>&quot;Authorization&quot;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;Bearer </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>_auth</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-0-238><a id=__codelineno-0-238 name=__codelineno-0-238></a>            <span class=s2>&quot;Content-Type&quot;</span><span class=p>:</span> <span class=s2>&quot;application/json&quot;</span><span class=p>,</span>
</span><span id=__span-0-239><a id=__codelineno-0-239 name=__codelineno-0-239></a>        <span class=p>}</span>
</span><span id=__span-0-240><a id=__codelineno-0-240 name=__codelineno-0-240></a>        <span class=n>data</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-241><a id=__codelineno-0-241 name=__codelineno-0-241></a>            <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=n>name</span><span class=p>,</span>
</span><span id=__span-0-242><a id=__codelineno-0-242 name=__codelineno-0-242></a>            <span class=s2>&quot;source&quot;</span><span class=p>:</span> <span class=n>source</span><span class=p>,</span>
</span><span id=__span-0-243><a id=__codelineno-0-243 name=__codelineno-0-243></a>            <span class=s2>&quot;source_auth&quot;</span><span class=p>:</span> <span class=n>source_auth</span><span class=p>,</span>
</span><span id=__span-0-244><a id=__codelineno-0-244 name=__codelineno-0-244></a>            <span class=s2>&quot;chunking_strategy&quot;</span><span class=p>:</span> <span class=n>chunking_strategy</span><span class=p>,</span>
</span><span id=__span-0-245><a id=__codelineno-0-245 name=__codelineno-0-245></a>            <span class=s2>&quot;expires_after&quot;</span><span class=p>:</span> <span class=n>expires_after</span><span class=p>,</span>
</span><span id=__span-0-246><a id=__codelineno-0-246 name=__codelineno-0-246></a>            <span class=s2>&quot;metadata&quot;</span><span class=p>:</span> <span class=n>metadata</span><span class=p>,</span>
</span><span id=__span-0-247><a id=__codelineno-0-247 name=__codelineno-0-247></a>        <span class=p>}</span>
</span><span id=__span-0-248><a id=__codelineno-0-248 name=__codelineno-0-248></a>        <span class=n>endpoint</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>/vector_stores/from_source&quot;</span>
</span><span id=__span-0-249><a id=__codelineno-0-249 name=__codelineno-0-249></a>
</span><span id=__span-0-250><a id=__codelineno-0-250 name=__codelineno-0-250></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-251><a id=__codelineno-0-251 name=__codelineno-0-251></a>            <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>endpoint</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>,</span> <span class=n>json</span><span class=o>=</span><span class=n>data</span><span class=p>)</span>
</span><span id=__span-0-252><a id=__codelineno-0-252 name=__codelineno-0-252></a>            <span class=nb>print</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>())</span>
</span><span id=__span-0-253><a id=__codelineno-0-253 name=__codelineno-0-253></a>            <span class=n>response</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
</span><span id=__span-0-254><a id=__codelineno-0-254 name=__codelineno-0-254></a>            <span class=k>return</span> <span class=n>VectorStore</span><span class=p>(</span><span class=o>**</span><span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>())</span>
</span><span id=__span-0-255><a id=__codelineno-0-255 name=__codelineno-0-255></a>        <span class=k>except</span> <span class=n>requests</span><span class=o>.</span><span class=n>RequestException</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-256><a id=__codelineno-0-256 name=__codelineno-0-256></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Failed to create vector store: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span> <span class=kn>from</span><span class=w> </span><span class=kc>None</span>
</span><span id=__span-0-257><a id=__codelineno-0-257 name=__codelineno-0-257></a>
</span><span id=__span-0-258><a id=__codelineno-0-258 name=__codelineno-0-258></a>    <span class=k>def</span><span class=w> </span><span class=nf>create_vector_store</span><span class=p>(</span>
</span><span id=__span-0-259><a id=__codelineno-0-259 name=__codelineno-0-259></a>        <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-260><a id=__codelineno-0-260 name=__codelineno-0-260></a>        <span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-261><a id=__codelineno-0-261 name=__codelineno-0-261></a>        <span class=n>file_ids</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>],</span>
</span><span id=__span-0-262><a id=__codelineno-0-262 name=__codelineno-0-262></a>        <span class=n>expires_after</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>ExpiresAfter</span><span class=p>,</span> <span class=n>NotGiven</span><span class=p>]</span> <span class=o>=</span> <span class=n>NOT_GIVEN</span><span class=p>,</span>
</span><span id=__span-0-263><a id=__codelineno-0-263 name=__codelineno-0-263></a>        <span class=n>chunking_strategy</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span>
</span><span id=__span-0-264><a id=__codelineno-0-264 name=__codelineno-0-264></a>            <span class=n>AutoFileChunkingStrategyParam</span><span class=p>,</span> <span class=n>StaticFileChunkingStrategyObjectParam</span><span class=p>,</span> <span class=n>NotGiven</span>
</span><span id=__span-0-265><a id=__codelineno-0-265 name=__codelineno-0-265></a>        <span class=p>]</span> <span class=o>=</span> <span class=n>NOT_GIVEN</span><span class=p>,</span>
</span><span id=__span-0-266><a id=__codelineno-0-266 name=__codelineno-0-266></a>        <span class=n>metadata</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-267><a id=__codelineno-0-267 name=__codelineno-0-267></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>VectorStore</span><span class=p>:</span>
</span><span id=__span-0-268><a id=__codelineno-0-268 name=__codelineno-0-268></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Creates Vector Store.</span>
</span><span id=__span-0-269><a id=__codelineno-0-269 name=__codelineno-0-269></a>
</span><span id=__span-0-270><a id=__codelineno-0-270 name=__codelineno-0-270></a><span class=sd>        :param name: Vector store name.</span>
</span><span id=__span-0-271><a id=__codelineno-0-271 name=__codelineno-0-271></a><span class=sd>        :param file_ids: Files to be added to the vector store.</span>
</span><span id=__span-0-272><a id=__codelineno-0-272 name=__codelineno-0-272></a><span class=sd>        :param expires_after: Expiration policy.</span>
</span><span id=__span-0-273><a id=__codelineno-0-273 name=__codelineno-0-273></a><span class=sd>        :param chunking_strategy: Chunking strategy.</span>
</span><span id=__span-0-274><a id=__codelineno-0-274 name=__codelineno-0-274></a><span class=sd>        :param metadata: Additional metadata.</span>
</span><span id=__span-0-275><a id=__codelineno-0-275 name=__codelineno-0-275></a><span class=sd>        :return: Returns the created vector store or error.</span>
</span><span id=__span-0-276><a id=__codelineno-0-276 name=__codelineno-0-276></a><span class=sd>        &quot;&quot;&quot;</span>
</span><span id=__span-0-277><a id=__codelineno-0-277 name=__codelineno-0-277></a>        <span class=n>client</span> <span class=o>=</span> <span class=n>openai</span><span class=o>.</span><span class=n>OpenAI</span><span class=p>(</span><span class=n>base_url</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>base_url</span><span class=p>,</span> <span class=n>api_key</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_auth</span><span class=p>)</span>
</span><span id=__span-0-278><a id=__codelineno-0-278 name=__codelineno-0-278></a>        <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>vector_stores</span><span class=o>.</span><span class=n>create</span><span class=p>(</span>
</span><span id=__span-0-279><a id=__codelineno-0-279 name=__codelineno-0-279></a>            <span class=n>file_ids</span><span class=o>=</span><span class=n>file_ids</span><span class=p>,</span>
</span><span id=__span-0-280><a id=__codelineno-0-280 name=__codelineno-0-280></a>            <span class=n>name</span><span class=o>=</span><span class=n>name</span><span class=p>,</span>
</span><span id=__span-0-281><a id=__codelineno-0-281 name=__codelineno-0-281></a>            <span class=n>expires_after</span><span class=o>=</span><span class=n>expires_after</span><span class=p>,</span>
</span><span id=__span-0-282><a id=__codelineno-0-282 name=__codelineno-0-282></a>            <span class=n>chunking_strategy</span><span class=o>=</span><span class=n>chunking_strategy</span><span class=p>,</span>
</span><span id=__span-0-283><a id=__codelineno-0-283 name=__codelineno-0-283></a>            <span class=n>metadata</span><span class=o>=</span><span class=n>metadata</span><span class=p>,</span>
</span><span id=__span-0-284><a id=__codelineno-0-284 name=__codelineno-0-284></a>        <span class=p>)</span>
</span><span id=__span-0-285><a id=__codelineno-0-285 name=__codelineno-0-285></a>
</span><span id=__span-0-286><a id=__codelineno-0-286 name=__codelineno-0-286></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_vector_store</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>vector_store_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>VectorStore</span><span class=p>:</span>
</span><span id=__span-0-287><a id=__codelineno-0-287 name=__codelineno-0-287></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Gets a vector store by id.&quot;&quot;&quot;</span>
</span><span id=__span-0-288><a id=__codelineno-0-288 name=__codelineno-0-288></a>        <span class=n>endpoint</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>/vector_stores/</span><span class=si>{</span><span class=n>vector_store_id</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-289><a id=__codelineno-0-289 name=__codelineno-0-289></a>        <span class=n>auth_bearer_token</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_auth</span>
</span><span id=__span-0-290><a id=__codelineno-0-290 name=__codelineno-0-290></a>
</span><span id=__span-0-291><a id=__codelineno-0-291 name=__codelineno-0-291></a>        <span class=n>headers</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-292><a id=__codelineno-0-292 name=__codelineno-0-292></a>            <span class=s2>&quot;Content-Type&quot;</span><span class=p>:</span> <span class=s2>&quot;application/json&quot;</span><span class=p>,</span>
</span><span id=__span-0-293><a id=__codelineno-0-293 name=__codelineno-0-293></a>            <span class=s2>&quot;Authorization&quot;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;Bearer </span><span class=si>{</span><span class=n>auth_bearer_token</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-0-294><a id=__codelineno-0-294 name=__codelineno-0-294></a>        <span class=p>}</span>
</span><span id=__span-0-295><a id=__codelineno-0-295 name=__codelineno-0-295></a>
</span><span id=__span-0-296><a id=__codelineno-0-296 name=__codelineno-0-296></a>        <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>endpoint</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span>
</span><span id=__span-0-297><a id=__codelineno-0-297 name=__codelineno-0-297></a>        <span class=n>response</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
</span><span id=__span-0-298><a id=__codelineno-0-298 name=__codelineno-0-298></a>        <span class=k>return</span> <span class=n>VectorStore</span><span class=p>(</span><span class=o>**</span><span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>())</span>
</span><span id=__span-0-299><a id=__codelineno-0-299 name=__codelineno-0-299></a>
</span><span id=__span-0-300><a id=__codelineno-0-300 name=__codelineno-0-300></a>    <span class=k>def</span><span class=w> </span><span class=nf>create_thread</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>messages</span><span class=p>):</span>
</span><span id=__span-0-301><a id=__codelineno-0-301 name=__codelineno-0-301></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Create a thread.&quot;&quot;&quot;</span>
</span><span id=__span-0-302><a id=__codelineno-0-302 name=__codelineno-0-302></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>create</span><span class=p>(</span><span class=n>messages</span><span class=o>=</span><span class=n>messages</span><span class=p>)</span>
</span><span id=__span-0-303><a id=__codelineno-0-303 name=__codelineno-0-303></a>
</span><span id=__span-0-304><a id=__codelineno-0-304 name=__codelineno-0-304></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_thread</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>thread_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-305><a id=__codelineno-0-305 name=__codelineno-0-305></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Get a thread.&quot;&quot;&quot;</span>
</span><span id=__span-0-306><a id=__codelineno-0-306 name=__codelineno-0-306></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>retrieve</span><span class=p>(</span><span class=n>thread_id</span><span class=o>=</span><span class=n>thread_id</span><span class=p>)</span>
</span><span id=__span-0-307><a id=__codelineno-0-307 name=__codelineno-0-307></a>
</span><span id=__span-0-308><a id=__codelineno-0-308 name=__codelineno-0-308></a>    <span class=k>def</span><span class=w> </span><span class=nf>threads_messages_create</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>thread_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>content</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>role</span><span class=p>:</span> <span class=n>Literal</span><span class=p>[</span><span class=s2>&quot;user&quot;</span><span class=p>,</span> <span class=s2>&quot;assistant&quot;</span><span class=p>]):</span>
</span><span id=__span-0-309><a id=__codelineno-0-309 name=__codelineno-0-309></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Create a message in a thread.&quot;&quot;&quot;</span>
</span><span id=__span-0-310><a id=__codelineno-0-310 name=__codelineno-0-310></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>messages</span><span class=o>.</span><span class=n>create</span><span class=p>(</span><span class=n>thread_id</span><span class=o>=</span><span class=n>thread_id</span><span class=p>,</span> <span class=n>content</span><span class=o>=</span><span class=n>content</span><span class=p>,</span> <span class=n>role</span><span class=o>=</span><span class=n>role</span><span class=p>)</span>
</span><span id=__span-0-311><a id=__codelineno-0-311 name=__codelineno-0-311></a>
</span><span id=__span-0-312><a id=__codelineno-0-312 name=__codelineno-0-312></a>    <span class=k>def</span><span class=w> </span><span class=nf>threads_create_and_run_poll</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>assistant_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>model</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>messages</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>ChatCompletionMessageParam</span><span class=p>]):</span>
</span><span id=__span-0-313><a id=__codelineno-0-313 name=__codelineno-0-313></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Create a thread and run the assistant.&quot;&quot;&quot;</span>
</span><span id=__span-0-314><a id=__codelineno-0-314 name=__codelineno-0-314></a>        <span class=n>thread</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>create_thread</span><span class=p>(</span><span class=n>messages</span><span class=p>)</span>
</span><span id=__span-0-315><a id=__codelineno-0-315 name=__codelineno-0-315></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>create_and_run_poll</span><span class=p>(</span><span class=n>thread</span><span class=o>=</span><span class=n>thread</span><span class=p>,</span> <span class=n>assistant_id</span><span class=o>=</span><span class=n>assistant_id</span><span class=p>,</span> <span class=n>model</span><span class=o>=</span><span class=n>model</span><span class=p>)</span>
</span><span id=__span-0-316><a id=__codelineno-0-316 name=__codelineno-0-316></a>
</span><span id=__span-0-317><a id=__codelineno-0-317 name=__codelineno-0-317></a>    <span class=k>def</span><span class=w> </span><span class=nf>threads_list_messages</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>thread_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>order</span><span class=p>:</span> <span class=n>Literal</span><span class=p>[</span><span class=s2>&quot;asc&quot;</span><span class=p>,</span> <span class=s2>&quot;desc&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;asc&quot;</span><span class=p>):</span>
</span><span id=__span-0-318><a id=__codelineno-0-318 name=__codelineno-0-318></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;List messages in a thread.&quot;&quot;&quot;</span>
</span><span id=__span-0-319><a id=__codelineno-0-319 name=__codelineno-0-319></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>messages</span><span class=o>.</span><span class=n>list</span><span class=p>(</span><span class=n>thread_id</span><span class=o>=</span><span class=n>thread_id</span><span class=p>,</span> <span class=n>order</span><span class=o>=</span><span class=n>order</span><span class=p>)</span>
</span><span id=__span-0-320><a id=__codelineno-0-320 name=__codelineno-0-320></a>
</span><span id=__span-0-321><a id=__codelineno-0-321 name=__codelineno-0-321></a>    <span class=k>def</span><span class=w> </span><span class=nf>threads_fork</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>thread_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-322><a id=__codelineno-0-322 name=__codelineno-0-322></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Fork a thread.&quot;&quot;&quot;</span>
</span><span id=__span-0-323><a id=__codelineno-0-323 name=__codelineno-0-323></a>        <span class=n>forked_thread</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>path</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>/threads/</span><span class=si>{</span><span class=n>thread_id</span><span class=si>}</span><span class=s2>/fork&quot;</span><span class=p>,</span> <span class=n>cast_to</span><span class=o>=</span><span class=n>Thread</span><span class=p>)</span>
</span><span id=__span-0-324><a id=__codelineno-0-324 name=__codelineno-0-324></a>        <span class=k>return</span> <span class=n>forked_thread</span>
</span><span id=__span-0-325><a id=__codelineno-0-325 name=__codelineno-0-325></a>
</span><span id=__span-0-326><a id=__codelineno-0-326 name=__codelineno-0-326></a>    <span class=k>def</span><span class=w> </span><span class=nf>create_subthread</span><span class=p>(</span>
</span><span id=__span-0-327><a id=__codelineno-0-327 name=__codelineno-0-327></a>        <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-328><a id=__codelineno-0-328 name=__codelineno-0-328></a>        <span class=n>thread_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-329><a id=__codelineno-0-329 name=__codelineno-0-329></a>        <span class=n>messages_to_copy</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-330><a id=__codelineno-0-330 name=__codelineno-0-330></a>        <span class=n>new_messages</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=n>ChatCompletionMessageParam</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-331><a id=__codelineno-0-331 name=__codelineno-0-331></a>    <span class=p>):</span>
</span><span id=__span-0-332><a id=__codelineno-0-332 name=__codelineno-0-332></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Create a subthread.&quot;&quot;&quot;</span>
</span><span id=__span-0-333><a id=__codelineno-0-333 name=__codelineno-0-333></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>post</span><span class=p>(</span>
</span><span id=__span-0-334><a id=__codelineno-0-334 name=__codelineno-0-334></a>            <span class=n>path</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>/threads/</span><span class=si>{</span><span class=n>thread_id</span><span class=si>}</span><span class=s2>/subthread&quot;</span><span class=p>,</span>
</span><span id=__span-0-335><a id=__codelineno-0-335 name=__codelineno-0-335></a>            <span class=n>body</span><span class=o>=</span><span class=p>{</span><span class=n>messages_to_copy</span><span class=p>:</span> <span class=n>messages_to_copy</span><span class=p>,</span> <span class=n>new_messages</span><span class=p>:</span> <span class=n>new_messages</span><span class=p>},</span>
</span><span id=__span-0-336><a id=__codelineno-0-336 name=__codelineno-0-336></a>            <span class=n>cast_to</span><span class=o>=</span><span class=n>Thread</span><span class=p>,</span>
</span><span id=__span-0-337><a id=__codelineno-0-337 name=__codelineno-0-337></a>        <span class=p>)</span>
</span><span id=__span-0-338><a id=__codelineno-0-338 name=__codelineno-0-338></a>
</span><span id=__span-0-339><a id=__codelineno-0-339 name=__codelineno-0-339></a>    <span class=k>def</span><span class=w> </span><span class=nf>threads_runs_create</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>thread_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>assistant_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>model</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-340><a id=__codelineno-0-340 name=__codelineno-0-340></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Create a run in a thread.&quot;&quot;&quot;</span>
</span><span id=__span-0-341><a id=__codelineno-0-341 name=__codelineno-0-341></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>runs</span><span class=o>.</span><span class=n>create</span><span class=p>(</span><span class=n>thread_id</span><span class=o>=</span><span class=n>thread_id</span><span class=p>,</span> <span class=n>assistant_id</span><span class=o>=</span><span class=n>assistant_id</span><span class=p>,</span> <span class=n>model</span><span class=o>=</span><span class=n>model</span><span class=p>)</span>
</span><span id=__span-0-342><a id=__codelineno-0-342 name=__codelineno-0-342></a>
</span><span id=__span-0-343><a id=__codelineno-0-343 name=__codelineno-0-343></a>    <span class=k>def</span><span class=w> </span><span class=nf>run_agent</span><span class=p>(</span>
</span><span id=__span-0-344><a id=__codelineno-0-344 name=__codelineno-0-344></a>        <span class=bp>self</span><span class=p>,</span> <span class=n>run_on_thread_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>assistant_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>parent_run_id</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>run_mode</span><span class=p>:</span> <span class=n>RunMode</span> <span class=o>=</span> <span class=n>RunMode</span><span class=o>.</span><span class=n>SIMPLE</span>
</span><span id=__span-0-345><a id=__codelineno-0-345 name=__codelineno-0-345></a>    <span class=p>):</span>
</span><span id=__span-0-346><a id=__codelineno-0-346 name=__codelineno-0-346></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Starts a child agent run from a parent agent run.&quot;&quot;&quot;</span>
</span><span id=__span-0-347><a id=__codelineno-0-347 name=__codelineno-0-347></a>        <span class=n>extra_body</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-0-348><a id=__codelineno-0-348 name=__codelineno-0-348></a>        <span class=k>if</span> <span class=n>parent_run_id</span><span class=p>:</span>
</span><span id=__span-0-349><a id=__codelineno-0-349 name=__codelineno-0-349></a>            <span class=n>extra_body</span><span class=p>[</span><span class=s2>&quot;parent_run_id&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>parent_run_id</span>
</span><span id=__span-0-350><a id=__codelineno-0-350 name=__codelineno-0-350></a>        <span class=n>extra_body</span><span class=p>[</span><span class=s2>&quot;run_mode&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>run_mode</span><span class=o>.</span><span class=n>value</span>  <span class=c1># type: ignore</span>
</span><span id=__span-0-351><a id=__codelineno-0-351 name=__codelineno-0-351></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>runs</span><span class=o>.</span><span class=n>create</span><span class=p>(</span>
</span><span id=__span-0-352><a id=__codelineno-0-352 name=__codelineno-0-352></a>            <span class=n>thread_id</span><span class=o>=</span><span class=n>run_on_thread_id</span><span class=p>,</span>
</span><span id=__span-0-353><a id=__codelineno-0-353 name=__codelineno-0-353></a>            <span class=n>assistant_id</span><span class=o>=</span><span class=n>assistant_id</span><span class=p>,</span>
</span><span id=__span-0-354><a id=__codelineno-0-354 name=__codelineno-0-354></a>            <span class=n>extra_body</span><span class=o>=</span><span class=n>extra_body</span><span class=p>,</span>
</span><span id=__span-0-355><a id=__codelineno-0-355 name=__codelineno-0-355></a>        <span class=p>)</span>
</span><span id=__span-0-356><a id=__codelineno-0-356 name=__codelineno-0-356></a>
</span><span id=__span-0-357><a id=__codelineno-0-357 name=__codelineno-0-357></a>    <span class=k>def</span><span class=w> </span><span class=nf>schedule_run</span><span class=p>(</span>
</span><span id=__span-0-358><a id=__codelineno-0-358 name=__codelineno-0-358></a>        <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-359><a id=__codelineno-0-359 name=__codelineno-0-359></a>        <span class=n>agent</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-360><a id=__codelineno-0-360 name=__codelineno-0-360></a>        <span class=n>input_message</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-361><a id=__codelineno-0-361 name=__codelineno-0-361></a>        <span class=n>thread_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>],</span>
</span><span id=__span-0-362><a id=__codelineno-0-362 name=__codelineno-0-362></a>        <span class=n>run_params</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]],</span>
</span><span id=__span-0-363><a id=__codelineno-0-363 name=__codelineno-0-363></a>        <span class=n>run_at</span><span class=p>:</span> <span class=n>datetime</span><span class=p>,</span>
</span><span id=__span-0-364><a id=__codelineno-0-364 name=__codelineno-0-364></a>    <span class=p>):</span>
</span><span id=__span-0-365><a id=__codelineno-0-365 name=__codelineno-0-365></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Query a vector store.&quot;&quot;&quot;</span>
</span><span id=__span-0-366><a id=__codelineno-0-366 name=__codelineno-0-366></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_config</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-367><a id=__codelineno-0-367 name=__codelineno-0-367></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Missing NearAI Hub config&quot;</span><span class=p>)</span>
</span><span id=__span-0-368><a id=__codelineno-0-368 name=__codelineno-0-368></a>
</span><span id=__span-0-369><a id=__codelineno-0-369 name=__codelineno-0-369></a>        <span class=n>auth_bearer_token</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_auth</span>
</span><span id=__span-0-370><a id=__codelineno-0-370 name=__codelineno-0-370></a>
</span><span id=__span-0-371><a id=__codelineno-0-371 name=__codelineno-0-371></a>        <span class=n>headers</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-372><a id=__codelineno-0-372 name=__codelineno-0-372></a>            <span class=s2>&quot;Content-Type&quot;</span><span class=p>:</span> <span class=s2>&quot;application/json&quot;</span><span class=p>,</span>
</span><span id=__span-0-373><a id=__codelineno-0-373 name=__codelineno-0-373></a>            <span class=s2>&quot;Authorization&quot;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;Bearer </span><span class=si>{</span><span class=n>auth_bearer_token</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-0-374><a id=__codelineno-0-374 name=__codelineno-0-374></a>        <span class=p>}</span>
</span><span id=__span-0-375><a id=__codelineno-0-375 name=__codelineno-0-375></a>
</span><span id=__span-0-376><a id=__codelineno-0-376 name=__codelineno-0-376></a>        <span class=k>if</span> <span class=n>run_params</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-377><a id=__codelineno-0-377 name=__codelineno-0-377></a>            <span class=n>run_params</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-0-378><a id=__codelineno-0-378 name=__codelineno-0-378></a>
</span><span id=__span-0-379><a id=__codelineno-0-379 name=__codelineno-0-379></a>        <span class=n>data</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-380><a id=__codelineno-0-380 name=__codelineno-0-380></a>            <span class=s2>&quot;agent&quot;</span><span class=p>:</span> <span class=n>agent</span><span class=p>,</span>
</span><span id=__span-0-381><a id=__codelineno-0-381 name=__codelineno-0-381></a>            <span class=s2>&quot;input_message&quot;</span><span class=p>:</span> <span class=n>input_message</span><span class=p>,</span>
</span><span id=__span-0-382><a id=__codelineno-0-382 name=__codelineno-0-382></a>            <span class=s2>&quot;thread_id&quot;</span><span class=p>:</span> <span class=n>thread_id</span><span class=p>,</span>
</span><span id=__span-0-383><a id=__codelineno-0-383 name=__codelineno-0-383></a>            <span class=s2>&quot;run_params&quot;</span><span class=p>:</span> <span class=n>run_params</span><span class=p>,</span>
</span><span id=__span-0-384><a id=__codelineno-0-384 name=__codelineno-0-384></a>            <span class=s2>&quot;run_at&quot;</span><span class=p>:</span> <span class=n>run_at</span><span class=p>,</span>
</span><span id=__span-0-385><a id=__codelineno-0-385 name=__codelineno-0-385></a>        <span class=p>}</span>
</span><span id=__span-0-386><a id=__codelineno-0-386 name=__codelineno-0-386></a>
</span><span id=__span-0-387><a id=__codelineno-0-387 name=__codelineno-0-387></a>        <span class=n>endpoint</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>/schedule_run&quot;</span>
</span><span id=__span-0-388><a id=__codelineno-0-388 name=__codelineno-0-388></a>
</span><span id=__span-0-389><a id=__codelineno-0-389 name=__codelineno-0-389></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-390><a id=__codelineno-0-390 name=__codelineno-0-390></a>            <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>endpoint</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>,</span> <span class=n>json</span><span class=o>=</span><span class=n>data</span><span class=p>)</span>
</span><span id=__span-0-391><a id=__codelineno-0-391 name=__codelineno-0-391></a>            <span class=n>response</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
</span><span id=__span-0-392><a id=__codelineno-0-392 name=__codelineno-0-392></a>            <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span><span id=__span-0-393><a id=__codelineno-0-393 name=__codelineno-0-393></a>        <span class=k>except</span> <span class=n>requests</span><span class=o>.</span><span class=n>RequestException</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-394><a id=__codelineno-0-394 name=__codelineno-0-394></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error querying schedule_run: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span> <span class=kn>from</span><span class=w> </span><span class=kc>None</span>
</span><span id=__span-0-395><a id=__codelineno-0-395 name=__codelineno-0-395></a>
</span><span id=__span-0-396><a id=__codelineno-0-396 name=__codelineno-0-396></a>    <span class=k>def</span><span class=w> </span><span class=nf>query_user_memory</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>query</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-397><a id=__codelineno-0-397 name=__codelineno-0-397></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Query the user memory.&quot;&quot;&quot;</span>
</span><span id=__span-0-398><a id=__codelineno-0-398 name=__codelineno-0-398></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>post</span><span class=p>(</span>
</span><span id=__span-0-399><a id=__codelineno-0-399 name=__codelineno-0-399></a>            <span class=n>path</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>/vector_stores/memory/query&quot;</span><span class=p>,</span>
</span><span id=__span-0-400><a id=__codelineno-0-400 name=__codelineno-0-400></a>            <span class=n>body</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;query&quot;</span><span class=p>:</span> <span class=n>query</span><span class=p>},</span>
</span><span id=__span-0-401><a id=__codelineno-0-401 name=__codelineno-0-401></a>            <span class=n>cast_to</span><span class=o>=</span><span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-402><a id=__codelineno-0-402 name=__codelineno-0-402></a>        <span class=p>)</span>
</span><span id=__span-0-403><a id=__codelineno-0-403 name=__codelineno-0-403></a>
</span><span id=__span-0-404><a id=__codelineno-0-404 name=__codelineno-0-404></a>    <span class=k>def</span><span class=w> </span><span class=nf>add_user_memory</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>memory</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-405><a id=__codelineno-0-405 name=__codelineno-0-405></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Add user memory.&quot;&quot;&quot;</span>
</span><span id=__span-0-406><a id=__codelineno-0-406 name=__codelineno-0-406></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>post</span><span class=p>(</span>
</span><span id=__span-0-407><a id=__codelineno-0-407 name=__codelineno-0-407></a>            <span class=n>path</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>/vector_stores/memory&quot;</span><span class=p>,</span>
</span><span id=__span-0-408><a id=__codelineno-0-408 name=__codelineno-0-408></a>            <span class=n>body</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;memory&quot;</span><span class=p>:</span> <span class=n>memory</span><span class=p>},</span>
</span><span id=__span-0-409><a id=__codelineno-0-409 name=__codelineno-0-409></a>            <span class=n>cast_to</span><span class=o>=</span><span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-410><a id=__codelineno-0-410 name=__codelineno-0-410></a>        <span class=p>)</span>
</span><span id=__span-0-411><a id=__codelineno-0-411 name=__codelineno-0-411></a>
</span><span id=__span-0-412><a id=__codelineno-0-412 name=__codelineno-0-412></a>    <span class=k>def</span><span class=w> </span><span class=nf>generate_image</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>prompt</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-413><a id=__codelineno-0-413 name=__codelineno-0-413></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Generate an image.&quot;&quot;&quot;</span>
</span><span id=__span-0-414><a id=__codelineno-0-414 name=__codelineno-0-414></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>images</span><span class=o>.</span><span class=n>generate</span><span class=p>(</span><span class=n>prompt</span><span class=o>=</span><span class=n>prompt</span><span class=p>)</span>
</span><span id=__span-0-415><a id=__codelineno-0-415 name=__codelineno-0-415></a>
</span><span id=__span-0-416><a id=__codelineno-0-416 name=__codelineno-0-416></a>    <span class=k>def</span><span class=w> </span><span class=nf>save_agent_data</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>agent_data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]):</span>
</span><span id=__span-0-417><a id=__codelineno-0-417 name=__codelineno-0-417></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Save agent data for the agent this client was initialized with.&quot;&quot;&quot;</span>
</span><span id=__span-0-418><a id=__codelineno-0-418 name=__codelineno-0-418></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>post</span><span class=p>(</span>
</span><span id=__span-0-419><a id=__codelineno-0-419 name=__codelineno-0-419></a>            <span class=n>path</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>/agent_data&quot;</span><span class=p>,</span>
</span><span id=__span-0-420><a id=__codelineno-0-420 name=__codelineno-0-420></a>            <span class=n>body</span><span class=o>=</span><span class=p>{</span>
</span><span id=__span-0-421><a id=__codelineno-0-421 name=__codelineno-0-421></a>                <span class=s2>&quot;key&quot;</span><span class=p>:</span> <span class=n>key</span><span class=p>,</span>
</span><span id=__span-0-422><a id=__codelineno-0-422 name=__codelineno-0-422></a>                <span class=s2>&quot;value&quot;</span><span class=p>:</span> <span class=n>agent_data</span><span class=p>,</span>
</span><span id=__span-0-423><a id=__codelineno-0-423 name=__codelineno-0-423></a>            <span class=p>},</span>
</span><span id=__span-0-424><a id=__codelineno-0-424 name=__codelineno-0-424></a>            <span class=n>cast_to</span><span class=o>=</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span>
</span><span id=__span-0-425><a id=__codelineno-0-425 name=__codelineno-0-425></a>        <span class=p>)</span>
</span><span id=__span-0-426><a id=__codelineno-0-426 name=__codelineno-0-426></a>
</span><span id=__span-0-427><a id=__codelineno-0-427 name=__codelineno-0-427></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_agent_data</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-0-428><a id=__codelineno-0-428 name=__codelineno-0-428></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Get agent data for the agent this client was initialized with.&quot;&quot;&quot;</span>
</span><span id=__span-0-429><a id=__codelineno-0-429 name=__codelineno-0-429></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
</span><span id=__span-0-430><a id=__codelineno-0-430 name=__codelineno-0-430></a>            <span class=n>path</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>/agent_data&quot;</span><span class=p>,</span>
</span><span id=__span-0-431><a id=__codelineno-0-431 name=__codelineno-0-431></a>            <span class=n>cast_to</span><span class=o>=</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>],</span>
</span><span id=__span-0-432><a id=__codelineno-0-432 name=__codelineno-0-432></a>        <span class=p>)</span>
</span><span id=__span-0-433><a id=__codelineno-0-433 name=__codelineno-0-433></a>
</span><span id=__span-0-434><a id=__codelineno-0-434 name=__codelineno-0-434></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_agent_data_by_key</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-435><a id=__codelineno-0-435 name=__codelineno-0-435></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Get agent data by key for the agent this client was initialized with.&quot;&quot;&quot;</span>
</span><span id=__span-0-436><a id=__codelineno-0-436 name=__codelineno-0-436></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
</span><span id=__span-0-437><a id=__codelineno-0-437 name=__codelineno-0-437></a>            <span class=n>path</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>/agent_data/</span><span class=si>{</span><span class=n>key</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-0-438><a id=__codelineno-0-438 name=__codelineno-0-438></a>            <span class=n>cast_to</span><span class=o>=</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>],</span>
</span><span id=__span-0-439><a id=__codelineno-0-439 name=__codelineno-0-439></a>        <span class=p>)</span>
</span><span id=__span-0-440><a id=__codelineno-0-440 name=__codelineno-0-440></a>
</span><span id=__span-0-441><a id=__codelineno-0-441 name=__codelineno-0-441></a>    <span class=k>def</span><span class=w> </span><span class=nf>find_agents</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>owner_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>with_capabilities</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>bool</span><span class=p>]</span> <span class=o>=</span> <span class=kc>False</span><span class=p>):</span>
</span><span id=__span-0-442><a id=__codelineno-0-442 name=__codelineno-0-442></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Filter agents.&quot;&quot;&quot;</span>
</span><span id=__span-0-443><a id=__codelineno-0-443 name=__codelineno-0-443></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>post</span><span class=p>(</span>
</span><span id=__span-0-444><a id=__codelineno-0-444 name=__codelineno-0-444></a>            <span class=n>path</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>/find_agents&quot;</span><span class=p>,</span>
</span><span id=__span-0-445><a id=__codelineno-0-445 name=__codelineno-0-445></a>            <span class=n>body</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;owner_id&quot;</span><span class=p>:</span> <span class=n>owner_id</span><span class=p>,</span> <span class=s2>&quot;with_capabilities&quot;</span><span class=p>:</span> <span class=n>with_capabilities</span><span class=p>},</span>
</span><span id=__span-0-446><a id=__codelineno-0-446 name=__codelineno-0-446></a>            <span class=n>cast_to</span><span class=o>=</span><span class=n>List</span><span class=p>[</span><span class=n>Any</span><span class=p>],</span>
</span><span id=__span-0-447><a id=__codelineno-0-447 name=__codelineno-0-447></a>        <span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.inference_client.InferenceClient.add_file_to_vector_store class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">add_file_to_vector_store</span> <a href=#nearai.shared.inference_client.InferenceClient.add_file_to_vector_store class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>add_file_to_vector_store</span><span class=p>(</span><span class=n>vector_store_id</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>file_id</span><span class=p>:</span> <span class=n>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=openai.types.beta.vector_stores.VectorStoreFile>VectorStoreFile</span></span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Adds a file to vector store.</p> <details class=quote> <summary>Source code in <code>nearai/shared/inference_client.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-200>200</a></span>
<span class=normal><a href=#__codelineno-0-201>201</a></span>
<span class=normal><a href=#__codelineno-0-202>202</a></span>
<span class=normal><a href=#__codelineno-0-203>203</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-200><a id=__codelineno-0-200 name=__codelineno-0-200></a><span class=k>def</span><span class=w> </span><span class=nf>add_file_to_vector_store</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>vector_store_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>file_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>VectorStoreFile</span><span class=p>:</span>
</span><span id=__span-0-201><a id=__codelineno-0-201 name=__codelineno-0-201></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Adds a file to vector store.&quot;&quot;&quot;</span>
</span><span id=__span-0-202><a id=__codelineno-0-202 name=__codelineno-0-202></a>    <span class=n>client</span> <span class=o>=</span> <span class=n>openai</span><span class=o>.</span><span class=n>OpenAI</span><span class=p>(</span><span class=n>base_url</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>base_url</span><span class=p>,</span> <span class=n>api_key</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_auth</span><span class=p>)</span>
</span><span id=__span-0-203><a id=__codelineno-0-203 name=__codelineno-0-203></a>    <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>vector_stores</span><span class=o>.</span><span class=n>files</span><span class=o>.</span><span class=n>create</span><span class=p>(</span><span class=n>vector_store_id</span><span class=o>=</span><span class=n>vector_store_id</span><span class=p>,</span> <span class=n>file_id</span><span class=o>=</span><span class=n>file_id</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.inference_client.InferenceClient.add_user_memory class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">add_user_memory</span> <a href=#nearai.shared.inference_client.InferenceClient.add_user_memory class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>add_user_memory</span><span class=p>(</span><span class=n>memory</span><span class=p>:</span> <span class=n>str</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Add user memory.</p> <details class=quote> <summary>Source code in <code>nearai/shared/inference_client.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-404>404</a></span>
<span class=normal><a href=#__codelineno-0-405>405</a></span>
<span class=normal><a href=#__codelineno-0-406>406</a></span>
<span class=normal><a href=#__codelineno-0-407>407</a></span>
<span class=normal><a href=#__codelineno-0-408>408</a></span>
<span class=normal><a href=#__codelineno-0-409>409</a></span>
<span class=normal><a href=#__codelineno-0-410>410</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-404><a id=__codelineno-0-404 name=__codelineno-0-404></a><span class=k>def</span><span class=w> </span><span class=nf>add_user_memory</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>memory</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-405><a id=__codelineno-0-405 name=__codelineno-0-405></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Add user memory.&quot;&quot;&quot;</span>
</span><span id=__span-0-406><a id=__codelineno-0-406 name=__codelineno-0-406></a>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>post</span><span class=p>(</span>
</span><span id=__span-0-407><a id=__codelineno-0-407 name=__codelineno-0-407></a>        <span class=n>path</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>/vector_stores/memory&quot;</span><span class=p>,</span>
</span><span id=__span-0-408><a id=__codelineno-0-408 name=__codelineno-0-408></a>        <span class=n>body</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;memory&quot;</span><span class=p>:</span> <span class=n>memory</span><span class=p>},</span>
</span><span id=__span-0-409><a id=__codelineno-0-409 name=__codelineno-0-409></a>        <span class=n>cast_to</span><span class=o>=</span><span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-410><a id=__codelineno-0-410 name=__codelineno-0-410></a>    <span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.inference_client.InferenceClient.completions class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">completions</span> <a href=#nearai.shared.inference_client.InferenceClient.completions class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>completions</span><span class=p>(</span><span class=n>model</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>messages</span><span class=p>:</span> <span class=n><span title=typing.Iterable>Iterable</span></span><span class=p>[</span><span class=n><span title=litellm.types.completion.ChatCompletionMessageParam>ChatCompletionMessageParam</span></span><span class=p>],</span> <span class=n>stream</span><span class=p>:</span> <span class=n>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span> <span class=n>temperature</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>float</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>max_tokens</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>int</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n><span title=typing.Any>Any</span></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=typing.Union>Union</span></span><span class=p>[</span><span class=n><span title=litellm.ModelResponse>ModelResponse</span></span><span class=p>,</span> <span class=n><span title=litellm.CustomStreamWrapper>CustomStreamWrapper</span></span><span class=p>]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Takes a <code>model</code> and <code>messages</code> and returns completions.</p> <p><code>model</code> can be: 1. full path <code>provider::model_full_path</code>. 2. <code>model_short_name</code>. Default provider will be used.</p> <details class=quote> <summary>Source code in <code>nearai/shared/inference_client.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-95> 95</a></span>
<span class=normal><a href=#__codelineno-0-96> 96</a></span>
<span class=normal><a href=#__codelineno-0-97> 97</a></span>
<span class=normal><a href=#__codelineno-0-98> 98</a></span>
<span class=normal><a href=#__codelineno-0-99> 99</a></span>
<span class=normal><a href=#__codelineno-0-100>100</a></span>
<span class=normal><a href=#__codelineno-0-101>101</a></span>
<span class=normal><a href=#__codelineno-0-102>102</a></span>
<span class=normal><a href=#__codelineno-0-103>103</a></span>
<span class=normal><a href=#__codelineno-0-104>104</a></span>
<span class=normal><a href=#__codelineno-0-105>105</a></span>
<span class=normal><a href=#__codelineno-0-106>106</a></span>
<span class=normal><a href=#__codelineno-0-107>107</a></span>
<span class=normal><a href=#__codelineno-0-108>108</a></span>
<span class=normal><a href=#__codelineno-0-109>109</a></span>
<span class=normal><a href=#__codelineno-0-110>110</a></span>
<span class=normal><a href=#__codelineno-0-111>111</a></span>
<span class=normal><a href=#__codelineno-0-112>112</a></span>
<span class=normal><a href=#__codelineno-0-113>113</a></span>
<span class=normal><a href=#__codelineno-0-114>114</a></span>
<span class=normal><a href=#__codelineno-0-115>115</a></span>
<span class=normal><a href=#__codelineno-0-116>116</a></span>
<span class=normal><a href=#__codelineno-0-117>117</a></span>
<span class=normal><a href=#__codelineno-0-118>118</a></span>
<span class=normal><a href=#__codelineno-0-119>119</a></span>
<span class=normal><a href=#__codelineno-0-120>120</a></span>
<span class=normal><a href=#__codelineno-0-121>121</a></span>
<span class=normal><a href=#__codelineno-0-122>122</a></span>
<span class=normal><a href=#__codelineno-0-123>123</a></span>
<span class=normal><a href=#__codelineno-0-124>124</a></span>
<span class=normal><a href=#__codelineno-0-125>125</a></span>
<span class=normal><a href=#__codelineno-0-126>126</a></span>
<span class=normal><a href=#__codelineno-0-127>127</a></span>
<span class=normal><a href=#__codelineno-0-128>128</a></span>
<span class=normal><a href=#__codelineno-0-129>129</a></span>
<span class=normal><a href=#__codelineno-0-130>130</a></span>
<span class=normal><a href=#__codelineno-0-131>131</a></span>
<span class=normal><a href=#__codelineno-0-132>132</a></span>
<span class=normal><a href=#__codelineno-0-133>133</a></span>
<span class=normal><a href=#__codelineno-0-134>134</a></span>
<span class=normal><a href=#__codelineno-0-135>135</a></span>
<span class=normal><a href=#__codelineno-0-136>136</a></span>
<span class=normal><a href=#__codelineno-0-137>137</a></span>
<span class=normal><a href=#__codelineno-0-138>138</a></span>
<span class=normal><a href=#__codelineno-0-139>139</a></span>
<span class=normal><a href=#__codelineno-0-140>140</a></span>
<span class=normal><a href=#__codelineno-0-141>141</a></span>
<span class=normal><a href=#__codelineno-0-142>142</a></span>
<span class=normal><a href=#__codelineno-0-143>143</a></span>
<span class=normal><a href=#__codelineno-0-144>144</a></span>
<span class=normal><a href=#__codelineno-0-145>145</a></span>
<span class=normal><a href=#__codelineno-0-146>146</a></span>
<span class=normal><a href=#__codelineno-0-147>147</a></span>
<span class=normal><a href=#__codelineno-0-148>148</a></span>
<span class=normal><a href=#__codelineno-0-149>149</a></span>
<span class=normal><a href=#__codelineno-0-150>150</a></span>
<span class=normal><a href=#__codelineno-0-151>151</a></span>
<span class=normal><a href=#__codelineno-0-152>152</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-95><a id=__codelineno-0-95 name=__codelineno-0-95></a><span class=k>def</span><span class=w> </span><span class=nf>completions</span><span class=p>(</span>
</span><span id=__span-0-96><a id=__codelineno-0-96 name=__codelineno-0-96></a>    <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-97><a id=__codelineno-0-97 name=__codelineno-0-97></a>    <span class=n>model</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-98><a id=__codelineno-0-98 name=__codelineno-0-98></a>    <span class=n>messages</span><span class=p>:</span> <span class=n>Iterable</span><span class=p>[</span><span class=n>ChatCompletionMessageParam</span><span class=p>],</span>
</span><span id=__span-0-99><a id=__codelineno-0-99 name=__codelineno-0-99></a>    <span class=n>stream</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-100><a id=__codelineno-0-100 name=__codelineno-0-100></a>    <span class=n>temperature</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>float</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-101><a id=__codelineno-0-101 name=__codelineno-0-101></a>    <span class=n>max_tokens</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-102><a id=__codelineno-0-102 name=__codelineno-0-102></a>    <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=n>Any</span><span class=p>,</span>
</span><span id=__span-0-103><a id=__codelineno-0-103 name=__codelineno-0-103></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span><span class=n>ModelResponse</span><span class=p>,</span> <span class=n>CustomStreamWrapper</span><span class=p>]:</span>
</span><span id=__span-0-104><a id=__codelineno-0-104 name=__codelineno-0-104></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Takes a `model` and `messages` and returns completions.</span>
</span><span id=__span-0-105><a id=__codelineno-0-105 name=__codelineno-0-105></a>
</span><span id=__span-0-106><a id=__codelineno-0-106 name=__codelineno-0-106></a><span class=sd>    `model` can be:</span>
</span><span id=__span-0-107><a id=__codelineno-0-107 name=__codelineno-0-107></a><span class=sd>    1. full path `provider::model_full_path`.</span>
</span><span id=__span-0-108><a id=__codelineno-0-108 name=__codelineno-0-108></a><span class=sd>    2. `model_short_name`. Default provider will be used.</span>
</span><span id=__span-0-109><a id=__codelineno-0-109 name=__codelineno-0-109></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-110><a id=__codelineno-0-110 name=__codelineno-0-110></a>    <span class=n>provider</span><span class=p>,</span> <span class=n>model</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>provider_models</span><span class=o>.</span><span class=n>match_provider_model</span><span class=p>(</span><span class=n>model</span><span class=p>)</span>
</span><span id=__span-0-111><a id=__codelineno-0-111 name=__codelineno-0-111></a>
</span><span id=__span-0-112><a id=__codelineno-0-112 name=__codelineno-0-112></a>    <span class=k>if</span> <span class=n>temperature</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-113><a id=__codelineno-0-113 name=__codelineno-0-113></a>        <span class=n>temperature</span> <span class=o>=</span> <span class=n>DEFAULT_MODEL_TEMPERATURE</span>
</span><span id=__span-0-114><a id=__codelineno-0-114 name=__codelineno-0-114></a>
</span><span id=__span-0-115><a id=__codelineno-0-115 name=__codelineno-0-115></a>    <span class=k>if</span> <span class=n>max_tokens</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-116><a id=__codelineno-0-116 name=__codelineno-0-116></a>        <span class=n>max_tokens</span> <span class=o>=</span> <span class=n>DEFAULT_MODEL_MAX_TOKENS</span>
</span><span id=__span-0-117><a id=__codelineno-0-117 name=__codelineno-0-117></a>
</span><span id=__span-0-118><a id=__codelineno-0-118 name=__codelineno-0-118></a>    <span class=c1># NOTE(#246): this is to disable &quot;Provider List&quot; messages.</span>
</span><span id=__span-0-119><a id=__codelineno-0-119 name=__codelineno-0-119></a>    <span class=n>litellm</span><span class=o>.</span><span class=n>suppress_debug_info</span> <span class=o>=</span> <span class=kc>True</span>
</span><span id=__span-0-120><a id=__codelineno-0-120 name=__codelineno-0-120></a>
</span><span id=__span-0-121><a id=__codelineno-0-121 name=__codelineno-0-121></a>    <span class=c1># lite_llm uses the openai.request_timeout to set the timeout for the request of &quot;openai&quot; custom provider</span>
</span><span id=__span-0-122><a id=__codelineno-0-122 name=__codelineno-0-122></a>    <span class=n>openai</span><span class=o>.</span><span class=n>timeout</span> <span class=o>=</span> <span class=n>DEFAULT_TIMEOUT</span>
</span><span id=__span-0-123><a id=__codelineno-0-123 name=__codelineno-0-123></a>    <span class=n>openai</span><span class=o>.</span><span class=n>max_retries</span> <span class=o>=</span> <span class=n>DEFAULT_MAX_RETRIES</span>
</span><span id=__span-0-124><a id=__codelineno-0-124 name=__codelineno-0-124></a>
</span><span id=__span-0-125><a id=__codelineno-0-125 name=__codelineno-0-125></a>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>num_inference_retries</span><span class=p>):</span>
</span><span id=__span-0-126><a id=__codelineno-0-126 name=__codelineno-0-126></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-127><a id=__codelineno-0-127 name=__codelineno-0-127></a>            <span class=n>result</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>ModelResponse</span><span class=p>,</span> <span class=n>CustomStreamWrapper</span><span class=p>]</span> <span class=o>=</span> <span class=n>litellm_completion</span><span class=p>(</span>
</span><span id=__span-0-128><a id=__codelineno-0-128 name=__codelineno-0-128></a>                <span class=n>model</span><span class=p>,</span>
</span><span id=__span-0-129><a id=__codelineno-0-129 name=__codelineno-0-129></a>                <span class=n>messages</span><span class=p>,</span>
</span><span id=__span-0-130><a id=__codelineno-0-130 name=__codelineno-0-130></a>                <span class=n>stream</span><span class=o>=</span><span class=n>stream</span><span class=p>,</span>
</span><span id=__span-0-131><a id=__codelineno-0-131 name=__codelineno-0-131></a>                <span class=n>custom_llm_provider</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>custom_llm_provider</span><span class=p>,</span>
</span><span id=__span-0-132><a id=__codelineno-0-132 name=__codelineno-0-132></a>                <span class=n>input_cost_per_token</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
</span><span id=__span-0-133><a id=__codelineno-0-133 name=__codelineno-0-133></a>                <span class=n>output_cost_per_token</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
</span><span id=__span-0-134><a id=__codelineno-0-134 name=__codelineno-0-134></a>                <span class=n>temperature</span><span class=o>=</span><span class=n>temperature</span><span class=p>,</span>
</span><span id=__span-0-135><a id=__codelineno-0-135 name=__codelineno-0-135></a>                <span class=n>max_tokens</span><span class=o>=</span><span class=n>max_tokens</span><span class=p>,</span>
</span><span id=__span-0-136><a id=__codelineno-0-136 name=__codelineno-0-136></a>                <span class=n>base_url</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>base_url</span><span class=p>,</span>
</span><span id=__span-0-137><a id=__codelineno-0-137 name=__codelineno-0-137></a>                <span class=n>provider</span><span class=o>=</span><span class=n>provider</span><span class=p>,</span>
</span><span id=__span-0-138><a id=__codelineno-0-138 name=__codelineno-0-138></a>                <span class=n>api_key</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_auth</span><span class=p>,</span>
</span><span id=__span-0-139><a id=__codelineno-0-139 name=__codelineno-0-139></a>                <span class=n>timeout</span><span class=o>=</span><span class=n>DEFAULT_TIMEOUT</span><span class=p>,</span>
</span><span id=__span-0-140><a id=__codelineno-0-140 name=__codelineno-0-140></a>                <span class=n>request_timeout</span><span class=o>=</span><span class=n>DEFAULT_TIMEOUT</span><span class=p>,</span>
</span><span id=__span-0-141><a id=__codelineno-0-141 name=__codelineno-0-141></a>                <span class=n>num_retries</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span>
</span><span id=__span-0-142><a id=__codelineno-0-142 name=__codelineno-0-142></a>                <span class=o>**</span><span class=n>kwargs</span><span class=p>,</span>
</span><span id=__span-0-143><a id=__codelineno-0-143 name=__codelineno-0-143></a>            <span class=p>)</span>
</span><span id=__span-0-144><a id=__codelineno-0-144 name=__codelineno-0-144></a>            <span class=k>break</span>
</span><span id=__span-0-145><a id=__codelineno-0-145 name=__codelineno-0-145></a>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-146><a id=__codelineno-0-146 name=__codelineno-0-146></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Completions exception:&quot;</span><span class=p>,</span> <span class=n>e</span><span class=p>)</span>
</span><span id=__span-0-147><a id=__codelineno-0-147 name=__codelineno-0-147></a>            <span class=k>if</span> <span class=n>i</span> <span class=o>==</span> <span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>num_inference_retries</span> <span class=o>-</span> <span class=mi>1</span><span class=p>:</span>
</span><span id=__span-0-148><a id=__codelineno-0-148 name=__codelineno-0-148></a>                <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Bad request: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span> <span class=kn>from</span><span class=w> </span><span class=kc>None</span>
</span><span id=__span-0-149><a id=__codelineno-0-149 name=__codelineno-0-149></a>            <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-150><a id=__codelineno-0-150 name=__codelineno-0-150></a>                <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Retrying...&quot;</span><span class=p>)</span>
</span><span id=__span-0-151><a id=__codelineno-0-151 name=__codelineno-0-151></a>
</span><span id=__span-0-152><a id=__codelineno-0-152 name=__codelineno-0-152></a>    <span class=k>return</span> <span class=n>result</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.inference_client.InferenceClient.create_subthread class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">create_subthread</span> <a href=#nearai.shared.inference_client.InferenceClient.create_subthread class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>create_subthread</span><span class=p>(</span><span class=n>thread_id</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>messages_to_copy</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n><span title=typing.List>List</span></span><span class=p>[</span><span class=n>str</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>new_messages</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n><span title=typing.List>List</span></span><span class=p>[</span><span class=n><span title=litellm.types.completion.ChatCompletionMessageParam>ChatCompletionMessageParam</span></span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Create a subthread.</p> <details class=quote> <summary>Source code in <code>nearai/shared/inference_client.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-326>326</a></span>
<span class=normal><a href=#__codelineno-0-327>327</a></span>
<span class=normal><a href=#__codelineno-0-328>328</a></span>
<span class=normal><a href=#__codelineno-0-329>329</a></span>
<span class=normal><a href=#__codelineno-0-330>330</a></span>
<span class=normal><a href=#__codelineno-0-331>331</a></span>
<span class=normal><a href=#__codelineno-0-332>332</a></span>
<span class=normal><a href=#__codelineno-0-333>333</a></span>
<span class=normal><a href=#__codelineno-0-334>334</a></span>
<span class=normal><a href=#__codelineno-0-335>335</a></span>
<span class=normal><a href=#__codelineno-0-336>336</a></span>
<span class=normal><a href=#__codelineno-0-337>337</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-326><a id=__codelineno-0-326 name=__codelineno-0-326></a><span class=k>def</span><span class=w> </span><span class=nf>create_subthread</span><span class=p>(</span>
</span><span id=__span-0-327><a id=__codelineno-0-327 name=__codelineno-0-327></a>    <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-328><a id=__codelineno-0-328 name=__codelineno-0-328></a>    <span class=n>thread_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-329><a id=__codelineno-0-329 name=__codelineno-0-329></a>    <span class=n>messages_to_copy</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-330><a id=__codelineno-0-330 name=__codelineno-0-330></a>    <span class=n>new_messages</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=n>ChatCompletionMessageParam</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-331><a id=__codelineno-0-331 name=__codelineno-0-331></a><span class=p>):</span>
</span><span id=__span-0-332><a id=__codelineno-0-332 name=__codelineno-0-332></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Create a subthread.&quot;&quot;&quot;</span>
</span><span id=__span-0-333><a id=__codelineno-0-333 name=__codelineno-0-333></a>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>post</span><span class=p>(</span>
</span><span id=__span-0-334><a id=__codelineno-0-334 name=__codelineno-0-334></a>        <span class=n>path</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>/threads/</span><span class=si>{</span><span class=n>thread_id</span><span class=si>}</span><span class=s2>/subthread&quot;</span><span class=p>,</span>
</span><span id=__span-0-335><a id=__codelineno-0-335 name=__codelineno-0-335></a>        <span class=n>body</span><span class=o>=</span><span class=p>{</span><span class=n>messages_to_copy</span><span class=p>:</span> <span class=n>messages_to_copy</span><span class=p>,</span> <span class=n>new_messages</span><span class=p>:</span> <span class=n>new_messages</span><span class=p>},</span>
</span><span id=__span-0-336><a id=__codelineno-0-336 name=__codelineno-0-336></a>        <span class=n>cast_to</span><span class=o>=</span><span class=n>Thread</span><span class=p>,</span>
</span><span id=__span-0-337><a id=__codelineno-0-337 name=__codelineno-0-337></a>    <span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.inference_client.InferenceClient.create_thread class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">create_thread</span> <a href=#nearai.shared.inference_client.InferenceClient.create_thread class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>create_thread</span><span class=p>(</span><span class=n>messages</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Create a thread.</p> <details class=quote> <summary>Source code in <code>nearai/shared/inference_client.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-300>300</a></span>
<span class=normal><a href=#__codelineno-0-301>301</a></span>
<span class=normal><a href=#__codelineno-0-302>302</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-300><a id=__codelineno-0-300 name=__codelineno-0-300></a><span class=k>def</span><span class=w> </span><span class=nf>create_thread</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>messages</span><span class=p>):</span>
</span><span id=__span-0-301><a id=__codelineno-0-301 name=__codelineno-0-301></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Create a thread.&quot;&quot;&quot;</span>
</span><span id=__span-0-302><a id=__codelineno-0-302 name=__codelineno-0-302></a>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>create</span><span class=p>(</span><span class=n>messages</span><span class=o>=</span><span class=n>messages</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.inference_client.InferenceClient.create_vector_store class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">create_vector_store</span> <a href=#nearai.shared.inference_client.InferenceClient.create_vector_store class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>create_vector_store</span><span class=p>(</span><span class=n>name</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>file_ids</span><span class=p>:</span> <span class=n><span title=typing.List>List</span></span><span class=p>[</span><span class=n>str</span><span class=p>],</span> <span class=n>expires_after</span><span class=p>:</span> <span class=n><span title=typing.Union>Union</span></span><span class=p>[</span><span class=n><a class="autorefs autorefs-internal" title=nearai.shared.models.ExpiresAfter href=#nearai.shared.models.ExpiresAfter>ExpiresAfter</a></span><span class=p>,</span> <span class=n><span title=openai.NotGiven>NotGiven</span></span><span class=p>]</span> <span class=o>=</span> <span class=n><span title=openai.NOT_GIVEN>NOT_GIVEN</span></span><span class=p>,</span> <span class=n>chunking_strategy</span><span class=p>:</span> <span class=n><span title=typing.Union>Union</span></span><span class=p>[</span><span class=n><a class="autorefs autorefs-internal" title=nearai.shared.models.AutoFileChunkingStrategyParam href=#nearai.shared.models.AutoFileChunkingStrategyParam>AutoFileChunkingStrategyParam</a></span><span class=p>,</span> <span class=n><span title=nearai.shared.models.StaticFileChunkingStrategyObjectParam>StaticFileChunkingStrategyObjectParam</span></span><span class=p>,</span> <span class=n><span title=openai.NotGiven>NotGiven</span></span><span class=p>]</span> <span class=o>=</span> <span class=n><span title=openai.NOT_GIVEN>NOT_GIVEN</span></span><span class=p>,</span> <span class=n>metadata</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n><span title=typing.Dict>Dict</span></span><span class=p>[</span><span class=n>str</span><span class=p>,</span> <span class=n>str</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=openai.types.beta.vector_store.VectorStore>VectorStore</span></span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Creates Vector Store.</p> <p>:param name: Vector store name. :param file_ids: Files to be added to the vector store. :param expires_after: Expiration policy. :param chunking_strategy: Chunking strategy. :param metadata: Additional metadata. :return: Returns the created vector store or error.</p> <details class=quote> <summary>Source code in <code>nearai/shared/inference_client.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-258>258</a></span>
<span class=normal><a href=#__codelineno-0-259>259</a></span>
<span class=normal><a href=#__codelineno-0-260>260</a></span>
<span class=normal><a href=#__codelineno-0-261>261</a></span>
<span class=normal><a href=#__codelineno-0-262>262</a></span>
<span class=normal><a href=#__codelineno-0-263>263</a></span>
<span class=normal><a href=#__codelineno-0-264>264</a></span>
<span class=normal><a href=#__codelineno-0-265>265</a></span>
<span class=normal><a href=#__codelineno-0-266>266</a></span>
<span class=normal><a href=#__codelineno-0-267>267</a></span>
<span class=normal><a href=#__codelineno-0-268>268</a></span>
<span class=normal><a href=#__codelineno-0-269>269</a></span>
<span class=normal><a href=#__codelineno-0-270>270</a></span>
<span class=normal><a href=#__codelineno-0-271>271</a></span>
<span class=normal><a href=#__codelineno-0-272>272</a></span>
<span class=normal><a href=#__codelineno-0-273>273</a></span>
<span class=normal><a href=#__codelineno-0-274>274</a></span>
<span class=normal><a href=#__codelineno-0-275>275</a></span>
<span class=normal><a href=#__codelineno-0-276>276</a></span>
<span class=normal><a href=#__codelineno-0-277>277</a></span>
<span class=normal><a href=#__codelineno-0-278>278</a></span>
<span class=normal><a href=#__codelineno-0-279>279</a></span>
<span class=normal><a href=#__codelineno-0-280>280</a></span>
<span class=normal><a href=#__codelineno-0-281>281</a></span>
<span class=normal><a href=#__codelineno-0-282>282</a></span>
<span class=normal><a href=#__codelineno-0-283>283</a></span>
<span class=normal><a href=#__codelineno-0-284>284</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-258><a id=__codelineno-0-258 name=__codelineno-0-258></a><span class=k>def</span><span class=w> </span><span class=nf>create_vector_store</span><span class=p>(</span>
</span><span id=__span-0-259><a id=__codelineno-0-259 name=__codelineno-0-259></a>    <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-260><a id=__codelineno-0-260 name=__codelineno-0-260></a>    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-261><a id=__codelineno-0-261 name=__codelineno-0-261></a>    <span class=n>file_ids</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>],</span>
</span><span id=__span-0-262><a id=__codelineno-0-262 name=__codelineno-0-262></a>    <span class=n>expires_after</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>ExpiresAfter</span><span class=p>,</span> <span class=n>NotGiven</span><span class=p>]</span> <span class=o>=</span> <span class=n>NOT_GIVEN</span><span class=p>,</span>
</span><span id=__span-0-263><a id=__codelineno-0-263 name=__codelineno-0-263></a>    <span class=n>chunking_strategy</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span>
</span><span id=__span-0-264><a id=__codelineno-0-264 name=__codelineno-0-264></a>        <span class=n>AutoFileChunkingStrategyParam</span><span class=p>,</span> <span class=n>StaticFileChunkingStrategyObjectParam</span><span class=p>,</span> <span class=n>NotGiven</span>
</span><span id=__span-0-265><a id=__codelineno-0-265 name=__codelineno-0-265></a>    <span class=p>]</span> <span class=o>=</span> <span class=n>NOT_GIVEN</span><span class=p>,</span>
</span><span id=__span-0-266><a id=__codelineno-0-266 name=__codelineno-0-266></a>    <span class=n>metadata</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-267><a id=__codelineno-0-267 name=__codelineno-0-267></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>VectorStore</span><span class=p>:</span>
</span><span id=__span-0-268><a id=__codelineno-0-268 name=__codelineno-0-268></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Creates Vector Store.</span>
</span><span id=__span-0-269><a id=__codelineno-0-269 name=__codelineno-0-269></a>
</span><span id=__span-0-270><a id=__codelineno-0-270 name=__codelineno-0-270></a><span class=sd>    :param name: Vector store name.</span>
</span><span id=__span-0-271><a id=__codelineno-0-271 name=__codelineno-0-271></a><span class=sd>    :param file_ids: Files to be added to the vector store.</span>
</span><span id=__span-0-272><a id=__codelineno-0-272 name=__codelineno-0-272></a><span class=sd>    :param expires_after: Expiration policy.</span>
</span><span id=__span-0-273><a id=__codelineno-0-273 name=__codelineno-0-273></a><span class=sd>    :param chunking_strategy: Chunking strategy.</span>
</span><span id=__span-0-274><a id=__codelineno-0-274 name=__codelineno-0-274></a><span class=sd>    :param metadata: Additional metadata.</span>
</span><span id=__span-0-275><a id=__codelineno-0-275 name=__codelineno-0-275></a><span class=sd>    :return: Returns the created vector store or error.</span>
</span><span id=__span-0-276><a id=__codelineno-0-276 name=__codelineno-0-276></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-277><a id=__codelineno-0-277 name=__codelineno-0-277></a>    <span class=n>client</span> <span class=o>=</span> <span class=n>openai</span><span class=o>.</span><span class=n>OpenAI</span><span class=p>(</span><span class=n>base_url</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>base_url</span><span class=p>,</span> <span class=n>api_key</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_auth</span><span class=p>)</span>
</span><span id=__span-0-278><a id=__codelineno-0-278 name=__codelineno-0-278></a>    <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>vector_stores</span><span class=o>.</span><span class=n>create</span><span class=p>(</span>
</span><span id=__span-0-279><a id=__codelineno-0-279 name=__codelineno-0-279></a>        <span class=n>file_ids</span><span class=o>=</span><span class=n>file_ids</span><span class=p>,</span>
</span><span id=__span-0-280><a id=__codelineno-0-280 name=__codelineno-0-280></a>        <span class=n>name</span><span class=o>=</span><span class=n>name</span><span class=p>,</span>
</span><span id=__span-0-281><a id=__codelineno-0-281 name=__codelineno-0-281></a>        <span class=n>expires_after</span><span class=o>=</span><span class=n>expires_after</span><span class=p>,</span>
</span><span id=__span-0-282><a id=__codelineno-0-282 name=__codelineno-0-282></a>        <span class=n>chunking_strategy</span><span class=o>=</span><span class=n>chunking_strategy</span><span class=p>,</span>
</span><span id=__span-0-283><a id=__codelineno-0-283 name=__codelineno-0-283></a>        <span class=n>metadata</span><span class=o>=</span><span class=n>metadata</span><span class=p>,</span>
</span><span id=__span-0-284><a id=__codelineno-0-284 name=__codelineno-0-284></a>    <span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.inference_client.InferenceClient.create_vector_store_from_source class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">create_vector_store_from_source</span> <a href=#nearai.shared.inference_client.InferenceClient.create_vector_store_from_source class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>create_vector_store_from_source</span><span class=p>(</span><span class=n>name</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>source</span><span class=p>:</span> <span class=n><span title=typing.Union>Union</span></span><span class=p>[</span><span class=n><span title=nearai.shared.models.GitHubSource>GitHubSource</span></span><span class=p>,</span> <span class=n><span title=nearai.shared.models.GitLabSource>GitLabSource</span></span><span class=p>],</span> <span class=n>source_auth</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>chunking_strategy</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n><a class="autorefs autorefs-internal" title=nearai.shared.models.ChunkingStrategy href=#nearai.shared.models.ChunkingStrategy>ChunkingStrategy</a></span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>expires_after</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n><a class="autorefs autorefs-internal" title=nearai.shared.models.ExpiresAfter href=#nearai.shared.models.ExpiresAfter>ExpiresAfter</a></span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>metadata</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n><span title=typing.Dict>Dict</span></span><span class=p>[</span><span class=n>str</span><span class=p>,</span> <span class=n>str</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=openai.types.beta.vector_store.VectorStore>VectorStore</span></span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Creates a vector store from the given source.</p> <hr> <div class="language-text highlight"><pre><span></span><code>name (str): The name of the vector store.
source (Union[GitHubSource, GitLabSource]): The source from which to create the vector store.
source_auth (Optional[str]): The source authentication token.
chunking_strategy (Optional[ChunkingStrategy]): The chunking strategy to use.
expires_after (Optional[ExpiresAfter]): The expiration policy.
metadata (Optional[Dict[str, str]]): Additional metadata.
</code></pre></div> <hr> <div class="language-text highlight"><pre><span></span><code>VectorStore: The created vector store.
</code></pre></div> <details class=quote> <summary>Source code in <code>nearai/shared/inference_client.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-210>210</a></span>
<span class=normal><a href=#__codelineno-0-211>211</a></span>
<span class=normal><a href=#__codelineno-0-212>212</a></span>
<span class=normal><a href=#__codelineno-0-213>213</a></span>
<span class=normal><a href=#__codelineno-0-214>214</a></span>
<span class=normal><a href=#__codelineno-0-215>215</a></span>
<span class=normal><a href=#__codelineno-0-216>216</a></span>
<span class=normal><a href=#__codelineno-0-217>217</a></span>
<span class=normal><a href=#__codelineno-0-218>218</a></span>
<span class=normal><a href=#__codelineno-0-219>219</a></span>
<span class=normal><a href=#__codelineno-0-220>220</a></span>
<span class=normal><a href=#__codelineno-0-221>221</a></span>
<span class=normal><a href=#__codelineno-0-222>222</a></span>
<span class=normal><a href=#__codelineno-0-223>223</a></span>
<span class=normal><a href=#__codelineno-0-224>224</a></span>
<span class=normal><a href=#__codelineno-0-225>225</a></span>
<span class=normal><a href=#__codelineno-0-226>226</a></span>
<span class=normal><a href=#__codelineno-0-227>227</a></span>
<span class=normal><a href=#__codelineno-0-228>228</a></span>
<span class=normal><a href=#__codelineno-0-229>229</a></span>
<span class=normal><a href=#__codelineno-0-230>230</a></span>
<span class=normal><a href=#__codelineno-0-231>231</a></span>
<span class=normal><a href=#__codelineno-0-232>232</a></span>
<span class=normal><a href=#__codelineno-0-233>233</a></span>
<span class=normal><a href=#__codelineno-0-234>234</a></span>
<span class=normal><a href=#__codelineno-0-235>235</a></span>
<span class=normal><a href=#__codelineno-0-236>236</a></span>
<span class=normal><a href=#__codelineno-0-237>237</a></span>
<span class=normal><a href=#__codelineno-0-238>238</a></span>
<span class=normal><a href=#__codelineno-0-239>239</a></span>
<span class=normal><a href=#__codelineno-0-240>240</a></span>
<span class=normal><a href=#__codelineno-0-241>241</a></span>
<span class=normal><a href=#__codelineno-0-242>242</a></span>
<span class=normal><a href=#__codelineno-0-243>243</a></span>
<span class=normal><a href=#__codelineno-0-244>244</a></span>
<span class=normal><a href=#__codelineno-0-245>245</a></span>
<span class=normal><a href=#__codelineno-0-246>246</a></span>
<span class=normal><a href=#__codelineno-0-247>247</a></span>
<span class=normal><a href=#__codelineno-0-248>248</a></span>
<span class=normal><a href=#__codelineno-0-249>249</a></span>
<span class=normal><a href=#__codelineno-0-250>250</a></span>
<span class=normal><a href=#__codelineno-0-251>251</a></span>
<span class=normal><a href=#__codelineno-0-252>252</a></span>
<span class=normal><a href=#__codelineno-0-253>253</a></span>
<span class=normal><a href=#__codelineno-0-254>254</a></span>
<span class=normal><a href=#__codelineno-0-255>255</a></span>
<span class=normal><a href=#__codelineno-0-256>256</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-210><a id=__codelineno-0-210 name=__codelineno-0-210></a><span class=k>def</span><span class=w> </span><span class=nf>create_vector_store_from_source</span><span class=p>(</span>
</span><span id=__span-0-211><a id=__codelineno-0-211 name=__codelineno-0-211></a>    <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-212><a id=__codelineno-0-212 name=__codelineno-0-212></a>    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-213><a id=__codelineno-0-213 name=__codelineno-0-213></a>    <span class=n>source</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>GitHubSource</span><span class=p>,</span> <span class=n>GitLabSource</span><span class=p>],</span>
</span><span id=__span-0-214><a id=__codelineno-0-214 name=__codelineno-0-214></a>    <span class=n>source_auth</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-215><a id=__codelineno-0-215 name=__codelineno-0-215></a>    <span class=n>chunking_strategy</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>ChunkingStrategy</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-216><a id=__codelineno-0-216 name=__codelineno-0-216></a>    <span class=n>expires_after</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>ExpiresAfter</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-217><a id=__codelineno-0-217 name=__codelineno-0-217></a>    <span class=n>metadata</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span><span id=__span-0-218><a id=__codelineno-0-218 name=__codelineno-0-218></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>VectorStore</span><span class=p>:</span>
</span><span id=__span-0-219><a id=__codelineno-0-219 name=__codelineno-0-219></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Creates a vector store from the given source.</span>
</span><span id=__span-0-220><a id=__codelineno-0-220 name=__codelineno-0-220></a>
</span><span id=__span-0-221><a id=__codelineno-0-221 name=__codelineno-0-221></a><span class=sd>    Args:</span>
</span><span id=__span-0-222><a id=__codelineno-0-222 name=__codelineno-0-222></a><span class=sd>    ----</span>
</span><span id=__span-0-223><a id=__codelineno-0-223 name=__codelineno-0-223></a><span class=sd>        name (str): The name of the vector store.</span>
</span><span id=__span-0-224><a id=__codelineno-0-224 name=__codelineno-0-224></a><span class=sd>        source (Union[GitHubSource, GitLabSource]): The source from which to create the vector store.</span>
</span><span id=__span-0-225><a id=__codelineno-0-225 name=__codelineno-0-225></a><span class=sd>        source_auth (Optional[str]): The source authentication token.</span>
</span><span id=__span-0-226><a id=__codelineno-0-226 name=__codelineno-0-226></a><span class=sd>        chunking_strategy (Optional[ChunkingStrategy]): The chunking strategy to use.</span>
</span><span id=__span-0-227><a id=__codelineno-0-227 name=__codelineno-0-227></a><span class=sd>        expires_after (Optional[ExpiresAfter]): The expiration policy.</span>
</span><span id=__span-0-228><a id=__codelineno-0-228 name=__codelineno-0-228></a><span class=sd>        metadata (Optional[Dict[str, str]]): Additional metadata.</span>
</span><span id=__span-0-229><a id=__codelineno-0-229 name=__codelineno-0-229></a>
</span><span id=__span-0-230><a id=__codelineno-0-230 name=__codelineno-0-230></a><span class=sd>    Returns:</span>
</span><span id=__span-0-231><a id=__codelineno-0-231 name=__codelineno-0-231></a><span class=sd>    -------</span>
</span><span id=__span-0-232><a id=__codelineno-0-232 name=__codelineno-0-232></a><span class=sd>        VectorStore: The created vector store.</span>
</span><span id=__span-0-233><a id=__codelineno-0-233 name=__codelineno-0-233></a>
</span><span id=__span-0-234><a id=__codelineno-0-234 name=__codelineno-0-234></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-235><a id=__codelineno-0-235 name=__codelineno-0-235></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Creating vector store from source: </span><span class=si>{</span><span class=n>source</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-236><a id=__codelineno-0-236 name=__codelineno-0-236></a>    <span class=n>headers</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-237><a id=__codelineno-0-237 name=__codelineno-0-237></a>        <span class=s2>&quot;Authorization&quot;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;Bearer </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>_auth</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-0-238><a id=__codelineno-0-238 name=__codelineno-0-238></a>        <span class=s2>&quot;Content-Type&quot;</span><span class=p>:</span> <span class=s2>&quot;application/json&quot;</span><span class=p>,</span>
</span><span id=__span-0-239><a id=__codelineno-0-239 name=__codelineno-0-239></a>    <span class=p>}</span>
</span><span id=__span-0-240><a id=__codelineno-0-240 name=__codelineno-0-240></a>    <span class=n>data</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-241><a id=__codelineno-0-241 name=__codelineno-0-241></a>        <span class=s2>&quot;name&quot;</span><span class=p>:</span> <span class=n>name</span><span class=p>,</span>
</span><span id=__span-0-242><a id=__codelineno-0-242 name=__codelineno-0-242></a>        <span class=s2>&quot;source&quot;</span><span class=p>:</span> <span class=n>source</span><span class=p>,</span>
</span><span id=__span-0-243><a id=__codelineno-0-243 name=__codelineno-0-243></a>        <span class=s2>&quot;source_auth&quot;</span><span class=p>:</span> <span class=n>source_auth</span><span class=p>,</span>
</span><span id=__span-0-244><a id=__codelineno-0-244 name=__codelineno-0-244></a>        <span class=s2>&quot;chunking_strategy&quot;</span><span class=p>:</span> <span class=n>chunking_strategy</span><span class=p>,</span>
</span><span id=__span-0-245><a id=__codelineno-0-245 name=__codelineno-0-245></a>        <span class=s2>&quot;expires_after&quot;</span><span class=p>:</span> <span class=n>expires_after</span><span class=p>,</span>
</span><span id=__span-0-246><a id=__codelineno-0-246 name=__codelineno-0-246></a>        <span class=s2>&quot;metadata&quot;</span><span class=p>:</span> <span class=n>metadata</span><span class=p>,</span>
</span><span id=__span-0-247><a id=__codelineno-0-247 name=__codelineno-0-247></a>    <span class=p>}</span>
</span><span id=__span-0-248><a id=__codelineno-0-248 name=__codelineno-0-248></a>    <span class=n>endpoint</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>/vector_stores/from_source&quot;</span>
</span><span id=__span-0-249><a id=__codelineno-0-249 name=__codelineno-0-249></a>
</span><span id=__span-0-250><a id=__codelineno-0-250 name=__codelineno-0-250></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-251><a id=__codelineno-0-251 name=__codelineno-0-251></a>        <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>endpoint</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>,</span> <span class=n>json</span><span class=o>=</span><span class=n>data</span><span class=p>)</span>
</span><span id=__span-0-252><a id=__codelineno-0-252 name=__codelineno-0-252></a>        <span class=nb>print</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>())</span>
</span><span id=__span-0-253><a id=__codelineno-0-253 name=__codelineno-0-253></a>        <span class=n>response</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
</span><span id=__span-0-254><a id=__codelineno-0-254 name=__codelineno-0-254></a>        <span class=k>return</span> <span class=n>VectorStore</span><span class=p>(</span><span class=o>**</span><span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>())</span>
</span><span id=__span-0-255><a id=__codelineno-0-255 name=__codelineno-0-255></a>    <span class=k>except</span> <span class=n>requests</span><span class=o>.</span><span class=n>RequestException</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-256><a id=__codelineno-0-256 name=__codelineno-0-256></a>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Failed to create vector store: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span> <span class=kn>from</span><span class=w> </span><span class=kc>None</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.inference_client.InferenceClient.find_agents class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">find_agents</span> <a href=#nearai.shared.inference_client.InferenceClient.find_agents class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>find_agents</span><span class=p>(</span><span class=n>owner_id</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>with_capabilities</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>bool</span><span class=p>]</span> <span class=o>=</span> <span class=kc>False</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Filter agents.</p> <details class=quote> <summary>Source code in <code>nearai/shared/inference_client.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-441>441</a></span>
<span class=normal><a href=#__codelineno-0-442>442</a></span>
<span class=normal><a href=#__codelineno-0-443>443</a></span>
<span class=normal><a href=#__codelineno-0-444>444</a></span>
<span class=normal><a href=#__codelineno-0-445>445</a></span>
<span class=normal><a href=#__codelineno-0-446>446</a></span>
<span class=normal><a href=#__codelineno-0-447>447</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-441><a id=__codelineno-0-441 name=__codelineno-0-441></a><span class=k>def</span><span class=w> </span><span class=nf>find_agents</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>owner_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>with_capabilities</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>bool</span><span class=p>]</span> <span class=o>=</span> <span class=kc>False</span><span class=p>):</span>
</span><span id=__span-0-442><a id=__codelineno-0-442 name=__codelineno-0-442></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Filter agents.&quot;&quot;&quot;</span>
</span><span id=__span-0-443><a id=__codelineno-0-443 name=__codelineno-0-443></a>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>post</span><span class=p>(</span>
</span><span id=__span-0-444><a id=__codelineno-0-444 name=__codelineno-0-444></a>        <span class=n>path</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>/find_agents&quot;</span><span class=p>,</span>
</span><span id=__span-0-445><a id=__codelineno-0-445 name=__codelineno-0-445></a>        <span class=n>body</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;owner_id&quot;</span><span class=p>:</span> <span class=n>owner_id</span><span class=p>,</span> <span class=s2>&quot;with_capabilities&quot;</span><span class=p>:</span> <span class=n>with_capabilities</span><span class=p>},</span>
</span><span id=__span-0-446><a id=__codelineno-0-446 name=__codelineno-0-446></a>        <span class=n>cast_to</span><span class=o>=</span><span class=n>List</span><span class=p>[</span><span class=n>Any</span><span class=p>],</span>
</span><span id=__span-0-447><a id=__codelineno-0-447 name=__codelineno-0-447></a>    <span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.inference_client.InferenceClient.generate_auth_for_current_agent class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">generate_auth_for_current_agent</span> <a href=#nearai.shared.inference_client.InferenceClient.generate_auth_for_current_agent class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>generate_auth_for_current_agent</span><span class=p>(</span><span class=n>config</span><span class=p>,</span> <span class=n>agent_identifier</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Regenerate auth for the current agent.</p> <details class=quote> <summary>Source code in <code>nearai/shared/inference_client.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-50>50</a></span>
<span class=normal><a href=#__codelineno-0-51>51</a></span>
<span class=normal><a href=#__codelineno-0-52>52</a></span>
<span class=normal><a href=#__codelineno-0-53>53</a></span>
<span class=normal><a href=#__codelineno-0-54>54</a></span>
<span class=normal><a href=#__codelineno-0-55>55</a></span>
<span class=normal><a href=#__codelineno-0-56>56</a></span>
<span class=normal><a href=#__codelineno-0-57>57</a></span>
<span class=normal><a href=#__codelineno-0-58>58</a></span>
<span class=normal><a href=#__codelineno-0-59>59</a></span>
<span class=normal><a href=#__codelineno-0-60>60</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-50><a id=__codelineno-0-50 name=__codelineno-0-50></a><span class=k>def</span><span class=w> </span><span class=nf>generate_auth_for_current_agent</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>config</span><span class=p>,</span> <span class=n>agent_identifier</span><span class=p>):</span>
</span><span id=__span-0-51><a id=__codelineno-0-51 name=__codelineno-0-51></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Regenerate auth for the current agent.&quot;&quot;&quot;</span>
</span><span id=__span-0-52><a id=__codelineno-0-52 name=__codelineno-0-52></a>    <span class=bp>self</span><span class=o>.</span><span class=n>agent_identifier</span> <span class=o>=</span> <span class=n>agent_identifier</span>
</span><span id=__span-0-53><a id=__codelineno-0-53 name=__codelineno-0-53></a>    <span class=k>if</span> <span class=n>config</span><span class=o>.</span><span class=n>auth</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-54><a id=__codelineno-0-54 name=__codelineno-0-54></a>        <span class=n>auth_bearer_token</span> <span class=o>=</span> <span class=n>config</span><span class=o>.</span><span class=n>auth</span><span class=o>.</span><span class=n>generate_bearer_token</span><span class=p>()</span>
</span><span id=__span-0-55><a id=__codelineno-0-55 name=__codelineno-0-55></a>        <span class=n>new_token</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>auth_bearer_token</span><span class=p>)</span>
</span><span id=__span-0-56><a id=__codelineno-0-56 name=__codelineno-0-56></a>        <span class=n>new_token</span><span class=p>[</span><span class=s2>&quot;runner_data&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>({</span><span class=s2>&quot;agent&quot;</span><span class=p>:</span> <span class=n>agent_identifier</span><span class=p>,</span> <span class=s2>&quot;runner_api_key&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>runner_api_key</span><span class=p>})</span>
</span><span id=__span-0-57><a id=__codelineno-0-57 name=__codelineno-0-57></a>        <span class=n>auth_bearer_token</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>new_token</span><span class=p>)</span>
</span><span id=__span-0-58><a id=__codelineno-0-58 name=__codelineno-0-58></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_auth</span> <span class=o>=</span> <span class=n>auth_bearer_token</span>
</span><span id=__span-0-59><a id=__codelineno-0-59 name=__codelineno-0-59></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-60><a id=__codelineno-0-60 name=__codelineno-0-60></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_auth</span> <span class=o>=</span> <span class=kc>None</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.inference_client.InferenceClient.generate_image class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">generate_image</span> <a href=#nearai.shared.inference_client.InferenceClient.generate_image class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>generate_image</span><span class=p>(</span><span class=n>prompt</span><span class=p>:</span> <span class=n>str</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Generate an image.</p> <details class=quote> <summary>Source code in <code>nearai/shared/inference_client.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-412>412</a></span>
<span class=normal><a href=#__codelineno-0-413>413</a></span>
<span class=normal><a href=#__codelineno-0-414>414</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-412><a id=__codelineno-0-412 name=__codelineno-0-412></a><span class=k>def</span><span class=w> </span><span class=nf>generate_image</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>prompt</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-413><a id=__codelineno-0-413 name=__codelineno-0-413></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Generate an image.&quot;&quot;&quot;</span>
</span><span id=__span-0-414><a id=__codelineno-0-414 name=__codelineno-0-414></a>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>images</span><span class=o>.</span><span class=n>generate</span><span class=p>(</span><span class=n>prompt</span><span class=o>=</span><span class=n>prompt</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.inference_client.InferenceClient.get_agent_data class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_agent_data</span> <a href=#nearai.shared.inference_client.InferenceClient.get_agent_data class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>get_agent_data</span><span class=p>()</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Get agent data for the agent this client was initialized with.</p> <details class=quote> <summary>Source code in <code>nearai/shared/inference_client.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-427>427</a></span>
<span class=normal><a href=#__codelineno-0-428>428</a></span>
<span class=normal><a href=#__codelineno-0-429>429</a></span>
<span class=normal><a href=#__codelineno-0-430>430</a></span>
<span class=normal><a href=#__codelineno-0-431>431</a></span>
<span class=normal><a href=#__codelineno-0-432>432</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-427><a id=__codelineno-0-427 name=__codelineno-0-427></a><span class=k>def</span><span class=w> </span><span class=nf>get_agent_data</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-0-428><a id=__codelineno-0-428 name=__codelineno-0-428></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Get agent data for the agent this client was initialized with.&quot;&quot;&quot;</span>
</span><span id=__span-0-429><a id=__codelineno-0-429 name=__codelineno-0-429></a>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
</span><span id=__span-0-430><a id=__codelineno-0-430 name=__codelineno-0-430></a>        <span class=n>path</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>/agent_data&quot;</span><span class=p>,</span>
</span><span id=__span-0-431><a id=__codelineno-0-431 name=__codelineno-0-431></a>        <span class=n>cast_to</span><span class=o>=</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>],</span>
</span><span id=__span-0-432><a id=__codelineno-0-432 name=__codelineno-0-432></a>    <span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.inference_client.InferenceClient.get_agent_data_by_key class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_agent_data_by_key</span> <a href=#nearai.shared.inference_client.InferenceClient.get_agent_data_by_key class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>get_agent_data_by_key</span><span class=p>(</span><span class=n>key</span><span class=p>:</span> <span class=n>str</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Get agent data by key for the agent this client was initialized with.</p> <details class=quote> <summary>Source code in <code>nearai/shared/inference_client.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-434>434</a></span>
<span class=normal><a href=#__codelineno-0-435>435</a></span>
<span class=normal><a href=#__codelineno-0-436>436</a></span>
<span class=normal><a href=#__codelineno-0-437>437</a></span>
<span class=normal><a href=#__codelineno-0-438>438</a></span>
<span class=normal><a href=#__codelineno-0-439>439</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-434><a id=__codelineno-0-434 name=__codelineno-0-434></a><span class=k>def</span><span class=w> </span><span class=nf>get_agent_data_by_key</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-435><a id=__codelineno-0-435 name=__codelineno-0-435></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Get agent data by key for the agent this client was initialized with.&quot;&quot;&quot;</span>
</span><span id=__span-0-436><a id=__codelineno-0-436 name=__codelineno-0-436></a>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
</span><span id=__span-0-437><a id=__codelineno-0-437 name=__codelineno-0-437></a>        <span class=n>path</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>/agent_data/</span><span class=si>{</span><span class=n>key</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-0-438><a id=__codelineno-0-438 name=__codelineno-0-438></a>        <span class=n>cast_to</span><span class=o>=</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>],</span>
</span><span id=__span-0-439><a id=__codelineno-0-439 name=__codelineno-0-439></a>    <span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.inference_client.InferenceClient.get_agent_public_key class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_agent_public_key</span> <a href=#nearai.shared.inference_client.InferenceClient.get_agent_public_key class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>get_agent_public_key</span><span class=p>(</span><span class=n>agent_name</span><span class=p>:</span> <span class=n>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>str</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Request agent public key.</p> <details class=quote> <summary>Source code in <code>nearai/shared/inference_client.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-78>78</a></span>
<span class=normal><a href=#__codelineno-0-79>79</a></span>
<span class=normal><a href=#__codelineno-0-80>80</a></span>
<span class=normal><a href=#__codelineno-0-81>81</a></span>
<span class=normal><a href=#__codelineno-0-82>82</a></span>
<span class=normal><a href=#__codelineno-0-83>83</a></span>
<span class=normal><a href=#__codelineno-0-84>84</a></span>
<span class=normal><a href=#__codelineno-0-85>85</a></span>
<span class=normal><a href=#__codelineno-0-86>86</a></span>
<span class=normal><a href=#__codelineno-0-87>87</a></span>
<span class=normal><a href=#__codelineno-0-88>88</a></span>
<span class=normal><a href=#__codelineno-0-89>89</a></span>
<span class=normal><a href=#__codelineno-0-90>90</a></span>
<span class=normal><a href=#__codelineno-0-91>91</a></span>
<span class=normal><a href=#__codelineno-0-92>92</a></span>
<span class=normal><a href=#__codelineno-0-93>93</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-78><a id=__codelineno-0-78 name=__codelineno-0-78></a><span class=k>def</span><span class=w> </span><span class=nf>get_agent_public_key</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>agent_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-0-79><a id=__codelineno-0-79 name=__codelineno-0-79></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Request agent public key.&quot;&quot;&quot;</span>
</span><span id=__span-0-80><a id=__codelineno-0-80 name=__codelineno-0-80></a>    <span class=n>headers</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-81><a id=__codelineno-0-81 name=__codelineno-0-81></a>        <span class=s2>&quot;Content-Type&quot;</span><span class=p>:</span> <span class=s2>&quot;application/json&quot;</span><span class=p>,</span>
</span><span id=__span-0-82><a id=__codelineno-0-82 name=__codelineno-0-82></a>    <span class=p>}</span>
</span><span id=__span-0-83><a id=__codelineno-0-83 name=__codelineno-0-83></a>
</span><span id=__span-0-84><a id=__codelineno-0-84 name=__codelineno-0-84></a>    <span class=n>data</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;agent_name&quot;</span><span class=p>:</span> <span class=n>agent_name</span><span class=p>}</span>
</span><span id=__span-0-85><a id=__codelineno-0-85 name=__codelineno-0-85></a>
</span><span id=__span-0-86><a id=__codelineno-0-86 name=__codelineno-0-86></a>    <span class=n>endpoint</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>/get_agent_public_key&quot;</span>
</span><span id=__span-0-87><a id=__codelineno-0-87 name=__codelineno-0-87></a>
</span><span id=__span-0-88><a id=__codelineno-0-88 name=__codelineno-0-88></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-89><a id=__codelineno-0-89 name=__codelineno-0-89></a>        <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>endpoint</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>,</span> <span class=n>params</span><span class=o>=</span><span class=n>data</span><span class=p>)</span>
</span><span id=__span-0-90><a id=__codelineno-0-90 name=__codelineno-0-90></a>        <span class=n>response</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
</span><span id=__span-0-91><a id=__codelineno-0-91 name=__codelineno-0-91></a>        <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span><span id=__span-0-92><a id=__codelineno-0-92 name=__codelineno-0-92></a>    <span class=k>except</span> <span class=n>requests</span><span class=o>.</span><span class=n>RequestException</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-93><a id=__codelineno-0-93 name=__codelineno-0-93></a>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Failed to get agent public key: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span> <span class=kn>from</span><span class=w> </span><span class=kc>None</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.inference_client.InferenceClient.get_thread class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_thread</span> <a href=#nearai.shared.inference_client.InferenceClient.get_thread class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>get_thread</span><span class=p>(</span><span class=n>thread_id</span><span class=p>:</span> <span class=n>str</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Get a thread.</p> <details class=quote> <summary>Source code in <code>nearai/shared/inference_client.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-304>304</a></span>
<span class=normal><a href=#__codelineno-0-305>305</a></span>
<span class=normal><a href=#__codelineno-0-306>306</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-304><a id=__codelineno-0-304 name=__codelineno-0-304></a><span class=k>def</span><span class=w> </span><span class=nf>get_thread</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>thread_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-305><a id=__codelineno-0-305 name=__codelineno-0-305></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Get a thread.&quot;&quot;&quot;</span>
</span><span id=__span-0-306><a id=__codelineno-0-306 name=__codelineno-0-306></a>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>retrieve</span><span class=p>(</span><span class=n>thread_id</span><span class=o>=</span><span class=n>thread_id</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.inference_client.InferenceClient.get_vector_store class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_vector_store</span> <a href=#nearai.shared.inference_client.InferenceClient.get_vector_store class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>get_vector_store</span><span class=p>(</span><span class=n>vector_store_id</span><span class=p>:</span> <span class=n>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=openai.types.beta.vector_store.VectorStore>VectorStore</span></span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Gets a vector store by id.</p> <details class=quote> <summary>Source code in <code>nearai/shared/inference_client.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-286>286</a></span>
<span class=normal><a href=#__codelineno-0-287>287</a></span>
<span class=normal><a href=#__codelineno-0-288>288</a></span>
<span class=normal><a href=#__codelineno-0-289>289</a></span>
<span class=normal><a href=#__codelineno-0-290>290</a></span>
<span class=normal><a href=#__codelineno-0-291>291</a></span>
<span class=normal><a href=#__codelineno-0-292>292</a></span>
<span class=normal><a href=#__codelineno-0-293>293</a></span>
<span class=normal><a href=#__codelineno-0-294>294</a></span>
<span class=normal><a href=#__codelineno-0-295>295</a></span>
<span class=normal><a href=#__codelineno-0-296>296</a></span>
<span class=normal><a href=#__codelineno-0-297>297</a></span>
<span class=normal><a href=#__codelineno-0-298>298</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-286><a id=__codelineno-0-286 name=__codelineno-0-286></a><span class=k>def</span><span class=w> </span><span class=nf>get_vector_store</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>vector_store_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>VectorStore</span><span class=p>:</span>
</span><span id=__span-0-287><a id=__codelineno-0-287 name=__codelineno-0-287></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Gets a vector store by id.&quot;&quot;&quot;</span>
</span><span id=__span-0-288><a id=__codelineno-0-288 name=__codelineno-0-288></a>    <span class=n>endpoint</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>/vector_stores/</span><span class=si>{</span><span class=n>vector_store_id</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-289><a id=__codelineno-0-289 name=__codelineno-0-289></a>    <span class=n>auth_bearer_token</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_auth</span>
</span><span id=__span-0-290><a id=__codelineno-0-290 name=__codelineno-0-290></a>
</span><span id=__span-0-291><a id=__codelineno-0-291 name=__codelineno-0-291></a>    <span class=n>headers</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-292><a id=__codelineno-0-292 name=__codelineno-0-292></a>        <span class=s2>&quot;Content-Type&quot;</span><span class=p>:</span> <span class=s2>&quot;application/json&quot;</span><span class=p>,</span>
</span><span id=__span-0-293><a id=__codelineno-0-293 name=__codelineno-0-293></a>        <span class=s2>&quot;Authorization&quot;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;Bearer </span><span class=si>{</span><span class=n>auth_bearer_token</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-0-294><a id=__codelineno-0-294 name=__codelineno-0-294></a>    <span class=p>}</span>
</span><span id=__span-0-295><a id=__codelineno-0-295 name=__codelineno-0-295></a>
</span><span id=__span-0-296><a id=__codelineno-0-296 name=__codelineno-0-296></a>    <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>endpoint</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span>
</span><span id=__span-0-297><a id=__codelineno-0-297 name=__codelineno-0-297></a>    <span class=n>response</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
</span><span id=__span-0-298><a id=__codelineno-0-298 name=__codelineno-0-298></a>    <span class=k>return</span> <span class=n>VectorStore</span><span class=p>(</span><span class=o>**</span><span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>())</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.inference_client.InferenceClient.get_vector_store_files class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_vector_store_files</span> <a href=#nearai.shared.inference_client.InferenceClient.get_vector_store_files class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>get_vector_store_files</span><span class=p>(</span><span class=n>vector_store_id</span><span class=p>:</span> <span class=n>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n><span title=typing.List>List</span></span><span class=p>[</span><span class=n><span title=openai.types.beta.vector_stores.VectorStoreFile>VectorStoreFile</span></span><span class=p>]]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Adds a file to vector store.</p> <details class=quote> <summary>Source code in <code>nearai/shared/inference_client.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-205>205</a></span>
<span class=normal><a href=#__codelineno-0-206>206</a></span>
<span class=normal><a href=#__codelineno-0-207>207</a></span>
<span class=normal><a href=#__codelineno-0-208>208</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-205><a id=__codelineno-0-205 name=__codelineno-0-205></a><span class=k>def</span><span class=w> </span><span class=nf>get_vector_store_files</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>vector_store_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=n>VectorStoreFile</span><span class=p>]]:</span>
</span><span id=__span-0-206><a id=__codelineno-0-206 name=__codelineno-0-206></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Adds a file to vector store.&quot;&quot;&quot;</span>
</span><span id=__span-0-207><a id=__codelineno-0-207 name=__codelineno-0-207></a>    <span class=n>client</span> <span class=o>=</span> <span class=n>openai</span><span class=o>.</span><span class=n>OpenAI</span><span class=p>(</span><span class=n>base_url</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>base_url</span><span class=p>,</span> <span class=n>api_key</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_auth</span><span class=p>)</span>
</span><span id=__span-0-208><a id=__codelineno-0-208 name=__codelineno-0-208></a>    <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>vector_stores</span><span class=o>.</span><span class=n>files</span><span class=o>.</span><span class=n>list</span><span class=p>(</span><span class=n>vector_store_id</span><span class=o>=</span><span class=n>vector_store_id</span><span class=p>)</span><span class=o>.</span><span class=n>data</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.inference_client.InferenceClient.query_user_memory class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">query_user_memory</span> <a href=#nearai.shared.inference_client.InferenceClient.query_user_memory class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>query_user_memory</span><span class=p>(</span><span class=n>query</span><span class=p>:</span> <span class=n>str</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Query the user memory.</p> <details class=quote> <summary>Source code in <code>nearai/shared/inference_client.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-396>396</a></span>
<span class=normal><a href=#__codelineno-0-397>397</a></span>
<span class=normal><a href=#__codelineno-0-398>398</a></span>
<span class=normal><a href=#__codelineno-0-399>399</a></span>
<span class=normal><a href=#__codelineno-0-400>400</a></span>
<span class=normal><a href=#__codelineno-0-401>401</a></span>
<span class=normal><a href=#__codelineno-0-402>402</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-396><a id=__codelineno-0-396 name=__codelineno-0-396></a><span class=k>def</span><span class=w> </span><span class=nf>query_user_memory</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>query</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-397><a id=__codelineno-0-397 name=__codelineno-0-397></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Query the user memory.&quot;&quot;&quot;</span>
</span><span id=__span-0-398><a id=__codelineno-0-398 name=__codelineno-0-398></a>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>post</span><span class=p>(</span>
</span><span id=__span-0-399><a id=__codelineno-0-399 name=__codelineno-0-399></a>        <span class=n>path</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>/vector_stores/memory/query&quot;</span><span class=p>,</span>
</span><span id=__span-0-400><a id=__codelineno-0-400 name=__codelineno-0-400></a>        <span class=n>body</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;query&quot;</span><span class=p>:</span> <span class=n>query</span><span class=p>},</span>
</span><span id=__span-0-401><a id=__codelineno-0-401 name=__codelineno-0-401></a>        <span class=n>cast_to</span><span class=o>=</span><span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-402><a id=__codelineno-0-402 name=__codelineno-0-402></a>    <span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.inference_client.InferenceClient.query_vector_store class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">query_vector_store</span> <a href=#nearai.shared.inference_client.InferenceClient.query_vector_store class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>query_vector_store</span><span class=p>(</span><span class=n>vector_store_id</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>query</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>full_files</span><span class=p>:</span> <span class=n>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=typing.Union>Union</span></span><span class=p>[</span><span class=n><span title=typing.List>List</span></span><span class=p>[</span><span class=n><span title=nearai.shared.models.SimilaritySearch>SimilaritySearch</span></span><span class=p>],</span> <span class=n><span title=typing.List>List</span></span><span class=p>[</span><span class=n><span title=nearai.shared.models.SimilaritySearchFile>SimilaritySearchFile</span></span><span class=p>]]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Query a vector store.</p> <details class=quote> <summary>Source code in <code>nearai/shared/inference_client.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-154>154</a></span>
<span class=normal><a href=#__codelineno-0-155>155</a></span>
<span class=normal><a href=#__codelineno-0-156>156</a></span>
<span class=normal><a href=#__codelineno-0-157>157</a></span>
<span class=normal><a href=#__codelineno-0-158>158</a></span>
<span class=normal><a href=#__codelineno-0-159>159</a></span>
<span class=normal><a href=#__codelineno-0-160>160</a></span>
<span class=normal><a href=#__codelineno-0-161>161</a></span>
<span class=normal><a href=#__codelineno-0-162>162</a></span>
<span class=normal><a href=#__codelineno-0-163>163</a></span>
<span class=normal><a href=#__codelineno-0-164>164</a></span>
<span class=normal><a href=#__codelineno-0-165>165</a></span>
<span class=normal><a href=#__codelineno-0-166>166</a></span>
<span class=normal><a href=#__codelineno-0-167>167</a></span>
<span class=normal><a href=#__codelineno-0-168>168</a></span>
<span class=normal><a href=#__codelineno-0-169>169</a></span>
<span class=normal><a href=#__codelineno-0-170>170</a></span>
<span class=normal><a href=#__codelineno-0-171>171</a></span>
<span class=normal><a href=#__codelineno-0-172>172</a></span>
<span class=normal><a href=#__codelineno-0-173>173</a></span>
<span class=normal><a href=#__codelineno-0-174>174</a></span>
<span class=normal><a href=#__codelineno-0-175>175</a></span>
<span class=normal><a href=#__codelineno-0-176>176</a></span>
<span class=normal><a href=#__codelineno-0-177>177</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-154><a id=__codelineno-0-154 name=__codelineno-0-154></a><span class=k>def</span><span class=w> </span><span class=nf>query_vector_store</span><span class=p>(</span>
</span><span id=__span-0-155><a id=__codelineno-0-155 name=__codelineno-0-155></a>    <span class=bp>self</span><span class=p>,</span> <span class=n>vector_store_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>query</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>full_files</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span>
</span><span id=__span-0-156><a id=__codelineno-0-156 name=__codelineno-0-156></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=n>SimilaritySearch</span><span class=p>],</span> <span class=n>List</span><span class=p>[</span><span class=n>SimilaritySearchFile</span><span class=p>]]:</span>
</span><span id=__span-0-157><a id=__codelineno-0-157 name=__codelineno-0-157></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Query a vector store.&quot;&quot;&quot;</span>
</span><span id=__span-0-158><a id=__codelineno-0-158 name=__codelineno-0-158></a>    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_config</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-159><a id=__codelineno-0-159 name=__codelineno-0-159></a>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Missing NEAR AI Hub config&quot;</span><span class=p>)</span>
</span><span id=__span-0-160><a id=__codelineno-0-160 name=__codelineno-0-160></a>
</span><span id=__span-0-161><a id=__codelineno-0-161 name=__codelineno-0-161></a>    <span class=n>auth_bearer_token</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_auth</span>
</span><span id=__span-0-162><a id=__codelineno-0-162 name=__codelineno-0-162></a>
</span><span id=__span-0-163><a id=__codelineno-0-163 name=__codelineno-0-163></a>    <span class=n>headers</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-164><a id=__codelineno-0-164 name=__codelineno-0-164></a>        <span class=s2>&quot;Content-Type&quot;</span><span class=p>:</span> <span class=s2>&quot;application/json&quot;</span><span class=p>,</span>
</span><span id=__span-0-165><a id=__codelineno-0-165 name=__codelineno-0-165></a>        <span class=s2>&quot;Authorization&quot;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;Bearer </span><span class=si>{</span><span class=n>auth_bearer_token</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-0-166><a id=__codelineno-0-166 name=__codelineno-0-166></a>    <span class=p>}</span>
</span><span id=__span-0-167><a id=__codelineno-0-167 name=__codelineno-0-167></a>
</span><span id=__span-0-168><a id=__codelineno-0-168 name=__codelineno-0-168></a>    <span class=n>data</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;query&quot;</span><span class=p>:</span> <span class=n>query</span><span class=p>,</span> <span class=s2>&quot;full_files&quot;</span><span class=p>:</span> <span class=n>full_files</span><span class=p>}</span>
</span><span id=__span-0-169><a id=__codelineno-0-169 name=__codelineno-0-169></a>
</span><span id=__span-0-170><a id=__codelineno-0-170 name=__codelineno-0-170></a>    <span class=n>endpoint</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>/vector_stores/</span><span class=si>{</span><span class=n>vector_store_id</span><span class=si>}</span><span class=s2>/search&quot;</span>
</span><span id=__span-0-171><a id=__codelineno-0-171 name=__codelineno-0-171></a>
</span><span id=__span-0-172><a id=__codelineno-0-172 name=__codelineno-0-172></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-173><a id=__codelineno-0-173 name=__codelineno-0-173></a>        <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>endpoint</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>,</span> <span class=n>json</span><span class=o>=</span><span class=n>data</span><span class=p>)</span>
</span><span id=__span-0-174><a id=__codelineno-0-174 name=__codelineno-0-174></a>        <span class=n>response</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
</span><span id=__span-0-175><a id=__codelineno-0-175 name=__codelineno-0-175></a>        <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span><span id=__span-0-176><a id=__codelineno-0-176 name=__codelineno-0-176></a>    <span class=k>except</span> <span class=n>requests</span><span class=o>.</span><span class=n>RequestException</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-177><a id=__codelineno-0-177 name=__codelineno-0-177></a>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error querying vector store: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span> <span class=kn>from</span><span class=w> </span><span class=kc>None</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.inference_client.InferenceClient.remove_file class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">remove_file</span> <a href=#nearai.shared.inference_client.InferenceClient.remove_file class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>remove_file</span><span class=p>(</span><span class=n>file_id</span><span class=p>:</span> <span class=n>str</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Removes a file.</p> <details class=quote> <summary>Source code in <code>nearai/shared/inference_client.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-195>195</a></span>
<span class=normal><a href=#__codelineno-0-196>196</a></span>
<span class=normal><a href=#__codelineno-0-197>197</a></span>
<span class=normal><a href=#__codelineno-0-198>198</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-195><a id=__codelineno-0-195 name=__codelineno-0-195></a><span class=k>def</span><span class=w> </span><span class=nf>remove_file</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>file_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-196><a id=__codelineno-0-196 name=__codelineno-0-196></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Removes a file.&quot;&quot;&quot;</span>
</span><span id=__span-0-197><a id=__codelineno-0-197 name=__codelineno-0-197></a>    <span class=n>client</span> <span class=o>=</span> <span class=n>openai</span><span class=o>.</span><span class=n>OpenAI</span><span class=p>(</span><span class=n>base_url</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>base_url</span><span class=p>,</span> <span class=n>api_key</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_auth</span><span class=p>)</span>
</span><span id=__span-0-198><a id=__codelineno-0-198 name=__codelineno-0-198></a>    <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>files</span><span class=o>.</span><span class=n>delete</span><span class=p>(</span><span class=n>file_id</span><span class=o>=</span><span class=n>file_id</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.inference_client.InferenceClient.run_agent class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">run_agent</span> <a href=#nearai.shared.inference_client.InferenceClient.run_agent class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>run_agent</span><span class=p>(</span><span class=n>run_on_thread_id</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>assistant_id</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>parent_run_id</span><span class=p>:</span> <span class=n>str</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=n>run_mode</span><span class=p>:</span> <span class=n><span title=nearai.shared.models.RunMode>RunMode</span></span> <span class=o>=</span> <span class=n><span title=nearai.shared.models.RunMode.SIMPLE>SIMPLE</span></span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Starts a child agent run from a parent agent run.</p> <details class=quote> <summary>Source code in <code>nearai/shared/inference_client.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-343>343</a></span>
<span class=normal><a href=#__codelineno-0-344>344</a></span>
<span class=normal><a href=#__codelineno-0-345>345</a></span>
<span class=normal><a href=#__codelineno-0-346>346</a></span>
<span class=normal><a href=#__codelineno-0-347>347</a></span>
<span class=normal><a href=#__codelineno-0-348>348</a></span>
<span class=normal><a href=#__codelineno-0-349>349</a></span>
<span class=normal><a href=#__codelineno-0-350>350</a></span>
<span class=normal><a href=#__codelineno-0-351>351</a></span>
<span class=normal><a href=#__codelineno-0-352>352</a></span>
<span class=normal><a href=#__codelineno-0-353>353</a></span>
<span class=normal><a href=#__codelineno-0-354>354</a></span>
<span class=normal><a href=#__codelineno-0-355>355</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-343><a id=__codelineno-0-343 name=__codelineno-0-343></a><span class=k>def</span><span class=w> </span><span class=nf>run_agent</span><span class=p>(</span>
</span><span id=__span-0-344><a id=__codelineno-0-344 name=__codelineno-0-344></a>    <span class=bp>self</span><span class=p>,</span> <span class=n>run_on_thread_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>assistant_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>parent_run_id</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>run_mode</span><span class=p>:</span> <span class=n>RunMode</span> <span class=o>=</span> <span class=n>RunMode</span><span class=o>.</span><span class=n>SIMPLE</span>
</span><span id=__span-0-345><a id=__codelineno-0-345 name=__codelineno-0-345></a><span class=p>):</span>
</span><span id=__span-0-346><a id=__codelineno-0-346 name=__codelineno-0-346></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Starts a child agent run from a parent agent run.&quot;&quot;&quot;</span>
</span><span id=__span-0-347><a id=__codelineno-0-347 name=__codelineno-0-347></a>    <span class=n>extra_body</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-0-348><a id=__codelineno-0-348 name=__codelineno-0-348></a>    <span class=k>if</span> <span class=n>parent_run_id</span><span class=p>:</span>
</span><span id=__span-0-349><a id=__codelineno-0-349 name=__codelineno-0-349></a>        <span class=n>extra_body</span><span class=p>[</span><span class=s2>&quot;parent_run_id&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>parent_run_id</span>
</span><span id=__span-0-350><a id=__codelineno-0-350 name=__codelineno-0-350></a>    <span class=n>extra_body</span><span class=p>[</span><span class=s2>&quot;run_mode&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>run_mode</span><span class=o>.</span><span class=n>value</span>  <span class=c1># type: ignore</span>
</span><span id=__span-0-351><a id=__codelineno-0-351 name=__codelineno-0-351></a>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>runs</span><span class=o>.</span><span class=n>create</span><span class=p>(</span>
</span><span id=__span-0-352><a id=__codelineno-0-352 name=__codelineno-0-352></a>        <span class=n>thread_id</span><span class=o>=</span><span class=n>run_on_thread_id</span><span class=p>,</span>
</span><span id=__span-0-353><a id=__codelineno-0-353 name=__codelineno-0-353></a>        <span class=n>assistant_id</span><span class=o>=</span><span class=n>assistant_id</span><span class=p>,</span>
</span><span id=__span-0-354><a id=__codelineno-0-354 name=__codelineno-0-354></a>        <span class=n>extra_body</span><span class=o>=</span><span class=n>extra_body</span><span class=p>,</span>
</span><span id=__span-0-355><a id=__codelineno-0-355 name=__codelineno-0-355></a>    <span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.inference_client.InferenceClient.save_agent_data class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">save_agent_data</span> <a href=#nearai.shared.inference_client.InferenceClient.save_agent_data class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>save_agent_data</span><span class=p>(</span><span class=n>key</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>agent_data</span><span class=p>:</span> <span class=n><span title=typing.Dict>Dict</span></span><span class=p>[</span><span class=n>str</span><span class=p>,</span> <span class=n><span title=typing.Any>Any</span></span><span class=p>])</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Save agent data for the agent this client was initialized with.</p> <details class=quote> <summary>Source code in <code>nearai/shared/inference_client.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-416>416</a></span>
<span class=normal><a href=#__codelineno-0-417>417</a></span>
<span class=normal><a href=#__codelineno-0-418>418</a></span>
<span class=normal><a href=#__codelineno-0-419>419</a></span>
<span class=normal><a href=#__codelineno-0-420>420</a></span>
<span class=normal><a href=#__codelineno-0-421>421</a></span>
<span class=normal><a href=#__codelineno-0-422>422</a></span>
<span class=normal><a href=#__codelineno-0-423>423</a></span>
<span class=normal><a href=#__codelineno-0-424>424</a></span>
<span class=normal><a href=#__codelineno-0-425>425</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-416><a id=__codelineno-0-416 name=__codelineno-0-416></a><span class=k>def</span><span class=w> </span><span class=nf>save_agent_data</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>agent_data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]):</span>
</span><span id=__span-0-417><a id=__codelineno-0-417 name=__codelineno-0-417></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Save agent data for the agent this client was initialized with.&quot;&quot;&quot;</span>
</span><span id=__span-0-418><a id=__codelineno-0-418 name=__codelineno-0-418></a>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>post</span><span class=p>(</span>
</span><span id=__span-0-419><a id=__codelineno-0-419 name=__codelineno-0-419></a>        <span class=n>path</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>/agent_data&quot;</span><span class=p>,</span>
</span><span id=__span-0-420><a id=__codelineno-0-420 name=__codelineno-0-420></a>        <span class=n>body</span><span class=o>=</span><span class=p>{</span>
</span><span id=__span-0-421><a id=__codelineno-0-421 name=__codelineno-0-421></a>            <span class=s2>&quot;key&quot;</span><span class=p>:</span> <span class=n>key</span><span class=p>,</span>
</span><span id=__span-0-422><a id=__codelineno-0-422 name=__codelineno-0-422></a>            <span class=s2>&quot;value&quot;</span><span class=p>:</span> <span class=n>agent_data</span><span class=p>,</span>
</span><span id=__span-0-423><a id=__codelineno-0-423 name=__codelineno-0-423></a>        <span class=p>},</span>
</span><span id=__span-0-424><a id=__codelineno-0-424 name=__codelineno-0-424></a>        <span class=n>cast_to</span><span class=o>=</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span>
</span><span id=__span-0-425><a id=__codelineno-0-425 name=__codelineno-0-425></a>    <span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.inference_client.InferenceClient.schedule_run class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">schedule_run</span> <a href=#nearai.shared.inference_client.InferenceClient.schedule_run class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>schedule_run</span><span class=p>(</span><span class=n>agent</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>input_message</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>thread_id</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>str</span><span class=p>],</span> <span class=n>run_params</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n><span title=typing.Dict>Dict</span></span><span class=p>[</span><span class=n>str</span><span class=p>,</span> <span class=n>str</span><span class=p>]],</span> <span class=n>run_at</span><span class=p>:</span> <span class=n><span title=datetime.datetime>datetime</span></span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Query a vector store.</p> <details class=quote> <summary>Source code in <code>nearai/shared/inference_client.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-357>357</a></span>
<span class=normal><a href=#__codelineno-0-358>358</a></span>
<span class=normal><a href=#__codelineno-0-359>359</a></span>
<span class=normal><a href=#__codelineno-0-360>360</a></span>
<span class=normal><a href=#__codelineno-0-361>361</a></span>
<span class=normal><a href=#__codelineno-0-362>362</a></span>
<span class=normal><a href=#__codelineno-0-363>363</a></span>
<span class=normal><a href=#__codelineno-0-364>364</a></span>
<span class=normal><a href=#__codelineno-0-365>365</a></span>
<span class=normal><a href=#__codelineno-0-366>366</a></span>
<span class=normal><a href=#__codelineno-0-367>367</a></span>
<span class=normal><a href=#__codelineno-0-368>368</a></span>
<span class=normal><a href=#__codelineno-0-369>369</a></span>
<span class=normal><a href=#__codelineno-0-370>370</a></span>
<span class=normal><a href=#__codelineno-0-371>371</a></span>
<span class=normal><a href=#__codelineno-0-372>372</a></span>
<span class=normal><a href=#__codelineno-0-373>373</a></span>
<span class=normal><a href=#__codelineno-0-374>374</a></span>
<span class=normal><a href=#__codelineno-0-375>375</a></span>
<span class=normal><a href=#__codelineno-0-376>376</a></span>
<span class=normal><a href=#__codelineno-0-377>377</a></span>
<span class=normal><a href=#__codelineno-0-378>378</a></span>
<span class=normal><a href=#__codelineno-0-379>379</a></span>
<span class=normal><a href=#__codelineno-0-380>380</a></span>
<span class=normal><a href=#__codelineno-0-381>381</a></span>
<span class=normal><a href=#__codelineno-0-382>382</a></span>
<span class=normal><a href=#__codelineno-0-383>383</a></span>
<span class=normal><a href=#__codelineno-0-384>384</a></span>
<span class=normal><a href=#__codelineno-0-385>385</a></span>
<span class=normal><a href=#__codelineno-0-386>386</a></span>
<span class=normal><a href=#__codelineno-0-387>387</a></span>
<span class=normal><a href=#__codelineno-0-388>388</a></span>
<span class=normal><a href=#__codelineno-0-389>389</a></span>
<span class=normal><a href=#__codelineno-0-390>390</a></span>
<span class=normal><a href=#__codelineno-0-391>391</a></span>
<span class=normal><a href=#__codelineno-0-392>392</a></span>
<span class=normal><a href=#__codelineno-0-393>393</a></span>
<span class=normal><a href=#__codelineno-0-394>394</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-357><a id=__codelineno-0-357 name=__codelineno-0-357></a><span class=k>def</span><span class=w> </span><span class=nf>schedule_run</span><span class=p>(</span>
</span><span id=__span-0-358><a id=__codelineno-0-358 name=__codelineno-0-358></a>    <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-359><a id=__codelineno-0-359 name=__codelineno-0-359></a>    <span class=n>agent</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-360><a id=__codelineno-0-360 name=__codelineno-0-360></a>    <span class=n>input_message</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-361><a id=__codelineno-0-361 name=__codelineno-0-361></a>    <span class=n>thread_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>],</span>
</span><span id=__span-0-362><a id=__codelineno-0-362 name=__codelineno-0-362></a>    <span class=n>run_params</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]],</span>
</span><span id=__span-0-363><a id=__codelineno-0-363 name=__codelineno-0-363></a>    <span class=n>run_at</span><span class=p>:</span> <span class=n>datetime</span><span class=p>,</span>
</span><span id=__span-0-364><a id=__codelineno-0-364 name=__codelineno-0-364></a><span class=p>):</span>
</span><span id=__span-0-365><a id=__codelineno-0-365 name=__codelineno-0-365></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Query a vector store.&quot;&quot;&quot;</span>
</span><span id=__span-0-366><a id=__codelineno-0-366 name=__codelineno-0-366></a>    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_config</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-367><a id=__codelineno-0-367 name=__codelineno-0-367></a>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Missing NearAI Hub config&quot;</span><span class=p>)</span>
</span><span id=__span-0-368><a id=__codelineno-0-368 name=__codelineno-0-368></a>
</span><span id=__span-0-369><a id=__codelineno-0-369 name=__codelineno-0-369></a>    <span class=n>auth_bearer_token</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_auth</span>
</span><span id=__span-0-370><a id=__codelineno-0-370 name=__codelineno-0-370></a>
</span><span id=__span-0-371><a id=__codelineno-0-371 name=__codelineno-0-371></a>    <span class=n>headers</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-372><a id=__codelineno-0-372 name=__codelineno-0-372></a>        <span class=s2>&quot;Content-Type&quot;</span><span class=p>:</span> <span class=s2>&quot;application/json&quot;</span><span class=p>,</span>
</span><span id=__span-0-373><a id=__codelineno-0-373 name=__codelineno-0-373></a>        <span class=s2>&quot;Authorization&quot;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;Bearer </span><span class=si>{</span><span class=n>auth_bearer_token</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span>
</span><span id=__span-0-374><a id=__codelineno-0-374 name=__codelineno-0-374></a>    <span class=p>}</span>
</span><span id=__span-0-375><a id=__codelineno-0-375 name=__codelineno-0-375></a>
</span><span id=__span-0-376><a id=__codelineno-0-376 name=__codelineno-0-376></a>    <span class=k>if</span> <span class=n>run_params</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-377><a id=__codelineno-0-377 name=__codelineno-0-377></a>        <span class=n>run_params</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-0-378><a id=__codelineno-0-378 name=__codelineno-0-378></a>
</span><span id=__span-0-379><a id=__codelineno-0-379 name=__codelineno-0-379></a>    <span class=n>data</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-380><a id=__codelineno-0-380 name=__codelineno-0-380></a>        <span class=s2>&quot;agent&quot;</span><span class=p>:</span> <span class=n>agent</span><span class=p>,</span>
</span><span id=__span-0-381><a id=__codelineno-0-381 name=__codelineno-0-381></a>        <span class=s2>&quot;input_message&quot;</span><span class=p>:</span> <span class=n>input_message</span><span class=p>,</span>
</span><span id=__span-0-382><a id=__codelineno-0-382 name=__codelineno-0-382></a>        <span class=s2>&quot;thread_id&quot;</span><span class=p>:</span> <span class=n>thread_id</span><span class=p>,</span>
</span><span id=__span-0-383><a id=__codelineno-0-383 name=__codelineno-0-383></a>        <span class=s2>&quot;run_params&quot;</span><span class=p>:</span> <span class=n>run_params</span><span class=p>,</span>
</span><span id=__span-0-384><a id=__codelineno-0-384 name=__codelineno-0-384></a>        <span class=s2>&quot;run_at&quot;</span><span class=p>:</span> <span class=n>run_at</span><span class=p>,</span>
</span><span id=__span-0-385><a id=__codelineno-0-385 name=__codelineno-0-385></a>    <span class=p>}</span>
</span><span id=__span-0-386><a id=__codelineno-0-386 name=__codelineno-0-386></a>
</span><span id=__span-0-387><a id=__codelineno-0-387 name=__codelineno-0-387></a>    <span class=n>endpoint</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>/schedule_run&quot;</span>
</span><span id=__span-0-388><a id=__codelineno-0-388 name=__codelineno-0-388></a>
</span><span id=__span-0-389><a id=__codelineno-0-389 name=__codelineno-0-389></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-390><a id=__codelineno-0-390 name=__codelineno-0-390></a>        <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>endpoint</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>,</span> <span class=n>json</span><span class=o>=</span><span class=n>data</span><span class=p>)</span>
</span><span id=__span-0-391><a id=__codelineno-0-391 name=__codelineno-0-391></a>        <span class=n>response</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
</span><span id=__span-0-392><a id=__codelineno-0-392 name=__codelineno-0-392></a>        <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span><span id=__span-0-393><a id=__codelineno-0-393 name=__codelineno-0-393></a>    <span class=k>except</span> <span class=n>requests</span><span class=o>.</span><span class=n>RequestException</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-394><a id=__codelineno-0-394 name=__codelineno-0-394></a>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error querying schedule_run: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span> <span class=kn>from</span><span class=w> </span><span class=kc>None</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.inference_client.InferenceClient.set_provider_models class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">set_provider_models</span> <a href=#nearai.shared.inference_client.InferenceClient.set_provider_models class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>set_provider_models</span><span class=p>(</span><span class=n>provider_models</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n><a class="autorefs autorefs-internal" title=nearai.shared.provider_models.ProviderModels href=#nearai.shared.provider_models.ProviderModels>ProviderModels</a></span><span class=p>])</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Set provider models. Used by external caching.</p> <details class=quote> <summary>Source code in <code>nearai/shared/inference_client.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-71>71</a></span>
<span class=normal><a href=#__codelineno-0-72>72</a></span>
<span class=normal><a href=#__codelineno-0-73>73</a></span>
<span class=normal><a href=#__codelineno-0-74>74</a></span>
<span class=normal><a href=#__codelineno-0-75>75</a></span>
<span class=normal><a href=#__codelineno-0-76>76</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-71><a id=__codelineno-0-71 name=__codelineno-0-71></a><span class=k>def</span><span class=w> </span><span class=nf>set_provider_models</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>provider_models</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>ProviderModels</span><span class=p>]):</span>
</span><span id=__span-0-72><a id=__codelineno-0-72 name=__codelineno-0-72></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Set provider models. Used by external caching.&quot;&quot;&quot;</span>
</span><span id=__span-0-73><a id=__codelineno-0-73 name=__codelineno-0-73></a>    <span class=k>if</span> <span class=n>provider_models</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-74><a id=__codelineno-0-74 name=__codelineno-0-74></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_provider_models</span> <span class=o>=</span> <span class=n>ProviderModels</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=p>)</span>
</span><span id=__span-0-75><a id=__codelineno-0-75 name=__codelineno-0-75></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-76><a id=__codelineno-0-76 name=__codelineno-0-76></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_provider_models</span> <span class=o>=</span> <span class=n>provider_models</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.inference_client.InferenceClient.threads_create_and_run_poll class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">threads_create_and_run_poll</span> <a href=#nearai.shared.inference_client.InferenceClient.threads_create_and_run_poll class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>threads_create_and_run_poll</span><span class=p>(</span><span class=n>assistant_id</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>model</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>messages</span><span class=p>:</span> <span class=n><span title=typing.List>List</span></span><span class=p>[</span><span class=n><span title=litellm.types.completion.ChatCompletionMessageParam>ChatCompletionMessageParam</span></span><span class=p>])</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Create a thread and run the assistant.</p> <details class=quote> <summary>Source code in <code>nearai/shared/inference_client.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-312>312</a></span>
<span class=normal><a href=#__codelineno-0-313>313</a></span>
<span class=normal><a href=#__codelineno-0-314>314</a></span>
<span class=normal><a href=#__codelineno-0-315>315</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-312><a id=__codelineno-0-312 name=__codelineno-0-312></a><span class=k>def</span><span class=w> </span><span class=nf>threads_create_and_run_poll</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>assistant_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>model</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>messages</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>ChatCompletionMessageParam</span><span class=p>]):</span>
</span><span id=__span-0-313><a id=__codelineno-0-313 name=__codelineno-0-313></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Create a thread and run the assistant.&quot;&quot;&quot;</span>
</span><span id=__span-0-314><a id=__codelineno-0-314 name=__codelineno-0-314></a>    <span class=n>thread</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>create_thread</span><span class=p>(</span><span class=n>messages</span><span class=p>)</span>
</span><span id=__span-0-315><a id=__codelineno-0-315 name=__codelineno-0-315></a>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>create_and_run_poll</span><span class=p>(</span><span class=n>thread</span><span class=o>=</span><span class=n>thread</span><span class=p>,</span> <span class=n>assistant_id</span><span class=o>=</span><span class=n>assistant_id</span><span class=p>,</span> <span class=n>model</span><span class=o>=</span><span class=n>model</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.inference_client.InferenceClient.threads_fork class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">threads_fork</span> <a href=#nearai.shared.inference_client.InferenceClient.threads_fork class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>threads_fork</span><span class=p>(</span><span class=n>thread_id</span><span class=p>:</span> <span class=n>str</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Fork a thread.</p> <details class=quote> <summary>Source code in <code>nearai/shared/inference_client.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-321>321</a></span>
<span class=normal><a href=#__codelineno-0-322>322</a></span>
<span class=normal><a href=#__codelineno-0-323>323</a></span>
<span class=normal><a href=#__codelineno-0-324>324</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-321><a id=__codelineno-0-321 name=__codelineno-0-321></a><span class=k>def</span><span class=w> </span><span class=nf>threads_fork</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>thread_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-322><a id=__codelineno-0-322 name=__codelineno-0-322></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Fork a thread.&quot;&quot;&quot;</span>
</span><span id=__span-0-323><a id=__codelineno-0-323 name=__codelineno-0-323></a>    <span class=n>forked_thread</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>path</span><span class=o>=</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>base_url</span><span class=si>}</span><span class=s2>/threads/</span><span class=si>{</span><span class=n>thread_id</span><span class=si>}</span><span class=s2>/fork&quot;</span><span class=p>,</span> <span class=n>cast_to</span><span class=o>=</span><span class=n>Thread</span><span class=p>)</span>
</span><span id=__span-0-324><a id=__codelineno-0-324 name=__codelineno-0-324></a>    <span class=k>return</span> <span class=n>forked_thread</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.inference_client.InferenceClient.threads_list_messages class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">threads_list_messages</span> <a href=#nearai.shared.inference_client.InferenceClient.threads_list_messages class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>threads_list_messages</span><span class=p>(</span><span class=n>thread_id</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>order</span><span class=p>:</span> <span class=n><span title=typing.Literal>Literal</span></span><span class=p>[</span><span class=s1>&#39;asc&#39;</span><span class=p>,</span> <span class=s1>&#39;desc&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;asc&#39;</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>List messages in a thread.</p> <details class=quote> <summary>Source code in <code>nearai/shared/inference_client.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-317>317</a></span>
<span class=normal><a href=#__codelineno-0-318>318</a></span>
<span class=normal><a href=#__codelineno-0-319>319</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-317><a id=__codelineno-0-317 name=__codelineno-0-317></a><span class=k>def</span><span class=w> </span><span class=nf>threads_list_messages</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>thread_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>order</span><span class=p>:</span> <span class=n>Literal</span><span class=p>[</span><span class=s2>&quot;asc&quot;</span><span class=p>,</span> <span class=s2>&quot;desc&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;asc&quot;</span><span class=p>):</span>
</span><span id=__span-0-318><a id=__codelineno-0-318 name=__codelineno-0-318></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;List messages in a thread.&quot;&quot;&quot;</span>
</span><span id=__span-0-319><a id=__codelineno-0-319 name=__codelineno-0-319></a>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>messages</span><span class=o>.</span><span class=n>list</span><span class=p>(</span><span class=n>thread_id</span><span class=o>=</span><span class=n>thread_id</span><span class=p>,</span> <span class=n>order</span><span class=o>=</span><span class=n>order</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.inference_client.InferenceClient.threads_messages_create class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">threads_messages_create</span> <a href=#nearai.shared.inference_client.InferenceClient.threads_messages_create class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>threads_messages_create</span><span class=p>(</span><span class=n>thread_id</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>content</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>role</span><span class=p>:</span> <span class=n><span title=typing.Literal>Literal</span></span><span class=p>[</span><span class=s1>&#39;user&#39;</span><span class=p>,</span> <span class=s1>&#39;assistant&#39;</span><span class=p>])</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Create a message in a thread.</p> <details class=quote> <summary>Source code in <code>nearai/shared/inference_client.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-308>308</a></span>
<span class=normal><a href=#__codelineno-0-309>309</a></span>
<span class=normal><a href=#__codelineno-0-310>310</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-308><a id=__codelineno-0-308 name=__codelineno-0-308></a><span class=k>def</span><span class=w> </span><span class=nf>threads_messages_create</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>thread_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>content</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>role</span><span class=p>:</span> <span class=n>Literal</span><span class=p>[</span><span class=s2>&quot;user&quot;</span><span class=p>,</span> <span class=s2>&quot;assistant&quot;</span><span class=p>]):</span>
</span><span id=__span-0-309><a id=__codelineno-0-309 name=__codelineno-0-309></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Create a message in a thread.&quot;&quot;&quot;</span>
</span><span id=__span-0-310><a id=__codelineno-0-310 name=__codelineno-0-310></a>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>messages</span><span class=o>.</span><span class=n>create</span><span class=p>(</span><span class=n>thread_id</span><span class=o>=</span><span class=n>thread_id</span><span class=p>,</span> <span class=n>content</span><span class=o>=</span><span class=n>content</span><span class=p>,</span> <span class=n>role</span><span class=o>=</span><span class=n>role</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.inference_client.InferenceClient.threads_runs_create class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">threads_runs_create</span> <a href=#nearai.shared.inference_client.InferenceClient.threads_runs_create class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>threads_runs_create</span><span class=p>(</span><span class=n>thread_id</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>assistant_id</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>model</span><span class=p>:</span> <span class=n>str</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Create a run in a thread.</p> <details class=quote> <summary>Source code in <code>nearai/shared/inference_client.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-339>339</a></span>
<span class=normal><a href=#__codelineno-0-340>340</a></span>
<span class=normal><a href=#__codelineno-0-341>341</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-339><a id=__codelineno-0-339 name=__codelineno-0-339></a><span class=k>def</span><span class=w> </span><span class=nf>threads_runs_create</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>thread_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>assistant_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>model</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-340><a id=__codelineno-0-340 name=__codelineno-0-340></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Create a run in a thread.&quot;&quot;&quot;</span>
</span><span id=__span-0-341><a id=__codelineno-0-341 name=__codelineno-0-341></a>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>runs</span><span class=o>.</span><span class=n>create</span><span class=p>(</span><span class=n>thread_id</span><span class=o>=</span><span class=n>thread_id</span><span class=p>,</span> <span class=n>assistant_id</span><span class=o>=</span><span class=n>assistant_id</span><span class=p>,</span> <span class=n>model</span><span class=o>=</span><span class=n>model</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.inference_client.InferenceClient.upload_file class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">upload_file</span> <a href=#nearai.shared.inference_client.InferenceClient.upload_file class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>upload_file</span><span class=p>(</span><span class=n>file_content</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>purpose</span><span class=p>:</span> <span class=n><span title=typing.Literal>Literal</span></span><span class=p>[</span><span class=s1>&#39;assistants&#39;</span><span class=p>,</span> <span class=s1>&#39;batch&#39;</span><span class=p>,</span> <span class=s1>&#39;fine-tune&#39;</span><span class=p>,</span> <span class=s1>&#39;vision&#39;</span><span class=p>],</span> <span class=n>encoding</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>str</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;utf-8&#39;</span><span class=p>,</span> <span class=n>file_name</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>str</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;file.txt&#39;</span><span class=p>,</span> <span class=n>file_type</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>str</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;text/plain&#39;</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n><span title=openai.types.file_object.FileObject>FileObject</span></span><span class=p>]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Uploads a file.</p> <details class=quote> <summary>Source code in <code>nearai/shared/inference_client.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-179>179</a></span>
<span class=normal><a href=#__codelineno-0-180>180</a></span>
<span class=normal><a href=#__codelineno-0-181>181</a></span>
<span class=normal><a href=#__codelineno-0-182>182</a></span>
<span class=normal><a href=#__codelineno-0-183>183</a></span>
<span class=normal><a href=#__codelineno-0-184>184</a></span>
<span class=normal><a href=#__codelineno-0-185>185</a></span>
<span class=normal><a href=#__codelineno-0-186>186</a></span>
<span class=normal><a href=#__codelineno-0-187>187</a></span>
<span class=normal><a href=#__codelineno-0-188>188</a></span>
<span class=normal><a href=#__codelineno-0-189>189</a></span>
<span class=normal><a href=#__codelineno-0-190>190</a></span>
<span class=normal><a href=#__codelineno-0-191>191</a></span>
<span class=normal><a href=#__codelineno-0-192>192</a></span>
<span class=normal><a href=#__codelineno-0-193>193</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-179><a id=__codelineno-0-179 name=__codelineno-0-179></a><span class=k>def</span><span class=w> </span><span class=nf>upload_file</span><span class=p>(</span>
</span><span id=__span-0-180><a id=__codelineno-0-180 name=__codelineno-0-180></a>    <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-181><a id=__codelineno-0-181 name=__codelineno-0-181></a>    <span class=n>file_content</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span><span id=__span-0-182><a id=__codelineno-0-182 name=__codelineno-0-182></a>    <span class=n>purpose</span><span class=p>:</span> <span class=n>Literal</span><span class=p>[</span><span class=s2>&quot;assistants&quot;</span><span class=p>,</span> <span class=s2>&quot;batch&quot;</span><span class=p>,</span> <span class=s2>&quot;fine-tune&quot;</span><span class=p>,</span> <span class=s2>&quot;vision&quot;</span><span class=p>],</span>
</span><span id=__span-0-183><a id=__codelineno-0-183 name=__codelineno-0-183></a>    <span class=n>encoding</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;utf-8&quot;</span><span class=p>,</span>
</span><span id=__span-0-184><a id=__codelineno-0-184 name=__codelineno-0-184></a>    <span class=n>file_name</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;file.txt&quot;</span><span class=p>,</span>
</span><span id=__span-0-185><a id=__codelineno-0-185 name=__codelineno-0-185></a>    <span class=n>file_type</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;text/plain&quot;</span><span class=p>,</span>
</span><span id=__span-0-186><a id=__codelineno-0-186 name=__codelineno-0-186></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>FileObject</span><span class=p>]:</span>
</span><span id=__span-0-187><a id=__codelineno-0-187 name=__codelineno-0-187></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Uploads a file.&quot;&quot;&quot;</span>
</span><span id=__span-0-188><a id=__codelineno-0-188 name=__codelineno-0-188></a>    <span class=n>client</span> <span class=o>=</span> <span class=n>openai</span><span class=o>.</span><span class=n>OpenAI</span><span class=p>(</span><span class=n>base_url</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>base_url</span><span class=p>,</span> <span class=n>api_key</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_auth</span><span class=p>)</span>
</span><span id=__span-0-189><a id=__codelineno-0-189 name=__codelineno-0-189></a>    <span class=k>if</span> <span class=n>file_content</span><span class=p>:</span>
</span><span id=__span-0-190><a id=__codelineno-0-190 name=__codelineno-0-190></a>        <span class=n>file_data</span> <span class=o>=</span> <span class=n>io</span><span class=o>.</span><span class=n>BytesIO</span><span class=p>(</span><span class=n>file_content</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=n>encoding</span> <span class=ow>or</span> <span class=s2>&quot;utf-8&quot;</span><span class=p>))</span>
</span><span id=__span-0-191><a id=__codelineno-0-191 name=__codelineno-0-191></a>        <span class=k>return</span> <span class=n>client</span><span class=o>.</span><span class=n>files</span><span class=o>.</span><span class=n>create</span><span class=p>(</span><span class=n>file</span><span class=o>=</span><span class=p>(</span><span class=n>file_name</span><span class=p>,</span> <span class=n>file_data</span><span class=p>,</span> <span class=n>file_type</span><span class=p>),</span> <span class=n>purpose</span><span class=o>=</span><span class=n>purpose</span><span class=p>)</span>
</span><span id=__span-0-192><a id=__codelineno-0-192 name=__codelineno-0-192></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-193><a id=__codelineno-0-193 name=__codelineno-0-193></a>        <span class=k>return</span> <span class=kc>None</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> </div> </div> </div> <div class="doc doc-object doc-module"> <h4 id=nearai.shared.models class="doc doc-heading"> <span class="doc doc-object-name doc-module-name">models</span> <a href=#nearai.shared.models class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h5 id=nearai.shared.models.AutoFileChunkingStrategyParam class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">AutoFileChunkingStrategyParam</span> <a href=#nearai.shared.models.AutoFileChunkingStrategyParam class=headerlink title="Permanent link">&para;</a></h5> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=typing_extensions.TypedDict>TypedDict</span></code></p> <details class=quote> <summary>Source code in <code>nearai/shared/models.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-58>58</a></span>
<span class=normal><a href=#__codelineno-0-59>59</a></span>
<span class=normal><a href=#__codelineno-0-60>60</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-58><a id=__codelineno-0-58 name=__codelineno-0-58></a><span class=k>class</span><span class=w> </span><span class=nc>AutoFileChunkingStrategyParam</span><span class=p>(</span><span class=n>TypedDict</span><span class=p>,</span> <span class=n>total</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
</span><span id=__span-0-59><a id=__codelineno-0-59 name=__codelineno-0-59></a>    <span class=nb>type</span><span class=p>:</span> <span class=n>Required</span><span class=p>[</span><span class=n>Literal</span><span class=p>[</span><span class=s2>&quot;auto&quot;</span><span class=p>]]</span>
</span><span id=__span-0-60><a id=__codelineno-0-60 name=__codelineno-0-60></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Always `auto`.&quot;&quot;&quot;</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-attribute"> <h6 id=nearai.shared.models.AutoFileChunkingStrategyParam.type class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">type</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small> </span> <a href=#nearai.shared.models.AutoFileChunkingStrategyParam.type class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nb>type</span><span class=p>:</span> <span class=n><span title=typing_extensions.Required>Required</span></span><span class=p>[</span><span class=n><span title=typing.Literal>Literal</span></span><span class=p>[</span><span class=s1>&#39;auto&#39;</span><span class=p>]]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Always <code>auto</code>.</p> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h5 id=nearai.shared.models.ChunkingStrategy class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">ChunkingStrategy</span> <a href=#nearai.shared.models.ChunkingStrategy class=headerlink title="Permanent link">&para;</a></h5> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=pydantic.BaseModel>BaseModel</span></code></p> <p>Defines the chunking strategy for vector stores.</p> <details class=quote> <summary>Source code in <code>nearai/shared/models.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-52>52</a></span>
<span class=normal><a href=#__codelineno-0-53>53</a></span>
<span class=normal><a href=#__codelineno-0-54>54</a></span>
<span class=normal><a href=#__codelineno-0-55>55</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-52><a id=__codelineno-0-52 name=__codelineno-0-52></a><span class=k>class</span><span class=w> </span><span class=nc>ChunkingStrategy</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span><span id=__span-0-53><a id=__codelineno-0-53 name=__codelineno-0-53></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Defines the chunking strategy for vector stores.&quot;&quot;&quot;</span>
</span><span id=__span-0-54><a id=__codelineno-0-54 name=__codelineno-0-54></a>
</span><span id=__span-0-55><a id=__codelineno-0-55 name=__codelineno-0-55></a>    <span class=k>pass</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-class"> <h5 id=nearai.shared.models.CreateVectorStoreRequest class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">CreateVectorStoreRequest</span> <a href=#nearai.shared.models.CreateVectorStoreRequest class=headerlink title="Permanent link">&para;</a></h5> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=pydantic.BaseModel>BaseModel</span></code></p> <p>Request model for creating a new vector store.</p> <details class=quote> <summary>Source code in <code>nearai/shared/models.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-83>83</a></span>
<span class=normal><a href=#__codelineno-0-84>84</a></span>
<span class=normal><a href=#__codelineno-0-85>85</a></span>
<span class=normal><a href=#__codelineno-0-86>86</a></span>
<span class=normal><a href=#__codelineno-0-87>87</a></span>
<span class=normal><a href=#__codelineno-0-88>88</a></span>
<span class=normal><a href=#__codelineno-0-89>89</a></span>
<span class=normal><a href=#__codelineno-0-90>90</a></span>
<span class=normal><a href=#__codelineno-0-91>91</a></span>
<span class=normal><a href=#__codelineno-0-92>92</a></span>
<span class=normal><a href=#__codelineno-0-93>93</a></span>
<span class=normal><a href=#__codelineno-0-94>94</a></span>
<span class=normal><a href=#__codelineno-0-95>95</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-83><a id=__codelineno-0-83 name=__codelineno-0-83></a><span class=k>class</span><span class=w> </span><span class=nc>CreateVectorStoreRequest</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span><span id=__span-0-84><a id=__codelineno-0-84 name=__codelineno-0-84></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Request model for creating a new vector store.&quot;&quot;&quot;</span>
</span><span id=__span-0-85><a id=__codelineno-0-85 name=__codelineno-0-85></a>
</span><span id=__span-0-86><a id=__codelineno-0-86 name=__codelineno-0-86></a>    <span class=n>chunking_strategy</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>AutoFileChunkingStrategyParam</span><span class=p>,</span> <span class=n>StaticFileChunkingStrategyParam</span><span class=p>,</span> <span class=kc>None</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-87><a id=__codelineno-0-87 name=__codelineno-0-87></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;The chunking strategy to use for the vector store.&quot;&quot;&quot;</span>
</span><span id=__span-0-88><a id=__codelineno-0-88 name=__codelineno-0-88></a>    <span class=n>expires_after</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>ExpiresAfter</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-89><a id=__codelineno-0-89 name=__codelineno-0-89></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;The expiration time for the vector store.&quot;&quot;&quot;</span>
</span><span id=__span-0-90><a id=__codelineno-0-90 name=__codelineno-0-90></a>    <span class=n>file_ids</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-91><a id=__codelineno-0-91 name=__codelineno-0-91></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;The file IDs to attach to the vector store.&quot;&quot;&quot;</span>
</span><span id=__span-0-92><a id=__codelineno-0-92 name=__codelineno-0-92></a>    <span class=n>metadata</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-93><a id=__codelineno-0-93 name=__codelineno-0-93></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;The metadata to attach to the vector store.&quot;&quot;&quot;</span>
</span><span id=__span-0-94><a id=__codelineno-0-94 name=__codelineno-0-94></a>    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span>
</span><span id=__span-0-95><a id=__codelineno-0-95 name=__codelineno-0-95></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;The name of the vector store.&quot;&quot;&quot;</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-attribute"> <h6 id=nearai.shared.models.CreateVectorStoreRequest.chunking_strategy class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">chunking_strategy</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small> <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small> </span> <a href=#nearai.shared.models.CreateVectorStoreRequest.chunking_strategy class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=n>chunking_strategy</span><span class=p>:</span> <span class=n><span title=typing.Union>Union</span></span><span class=p>[</span><span class=n><a class="autorefs autorefs-internal" title=nearai.shared.models.AutoFileChunkingStrategyParam href=#nearai.shared.models.AutoFileChunkingStrategyParam>AutoFileChunkingStrategyParam</a></span><span class=p>,</span> <span class=n><a class="autorefs autorefs-internal" title=nearai.shared.models.StaticFileChunkingStrategyParam href=#nearai.shared.models.StaticFileChunkingStrategyParam>StaticFileChunkingStrategyParam</a></span><span class=p>,</span> <span class=kc>None</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>The chunking strategy to use for the vector store.</p> </div> </div> <div class="doc doc-object doc-attribute"> <h6 id=nearai.shared.models.CreateVectorStoreRequest.expires_after class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">expires_after</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small> <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small> </span> <a href=#nearai.shared.models.CreateVectorStoreRequest.expires_after class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=n>expires_after</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n><a class="autorefs autorefs-internal" title=nearai.shared.models.ExpiresAfter href=#nearai.shared.models.ExpiresAfter>ExpiresAfter</a></span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>The expiration time for the vector store.</p> </div> </div> <div class="doc doc-object doc-attribute"> <h6 id=nearai.shared.models.CreateVectorStoreRequest.file_ids class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">file_ids</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small> <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small> </span> <a href=#nearai.shared.models.CreateVectorStoreRequest.file_ids class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=n>file_ids</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n><span title=typing.List>List</span></span><span class=p>[</span><span class=n>str</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>The file IDs to attach to the vector store.</p> </div> </div> <div class="doc doc-object doc-attribute"> <h6 id=nearai.shared.models.CreateVectorStoreRequest.metadata class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">metadata</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small> <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small> </span> <a href=#nearai.shared.models.CreateVectorStoreRequest.metadata class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=n>metadata</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n><span title=typing.Dict>Dict</span></span><span class=p>[</span><span class=n>str</span><span class=p>,</span> <span class=n>str</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>The metadata to attach to the vector store.</p> </div> </div> <div class="doc doc-object doc-attribute"> <h6 id=nearai.shared.models.CreateVectorStoreRequest.name class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">name</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small> </span> <a href=#nearai.shared.models.CreateVectorStoreRequest.name class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=n>name</span><span class=p>:</span> <span class=n>str</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>The name of the vector store.</p> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h5 id=nearai.shared.models.ExpiresAfter class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">ExpiresAfter</span> <a href=#nearai.shared.models.ExpiresAfter class=headerlink title="Permanent link">&para;</a></h5> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=typing_extensions.TypedDict>TypedDict</span></code></p> <details class=quote> <summary>Source code in <code>nearai/shared/models.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-63>63</a></span>
<span class=normal><a href=#__codelineno-0-64>64</a></span>
<span class=normal><a href=#__codelineno-0-65>65</a></span>
<span class=normal><a href=#__codelineno-0-66>66</a></span>
<span class=normal><a href=#__codelineno-0-67>67</a></span>
<span class=normal><a href=#__codelineno-0-68>68</a></span>
<span class=normal><a href=#__codelineno-0-69>69</a></span>
<span class=normal><a href=#__codelineno-0-70>70</a></span>
<span class=normal><a href=#__codelineno-0-71>71</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-63><a id=__codelineno-0-63 name=__codelineno-0-63></a><span class=k>class</span><span class=w> </span><span class=nc>ExpiresAfter</span><span class=p>(</span><span class=n>TypedDict</span><span class=p>,</span> <span class=n>total</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
</span><span id=__span-0-64><a id=__codelineno-0-64 name=__codelineno-0-64></a>    <span class=n>anchor</span><span class=p>:</span> <span class=n>Required</span><span class=p>[</span><span class=n>Literal</span><span class=p>[</span><span class=s2>&quot;last_active_at&quot;</span><span class=p>]]</span>
</span><span id=__span-0-65><a id=__codelineno-0-65 name=__codelineno-0-65></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Anchor timestamp after which the expiration policy applies.</span>
</span><span id=__span-0-66><a id=__codelineno-0-66 name=__codelineno-0-66></a>
</span><span id=__span-0-67><a id=__codelineno-0-67 name=__codelineno-0-67></a><span class=sd>    Supported anchors: `last_active_at`.</span>
</span><span id=__span-0-68><a id=__codelineno-0-68 name=__codelineno-0-68></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-69><a id=__codelineno-0-69 name=__codelineno-0-69></a>
</span><span id=__span-0-70><a id=__codelineno-0-70 name=__codelineno-0-70></a>    <span class=n>days</span><span class=p>:</span> <span class=n>Required</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span>
</span><span id=__span-0-71><a id=__codelineno-0-71 name=__codelineno-0-71></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;The number of days after the anchor time that the vector store will expire.&quot;&quot;&quot;</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-attribute"> <h6 id=nearai.shared.models.ExpiresAfter.anchor class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">anchor</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small> </span> <a href=#nearai.shared.models.ExpiresAfter.anchor class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=n>anchor</span><span class=p>:</span> <span class=n><span title=typing_extensions.Required>Required</span></span><span class=p>[</span><span class=n><span title=typing.Literal>Literal</span></span><span class=p>[</span><span class=s1>&#39;last_active_at&#39;</span><span class=p>]]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Anchor timestamp after which the expiration policy applies.</p> <p>Supported anchors: <code>last_active_at</code>.</p> </div> </div> <div class="doc doc-object doc-attribute"> <h6 id=nearai.shared.models.ExpiresAfter.days class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">days</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small> </span> <a href=#nearai.shared.models.ExpiresAfter.days class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=n>days</span><span class=p>:</span> <span class=n><span title=typing_extensions.Required>Required</span></span><span class=p>[</span><span class=n>int</span><span class=p>]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>The number of days after the anchor time that the vector store will expire.</p> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h5 id=nearai.shared.models.StaticFileChunkingStrategyParam class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">StaticFileChunkingStrategyParam</span> <a href=#nearai.shared.models.StaticFileChunkingStrategyParam class=headerlink title="Permanent link">&para;</a></h5> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=typing_extensions.TypedDict>TypedDict</span></code></p> <details class=quote> <summary>Source code in <code>nearai/shared/models.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-32>32</a></span>
<span class=normal><a href=#__codelineno-0-33>33</a></span>
<span class=normal><a href=#__codelineno-0-34>34</a></span>
<span class=normal><a href=#__codelineno-0-35>35</a></span>
<span class=normal><a href=#__codelineno-0-36>36</a></span>
<span class=normal><a href=#__codelineno-0-37>37</a></span>
<span class=normal><a href=#__codelineno-0-38>38</a></span>
<span class=normal><a href=#__codelineno-0-39>39</a></span>
<span class=normal><a href=#__codelineno-0-40>40</a></span>
<span class=normal><a href=#__codelineno-0-41>41</a></span>
<span class=normal><a href=#__codelineno-0-42>42</a></span>
<span class=normal><a href=#__codelineno-0-43>43</a></span>
<span class=normal><a href=#__codelineno-0-44>44</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-32><a id=__codelineno-0-32 name=__codelineno-0-32></a><span class=k>class</span><span class=w> </span><span class=nc>StaticFileChunkingStrategyParam</span><span class=p>(</span><span class=n>TypedDict</span><span class=p>,</span> <span class=n>total</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
</span><span id=__span-0-33><a id=__codelineno-0-33 name=__codelineno-0-33></a>    <span class=n>chunk_overlap_tokens</span><span class=p>:</span> <span class=n>Required</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span>
</span><span id=__span-0-34><a id=__codelineno-0-34 name=__codelineno-0-34></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;The number of tokens that overlap between chunks. The default value is `400`.</span>
</span><span id=__span-0-35><a id=__codelineno-0-35 name=__codelineno-0-35></a>
</span><span id=__span-0-36><a id=__codelineno-0-36 name=__codelineno-0-36></a><span class=sd>    Note that the overlap must not exceed half of `max_chunk_size_tokens`.</span>
</span><span id=__span-0-37><a id=__codelineno-0-37 name=__codelineno-0-37></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-38><a id=__codelineno-0-38 name=__codelineno-0-38></a>
</span><span id=__span-0-39><a id=__codelineno-0-39 name=__codelineno-0-39></a>    <span class=n>max_chunk_size_tokens</span><span class=p>:</span> <span class=n>Required</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span>
</span><span id=__span-0-40><a id=__codelineno-0-40 name=__codelineno-0-40></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;The maximum number of tokens in each chunk.</span>
</span><span id=__span-0-41><a id=__codelineno-0-41 name=__codelineno-0-41></a>
</span><span id=__span-0-42><a id=__codelineno-0-42 name=__codelineno-0-42></a><span class=sd>    The default value is `800`. The minimum value is `100` and the maximum value is</span>
</span><span id=__span-0-43><a id=__codelineno-0-43 name=__codelineno-0-43></a><span class=sd>    `4096`.</span>
</span><span id=__span-0-44><a id=__codelineno-0-44 name=__codelineno-0-44></a><span class=sd>    &quot;&quot;&quot;</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-attribute"> <h6 id=nearai.shared.models.StaticFileChunkingStrategyParam.chunk_overlap_tokens class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">chunk_overlap_tokens</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small> </span> <a href=#nearai.shared.models.StaticFileChunkingStrategyParam.chunk_overlap_tokens class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=n>chunk_overlap_tokens</span><span class=p>:</span> <span class=n><span title=typing_extensions.Required>Required</span></span><span class=p>[</span><span class=n>int</span><span class=p>]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>The number of tokens that overlap between chunks. The default value is <code>400</code>.</p> <p>Note that the overlap must not exceed half of <code>max_chunk_size_tokens</code>.</p> </div> </div> <div class="doc doc-object doc-attribute"> <h6 id=nearai.shared.models.StaticFileChunkingStrategyParam.max_chunk_size_tokens class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">max_chunk_size_tokens</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small> </span> <a href=#nearai.shared.models.StaticFileChunkingStrategyParam.max_chunk_size_tokens class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=n>max_chunk_size_tokens</span><span class=p>:</span> <span class=n><span title=typing_extensions.Required>Required</span></span><span class=p>[</span><span class=n>int</span><span class=p>]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>The maximum number of tokens in each chunk.</p> <p>The default value is <code>800</code>. The minimum value is <code>100</code> and the maximum value is <code>4096</code>.</p> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h5 id=nearai.shared.models.VectorStoreFileCreate class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">VectorStoreFileCreate</span> <a href=#nearai.shared.models.VectorStoreFileCreate class=headerlink title="Permanent link">&para;</a></h5> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=pydantic.BaseModel>BaseModel</span></code></p> <p>Request model for creating a vector store file.</p> <details class=quote> <summary>Source code in <code>nearai/shared/models.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-125>125</a></span>
<span class=normal><a href=#__codelineno-0-126>126</a></span>
<span class=normal><a href=#__codelineno-0-127>127</a></span>
<span class=normal><a href=#__codelineno-0-128>128</a></span>
<span class=normal><a href=#__codelineno-0-129>129</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-125><a id=__codelineno-0-125 name=__codelineno-0-125></a><span class=k>class</span><span class=w> </span><span class=nc>VectorStoreFileCreate</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span><span id=__span-0-126><a id=__codelineno-0-126 name=__codelineno-0-126></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Request model for creating a vector store file.&quot;&quot;&quot;</span>
</span><span id=__span-0-127><a id=__codelineno-0-127 name=__codelineno-0-127></a>
</span><span id=__span-0-128><a id=__codelineno-0-128 name=__codelineno-0-128></a>    <span class=n>file_id</span><span class=p>:</span> <span class=nb>str</span>
</span><span id=__span-0-129><a id=__codelineno-0-129 name=__codelineno-0-129></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;File ID returned from upload file endpoint.&quot;&quot;&quot;</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-attribute"> <h6 id=nearai.shared.models.VectorStoreFileCreate.file_id class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">file_id</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small> </span> <a href=#nearai.shared.models.VectorStoreFileCreate.file_id class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=n>file_id</span><span class=p>:</span> <span class=n>str</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>File ID returned from upload file endpoint.</p> </div> </div> </div> </div> </div> </div> </div> </div> <div class="doc doc-object doc-module"> <h4 id=nearai.shared.naming class="doc doc-heading"> <span class="doc doc-object-name doc-module-name">naming</span> <a href=#nearai.shared.naming class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h5 id=nearai.shared.naming.NamespacedName class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">NamespacedName</span> <a href=#nearai.shared.naming.NamespacedName class=headerlink title="Permanent link">&para;</a></h5> <div class="doc doc-contents "> <details class=quote> <summary>Source code in <code>nearai/shared/naming.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-63>63</a></span>
<span class=normal><a href=#__codelineno-0-64>64</a></span>
<span class=normal><a href=#__codelineno-0-65>65</a></span>
<span class=normal><a href=#__codelineno-0-66>66</a></span>
<span class=normal><a href=#__codelineno-0-67>67</a></span>
<span class=normal><a href=#__codelineno-0-68>68</a></span>
<span class=normal><a href=#__codelineno-0-69>69</a></span>
<span class=normal><a href=#__codelineno-0-70>70</a></span>
<span class=normal><a href=#__codelineno-0-71>71</a></span>
<span class=normal><a href=#__codelineno-0-72>72</a></span>
<span class=normal><a href=#__codelineno-0-73>73</a></span>
<span class=normal><a href=#__codelineno-0-74>74</a></span>
<span class=normal><a href=#__codelineno-0-75>75</a></span>
<span class=normal><a href=#__codelineno-0-76>76</a></span>
<span class=normal><a href=#__codelineno-0-77>77</a></span>
<span class=normal><a href=#__codelineno-0-78>78</a></span>
<span class=normal><a href=#__codelineno-0-79>79</a></span>
<span class=normal><a href=#__codelineno-0-80>80</a></span>
<span class=normal><a href=#__codelineno-0-81>81</a></span>
<span class=normal><a href=#__codelineno-0-82>82</a></span>
<span class=normal><a href=#__codelineno-0-83>83</a></span>
<span class=normal><a href=#__codelineno-0-84>84</a></span>
<span class=normal><a href=#__codelineno-0-85>85</a></span>
<span class=normal><a href=#__codelineno-0-86>86</a></span>
<span class=normal><a href=#__codelineno-0-87>87</a></span>
<span class=normal><a href=#__codelineno-0-88>88</a></span>
<span class=normal><a href=#__codelineno-0-89>89</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-63><a id=__codelineno-0-63 name=__codelineno-0-63></a><span class=k>class</span><span class=w> </span><span class=nc>NamespacedName</span><span class=p>:</span>
</span><span id=__span-0-64><a id=__codelineno-0-64 name=__codelineno-0-64></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>namespace</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>):</span>  <span class=c1># noqa: D107</span>
</span><span id=__span-0-65><a id=__codelineno-0-65 name=__codelineno-0-65></a>        <span class=bp>self</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=n>name</span>
</span><span id=__span-0-66><a id=__codelineno-0-66 name=__codelineno-0-66></a>        <span class=bp>self</span><span class=o>.</span><span class=n>namespace</span> <span class=o>=</span> <span class=n>namespace</span>
</span><span id=__span-0-67><a id=__codelineno-0-67 name=__codelineno-0-67></a>
</span><span id=__span-0-68><a id=__codelineno-0-68 name=__codelineno-0-68></a>    <span class=k>def</span><span class=w> </span><span class=fm>__eq__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>other</span><span class=p>):</span>  <span class=c1># noqa: D105</span>
</span><span id=__span-0-69><a id=__codelineno-0-69 name=__codelineno-0-69></a>        <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>other</span><span class=p>,</span> <span class=n>NamespacedName</span><span class=p>):</span>
</span><span id=__span-0-70><a id=__codelineno-0-70 name=__codelineno-0-70></a>            <span class=k>return</span> <span class=bp>NotImplemented</span>
</span><span id=__span-0-71><a id=__codelineno-0-71 name=__codelineno-0-71></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>name</span> <span class=o>==</span> <span class=n>other</span><span class=o>.</span><span class=n>name</span> <span class=ow>and</span> <span class=bp>self</span><span class=o>.</span><span class=n>namespace</span> <span class=o>==</span> <span class=n>other</span><span class=o>.</span><span class=n>namespace</span>
</span><span id=__span-0-72><a id=__codelineno-0-72 name=__codelineno-0-72></a>
</span><span id=__span-0-73><a id=__codelineno-0-73 name=__codelineno-0-73></a>    <span class=k>def</span><span class=w> </span><span class=fm>__hash__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>  <span class=c1># noqa: D105</span>
</span><span id=__span-0-74><a id=__codelineno-0-74 name=__codelineno-0-74></a>        <span class=k>return</span> <span class=nb>hash</span><span class=p>((</span><span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>namespace</span><span class=p>))</span>
</span><span id=__span-0-75><a id=__codelineno-0-75 name=__codelineno-0-75></a>
</span><span id=__span-0-76><a id=__codelineno-0-76 name=__codelineno-0-76></a>    <span class=k>def</span><span class=w> </span><span class=fm>__str__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>  <span class=c1># noqa: D105</span>
</span><span id=__span-0-77><a id=__codelineno-0-77 name=__codelineno-0-77></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>namespace</span><span class=p>:</span>
</span><span id=__span-0-78><a id=__codelineno-0-78 name=__codelineno-0-78></a>            <span class=k>return</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>namespace</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-79><a id=__codelineno-0-79 name=__codelineno-0-79></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>name</span>
</span><span id=__span-0-80><a id=__codelineno-0-80 name=__codelineno-0-80></a>
</span><span id=__span-0-81><a id=__codelineno-0-81 name=__codelineno-0-81></a>    <span class=k>def</span><span class=w> </span><span class=fm>__repr__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>  <span class=c1># noqa: D105</span>
</span><span id=__span-0-82><a id=__codelineno-0-82 name=__codelineno-0-82></a>        <span class=k>return</span> <span class=sa>f</span><span class=s2>&quot;NamespacedName(name=&#39;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2>&#39;, namespace=&#39;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>namespace</span><span class=si>}</span><span class=s2>&#39;)&quot;</span>
</span><span id=__span-0-83><a id=__codelineno-0-83 name=__codelineno-0-83></a>
</span><span id=__span-0-84><a id=__codelineno-0-84 name=__codelineno-0-84></a>    <span class=k>def</span><span class=w> </span><span class=nf>canonical</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=s2>&quot;NamespacedName&quot;</span><span class=p>:</span>  <span class=c1># noqa: D105</span>
</span><span id=__span-0-85><a id=__codelineno-0-85 name=__codelineno-0-85></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns canonical NamespacedName.&quot;&quot;&quot;</span>
</span><span id=__span-0-86><a id=__codelineno-0-86 name=__codelineno-0-86></a>        <span class=k>return</span> <span class=n>NamespacedName</span><span class=p>(</span>
</span><span id=__span-0-87><a id=__codelineno-0-87 name=__codelineno-0-87></a>            <span class=n>name</span><span class=o>=</span><span class=n>get_canonical_name</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=p>),</span>
</span><span id=__span-0-88><a id=__codelineno-0-88 name=__codelineno-0-88></a>            <span class=n>namespace</span><span class=o>=</span><span class=n>get_canonical_name</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>namespace</span><span class=p>)</span> <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>namespace</span> <span class=o>!=</span> <span class=n>DEFAULT_NAMESPACE</span> <span class=k>else</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-89><a id=__codelineno-0-89 name=__codelineno-0-89></a>        <span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.naming.NamespacedName.canonical class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">canonical</span> <a href=#nearai.shared.naming.NamespacedName.canonical class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>canonical</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n><a class="autorefs autorefs-internal" title=nearai.shared.naming.NamespacedName href=#nearai.shared.naming.NamespacedName>NamespacedName</a></span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Returns canonical NamespacedName.</p> <details class=quote> <summary>Source code in <code>nearai/shared/naming.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-84>84</a></span>
<span class=normal><a href=#__codelineno-0-85>85</a></span>
<span class=normal><a href=#__codelineno-0-86>86</a></span>
<span class=normal><a href=#__codelineno-0-87>87</a></span>
<span class=normal><a href=#__codelineno-0-88>88</a></span>
<span class=normal><a href=#__codelineno-0-89>89</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-84><a id=__codelineno-0-84 name=__codelineno-0-84></a><span class=k>def</span><span class=w> </span><span class=nf>canonical</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=s2>&quot;NamespacedName&quot;</span><span class=p>:</span>  <span class=c1># noqa: D105</span>
</span><span id=__span-0-85><a id=__codelineno-0-85 name=__codelineno-0-85></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns canonical NamespacedName.&quot;&quot;&quot;</span>
</span><span id=__span-0-86><a id=__codelineno-0-86 name=__codelineno-0-86></a>    <span class=k>return</span> <span class=n>NamespacedName</span><span class=p>(</span>
</span><span id=__span-0-87><a id=__codelineno-0-87 name=__codelineno-0-87></a>        <span class=n>name</span><span class=o>=</span><span class=n>get_canonical_name</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=p>),</span>
</span><span id=__span-0-88><a id=__codelineno-0-88 name=__codelineno-0-88></a>        <span class=n>namespace</span><span class=o>=</span><span class=n>get_canonical_name</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>namespace</span><span class=p>)</span> <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>namespace</span> <span class=o>!=</span> <span class=n>DEFAULT_NAMESPACE</span> <span class=k>else</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-89><a id=__codelineno-0-89 name=__codelineno-0-89></a>    <span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.shared.naming.create_registry_name class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">create_registry_name</span> <a href=#nearai.shared.naming.create_registry_name class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>create_registry_name</span><span class=p>(</span><span class=n>name</span><span class=p>:</span> <span class=n>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>str</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Formats <code>name</code> for a suitable registry name.</p> <details class=quote> <summary>Source code in <code>nearai/shared/naming.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-40>40</a></span>
<span class=normal><a href=#__codelineno-0-41>41</a></span>
<span class=normal><a href=#__codelineno-0-42>42</a></span>
<span class=normal><a href=#__codelineno-0-43>43</a></span>
<span class=normal><a href=#__codelineno-0-44>44</a></span>
<span class=normal><a href=#__codelineno-0-45>45</a></span>
<span class=normal><a href=#__codelineno-0-46>46</a></span>
<span class=normal><a href=#__codelineno-0-47>47</a></span>
<span class=normal><a href=#__codelineno-0-48>48</a></span>
<span class=normal><a href=#__codelineno-0-49>49</a></span>
<span class=normal><a href=#__codelineno-0-50>50</a></span>
<span class=normal><a href=#__codelineno-0-51>51</a></span>
<span class=normal><a href=#__codelineno-0-52>52</a></span>
<span class=normal><a href=#__codelineno-0-53>53</a></span>
<span class=normal><a href=#__codelineno-0-54>54</a></span>
<span class=normal><a href=#__codelineno-0-55>55</a></span>
<span class=normal><a href=#__codelineno-0-56>56</a></span>
<span class=normal><a href=#__codelineno-0-57>57</a></span>
<span class=normal><a href=#__codelineno-0-58>58</a></span>
<span class=normal><a href=#__codelineno-0-59>59</a></span>
<span class=normal><a href=#__codelineno-0-60>60</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-40><a id=__codelineno-0-40 name=__codelineno-0-40></a><span class=k>def</span><span class=w> </span><span class=nf>create_registry_name</span><span class=p>(</span><span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-0-41><a id=__codelineno-0-41 name=__codelineno-0-41></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Formats `name` for a suitable registry name.&quot;&quot;&quot;</span>
</span><span id=__span-0-42><a id=__codelineno-0-42 name=__codelineno-0-42></a>    <span class=c1># Convert to lowercase</span>
</span><span id=__span-0-43><a id=__codelineno-0-43 name=__codelineno-0-43></a>    <span class=n>name</span> <span class=o>=</span> <span class=n>name</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
</span><span id=__span-0-44><a id=__codelineno-0-44 name=__codelineno-0-44></a>    <span class=c1># Convert &#39;.&#39; between digits to &#39;p&#39;</span>
</span><span id=__span-0-45><a id=__codelineno-0-45 name=__codelineno-0-45></a>    <span class=n>name</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=sa>r</span><span class=s2>&quot;(\d)\.(\d)&quot;</span><span class=p>,</span> <span class=sa>r</span><span class=s2>&quot;\1p\2&quot;</span><span class=p>,</span> <span class=n>name</span><span class=p>)</span>
</span><span id=__span-0-46><a id=__codelineno-0-46 name=__codelineno-0-46></a>    <span class=c1># Convert &#39;&lt;digit&gt;v&lt;digit&gt;&#39; -&gt; &#39;&lt;digit&gt;-&lt;digit&gt;&#39;</span>
</span><span id=__span-0-47><a id=__codelineno-0-47 name=__codelineno-0-47></a>    <span class=n>name</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=sa>r</span><span class=s2>&quot;(\d)v(\d)&quot;</span><span class=p>,</span> <span class=sa>r</span><span class=s2>&quot;\1-\2&quot;</span><span class=p>,</span> <span class=n>name</span><span class=p>)</span>
</span><span id=__span-0-48><a id=__codelineno-0-48 name=__codelineno-0-48></a>    <span class=c1># Convert &#39;&lt;not letter&gt;v&lt;digit&gt;&#39; -&gt; &#39;&lt;not letter&gt;&lt;digit&gt;&#39;</span>
</span><span id=__span-0-49><a id=__codelineno-0-49 name=__codelineno-0-49></a>    <span class=n>name</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=sa>r</span><span class=s2>&quot;(^|[^a-z])v(\d)&quot;</span><span class=p>,</span> <span class=sa>r</span><span class=s2>&quot;\1\2&quot;</span><span class=p>,</span> <span class=n>name</span><span class=p>)</span>
</span><span id=__span-0-50><a id=__codelineno-0-50 name=__codelineno-0-50></a>    <span class=c1># Replace non-alphanumeric characters between digits with &#39;-&#39;</span>
</span><span id=__span-0-51><a id=__codelineno-0-51 name=__codelineno-0-51></a>    <span class=n>name</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=sa>r</span><span class=s2>&quot;(\d)[^a-z0-9]+(\d)&quot;</span><span class=p>,</span> <span class=sa>r</span><span class=s2>&quot;\1-\2&quot;</span><span class=p>,</span> <span class=n>name</span><span class=p>)</span>
</span><span id=__span-0-52><a id=__codelineno-0-52 name=__codelineno-0-52></a>    <span class=c1># Remove remaining non-alphanumeric characters, except &#39;-&#39;</span>
</span><span id=__span-0-53><a id=__codelineno-0-53 name=__codelineno-0-53></a>    <span class=n>name</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=sa>r</span><span class=s2>&quot;[^a-z0-9-]&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>name</span><span class=p>)</span>
</span><span id=__span-0-54><a id=__codelineno-0-54 name=__codelineno-0-54></a>    <span class=c1># Convert &#39;metallama&#39; or &#39;meta-llama&#39; to &#39;llama&#39;</span>
</span><span id=__span-0-55><a id=__codelineno-0-55 name=__codelineno-0-55></a>    <span class=n>name</span> <span class=o>=</span> <span class=n>name</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;metallama&quot;</span><span class=p>,</span> <span class=s2>&quot;llama&quot;</span><span class=p>)</span>
</span><span id=__span-0-56><a id=__codelineno-0-56 name=__codelineno-0-56></a>    <span class=n>name</span> <span class=o>=</span> <span class=n>name</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;meta-llama&quot;</span><span class=p>,</span> <span class=s2>&quot;llama&quot;</span><span class=p>)</span>
</span><span id=__span-0-57><a id=__codelineno-0-57 name=__codelineno-0-57></a>    <span class=c1># Convert &#39;qwenq&#39; or &#39;qwen-q&#39; to &#39;q&#39;</span>
</span><span id=__span-0-58><a id=__codelineno-0-58 name=__codelineno-0-58></a>    <span class=n>name</span> <span class=o>=</span> <span class=n>name</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;qwenq&quot;</span><span class=p>,</span> <span class=s2>&quot;q&quot;</span><span class=p>)</span>
</span><span id=__span-0-59><a id=__codelineno-0-59 name=__codelineno-0-59></a>    <span class=n>name</span> <span class=o>=</span> <span class=n>name</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;qwen-q&quot;</span><span class=p>,</span> <span class=s2>&quot;q&quot;</span><span class=p>)</span>
</span><span id=__span-0-60><a id=__codelineno-0-60 name=__codelineno-0-60></a>    <span class=k>return</span> <span class=n>name</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.shared.naming.get_canonical_name class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_canonical_name</span> <a href=#nearai.shared.naming.get_canonical_name class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>get_canonical_name</span><span class=p>(</span><span class=n>name</span><span class=p>:</span> <span class=n>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>str</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Returns a name that can be used for matching entities.</p> <p>Applies such transformations: 1. All letters lowercase. 2. Convert '.' between digits to 'p'. 3. Convert '<not letter>v<digit>' -&gt; '<not letter><digit>' 4. Remove all non-alphanumeric characters except between digits. Use '_' between digits. 5. Convert 'metallama' -&gt; 'llama'.</p> <p>e.g. "llama-3.1-70b-instruct" -&gt; "llama3p1_70binstruct"</p> <details class=quote> <summary>Source code in <code>nearai/shared/naming.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-6> 6</a></span>
<span class=normal><a href=#__codelineno-0-7> 7</a></span>
<span class=normal><a href=#__codelineno-0-8> 8</a></span>
<span class=normal><a href=#__codelineno-0-9> 9</a></span>
<span class=normal><a href=#__codelineno-0-10>10</a></span>
<span class=normal><a href=#__codelineno-0-11>11</a></span>
<span class=normal><a href=#__codelineno-0-12>12</a></span>
<span class=normal><a href=#__codelineno-0-13>13</a></span>
<span class=normal><a href=#__codelineno-0-14>14</a></span>
<span class=normal><a href=#__codelineno-0-15>15</a></span>
<span class=normal><a href=#__codelineno-0-16>16</a></span>
<span class=normal><a href=#__codelineno-0-17>17</a></span>
<span class=normal><a href=#__codelineno-0-18>18</a></span>
<span class=normal><a href=#__codelineno-0-19>19</a></span>
<span class=normal><a href=#__codelineno-0-20>20</a></span>
<span class=normal><a href=#__codelineno-0-21>21</a></span>
<span class=normal><a href=#__codelineno-0-22>22</a></span>
<span class=normal><a href=#__codelineno-0-23>23</a></span>
<span class=normal><a href=#__codelineno-0-24>24</a></span>
<span class=normal><a href=#__codelineno-0-25>25</a></span>
<span class=normal><a href=#__codelineno-0-26>26</a></span>
<span class=normal><a href=#__codelineno-0-27>27</a></span>
<span class=normal><a href=#__codelineno-0-28>28</a></span>
<span class=normal><a href=#__codelineno-0-29>29</a></span>
<span class=normal><a href=#__codelineno-0-30>30</a></span>
<span class=normal><a href=#__codelineno-0-31>31</a></span>
<span class=normal><a href=#__codelineno-0-32>32</a></span>
<span class=normal><a href=#__codelineno-0-33>33</a></span>
<span class=normal><a href=#__codelineno-0-34>34</a></span>
<span class=normal><a href=#__codelineno-0-35>35</a></span>
<span class=normal><a href=#__codelineno-0-36>36</a></span>
<span class=normal><a href=#__codelineno-0-37>37</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6></a><span class=k>def</span><span class=w> </span><span class=nf>get_canonical_name</span><span class=p>(</span><span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns a name that can be used for matching entities.</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8></a>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9></a><span class=sd>    Applies such transformations:</span>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10></a><span class=sd>    1. All letters lowercase.</span>
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11></a><span class=sd>    2. Convert &#39;.&#39; between digits to &#39;p&#39;.</span>
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12></a><span class=sd>    3. Convert &#39;&lt;not letter&gt;v&lt;digit&gt;&#39; -&gt; &#39;&lt;not letter&gt;&lt;digit&gt;&#39;</span>
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13></a><span class=sd>    4. Remove all non-alphanumeric characters except between digits.</span>
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14></a><span class=sd>        Use &#39;_&#39; between digits.</span>
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15></a><span class=sd>    5. Convert &#39;metallama&#39; -&gt; &#39;llama&#39;.</span>
</span><span id=__span-0-16><a id=__codelineno-0-16 name=__codelineno-0-16></a>
</span><span id=__span-0-17><a id=__codelineno-0-17 name=__codelineno-0-17></a><span class=sd>    e.g. &quot;llama-3.1-70b-instruct&quot; -&gt; &quot;llama3p1_70binstruct&quot;</span>
</span><span id=__span-0-18><a id=__codelineno-0-18 name=__codelineno-0-18></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19></a>    <span class=c1># Convert to lowercase</span>
</span><span id=__span-0-20><a id=__codelineno-0-20 name=__codelineno-0-20></a>    <span class=n>name</span> <span class=o>=</span> <span class=n>name</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
</span><span id=__span-0-21><a id=__codelineno-0-21 name=__codelineno-0-21></a>    <span class=c1># Convert &#39;.&#39; between digits to &#39;p&#39;</span>
</span><span id=__span-0-22><a id=__codelineno-0-22 name=__codelineno-0-22></a>    <span class=n>name</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=sa>r</span><span class=s2>&quot;(\d)\.(\d)&quot;</span><span class=p>,</span> <span class=sa>r</span><span class=s2>&quot;\1p\2&quot;</span><span class=p>,</span> <span class=n>name</span><span class=p>)</span>
</span><span id=__span-0-23><a id=__codelineno-0-23 name=__codelineno-0-23></a>    <span class=c1># Convert &#39;&lt;digit&gt;v&lt;digit&gt;&#39; -&gt; &#39;&lt;digit&gt;_&lt;digit&gt;&#39;</span>
</span><span id=__span-0-24><a id=__codelineno-0-24 name=__codelineno-0-24></a>    <span class=n>name</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=sa>r</span><span class=s2>&quot;(\d)v(\d)&quot;</span><span class=p>,</span> <span class=sa>r</span><span class=s2>&quot;\1_\2&quot;</span><span class=p>,</span> <span class=n>name</span><span class=p>)</span>
</span><span id=__span-0-25><a id=__codelineno-0-25 name=__codelineno-0-25></a>    <span class=c1># Convert &#39;&lt;not letter&gt;v&lt;digit&gt;&#39; -&gt; &#39;&lt;not letter&gt;&lt;digit&gt;&#39;</span>
</span><span id=__span-0-26><a id=__codelineno-0-26 name=__codelineno-0-26></a>    <span class=n>name</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=sa>r</span><span class=s2>&quot;(^|[^a-z])v(\d)&quot;</span><span class=p>,</span> <span class=sa>r</span><span class=s2>&quot;\1\2&quot;</span><span class=p>,</span> <span class=n>name</span><span class=p>)</span>
</span><span id=__span-0-27><a id=__codelineno-0-27 name=__codelineno-0-27></a>    <span class=c1># Replace non-alphanumeric characters between digits with &#39;_&#39;</span>
</span><span id=__span-0-28><a id=__codelineno-0-28 name=__codelineno-0-28></a>    <span class=n>name</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=sa>r</span><span class=s2>&quot;(\d)[^a-z0-9]+(\d)&quot;</span><span class=p>,</span> <span class=sa>r</span><span class=s2>&quot;\1_\2&quot;</span><span class=p>,</span> <span class=n>name</span><span class=p>)</span>
</span><span id=__span-0-29><a id=__codelineno-0-29 name=__codelineno-0-29></a>    <span class=c1># Remove remaining non-alphanumeric characters, except &#39;_&#39;</span>
</span><span id=__span-0-30><a id=__codelineno-0-30 name=__codelineno-0-30></a>    <span class=n>name</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=sa>r</span><span class=s2>&quot;[^a-z0-9_]&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>name</span><span class=p>)</span>
</span><span id=__span-0-31><a id=__codelineno-0-31 name=__codelineno-0-31></a>    <span class=c1># Remove any remaining underscores that are not between digits</span>
</span><span id=__span-0-32><a id=__codelineno-0-32 name=__codelineno-0-32></a>    <span class=n>name</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=sa>r</span><span class=s2>&quot;(?&lt;!\d)_|_(?!\d)&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>name</span><span class=p>)</span>
</span><span id=__span-0-33><a id=__codelineno-0-33 name=__codelineno-0-33></a>    <span class=c1># Convert &#39;metallama&#39; to &#39;llama&#39;</span>
</span><span id=__span-0-34><a id=__codelineno-0-34 name=__codelineno-0-34></a>    <span class=n>name</span> <span class=o>=</span> <span class=n>name</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;metallama&quot;</span><span class=p>,</span> <span class=s2>&quot;llama&quot;</span><span class=p>)</span>
</span><span id=__span-0-35><a id=__codelineno-0-35 name=__codelineno-0-35></a>    <span class=c1># Convert &#39;qwenq&#39; to &#39;q&#39;</span>
</span><span id=__span-0-36><a id=__codelineno-0-36 name=__codelineno-0-36></a>    <span class=n>name</span> <span class=o>=</span> <span class=n>name</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;qwenq&quot;</span><span class=p>,</span> <span class=s2>&quot;q&quot;</span><span class=p>)</span>
</span><span id=__span-0-37><a id=__codelineno-0-37 name=__codelineno-0-37></a>    <span class=k>return</span> <span class=n>name</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-module"> <h4 id=nearai.shared.near class="doc doc-heading"> <span class="doc doc-object-name doc-module-name">near</span> <a href=#nearai.shared.near class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <div class="doc doc-children"> <div class="doc doc-object doc-module"> <h5 id=nearai.shared.near.sign class="doc doc-heading"> <span class="doc doc-object-name doc-module-name">sign</span> <a href=#nearai.shared.near.sign class=headerlink title="Permanent link">&para;</a></h5> <div class="doc doc-contents "> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h6 id=nearai.shared.near.sign.SignatureVerificationResult class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">SignatureVerificationResult</span> <a href=#nearai.shared.near.sign.SignatureVerificationResult class=headerlink title="Permanent link">&para;</a></h6> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=enum.Enum>Enum</span></code></p> <details class=quote> <summary>Source code in <code>nearai/shared/near/sign.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-93> 93</a></span>
<span class=normal><a href=#__codelineno-0-94> 94</a></span>
<span class=normal><a href=#__codelineno-0-95> 95</a></span>
<span class=normal><a href=#__codelineno-0-96> 96</a></span>
<span class=normal><a href=#__codelineno-0-97> 97</a></span>
<span class=normal><a href=#__codelineno-0-98> 98</a></span>
<span class=normal><a href=#__codelineno-0-99> 99</a></span>
<span class=normal><a href=#__codelineno-0-100>100</a></span>
<span class=normal><a href=#__codelineno-0-101>101</a></span>
<span class=normal><a href=#__codelineno-0-102>102</a></span>
<span class=normal><a href=#__codelineno-0-103>103</a></span>
<span class=normal><a href=#__codelineno-0-104>104</a></span>
<span class=normal><a href=#__codelineno-0-105>105</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-93><a id=__codelineno-0-93 name=__codelineno-0-93></a><span class=k>class</span><span class=w> </span><span class=nc>SignatureVerificationResult</span><span class=p>(</span><span class=n>Enum</span><span class=p>):</span>
</span><span id=__span-0-94><a id=__codelineno-0-94 name=__codelineno-0-94></a>    <span class=n>TRUE</span> <span class=o>=</span> <span class=kc>True</span>
</span><span id=__span-0-95><a id=__codelineno-0-95 name=__codelineno-0-95></a>    <span class=n>FALSE</span> <span class=o>=</span> <span class=kc>False</span>
</span><span id=__span-0-96><a id=__codelineno-0-96 name=__codelineno-0-96></a>    <span class=n>VERIFY_ACCESS_KEY_OWNER_SERVICE_NOT_AVAILABLE</span> <span class=o>=</span> <span class=s2>&quot;verify_access_key_owner_not_available&quot;</span>
</span><span id=__span-0-97><a id=__codelineno-0-97 name=__codelineno-0-97></a>
</span><span id=__span-0-98><a id=__codelineno-0-98 name=__codelineno-0-98></a>    <span class=nd>@classmethod</span>
</span><span id=__span-0-99><a id=__codelineno-0-99 name=__codelineno-0-99></a>    <span class=k>def</span><span class=w> </span><span class=nf>from_bool</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>value</span><span class=p>:</span> <span class=nb>bool</span><span class=p>):</span>
</span><span id=__span-0-100><a id=__codelineno-0-100 name=__codelineno-0-100></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Gets VerificationResult based on a boolean value.&quot;&quot;&quot;</span>
</span><span id=__span-0-101><a id=__codelineno-0-101 name=__codelineno-0-101></a>        <span class=k>return</span> <span class=bp>cls</span><span class=o>.</span><span class=n>TRUE</span> <span class=k>if</span> <span class=n>value</span> <span class=k>else</span> <span class=bp>cls</span><span class=o>.</span><span class=n>FALSE</span>
</span><span id=__span-0-102><a id=__codelineno-0-102 name=__codelineno-0-102></a>
</span><span id=__span-0-103><a id=__codelineno-0-103 name=__codelineno-0-103></a>    <span class=k>def</span><span class=w> </span><span class=fm>__bool__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-0-104><a id=__codelineno-0-104 name=__codelineno-0-104></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Overrides the behavior when checking for truthiness.&quot;&quot;&quot;</span>
</span><span id=__span-0-105><a id=__codelineno-0-105 name=__codelineno-0-105></a>        <span class=k>return</span> <span class=bp>self</span> <span class=o>==</span> <span class=n>SignatureVerificationResult</span><span class=o>.</span><span class=n>TRUE</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h7 id=nearai.shared.near.sign.SignatureVerificationResult.__bool__ class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">__bool__</span> <a href=#nearai.shared.near.sign.SignatureVerificationResult.__bool__ class=headerlink title="Permanent link">&para;</a></h7> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=fm>__bool__</span><span class=p>()</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Overrides the behavior when checking for truthiness.</p> <details class=quote> <summary>Source code in <code>nearai/shared/near/sign.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-103>103</a></span>
<span class=normal><a href=#__codelineno-0-104>104</a></span>
<span class=normal><a href=#__codelineno-0-105>105</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-103><a id=__codelineno-0-103 name=__codelineno-0-103></a><span class=k>def</span><span class=w> </span><span class=fm>__bool__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-0-104><a id=__codelineno-0-104 name=__codelineno-0-104></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Overrides the behavior when checking for truthiness.&quot;&quot;&quot;</span>
</span><span id=__span-0-105><a id=__codelineno-0-105 name=__codelineno-0-105></a>    <span class=k>return</span> <span class=bp>self</span> <span class=o>==</span> <span class=n>SignatureVerificationResult</span><span class=o>.</span><span class=n>TRUE</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h7 id=nearai.shared.near.sign.SignatureVerificationResult.from_bool class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">from_bool</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small> </span> <a href=#nearai.shared.near.sign.SignatureVerificationResult.from_bool class=headerlink title="Permanent link">&para;</a></h7> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>from_bool</span><span class=p>(</span><span class=n>value</span><span class=p>:</span> <span class=n>bool</span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Gets VerificationResult based on a boolean value.</p> <details class=quote> <summary>Source code in <code>nearai/shared/near/sign.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-98> 98</a></span>
<span class=normal><a href=#__codelineno-0-99> 99</a></span>
<span class=normal><a href=#__codelineno-0-100>100</a></span>
<span class=normal><a href=#__codelineno-0-101>101</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-98><a id=__codelineno-0-98 name=__codelineno-0-98></a><span class=nd>@classmethod</span>
</span><span id=__span-0-99><a id=__codelineno-0-99 name=__codelineno-0-99></a><span class=k>def</span><span class=w> </span><span class=nf>from_bool</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>value</span><span class=p>:</span> <span class=nb>bool</span><span class=p>):</span>
</span><span id=__span-0-100><a id=__codelineno-0-100 name=__codelineno-0-100></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Gets VerificationResult based on a boolean value.&quot;&quot;&quot;</span>
</span><span id=__span-0-101><a id=__codelineno-0-101 name=__codelineno-0-101></a>    <span class=k>return</span> <span class=bp>cls</span><span class=o>.</span><span class=n>TRUE</span> <span class=k>if</span> <span class=n>value</span> <span class=k>else</span> <span class=bp>cls</span><span class=o>.</span><span class=n>FALSE</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.near.sign.convert_nonce class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">convert_nonce</span> <a href=#nearai.shared.near.sign.convert_nonce class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>convert_nonce</span><span class=p>(</span><span class=n>value</span><span class=p>:</span> <span class=n><span title=typing.Union>Union</span></span><span class=p>[</span><span class=n>str</span><span class=p>,</span> <span class=n>bytes</span><span class=p>,</span> <span class=n>list</span><span class=p>[</span><span class=n>int</span><span class=p>]])</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Converts a given value to a 32-byte nonce.</p> <details class=quote> <summary>Source code in <code>nearai/shared/near/sign.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-54>54</a></span>
<span class=normal><a href=#__codelineno-0-55>55</a></span>
<span class=normal><a href=#__codelineno-0-56>56</a></span>
<span class=normal><a href=#__codelineno-0-57>57</a></span>
<span class=normal><a href=#__codelineno-0-58>58</a></span>
<span class=normal><a href=#__codelineno-0-59>59</a></span>
<span class=normal><a href=#__codelineno-0-60>60</a></span>
<span class=normal><a href=#__codelineno-0-61>61</a></span>
<span class=normal><a href=#__codelineno-0-62>62</a></span>
<span class=normal><a href=#__codelineno-0-63>63</a></span>
<span class=normal><a href=#__codelineno-0-64>64</a></span>
<span class=normal><a href=#__codelineno-0-65>65</a></span>
<span class=normal><a href=#__codelineno-0-66>66</a></span>
<span class=normal><a href=#__codelineno-0-67>67</a></span>
<span class=normal><a href=#__codelineno-0-68>68</a></span>
<span class=normal><a href=#__codelineno-0-69>69</a></span>
<span class=normal><a href=#__codelineno-0-70>70</a></span>
<span class=normal><a href=#__codelineno-0-71>71</a></span>
<span class=normal><a href=#__codelineno-0-72>72</a></span>
<span class=normal><a href=#__codelineno-0-73>73</a></span>
<span class=normal><a href=#__codelineno-0-74>74</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-54><a id=__codelineno-0-54 name=__codelineno-0-54></a><span class=k>def</span><span class=w> </span><span class=nf>convert_nonce</span><span class=p>(</span><span class=n>value</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>bytes</span><span class=p>,</span> <span class=nb>list</span><span class=p>[</span><span class=nb>int</span><span class=p>]]):</span>
</span><span id=__span-0-55><a id=__codelineno-0-55 name=__codelineno-0-55></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Converts a given value to a 32-byte nonce.&quot;&quot;&quot;</span>
</span><span id=__span-0-56><a id=__codelineno-0-56 name=__codelineno-0-56></a>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=nb>bytes</span><span class=p>):</span>
</span><span id=__span-0-57><a id=__codelineno-0-57 name=__codelineno-0-57></a>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>value</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>32</span><span class=p>:</span>
</span><span id=__span-0-58><a id=__codelineno-0-58 name=__codelineno-0-58></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Invalid nonce length&quot;</span><span class=p>)</span>
</span><span id=__span-0-59><a id=__codelineno-0-59 name=__codelineno-0-59></a>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>value</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>32</span><span class=p>:</span>
</span><span id=__span-0-60><a id=__codelineno-0-60 name=__codelineno-0-60></a>            <span class=n>value</span> <span class=o>=</span> <span class=n>value</span><span class=o>.</span><span class=n>rjust</span><span class=p>(</span><span class=mi>32</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&quot;0&quot;</span><span class=p>)</span>
</span><span id=__span-0-61><a id=__codelineno-0-61 name=__codelineno-0-61></a>        <span class=k>return</span> <span class=n>value</span>
</span><span id=__span-0-62><a id=__codelineno-0-62 name=__codelineno-0-62></a>    <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-0-63><a id=__codelineno-0-63 name=__codelineno-0-63></a>        <span class=n>nonce_bytes</span> <span class=o>=</span> <span class=n>value</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s2>&quot;utf-8&quot;</span><span class=p>)</span>
</span><span id=__span-0-64><a id=__codelineno-0-64 name=__codelineno-0-64></a>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>nonce_bytes</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>32</span><span class=p>:</span>
</span><span id=__span-0-65><a id=__codelineno-0-65 name=__codelineno-0-65></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Invalid nonce length&quot;</span><span class=p>)</span>
</span><span id=__span-0-66><a id=__codelineno-0-66 name=__codelineno-0-66></a>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>nonce_bytes</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>32</span><span class=p>:</span>
</span><span id=__span-0-67><a id=__codelineno-0-67 name=__codelineno-0-67></a>            <span class=n>nonce_bytes</span> <span class=o>=</span> <span class=n>nonce_bytes</span><span class=o>.</span><span class=n>rjust</span><span class=p>(</span><span class=mi>32</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&quot;0&quot;</span><span class=p>)</span>
</span><span id=__span-0-68><a id=__codelineno-0-68 name=__codelineno-0-68></a>        <span class=k>return</span> <span class=n>nonce_bytes</span>
</span><span id=__span-0-69><a id=__codelineno-0-69 name=__codelineno-0-69></a>    <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=nb>list</span><span class=p>):</span>
</span><span id=__span-0-70><a id=__codelineno-0-70 name=__codelineno-0-70></a>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>value</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>32</span><span class=p>:</span>
</span><span id=__span-0-71><a id=__codelineno-0-71 name=__codelineno-0-71></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Invalid nonce length&quot;</span><span class=p>)</span>
</span><span id=__span-0-72><a id=__codelineno-0-72 name=__codelineno-0-72></a>        <span class=k>return</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
</span><span id=__span-0-73><a id=__codelineno-0-73 name=__codelineno-0-73></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-74><a id=__codelineno-0-74 name=__codelineno-0-74></a>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Invalid nonce format&quot;</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.near.sign.create_inference_signature class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">create_inference_signature</span> <a href=#nearai.shared.near.sign.create_inference_signature class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>create_inference_signature</span><span class=p>(</span><span class=n>private_key</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>payload</span><span class=p>:</span> <span class=n><span title=nearai.shared.near.sign.CompletionSignaturePayload>CompletionSignaturePayload</span></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>tuple</span><span class=p>[</span><span class=n>str</span><span class=p>,</span> <span class=n>str</span><span class=p>]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Creates a cryptographic signature for a given extended inference payload using a specified private key.</p> <details class=quote> <summary>Source code in <code>nearai/shared/near/sign.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-287>287</a></span>
<span class=normal><a href=#__codelineno-0-288>288</a></span>
<span class=normal><a href=#__codelineno-0-289>289</a></span>
<span class=normal><a href=#__codelineno-0-290>290</a></span>
<span class=normal><a href=#__codelineno-0-291>291</a></span>
<span class=normal><a href=#__codelineno-0-292>292</a></span>
<span class=normal><a href=#__codelineno-0-293>293</a></span>
<span class=normal><a href=#__codelineno-0-294>294</a></span>
<span class=normal><a href=#__codelineno-0-295>295</a></span>
<span class=normal><a href=#__codelineno-0-296>296</a></span>
<span class=normal><a href=#__codelineno-0-297>297</a></span>
<span class=normal><a href=#__codelineno-0-298>298</a></span>
<span class=normal><a href=#__codelineno-0-299>299</a></span>
<span class=normal><a href=#__codelineno-0-300>300</a></span>
<span class=normal><a href=#__codelineno-0-301>301</a></span>
<span class=normal><a href=#__codelineno-0-302>302</a></span>
<span class=normal><a href=#__codelineno-0-303>303</a></span>
<span class=normal><a href=#__codelineno-0-304>304</a></span>
<span class=normal><a href=#__codelineno-0-305>305</a></span>
<span class=normal><a href=#__codelineno-0-306>306</a></span>
<span class=normal><a href=#__codelineno-0-307>307</a></span>
<span class=normal><a href=#__codelineno-0-308>308</a></span>
<span class=normal><a href=#__codelineno-0-309>309</a></span>
<span class=normal><a href=#__codelineno-0-310>310</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-287><a id=__codelineno-0-287 name=__codelineno-0-287></a><span class=k>def</span><span class=w> </span><span class=nf>create_inference_signature</span><span class=p>(</span><span class=n>private_key</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>payload</span><span class=p>:</span> <span class=n>CompletionSignaturePayload</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]:</span>
</span><span id=__span-0-288><a id=__codelineno-0-288 name=__codelineno-0-288></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Creates a cryptographic signature for a given extended inference payload using a specified private key.&quot;&quot;&quot;</span>
</span><span id=__span-0-289><a id=__codelineno-0-289 name=__codelineno-0-289></a>    <span class=n>borsh_payload</span> <span class=o>=</span> <span class=n>BinarySerializer</span><span class=p>(</span><span class=nb>dict</span><span class=p>(</span><span class=n>COMPLETION_PAYLOAD_SCHEMA</span><span class=p>))</span><span class=o>.</span><span class=n>serialize</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span><span id=__span-0-290><a id=__codelineno-0-290 name=__codelineno-0-290></a>
</span><span id=__span-0-291><a id=__codelineno-0-291 name=__codelineno-0-291></a>    <span class=n>to_sign</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>sha256</span><span class=p>(</span><span class=n>borsh_payload</span><span class=p>)</span><span class=o>.</span><span class=n>digest</span><span class=p>()</span>
</span><span id=__span-0-292><a id=__codelineno-0-292 name=__codelineno-0-292></a>
</span><span id=__span-0-293><a id=__codelineno-0-293 name=__codelineno-0-293></a>    <span class=n>private_key_base58</span> <span class=o>=</span> <span class=n>private_key</span><span class=p>[</span><span class=nb>len</span><span class=p>(</span><span class=n>ED_PREFIX</span><span class=p>)</span> <span class=p>:]</span>
</span><span id=__span-0-294><a id=__codelineno-0-294 name=__codelineno-0-294></a>    <span class=n>private_key_bytes</span> <span class=o>=</span> <span class=n>base58</span><span class=o>.</span><span class=n>b58decode</span><span class=p>(</span><span class=n>private_key_base58</span><span class=p>)</span>
</span><span id=__span-0-295><a id=__codelineno-0-295 name=__codelineno-0-295></a>
</span><span id=__span-0-296><a id=__codelineno-0-296 name=__codelineno-0-296></a>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>private_key_bytes</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>64</span><span class=p>:</span>
</span><span id=__span-0-297><a id=__codelineno-0-297 name=__codelineno-0-297></a>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;The private key must be exactly 64 bytes long&quot;</span><span class=p>)</span>
</span><span id=__span-0-298><a id=__codelineno-0-298 name=__codelineno-0-298></a>
</span><span id=__span-0-299><a id=__codelineno-0-299 name=__codelineno-0-299></a>    <span class=n>private_key_seed</span> <span class=o>=</span> <span class=n>private_key_bytes</span><span class=p>[:</span><span class=mi>32</span><span class=p>]</span>
</span><span id=__span-0-300><a id=__codelineno-0-300 name=__codelineno-0-300></a>
</span><span id=__span-0-301><a id=__codelineno-0-301 name=__codelineno-0-301></a>    <span class=n>signing_key</span> <span class=o>=</span> <span class=n>nacl</span><span class=o>.</span><span class=n>signing</span><span class=o>.</span><span class=n>SigningKey</span><span class=p>(</span><span class=n>private_key_seed</span><span class=p>)</span>
</span><span id=__span-0-302><a id=__codelineno-0-302 name=__codelineno-0-302></a>    <span class=n>public_key</span> <span class=o>=</span> <span class=n>signing_key</span><span class=o>.</span><span class=n>verify_key</span>
</span><span id=__span-0-303><a id=__codelineno-0-303 name=__codelineno-0-303></a>
</span><span id=__span-0-304><a id=__codelineno-0-304 name=__codelineno-0-304></a>    <span class=n>signed</span> <span class=o>=</span> <span class=n>signing_key</span><span class=o>.</span><span class=n>sign</span><span class=p>(</span><span class=n>to_sign</span><span class=p>)</span>
</span><span id=__span-0-305><a id=__codelineno-0-305 name=__codelineno-0-305></a>    <span class=n>signature</span> <span class=o>=</span> <span class=n>base64</span><span class=o>.</span><span class=n>b64encode</span><span class=p>(</span><span class=n>signed</span><span class=o>.</span><span class=n>signature</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s2>&quot;utf-8&quot;</span><span class=p>)</span>
</span><span id=__span-0-306><a id=__codelineno-0-306 name=__codelineno-0-306></a>
</span><span id=__span-0-307><a id=__codelineno-0-307 name=__codelineno-0-307></a>    <span class=n>public_key_base58</span> <span class=o>=</span> <span class=n>base58</span><span class=o>.</span><span class=n>b58encode</span><span class=p>(</span><span class=n>public_key</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s2>&quot;utf-8&quot;</span><span class=p>)</span>
</span><span id=__span-0-308><a id=__codelineno-0-308 name=__codelineno-0-308></a>    <span class=n>full_public_key</span> <span class=o>=</span> <span class=n>ED_PREFIX</span> <span class=o>+</span> <span class=n>public_key_base58</span>
</span><span id=__span-0-309><a id=__codelineno-0-309 name=__codelineno-0-309></a>
</span><span id=__span-0-310><a id=__codelineno-0-310 name=__codelineno-0-310></a>    <span class=k>return</span> <span class=n>signature</span><span class=p>,</span> <span class=n>full_public_key</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.near.sign.create_signature class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">create_signature</span> <a href=#nearai.shared.near.sign.create_signature class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>create_signature</span><span class=p>(</span><span class=n>private_key</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>payload</span><span class=p>:</span> <span class=n><span title=nearai.shared.near.sign.Payload>Payload</span></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>tuple</span><span class=p>[</span><span class=n>str</span><span class=p>,</span> <span class=n>str</span><span class=p>]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Creates a cryptographic signature for a given payload using a specified private key.</p> <details class=quote> <summary>Source code in <code>nearai/shared/near/sign.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-148>148</a></span>
<span class=normal><a href=#__codelineno-0-149>149</a></span>
<span class=normal><a href=#__codelineno-0-150>150</a></span>
<span class=normal><a href=#__codelineno-0-151>151</a></span>
<span class=normal><a href=#__codelineno-0-152>152</a></span>
<span class=normal><a href=#__codelineno-0-153>153</a></span>
<span class=normal><a href=#__codelineno-0-154>154</a></span>
<span class=normal><a href=#__codelineno-0-155>155</a></span>
<span class=normal><a href=#__codelineno-0-156>156</a></span>
<span class=normal><a href=#__codelineno-0-157>157</a></span>
<span class=normal><a href=#__codelineno-0-158>158</a></span>
<span class=normal><a href=#__codelineno-0-159>159</a></span>
<span class=normal><a href=#__codelineno-0-160>160</a></span>
<span class=normal><a href=#__codelineno-0-161>161</a></span>
<span class=normal><a href=#__codelineno-0-162>162</a></span>
<span class=normal><a href=#__codelineno-0-163>163</a></span>
<span class=normal><a href=#__codelineno-0-164>164</a></span>
<span class=normal><a href=#__codelineno-0-165>165</a></span>
<span class=normal><a href=#__codelineno-0-166>166</a></span>
<span class=normal><a href=#__codelineno-0-167>167</a></span>
<span class=normal><a href=#__codelineno-0-168>168</a></span>
<span class=normal><a href=#__codelineno-0-169>169</a></span>
<span class=normal><a href=#__codelineno-0-170>170</a></span>
<span class=normal><a href=#__codelineno-0-171>171</a></span>
<span class=normal><a href=#__codelineno-0-172>172</a></span>
<span class=normal><a href=#__codelineno-0-173>173</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-148><a id=__codelineno-0-148 name=__codelineno-0-148></a><span class=k>def</span><span class=w> </span><span class=nf>create_signature</span><span class=p>(</span><span class=n>private_key</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>payload</span><span class=p>:</span> <span class=n>Payload</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>tuple</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]:</span>
</span><span id=__span-0-149><a id=__codelineno-0-149 name=__codelineno-0-149></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Creates a cryptographic signature for a given payload using a specified private key.&quot;&quot;&quot;</span>
</span><span id=__span-0-150><a id=__codelineno-0-150 name=__codelineno-0-150></a>    <span class=n>borsh_payload</span> <span class=o>=</span> <span class=n>BinarySerializer</span><span class=p>(</span><span class=nb>dict</span><span class=p>(</span><span class=n>PAYLOAD_SCHEMA</span><span class=p>))</span><span class=o>.</span><span class=n>serialize</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span><span id=__span-0-151><a id=__codelineno-0-151 name=__codelineno-0-151></a>
</span><span id=__span-0-152><a id=__codelineno-0-152 name=__codelineno-0-152></a>    <span class=n>to_sign</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>sha256</span><span class=p>(</span><span class=n>borsh_payload</span><span class=p>)</span><span class=o>.</span><span class=n>digest</span><span class=p>()</span>
</span><span id=__span-0-153><a id=__codelineno-0-153 name=__codelineno-0-153></a>
</span><span id=__span-0-154><a id=__codelineno-0-154 name=__codelineno-0-154></a>    <span class=c1># Extract and decode the private key</span>
</span><span id=__span-0-155><a id=__codelineno-0-155 name=__codelineno-0-155></a>    <span class=n>private_key_base58</span> <span class=o>=</span> <span class=n>private_key</span><span class=p>[</span><span class=nb>len</span><span class=p>(</span><span class=n>ED_PREFIX</span><span class=p>)</span> <span class=p>:]</span>
</span><span id=__span-0-156><a id=__codelineno-0-156 name=__codelineno-0-156></a>    <span class=n>private_key_bytes</span> <span class=o>=</span> <span class=n>base58</span><span class=o>.</span><span class=n>b58decode</span><span class=p>(</span><span class=n>private_key_base58</span><span class=p>)</span>
</span><span id=__span-0-157><a id=__codelineno-0-157 name=__codelineno-0-157></a>
</span><span id=__span-0-158><a id=__codelineno-0-158 name=__codelineno-0-158></a>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>private_key_bytes</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>64</span><span class=p>:</span>
</span><span id=__span-0-159><a id=__codelineno-0-159 name=__codelineno-0-159></a>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;The private key must be exactly 64 bytes long&quot;</span><span class=p>)</span>
</span><span id=__span-0-160><a id=__codelineno-0-160 name=__codelineno-0-160></a>
</span><span id=__span-0-161><a id=__codelineno-0-161 name=__codelineno-0-161></a>    <span class=c1># Use only the first 32 bytes as the seed</span>
</span><span id=__span-0-162><a id=__codelineno-0-162 name=__codelineno-0-162></a>    <span class=n>private_key_seed</span> <span class=o>=</span> <span class=n>private_key_bytes</span><span class=p>[:</span><span class=mi>32</span><span class=p>]</span>
</span><span id=__span-0-163><a id=__codelineno-0-163 name=__codelineno-0-163></a>
</span><span id=__span-0-164><a id=__codelineno-0-164 name=__codelineno-0-164></a>    <span class=n>signing_key</span> <span class=o>=</span> <span class=n>nacl</span><span class=o>.</span><span class=n>signing</span><span class=o>.</span><span class=n>SigningKey</span><span class=p>(</span><span class=n>private_key_seed</span><span class=p>)</span>
</span><span id=__span-0-165><a id=__codelineno-0-165 name=__codelineno-0-165></a>    <span class=n>public_key</span> <span class=o>=</span> <span class=n>signing_key</span><span class=o>.</span><span class=n>verify_key</span>
</span><span id=__span-0-166><a id=__codelineno-0-166 name=__codelineno-0-166></a>
</span><span id=__span-0-167><a id=__codelineno-0-167 name=__codelineno-0-167></a>    <span class=n>signed</span> <span class=o>=</span> <span class=n>signing_key</span><span class=o>.</span><span class=n>sign</span><span class=p>(</span><span class=n>to_sign</span><span class=p>)</span>
</span><span id=__span-0-168><a id=__codelineno-0-168 name=__codelineno-0-168></a>    <span class=n>signature</span> <span class=o>=</span> <span class=n>base64</span><span class=o>.</span><span class=n>b64encode</span><span class=p>(</span><span class=n>signed</span><span class=o>.</span><span class=n>signature</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s2>&quot;utf-8&quot;</span><span class=p>)</span>
</span><span id=__span-0-169><a id=__codelineno-0-169 name=__codelineno-0-169></a>
</span><span id=__span-0-170><a id=__codelineno-0-170 name=__codelineno-0-170></a>    <span class=n>public_key_base58</span> <span class=o>=</span> <span class=n>base58</span><span class=o>.</span><span class=n>b58encode</span><span class=p>(</span><span class=n>public_key</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s2>&quot;utf-8&quot;</span><span class=p>)</span>
</span><span id=__span-0-171><a id=__codelineno-0-171 name=__codelineno-0-171></a>    <span class=n>full_public_key</span> <span class=o>=</span> <span class=n>ED_PREFIX</span> <span class=o>+</span> <span class=n>public_key_base58</span>
</span><span id=__span-0-172><a id=__codelineno-0-172 name=__codelineno-0-172></a>
</span><span id=__span-0-173><a id=__codelineno-0-173 name=__codelineno-0-173></a>    <span class=k>return</span> <span class=n>signature</span><span class=p>,</span> <span class=n>full_public_key</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.near.sign.validate_completion_signature class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">validate_completion_signature</span> <a href=#nearai.shared.near.sign.validate_completion_signature class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>validate_completion_signature</span><span class=p>(</span><span class=n>public_key</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>signature</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>payload</span><span class=p>:</span> <span class=n><span title=nearai.shared.near.sign.CompletionSignaturePayload>CompletionSignaturePayload</span></span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Validates a cryptographic signature for a given payload using a specified public key.</p> <details class=quote> <summary>Source code in <code>nearai/shared/near/sign.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-254>254</a></span>
<span class=normal><a href=#__codelineno-0-255>255</a></span>
<span class=normal><a href=#__codelineno-0-256>256</a></span>
<span class=normal><a href=#__codelineno-0-257>257</a></span>
<span class=normal><a href=#__codelineno-0-258>258</a></span>
<span class=normal><a href=#__codelineno-0-259>259</a></span>
<span class=normal><a href=#__codelineno-0-260>260</a></span>
<span class=normal><a href=#__codelineno-0-261>261</a></span>
<span class=normal><a href=#__codelineno-0-262>262</a></span>
<span class=normal><a href=#__codelineno-0-263>263</a></span>
<span class=normal><a href=#__codelineno-0-264>264</a></span>
<span class=normal><a href=#__codelineno-0-265>265</a></span>
<span class=normal><a href=#__codelineno-0-266>266</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-254><a id=__codelineno-0-254 name=__codelineno-0-254></a><span class=k>def</span><span class=w> </span><span class=nf>validate_completion_signature</span><span class=p>(</span><span class=n>public_key</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>signature</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>payload</span><span class=p>:</span> <span class=n>CompletionSignaturePayload</span><span class=p>):</span>
</span><span id=__span-0-255><a id=__codelineno-0-255 name=__codelineno-0-255></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Validates a cryptographic signature for a given payload using a specified public key.&quot;&quot;&quot;</span>
</span><span id=__span-0-256><a id=__codelineno-0-256 name=__codelineno-0-256></a>    <span class=n>borsh_payload</span> <span class=o>=</span> <span class=n>BinarySerializer</span><span class=p>(</span><span class=nb>dict</span><span class=p>(</span><span class=n>COMPLETION_PAYLOAD_SCHEMA</span><span class=p>))</span><span class=o>.</span><span class=n>serialize</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span><span id=__span-0-257><a id=__codelineno-0-257 name=__codelineno-0-257></a>    <span class=n>to_sign</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>sha256</span><span class=p>(</span><span class=n>borsh_payload</span><span class=p>)</span><span class=o>.</span><span class=n>digest</span><span class=p>()</span>
</span><span id=__span-0-258><a id=__codelineno-0-258 name=__codelineno-0-258></a>    <span class=n>real_signature</span> <span class=o>=</span> <span class=n>base64</span><span class=o>.</span><span class=n>b64decode</span><span class=p>(</span><span class=n>signature</span><span class=p>)</span>
</span><span id=__span-0-259><a id=__codelineno-0-259 name=__codelineno-0-259></a>
</span><span id=__span-0-260><a id=__codelineno-0-260 name=__codelineno-0-260></a>    <span class=n>verify_key</span><span class=p>:</span> <span class=n>nacl</span><span class=o>.</span><span class=n>signing</span><span class=o>.</span><span class=n>VerifyKey</span> <span class=o>=</span> <span class=n>nacl</span><span class=o>.</span><span class=n>signing</span><span class=o>.</span><span class=n>VerifyKey</span><span class=p>(</span><span class=n>base58</span><span class=o>.</span><span class=n>b58decode</span><span class=p>(</span><span class=n>public_key</span><span class=p>[</span><span class=nb>len</span><span class=p>(</span><span class=n>ED_PREFIX</span><span class=p>)</span> <span class=p>:]))</span>
</span><span id=__span-0-261><a id=__codelineno-0-261 name=__codelineno-0-261></a>
</span><span id=__span-0-262><a id=__codelineno-0-262 name=__codelineno-0-262></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-263><a id=__codelineno-0-263 name=__codelineno-0-263></a>        <span class=n>verify_key</span><span class=o>.</span><span class=n>verify</span><span class=p>(</span><span class=n>to_sign</span><span class=p>,</span> <span class=n>real_signature</span><span class=p>)</span>
</span><span id=__span-0-264><a id=__codelineno-0-264 name=__codelineno-0-264></a>        <span class=k>return</span> <span class=kc>True</span>
</span><span id=__span-0-265><a id=__codelineno-0-265 name=__codelineno-0-265></a>    <span class=k>except</span> <span class=n>nacl</span><span class=o>.</span><span class=n>exceptions</span><span class=o>.</span><span class=n>BadSignatureError</span><span class=p>:</span>
</span><span id=__span-0-266><a id=__codelineno-0-266 name=__codelineno-0-266></a>        <span class=k>return</span> <span class=kc>False</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.near.sign.validate_nonce class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">validate_nonce</span> <a href=#nearai.shared.near.sign.validate_nonce class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>validate_nonce</span><span class=p>(</span><span class=n>value</span><span class=p>:</span> <span class=n><span title=typing.Union>Union</span></span><span class=p>[</span><span class=n>str</span><span class=p>,</span> <span class=n>bytes</span><span class=p>,</span> <span class=n>list</span><span class=p>[</span><span class=n>int</span><span class=p>]])</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Ensures that the nonce is a valid timestamp.</p> <details class=quote> <summary>Source code in <code>nearai/shared/near/sign.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-77>77</a></span>
<span class=normal><a href=#__codelineno-0-78>78</a></span>
<span class=normal><a href=#__codelineno-0-79>79</a></span>
<span class=normal><a href=#__codelineno-0-80>80</a></span>
<span class=normal><a href=#__codelineno-0-81>81</a></span>
<span class=normal><a href=#__codelineno-0-82>82</a></span>
<span class=normal><a href=#__codelineno-0-83>83</a></span>
<span class=normal><a href=#__codelineno-0-84>84</a></span>
<span class=normal><a href=#__codelineno-0-85>85</a></span>
<span class=normal><a href=#__codelineno-0-86>86</a></span>
<span class=normal><a href=#__codelineno-0-87>87</a></span>
<span class=normal><a href=#__codelineno-0-88>88</a></span>
<span class=normal><a href=#__codelineno-0-89>89</a></span>
<span class=normal><a href=#__codelineno-0-90>90</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-77><a id=__codelineno-0-77 name=__codelineno-0-77></a><span class=k>def</span><span class=w> </span><span class=nf>validate_nonce</span><span class=p>(</span><span class=n>value</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>bytes</span><span class=p>,</span> <span class=nb>list</span><span class=p>[</span><span class=nb>int</span><span class=p>]]):</span>
</span><span id=__span-0-78><a id=__codelineno-0-78 name=__codelineno-0-78></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Ensures that the nonce is a valid timestamp.&quot;&quot;&quot;</span>
</span><span id=__span-0-79><a id=__codelineno-0-79 name=__codelineno-0-79></a>    <span class=n>nonce</span> <span class=o>=</span> <span class=n>convert_nonce</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
</span><span id=__span-0-80><a id=__codelineno-0-80 name=__codelineno-0-80></a>    <span class=n>nonce_int</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>nonce</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s2>&quot;utf-8&quot;</span><span class=p>))</span>
</span><span id=__span-0-81><a id=__codelineno-0-81 name=__codelineno-0-81></a>
</span><span id=__span-0-82><a id=__codelineno-0-82 name=__codelineno-0-82></a>    <span class=n>now</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>)</span>
</span><span id=__span-0-83><a id=__codelineno-0-83 name=__codelineno-0-83></a>
</span><span id=__span-0-84><a id=__codelineno-0-84 name=__codelineno-0-84></a>    <span class=k>if</span> <span class=n>nonce_int</span> <span class=o>&gt;</span> <span class=n>now</span><span class=p>:</span>
</span><span id=__span-0-85><a id=__codelineno-0-85 name=__codelineno-0-85></a>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Nonce is in the future&quot;</span><span class=p>)</span>
</span><span id=__span-0-86><a id=__codelineno-0-86 name=__codelineno-0-86></a>    <span class=k>if</span> <span class=n>now</span> <span class=o>-</span> <span class=n>nonce_int</span> <span class=o>&gt;</span> <span class=mi>10</span> <span class=o>*</span> <span class=mi>365</span> <span class=o>*</span> <span class=mi>24</span> <span class=o>*</span> <span class=mi>60</span> <span class=o>*</span> <span class=mi>60</span> <span class=o>*</span> <span class=mi>1000</span><span class=p>:</span>
</span><span id=__span-0-87><a id=__codelineno-0-87 name=__codelineno-0-87></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;If the timestamp is older than 10 years, it is considered invalid. Forcing apps to use unique nonces.&quot;&quot;&quot;</span>
</span><span id=__span-0-88><a id=__codelineno-0-88 name=__codelineno-0-88></a>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Nonce is too old&quot;</span><span class=p>)</span>
</span><span id=__span-0-89><a id=__codelineno-0-89 name=__codelineno-0-89></a>
</span><span id=__span-0-90><a id=__codelineno-0-90 name=__codelineno-0-90></a>    <span class=k>return</span> <span class=n>nonce</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.near.sign.validate_signature class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">validate_signature</span> <a href=#nearai.shared.near.sign.validate_signature class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>validate_signature</span><span class=p>(</span><span class=n>public_key</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>signature</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>payload</span><span class=p>:</span> <span class=n><span title=nearai.shared.near.sign.Payload>Payload</span></span><span class=p>)</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Validates a cryptographic signature for a given payload using a specified public key.</p> <details class=quote> <summary>Source code in <code>nearai/shared/near/sign.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-176>176</a></span>
<span class=normal><a href=#__codelineno-0-177>177</a></span>
<span class=normal><a href=#__codelineno-0-178>178</a></span>
<span class=normal><a href=#__codelineno-0-179>179</a></span>
<span class=normal><a href=#__codelineno-0-180>180</a></span>
<span class=normal><a href=#__codelineno-0-181>181</a></span>
<span class=normal><a href=#__codelineno-0-182>182</a></span>
<span class=normal><a href=#__codelineno-0-183>183</a></span>
<span class=normal><a href=#__codelineno-0-184>184</a></span>
<span class=normal><a href=#__codelineno-0-185>185</a></span>
<span class=normal><a href=#__codelineno-0-186>186</a></span>
<span class=normal><a href=#__codelineno-0-187>187</a></span>
<span class=normal><a href=#__codelineno-0-188>188</a></span>
<span class=normal><a href=#__codelineno-0-189>189</a></span>
<span class=normal><a href=#__codelineno-0-190>190</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-176><a id=__codelineno-0-176 name=__codelineno-0-176></a><span class=k>def</span><span class=w> </span><span class=nf>validate_signature</span><span class=p>(</span><span class=n>public_key</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>signature</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>payload</span><span class=p>:</span> <span class=n>Payload</span><span class=p>):</span>
</span><span id=__span-0-177><a id=__codelineno-0-177 name=__codelineno-0-177></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Validates a cryptographic signature for a given payload using a specified public key.&quot;&quot;&quot;</span>
</span><span id=__span-0-178><a id=__codelineno-0-178 name=__codelineno-0-178></a>    <span class=n>borsh_payload</span> <span class=o>=</span> <span class=n>BinarySerializer</span><span class=p>(</span><span class=nb>dict</span><span class=p>(</span><span class=n>PAYLOAD_SCHEMA</span><span class=p>))</span><span class=o>.</span><span class=n>serialize</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span><span id=__span-0-179><a id=__codelineno-0-179 name=__codelineno-0-179></a>    <span class=n>to_sign</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>sha256</span><span class=p>(</span><span class=n>borsh_payload</span><span class=p>)</span><span class=o>.</span><span class=n>digest</span><span class=p>()</span>
</span><span id=__span-0-180><a id=__codelineno-0-180 name=__codelineno-0-180></a>    <span class=n>real_signature</span> <span class=o>=</span> <span class=n>base64</span><span class=o>.</span><span class=n>b64decode</span><span class=p>(</span><span class=n>signature</span><span class=p>)</span>
</span><span id=__span-0-181><a id=__codelineno-0-181 name=__codelineno-0-181></a>
</span><span id=__span-0-182><a id=__codelineno-0-182 name=__codelineno-0-182></a>    <span class=n>verify_key</span><span class=p>:</span> <span class=n>nacl</span><span class=o>.</span><span class=n>signing</span><span class=o>.</span><span class=n>VerifyKey</span> <span class=o>=</span> <span class=n>nacl</span><span class=o>.</span><span class=n>signing</span><span class=o>.</span><span class=n>VerifyKey</span><span class=p>(</span><span class=n>base58</span><span class=o>.</span><span class=n>b58decode</span><span class=p>(</span><span class=n>public_key</span><span class=p>[</span><span class=nb>len</span><span class=p>(</span><span class=n>ED_PREFIX</span><span class=p>)</span> <span class=p>:]))</span>
</span><span id=__span-0-183><a id=__codelineno-0-183 name=__codelineno-0-183></a>
</span><span id=__span-0-184><a id=__codelineno-0-184 name=__codelineno-0-184></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-185><a id=__codelineno-0-185 name=__codelineno-0-185></a>        <span class=n>verify_key</span><span class=o>.</span><span class=n>verify</span><span class=p>(</span><span class=n>to_sign</span><span class=p>,</span> <span class=n>real_signature</span><span class=p>)</span>
</span><span id=__span-0-186><a id=__codelineno-0-186 name=__codelineno-0-186></a>        <span class=c1># print(&quot;Signature is valid.&quot;)</span>
</span><span id=__span-0-187><a id=__codelineno-0-187 name=__codelineno-0-187></a>        <span class=k>return</span> <span class=kc>True</span>
</span><span id=__span-0-188><a id=__codelineno-0-188 name=__codelineno-0-188></a>    <span class=k>except</span> <span class=n>nacl</span><span class=o>.</span><span class=n>exceptions</span><span class=o>.</span><span class=n>BadSignatureError</span><span class=p>:</span>
</span><span id=__span-0-189><a id=__codelineno-0-189 name=__codelineno-0-189></a>        <span class=c1># print(&quot;Signature was forged or corrupt.&quot;)</span>
</span><span id=__span-0-190><a id=__codelineno-0-190 name=__codelineno-0-190></a>        <span class=k>return</span> <span class=kc>False</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.near.sign.verify_access_key_owner class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">verify_access_key_owner</span> <a href=#nearai.shared.near.sign.verify_access_key_owner class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>verify_access_key_owner</span><span class=p>(</span><span class=n>public_key</span><span class=p>,</span> <span class=n>account_id</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><a class="autorefs autorefs-internal" title=nearai.shared.near.sign.SignatureVerificationResult href=#nearai.shared.near.sign.SignatureVerificationResult>SignatureVerificationResult</a></span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Verifies if a given public key belongs to a specified account ID using FastNEAR API.</p> <details class=quote> <summary>Source code in <code>nearai/shared/near/sign.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-126>126</a></span>
<span class=normal><a href=#__codelineno-0-127>127</a></span>
<span class=normal><a href=#__codelineno-0-128>128</a></span>
<span class=normal><a href=#__codelineno-0-129>129</a></span>
<span class=normal><a href=#__codelineno-0-130>130</a></span>
<span class=normal><a href=#__codelineno-0-131>131</a></span>
<span class=normal><a href=#__codelineno-0-132>132</a></span>
<span class=normal><a href=#__codelineno-0-133>133</a></span>
<span class=normal><a href=#__codelineno-0-134>134</a></span>
<span class=normal><a href=#__codelineno-0-135>135</a></span>
<span class=normal><a href=#__codelineno-0-136>136</a></span>
<span class=normal><a href=#__codelineno-0-137>137</a></span>
<span class=normal><a href=#__codelineno-0-138>138</a></span>
<span class=normal><a href=#__codelineno-0-139>139</a></span>
<span class=normal><a href=#__codelineno-0-140>140</a></span>
<span class=normal><a href=#__codelineno-0-141>141</a></span>
<span class=normal><a href=#__codelineno-0-142>142</a></span>
<span class=normal><a href=#__codelineno-0-143>143</a></span>
<span class=normal><a href=#__codelineno-0-144>144</a></span>
<span class=normal><a href=#__codelineno-0-145>145</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-126><a id=__codelineno-0-126 name=__codelineno-0-126></a><span class=nd>@mem_cache_with_timeout</span><span class=p>(</span><span class=mi>300</span><span class=p>)</span>
</span><span id=__span-0-127><a id=__codelineno-0-127 name=__codelineno-0-127></a><span class=k>def</span><span class=w> </span><span class=nf>verify_access_key_owner</span><span class=p>(</span><span class=n>public_key</span><span class=p>,</span> <span class=n>account_id</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>SignatureVerificationResult</span><span class=p>:</span>
</span><span id=__span-0-128><a id=__codelineno-0-128 name=__codelineno-0-128></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Verifies if a given public key belongs to a specified account ID using FastNEAR API.&quot;&quot;&quot;</span>
</span><span id=__span-0-129><a id=__codelineno-0-129 name=__codelineno-0-129></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-130><a id=__codelineno-0-130 name=__codelineno-0-130></a>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Verifying access key owner for public key: </span><span class=si>{</span><span class=n>public_key</span><span class=si>}</span><span class=s2>, account_id: </span><span class=si>{</span><span class=n>account_id</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-131><a id=__codelineno-0-131 name=__codelineno-0-131></a>        <span class=n>url</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;https://api.fastnear.com/v0/public_key/</span><span class=si>{</span><span class=n>public_key</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-132><a id=__codelineno-0-132 name=__codelineno-0-132></a>        <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>)</span>
</span><span id=__span-0-133><a id=__codelineno-0-133 name=__codelineno-0-133></a>        <span class=n>response</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
</span><span id=__span-0-134><a id=__codelineno-0-134 name=__codelineno-0-134></a>        <span class=n>content</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span><span id=__span-0-135><a id=__codelineno-0-135 name=__codelineno-0-135></a>        <span class=n>account_ids</span> <span class=o>=</span> <span class=n>content</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;account_ids&quot;</span><span class=p>,</span> <span class=p>[])</span>
</span><span id=__span-0-136><a id=__codelineno-0-136 name=__codelineno-0-136></a>        <span class=n>key_owner_verified</span> <span class=o>=</span> <span class=n>account_id</span> <span class=ow>in</span> <span class=n>account_ids</span>
</span><span id=__span-0-137><a id=__codelineno-0-137 name=__codelineno-0-137></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>key_owner_verified</span><span class=p>:</span>
</span><span id=__span-0-138><a id=__codelineno-0-138 name=__codelineno-0-138></a>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;Key&#39;s owner verification failed. Only NEAR Mainnet accounts are supported.&quot;</span><span class=p>)</span>
</span><span id=__span-0-139><a id=__codelineno-0-139 name=__codelineno-0-139></a>        <span class=k>return</span> <span class=n>SignatureVerificationResult</span><span class=o>.</span><span class=n>from_bool</span><span class=p>(</span><span class=n>key_owner_verified</span><span class=p>)</span>
</span><span id=__span-0-140><a id=__codelineno-0-140 name=__codelineno-0-140></a>    <span class=k>except</span> <span class=n>requests</span><span class=o>.</span><span class=n>exceptions</span><span class=o>.</span><span class=n>HTTPError</span> <span class=k>as</span> <span class=n>http_err</span><span class=p>:</span>
</span><span id=__span-0-141><a id=__codelineno-0-141 name=__codelineno-0-141></a>        <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;HTTP error occurred: </span><span class=si>{</span><span class=n>http_err</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-142><a id=__codelineno-0-142 name=__codelineno-0-142></a>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>err</span><span class=p>:</span>
</span><span id=__span-0-143><a id=__codelineno-0-143 name=__codelineno-0-143></a>        <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Other error occurred: </span><span class=si>{</span><span class=n>err</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-144><a id=__codelineno-0-144 name=__codelineno-0-144></a>
</span><span id=__span-0-145><a id=__codelineno-0-145 name=__codelineno-0-145></a>    <span class=k>return</span> <span class=n>SignatureVerificationResult</span><span class=o>.</span><span class=n>VERIFY_ACCESS_KEY_OWNER_SERVICE_NOT_AVAILABLE</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.near.sign.verify_signed_message class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">verify_signed_message</span> <a href=#nearai.shared.near.sign.verify_signed_message class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>verify_signed_message</span><span class=p>(</span><span class=n>account_id</span><span class=p>,</span> <span class=n>public_key</span><span class=p>,</span> <span class=n>signature</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=n>nonce</span><span class=p>,</span> <span class=n>recipient</span><span class=p>,</span> <span class=n>callback_url</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><a class="autorefs autorefs-internal" title=nearai.shared.near.sign.SignatureVerificationResult href=#nearai.shared.near.sign.SignatureVerificationResult>SignatureVerificationResult</a></span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Verifies a signed message and ensures the public key belongs to the specified account.</p> <details class=quote> <summary>Source code in <code>nearai/shared/near/sign.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-108>108</a></span>
<span class=normal><a href=#__codelineno-0-109>109</a></span>
<span class=normal><a href=#__codelineno-0-110>110</a></span>
<span class=normal><a href=#__codelineno-0-111>111</a></span>
<span class=normal><a href=#__codelineno-0-112>112</a></span>
<span class=normal><a href=#__codelineno-0-113>113</a></span>
<span class=normal><a href=#__codelineno-0-114>114</a></span>
<span class=normal><a href=#__codelineno-0-115>115</a></span>
<span class=normal><a href=#__codelineno-0-116>116</a></span>
<span class=normal><a href=#__codelineno-0-117>117</a></span>
<span class=normal><a href=#__codelineno-0-118>118</a></span>
<span class=normal><a href=#__codelineno-0-119>119</a></span>
<span class=normal><a href=#__codelineno-0-120>120</a></span>
<span class=normal><a href=#__codelineno-0-121>121</a></span>
<span class=normal><a href=#__codelineno-0-122>122</a></span>
<span class=normal><a href=#__codelineno-0-123>123</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-108><a id=__codelineno-0-108 name=__codelineno-0-108></a><span class=k>def</span><span class=w> </span><span class=nf>verify_signed_message</span><span class=p>(</span>
</span><span id=__span-0-109><a id=__codelineno-0-109 name=__codelineno-0-109></a>    <span class=n>account_id</span><span class=p>,</span> <span class=n>public_key</span><span class=p>,</span> <span class=n>signature</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=n>nonce</span><span class=p>,</span> <span class=n>recipient</span><span class=p>,</span> <span class=n>callback_url</span>
</span><span id=__span-0-110><a id=__codelineno-0-110 name=__codelineno-0-110></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>SignatureVerificationResult</span><span class=p>:</span>
</span><span id=__span-0-111><a id=__codelineno-0-111 name=__codelineno-0-111></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Verifies a signed message and ensures the public key belongs to the specified account.&quot;&quot;&quot;</span>
</span><span id=__span-0-112><a id=__codelineno-0-112 name=__codelineno-0-112></a>    <span class=n>is_valid</span> <span class=o>=</span> <span class=n>validate_signature</span><span class=p>(</span><span class=n>public_key</span><span class=p>,</span> <span class=n>signature</span><span class=p>,</span> <span class=n>Payload</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=n>nonce</span><span class=p>,</span> <span class=n>recipient</span><span class=p>,</span> <span class=n>callback_url</span><span class=p>))</span>
</span><span id=__span-0-113><a id=__codelineno-0-113 name=__codelineno-0-113></a>
</span><span id=__span-0-114><a id=__codelineno-0-114 name=__codelineno-0-114></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>is_valid</span> <span class=ow>and</span> <span class=n>callback_url</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-115><a id=__codelineno-0-115 name=__codelineno-0-115></a>        <span class=n>is_valid</span> <span class=o>=</span> <span class=n>validate_signature</span><span class=p>(</span><span class=n>public_key</span><span class=p>,</span> <span class=n>signature</span><span class=p>,</span> <span class=n>Payload</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=n>nonce</span><span class=p>,</span> <span class=n>recipient</span><span class=p>,</span> <span class=kc>None</span><span class=p>))</span>
</span><span id=__span-0-116><a id=__codelineno-0-116 name=__codelineno-0-116></a>
</span><span id=__span-0-117><a id=__codelineno-0-117 name=__codelineno-0-117></a>    <span class=k>if</span> <span class=n>is_valid</span><span class=p>:</span>
</span><span id=__span-0-118><a id=__codelineno-0-118 name=__codelineno-0-118></a>        <span class=c1># verify that key belongs to `account_id`</span>
</span><span id=__span-0-119><a id=__codelineno-0-119 name=__codelineno-0-119></a>        <span class=k>return</span> <span class=n>verify_access_key_owner</span><span class=p>(</span><span class=n>public_key</span><span class=p>,</span> <span class=n>account_id</span><span class=p>)</span>
</span><span id=__span-0-120><a id=__codelineno-0-120 name=__codelineno-0-120></a>
</span><span id=__span-0-121><a id=__codelineno-0-121 name=__codelineno-0-121></a>    <span class=c1># TODO verifies that key is a FULL ACCESS KEY</span>
</span><span id=__span-0-122><a id=__codelineno-0-122 name=__codelineno-0-122></a>
</span><span id=__span-0-123><a id=__codelineno-0-123 name=__codelineno-0-123></a>    <span class=k>return</span> <span class=n>SignatureVerificationResult</span><span class=o>.</span><span class=n>FALSE</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> </div> </div> </div> <div class="doc doc-object doc-module"> <h4 id=nearai.shared.provider_models class="doc doc-heading"> <span class="doc doc-object-name doc-module-name">provider_models</span> <a href=#nearai.shared.provider_models class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h5 id=nearai.shared.provider_models.ProviderModels class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">ProviderModels</span> <a href=#nearai.shared.provider_models.ProviderModels class=headerlink title="Permanent link">&para;</a></h5> <div class="doc doc-contents "> <details class=quote> <summary>Source code in <code>nearai/shared/provider_models.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-55> 55</a></span>
<span class=normal><a href=#__codelineno-0-56> 56</a></span>
<span class=normal><a href=#__codelineno-0-57> 57</a></span>
<span class=normal><a href=#__codelineno-0-58> 58</a></span>
<span class=normal><a href=#__codelineno-0-59> 59</a></span>
<span class=normal><a href=#__codelineno-0-60> 60</a></span>
<span class=normal><a href=#__codelineno-0-61> 61</a></span>
<span class=normal><a href=#__codelineno-0-62> 62</a></span>
<span class=normal><a href=#__codelineno-0-63> 63</a></span>
<span class=normal><a href=#__codelineno-0-64> 64</a></span>
<span class=normal><a href=#__codelineno-0-65> 65</a></span>
<span class=normal><a href=#__codelineno-0-66> 66</a></span>
<span class=normal><a href=#__codelineno-0-67> 67</a></span>
<span class=normal><a href=#__codelineno-0-68> 68</a></span>
<span class=normal><a href=#__codelineno-0-69> 69</a></span>
<span class=normal><a href=#__codelineno-0-70> 70</a></span>
<span class=normal><a href=#__codelineno-0-71> 71</a></span>
<span class=normal><a href=#__codelineno-0-72> 72</a></span>
<span class=normal><a href=#__codelineno-0-73> 73</a></span>
<span class=normal><a href=#__codelineno-0-74> 74</a></span>
<span class=normal><a href=#__codelineno-0-75> 75</a></span>
<span class=normal><a href=#__codelineno-0-76> 76</a></span>
<span class=normal><a href=#__codelineno-0-77> 77</a></span>
<span class=normal><a href=#__codelineno-0-78> 78</a></span>
<span class=normal><a href=#__codelineno-0-79> 79</a></span>
<span class=normal><a href=#__codelineno-0-80> 80</a></span>
<span class=normal><a href=#__codelineno-0-81> 81</a></span>
<span class=normal><a href=#__codelineno-0-82> 82</a></span>
<span class=normal><a href=#__codelineno-0-83> 83</a></span>
<span class=normal><a href=#__codelineno-0-84> 84</a></span>
<span class=normal><a href=#__codelineno-0-85> 85</a></span>
<span class=normal><a href=#__codelineno-0-86> 86</a></span>
<span class=normal><a href=#__codelineno-0-87> 87</a></span>
<span class=normal><a href=#__codelineno-0-88> 88</a></span>
<span class=normal><a href=#__codelineno-0-89> 89</a></span>
<span class=normal><a href=#__codelineno-0-90> 90</a></span>
<span class=normal><a href=#__codelineno-0-91> 91</a></span>
<span class=normal><a href=#__codelineno-0-92> 92</a></span>
<span class=normal><a href=#__codelineno-0-93> 93</a></span>
<span class=normal><a href=#__codelineno-0-94> 94</a></span>
<span class=normal><a href=#__codelineno-0-95> 95</a></span>
<span class=normal><a href=#__codelineno-0-96> 96</a></span>
<span class=normal><a href=#__codelineno-0-97> 97</a></span>
<span class=normal><a href=#__codelineno-0-98> 98</a></span>
<span class=normal><a href=#__codelineno-0-99> 99</a></span>
<span class=normal><a href=#__codelineno-0-100>100</a></span>
<span class=normal><a href=#__codelineno-0-101>101</a></span>
<span class=normal><a href=#__codelineno-0-102>102</a></span>
<span class=normal><a href=#__codelineno-0-103>103</a></span>
<span class=normal><a href=#__codelineno-0-104>104</a></span>
<span class=normal><a href=#__codelineno-0-105>105</a></span>
<span class=normal><a href=#__codelineno-0-106>106</a></span>
<span class=normal><a href=#__codelineno-0-107>107</a></span>
<span class=normal><a href=#__codelineno-0-108>108</a></span>
<span class=normal><a href=#__codelineno-0-109>109</a></span>
<span class=normal><a href=#__codelineno-0-110>110</a></span>
<span class=normal><a href=#__codelineno-0-111>111</a></span>
<span class=normal><a href=#__codelineno-0-112>112</a></span>
<span class=normal><a href=#__codelineno-0-113>113</a></span>
<span class=normal><a href=#__codelineno-0-114>114</a></span>
<span class=normal><a href=#__codelineno-0-115>115</a></span>
<span class=normal><a href=#__codelineno-0-116>116</a></span>
<span class=normal><a href=#__codelineno-0-117>117</a></span>
<span class=normal><a href=#__codelineno-0-118>118</a></span>
<span class=normal><a href=#__codelineno-0-119>119</a></span>
<span class=normal><a href=#__codelineno-0-120>120</a></span>
<span class=normal><a href=#__codelineno-0-121>121</a></span>
<span class=normal><a href=#__codelineno-0-122>122</a></span>
<span class=normal><a href=#__codelineno-0-123>123</a></span>
<span class=normal><a href=#__codelineno-0-124>124</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-55><a id=__codelineno-0-55 name=__codelineno-0-55></a><span class=k>class</span><span class=w> </span><span class=nc>ProviderModels</span><span class=p>:</span>
</span><span id=__span-0-56><a id=__codelineno-0-56 name=__codelineno-0-56></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>config</span><span class=p>:</span> <span class=n>ClientConfig</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>  <span class=c1># noqa: D107</span>
</span><span id=__span-0-57><a id=__codelineno-0-57 name=__codelineno-0-57></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_config</span> <span class=o>=</span> <span class=n>config</span>
</span><span id=__span-0-58><a id=__codelineno-0-58 name=__codelineno-0-58></a>
</span><span id=__span-0-59><a id=__codelineno-0-59 name=__codelineno-0-59></a>    <span class=nd>@cached_property</span>
</span><span id=__span-0-60><a id=__codelineno-0-60 name=__codelineno-0-60></a>    <span class=k>def</span><span class=w> </span><span class=nf>provider_models</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=n>NamespacedName</span><span class=p>,</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]]:</span>
</span><span id=__span-0-61><a id=__codelineno-0-61 name=__codelineno-0-61></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns a mapping canonical-&gt;provider-&gt;model_full_name.&quot;&quot;&quot;</span>
</span><span id=__span-0-62><a id=__codelineno-0-62 name=__codelineno-0-62></a>        <span class=n>client</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_config</span><span class=o>.</span><span class=n>get_hub_client</span><span class=p>()</span>
</span><span id=__span-0-63><a id=__codelineno-0-63 name=__codelineno-0-63></a>
</span><span id=__span-0-64><a id=__codelineno-0-64 name=__codelineno-0-64></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-65><a id=__codelineno-0-65 name=__codelineno-0-65></a>            <span class=n>models</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>models</span><span class=o>.</span><span class=n>list</span><span class=p>()</span>
</span><span id=__span-0-66><a id=__codelineno-0-66 name=__codelineno-0-66></a>
</span><span id=__span-0-67><a id=__codelineno-0-67 name=__codelineno-0-67></a>            <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>data</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>,</span> <span class=s2>&quot;No models found&quot;</span>
</span><span id=__span-0-68><a id=__codelineno-0-68 name=__codelineno-0-68></a>            <span class=n>result</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=n>NamespacedName</span><span class=p>,</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]]</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-0-69><a id=__codelineno-0-69 name=__codelineno-0-69></a>            <span class=k>for</span> <span class=n>model</span> <span class=ow>in</span> <span class=n>models</span><span class=o>.</span><span class=n>data</span><span class=p>:</span>
</span><span id=__span-0-70><a id=__codelineno-0-70 name=__codelineno-0-70></a>                <span class=n>provider</span><span class=p>,</span> <span class=n>namespaced_model</span> <span class=o>=</span> <span class=n>get_provider_namespaced_model</span><span class=p>(</span><span class=n>model</span><span class=o>.</span><span class=n>id</span><span class=p>)</span>
</span><span id=__span-0-71><a id=__codelineno-0-71 name=__codelineno-0-71></a>                <span class=n>namespaced_model</span> <span class=o>=</span> <span class=n>namespaced_model</span><span class=o>.</span><span class=n>canonical</span><span class=p>()</span>
</span><span id=__span-0-72><a id=__codelineno-0-72 name=__codelineno-0-72></a>                <span class=k>if</span> <span class=n>namespaced_model</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>result</span><span class=p>:</span>
</span><span id=__span-0-73><a id=__codelineno-0-73 name=__codelineno-0-73></a>                    <span class=n>result</span><span class=p>[</span><span class=n>namespaced_model</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-0-74><a id=__codelineno-0-74 name=__codelineno-0-74></a>                <span class=k>if</span> <span class=n>provider</span> <span class=ow>in</span> <span class=n>result</span><span class=p>[</span><span class=n>namespaced_model</span><span class=p>]:</span>
</span><span id=__span-0-75><a id=__codelineno-0-75 name=__codelineno-0-75></a>                    <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Duplicate entry for provider </span><span class=si>{</span><span class=n>provider</span><span class=si>}</span><span class=s2> and model </span><span class=si>{</span><span class=n>namespaced_model</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-76><a id=__codelineno-0-76 name=__codelineno-0-76></a>                <span class=n>result</span><span class=p>[</span><span class=n>namespaced_model</span><span class=p>][</span><span class=n>provider</span><span class=p>]</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>id</span>
</span><span id=__span-0-77><a id=__codelineno-0-77 name=__codelineno-0-77></a>
</span><span id=__span-0-78><a id=__codelineno-0-78 name=__codelineno-0-78></a>            <span class=k>return</span> <span class=n>result</span>
</span><span id=__span-0-79><a id=__codelineno-0-79 name=__codelineno-0-79></a>
</span><span id=__span-0-80><a id=__codelineno-0-80 name=__codelineno-0-80></a>        <span class=k>except</span> <span class=n>requests</span><span class=o>.</span><span class=n>RequestException</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-81><a id=__codelineno-0-81 name=__codelineno-0-81></a>            <span class=k>raise</span> <span class=ne>RuntimeError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error fetching models: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span> <span class=kn>from</span><span class=w> </span><span class=nn>e</span>
</span><span id=__span-0-82><a id=__codelineno-0-82 name=__codelineno-0-82></a>
</span><span id=__span-0-83><a id=__codelineno-0-83 name=__codelineno-0-83></a>    <span class=k>def</span><span class=w> </span><span class=nf>available_provider_matches</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>model</span><span class=p>:</span> <span class=n>NamespacedName</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]:</span>
</span><span id=__span-0-84><a id=__codelineno-0-84 name=__codelineno-0-84></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns provider matches for `model`.&quot;&quot;&quot;</span>
</span><span id=__span-0-85><a id=__codelineno-0-85 name=__codelineno-0-85></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>provider_models</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>model</span><span class=o>.</span><span class=n>canonical</span><span class=p>(),</span> <span class=p>{})</span>
</span><span id=__span-0-86><a id=__codelineno-0-86 name=__codelineno-0-86></a>
</span><span id=__span-0-87><a id=__codelineno-0-87 name=__codelineno-0-87></a>    <span class=k>def</span><span class=w> </span><span class=nf>match_provider_model</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>model</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>provider</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]:</span>
</span><span id=__span-0-88><a id=__codelineno-0-88 name=__codelineno-0-88></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns provider and model_full_path for given `model` and optional `provider`.</span>
</span><span id=__span-0-89><a id=__codelineno-0-89 name=__codelineno-0-89></a>
</span><span id=__span-0-90><a id=__codelineno-0-90 name=__codelineno-0-90></a><span class=sd>        `model` may take different formats. Supported ones:</span>
</span><span id=__span-0-91><a id=__codelineno-0-91 name=__codelineno-0-91></a><span class=sd>        1. model_full_path, e.g. &quot;fireworks::accounts/yi-01-ai/models/yi-large&quot;</span>
</span><span id=__span-0-92><a id=__codelineno-0-92 name=__codelineno-0-92></a><span class=sd>        2. model_full_path without provider, e.g. &quot;accounts/yi-01-ai/models/yi-large&quot;</span>
</span><span id=__span-0-93><a id=__codelineno-0-93 name=__codelineno-0-93></a><span class=sd>        3. model_short_name as used by provider, e.g. &quot;llama-v3-70b-instruct&quot;</span>
</span><span id=__span-0-94><a id=__codelineno-0-94 name=__codelineno-0-94></a><span class=sd>        4. namespace/model_short_name as used by provider, e.g. &quot;yi-01-ai/yi-large&quot;</span>
</span><span id=__span-0-95><a id=__codelineno-0-95 name=__codelineno-0-95></a><span class=sd>        5. model_name as used in registry, e.g. &quot;llama-3-70b-instruct&quot;</span>
</span><span id=__span-0-96><a id=__codelineno-0-96 name=__codelineno-0-96></a><span class=sd>        6. namespace/model_name as used in registry, e.g. &quot;near.ai/llama-3-70b-instruct&quot;</span>
</span><span id=__span-0-97><a id=__codelineno-0-97 name=__codelineno-0-97></a><span class=sd>        &quot;&quot;&quot;</span>
</span><span id=__span-0-98><a id=__codelineno-0-98 name=__codelineno-0-98></a>        <span class=k>if</span> <span class=n>provider</span> <span class=o>==</span> <span class=s2>&quot;&quot;</span><span class=p>:</span>
</span><span id=__span-0-99><a id=__codelineno-0-99 name=__codelineno-0-99></a>            <span class=n>provider</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-100><a id=__codelineno-0-100 name=__codelineno-0-100></a>        <span class=n>matched_provider</span><span class=p>,</span> <span class=n>namespaced_model</span> <span class=o>=</span> <span class=n>get_provider_namespaced_model</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>provider</span><span class=p>)</span>
</span><span id=__span-0-101><a id=__codelineno-0-101 name=__codelineno-0-101></a>        <span class=n>namespaced_model</span> <span class=o>=</span> <span class=n>namespaced_model</span><span class=o>.</span><span class=n>canonical</span><span class=p>()</span>
</span><span id=__span-0-102><a id=__codelineno-0-102 name=__codelineno-0-102></a>        <span class=k>if</span> <span class=n>namespaced_model</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>provider_models</span><span class=p>:</span>
</span><span id=__span-0-103><a id=__codelineno-0-103 name=__codelineno-0-103></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Model </span><span class=si>{</span><span class=n>namespaced_model</span><span class=si>}</span><span class=s2> not present in provider models </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>provider_models</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-104><a id=__codelineno-0-104 name=__codelineno-0-104></a>        <span class=n>available_matches</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>provider_models</span><span class=p>[</span><span class=n>namespaced_model</span><span class=p>]</span>
</span><span id=__span-0-105><a id=__codelineno-0-105 name=__codelineno-0-105></a>        <span class=k>if</span> <span class=n>matched_provider</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>available_matches</span><span class=p>:</span>
</span><span id=__span-0-106><a id=__codelineno-0-106 name=__codelineno-0-106></a>            <span class=k>for</span> <span class=n>match</span> <span class=ow>in</span> <span class=n>available_matches</span><span class=o>.</span><span class=n>keys</span><span class=p>():</span>
</span><span id=__span-0-107><a id=__codelineno-0-107 name=__codelineno-0-107></a>                <span class=n>matched_provider</span> <span class=o>=</span> <span class=n>match</span>
</span><span id=__span-0-108><a id=__codelineno-0-108 name=__codelineno-0-108></a>                <span class=k>break</span>
</span><span id=__span-0-109><a id=__codelineno-0-109 name=__codelineno-0-109></a>        <span class=k>if</span> <span class=n>provider</span> <span class=ow>and</span> <span class=n>provider</span> <span class=o>!=</span> <span class=n>matched_provider</span><span class=p>:</span>
</span><span id=__span-0-110><a id=__codelineno-0-110 name=__codelineno-0-110></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
</span><span id=__span-0-111><a id=__codelineno-0-111 name=__codelineno-0-111></a>                <span class=sa>f</span><span class=s2>&quot;Requested provider </span><span class=si>{</span><span class=n>provider</span><span class=si>}</span><span class=s2> for model </span><span class=si>{</span><span class=n>model</span><span class=si>}</span><span class=s2> does not match matched_provider </span><span class=si>{</span><span class=n>matched_provider</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-112><a id=__codelineno-0-112 name=__codelineno-0-112></a>            <span class=p>)</span>
</span><span id=__span-0-113><a id=__codelineno-0-113 name=__codelineno-0-113></a>        <span class=k>return</span> <span class=n>matched_provider</span><span class=p>,</span> <span class=n>available_matches</span><span class=p>[</span><span class=n>matched_provider</span><span class=p>]</span>
</span><span id=__span-0-114><a id=__codelineno-0-114 name=__codelineno-0-114></a>
</span><span id=__span-0-115><a id=__codelineno-0-115 name=__codelineno-0-115></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_unregistered_common_provider_models</span><span class=p>(</span>
</span><span id=__span-0-116><a id=__codelineno-0-116 name=__codelineno-0-116></a>        <span class=bp>self</span><span class=p>,</span> <span class=n>registry_models</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=n>NamespacedName</span><span class=p>,</span> <span class=n>NamespacedName</span><span class=p>]</span>
</span><span id=__span-0-117><a id=__codelineno-0-117 name=__codelineno-0-117></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]]:</span>
</span><span id=__span-0-118><a id=__codelineno-0-118 name=__codelineno-0-118></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns provider matches for unregistered provider models with default namespace.&quot;&quot;&quot;</span>
</span><span id=__span-0-119><a id=__codelineno-0-119 name=__codelineno-0-119></a>        <span class=n>result</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]]</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-0-120><a id=__codelineno-0-120 name=__codelineno-0-120></a>        <span class=k>for</span> <span class=n>namespaced_name</span><span class=p>,</span> <span class=n>available_matches</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>provider_models</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span><span id=__span-0-121><a id=__codelineno-0-121 name=__codelineno-0-121></a>            <span class=k>if</span> <span class=n>namespaced_name</span><span class=o>.</span><span class=n>namespace</span> <span class=o>!=</span> <span class=s2>&quot;&quot;</span> <span class=ow>or</span> <span class=n>namespaced_name</span> <span class=ow>in</span> <span class=n>registry_models</span><span class=p>:</span>
</span><span id=__span-0-122><a id=__codelineno-0-122 name=__codelineno-0-122></a>                <span class=k>continue</span>
</span><span id=__span-0-123><a id=__codelineno-0-123 name=__codelineno-0-123></a>            <span class=n>result</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>available_matches</span><span class=p>)</span>
</span><span id=__span-0-124><a id=__codelineno-0-124 name=__codelineno-0-124></a>        <span class=k>return</span> <span class=n>result</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-attribute"> <h6 id=nearai.shared.provider_models.ProviderModels.provider_models class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">provider_models</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-cached"><code>cached</code></small> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> <a href=#nearai.shared.provider_models.ProviderModels.provider_models class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=n>provider_models</span><span class=p>:</span> <span class=n><span title=typing.Dict>Dict</span></span><span class=p>[</span><span class=n><a class="autorefs autorefs-internal" title=nearai.shared.naming.NamespacedName href=#nearai.shared.naming.NamespacedName>NamespacedName</a></span><span class=p>,</span> <span class=n><span title=typing.Dict>Dict</span></span><span class=p>[</span><span class=n>str</span><span class=p>,</span> <span class=n>str</span><span class=p>]]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Returns a mapping canonical-&gt;provider-&gt;model_full_name.</p> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.provider_models.ProviderModels.available_provider_matches class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">available_provider_matches</span> <a href=#nearai.shared.provider_models.ProviderModels.available_provider_matches class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>available_provider_matches</span><span class=p>(</span><span class=n>model</span><span class=p>:</span> <span class=n><a class="autorefs autorefs-internal" title=nearai.shared.naming.NamespacedName href=#nearai.shared.naming.NamespacedName>NamespacedName</a></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=typing.Dict>Dict</span></span><span class=p>[</span><span class=n>str</span><span class=p>,</span> <span class=n>str</span><span class=p>]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Returns provider matches for <code>model</code>.</p> <details class=quote> <summary>Source code in <code>nearai/shared/provider_models.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-83>83</a></span>
<span class=normal><a href=#__codelineno-0-84>84</a></span>
<span class=normal><a href=#__codelineno-0-85>85</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-83><a id=__codelineno-0-83 name=__codelineno-0-83></a><span class=k>def</span><span class=w> </span><span class=nf>available_provider_matches</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>model</span><span class=p>:</span> <span class=n>NamespacedName</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]:</span>
</span><span id=__span-0-84><a id=__codelineno-0-84 name=__codelineno-0-84></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns provider matches for `model`.&quot;&quot;&quot;</span>
</span><span id=__span-0-85><a id=__codelineno-0-85 name=__codelineno-0-85></a>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>provider_models</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>model</span><span class=o>.</span><span class=n>canonical</span><span class=p>(),</span> <span class=p>{})</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.provider_models.ProviderModels.get_unregistered_common_provider_models class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_unregistered_common_provider_models</span> <a href=#nearai.shared.provider_models.ProviderModels.get_unregistered_common_provider_models class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>get_unregistered_common_provider_models</span><span class=p>(</span><span class=n>registry_models</span><span class=p>:</span> <span class=n><span title=typing.Dict>Dict</span></span><span class=p>[</span><span class=n><a class="autorefs autorefs-internal" title=nearai.shared.naming.NamespacedName href=#nearai.shared.naming.NamespacedName>NamespacedName</a></span><span class=p>,</span> <span class=n><a class="autorefs autorefs-internal" title=nearai.shared.naming.NamespacedName href=#nearai.shared.naming.NamespacedName>NamespacedName</a></span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n><span title=typing.List>List</span></span><span class=p>[</span><span class=n><span title=typing.Dict>Dict</span></span><span class=p>[</span><span class=n>str</span><span class=p>,</span> <span class=n>str</span><span class=p>]]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Returns provider matches for unregistered provider models with default namespace.</p> <details class=quote> <summary>Source code in <code>nearai/shared/provider_models.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-115>115</a></span>
<span class=normal><a href=#__codelineno-0-116>116</a></span>
<span class=normal><a href=#__codelineno-0-117>117</a></span>
<span class=normal><a href=#__codelineno-0-118>118</a></span>
<span class=normal><a href=#__codelineno-0-119>119</a></span>
<span class=normal><a href=#__codelineno-0-120>120</a></span>
<span class=normal><a href=#__codelineno-0-121>121</a></span>
<span class=normal><a href=#__codelineno-0-122>122</a></span>
<span class=normal><a href=#__codelineno-0-123>123</a></span>
<span class=normal><a href=#__codelineno-0-124>124</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-115><a id=__codelineno-0-115 name=__codelineno-0-115></a><span class=k>def</span><span class=w> </span><span class=nf>get_unregistered_common_provider_models</span><span class=p>(</span>
</span><span id=__span-0-116><a id=__codelineno-0-116 name=__codelineno-0-116></a>    <span class=bp>self</span><span class=p>,</span> <span class=n>registry_models</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=n>NamespacedName</span><span class=p>,</span> <span class=n>NamespacedName</span><span class=p>]</span>
</span><span id=__span-0-117><a id=__codelineno-0-117 name=__codelineno-0-117></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]]:</span>
</span><span id=__span-0-118><a id=__codelineno-0-118 name=__codelineno-0-118></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns provider matches for unregistered provider models with default namespace.&quot;&quot;&quot;</span>
</span><span id=__span-0-119><a id=__codelineno-0-119 name=__codelineno-0-119></a>    <span class=n>result</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]]</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-0-120><a id=__codelineno-0-120 name=__codelineno-0-120></a>    <span class=k>for</span> <span class=n>namespaced_name</span><span class=p>,</span> <span class=n>available_matches</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>provider_models</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span><span id=__span-0-121><a id=__codelineno-0-121 name=__codelineno-0-121></a>        <span class=k>if</span> <span class=n>namespaced_name</span><span class=o>.</span><span class=n>namespace</span> <span class=o>!=</span> <span class=s2>&quot;&quot;</span> <span class=ow>or</span> <span class=n>namespaced_name</span> <span class=ow>in</span> <span class=n>registry_models</span><span class=p>:</span>
</span><span id=__span-0-122><a id=__codelineno-0-122 name=__codelineno-0-122></a>            <span class=k>continue</span>
</span><span id=__span-0-123><a id=__codelineno-0-123 name=__codelineno-0-123></a>        <span class=n>result</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>available_matches</span><span class=p>)</span>
</span><span id=__span-0-124><a id=__codelineno-0-124 name=__codelineno-0-124></a>    <span class=k>return</span> <span class=n>result</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h6 id=nearai.shared.provider_models.ProviderModels.match_provider_model class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">match_provider_model</span> <a href=#nearai.shared.provider_models.ProviderModels.match_provider_model class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>match_provider_model</span><span class=p>(</span><span class=n>model</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>provider</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=typing.Tuple>Tuple</span></span><span class=p>[</span><span class=n>str</span><span class=p>,</span> <span class=n>str</span><span class=p>]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Returns provider and model_full_path for given <code>model</code> and optional <code>provider</code>.</p> <p><code>model</code> may take different formats. Supported ones: 1. model_full_path, e.g. "fireworks::accounts/yi-01-ai/models/yi-large" 2. model_full_path without provider, e.g. "accounts/yi-01-ai/models/yi-large" 3. model_short_name as used by provider, e.g. "llama-v3-70b-instruct" 4. namespace/model_short_name as used by provider, e.g. "yi-01-ai/yi-large" 5. model_name as used in registry, e.g. "llama-3-70b-instruct" 6. namespace/model_name as used in registry, e.g. "near.ai/llama-3-70b-instruct"</p> <details class=quote> <summary>Source code in <code>nearai/shared/provider_models.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-87> 87</a></span>
<span class=normal><a href=#__codelineno-0-88> 88</a></span>
<span class=normal><a href=#__codelineno-0-89> 89</a></span>
<span class=normal><a href=#__codelineno-0-90> 90</a></span>
<span class=normal><a href=#__codelineno-0-91> 91</a></span>
<span class=normal><a href=#__codelineno-0-92> 92</a></span>
<span class=normal><a href=#__codelineno-0-93> 93</a></span>
<span class=normal><a href=#__codelineno-0-94> 94</a></span>
<span class=normal><a href=#__codelineno-0-95> 95</a></span>
<span class=normal><a href=#__codelineno-0-96> 96</a></span>
<span class=normal><a href=#__codelineno-0-97> 97</a></span>
<span class=normal><a href=#__codelineno-0-98> 98</a></span>
<span class=normal><a href=#__codelineno-0-99> 99</a></span>
<span class=normal><a href=#__codelineno-0-100>100</a></span>
<span class=normal><a href=#__codelineno-0-101>101</a></span>
<span class=normal><a href=#__codelineno-0-102>102</a></span>
<span class=normal><a href=#__codelineno-0-103>103</a></span>
<span class=normal><a href=#__codelineno-0-104>104</a></span>
<span class=normal><a href=#__codelineno-0-105>105</a></span>
<span class=normal><a href=#__codelineno-0-106>106</a></span>
<span class=normal><a href=#__codelineno-0-107>107</a></span>
<span class=normal><a href=#__codelineno-0-108>108</a></span>
<span class=normal><a href=#__codelineno-0-109>109</a></span>
<span class=normal><a href=#__codelineno-0-110>110</a></span>
<span class=normal><a href=#__codelineno-0-111>111</a></span>
<span class=normal><a href=#__codelineno-0-112>112</a></span>
<span class=normal><a href=#__codelineno-0-113>113</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-87><a id=__codelineno-0-87 name=__codelineno-0-87></a><span class=k>def</span><span class=w> </span><span class=nf>match_provider_model</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>model</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>provider</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>str</span><span class=p>]:</span>
</span><span id=__span-0-88><a id=__codelineno-0-88 name=__codelineno-0-88></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns provider and model_full_path for given `model` and optional `provider`.</span>
</span><span id=__span-0-89><a id=__codelineno-0-89 name=__codelineno-0-89></a>
</span><span id=__span-0-90><a id=__codelineno-0-90 name=__codelineno-0-90></a><span class=sd>    `model` may take different formats. Supported ones:</span>
</span><span id=__span-0-91><a id=__codelineno-0-91 name=__codelineno-0-91></a><span class=sd>    1. model_full_path, e.g. &quot;fireworks::accounts/yi-01-ai/models/yi-large&quot;</span>
</span><span id=__span-0-92><a id=__codelineno-0-92 name=__codelineno-0-92></a><span class=sd>    2. model_full_path without provider, e.g. &quot;accounts/yi-01-ai/models/yi-large&quot;</span>
</span><span id=__span-0-93><a id=__codelineno-0-93 name=__codelineno-0-93></a><span class=sd>    3. model_short_name as used by provider, e.g. &quot;llama-v3-70b-instruct&quot;</span>
</span><span id=__span-0-94><a id=__codelineno-0-94 name=__codelineno-0-94></a><span class=sd>    4. namespace/model_short_name as used by provider, e.g. &quot;yi-01-ai/yi-large&quot;</span>
</span><span id=__span-0-95><a id=__codelineno-0-95 name=__codelineno-0-95></a><span class=sd>    5. model_name as used in registry, e.g. &quot;llama-3-70b-instruct&quot;</span>
</span><span id=__span-0-96><a id=__codelineno-0-96 name=__codelineno-0-96></a><span class=sd>    6. namespace/model_name as used in registry, e.g. &quot;near.ai/llama-3-70b-instruct&quot;</span>
</span><span id=__span-0-97><a id=__codelineno-0-97 name=__codelineno-0-97></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-98><a id=__codelineno-0-98 name=__codelineno-0-98></a>    <span class=k>if</span> <span class=n>provider</span> <span class=o>==</span> <span class=s2>&quot;&quot;</span><span class=p>:</span>
</span><span id=__span-0-99><a id=__codelineno-0-99 name=__codelineno-0-99></a>        <span class=n>provider</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-0-100><a id=__codelineno-0-100 name=__codelineno-0-100></a>    <span class=n>matched_provider</span><span class=p>,</span> <span class=n>namespaced_model</span> <span class=o>=</span> <span class=n>get_provider_namespaced_model</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>provider</span><span class=p>)</span>
</span><span id=__span-0-101><a id=__codelineno-0-101 name=__codelineno-0-101></a>    <span class=n>namespaced_model</span> <span class=o>=</span> <span class=n>namespaced_model</span><span class=o>.</span><span class=n>canonical</span><span class=p>()</span>
</span><span id=__span-0-102><a id=__codelineno-0-102 name=__codelineno-0-102></a>    <span class=k>if</span> <span class=n>namespaced_model</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>provider_models</span><span class=p>:</span>
</span><span id=__span-0-103><a id=__codelineno-0-103 name=__codelineno-0-103></a>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Model </span><span class=si>{</span><span class=n>namespaced_model</span><span class=si>}</span><span class=s2> not present in provider models </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>provider_models</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-104><a id=__codelineno-0-104 name=__codelineno-0-104></a>    <span class=n>available_matches</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>provider_models</span><span class=p>[</span><span class=n>namespaced_model</span><span class=p>]</span>
</span><span id=__span-0-105><a id=__codelineno-0-105 name=__codelineno-0-105></a>    <span class=k>if</span> <span class=n>matched_provider</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>available_matches</span><span class=p>:</span>
</span><span id=__span-0-106><a id=__codelineno-0-106 name=__codelineno-0-106></a>        <span class=k>for</span> <span class=n>match</span> <span class=ow>in</span> <span class=n>available_matches</span><span class=o>.</span><span class=n>keys</span><span class=p>():</span>
</span><span id=__span-0-107><a id=__codelineno-0-107 name=__codelineno-0-107></a>            <span class=n>matched_provider</span> <span class=o>=</span> <span class=n>match</span>
</span><span id=__span-0-108><a id=__codelineno-0-108 name=__codelineno-0-108></a>            <span class=k>break</span>
</span><span id=__span-0-109><a id=__codelineno-0-109 name=__codelineno-0-109></a>    <span class=k>if</span> <span class=n>provider</span> <span class=ow>and</span> <span class=n>provider</span> <span class=o>!=</span> <span class=n>matched_provider</span><span class=p>:</span>
</span><span id=__span-0-110><a id=__codelineno-0-110 name=__codelineno-0-110></a>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
</span><span id=__span-0-111><a id=__codelineno-0-111 name=__codelineno-0-111></a>            <span class=sa>f</span><span class=s2>&quot;Requested provider </span><span class=si>{</span><span class=n>provider</span><span class=si>}</span><span class=s2> for model </span><span class=si>{</span><span class=n>model</span><span class=si>}</span><span class=s2> does not match matched_provider </span><span class=si>{</span><span class=n>matched_provider</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-112><a id=__codelineno-0-112 name=__codelineno-0-112></a>        <span class=p>)</span>
</span><span id=__span-0-113><a id=__codelineno-0-113 name=__codelineno-0-113></a>    <span class=k>return</span> <span class=n>matched_provider</span><span class=p>,</span> <span class=n>available_matches</span><span class=p>[</span><span class=n>matched_provider</span><span class=p>]</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.shared.provider_models.get_provider_model class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_provider_model</span> <a href=#nearai.shared.provider_models.get_provider_model class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>get_provider_model</span><span class=p>(</span><span class=n>provider</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>str</span><span class=p>],</span> <span class=n>model</span><span class=p>:</span> <span class=n>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=typing.Tuple>Tuple</span></span><span class=p>[</span><span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>str</span><span class=p>],</span> <span class=n>str</span><span class=p>]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Splits the <code>model</code> string based on a predefined separator and returns the components.</p> <hr> <div class="language-text highlight"><pre><span></span><code>provider (Optional[str]): The default provider name. Can be `None` if the provider
                          is included in the `model` string.
model (str): The model identifier, which may include the provider name separated by
             a specific delimiter (defined by `PROVIDER_MODEL_SEP`, e.g. `::`).
</code></pre></div> <details class=quote> <summary>Source code in <code>nearai/shared/provider_models.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-13>13</a></span>
<span class=normal><a href=#__codelineno-0-14>14</a></span>
<span class=normal><a href=#__codelineno-0-15>15</a></span>
<span class=normal><a href=#__codelineno-0-16>16</a></span>
<span class=normal><a href=#__codelineno-0-17>17</a></span>
<span class=normal><a href=#__codelineno-0-18>18</a></span>
<span class=normal><a href=#__codelineno-0-19>19</a></span>
<span class=normal><a href=#__codelineno-0-20>20</a></span>
<span class=normal><a href=#__codelineno-0-21>21</a></span>
<span class=normal><a href=#__codelineno-0-22>22</a></span>
<span class=normal><a href=#__codelineno-0-23>23</a></span>
<span class=normal><a href=#__codelineno-0-24>24</a></span>
<span class=normal><a href=#__codelineno-0-25>25</a></span>
<span class=normal><a href=#__codelineno-0-26>26</a></span>
<span class=normal><a href=#__codelineno-0-27>27</a></span>
<span class=normal><a href=#__codelineno-0-28>28</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13></a><span class=k>def</span><span class=w> </span><span class=nf>get_provider_model</span><span class=p>(</span><span class=n>provider</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>],</span> <span class=n>model</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>],</span> <span class=nb>str</span><span class=p>]:</span>
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Splits the `model` string based on a predefined separator and returns the components.</span>
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15></a>
</span><span id=__span-0-16><a id=__codelineno-0-16 name=__codelineno-0-16></a><span class=sd>    Args:</span>
</span><span id=__span-0-17><a id=__codelineno-0-17 name=__codelineno-0-17></a><span class=sd>    ----</span>
</span><span id=__span-0-18><a id=__codelineno-0-18 name=__codelineno-0-18></a><span class=sd>        provider (Optional[str]): The default provider name. Can be `None` if the provider</span>
</span><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19></a><span class=sd>                                  is included in the `model` string.</span>
</span><span id=__span-0-20><a id=__codelineno-0-20 name=__codelineno-0-20></a><span class=sd>        model (str): The model identifier, which may include the provider name separated by</span>
</span><span id=__span-0-21><a id=__codelineno-0-21 name=__codelineno-0-21></a><span class=sd>                     a specific delimiter (defined by `PROVIDER_MODEL_SEP`, e.g. `::`).</span>
</span><span id=__span-0-22><a id=__codelineno-0-22 name=__codelineno-0-22></a>
</span><span id=__span-0-23><a id=__codelineno-0-23 name=__codelineno-0-23></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-24><a id=__codelineno-0-24 name=__codelineno-0-24></a>    <span class=k>if</span> <span class=n>PROVIDER_MODEL_SEP</span> <span class=ow>in</span> <span class=n>model</span><span class=p>:</span>
</span><span id=__span-0-25><a id=__codelineno-0-25 name=__codelineno-0-25></a>        <span class=n>parts</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=n>PROVIDER_MODEL_SEP</span><span class=p>)</span>
</span><span id=__span-0-26><a id=__codelineno-0-26 name=__codelineno-0-26></a>        <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>parts</span><span class=p>)</span> <span class=o>==</span> <span class=mi>2</span>
</span><span id=__span-0-27><a id=__codelineno-0-27 name=__codelineno-0-27></a>        <span class=k>return</span> <span class=n>parts</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>parts</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span><span id=__span-0-28><a id=__codelineno-0-28 name=__codelineno-0-28></a>    <span class=k>return</span> <span class=n>provider</span><span class=p>,</span> <span class=n>model</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.shared.provider_models.get_provider_namespaced_model class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_provider_namespaced_model</span> <a href=#nearai.shared.provider_models.get_provider_namespaced_model class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>get_provider_namespaced_model</span><span class=p>(</span><span class=n>provider_model</span><span class=p>:</span> <span class=n>str</span><span class=p>,</span> <span class=n>provider</span><span class=p>:</span> <span class=n><span title=typing.Optional>Optional</span></span><span class=p>[</span><span class=n>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=typing.Tuple>Tuple</span></span><span class=p>[</span><span class=n>str</span><span class=p>,</span> <span class=n><a class="autorefs autorefs-internal" title=nearai.shared.naming.NamespacedName href=#nearai.shared.naming.NamespacedName>NamespacedName</a></span><span class=p>]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Given <code>provider_model</code> returns provider and namespaced model.</p> <details class=quote> <summary>Source code in <code>nearai/shared/provider_models.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-31>31</a></span>
<span class=normal><a href=#__codelineno-0-32>32</a></span>
<span class=normal><a href=#__codelineno-0-33>33</a></span>
<span class=normal><a href=#__codelineno-0-34>34</a></span>
<span class=normal><a href=#__codelineno-0-35>35</a></span>
<span class=normal><a href=#__codelineno-0-36>36</a></span>
<span class=normal><a href=#__codelineno-0-37>37</a></span>
<span class=normal><a href=#__codelineno-0-38>38</a></span>
<span class=normal><a href=#__codelineno-0-39>39</a></span>
<span class=normal><a href=#__codelineno-0-40>40</a></span>
<span class=normal><a href=#__codelineno-0-41>41</a></span>
<span class=normal><a href=#__codelineno-0-42>42</a></span>
<span class=normal><a href=#__codelineno-0-43>43</a></span>
<span class=normal><a href=#__codelineno-0-44>44</a></span>
<span class=normal><a href=#__codelineno-0-45>45</a></span>
<span class=normal><a href=#__codelineno-0-46>46</a></span>
<span class=normal><a href=#__codelineno-0-47>47</a></span>
<span class=normal><a href=#__codelineno-0-48>48</a></span>
<span class=normal><a href=#__codelineno-0-49>49</a></span>
<span class=normal><a href=#__codelineno-0-50>50</a></span>
<span class=normal><a href=#__codelineno-0-51>51</a></span>
<span class=normal><a href=#__codelineno-0-52>52</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-31><a id=__codelineno-0-31 name=__codelineno-0-31></a><span class=k>def</span><span class=w> </span><span class=nf>get_provider_namespaced_model</span><span class=p>(</span><span class=n>provider_model</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>provider</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>NamespacedName</span><span class=p>]:</span>
</span><span id=__span-0-32><a id=__codelineno-0-32 name=__codelineno-0-32></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Given `provider_model` returns provider and namespaced model.&quot;&quot;&quot;</span>
</span><span id=__span-0-33><a id=__codelineno-0-33 name=__codelineno-0-33></a>    <span class=n>provider_model</span> <span class=o>=</span> <span class=n>provider_model</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;accounts/&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span>
</span><span id=__span-0-34><a id=__codelineno-0-34 name=__codelineno-0-34></a>    <span class=n>provider_model</span> <span class=o>=</span> <span class=n>provider_model</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;fireworks/&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span>
</span><span id=__span-0-35><a id=__codelineno-0-35 name=__codelineno-0-35></a>    <span class=n>provider_model</span> <span class=o>=</span> <span class=n>provider_model</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;models/&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span>
</span><span id=__span-0-36><a id=__codelineno-0-36 name=__codelineno-0-36></a>    <span class=n>provider_opt</span><span class=p>,</span> <span class=n>model</span> <span class=o>=</span> <span class=n>get_provider_model</span><span class=p>(</span><span class=n>DEFAULT_PROVIDER</span> <span class=k>if</span> <span class=ow>not</span> <span class=n>provider</span> <span class=k>else</span> <span class=n>provider</span><span class=p>,</span> <span class=n>provider_model</span><span class=p>)</span>
</span><span id=__span-0-37><a id=__codelineno-0-37 name=__codelineno-0-37></a>    <span class=n>provider</span> <span class=o>=</span> <span class=n>cast</span><span class=p>(</span><span class=nb>str</span><span class=p>,</span> <span class=n>provider_opt</span><span class=p>)</span>
</span><span id=__span-0-38><a id=__codelineno-0-38 name=__codelineno-0-38></a>    <span class=k>if</span> <span class=n>provider</span> <span class=o>==</span> <span class=s2>&quot;hyperbolic&quot;</span><span class=p>:</span>
</span><span id=__span-0-39><a id=__codelineno-0-39 name=__codelineno-0-39></a>        <span class=n>model</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=sa>r</span><span class=s2>&quot;.*/&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>model</span><span class=p>)</span>
</span><span id=__span-0-40><a id=__codelineno-0-40 name=__codelineno-0-40></a>        <span class=k>return</span> <span class=n>provider</span><span class=p>,</span> <span class=n>NamespacedName</span><span class=p>(</span><span class=n>model</span><span class=p>)</span>
</span><span id=__span-0-41><a id=__codelineno-0-41 name=__codelineno-0-41></a>    <span class=k>if</span> <span class=n>provider</span> <span class=o>==</span> <span class=s2>&quot;fireworks&quot;</span><span class=p>:</span>
</span><span id=__span-0-42><a id=__codelineno-0-42 name=__codelineno-0-42></a>        <span class=n>parts</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;/&quot;</span><span class=p>)</span>
</span><span id=__span-0-43><a id=__codelineno-0-43 name=__codelineno-0-43></a>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>parts</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
</span><span id=__span-0-44><a id=__codelineno-0-44 name=__codelineno-0-44></a>            <span class=k>return</span> <span class=n>provider</span><span class=p>,</span> <span class=n>NamespacedName</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=n>parts</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span><span id=__span-0-45><a id=__codelineno-0-45 name=__codelineno-0-45></a>        <span class=k>elif</span> <span class=nb>len</span><span class=p>(</span><span class=n>parts</span><span class=p>)</span> <span class=o>==</span> <span class=mi>2</span><span class=p>:</span>
</span><span id=__span-0-46><a id=__codelineno-0-46 name=__codelineno-0-46></a>            <span class=k>return</span> <span class=n>provider</span><span class=p>,</span> <span class=n>NamespacedName</span><span class=p>(</span><span class=n>namespace</span><span class=o>=</span><span class=n>parts</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>name</span><span class=o>=</span><span class=n>parts</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span><span id=__span-0-47><a id=__codelineno-0-47 name=__codelineno-0-47></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-48><a id=__codelineno-0-48 name=__codelineno-0-48></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Invalid model format for Fireworks: </span><span class=si>{</span><span class=n>model</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-49><a id=__codelineno-0-49 name=__codelineno-0-49></a>    <span class=k>if</span> <span class=n>provider</span> <span class=o>==</span> <span class=s2>&quot;local&quot;</span><span class=p>:</span>
</span><span id=__span-0-50><a id=__codelineno-0-50 name=__codelineno-0-50></a>        <span class=n>model</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=sa>r</span><span class=s2>&quot;.*/&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>model</span><span class=p>)</span>
</span><span id=__span-0-51><a id=__codelineno-0-51 name=__codelineno-0-51></a>        <span class=k>return</span> <span class=n>provider</span><span class=p>,</span> <span class=n>NamespacedName</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=n>model</span><span class=p>)</span>
</span><span id=__span-0-52><a id=__codelineno-0-52 name=__codelineno-0-52></a>    <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Unrecognized provider: </span><span class=si>{</span><span class=n>provider</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> </div> </div> </div> <div class="doc doc-object doc-module"> <h3 id=nearai.solvers class="doc doc-heading"> <span class="doc doc-object-name doc-module-name">solvers</span> <a href=#nearai.solvers class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h4 id=nearai.solvers.DDOTSV0Solver class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">DDOTSV0Solver</span> <a href=#nearai.solvers.DDOTSV0Solver class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title=nearai.solvers.SolverStrategy href=#nearai.solvers.SolverStrategy>SolverStrategy</a></code></p> <p>Solver strategy for competitive programming problems live on DDOTS.</p> <p>This dataset will run agents in an Agent environment previously prepared.</p> <p>workspace/ .id -- Id of the problem PROBLEM.txt -- Description of the problem</p> <p>The agent should call env.submit_python(code) to submit the code to the DDOTS server.</p> <details class=quote> <summary>Source code in <code>nearai/solvers/ddot_v0_solver.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-135>135</a></span>
<span class=normal><a href=#__codelineno-0-136>136</a></span>
<span class=normal><a href=#__codelineno-0-137>137</a></span>
<span class=normal><a href=#__codelineno-0-138>138</a></span>
<span class=normal><a href=#__codelineno-0-139>139</a></span>
<span class=normal><a href=#__codelineno-0-140>140</a></span>
<span class=normal><a href=#__codelineno-0-141>141</a></span>
<span class=normal><a href=#__codelineno-0-142>142</a></span>
<span class=normal><a href=#__codelineno-0-143>143</a></span>
<span class=normal><a href=#__codelineno-0-144>144</a></span>
<span class=normal><a href=#__codelineno-0-145>145</a></span>
<span class=normal><a href=#__codelineno-0-146>146</a></span>
<span class=normal><a href=#__codelineno-0-147>147</a></span>
<span class=normal><a href=#__codelineno-0-148>148</a></span>
<span class=normal><a href=#__codelineno-0-149>149</a></span>
<span class=normal><a href=#__codelineno-0-150>150</a></span>
<span class=normal><a href=#__codelineno-0-151>151</a></span>
<span class=normal><a href=#__codelineno-0-152>152</a></span>
<span class=normal><a href=#__codelineno-0-153>153</a></span>
<span class=normal><a href=#__codelineno-0-154>154</a></span>
<span class=normal><a href=#__codelineno-0-155>155</a></span>
<span class=normal><a href=#__codelineno-0-156>156</a></span>
<span class=normal><a href=#__codelineno-0-157>157</a></span>
<span class=normal><a href=#__codelineno-0-158>158</a></span>
<span class=normal><a href=#__codelineno-0-159>159</a></span>
<span class=normal><a href=#__codelineno-0-160>160</a></span>
<span class=normal><a href=#__codelineno-0-161>161</a></span>
<span class=normal><a href=#__codelineno-0-162>162</a></span>
<span class=normal><a href=#__codelineno-0-163>163</a></span>
<span class=normal><a href=#__codelineno-0-164>164</a></span>
<span class=normal><a href=#__codelineno-0-165>165</a></span>
<span class=normal><a href=#__codelineno-0-166>166</a></span>
<span class=normal><a href=#__codelineno-0-167>167</a></span>
<span class=normal><a href=#__codelineno-0-168>168</a></span>
<span class=normal><a href=#__codelineno-0-169>169</a></span>
<span class=normal><a href=#__codelineno-0-170>170</a></span>
<span class=normal><a href=#__codelineno-0-171>171</a></span>
<span class=normal><a href=#__codelineno-0-172>172</a></span>
<span class=normal><a href=#__codelineno-0-173>173</a></span>
<span class=normal><a href=#__codelineno-0-174>174</a></span>
<span class=normal><a href=#__codelineno-0-175>175</a></span>
<span class=normal><a href=#__codelineno-0-176>176</a></span>
<span class=normal><a href=#__codelineno-0-177>177</a></span>
<span class=normal><a href=#__codelineno-0-178>178</a></span>
<span class=normal><a href=#__codelineno-0-179>179</a></span>
<span class=normal><a href=#__codelineno-0-180>180</a></span>
<span class=normal><a href=#__codelineno-0-181>181</a></span>
<span class=normal><a href=#__codelineno-0-182>182</a></span>
<span class=normal><a href=#__codelineno-0-183>183</a></span>
<span class=normal><a href=#__codelineno-0-184>184</a></span>
<span class=normal><a href=#__codelineno-0-185>185</a></span>
<span class=normal><a href=#__codelineno-0-186>186</a></span>
<span class=normal><a href=#__codelineno-0-187>187</a></span>
<span class=normal><a href=#__codelineno-0-188>188</a></span>
<span class=normal><a href=#__codelineno-0-189>189</a></span>
<span class=normal><a href=#__codelineno-0-190>190</a></span>
<span class=normal><a href=#__codelineno-0-191>191</a></span>
<span class=normal><a href=#__codelineno-0-192>192</a></span>
<span class=normal><a href=#__codelineno-0-193>193</a></span>
<span class=normal><a href=#__codelineno-0-194>194</a></span>
<span class=normal><a href=#__codelineno-0-195>195</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-135><a id=__codelineno-0-135 name=__codelineno-0-135></a><span class=k>class</span><span class=w> </span><span class=nc>DDOTSV0Solver</span><span class=p>(</span><span class=n>SolverStrategy</span><span class=p>):</span>
</span><span id=__span-0-136><a id=__codelineno-0-136 name=__codelineno-0-136></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Solver strategy for competitive programming problems live on DDOTS.</span>
</span><span id=__span-0-137><a id=__codelineno-0-137 name=__codelineno-0-137></a>
</span><span id=__span-0-138><a id=__codelineno-0-138 name=__codelineno-0-138></a><span class=sd>    This dataset will run agents in an Agent environment previously prepared.</span>
</span><span id=__span-0-139><a id=__codelineno-0-139 name=__codelineno-0-139></a>
</span><span id=__span-0-140><a id=__codelineno-0-140 name=__codelineno-0-140></a><span class=sd>    workspace/</span>
</span><span id=__span-0-141><a id=__codelineno-0-141 name=__codelineno-0-141></a><span class=sd>        .id             -- Id of the problem</span>
</span><span id=__span-0-142><a id=__codelineno-0-142 name=__codelineno-0-142></a><span class=sd>        PROBLEM.txt     -- Description of the problem</span>
</span><span id=__span-0-143><a id=__codelineno-0-143 name=__codelineno-0-143></a>
</span><span id=__span-0-144><a id=__codelineno-0-144 name=__codelineno-0-144></a><span class=sd>    The agent should call env.submit_python(code) to submit the code to the DDOTS server.</span>
</span><span id=__span-0-145><a id=__codelineno-0-145 name=__codelineno-0-145></a>
</span><span id=__span-0-146><a id=__codelineno-0-146 name=__codelineno-0-146></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-147><a id=__codelineno-0-147 name=__codelineno-0-147></a>
</span><span id=__span-0-148><a id=__codelineno-0-148 name=__codelineno-0-148></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>dataset_ref</span><span class=p>:</span> <span class=n>Dataset</span><span class=p>,</span> <span class=n>agents</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>max_iterations</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>save_snapshots</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>):</span>  <span class=c1># noqa: D107</span>
</span><span id=__span-0-149><a id=__codelineno-0-149 name=__codelineno-0-149></a>        <span class=n>client_config</span> <span class=o>=</span> <span class=n>ClientConfig</span><span class=p>(</span>
</span><span id=__span-0-150><a id=__codelineno-0-150 name=__codelineno-0-150></a>            <span class=n>base_url</span><span class=o>=</span><span class=n>CONFIG</span><span class=o>.</span><span class=n>nearai_hub</span><span class=o>.</span><span class=n>base_url</span><span class=p>,</span>
</span><span id=__span-0-151><a id=__codelineno-0-151 name=__codelineno-0-151></a>            <span class=n>auth</span><span class=o>=</span><span class=n>CONFIG</span><span class=o>.</span><span class=n>auth</span><span class=p>,</span>
</span><span id=__span-0-152><a id=__codelineno-0-152 name=__codelineno-0-152></a>        <span class=p>)</span>
</span><span id=__span-0-153><a id=__codelineno-0-153 name=__codelineno-0-153></a>        <span class=bp>self</span><span class=o>.</span><span class=n>agents</span> <span class=o>=</span> <span class=p>[</span><span class=n>Agent</span><span class=o>.</span><span class=n>load_agent</span><span class=p>(</span><span class=n>agent</span><span class=p>,</span> <span class=n>client_config</span><span class=p>)</span> <span class=k>for</span> <span class=n>agent</span> <span class=ow>in</span> <span class=n>agents</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;,&quot;</span><span class=p>)]</span>
</span><span id=__span-0-154><a id=__codelineno-0-154 name=__codelineno-0-154></a>        <span class=bp>self</span><span class=o>.</span><span class=n>max_iterations</span> <span class=o>=</span> <span class=n>max_iterations</span>
</span><span id=__span-0-155><a id=__codelineno-0-155 name=__codelineno-0-155></a>
</span><span id=__span-0-156><a id=__codelineno-0-156 name=__codelineno-0-156></a>        <span class=n>date</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s2>&quot;%Y-%m-</span><span class=si>%d</span><span class=s2>_%H-%M-%S&quot;</span><span class=p>)</span>
</span><span id=__span-0-157><a id=__codelineno-0-157 name=__codelineno-0-157></a>        <span class=n>rnd_id</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>10</span><span class=o>**</span><span class=mi>8</span><span class=p>,</span> <span class=mi>10</span><span class=o>**</span><span class=mi>9</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span>
</span><span id=__span-0-158><a id=__codelineno-0-158 name=__codelineno-0-158></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_saved_trajectories</span> <span class=o>=</span> <span class=n>DATA_FOLDER</span> <span class=o>/</span> <span class=s2>&quot;data&quot;</span> <span class=o>/</span> <span class=s2>&quot;ddots_v0_trajectories&quot;</span> <span class=o>/</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>date</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>rnd_id</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-159><a id=__codelineno-0-159 name=__codelineno-0-159></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_saved_trajectories</span><span class=o>.</span><span class=n>mkdir</span><span class=p>(</span><span class=n>parents</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-160><a id=__codelineno-0-160 name=__codelineno-0-160></a>
</span><span id=__span-0-161><a id=__codelineno-0-161 name=__codelineno-0-161></a>        <span class=bp>self</span><span class=o>.</span><span class=n>save_snapshots</span> <span class=o>=</span> <span class=n>save_snapshots</span>
</span><span id=__span-0-162><a id=__codelineno-0-162 name=__codelineno-0-162></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Saving trajectories to&quot;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>_saved_trajectories</span><span class=p>)</span>
</span><span id=__span-0-163><a id=__codelineno-0-163 name=__codelineno-0-163></a>
</span><span id=__span-0-164><a id=__codelineno-0-164 name=__codelineno-0-164></a>    <span class=k>def</span><span class=w> </span><span class=nf>evaluation_name</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-165><a id=__codelineno-0-165 name=__codelineno-0-165></a>        <span class=k>return</span> <span class=s2>&quot;ddots&quot;</span>
</span><span id=__span-0-166><a id=__codelineno-0-166 name=__codelineno-0-166></a>
</span><span id=__span-0-167><a id=__codelineno-0-167 name=__codelineno-0-167></a>    <span class=k>def</span><span class=w> </span><span class=nf>compatible_datasets</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-168><a id=__codelineno-0-168 name=__codelineno-0-168></a>        <span class=k>return</span> <span class=p>[</span><span class=s2>&quot;ddots_codeforces_small/v0&quot;</span><span class=p>,</span> <span class=s2>&quot;datasets/ddots_codeforces_medium_A_B/v0&quot;</span><span class=p>]</span>
</span><span id=__span-0-169><a id=__codelineno-0-169 name=__codelineno-0-169></a>
</span><span id=__span-0-170><a id=__codelineno-0-170 name=__codelineno-0-170></a>    <span class=k>def</span><span class=w> </span><span class=nf>solve</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>datum</span><span class=p>:</span> <span class=nb>dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-171><a id=__codelineno-0-171 name=__codelineno-0-171></a>        <span class=n>problem_id</span> <span class=o>=</span> <span class=n>datum</span><span class=p>[</span><span class=s2>&quot;problem_id&quot;</span><span class=p>]</span>
</span><span id=__span-0-172><a id=__codelineno-0-172 name=__codelineno-0-172></a>        <span class=n>description</span> <span class=o>=</span> <span class=n>datum</span><span class=p>[</span><span class=s2>&quot;description&quot;</span><span class=p>]</span>
</span><span id=__span-0-173><a id=__codelineno-0-173 name=__codelineno-0-173></a>
</span><span id=__span-0-174><a id=__codelineno-0-174 name=__codelineno-0-174></a>        <span class=n>client_config</span> <span class=o>=</span> <span class=n>ClientConfig</span><span class=p>(</span>
</span><span id=__span-0-175><a id=__codelineno-0-175 name=__codelineno-0-175></a>            <span class=n>base_url</span><span class=o>=</span><span class=n>CONFIG</span><span class=o>.</span><span class=n>nearai_hub</span><span class=o>.</span><span class=n>base_url</span><span class=p>,</span>
</span><span id=__span-0-176><a id=__codelineno-0-176 name=__codelineno-0-176></a>            <span class=n>auth</span><span class=o>=</span><span class=n>CONFIG</span><span class=o>.</span><span class=n>auth</span><span class=p>,</span>
</span><span id=__span-0-177><a id=__codelineno-0-177 name=__codelineno-0-177></a>        <span class=p>)</span>
</span><span id=__span-0-178><a id=__codelineno-0-178 name=__codelineno-0-178></a>        <span class=n>client</span> <span class=o>=</span> <span class=n>InferenceClient</span><span class=p>(</span><span class=n>client_config</span><span class=p>)</span>
</span><span id=__span-0-179><a id=__codelineno-0-179 name=__codelineno-0-179></a>        <span class=n>env</span> <span class=o>=</span> <span class=n>DDOTSEnvironment</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>agents</span><span class=p>,</span> <span class=n>problem_id</span><span class=p>,</span> <span class=n>description</span><span class=p>,</span> <span class=n>client</span><span class=p>)</span>
</span><span id=__span-0-180><a id=__codelineno-0-180 name=__codelineno-0-180></a>        <span class=n>env</span><span class=o>.</span><span class=n>write_file</span><span class=p>(</span><span class=s2>&quot;.solved&quot;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=kc>False</span><span class=p>))</span>
</span><span id=__span-0-181><a id=__codelineno-0-181 name=__codelineno-0-181></a>
</span><span id=__span-0-182><a id=__codelineno-0-182 name=__codelineno-0-182></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-183><a id=__codelineno-0-183 name=__codelineno-0-183></a>            <span class=n>env</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>description</span><span class=p>,</span> <span class=n>max_iterations</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>max_iterations</span><span class=p>)</span>
</span><span id=__span-0-184><a id=__codelineno-0-184 name=__codelineno-0-184></a>            <span class=n>env</span><span class=o>.</span><span class=n>write_file</span><span class=p>(</span><span class=s2>&quot;.solved&quot;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>env</span><span class=o>.</span><span class=n>solved</span><span class=p>))</span>
</span><span id=__span-0-185><a id=__codelineno-0-185 name=__codelineno-0-185></a>
</span><span id=__span-0-186><a id=__codelineno-0-186 name=__codelineno-0-186></a>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-187><a id=__codelineno-0-187 name=__codelineno-0-187></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error running task: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-188><a id=__codelineno-0-188 name=__codelineno-0-188></a>
</span><span id=__span-0-189><a id=__codelineno-0-189 name=__codelineno-0-189></a>        <span class=k>finally</span><span class=p>:</span>
</span><span id=__span-0-190><a id=__codelineno-0-190 name=__codelineno-0-190></a>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>save_snapshots</span><span class=p>:</span>
</span><span id=__span-0-191><a id=__codelineno-0-191 name=__codelineno-0-191></a>                <span class=n>snapshot</span> <span class=o>=</span> <span class=n>env</span><span class=o>.</span><span class=n>create_snapshot</span><span class=p>()</span>
</span><span id=__span-0-192><a id=__codelineno-0-192 name=__codelineno-0-192></a>                <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_saved_trajectories</span> <span class=o>/</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>problem_id</span><span class=si>}</span><span class=s2>.tar.gz&quot;</span><span class=p>,</span> <span class=s2>&quot;wb&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-193><a id=__codelineno-0-193 name=__codelineno-0-193></a>                    <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>snapshot</span><span class=p>)</span>
</span><span id=__span-0-194><a id=__codelineno-0-194 name=__codelineno-0-194></a>
</span><span id=__span-0-195><a id=__codelineno-0-195 name=__codelineno-0-195></a>        <span class=k>return</span> <span class=n>env</span><span class=o>.</span><span class=n>solved</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-class"> <h4 id=nearai.solvers.GSM8KSolverStrategy class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">GSM8KSolverStrategy</span> <a href=#nearai.solvers.GSM8KSolverStrategy class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title=nearai.solvers.SolverStrategy href=#nearai.solvers.SolverStrategy>SolverStrategy</a></code></p> <p>Solver strategy for the GSM8K dataset.</p> <details class=quote> <summary>Source code in <code>nearai/solvers/gsm8k_solver.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-15>15</a></span>
<span class=normal><a href=#__codelineno-0-16>16</a></span>
<span class=normal><a href=#__codelineno-0-17>17</a></span>
<span class=normal><a href=#__codelineno-0-18>18</a></span>
<span class=normal><a href=#__codelineno-0-19>19</a></span>
<span class=normal><a href=#__codelineno-0-20>20</a></span>
<span class=normal><a href=#__codelineno-0-21>21</a></span>
<span class=normal><a href=#__codelineno-0-22>22</a></span>
<span class=normal><a href=#__codelineno-0-23>23</a></span>
<span class=normal><a href=#__codelineno-0-24>24</a></span>
<span class=normal><a href=#__codelineno-0-25>25</a></span>
<span class=normal><a href=#__codelineno-0-26>26</a></span>
<span class=normal><a href=#__codelineno-0-27>27</a></span>
<span class=normal><a href=#__codelineno-0-28>28</a></span>
<span class=normal><a href=#__codelineno-0-29>29</a></span>
<span class=normal><a href=#__codelineno-0-30>30</a></span>
<span class=normal><a href=#__codelineno-0-31>31</a></span>
<span class=normal><a href=#__codelineno-0-32>32</a></span>
<span class=normal><a href=#__codelineno-0-33>33</a></span>
<span class=normal><a href=#__codelineno-0-34>34</a></span>
<span class=normal><a href=#__codelineno-0-35>35</a></span>
<span class=normal><a href=#__codelineno-0-36>36</a></span>
<span class=normal><a href=#__codelineno-0-37>37</a></span>
<span class=normal><a href=#__codelineno-0-38>38</a></span>
<span class=normal><a href=#__codelineno-0-39>39</a></span>
<span class=normal><a href=#__codelineno-0-40>40</a></span>
<span class=normal><a href=#__codelineno-0-41>41</a></span>
<span class=normal><a href=#__codelineno-0-42>42</a></span>
<span class=normal><a href=#__codelineno-0-43>43</a></span>
<span class=normal><a href=#__codelineno-0-44>44</a></span>
<span class=normal><a href=#__codelineno-0-45>45</a></span>
<span class=normal><a href=#__codelineno-0-46>46</a></span>
<span class=normal><a href=#__codelineno-0-47>47</a></span>
<span class=normal><a href=#__codelineno-0-48>48</a></span>
<span class=normal><a href=#__codelineno-0-49>49</a></span>
<span class=normal><a href=#__codelineno-0-50>50</a></span>
<span class=normal><a href=#__codelineno-0-51>51</a></span>
<span class=normal><a href=#__codelineno-0-52>52</a></span>
<span class=normal><a href=#__codelineno-0-53>53</a></span>
<span class=normal><a href=#__codelineno-0-54>54</a></span>
<span class=normal><a href=#__codelineno-0-55>55</a></span>
<span class=normal><a href=#__codelineno-0-56>56</a></span>
<span class=normal><a href=#__codelineno-0-57>57</a></span>
<span class=normal><a href=#__codelineno-0-58>58</a></span>
<span class=normal><a href=#__codelineno-0-59>59</a></span>
<span class=normal><a href=#__codelineno-0-60>60</a></span>
<span class=normal><a href=#__codelineno-0-61>61</a></span>
<span class=normal><a href=#__codelineno-0-62>62</a></span>
<span class=normal><a href=#__codelineno-0-63>63</a></span>
<span class=normal><a href=#__codelineno-0-64>64</a></span>
<span class=normal><a href=#__codelineno-0-65>65</a></span>
<span class=normal><a href=#__codelineno-0-66>66</a></span>
<span class=normal><a href=#__codelineno-0-67>67</a></span>
<span class=normal><a href=#__codelineno-0-68>68</a></span>
<span class=normal><a href=#__codelineno-0-69>69</a></span>
<span class=normal><a href=#__codelineno-0-70>70</a></span>
<span class=normal><a href=#__codelineno-0-71>71</a></span>
<span class=normal><a href=#__codelineno-0-72>72</a></span>
<span class=normal><a href=#__codelineno-0-73>73</a></span>
<span class=normal><a href=#__codelineno-0-74>74</a></span>
<span class=normal><a href=#__codelineno-0-75>75</a></span>
<span class=normal><a href=#__codelineno-0-76>76</a></span>
<span class=normal><a href=#__codelineno-0-77>77</a></span>
<span class=normal><a href=#__codelineno-0-78>78</a></span>
<span class=normal><a href=#__codelineno-0-79>79</a></span>
<span class=normal><a href=#__codelineno-0-80>80</a></span>
<span class=normal><a href=#__codelineno-0-81>81</a></span>
<span class=normal><a href=#__codelineno-0-82>82</a></span>
<span class=normal><a href=#__codelineno-0-83>83</a></span>
<span class=normal><a href=#__codelineno-0-84>84</a></span>
<span class=normal><a href=#__codelineno-0-85>85</a></span>
<span class=normal><a href=#__codelineno-0-86>86</a></span>
<span class=normal><a href=#__codelineno-0-87>87</a></span>
<span class=normal><a href=#__codelineno-0-88>88</a></span>
<span class=normal><a href=#__codelineno-0-89>89</a></span>
<span class=normal><a href=#__codelineno-0-90>90</a></span>
<span class=normal><a href=#__codelineno-0-91>91</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15></a><span class=k>class</span><span class=w> </span><span class=nc>GSM8KSolverStrategy</span><span class=p>(</span><span class=n>SolverStrategy</span><span class=p>):</span>
</span><span id=__span-0-16><a id=__codelineno-0-16 name=__codelineno-0-16></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Solver strategy for the GSM8K dataset.&quot;&quot;&quot;</span>
</span><span id=__span-0-17><a id=__codelineno-0-17 name=__codelineno-0-17></a>
</span><span id=__span-0-18><a id=__codelineno-0-18 name=__codelineno-0-18></a>    <span class=n>SHOTS</span> <span class=o>=</span> <span class=mi>8</span>
</span><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19></a>
</span><span id=__span-0-20><a id=__codelineno-0-20 name=__codelineno-0-20></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>dataset_ref</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Dataset</span><span class=p>,</span> <span class=n>DatasetDict</span><span class=p>],</span> <span class=n>model</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>agent</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>  <span class=c1># noqa: D107</span>
</span><span id=__span-0-21><a id=__codelineno-0-21 name=__codelineno-0-21></a>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>agent</span><span class=p>)</span>
</span><span id=__span-0-22><a id=__codelineno-0-22 name=__codelineno-0-22></a>        <span class=bp>self</span><span class=o>.</span><span class=n>dataset_ref</span> <span class=o>=</span> <span class=n>dataset_ref</span>
</span><span id=__span-0-23><a id=__codelineno-0-23 name=__codelineno-0-23></a>
</span><span id=__span-0-24><a id=__codelineno-0-24 name=__codelineno-0-24></a>    <span class=k>def</span><span class=w> </span><span class=nf>evaluation_name</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-25><a id=__codelineno-0-25 name=__codelineno-0-25></a>        <span class=k>return</span> <span class=s2>&quot;gsm8k&quot;</span>
</span><span id=__span-0-26><a id=__codelineno-0-26 name=__codelineno-0-26></a>
</span><span id=__span-0-27><a id=__codelineno-0-27 name=__codelineno-0-27></a>    <span class=k>def</span><span class=w> </span><span class=nf>compatible_datasets</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-28><a id=__codelineno-0-28 name=__codelineno-0-28></a>        <span class=k>return</span> <span class=p>[</span><span class=s2>&quot;gsm8k&quot;</span><span class=p>]</span>
</span><span id=__span-0-29><a id=__codelineno-0-29 name=__codelineno-0-29></a>
</span><span id=__span-0-30><a id=__codelineno-0-30 name=__codelineno-0-30></a>    <span class=k>def</span><span class=w> </span><span class=nf>solve</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>datum</span><span class=p>:</span> <span class=nb>dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-31><a id=__codelineno-0-31 name=__codelineno-0-31></a>        <span class=n>parsed_datum</span><span class=p>:</span> <span class=n>GSM8KDatum</span> <span class=o>=</span> <span class=n>GSM8KDatum</span><span class=p>(</span><span class=o>**</span><span class=n>datum</span><span class=p>)</span>
</span><span id=__span-0-32><a id=__codelineno-0-32 name=__codelineno-0-32></a>
</span><span id=__span-0-33><a id=__codelineno-0-33 name=__codelineno-0-33></a>        <span class=n>problem_shots_indices</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>SHOTS</span><span class=p>))</span>
</span><span id=__span-0-34><a id=__codelineno-0-34 name=__codelineno-0-34></a>        <span class=n>problem_shots</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span>
</span><span id=__span-0-35><a id=__codelineno-0-35 name=__codelineno-0-35></a>            <span class=nb>map</span><span class=p>(</span>
</span><span id=__span-0-36><a id=__codelineno-0-36 name=__codelineno-0-36></a>                <span class=k>lambda</span> <span class=n>i</span><span class=p>:</span> <span class=n>GSM8KDatum</span><span class=p>(</span><span class=o>**</span><span class=bp>self</span><span class=o>.</span><span class=n>dataset_ref</span><span class=p>[</span><span class=s2>&quot;train&quot;</span><span class=p>][</span><span class=n>i</span><span class=p>])</span><span class=o>.</span><span class=n>model_dump</span><span class=p>(),</span>
</span><span id=__span-0-37><a id=__codelineno-0-37 name=__codelineno-0-37></a>                <span class=n>problem_shots_indices</span><span class=p>,</span>
</span><span id=__span-0-38><a id=__codelineno-0-38 name=__codelineno-0-38></a>            <span class=p>)</span>
</span><span id=__span-0-39><a id=__codelineno-0-39 name=__codelineno-0-39></a>        <span class=p>)</span>
</span><span id=__span-0-40><a id=__codelineno-0-40 name=__codelineno-0-40></a>
</span><span id=__span-0-41><a id=__codelineno-0-41 name=__codelineno-0-41></a>        <span class=n>session</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>start_inference_session</span><span class=p>(</span><span class=s2>&quot;&quot;</span><span class=p>)</span>
</span><span id=__span-0-42><a id=__codelineno-0-42 name=__codelineno-0-42></a>        <span class=n>session</span><span class=o>.</span><span class=n>add_system_message</span><span class=p>(</span>
</span><span id=__span-0-43><a id=__codelineno-0-43 name=__codelineno-0-43></a>            <span class=n>dedent</span><span class=p>(</span>
</span><span id=__span-0-44><a id=__codelineno-0-44 name=__codelineno-0-44></a><span class=w>                </span><span class=sd>&quot;&quot;&quot;</span>
</span><span id=__span-0-45><a id=__codelineno-0-45 name=__codelineno-0-45></a><span class=sd>                    You are a helpful assistant. You&#39;re goal is to answer word based math questions.</span>
</span><span id=__span-0-46><a id=__codelineno-0-46 name=__codelineno-0-46></a><span class=sd>                    &quot;&quot;&quot;</span>
</span><span id=__span-0-47><a id=__codelineno-0-47 name=__codelineno-0-47></a>                <span class=o>+</span> <span class=s2>&quot;</span><span class=se>\n\n</span><span class=s2>&quot;</span>
</span><span id=__span-0-48><a id=__codelineno-0-48 name=__codelineno-0-48></a>                <span class=o>+</span> <span class=s2>&quot;Here are some examples of math questions and their answers:&quot;</span>
</span><span id=__span-0-49><a id=__codelineno-0-49 name=__codelineno-0-49></a>                <span class=o>+</span> <span class=s2>&quot;</span><span class=se>\n\n</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=sa>f</span><span class=s2>&quot;Question: </span><span class=si>{</span><span class=n>shot</span><span class=p>[</span><span class=s1>&#39;question&#39;</span><span class=p>]</span><span class=si>}</span><span class=se>\n</span><span class=s2>Answer: </span><span class=si>{</span><span class=n>shot</span><span class=p>[</span><span class=s1>&#39;answer&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span> <span class=k>for</span> <span class=n>shot</span> <span class=ow>in</span> <span class=n>problem_shots</span><span class=p>])</span>
</span><span id=__span-0-50><a id=__codelineno-0-50 name=__codelineno-0-50></a>                <span class=o>+</span> <span class=s2>&quot;</span><span class=se>\n\n</span><span class=s2>&quot;</span>
</span><span id=__span-0-51><a id=__codelineno-0-51 name=__codelineno-0-51></a>                <span class=o>+</span> <span class=s2>&quot;Now, answer the next question provided in the user prompt. &quot;</span>
</span><span id=__span-0-52><a id=__codelineno-0-52 name=__codelineno-0-52></a>                <span class=o>+</span> <span class=s2>&quot;Think step by step about how to solve the problem. &quot;</span>
</span><span id=__span-0-53><a id=__codelineno-0-53 name=__codelineno-0-53></a>                <span class=o>+</span> <span class=s2>&quot;Then, provide the answer.&quot;</span>
</span><span id=__span-0-54><a id=__codelineno-0-54 name=__codelineno-0-54></a>            <span class=p>)</span>
</span><span id=__span-0-55><a id=__codelineno-0-55 name=__codelineno-0-55></a>        <span class=p>)</span>
</span><span id=__span-0-56><a id=__codelineno-0-56 name=__codelineno-0-56></a>        <span class=n>res_output</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>run_task</span><span class=p>(</span><span class=n>parsed_datum</span><span class=o>.</span><span class=n>question</span><span class=p>)</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span><span id=__span-0-57><a id=__codelineno-0-57 name=__codelineno-0-57></a>
</span><span id=__span-0-58><a id=__codelineno-0-58 name=__codelineno-0-58></a>        <span class=c1>## cleanup the output</span>
</span><span id=__span-0-59><a id=__codelineno-0-59 name=__codelineno-0-59></a>        <span class=n>session</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>start_inference_session</span><span class=p>(</span><span class=s2>&quot;&quot;</span><span class=p>)</span>
</span><span id=__span-0-60><a id=__codelineno-0-60 name=__codelineno-0-60></a>        <span class=n>res_refined_output</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>run_task</span><span class=p>(</span>
</span><span id=__span-0-61><a id=__codelineno-0-61 name=__codelineno-0-61></a>            <span class=n>dedent</span><span class=p>(</span>
</span><span id=__span-0-62><a id=__codelineno-0-62 name=__codelineno-0-62></a>                <span class=sa>f</span><span class=s2>&quot;&quot;&quot;</span>
</span><span id=__span-0-63><a id=__codelineno-0-63 name=__codelineno-0-63></a><span class=s2>                    You are a helpful assistant. You&#39;re goal is to answer math questions.</span>
</span><span id=__span-0-64><a id=__codelineno-0-64 name=__codelineno-0-64></a>
</span><span id=__span-0-65><a id=__codelineno-0-65 name=__codelineno-0-65></a><span class=s2>                    You have just answered a math question with the following response:</span>
</span><span id=__span-0-66><a id=__codelineno-0-66 name=__codelineno-0-66></a>
</span><span id=__span-0-67><a id=__codelineno-0-67 name=__codelineno-0-67></a><span class=s2>                    --- BEGIN RESPONSE ---</span>
</span><span id=__span-0-68><a id=__codelineno-0-68 name=__codelineno-0-68></a><span class=s2>                    </span><span class=si>{</span><span class=n>res_output</span><span class=si>}</span>
</span><span id=__span-0-69><a id=__codelineno-0-69 name=__codelineno-0-69></a><span class=s2>                    --- END RESPONSE ---</span>
</span><span id=__span-0-70><a id=__codelineno-0-70 name=__codelineno-0-70></a>
</span><span id=__span-0-71><a id=__codelineno-0-71 name=__codelineno-0-71></a><span class=s2>                    Please refine your answer.</span>
</span><span id=__span-0-72><a id=__codelineno-0-72 name=__codelineno-0-72></a>
</span><span id=__span-0-73><a id=__codelineno-0-73 name=__codelineno-0-73></a><span class=s2>                    Only output the final number *without units* as your answer. Nothing else.</span>
</span><span id=__span-0-74><a id=__codelineno-0-74 name=__codelineno-0-74></a><span class=s2>                    &quot;&quot;&quot;</span>
</span><span id=__span-0-75><a id=__codelineno-0-75 name=__codelineno-0-75></a>            <span class=p>)</span>
</span><span id=__span-0-76><a id=__codelineno-0-76 name=__codelineno-0-76></a>        <span class=p>)</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span><span id=__span-0-77><a id=__codelineno-0-77 name=__codelineno-0-77></a>        <span class=n>res_refined_output</span> <span class=o>=</span> <span class=n>res_refined_output</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;$&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;,&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span>
</span><span id=__span-0-78><a id=__codelineno-0-78 name=__codelineno-0-78></a>        <span class=k>if</span> <span class=s2>&quot; &quot;</span> <span class=ow>in</span> <span class=n>res_refined_output</span><span class=p>:</span>
</span><span id=__span-0-79><a id=__codelineno-0-79 name=__codelineno-0-79></a>            <span class=n>res_refined_output</span> <span class=o>=</span> <span class=n>res_refined_output</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot; &quot;</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span><span id=__span-0-80><a id=__codelineno-0-80 name=__codelineno-0-80></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-81><a id=__codelineno-0-81 name=__codelineno-0-81></a>            <span class=n>res_refined_output</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>res_refined_output</span><span class=p>))</span>
</span><span id=__span-0-82><a id=__codelineno-0-82 name=__codelineno-0-82></a>        <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
</span><span id=__span-0-83><a id=__codelineno-0-83 name=__codelineno-0-83></a>            <span class=k>pass</span>
</span><span id=__span-0-84><a id=__codelineno-0-84 name=__codelineno-0-84></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-85><a id=__codelineno-0-85 name=__codelineno-0-85></a>            <span class=n>res_refined_output</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=nb>float</span><span class=p>(</span><span class=n>res_refined_output</span><span class=p>)))</span>
</span><span id=__span-0-86><a id=__codelineno-0-86 name=__codelineno-0-86></a>        <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
</span><span id=__span-0-87><a id=__codelineno-0-87 name=__codelineno-0-87></a>            <span class=k>pass</span>
</span><span id=__span-0-88><a id=__codelineno-0-88 name=__codelineno-0-88></a>
</span><span id=__span-0-89><a id=__codelineno-0-89 name=__codelineno-0-89></a>        <span class=n>refined_answer</span> <span class=o>=</span> <span class=n>parsed_datum</span><span class=o>.</span><span class=n>answer</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;$&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;,&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span>
</span><span id=__span-0-90><a id=__codelineno-0-90 name=__codelineno-0-90></a>        <span class=nb>print</span><span class=p>(</span><span class=n>res_refined_output</span><span class=p>,</span> <span class=n>refined_answer</span><span class=p>)</span>
</span><span id=__span-0-91><a id=__codelineno-0-91 name=__codelineno-0-91></a>        <span class=k>return</span> <span class=n>res_refined_output</span> <span class=o>==</span> <span class=n>refined_answer</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-class"> <h4 id=nearai.solvers.HellaswagSolverStrategy class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">HellaswagSolverStrategy</span> <a href=#nearai.solvers.HellaswagSolverStrategy class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title=nearai.solvers.SolverStrategy href=#nearai.solvers.SolverStrategy>SolverStrategy</a></code></p> <p>Solver strategy for the MMLU dataset.</p> <details class=quote> <summary>Source code in <code>nearai/solvers/hellaswag_solver.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-24>24</a></span>
<span class=normal><a href=#__codelineno-0-25>25</a></span>
<span class=normal><a href=#__codelineno-0-26>26</a></span>
<span class=normal><a href=#__codelineno-0-27>27</a></span>
<span class=normal><a href=#__codelineno-0-28>28</a></span>
<span class=normal><a href=#__codelineno-0-29>29</a></span>
<span class=normal><a href=#__codelineno-0-30>30</a></span>
<span class=normal><a href=#__codelineno-0-31>31</a></span>
<span class=normal><a href=#__codelineno-0-32>32</a></span>
<span class=normal><a href=#__codelineno-0-33>33</a></span>
<span class=normal><a href=#__codelineno-0-34>34</a></span>
<span class=normal><a href=#__codelineno-0-35>35</a></span>
<span class=normal><a href=#__codelineno-0-36>36</a></span>
<span class=normal><a href=#__codelineno-0-37>37</a></span>
<span class=normal><a href=#__codelineno-0-38>38</a></span>
<span class=normal><a href=#__codelineno-0-39>39</a></span>
<span class=normal><a href=#__codelineno-0-40>40</a></span>
<span class=normal><a href=#__codelineno-0-41>41</a></span>
<span class=normal><a href=#__codelineno-0-42>42</a></span>
<span class=normal><a href=#__codelineno-0-43>43</a></span>
<span class=normal><a href=#__codelineno-0-44>44</a></span>
<span class=normal><a href=#__codelineno-0-45>45</a></span>
<span class=normal><a href=#__codelineno-0-46>46</a></span>
<span class=normal><a href=#__codelineno-0-47>47</a></span>
<span class=normal><a href=#__codelineno-0-48>48</a></span>
<span class=normal><a href=#__codelineno-0-49>49</a></span>
<span class=normal><a href=#__codelineno-0-50>50</a></span>
<span class=normal><a href=#__codelineno-0-51>51</a></span>
<span class=normal><a href=#__codelineno-0-52>52</a></span>
<span class=normal><a href=#__codelineno-0-53>53</a></span>
<span class=normal><a href=#__codelineno-0-54>54</a></span>
<span class=normal><a href=#__codelineno-0-55>55</a></span>
<span class=normal><a href=#__codelineno-0-56>56</a></span>
<span class=normal><a href=#__codelineno-0-57>57</a></span>
<span class=normal><a href=#__codelineno-0-58>58</a></span>
<span class=normal><a href=#__codelineno-0-59>59</a></span>
<span class=normal><a href=#__codelineno-0-60>60</a></span>
<span class=normal><a href=#__codelineno-0-61>61</a></span>
<span class=normal><a href=#__codelineno-0-62>62</a></span>
<span class=normal><a href=#__codelineno-0-63>63</a></span>
<span class=normal><a href=#__codelineno-0-64>64</a></span>
<span class=normal><a href=#__codelineno-0-65>65</a></span>
<span class=normal><a href=#__codelineno-0-66>66</a></span>
<span class=normal><a href=#__codelineno-0-67>67</a></span>
<span class=normal><a href=#__codelineno-0-68>68</a></span>
<span class=normal><a href=#__codelineno-0-69>69</a></span>
<span class=normal><a href=#__codelineno-0-70>70</a></span>
<span class=normal><a href=#__codelineno-0-71>71</a></span>
<span class=normal><a href=#__codelineno-0-72>72</a></span>
<span class=normal><a href=#__codelineno-0-73>73</a></span>
<span class=normal><a href=#__codelineno-0-74>74</a></span>
<span class=normal><a href=#__codelineno-0-75>75</a></span>
<span class=normal><a href=#__codelineno-0-76>76</a></span>
<span class=normal><a href=#__codelineno-0-77>77</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-24><a id=__codelineno-0-24 name=__codelineno-0-24></a><span class=k>class</span><span class=w> </span><span class=nc>HellaswagSolverStrategy</span><span class=p>(</span><span class=n>SolverStrategy</span><span class=p>):</span>
</span><span id=__span-0-25><a id=__codelineno-0-25 name=__codelineno-0-25></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Solver strategy for the MMLU dataset.&quot;&quot;&quot;</span>
</span><span id=__span-0-26><a id=__codelineno-0-26 name=__codelineno-0-26></a>
</span><span id=__span-0-27><a id=__codelineno-0-27 name=__codelineno-0-27></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span>  <span class=c1># noqa: D107</span>
</span><span id=__span-0-28><a id=__codelineno-0-28 name=__codelineno-0-28></a>        <span class=bp>self</span><span class=p>,</span> <span class=n>dataset_ref</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Dataset</span><span class=p>,</span> <span class=n>DatasetDict</span><span class=p>],</span> <span class=n>model</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>agent</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>shots</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>8</span>
</span><span id=__span-0-29><a id=__codelineno-0-29 name=__codelineno-0-29></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-30><a id=__codelineno-0-30 name=__codelineno-0-30></a>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>agent</span><span class=p>)</span>
</span><span id=__span-0-31><a id=__codelineno-0-31 name=__codelineno-0-31></a>        <span class=bp>self</span><span class=o>.</span><span class=n>dataset_ref</span> <span class=o>=</span> <span class=n>dataset_ref</span>
</span><span id=__span-0-32><a id=__codelineno-0-32 name=__codelineno-0-32></a>        <span class=bp>self</span><span class=o>.</span><span class=n>shots</span> <span class=o>=</span> <span class=n>shots</span>
</span><span id=__span-0-33><a id=__codelineno-0-33 name=__codelineno-0-33></a>
</span><span id=__span-0-34><a id=__codelineno-0-34 name=__codelineno-0-34></a>    <span class=k>def</span><span class=w> </span><span class=nf>evaluation_name</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-35><a id=__codelineno-0-35 name=__codelineno-0-35></a>        <span class=k>return</span> <span class=sa>f</span><span class=s2>&quot;hellaswag_</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>shots</span><span class=si>}</span><span class=s2>shots&quot;</span>
</span><span id=__span-0-36><a id=__codelineno-0-36 name=__codelineno-0-36></a>
</span><span id=__span-0-37><a id=__codelineno-0-37 name=__codelineno-0-37></a>    <span class=k>def</span><span class=w> </span><span class=nf>compatible_datasets</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-38><a id=__codelineno-0-38 name=__codelineno-0-38></a>        <span class=k>return</span> <span class=p>[</span><span class=s2>&quot;hellaswag&quot;</span><span class=p>]</span>
</span><span id=__span-0-39><a id=__codelineno-0-39 name=__codelineno-0-39></a>
</span><span id=__span-0-40><a id=__codelineno-0-40 name=__codelineno-0-40></a>    <span class=k>def</span><span class=w> </span><span class=nf>solve</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>datum</span><span class=p>:</span> <span class=nb>dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-41><a id=__codelineno-0-41 name=__codelineno-0-41></a>        <span class=n>datum</span> <span class=o>=</span> <span class=n>HellaswagDatum</span><span class=p>(</span><span class=o>**</span><span class=n>datum</span><span class=p>)</span><span class=o>.</span><span class=n>model_dump</span><span class=p>()</span>
</span><span id=__span-0-42><a id=__codelineno-0-42 name=__codelineno-0-42></a>
</span><span id=__span-0-43><a id=__codelineno-0-43 name=__codelineno-0-43></a>        <span class=n>choices</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;A&quot;</span><span class=p>,</span> <span class=s2>&quot;B&quot;</span><span class=p>,</span> <span class=s2>&quot;C&quot;</span><span class=p>,</span> <span class=s2>&quot;D&quot;</span><span class=p>]</span>
</span><span id=__span-0-44><a id=__codelineno-0-44 name=__codelineno-0-44></a>        <span class=n>example_problems_indices</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>5</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>shots</span><span class=p>,</span> <span class=mi>5</span><span class=p>))</span>
</span><span id=__span-0-45><a id=__codelineno-0-45 name=__codelineno-0-45></a>        <span class=n>example_problems</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span>
</span><span id=__span-0-46><a id=__codelineno-0-46 name=__codelineno-0-46></a>            <span class=nb>map</span><span class=p>(</span>
</span><span id=__span-0-47><a id=__codelineno-0-47 name=__codelineno-0-47></a>                <span class=k>lambda</span> <span class=n>d</span><span class=p>:</span> <span class=n>HellaswagDatum</span><span class=p>(</span><span class=o>**</span><span class=n>d</span><span class=p>)</span><span class=o>.</span><span class=n>model_dump</span><span class=p>(),</span>
</span><span id=__span-0-48><a id=__codelineno-0-48 name=__codelineno-0-48></a>                <span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>dataset_ref</span><span class=p>[</span><span class=s2>&quot;validation&quot;</span><span class=p>][</span><span class=n>i</span><span class=p>]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>example_problems_indices</span><span class=p>],</span>
</span><span id=__span-0-49><a id=__codelineno-0-49 name=__codelineno-0-49></a>            <span class=p>)</span>
</span><span id=__span-0-50><a id=__codelineno-0-50 name=__codelineno-0-50></a>        <span class=p>)</span>
</span><span id=__span-0-51><a id=__codelineno-0-51 name=__codelineno-0-51></a>        <span class=n>base_prompt</span> <span class=o>=</span> <span class=n>Template</span><span class=p>(</span>
</span><span id=__span-0-52><a id=__codelineno-0-52 name=__codelineno-0-52></a>            <span class=nb>open</span><span class=p>(</span><span class=n>PROMPTS_FOLDER</span> <span class=o>/</span> <span class=s2>&quot;hellaswag_verbose_answer.j2&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>(),</span>
</span><span id=__span-0-53><a id=__codelineno-0-53 name=__codelineno-0-53></a>            <span class=n>trim_blocks</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-54><a id=__codelineno-0-54 name=__codelineno-0-54></a>        <span class=p>)</span><span class=o>.</span><span class=n>render</span><span class=p>(</span>
</span><span id=__span-0-55><a id=__codelineno-0-55 name=__codelineno-0-55></a>            <span class=n>example_problems</span><span class=o>=</span><span class=n>example_problems</span><span class=p>,</span>
</span><span id=__span-0-56><a id=__codelineno-0-56 name=__codelineno-0-56></a>            <span class=n>challenge_problem</span><span class=o>=</span><span class=n>datum</span><span class=p>,</span>
</span><span id=__span-0-57><a id=__codelineno-0-57 name=__codelineno-0-57></a>            <span class=n>choices</span><span class=o>=</span><span class=n>choices</span><span class=p>,</span>
</span><span id=__span-0-58><a id=__codelineno-0-58 name=__codelineno-0-58></a>        <span class=p>)</span>
</span><span id=__span-0-59><a id=__codelineno-0-59 name=__codelineno-0-59></a>        <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>start_inference_session</span><span class=p>(</span><span class=s2>&quot;&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>run_task</span><span class=p>(</span><span class=n>base_prompt</span><span class=p>)</span>
</span><span id=__span-0-60><a id=__codelineno-0-60 name=__codelineno-0-60></a>
</span><span id=__span-0-61><a id=__codelineno-0-61 name=__codelineno-0-61></a>        <span class=c1>## Extract the answer from the response</span>
</span><span id=__span-0-62><a id=__codelineno-0-62 name=__codelineno-0-62></a>        <span class=n>extract_answer_prompt</span> <span class=o>=</span> <span class=n>Template</span><span class=p>(</span>
</span><span id=__span-0-63><a id=__codelineno-0-63 name=__codelineno-0-63></a>            <span class=nb>open</span><span class=p>(</span><span class=n>PROMPTS_FOLDER</span> <span class=o>/</span> <span class=s2>&quot;hellaswag_extract_answer.j2&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>(),</span>
</span><span id=__span-0-64><a id=__codelineno-0-64 name=__codelineno-0-64></a>            <span class=n>trim_blocks</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-65><a id=__codelineno-0-65 name=__codelineno-0-65></a>        <span class=p>)</span><span class=o>.</span><span class=n>render</span><span class=p>(</span>
</span><span id=__span-0-66><a id=__codelineno-0-66 name=__codelineno-0-66></a>            <span class=n>challenge_problem</span><span class=o>=</span><span class=n>datum</span><span class=p>,</span>
</span><span id=__span-0-67><a id=__codelineno-0-67 name=__codelineno-0-67></a>            <span class=n>answer_text</span><span class=o>=</span><span class=n>response</span><span class=p>,</span>
</span><span id=__span-0-68><a id=__codelineno-0-68 name=__codelineno-0-68></a>            <span class=n>choices</span><span class=o>=</span><span class=n>choices</span><span class=p>,</span>
</span><span id=__span-0-69><a id=__codelineno-0-69 name=__codelineno-0-69></a>        <span class=p>)</span>
</span><span id=__span-0-70><a id=__codelineno-0-70 name=__codelineno-0-70></a>        <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>start_inference_session</span><span class=p>(</span><span class=s2>&quot;&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>run_task</span><span class=p>(</span><span class=n>extract_answer_prompt</span><span class=p>)</span>
</span><span id=__span-0-71><a id=__codelineno-0-71 name=__codelineno-0-71></a>
</span><span id=__span-0-72><a id=__codelineno-0-72 name=__codelineno-0-72></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-73><a id=__codelineno-0-73 name=__codelineno-0-73></a>            <span class=n>answer</span> <span class=o>=</span> <span class=n>choices</span><span class=o>.</span><span class=n>index</span><span class=p>(</span><span class=n>response</span><span class=p>)</span>
</span><span id=__span-0-74><a id=__codelineno-0-74 name=__codelineno-0-74></a>            <span class=k>return</span> <span class=nb>bool</span><span class=p>(</span><span class=n>answer</span> <span class=o>==</span> <span class=nb>int</span><span class=p>(</span><span class=n>datum</span><span class=p>[</span><span class=s2>&quot;label&quot;</span><span class=p>]))</span>
</span><span id=__span-0-75><a id=__codelineno-0-75 name=__codelineno-0-75></a>        <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
</span><span id=__span-0-76><a id=__codelineno-0-76 name=__codelineno-0-76></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Failed to parse answer&quot;</span><span class=p>)</span>
</span><span id=__span-0-77><a id=__codelineno-0-77 name=__codelineno-0-77></a>            <span class=k>return</span> <span class=kc>False</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-class"> <h4 id=nearai.solvers.LeanSolverStrategy class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">LeanSolverStrategy</span> <a href=#nearai.solvers.LeanSolverStrategy class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title=nearai.solvers.SolverStrategy href=#nearai.solvers.SolverStrategy>SolverStrategy</a></code></p> <p>Solver strategy to evaluate against Lean problems.</p> <details class=quote> <summary>Source code in <code>nearai/solvers/lean_solver.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-123>123</a></span>
<span class=normal><a href=#__codelineno-0-124>124</a></span>
<span class=normal><a href=#__codelineno-0-125>125</a></span>
<span class=normal><a href=#__codelineno-0-126>126</a></span>
<span class=normal><a href=#__codelineno-0-127>127</a></span>
<span class=normal><a href=#__codelineno-0-128>128</a></span>
<span class=normal><a href=#__codelineno-0-129>129</a></span>
<span class=normal><a href=#__codelineno-0-130>130</a></span>
<span class=normal><a href=#__codelineno-0-131>131</a></span>
<span class=normal><a href=#__codelineno-0-132>132</a></span>
<span class=normal><a href=#__codelineno-0-133>133</a></span>
<span class=normal><a href=#__codelineno-0-134>134</a></span>
<span class=normal><a href=#__codelineno-0-135>135</a></span>
<span class=normal><a href=#__codelineno-0-136>136</a></span>
<span class=normal><a href=#__codelineno-0-137>137</a></span>
<span class=normal><a href=#__codelineno-0-138>138</a></span>
<span class=normal><a href=#__codelineno-0-139>139</a></span>
<span class=normal><a href=#__codelineno-0-140>140</a></span>
<span class=normal><a href=#__codelineno-0-141>141</a></span>
<span class=normal><a href=#__codelineno-0-142>142</a></span>
<span class=normal><a href=#__codelineno-0-143>143</a></span>
<span class=normal><a href=#__codelineno-0-144>144</a></span>
<span class=normal><a href=#__codelineno-0-145>145</a></span>
<span class=normal><a href=#__codelineno-0-146>146</a></span>
<span class=normal><a href=#__codelineno-0-147>147</a></span>
<span class=normal><a href=#__codelineno-0-148>148</a></span>
<span class=normal><a href=#__codelineno-0-149>149</a></span>
<span class=normal><a href=#__codelineno-0-150>150</a></span>
<span class=normal><a href=#__codelineno-0-151>151</a></span>
<span class=normal><a href=#__codelineno-0-152>152</a></span>
<span class=normal><a href=#__codelineno-0-153>153</a></span>
<span class=normal><a href=#__codelineno-0-154>154</a></span>
<span class=normal><a href=#__codelineno-0-155>155</a></span>
<span class=normal><a href=#__codelineno-0-156>156</a></span>
<span class=normal><a href=#__codelineno-0-157>157</a></span>
<span class=normal><a href=#__codelineno-0-158>158</a></span>
<span class=normal><a href=#__codelineno-0-159>159</a></span>
<span class=normal><a href=#__codelineno-0-160>160</a></span>
<span class=normal><a href=#__codelineno-0-161>161</a></span>
<span class=normal><a href=#__codelineno-0-162>162</a></span>
<span class=normal><a href=#__codelineno-0-163>163</a></span>
<span class=normal><a href=#__codelineno-0-164>164</a></span>
<span class=normal><a href=#__codelineno-0-165>165</a></span>
<span class=normal><a href=#__codelineno-0-166>166</a></span>
<span class=normal><a href=#__codelineno-0-167>167</a></span>
<span class=normal><a href=#__codelineno-0-168>168</a></span>
<span class=normal><a href=#__codelineno-0-169>169</a></span>
<span class=normal><a href=#__codelineno-0-170>170</a></span>
<span class=normal><a href=#__codelineno-0-171>171</a></span>
<span class=normal><a href=#__codelineno-0-172>172</a></span>
<span class=normal><a href=#__codelineno-0-173>173</a></span>
<span class=normal><a href=#__codelineno-0-174>174</a></span>
<span class=normal><a href=#__codelineno-0-175>175</a></span>
<span class=normal><a href=#__codelineno-0-176>176</a></span>
<span class=normal><a href=#__codelineno-0-177>177</a></span>
<span class=normal><a href=#__codelineno-0-178>178</a></span>
<span class=normal><a href=#__codelineno-0-179>179</a></span>
<span class=normal><a href=#__codelineno-0-180>180</a></span>
<span class=normal><a href=#__codelineno-0-181>181</a></span>
<span class=normal><a href=#__codelineno-0-182>182</a></span>
<span class=normal><a href=#__codelineno-0-183>183</a></span>
<span class=normal><a href=#__codelineno-0-184>184</a></span>
<span class=normal><a href=#__codelineno-0-185>185</a></span>
<span class=normal><a href=#__codelineno-0-186>186</a></span>
<span class=normal><a href=#__codelineno-0-187>187</a></span>
<span class=normal><a href=#__codelineno-0-188>188</a></span>
<span class=normal><a href=#__codelineno-0-189>189</a></span>
<span class=normal><a href=#__codelineno-0-190>190</a></span>
<span class=normal><a href=#__codelineno-0-191>191</a></span>
<span class=normal><a href=#__codelineno-0-192>192</a></span>
<span class=normal><a href=#__codelineno-0-193>193</a></span>
<span class=normal><a href=#__codelineno-0-194>194</a></span>
<span class=normal><a href=#__codelineno-0-195>195</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-123><a id=__codelineno-0-123 name=__codelineno-0-123></a><span class=k>class</span><span class=w> </span><span class=nc>LeanSolverStrategy</span><span class=p>(</span><span class=n>SolverStrategy</span><span class=p>):</span>
</span><span id=__span-0-124><a id=__codelineno-0-124 name=__codelineno-0-124></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Solver strategy to evaluate against Lean problems.&quot;&quot;&quot;</span>
</span><span id=__span-0-125><a id=__codelineno-0-125 name=__codelineno-0-125></a>
</span><span id=__span-0-126><a id=__codelineno-0-126 name=__codelineno-0-126></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span>  <span class=c1># noqa: D107</span>
</span><span id=__span-0-127><a id=__codelineno-0-127 name=__codelineno-0-127></a>        <span class=bp>self</span><span class=p>,</span> <span class=n>dataset_ref</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Dataset</span><span class=p>,</span> <span class=n>DatasetDict</span><span class=p>],</span> <span class=n>model</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>agent</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-128><a id=__codelineno-0-128 name=__codelineno-0-128></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-129><a id=__codelineno-0-129 name=__codelineno-0-129></a>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>agent</span><span class=p>)</span>
</span><span id=__span-0-130><a id=__codelineno-0-130 name=__codelineno-0-130></a>
</span><span id=__span-0-131><a id=__codelineno-0-131 name=__codelineno-0-131></a>    <span class=k>def</span><span class=w> </span><span class=nf>evaluation_name</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-132><a id=__codelineno-0-132 name=__codelineno-0-132></a>        <span class=k>assert</span> <span class=bp>self</span><span class=o>.</span><span class=n>dataset_evaluation_name</span>
</span><span id=__span-0-133><a id=__codelineno-0-133 name=__codelineno-0-133></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>dataset_evaluation_name</span>
</span><span id=__span-0-134><a id=__codelineno-0-134 name=__codelineno-0-134></a>
</span><span id=__span-0-135><a id=__codelineno-0-135 name=__codelineno-0-135></a>    <span class=k>def</span><span class=w> </span><span class=nf>compatible_datasets</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-136><a id=__codelineno-0-136 name=__codelineno-0-136></a>        <span class=k>return</span> <span class=p>[</span><span class=s2>&quot;lean&quot;</span><span class=p>]</span>
</span><span id=__span-0-137><a id=__codelineno-0-137 name=__codelineno-0-137></a>
</span><span id=__span-0-138><a id=__codelineno-0-138 name=__codelineno-0-138></a>    <span class=k>def</span><span class=w> </span><span class=nf>solve</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>datum</span><span class=p>:</span> <span class=nb>dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>bool</span><span class=p>,</span> <span class=nb>dict</span><span class=p>]:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-139><a id=__codelineno-0-139 name=__codelineno-0-139></a>        <span class=n>lean_datum</span> <span class=o>=</span> <span class=n>LeanDatum</span><span class=o>.</span><span class=n>model_validate</span><span class=p>(</span><span class=n>datum</span><span class=p>)</span>
</span><span id=__span-0-140><a id=__codelineno-0-140 name=__codelineno-0-140></a>        <span class=n>lean_datum</span><span class=o>.</span><span class=n>url</span> <span class=o>=</span> <span class=n>load_repository</span><span class=p>(</span><span class=n>lean_datum</span><span class=o>.</span><span class=n>url</span><span class=p>)</span>
</span><span id=__span-0-141><a id=__codelineno-0-141 name=__codelineno-0-141></a>
</span><span id=__span-0-142><a id=__codelineno-0-142 name=__codelineno-0-142></a>        <span class=n>info</span><span class=p>:</span> <span class=nb>dict</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-0-143><a id=__codelineno-0-143 name=__codelineno-0-143></a>        <span class=n>info</span><span class=p>[</span><span class=s2>&quot;verbose&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-0-144><a id=__codelineno-0-144 name=__codelineno-0-144></a>
</span><span id=__span-0-145><a id=__codelineno-0-145 name=__codelineno-0-145></a>        <span class=n>lean_task</span> <span class=o>=</span> <span class=n>LeanTaskInfo</span><span class=p>(</span>
</span><span id=__span-0-146><a id=__codelineno-0-146 name=__codelineno-0-146></a>            <span class=n>lean_datum</span><span class=o>.</span><span class=n>url</span><span class=p>,</span>
</span><span id=__span-0-147><a id=__codelineno-0-147 name=__codelineno-0-147></a>            <span class=n>lean_datum</span><span class=o>.</span><span class=n>commit</span><span class=p>,</span>
</span><span id=__span-0-148><a id=__codelineno-0-148 name=__codelineno-0-148></a>            <span class=n>lean_datum</span><span class=o>.</span><span class=n>filename</span><span class=p>,</span>
</span><span id=__span-0-149><a id=__codelineno-0-149 name=__codelineno-0-149></a>            <span class=n>lean_datum</span><span class=o>.</span><span class=n>theorem</span><span class=p>,</span>
</span><span id=__span-0-150><a id=__codelineno-0-150 name=__codelineno-0-150></a>            <span class=n>load_theorem</span><span class=p>(</span><span class=n>lean_datum</span><span class=p>),</span>
</span><span id=__span-0-151><a id=__codelineno-0-151 name=__codelineno-0-151></a>        <span class=p>)</span>
</span><span id=__span-0-152><a id=__codelineno-0-152 name=__codelineno-0-152></a>        <span class=n>info</span><span class=p>[</span><span class=s2>&quot;verbose&quot;</span><span class=p>][</span><span class=s2>&quot;theorem_raw&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>lean_task</span><span class=o>.</span><span class=n>theorem_raw</span>
</span><span id=__span-0-153><a id=__codelineno-0-153 name=__codelineno-0-153></a>
</span><span id=__span-0-154><a id=__codelineno-0-154 name=__codelineno-0-154></a>        <span class=n>base_prompt</span> <span class=o>=</span> <span class=n>Template</span><span class=p>(</span><span class=nb>open</span><span class=p>(</span><span class=n>PROMPTS_FOLDER</span> <span class=o>/</span> <span class=s2>&quot;lean_answer.j2&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>(),</span> <span class=n>trim_blocks</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span><span class=o>.</span><span class=n>render</span><span class=p>(</span>
</span><span id=__span-0-155><a id=__codelineno-0-155 name=__codelineno-0-155></a>            <span class=n>url</span><span class=o>=</span><span class=n>lean_task</span><span class=o>.</span><span class=n>url</span><span class=p>,</span>
</span><span id=__span-0-156><a id=__codelineno-0-156 name=__codelineno-0-156></a>            <span class=n>commit</span><span class=o>=</span><span class=n>lean_task</span><span class=o>.</span><span class=n>commit</span><span class=p>,</span>
</span><span id=__span-0-157><a id=__codelineno-0-157 name=__codelineno-0-157></a>            <span class=n>filepath</span><span class=o>=</span><span class=n>lean_task</span><span class=o>.</span><span class=n>filename</span><span class=p>,</span>
</span><span id=__span-0-158><a id=__codelineno-0-158 name=__codelineno-0-158></a>            <span class=n>theorem_name</span><span class=o>=</span><span class=n>lean_task</span><span class=o>.</span><span class=n>theorem</span><span class=p>,</span>
</span><span id=__span-0-159><a id=__codelineno-0-159 name=__codelineno-0-159></a>            <span class=n>theorem_raw</span><span class=o>=</span><span class=n>lean_task</span><span class=o>.</span><span class=n>theorem_raw</span><span class=p>,</span>
</span><span id=__span-0-160><a id=__codelineno-0-160 name=__codelineno-0-160></a>            <span class=n>begin_marker</span><span class=o>=</span><span class=n>BEGIN_MARKER</span><span class=p>,</span>
</span><span id=__span-0-161><a id=__codelineno-0-161 name=__codelineno-0-161></a>            <span class=n>end_marker</span><span class=o>=</span><span class=n>END_MARKER</span><span class=p>,</span>
</span><span id=__span-0-162><a id=__codelineno-0-162 name=__codelineno-0-162></a>        <span class=p>)</span>
</span><span id=__span-0-163><a id=__codelineno-0-163 name=__codelineno-0-163></a>        <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>start_inference_session</span><span class=p>(</span><span class=s2>&quot;&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>run_task</span><span class=p>(</span><span class=n>base_prompt</span><span class=p>)</span>
</span><span id=__span-0-164><a id=__codelineno-0-164 name=__codelineno-0-164></a>
</span><span id=__span-0-165><a id=__codelineno-0-165 name=__codelineno-0-165></a>        <span class=n>json_response</span> <span class=o>=</span> <span class=n>extract_between_markers</span><span class=p>(</span><span class=n>response</span><span class=p>)</span>
</span><span id=__span-0-166><a id=__codelineno-0-166 name=__codelineno-0-166></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>json_response</span><span class=p>:</span>
</span><span id=__span-0-167><a id=__codelineno-0-167 name=__codelineno-0-167></a>            <span class=n>info</span><span class=p>[</span><span class=s2>&quot;error&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;Failed to extract between markers.&quot;</span>
</span><span id=__span-0-168><a id=__codelineno-0-168 name=__codelineno-0-168></a>            <span class=n>info</span><span class=p>[</span><span class=s2>&quot;verbose&quot;</span><span class=p>][</span><span class=s2>&quot;response&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>response</span>
</span><span id=__span-0-169><a id=__codelineno-0-169 name=__codelineno-0-169></a>            <span class=k>return</span> <span class=kc>False</span><span class=p>,</span> <span class=n>info</span>
</span><span id=__span-0-170><a id=__codelineno-0-170 name=__codelineno-0-170></a>
</span><span id=__span-0-171><a id=__codelineno-0-171 name=__codelineno-0-171></a>        <span class=n>tactics</span> <span class=o>=</span> <span class=n>parse_tactics</span><span class=p>(</span><span class=n>json_response</span><span class=p>)</span>
</span><span id=__span-0-172><a id=__codelineno-0-172 name=__codelineno-0-172></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>tactics</span><span class=p>:</span>
</span><span id=__span-0-173><a id=__codelineno-0-173 name=__codelineno-0-173></a>            <span class=n>info</span><span class=p>[</span><span class=s2>&quot;error&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;Failed to parse tactics.&quot;</span>
</span><span id=__span-0-174><a id=__codelineno-0-174 name=__codelineno-0-174></a>            <span class=n>info</span><span class=p>[</span><span class=s2>&quot;verbose&quot;</span><span class=p>][</span><span class=s2>&quot;response&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>json_response</span>
</span><span id=__span-0-175><a id=__codelineno-0-175 name=__codelineno-0-175></a>            <span class=k>return</span> <span class=kc>False</span><span class=p>,</span> <span class=n>info</span>
</span><span id=__span-0-176><a id=__codelineno-0-176 name=__codelineno-0-176></a>
</span><span id=__span-0-177><a id=__codelineno-0-177 name=__codelineno-0-177></a>        <span class=c1># Sometimes, there are timeout errors.</span>
</span><span id=__span-0-178><a id=__codelineno-0-178 name=__codelineno-0-178></a>        <span class=n>num_attempts</span> <span class=o>=</span> <span class=mi>3</span>
</span><span id=__span-0-179><a id=__codelineno-0-179 name=__codelineno-0-179></a>        <span class=n>info</span><span class=p>[</span><span class=s2>&quot;tactics&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>tactics</span>
</span><span id=__span-0-180><a id=__codelineno-0-180 name=__codelineno-0-180></a>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>num_attempts</span><span class=p>):</span>
</span><span id=__span-0-181><a id=__codelineno-0-181 name=__codelineno-0-181></a>            <span class=k>if</span> <span class=n>i</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
</span><span id=__span-0-182><a id=__codelineno-0-182 name=__codelineno-0-182></a>                <span class=n>info</span><span class=p>[</span><span class=s2>&quot;check_solution_attempts&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=si>}</span><span class=s2> (max: </span><span class=si>{</span><span class=n>num_attempts</span><span class=si>}</span><span class=s2>)&quot;</span>
</span><span id=__span-0-183><a id=__codelineno-0-183 name=__codelineno-0-183></a>            <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-184><a id=__codelineno-0-184 name=__codelineno-0-184></a>                <span class=n>r</span><span class=p>,</span> <span class=n>m</span> <span class=o>=</span> <span class=n>check_solution</span><span class=p>(</span><span class=n>lean_datum</span><span class=p>,</span> <span class=n>tactics</span><span class=p>)</span>
</span><span id=__span-0-185><a id=__codelineno-0-185 name=__codelineno-0-185></a>                <span class=k>if</span> <span class=n>r</span><span class=p>:</span>
</span><span id=__span-0-186><a id=__codelineno-0-186 name=__codelineno-0-186></a>                    <span class=n>info</span><span class=p>[</span><span class=s2>&quot;verbose&quot;</span><span class=p>][</span><span class=s2>&quot;check_solution_message&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>m</span>
</span><span id=__span-0-187><a id=__codelineno-0-187 name=__codelineno-0-187></a>                <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-188><a id=__codelineno-0-188 name=__codelineno-0-188></a>                    <span class=n>info</span><span class=p>[</span><span class=s2>&quot;check_solution_message&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>m</span>
</span><span id=__span-0-189><a id=__codelineno-0-189 name=__codelineno-0-189></a>                <span class=k>return</span> <span class=n>r</span><span class=p>,</span> <span class=n>info</span>
</span><span id=__span-0-190><a id=__codelineno-0-190 name=__codelineno-0-190></a>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-191><a id=__codelineno-0-191 name=__codelineno-0-191></a>                <span class=k>if</span> <span class=n>i</span> <span class=o>==</span> <span class=n>num_attempts</span> <span class=o>-</span> <span class=mi>1</span><span class=p>:</span>
</span><span id=__span-0-192><a id=__codelineno-0-192 name=__codelineno-0-192></a>                    <span class=n>error_message</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;Exception while checking solution: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>.&quot;</span>
</span><span id=__span-0-193><a id=__codelineno-0-193 name=__codelineno-0-193></a>                    <span class=nb>print</span><span class=p>(</span><span class=n>error_message</span><span class=p>)</span>
</span><span id=__span-0-194><a id=__codelineno-0-194 name=__codelineno-0-194></a>                    <span class=n>info</span><span class=p>[</span><span class=s2>&quot;error&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>error_message</span>
</span><span id=__span-0-195><a id=__codelineno-0-195 name=__codelineno-0-195></a>        <span class=k>return</span> <span class=kc>False</span><span class=p>,</span> <span class=n>info</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-class"> <h4 id=nearai.solvers.LiveBenchSolverStrategy class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">LiveBenchSolverStrategy</span> <a href=#nearai.solvers.LiveBenchSolverStrategy class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title=nearai.solvers.SolverStrategy href=#nearai.solvers.SolverStrategy>SolverStrategy</a></code></p> <p>Solver strategy for the live bench dataset.</p> <details class=quote> <summary>Source code in <code>nearai/solvers/livebench_solver.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-66> 66</a></span>
<span class=normal><a href=#__codelineno-0-67> 67</a></span>
<span class=normal><a href=#__codelineno-0-68> 68</a></span>
<span class=normal><a href=#__codelineno-0-69> 69</a></span>
<span class=normal><a href=#__codelineno-0-70> 70</a></span>
<span class=normal><a href=#__codelineno-0-71> 71</a></span>
<span class=normal><a href=#__codelineno-0-72> 72</a></span>
<span class=normal><a href=#__codelineno-0-73> 73</a></span>
<span class=normal><a href=#__codelineno-0-74> 74</a></span>
<span class=normal><a href=#__codelineno-0-75> 75</a></span>
<span class=normal><a href=#__codelineno-0-76> 76</a></span>
<span class=normal><a href=#__codelineno-0-77> 77</a></span>
<span class=normal><a href=#__codelineno-0-78> 78</a></span>
<span class=normal><a href=#__codelineno-0-79> 79</a></span>
<span class=normal><a href=#__codelineno-0-80> 80</a></span>
<span class=normal><a href=#__codelineno-0-81> 81</a></span>
<span class=normal><a href=#__codelineno-0-82> 82</a></span>
<span class=normal><a href=#__codelineno-0-83> 83</a></span>
<span class=normal><a href=#__codelineno-0-84> 84</a></span>
<span class=normal><a href=#__codelineno-0-85> 85</a></span>
<span class=normal><a href=#__codelineno-0-86> 86</a></span>
<span class=normal><a href=#__codelineno-0-87> 87</a></span>
<span class=normal><a href=#__codelineno-0-88> 88</a></span>
<span class=normal><a href=#__codelineno-0-89> 89</a></span>
<span class=normal><a href=#__codelineno-0-90> 90</a></span>
<span class=normal><a href=#__codelineno-0-91> 91</a></span>
<span class=normal><a href=#__codelineno-0-92> 92</a></span>
<span class=normal><a href=#__codelineno-0-93> 93</a></span>
<span class=normal><a href=#__codelineno-0-94> 94</a></span>
<span class=normal><a href=#__codelineno-0-95> 95</a></span>
<span class=normal><a href=#__codelineno-0-96> 96</a></span>
<span class=normal><a href=#__codelineno-0-97> 97</a></span>
<span class=normal><a href=#__codelineno-0-98> 98</a></span>
<span class=normal><a href=#__codelineno-0-99> 99</a></span>
<span class=normal><a href=#__codelineno-0-100>100</a></span>
<span class=normal><a href=#__codelineno-0-101>101</a></span>
<span class=normal><a href=#__codelineno-0-102>102</a></span>
<span class=normal><a href=#__codelineno-0-103>103</a></span>
<span class=normal><a href=#__codelineno-0-104>104</a></span>
<span class=normal><a href=#__codelineno-0-105>105</a></span>
<span class=normal><a href=#__codelineno-0-106>106</a></span>
<span class=normal><a href=#__codelineno-0-107>107</a></span>
<span class=normal><a href=#__codelineno-0-108>108</a></span>
<span class=normal><a href=#__codelineno-0-109>109</a></span>
<span class=normal><a href=#__codelineno-0-110>110</a></span>
<span class=normal><a href=#__codelineno-0-111>111</a></span>
<span class=normal><a href=#__codelineno-0-112>112</a></span>
<span class=normal><a href=#__codelineno-0-113>113</a></span>
<span class=normal><a href=#__codelineno-0-114>114</a></span>
<span class=normal><a href=#__codelineno-0-115>115</a></span>
<span class=normal><a href=#__codelineno-0-116>116</a></span>
<span class=normal><a href=#__codelineno-0-117>117</a></span>
<span class=normal><a href=#__codelineno-0-118>118</a></span>
<span class=normal><a href=#__codelineno-0-119>119</a></span>
<span class=normal><a href=#__codelineno-0-120>120</a></span>
<span class=normal><a href=#__codelineno-0-121>121</a></span>
<span class=normal><a href=#__codelineno-0-122>122</a></span>
<span class=normal><a href=#__codelineno-0-123>123</a></span>
<span class=normal><a href=#__codelineno-0-124>124</a></span>
<span class=normal><a href=#__codelineno-0-125>125</a></span>
<span class=normal><a href=#__codelineno-0-126>126</a></span>
<span class=normal><a href=#__codelineno-0-127>127</a></span>
<span class=normal><a href=#__codelineno-0-128>128</a></span>
<span class=normal><a href=#__codelineno-0-129>129</a></span>
<span class=normal><a href=#__codelineno-0-130>130</a></span>
<span class=normal><a href=#__codelineno-0-131>131</a></span>
<span class=normal><a href=#__codelineno-0-132>132</a></span>
<span class=normal><a href=#__codelineno-0-133>133</a></span>
<span class=normal><a href=#__codelineno-0-134>134</a></span>
<span class=normal><a href=#__codelineno-0-135>135</a></span>
<span class=normal><a href=#__codelineno-0-136>136</a></span>
<span class=normal><a href=#__codelineno-0-137>137</a></span>
<span class=normal><a href=#__codelineno-0-138>138</a></span>
<span class=normal><a href=#__codelineno-0-139>139</a></span>
<span class=normal><a href=#__codelineno-0-140>140</a></span>
<span class=normal><a href=#__codelineno-0-141>141</a></span>
<span class=normal><a href=#__codelineno-0-142>142</a></span>
<span class=normal><a href=#__codelineno-0-143>143</a></span>
<span class=normal><a href=#__codelineno-0-144>144</a></span>
<span class=normal><a href=#__codelineno-0-145>145</a></span>
<span class=normal><a href=#__codelineno-0-146>146</a></span>
<span class=normal><a href=#__codelineno-0-147>147</a></span>
<span class=normal><a href=#__codelineno-0-148>148</a></span>
<span class=normal><a href=#__codelineno-0-149>149</a></span>
<span class=normal><a href=#__codelineno-0-150>150</a></span>
<span class=normal><a href=#__codelineno-0-151>151</a></span>
<span class=normal><a href=#__codelineno-0-152>152</a></span>
<span class=normal><a href=#__codelineno-0-153>153</a></span>
<span class=normal><a href=#__codelineno-0-154>154</a></span>
<span class=normal><a href=#__codelineno-0-155>155</a></span>
<span class=normal><a href=#__codelineno-0-156>156</a></span>
<span class=normal><a href=#__codelineno-0-157>157</a></span>
<span class=normal><a href=#__codelineno-0-158>158</a></span>
<span class=normal><a href=#__codelineno-0-159>159</a></span>
<span class=normal><a href=#__codelineno-0-160>160</a></span>
<span class=normal><a href=#__codelineno-0-161>161</a></span>
<span class=normal><a href=#__codelineno-0-162>162</a></span>
<span class=normal><a href=#__codelineno-0-163>163</a></span>
<span class=normal><a href=#__codelineno-0-164>164</a></span>
<span class=normal><a href=#__codelineno-0-165>165</a></span>
<span class=normal><a href=#__codelineno-0-166>166</a></span>
<span class=normal><a href=#__codelineno-0-167>167</a></span>
<span class=normal><a href=#__codelineno-0-168>168</a></span>
<span class=normal><a href=#__codelineno-0-169>169</a></span>
<span class=normal><a href=#__codelineno-0-170>170</a></span>
<span class=normal><a href=#__codelineno-0-171>171</a></span>
<span class=normal><a href=#__codelineno-0-172>172</a></span>
<span class=normal><a href=#__codelineno-0-173>173</a></span>
<span class=normal><a href=#__codelineno-0-174>174</a></span>
<span class=normal><a href=#__codelineno-0-175>175</a></span>
<span class=normal><a href=#__codelineno-0-176>176</a></span>
<span class=normal><a href=#__codelineno-0-177>177</a></span>
<span class=normal><a href=#__codelineno-0-178>178</a></span>
<span class=normal><a href=#__codelineno-0-179>179</a></span>
<span class=normal><a href=#__codelineno-0-180>180</a></span>
<span class=normal><a href=#__codelineno-0-181>181</a></span>
<span class=normal><a href=#__codelineno-0-182>182</a></span>
<span class=normal><a href=#__codelineno-0-183>183</a></span>
<span class=normal><a href=#__codelineno-0-184>184</a></span>
<span class=normal><a href=#__codelineno-0-185>185</a></span>
<span class=normal><a href=#__codelineno-0-186>186</a></span>
<span class=normal><a href=#__codelineno-0-187>187</a></span>
<span class=normal><a href=#__codelineno-0-188>188</a></span>
<span class=normal><a href=#__codelineno-0-189>189</a></span>
<span class=normal><a href=#__codelineno-0-190>190</a></span>
<span class=normal><a href=#__codelineno-0-191>191</a></span>
<span class=normal><a href=#__codelineno-0-192>192</a></span>
<span class=normal><a href=#__codelineno-0-193>193</a></span>
<span class=normal><a href=#__codelineno-0-194>194</a></span>
<span class=normal><a href=#__codelineno-0-195>195</a></span>
<span class=normal><a href=#__codelineno-0-196>196</a></span>
<span class=normal><a href=#__codelineno-0-197>197</a></span>
<span class=normal><a href=#__codelineno-0-198>198</a></span>
<span class=normal><a href=#__codelineno-0-199>199</a></span>
<span class=normal><a href=#__codelineno-0-200>200</a></span>
<span class=normal><a href=#__codelineno-0-201>201</a></span>
<span class=normal><a href=#__codelineno-0-202>202</a></span>
<span class=normal><a href=#__codelineno-0-203>203</a></span>
<span class=normal><a href=#__codelineno-0-204>204</a></span>
<span class=normal><a href=#__codelineno-0-205>205</a></span>
<span class=normal><a href=#__codelineno-0-206>206</a></span>
<span class=normal><a href=#__codelineno-0-207>207</a></span>
<span class=normal><a href=#__codelineno-0-208>208</a></span>
<span class=normal><a href=#__codelineno-0-209>209</a></span>
<span class=normal><a href=#__codelineno-0-210>210</a></span>
<span class=normal><a href=#__codelineno-0-211>211</a></span>
<span class=normal><a href=#__codelineno-0-212>212</a></span>
<span class=normal><a href=#__codelineno-0-213>213</a></span>
<span class=normal><a href=#__codelineno-0-214>214</a></span>
<span class=normal><a href=#__codelineno-0-215>215</a></span>
<span class=normal><a href=#__codelineno-0-216>216</a></span>
<span class=normal><a href=#__codelineno-0-217>217</a></span>
<span class=normal><a href=#__codelineno-0-218>218</a></span>
<span class=normal><a href=#__codelineno-0-219>219</a></span>
<span class=normal><a href=#__codelineno-0-220>220</a></span>
<span class=normal><a href=#__codelineno-0-221>221</a></span>
<span class=normal><a href=#__codelineno-0-222>222</a></span>
<span class=normal><a href=#__codelineno-0-223>223</a></span>
<span class=normal><a href=#__codelineno-0-224>224</a></span>
<span class=normal><a href=#__codelineno-0-225>225</a></span>
<span class=normal><a href=#__codelineno-0-226>226</a></span>
<span class=normal><a href=#__codelineno-0-227>227</a></span>
<span class=normal><a href=#__codelineno-0-228>228</a></span>
<span class=normal><a href=#__codelineno-0-229>229</a></span>
<span class=normal><a href=#__codelineno-0-230>230</a></span>
<span class=normal><a href=#__codelineno-0-231>231</a></span>
<span class=normal><a href=#__codelineno-0-232>232</a></span>
<span class=normal><a href=#__codelineno-0-233>233</a></span>
<span class=normal><a href=#__codelineno-0-234>234</a></span>
<span class=normal><a href=#__codelineno-0-235>235</a></span>
<span class=normal><a href=#__codelineno-0-236>236</a></span>
<span class=normal><a href=#__codelineno-0-237>237</a></span>
<span class=normal><a href=#__codelineno-0-238>238</a></span>
<span class=normal><a href=#__codelineno-0-239>239</a></span>
<span class=normal><a href=#__codelineno-0-240>240</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-66><a id=__codelineno-0-66 name=__codelineno-0-66></a><span class=k>class</span><span class=w> </span><span class=nc>LiveBenchSolverStrategy</span><span class=p>(</span><span class=n>SolverStrategy</span><span class=p>):</span>
</span><span id=__span-0-67><a id=__codelineno-0-67 name=__codelineno-0-67></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Solver strategy for the live bench dataset.&quot;&quot;&quot;</span>
</span><span id=__span-0-68><a id=__codelineno-0-68 name=__codelineno-0-68></a>
</span><span id=__span-0-69><a id=__codelineno-0-69 name=__codelineno-0-69></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span>  <span class=c1># noqa: D107</span>
</span><span id=__span-0-70><a id=__codelineno-0-70 name=__codelineno-0-70></a>        <span class=bp>self</span><span class=p>,</span> <span class=n>dataset_ref</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>model</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>agent</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>step</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;all&quot;</span>
</span><span id=__span-0-71><a id=__codelineno-0-71 name=__codelineno-0-71></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-72><a id=__codelineno-0-72 name=__codelineno-0-72></a>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>agent</span><span class=p>)</span>
</span><span id=__span-0-73><a id=__codelineno-0-73 name=__codelineno-0-73></a>        <span class=bp>self</span><span class=o>.</span><span class=n>dataset_ref</span> <span class=o>=</span> <span class=n>dataset_ref</span>
</span><span id=__span-0-74><a id=__codelineno-0-74 name=__codelineno-0-74></a>        <span class=bp>self</span><span class=o>.</span><span class=n>step</span> <span class=o>=</span> <span class=n>step</span>
</span><span id=__span-0-75><a id=__codelineno-0-75 name=__codelineno-0-75></a>
</span><span id=__span-0-76><a id=__codelineno-0-76 name=__codelineno-0-76></a>    <span class=k>def</span><span class=w> </span><span class=nf>evaluation_name</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-77><a id=__codelineno-0-77 name=__codelineno-0-77></a>        <span class=k>return</span> <span class=s2>&quot;live_bench&quot;</span>
</span><span id=__span-0-78><a id=__codelineno-0-78 name=__codelineno-0-78></a>
</span><span id=__span-0-79><a id=__codelineno-0-79 name=__codelineno-0-79></a>    <span class=k>def</span><span class=w> </span><span class=nf>compatible_datasets</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-80><a id=__codelineno-0-80 name=__codelineno-0-80></a>        <span class=k>return</span> <span class=p>[</span><span class=s2>&quot;live_bench&quot;</span><span class=p>]</span>
</span><span id=__span-0-81><a id=__codelineno-0-81 name=__codelineno-0-81></a>
</span><span id=__span-0-82><a id=__codelineno-0-82 name=__codelineno-0-82></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_custom_tasks</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>dict</span><span class=p>]:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-83><a id=__codelineno-0-83 name=__codelineno-0-83></a>        <span class=k>return</span> <span class=p>[{</span><span class=s2>&quot;summary&quot;</span><span class=p>:</span> <span class=s2>&quot;all&quot;</span><span class=p>}]</span>
</span><span id=__span-0-84><a id=__codelineno-0-84 name=__codelineno-0-84></a>
</span><span id=__span-0-85><a id=__codelineno-0-85 name=__codelineno-0-85></a>    <span class=nd>@property</span>
</span><span id=__span-0-86><a id=__codelineno-0-86 name=__codelineno-0-86></a>    <span class=k>def</span><span class=w> </span><span class=nf>evaluated_entry_name</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-87><a id=__codelineno-0-87 name=__codelineno-0-87></a>        <span class=n>name</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-88><a id=__codelineno-0-88 name=__codelineno-0-88></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>agent</span><span class=p>:</span>
</span><span id=__span-0-89><a id=__codelineno-0-89 name=__codelineno-0-89></a>            <span class=n>name</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>agent_name</span><span class=p>()</span>
</span><span id=__span-0-90><a id=__codelineno-0-90 name=__codelineno-0-90></a>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>model_name</span> <span class=o>!=</span> <span class=s2>&quot;&quot;</span><span class=p>:</span>
</span><span id=__span-0-91><a id=__codelineno-0-91 name=__codelineno-0-91></a>                <span class=n>name</span> <span class=o>+=</span> <span class=sa>f</span><span class=s2>&quot;_with_model_</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>model_name</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-92><a id=__codelineno-0-92 name=__codelineno-0-92></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-93><a id=__codelineno-0-93 name=__codelineno-0-93></a>            <span class=n>name</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>model_name</span>
</span><span id=__span-0-94><a id=__codelineno-0-94 name=__codelineno-0-94></a>        <span class=k>assert</span> <span class=s2>&quot;/&quot;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>name</span>
</span><span id=__span-0-95><a id=__codelineno-0-95 name=__codelineno-0-95></a>        <span class=k>return</span> <span class=n>name</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
</span><span id=__span-0-96><a id=__codelineno-0-96 name=__codelineno-0-96></a>
</span><span id=__span-0-97><a id=__codelineno-0-97 name=__codelineno-0-97></a>    <span class=nd>@SolverStrategyClassProperty</span>
</span><span id=__span-0-98><a id=__codelineno-0-98 name=__codelineno-0-98></a>    <span class=k>def</span><span class=w> </span><span class=nf>scoring_method</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>SolverScoringMethod</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-99><a id=__codelineno-0-99 name=__codelineno-0-99></a>        <span class=k>return</span> <span class=n>SolverScoringMethod</span><span class=o>.</span><span class=n>Custom</span>
</span><span id=__span-0-100><a id=__codelineno-0-100 name=__codelineno-0-100></a>
</span><span id=__span-0-101><a id=__codelineno-0-101 name=__codelineno-0-101></a>    <span class=k>def</span><span class=w> </span><span class=nf>solve</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>_datum</span><span class=p>:</span> <span class=nb>dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>bool</span><span class=p>,</span> <span class=nb>dict</span><span class=p>]:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-102><a id=__codelineno-0-102 name=__codelineno-0-102></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>step</span> <span class=o>==</span> <span class=s2>&quot;gen_model_answer&quot;</span><span class=p>:</span>
</span><span id=__span-0-103><a id=__codelineno-0-103 name=__codelineno-0-103></a>            <span class=bp>self</span><span class=o>.</span><span class=n>gen_model_answer</span><span class=p>()</span>
</span><span id=__span-0-104><a id=__codelineno-0-104 name=__codelineno-0-104></a>            <span class=k>return</span> <span class=kc>True</span><span class=p>,</span> <span class=p>{}</span>
</span><span id=__span-0-105><a id=__codelineno-0-105 name=__codelineno-0-105></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>step</span> <span class=o>==</span> <span class=s2>&quot;gen_ground_truth_judgement&quot;</span><span class=p>:</span>
</span><span id=__span-0-106><a id=__codelineno-0-106 name=__codelineno-0-106></a>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>gen_ground_truth_judgement</span><span class=p>(),</span> <span class=p>{}</span>
</span><span id=__span-0-107><a id=__codelineno-0-107 name=__codelineno-0-107></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>step</span> <span class=o>==</span> <span class=s2>&quot;show_livebench_results&quot;</span><span class=p>:</span>
</span><span id=__span-0-108><a id=__codelineno-0-108 name=__codelineno-0-108></a>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>show_livebench_results</span><span class=p>()</span>
</span><span id=__span-0-109><a id=__codelineno-0-109 name=__codelineno-0-109></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>step</span> <span class=o>==</span> <span class=s2>&quot;all&quot;</span><span class=p>:</span>
</span><span id=__span-0-110><a id=__codelineno-0-110 name=__codelineno-0-110></a>            <span class=bp>self</span><span class=o>.</span><span class=n>gen_model_answer</span><span class=p>()</span>
</span><span id=__span-0-111><a id=__codelineno-0-111 name=__codelineno-0-111></a>            <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>gen_ground_truth_judgement</span><span class=p>():</span>
</span><span id=__span-0-112><a id=__codelineno-0-112 name=__codelineno-0-112></a>                <span class=k>return</span> <span class=kc>False</span><span class=p>,</span> <span class=p>{}</span>
</span><span id=__span-0-113><a id=__codelineno-0-113 name=__codelineno-0-113></a>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>show_livebench_results</span><span class=p>()</span>
</span><span id=__span-0-114><a id=__codelineno-0-114 name=__codelineno-0-114></a>        <span class=k>return</span> <span class=kc>False</span><span class=p>,</span> <span class=p>{}</span>
</span><span id=__span-0-115><a id=__codelineno-0-115 name=__codelineno-0-115></a>
</span><span id=__span-0-116><a id=__codelineno-0-116 name=__codelineno-0-116></a>    <span class=k>def</span><span class=w> </span><span class=nf>gen_model_answer</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-117><a id=__codelineno-0-117 name=__codelineno-0-117></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;&quot;</span><span class=p>)</span>
</span><span id=__span-0-118><a id=__codelineno-0-118 name=__codelineno-0-118></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;----------- Step gen_model_answer -----------&quot;</span><span class=p>)</span>
</span><span id=__span-0-119><a id=__codelineno-0-119 name=__codelineno-0-119></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;&quot;</span><span class=p>)</span>
</span><span id=__span-0-120><a id=__codelineno-0-120 name=__codelineno-0-120></a>        <span class=n>list_of_question_files</span> <span class=o>=</span> <span class=n>glob</span><span class=o>.</span><span class=n>glob</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>dataset_ref</span><span class=si>}</span><span class=s2>/**/question.jsonl&quot;</span><span class=p>,</span> <span class=n>recursive</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-121><a id=__codelineno-0-121 name=__codelineno-0-121></a>        <span class=k>for</span> <span class=n>question_file</span> <span class=ow>in</span> <span class=n>list_of_question_files</span><span class=p>:</span>
</span><span id=__span-0-122><a id=__codelineno-0-122 name=__codelineno-0-122></a>            <span class=n>questions</span> <span class=o>=</span> <span class=n>load_questions_jsonl</span><span class=p>(</span><span class=n>question_file</span><span class=p>)</span>
</span><span id=__span-0-123><a id=__codelineno-0-123 name=__codelineno-0-123></a>            <span class=n>bench_name</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=n>question_file</span><span class=p>)</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>dataset_ref</span><span class=p>))[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span><span id=__span-0-124><a id=__codelineno-0-124 name=__codelineno-0-124></a>            <span class=n>answer_file</span> <span class=o>=</span> <span class=n>_get_answer_file_path</span><span class=p>(</span><span class=n>bench_name</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>evaluated_entry_name</span><span class=p>)</span>
</span><span id=__span-0-125><a id=__codelineno-0-125 name=__codelineno-0-125></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Questions from </span><span class=si>{</span><span class=n>question_file</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-126><a id=__codelineno-0-126 name=__codelineno-0-126></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Output to </span><span class=si>{</span><span class=n>answer_file</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-127><a id=__codelineno-0-127 name=__codelineno-0-127></a>            <span class=bp>self</span><span class=o>.</span><span class=n>run_eval</span><span class=p>(</span><span class=n>questions</span><span class=p>,</span> <span class=n>answer_file</span><span class=p>)</span>
</span><span id=__span-0-128><a id=__codelineno-0-128 name=__codelineno-0-128></a>
</span><span id=__span-0-129><a id=__codelineno-0-129 name=__codelineno-0-129></a>    <span class=k>def</span><span class=w> </span><span class=nf>run_eval</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>questions</span><span class=p>,</span> <span class=n>answer_file</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-130><a id=__codelineno-0-130 name=__codelineno-0-130></a>        <span class=n>answer_file</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>expanduser</span><span class=p>(</span><span class=n>answer_file</span><span class=p>)</span>
</span><span id=__span-0-131><a id=__codelineno-0-131 name=__codelineno-0-131></a>
</span><span id=__span-0-132><a id=__codelineno-0-132 name=__codelineno-0-132></a>        <span class=c1># Load existing answers</span>
</span><span id=__span-0-133><a id=__codelineno-0-133 name=__codelineno-0-133></a>        <span class=n>existing_answers</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
</span><span id=__span-0-134><a id=__codelineno-0-134 name=__codelineno-0-134></a>        <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>answer_file</span><span class=p>):</span>
</span><span id=__span-0-135><a id=__codelineno-0-135 name=__codelineno-0-135></a>            <span class=nb>print</span><span class=p>(</span>
</span><span id=__span-0-136><a id=__codelineno-0-136 name=__codelineno-0-136></a>                <span class=sa>f</span><span class=s2>&quot;Answer file </span><span class=si>{</span><span class=n>answer_file</span><span class=si>}</span><span class=s2> exists. Will skip already answered questions. Delete this file if that is not intended.&quot;</span>  <span class=c1># noqa: E501</span>
</span><span id=__span-0-137><a id=__codelineno-0-137 name=__codelineno-0-137></a>            <span class=p>)</span>
</span><span id=__span-0-138><a id=__codelineno-0-138 name=__codelineno-0-138></a>            <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>answer_file</span><span class=p>,</span> <span class=s2>&quot;r&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>fin</span><span class=p>:</span>
</span><span id=__span-0-139><a id=__codelineno-0-139 name=__codelineno-0-139></a>                <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>fin</span><span class=p>:</span>
</span><span id=__span-0-140><a id=__codelineno-0-140 name=__codelineno-0-140></a>                    <span class=n>answer</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>line</span><span class=p>)</span>
</span><span id=__span-0-141><a id=__codelineno-0-141 name=__codelineno-0-141></a>                    <span class=n>existing_answers</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>answer</span><span class=p>[</span><span class=s2>&quot;question_id&quot;</span><span class=p>])</span>
</span><span id=__span-0-142><a id=__codelineno-0-142 name=__codelineno-0-142></a>
</span><span id=__span-0-143><a id=__codelineno-0-143 name=__codelineno-0-143></a>        <span class=k>for</span> <span class=n>question</span> <span class=ow>in</span> <span class=n>tqdm</span><span class=p>(</span><span class=n>questions</span><span class=p>):</span>
</span><span id=__span-0-144><a id=__codelineno-0-144 name=__codelineno-0-144></a>            <span class=k>if</span> <span class=n>question</span><span class=p>[</span><span class=s2>&quot;question_id&quot;</span><span class=p>]</span> <span class=ow>in</span> <span class=n>existing_answers</span><span class=p>:</span>
</span><span id=__span-0-145><a id=__codelineno-0-145 name=__codelineno-0-145></a>                <span class=k>continue</span>
</span><span id=__span-0-146><a id=__codelineno-0-146 name=__codelineno-0-146></a>            <span class=n>choices</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>answer_question</span><span class=p>(</span><span class=n>question</span><span class=p>)</span>
</span><span id=__span-0-147><a id=__codelineno-0-147 name=__codelineno-0-147></a>
</span><span id=__span-0-148><a id=__codelineno-0-148 name=__codelineno-0-148></a>            <span class=n>ans_json</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-149><a id=__codelineno-0-149 name=__codelineno-0-149></a>                <span class=s2>&quot;question_id&quot;</span><span class=p>:</span> <span class=n>question</span><span class=p>[</span><span class=s2>&quot;question_id&quot;</span><span class=p>],</span>
</span><span id=__span-0-150><a id=__codelineno-0-150 name=__codelineno-0-150></a>                <span class=s2>&quot;answer_id&quot;</span><span class=p>:</span> <span class=n>shortuuid</span><span class=o>.</span><span class=n>uuid</span><span class=p>(),</span>
</span><span id=__span-0-151><a id=__codelineno-0-151 name=__codelineno-0-151></a>                <span class=s2>&quot;model_id&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>evaluated_entry_name</span><span class=p>,</span>
</span><span id=__span-0-152><a id=__codelineno-0-152 name=__codelineno-0-152></a>                <span class=s2>&quot;choices&quot;</span><span class=p>:</span> <span class=n>choices</span><span class=p>,</span>
</span><span id=__span-0-153><a id=__codelineno-0-153 name=__codelineno-0-153></a>                <span class=s2>&quot;tstamp&quot;</span><span class=p>:</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>(),</span>
</span><span id=__span-0-154><a id=__codelineno-0-154 name=__codelineno-0-154></a>            <span class=p>}</span>
</span><span id=__span-0-155><a id=__codelineno-0-155 name=__codelineno-0-155></a>
</span><span id=__span-0-156><a id=__codelineno-0-156 name=__codelineno-0-156></a>            <span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=n>answer_file</span><span class=p>),</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-157><a id=__codelineno-0-157 name=__codelineno-0-157></a>            <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>answer_file</span><span class=p>,</span> <span class=s2>&quot;a&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>fout</span><span class=p>:</span>
</span><span id=__span-0-158><a id=__codelineno-0-158 name=__codelineno-0-158></a>                <span class=n>fout</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>ans_json</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-159><a id=__codelineno-0-159 name=__codelineno-0-159></a>
</span><span id=__span-0-160><a id=__codelineno-0-160 name=__codelineno-0-160></a>    <span class=k>def</span><span class=w> </span><span class=nf>answer_question</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>question</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>dict</span><span class=p>]:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-161><a id=__codelineno-0-161 name=__codelineno-0-161></a>        <span class=n>turns</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-0-162><a id=__codelineno-0-162 name=__codelineno-0-162></a>        <span class=n>session</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>start_inference_session</span><span class=p>(</span><span class=n>question</span><span class=p>[</span><span class=s2>&quot;question_id&quot;</span><span class=p>])</span>
</span><span id=__span-0-163><a id=__codelineno-0-163 name=__codelineno-0-163></a>        <span class=k>for</span> <span class=n>qs</span> <span class=ow>in</span> <span class=n>question</span><span class=p>[</span><span class=s2>&quot;turns&quot;</span><span class=p>]:</span>
</span><span id=__span-0-164><a id=__codelineno-0-164 name=__codelineno-0-164></a>            <span class=n>output</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>run_task</span><span class=p>(</span><span class=n>qs</span><span class=p>)</span>
</span><span id=__span-0-165><a id=__codelineno-0-165 name=__codelineno-0-165></a>            <span class=n>turns</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>output</span><span class=p>)</span>
</span><span id=__span-0-166><a id=__codelineno-0-166 name=__codelineno-0-166></a>
</span><span id=__span-0-167><a id=__codelineno-0-167 name=__codelineno-0-167></a>        <span class=k>return</span> <span class=p>[{</span><span class=s2>&quot;index&quot;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=s2>&quot;turns&quot;</span><span class=p>:</span> <span class=n>turns</span><span class=p>}]</span>
</span><span id=__span-0-168><a id=__codelineno-0-168 name=__codelineno-0-168></a>
</span><span id=__span-0-169><a id=__codelineno-0-169 name=__codelineno-0-169></a>    <span class=k>def</span><span class=w> </span><span class=nf>gen_ground_truth_judgement</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-170><a id=__codelineno-0-170 name=__codelineno-0-170></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;&quot;</span><span class=p>)</span>
</span><span id=__span-0-171><a id=__codelineno-0-171 name=__codelineno-0-171></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;----------- Step gen_ground_truth_judgement -----------&quot;</span><span class=p>)</span>
</span><span id=__span-0-172><a id=__codelineno-0-172 name=__codelineno-0-172></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;&quot;</span><span class=p>)</span>
</span><span id=__span-0-173><a id=__codelineno-0-173 name=__codelineno-0-173></a>        <span class=n>script_path</span> <span class=o>=</span> <span class=s2>&quot;nearai/projects/live_bench/gen_ground_truth_judgement.sh&quot;</span>
</span><span id=__span-0-174><a id=__codelineno-0-174 name=__codelineno-0-174></a>
</span><span id=__span-0-175><a id=__codelineno-0-175 name=__codelineno-0-175></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-176><a id=__codelineno-0-176 name=__codelineno-0-176></a>            <span class=c1># Run the script without capturing output</span>
</span><span id=__span-0-177><a id=__codelineno-0-177 name=__codelineno-0-177></a>            <span class=n>subprocess</span><span class=o>.</span><span class=n>run</span><span class=p>([</span><span class=s2>&quot;/bin/bash&quot;</span><span class=p>,</span> <span class=n>script_path</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>evaluated_entry_name</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>dataset_ref</span><span class=p>],</span> <span class=n>check</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-178><a id=__codelineno-0-178 name=__codelineno-0-178></a>            <span class=k>return</span> <span class=kc>True</span>
</span><span id=__span-0-179><a id=__codelineno-0-179 name=__codelineno-0-179></a>
</span><span id=__span-0-180><a id=__codelineno-0-180 name=__codelineno-0-180></a>        <span class=k>except</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>CalledProcessError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-181><a id=__codelineno-0-181 name=__codelineno-0-181></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;An error occurred while running the script: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-182><a id=__codelineno-0-182 name=__codelineno-0-182></a>            <span class=k>return</span> <span class=kc>False</span>
</span><span id=__span-0-183><a id=__codelineno-0-183 name=__codelineno-0-183></a>
</span><span id=__span-0-184><a id=__codelineno-0-184 name=__codelineno-0-184></a>    <span class=k>def</span><span class=w> </span><span class=nf>show_livebench_results</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>bool</span><span class=p>,</span> <span class=nb>dict</span><span class=p>]:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-185><a id=__codelineno-0-185 name=__codelineno-0-185></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;&quot;</span><span class=p>)</span>
</span><span id=__span-0-186><a id=__codelineno-0-186 name=__codelineno-0-186></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;----------- Step show_livebench_results -----------&quot;</span><span class=p>)</span>
</span><span id=__span-0-187><a id=__codelineno-0-187 name=__codelineno-0-187></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;&quot;</span><span class=p>)</span>
</span><span id=__span-0-188><a id=__codelineno-0-188 name=__codelineno-0-188></a>        <span class=n>script_path</span> <span class=o>=</span> <span class=s2>&quot;nearai/projects/live_bench/show_livebench_results.sh&quot;</span>
</span><span id=__span-0-189><a id=__codelineno-0-189 name=__codelineno-0-189></a>
</span><span id=__span-0-190><a id=__codelineno-0-190 name=__codelineno-0-190></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-191><a id=__codelineno-0-191 name=__codelineno-0-191></a>            <span class=c1># Run the script without capturing output</span>
</span><span id=__span-0-192><a id=__codelineno-0-192 name=__codelineno-0-192></a>            <span class=n>subprocess</span><span class=o>.</span><span class=n>run</span><span class=p>([</span><span class=s2>&quot;/bin/bash&quot;</span><span class=p>,</span> <span class=n>script_path</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>evaluated_entry_name</span><span class=p>],</span> <span class=n>check</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-193><a id=__codelineno-0-193 name=__codelineno-0-193></a>
</span><span id=__span-0-194><a id=__codelineno-0-194 name=__codelineno-0-194></a>        <span class=k>except</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>CalledProcessError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-195><a id=__codelineno-0-195 name=__codelineno-0-195></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;An error occurred while running the script: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-196><a id=__codelineno-0-196 name=__codelineno-0-196></a>            <span class=k>return</span> <span class=kc>False</span><span class=p>,</span> <span class=p>{}</span>
</span><span id=__span-0-197><a id=__codelineno-0-197 name=__codelineno-0-197></a>
</span><span id=__span-0-198><a id=__codelineno-0-198 name=__codelineno-0-198></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>create_result_dict</span><span class=p>()</span>
</span><span id=__span-0-199><a id=__codelineno-0-199 name=__codelineno-0-199></a>
</span><span id=__span-0-200><a id=__codelineno-0-200 name=__codelineno-0-200></a>    <span class=k>def</span><span class=w> </span><span class=nf>read_csv_to_dict</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>file_path</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-201><a id=__codelineno-0-201 name=__codelineno-0-201></a>        <span class=n>file_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>expanduser</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
</span><span id=__span-0-202><a id=__codelineno-0-202 name=__codelineno-0-202></a>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=s2>&quot;r&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-203><a id=__codelineno-0-203 name=__codelineno-0-203></a>            <span class=n>reader</span> <span class=o>=</span> <span class=n>csv</span><span class=o>.</span><span class=n>DictReader</span><span class=p>(</span><span class=n>f</span><span class=p>)</span>
</span><span id=__span-0-204><a id=__codelineno-0-204 name=__codelineno-0-204></a>            <span class=n>matching_rows</span> <span class=o>=</span> <span class=p>[</span><span class=n>row</span> <span class=k>for</span> <span class=n>row</span> <span class=ow>in</span> <span class=n>reader</span> <span class=k>if</span> <span class=n>row</span><span class=p>[</span><span class=s2>&quot;model&quot;</span><span class=p>]</span> <span class=o>==</span> <span class=bp>self</span><span class=o>.</span><span class=n>evaluated_entry_name</span><span class=p>]</span>
</span><span id=__span-0-205><a id=__codelineno-0-205 name=__codelineno-0-205></a>            <span class=k>return</span> <span class=n>matching_rows</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=k>if</span> <span class=n>matching_rows</span> <span class=k>else</span> <span class=p>{}</span>  <span class=c1># Get the last matching row</span>
</span><span id=__span-0-206><a id=__codelineno-0-206 name=__codelineno-0-206></a>
</span><span id=__span-0-207><a id=__codelineno-0-207 name=__codelineno-0-207></a>    <span class=k>def</span><span class=w> </span><span class=nf>create_result_dict</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>bool</span><span class=p>,</span> <span class=nb>dict</span><span class=p>]:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-208><a id=__codelineno-0-208 name=__codelineno-0-208></a>        <span class=n>tasks_data</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>read_csv_to_dict</span><span class=p>(</span><span class=n>_get_all_tasks_csv_file</span><span class=p>())</span>
</span><span id=__span-0-209><a id=__codelineno-0-209 name=__codelineno-0-209></a>        <span class=n>groups_data</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>read_csv_to_dict</span><span class=p>(</span><span class=n>_get_all_groups_csv_file</span><span class=p>())</span>
</span><span id=__span-0-210><a id=__codelineno-0-210 name=__codelineno-0-210></a>
</span><span id=__span-0-211><a id=__codelineno-0-211 name=__codelineno-0-211></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>tasks_data</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>groups_data</span><span class=p>:</span>
</span><span id=__span-0-212><a id=__codelineno-0-212 name=__codelineno-0-212></a>            <span class=k>return</span> <span class=kc>False</span><span class=p>,</span> <span class=p>{}</span>  <span class=c1># Return None if the model is not found in either file</span>
</span><span id=__span-0-213><a id=__codelineno-0-213 name=__codelineno-0-213></a>
</span><span id=__span-0-214><a id=__codelineno-0-214 name=__codelineno-0-214></a>        <span class=n>result</span><span class=p>:</span> <span class=nb>dict</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;tasks&quot;</span><span class=p>:</span> <span class=p>{},</span> <span class=s2>&quot;groups&quot;</span><span class=p>:</span> <span class=p>{}}</span>
</span><span id=__span-0-215><a id=__codelineno-0-215 name=__codelineno-0-215></a>
</span><span id=__span-0-216><a id=__codelineno-0-216 name=__codelineno-0-216></a>        <span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>tasks_data</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span><span id=__span-0-217><a id=__codelineno-0-217 name=__codelineno-0-217></a>            <span class=k>if</span> <span class=n>key</span> <span class=o>!=</span> <span class=s2>&quot;model&quot;</span><span class=p>:</span>
</span><span id=__span-0-218><a id=__codelineno-0-218 name=__codelineno-0-218></a>                <span class=n>result</span><span class=p>[</span><span class=s2>&quot;tasks&quot;</span><span class=p>][</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=nb>float</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
</span><span id=__span-0-219><a id=__codelineno-0-219 name=__codelineno-0-219></a>
</span><span id=__span-0-220><a id=__codelineno-0-220 name=__codelineno-0-220></a>        <span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>groups_data</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span><span id=__span-0-221><a id=__codelineno-0-221 name=__codelineno-0-221></a>            <span class=k>if</span> <span class=n>key</span> <span class=o>!=</span> <span class=s2>&quot;model&quot;</span><span class=p>:</span>
</span><span id=__span-0-222><a id=__codelineno-0-222 name=__codelineno-0-222></a>                <span class=n>result</span><span class=p>[</span><span class=s2>&quot;groups&quot;</span><span class=p>][</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=nb>float</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
</span><span id=__span-0-223><a id=__codelineno-0-223 name=__codelineno-0-223></a>
</span><span id=__span-0-224><a id=__codelineno-0-224 name=__codelineno-0-224></a>        <span class=k>return</span> <span class=kc>True</span><span class=p>,</span> <span class=n>result</span>
</span><span id=__span-0-225><a id=__codelineno-0-225 name=__codelineno-0-225></a>
</span><span id=__span-0-226><a id=__codelineno-0-226 name=__codelineno-0-226></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_evaluation_metrics</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>tasks_results</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Tuple</span><span class=p>[</span><span class=nb>bool</span><span class=p>,</span> <span class=n>Any</span><span class=p>]])</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-227><a id=__codelineno-0-227 name=__codelineno-0-227></a>        <span class=n>results</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=n>tasks_results</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span>
</span><span id=__span-0-228><a id=__codelineno-0-228 name=__codelineno-0-228></a>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>results</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span><span id=__span-0-229><a id=__codelineno-0-229 name=__codelineno-0-229></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Cache empty. Rerun the job with --force. Use --step arg to specify a step.&quot;</span><span class=p>)</span>
</span><span id=__span-0-230><a id=__codelineno-0-230 name=__codelineno-0-230></a>        <span class=n>metrics</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;average&quot;</span><span class=p>:</span> <span class=n>results</span><span class=p>[</span><span class=s2>&quot;groups&quot;</span><span class=p>][</span><span class=s2>&quot;average&quot;</span><span class=p>]}</span>
</span><span id=__span-0-231><a id=__codelineno-0-231 name=__codelineno-0-231></a>
</span><span id=__span-0-232><a id=__codelineno-0-232 name=__codelineno-0-232></a>        <span class=k>for</span> <span class=n>group</span><span class=p>,</span> <span class=n>score</span> <span class=ow>in</span> <span class=n>results</span><span class=p>[</span><span class=s2>&quot;groups&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span><span id=__span-0-233><a id=__codelineno-0-233 name=__codelineno-0-233></a>            <span class=k>if</span> <span class=n>group</span> <span class=o>==</span> <span class=s2>&quot;average&quot;</span><span class=p>:</span>
</span><span id=__span-0-234><a id=__codelineno-0-234 name=__codelineno-0-234></a>                <span class=k>continue</span>
</span><span id=__span-0-235><a id=__codelineno-0-235 name=__codelineno-0-235></a>            <span class=n>metrics</span><span class=p>[</span><span class=sa>f</span><span class=s2>&quot;group/</span><span class=si>{</span><span class=n>group</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>score</span>
</span><span id=__span-0-236><a id=__codelineno-0-236 name=__codelineno-0-236></a>
</span><span id=__span-0-237><a id=__codelineno-0-237 name=__codelineno-0-237></a>        <span class=k>for</span> <span class=n>task</span><span class=p>,</span> <span class=n>score</span> <span class=ow>in</span> <span class=n>results</span><span class=p>[</span><span class=s2>&quot;tasks&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span><span id=__span-0-238><a id=__codelineno-0-238 name=__codelineno-0-238></a>            <span class=n>metrics</span><span class=p>[</span><span class=sa>f</span><span class=s2>&quot;task/</span><span class=si>{</span><span class=n>task</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>score</span>
</span><span id=__span-0-239><a id=__codelineno-0-239 name=__codelineno-0-239></a>
</span><span id=__span-0-240><a id=__codelineno-0-240 name=__codelineno-0-240></a>        <span class=k>return</span> <span class=n>metrics</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-class"> <h4 id=nearai.solvers.MBPPSolverStrategy class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">MBPPSolverStrategy</span> <a href=#nearai.solvers.MBPPSolverStrategy class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title=nearai.solvers.SolverStrategy href=#nearai.solvers.SolverStrategy>SolverStrategy</a></code></p> <p>Solver strategy for the MBPP dataset.</p> <details class=quote> <summary>Source code in <code>nearai/solvers/mbpp_solver.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-68> 68</a></span>
<span class=normal><a href=#__codelineno-0-69> 69</a></span>
<span class=normal><a href=#__codelineno-0-70> 70</a></span>
<span class=normal><a href=#__codelineno-0-71> 71</a></span>
<span class=normal><a href=#__codelineno-0-72> 72</a></span>
<span class=normal><a href=#__codelineno-0-73> 73</a></span>
<span class=normal><a href=#__codelineno-0-74> 74</a></span>
<span class=normal><a href=#__codelineno-0-75> 75</a></span>
<span class=normal><a href=#__codelineno-0-76> 76</a></span>
<span class=normal><a href=#__codelineno-0-77> 77</a></span>
<span class=normal><a href=#__codelineno-0-78> 78</a></span>
<span class=normal><a href=#__codelineno-0-79> 79</a></span>
<span class=normal><a href=#__codelineno-0-80> 80</a></span>
<span class=normal><a href=#__codelineno-0-81> 81</a></span>
<span class=normal><a href=#__codelineno-0-82> 82</a></span>
<span class=normal><a href=#__codelineno-0-83> 83</a></span>
<span class=normal><a href=#__codelineno-0-84> 84</a></span>
<span class=normal><a href=#__codelineno-0-85> 85</a></span>
<span class=normal><a href=#__codelineno-0-86> 86</a></span>
<span class=normal><a href=#__codelineno-0-87> 87</a></span>
<span class=normal><a href=#__codelineno-0-88> 88</a></span>
<span class=normal><a href=#__codelineno-0-89> 89</a></span>
<span class=normal><a href=#__codelineno-0-90> 90</a></span>
<span class=normal><a href=#__codelineno-0-91> 91</a></span>
<span class=normal><a href=#__codelineno-0-92> 92</a></span>
<span class=normal><a href=#__codelineno-0-93> 93</a></span>
<span class=normal><a href=#__codelineno-0-94> 94</a></span>
<span class=normal><a href=#__codelineno-0-95> 95</a></span>
<span class=normal><a href=#__codelineno-0-96> 96</a></span>
<span class=normal><a href=#__codelineno-0-97> 97</a></span>
<span class=normal><a href=#__codelineno-0-98> 98</a></span>
<span class=normal><a href=#__codelineno-0-99> 99</a></span>
<span class=normal><a href=#__codelineno-0-100>100</a></span>
<span class=normal><a href=#__codelineno-0-101>101</a></span>
<span class=normal><a href=#__codelineno-0-102>102</a></span>
<span class=normal><a href=#__codelineno-0-103>103</a></span>
<span class=normal><a href=#__codelineno-0-104>104</a></span>
<span class=normal><a href=#__codelineno-0-105>105</a></span>
<span class=normal><a href=#__codelineno-0-106>106</a></span>
<span class=normal><a href=#__codelineno-0-107>107</a></span>
<span class=normal><a href=#__codelineno-0-108>108</a></span>
<span class=normal><a href=#__codelineno-0-109>109</a></span>
<span class=normal><a href=#__codelineno-0-110>110</a></span>
<span class=normal><a href=#__codelineno-0-111>111</a></span>
<span class=normal><a href=#__codelineno-0-112>112</a></span>
<span class=normal><a href=#__codelineno-0-113>113</a></span>
<span class=normal><a href=#__codelineno-0-114>114</a></span>
<span class=normal><a href=#__codelineno-0-115>115</a></span>
<span class=normal><a href=#__codelineno-0-116>116</a></span>
<span class=normal><a href=#__codelineno-0-117>117</a></span>
<span class=normal><a href=#__codelineno-0-118>118</a></span>
<span class=normal><a href=#__codelineno-0-119>119</a></span>
<span class=normal><a href=#__codelineno-0-120>120</a></span>
<span class=normal><a href=#__codelineno-0-121>121</a></span>
<span class=normal><a href=#__codelineno-0-122>122</a></span>
<span class=normal><a href=#__codelineno-0-123>123</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-68><a id=__codelineno-0-68 name=__codelineno-0-68></a><span class=k>class</span><span class=w> </span><span class=nc>MBPPSolverStrategy</span><span class=p>(</span><span class=n>SolverStrategy</span><span class=p>):</span>
</span><span id=__span-0-69><a id=__codelineno-0-69 name=__codelineno-0-69></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Solver strategy for the MBPP dataset.&quot;&quot;&quot;</span>
</span><span id=__span-0-70><a id=__codelineno-0-70 name=__codelineno-0-70></a>
</span><span id=__span-0-71><a id=__codelineno-0-71 name=__codelineno-0-71></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span>  <span class=c1># noqa: D107</span>
</span><span id=__span-0-72><a id=__codelineno-0-72 name=__codelineno-0-72></a>        <span class=bp>self</span><span class=p>,</span> <span class=n>dataset_ref</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Dataset</span><span class=p>,</span> <span class=n>DatasetDict</span><span class=p>],</span> <span class=n>model</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>agent</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>shots</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>3</span>
</span><span id=__span-0-73><a id=__codelineno-0-73 name=__codelineno-0-73></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-74><a id=__codelineno-0-74 name=__codelineno-0-74></a>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>agent</span><span class=p>)</span>
</span><span id=__span-0-75><a id=__codelineno-0-75 name=__codelineno-0-75></a>        <span class=bp>self</span><span class=o>.</span><span class=n>dataset_ref</span> <span class=o>=</span> <span class=n>dataset_ref</span>
</span><span id=__span-0-76><a id=__codelineno-0-76 name=__codelineno-0-76></a>        <span class=bp>self</span><span class=o>.</span><span class=n>shots</span> <span class=o>=</span> <span class=n>shots</span>
</span><span id=__span-0-77><a id=__codelineno-0-77 name=__codelineno-0-77></a>
</span><span id=__span-0-78><a id=__codelineno-0-78 name=__codelineno-0-78></a>    <span class=k>def</span><span class=w> </span><span class=nf>evaluation_name</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-79><a id=__codelineno-0-79 name=__codelineno-0-79></a>        <span class=n>prefix</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>dataset_evaluation_name</span> <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>dataset_evaluation_name</span> <span class=k>else</span> <span class=s2>&quot;mbpp&quot;</span>
</span><span id=__span-0-80><a id=__codelineno-0-80 name=__codelineno-0-80></a>        <span class=k>return</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>prefix</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>shots</span><span class=si>}</span><span class=s2>shots&quot;</span>
</span><span id=__span-0-81><a id=__codelineno-0-81 name=__codelineno-0-81></a>
</span><span id=__span-0-82><a id=__codelineno-0-82 name=__codelineno-0-82></a>    <span class=k>def</span><span class=w> </span><span class=nf>compatible_datasets</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-83><a id=__codelineno-0-83 name=__codelineno-0-83></a>        <span class=k>return</span> <span class=p>[</span><span class=s2>&quot;mbpp&quot;</span><span class=p>]</span>
</span><span id=__span-0-84><a id=__codelineno-0-84 name=__codelineno-0-84></a>
</span><span id=__span-0-85><a id=__codelineno-0-85 name=__codelineno-0-85></a>    <span class=k>def</span><span class=w> </span><span class=nf>solve</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>datum</span><span class=p>:</span> <span class=nb>dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-86><a id=__codelineno-0-86 name=__codelineno-0-86></a>        <span class=n>datum</span> <span class=o>=</span> <span class=n>MBPPDatum</span><span class=p>(</span><span class=o>**</span><span class=n>datum</span><span class=p>)</span><span class=o>.</span><span class=n>model_dump</span><span class=p>()</span>
</span><span id=__span-0-87><a id=__codelineno-0-87 name=__codelineno-0-87></a>
</span><span id=__span-0-88><a id=__codelineno-0-88 name=__codelineno-0-88></a>        <span class=c1>## Allow LLM to think &quot;out loud&quot; for it&#39;s answer</span>
</span><span id=__span-0-89><a id=__codelineno-0-89 name=__codelineno-0-89></a>        <span class=n>function_name</span> <span class=o>=</span> <span class=n>get_function_name</span><span class=p>(</span><span class=n>datum</span><span class=p>[</span><span class=s2>&quot;code&quot;</span><span class=p>])</span>
</span><span id=__span-0-90><a id=__codelineno-0-90 name=__codelineno-0-90></a>        <span class=n>example_problems</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>islice</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>dataset_ref</span><span class=p>[</span><span class=s2>&quot;prompt&quot;</span><span class=p>],</span> <span class=bp>self</span><span class=o>.</span><span class=n>shots</span><span class=p>))</span>
</span><span id=__span-0-91><a id=__codelineno-0-91 name=__codelineno-0-91></a>        <span class=n>base_prompt</span> <span class=o>=</span> <span class=n>Template</span><span class=p>(</span><span class=nb>open</span><span class=p>(</span><span class=n>PROMPTS_FOLDER</span> <span class=o>/</span> <span class=s2>&quot;mbpp_verbose_answer.j2&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>(),</span> <span class=n>trim_blocks</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span><span class=o>.</span><span class=n>render</span><span class=p>(</span>
</span><span id=__span-0-92><a id=__codelineno-0-92 name=__codelineno-0-92></a>            <span class=n>function_name</span><span class=o>=</span><span class=n>function_name</span><span class=p>,</span>
</span><span id=__span-0-93><a id=__codelineno-0-93 name=__codelineno-0-93></a>            <span class=n>example_problems</span><span class=o>=</span><span class=n>example_problems</span><span class=p>,</span>
</span><span id=__span-0-94><a id=__codelineno-0-94 name=__codelineno-0-94></a>            <span class=n>challenge_problem</span><span class=o>=</span><span class=n>datum</span><span class=p>,</span>
</span><span id=__span-0-95><a id=__codelineno-0-95 name=__codelineno-0-95></a>        <span class=p>)</span>
</span><span id=__span-0-96><a id=__codelineno-0-96 name=__codelineno-0-96></a>        <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>start_inference_session</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>datum</span><span class=p>[</span><span class=s2>&quot;task_id&quot;</span><span class=p>]))</span><span class=o>.</span><span class=n>run_task</span><span class=p>(</span><span class=n>base_prompt</span><span class=p>)</span>
</span><span id=__span-0-97><a id=__codelineno-0-97 name=__codelineno-0-97></a>
</span><span id=__span-0-98><a id=__codelineno-0-98 name=__codelineno-0-98></a>        <span class=c1>## Extract the answer from the response</span>
</span><span id=__span-0-99><a id=__codelineno-0-99 name=__codelineno-0-99></a>        <span class=n>extract_answer_prompt</span> <span class=o>=</span> <span class=n>Template</span><span class=p>(</span>
</span><span id=__span-0-100><a id=__codelineno-0-100 name=__codelineno-0-100></a>            <span class=nb>open</span><span class=p>(</span><span class=n>PROMPTS_FOLDER</span> <span class=o>/</span> <span class=s2>&quot;mbpp_extract_answer.j2&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>(),</span> <span class=n>trim_blocks</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-0-101><a id=__codelineno-0-101 name=__codelineno-0-101></a>        <span class=p>)</span><span class=o>.</span><span class=n>render</span><span class=p>(</span>
</span><span id=__span-0-102><a id=__codelineno-0-102 name=__codelineno-0-102></a>            <span class=n>function_name</span><span class=o>=</span><span class=n>function_name</span><span class=p>,</span>
</span><span id=__span-0-103><a id=__codelineno-0-103 name=__codelineno-0-103></a>            <span class=n>answer_text</span><span class=o>=</span><span class=n>response</span><span class=p>,</span>
</span><span id=__span-0-104><a id=__codelineno-0-104 name=__codelineno-0-104></a>        <span class=p>)</span>
</span><span id=__span-0-105><a id=__codelineno-0-105 name=__codelineno-0-105></a>        <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>start_inference_session</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>datum</span><span class=p>[</span><span class=s2>&quot;task_id&quot;</span><span class=p>]))</span><span class=o>.</span><span class=n>run_task</span><span class=p>(</span><span class=n>extract_answer_prompt</span><span class=p>)</span>
</span><span id=__span-0-106><a id=__codelineno-0-106 name=__codelineno-0-106></a>
</span><span id=__span-0-107><a id=__codelineno-0-107 name=__codelineno-0-107></a>        <span class=c1>## Parse the python code</span>
</span><span id=__span-0-108><a id=__codelineno-0-108 name=__codelineno-0-108></a>        <span class=n>python_code_blocks</span> <span class=o>=</span> <span class=n>parse_python_code_block</span><span class=p>(</span><span class=n>response</span><span class=p>)</span> <span class=o>+</span> <span class=n>parse_code_block</span><span class=p>(</span><span class=n>response</span><span class=p>)</span>
</span><span id=__span-0-109><a id=__codelineno-0-109 name=__codelineno-0-109></a>        <span class=n>code</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-110><a id=__codelineno-0-110 name=__codelineno-0-110></a>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>python_code_blocks</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span><span id=__span-0-111><a id=__codelineno-0-111 name=__codelineno-0-111></a>            <span class=n>code</span> <span class=o>=</span> <span class=n>response</span>
</span><span id=__span-0-112><a id=__codelineno-0-112 name=__codelineno-0-112></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-113><a id=__codelineno-0-113 name=__codelineno-0-113></a>            <span class=n>code</span> <span class=o>=</span> <span class=n>python_code_blocks</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span><span id=__span-0-114><a id=__codelineno-0-114 name=__codelineno-0-114></a>
</span><span id=__span-0-115><a id=__codelineno-0-115 name=__codelineno-0-115></a>        <span class=c1>## Evaluate the code</span>
</span><span id=__span-0-116><a id=__codelineno-0-116 name=__codelineno-0-116></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-117><a id=__codelineno-0-117 name=__codelineno-0-117></a>            <span class=k>for</span> <span class=n>test</span> <span class=ow>in</span> <span class=n>datum</span><span class=p>[</span><span class=s2>&quot;test_list&quot;</span><span class=p>]</span> <span class=o>+</span> <span class=n>datum</span><span class=p>[</span><span class=s2>&quot;challenge_test_list&quot;</span><span class=p>]:</span>
</span><span id=__span-0-118><a id=__codelineno-0-118 name=__codelineno-0-118></a>                <span class=n>test_code</span> <span class=o>=</span> <span class=n>code</span> <span class=o>+</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span> <span class=o>+</span> <span class=n>test</span>
</span><span id=__span-0-119><a id=__codelineno-0-119 name=__codelineno-0-119></a>                <span class=k>if</span> <span class=ow>not</span> <span class=n>run_with_timeout</span><span class=p>(</span><span class=n>test_code</span><span class=p>):</span>
</span><span id=__span-0-120><a id=__codelineno-0-120 name=__codelineno-0-120></a>                    <span class=k>return</span> <span class=kc>False</span>
</span><span id=__span-0-121><a id=__codelineno-0-121 name=__codelineno-0-121></a>            <span class=k>return</span> <span class=kc>True</span>
</span><span id=__span-0-122><a id=__codelineno-0-122 name=__codelineno-0-122></a>        <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
</span><span id=__span-0-123><a id=__codelineno-0-123 name=__codelineno-0-123></a>            <span class=k>return</span> <span class=kc>False</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-class"> <h4 id=nearai.solvers.MMLUSolverStrategy class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">MMLUSolverStrategy</span> <a href=#nearai.solvers.MMLUSolverStrategy class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title=nearai.solvers.SolverStrategy href=#nearai.solvers.SolverStrategy>SolverStrategy</a></code></p> <p>Solver strategy for the MMLU dataset.</p> <details class=quote> <summary>Source code in <code>nearai/solvers/mmlu_solver.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-18>18</a></span>
<span class=normal><a href=#__codelineno-0-19>19</a></span>
<span class=normal><a href=#__codelineno-0-20>20</a></span>
<span class=normal><a href=#__codelineno-0-21>21</a></span>
<span class=normal><a href=#__codelineno-0-22>22</a></span>
<span class=normal><a href=#__codelineno-0-23>23</a></span>
<span class=normal><a href=#__codelineno-0-24>24</a></span>
<span class=normal><a href=#__codelineno-0-25>25</a></span>
<span class=normal><a href=#__codelineno-0-26>26</a></span>
<span class=normal><a href=#__codelineno-0-27>27</a></span>
<span class=normal><a href=#__codelineno-0-28>28</a></span>
<span class=normal><a href=#__codelineno-0-29>29</a></span>
<span class=normal><a href=#__codelineno-0-30>30</a></span>
<span class=normal><a href=#__codelineno-0-31>31</a></span>
<span class=normal><a href=#__codelineno-0-32>32</a></span>
<span class=normal><a href=#__codelineno-0-33>33</a></span>
<span class=normal><a href=#__codelineno-0-34>34</a></span>
<span class=normal><a href=#__codelineno-0-35>35</a></span>
<span class=normal><a href=#__codelineno-0-36>36</a></span>
<span class=normal><a href=#__codelineno-0-37>37</a></span>
<span class=normal><a href=#__codelineno-0-38>38</a></span>
<span class=normal><a href=#__codelineno-0-39>39</a></span>
<span class=normal><a href=#__codelineno-0-40>40</a></span>
<span class=normal><a href=#__codelineno-0-41>41</a></span>
<span class=normal><a href=#__codelineno-0-42>42</a></span>
<span class=normal><a href=#__codelineno-0-43>43</a></span>
<span class=normal><a href=#__codelineno-0-44>44</a></span>
<span class=normal><a href=#__codelineno-0-45>45</a></span>
<span class=normal><a href=#__codelineno-0-46>46</a></span>
<span class=normal><a href=#__codelineno-0-47>47</a></span>
<span class=normal><a href=#__codelineno-0-48>48</a></span>
<span class=normal><a href=#__codelineno-0-49>49</a></span>
<span class=normal><a href=#__codelineno-0-50>50</a></span>
<span class=normal><a href=#__codelineno-0-51>51</a></span>
<span class=normal><a href=#__codelineno-0-52>52</a></span>
<span class=normal><a href=#__codelineno-0-53>53</a></span>
<span class=normal><a href=#__codelineno-0-54>54</a></span>
<span class=normal><a href=#__codelineno-0-55>55</a></span>
<span class=normal><a href=#__codelineno-0-56>56</a></span>
<span class=normal><a href=#__codelineno-0-57>57</a></span>
<span class=normal><a href=#__codelineno-0-58>58</a></span>
<span class=normal><a href=#__codelineno-0-59>59</a></span>
<span class=normal><a href=#__codelineno-0-60>60</a></span>
<span class=normal><a href=#__codelineno-0-61>61</a></span>
<span class=normal><a href=#__codelineno-0-62>62</a></span>
<span class=normal><a href=#__codelineno-0-63>63</a></span>
<span class=normal><a href=#__codelineno-0-64>64</a></span>
<span class=normal><a href=#__codelineno-0-65>65</a></span>
<span class=normal><a href=#__codelineno-0-66>66</a></span>
<span class=normal><a href=#__codelineno-0-67>67</a></span>
<span class=normal><a href=#__codelineno-0-68>68</a></span>
<span class=normal><a href=#__codelineno-0-69>69</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-18><a id=__codelineno-0-18 name=__codelineno-0-18></a><span class=k>class</span><span class=w> </span><span class=nc>MMLUSolverStrategy</span><span class=p>(</span><span class=n>SolverStrategy</span><span class=p>):</span>
</span><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Solver strategy for the MMLU dataset.&quot;&quot;&quot;</span>
</span><span id=__span-0-20><a id=__codelineno-0-20 name=__codelineno-0-20></a>
</span><span id=__span-0-21><a id=__codelineno-0-21 name=__codelineno-0-21></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span>  <span class=c1># noqa: D107</span>
</span><span id=__span-0-22><a id=__codelineno-0-22 name=__codelineno-0-22></a>        <span class=bp>self</span><span class=p>,</span> <span class=n>dataset_ref</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Dataset</span><span class=p>,</span> <span class=n>DatasetDict</span><span class=p>],</span> <span class=n>model</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>agent</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>shots</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>8</span>
</span><span id=__span-0-23><a id=__codelineno-0-23 name=__codelineno-0-23></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-24><a id=__codelineno-0-24 name=__codelineno-0-24></a>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>agent</span><span class=p>)</span>
</span><span id=__span-0-25><a id=__codelineno-0-25 name=__codelineno-0-25></a>        <span class=bp>self</span><span class=o>.</span><span class=n>dataset_ref</span> <span class=o>=</span> <span class=n>dataset_ref</span>
</span><span id=__span-0-26><a id=__codelineno-0-26 name=__codelineno-0-26></a>        <span class=bp>self</span><span class=o>.</span><span class=n>shots</span> <span class=o>=</span> <span class=n>shots</span>
</span><span id=__span-0-27><a id=__codelineno-0-27 name=__codelineno-0-27></a>
</span><span id=__span-0-28><a id=__codelineno-0-28 name=__codelineno-0-28></a>    <span class=k>def</span><span class=w> </span><span class=nf>evaluation_name</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-29><a id=__codelineno-0-29 name=__codelineno-0-29></a>        <span class=n>prefix</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>dataset_evaluation_name</span> <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>dataset_evaluation_name</span> <span class=k>else</span> <span class=s2>&quot;mmlu&quot;</span>
</span><span id=__span-0-30><a id=__codelineno-0-30 name=__codelineno-0-30></a>        <span class=k>return</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>prefix</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>shots</span><span class=si>}</span><span class=s2>shots&quot;</span>
</span><span id=__span-0-31><a id=__codelineno-0-31 name=__codelineno-0-31></a>
</span><span id=__span-0-32><a id=__codelineno-0-32 name=__codelineno-0-32></a>    <span class=k>def</span><span class=w> </span><span class=nf>compatible_datasets</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-33><a id=__codelineno-0-33 name=__codelineno-0-33></a>        <span class=k>return</span> <span class=p>[</span><span class=s2>&quot;mmlu&quot;</span><span class=p>]</span>
</span><span id=__span-0-34><a id=__codelineno-0-34 name=__codelineno-0-34></a>
</span><span id=__span-0-35><a id=__codelineno-0-35 name=__codelineno-0-35></a>    <span class=k>def</span><span class=w> </span><span class=nf>solve</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>datum</span><span class=p>:</span> <span class=nb>dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-36><a id=__codelineno-0-36 name=__codelineno-0-36></a>        <span class=n>datum</span> <span class=o>=</span> <span class=n>MMLUDatum</span><span class=p>(</span><span class=o>**</span><span class=n>datum</span><span class=p>)</span><span class=o>.</span><span class=n>model_dump</span><span class=p>()</span>
</span><span id=__span-0-37><a id=__codelineno-0-37 name=__codelineno-0-37></a>
</span><span id=__span-0-38><a id=__codelineno-0-38 name=__codelineno-0-38></a>        <span class=n>choices</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;A&quot;</span><span class=p>,</span> <span class=s2>&quot;B&quot;</span><span class=p>,</span> <span class=s2>&quot;C&quot;</span><span class=p>,</span> <span class=s2>&quot;D&quot;</span><span class=p>]</span>
</span><span id=__span-0-39><a id=__codelineno-0-39 name=__codelineno-0-39></a>        <span class=n>example_problems_indices</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>5</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>shots</span><span class=p>,</span> <span class=mi>5</span><span class=p>))</span>
</span><span id=__span-0-40><a id=__codelineno-0-40 name=__codelineno-0-40></a>        <span class=n>example_problems</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span>
</span><span id=__span-0-41><a id=__codelineno-0-41 name=__codelineno-0-41></a>            <span class=nb>map</span><span class=p>(</span>
</span><span id=__span-0-42><a id=__codelineno-0-42 name=__codelineno-0-42></a>                <span class=k>lambda</span> <span class=n>d</span><span class=p>:</span> <span class=n>MMLUDatum</span><span class=p>(</span><span class=o>**</span><span class=n>d</span><span class=p>)</span><span class=o>.</span><span class=n>model_dump</span><span class=p>(),</span>
</span><span id=__span-0-43><a id=__codelineno-0-43 name=__codelineno-0-43></a>                <span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>dataset_ref</span><span class=p>[</span><span class=s2>&quot;dev&quot;</span><span class=p>][</span><span class=n>i</span><span class=p>]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>example_problems_indices</span><span class=p>],</span>
</span><span id=__span-0-44><a id=__codelineno-0-44 name=__codelineno-0-44></a>            <span class=p>)</span>
</span><span id=__span-0-45><a id=__codelineno-0-45 name=__codelineno-0-45></a>        <span class=p>)</span>
</span><span id=__span-0-46><a id=__codelineno-0-46 name=__codelineno-0-46></a>        <span class=n>base_prompt</span> <span class=o>=</span> <span class=n>Template</span><span class=p>(</span><span class=nb>open</span><span class=p>(</span><span class=n>PROMPTS_FOLDER</span> <span class=o>/</span> <span class=s2>&quot;mmlu_verbose_answer.j2&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>(),</span> <span class=n>trim_blocks</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span><span class=o>.</span><span class=n>render</span><span class=p>(</span>
</span><span id=__span-0-47><a id=__codelineno-0-47 name=__codelineno-0-47></a>            <span class=n>example_problems</span><span class=o>=</span><span class=n>example_problems</span><span class=p>,</span>
</span><span id=__span-0-48><a id=__codelineno-0-48 name=__codelineno-0-48></a>            <span class=n>challenge_problem</span><span class=o>=</span><span class=n>datum</span><span class=p>,</span>
</span><span id=__span-0-49><a id=__codelineno-0-49 name=__codelineno-0-49></a>            <span class=n>choices</span><span class=o>=</span><span class=n>choices</span><span class=p>,</span>
</span><span id=__span-0-50><a id=__codelineno-0-50 name=__codelineno-0-50></a>        <span class=p>)</span>
</span><span id=__span-0-51><a id=__codelineno-0-51 name=__codelineno-0-51></a>
</span><span id=__span-0-52><a id=__codelineno-0-52 name=__codelineno-0-52></a>        <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>start_inference_session</span><span class=p>(</span><span class=s2>&quot;&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>run_task</span><span class=p>(</span><span class=n>base_prompt</span><span class=p>)</span>
</span><span id=__span-0-53><a id=__codelineno-0-53 name=__codelineno-0-53></a>
</span><span id=__span-0-54><a id=__codelineno-0-54 name=__codelineno-0-54></a>        <span class=c1>## Extract the answer from the response</span>
</span><span id=__span-0-55><a id=__codelineno-0-55 name=__codelineno-0-55></a>        <span class=n>extract_answer_prompt</span> <span class=o>=</span> <span class=n>Template</span><span class=p>(</span>
</span><span id=__span-0-56><a id=__codelineno-0-56 name=__codelineno-0-56></a>            <span class=nb>open</span><span class=p>(</span><span class=n>PROMPTS_FOLDER</span> <span class=o>/</span> <span class=s2>&quot;mmlu_extract_answer.j2&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>(),</span> <span class=n>trim_blocks</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-0-57><a id=__codelineno-0-57 name=__codelineno-0-57></a>        <span class=p>)</span><span class=o>.</span><span class=n>render</span><span class=p>(</span>
</span><span id=__span-0-58><a id=__codelineno-0-58 name=__codelineno-0-58></a>            <span class=n>challenge_problem</span><span class=o>=</span><span class=n>datum</span><span class=p>,</span>
</span><span id=__span-0-59><a id=__codelineno-0-59 name=__codelineno-0-59></a>            <span class=n>answer_text</span><span class=o>=</span><span class=n>response</span><span class=p>,</span>
</span><span id=__span-0-60><a id=__codelineno-0-60 name=__codelineno-0-60></a>            <span class=n>choices</span><span class=o>=</span><span class=n>choices</span><span class=p>,</span>
</span><span id=__span-0-61><a id=__codelineno-0-61 name=__codelineno-0-61></a>        <span class=p>)</span>
</span><span id=__span-0-62><a id=__codelineno-0-62 name=__codelineno-0-62></a>        <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>start_inference_session</span><span class=p>(</span><span class=s2>&quot;&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>run_task</span><span class=p>(</span><span class=n>extract_answer_prompt</span><span class=p>)</span>
</span><span id=__span-0-63><a id=__codelineno-0-63 name=__codelineno-0-63></a>
</span><span id=__span-0-64><a id=__codelineno-0-64 name=__codelineno-0-64></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-65><a id=__codelineno-0-65 name=__codelineno-0-65></a>            <span class=n>answer</span> <span class=o>=</span> <span class=n>choices</span><span class=o>.</span><span class=n>index</span><span class=p>(</span><span class=n>response</span><span class=p>)</span>
</span><span id=__span-0-66><a id=__codelineno-0-66 name=__codelineno-0-66></a>            <span class=k>return</span> <span class=nb>bool</span><span class=p>(</span><span class=n>answer</span> <span class=o>==</span> <span class=n>datum</span><span class=p>[</span><span class=s2>&quot;answer&quot;</span><span class=p>])</span>
</span><span id=__span-0-67><a id=__codelineno-0-67 name=__codelineno-0-67></a>        <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
</span><span id=__span-0-68><a id=__codelineno-0-68 name=__codelineno-0-68></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Failed to parse answer&quot;</span><span class=p>)</span>
</span><span id=__span-0-69><a id=__codelineno-0-69 name=__codelineno-0-69></a>            <span class=k>return</span> <span class=kc>False</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-class"> <h4 id=nearai.solvers.SolverStrategy class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">SolverStrategy</span> <a href=#nearai.solvers.SolverStrategy class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=abc.ABC>ABC</span></code></p> <p>Abstract class for solver strategies.</p> <details class=quote> <summary>Source code in <code>nearai/solvers/__init__.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-106>106</a></span>
<span class=normal><a href=#__codelineno-0-107>107</a></span>
<span class=normal><a href=#__codelineno-0-108>108</a></span>
<span class=normal><a href=#__codelineno-0-109>109</a></span>
<span class=normal><a href=#__codelineno-0-110>110</a></span>
<span class=normal><a href=#__codelineno-0-111>111</a></span>
<span class=normal><a href=#__codelineno-0-112>112</a></span>
<span class=normal><a href=#__codelineno-0-113>113</a></span>
<span class=normal><a href=#__codelineno-0-114>114</a></span>
<span class=normal><a href=#__codelineno-0-115>115</a></span>
<span class=normal><a href=#__codelineno-0-116>116</a></span>
<span class=normal><a href=#__codelineno-0-117>117</a></span>
<span class=normal><a href=#__codelineno-0-118>118</a></span>
<span class=normal><a href=#__codelineno-0-119>119</a></span>
<span class=normal><a href=#__codelineno-0-120>120</a></span>
<span class=normal><a href=#__codelineno-0-121>121</a></span>
<span class=normal><a href=#__codelineno-0-122>122</a></span>
<span class=normal><a href=#__codelineno-0-123>123</a></span>
<span class=normal><a href=#__codelineno-0-124>124</a></span>
<span class=normal><a href=#__codelineno-0-125>125</a></span>
<span class=normal><a href=#__codelineno-0-126>126</a></span>
<span class=normal><a href=#__codelineno-0-127>127</a></span>
<span class=normal><a href=#__codelineno-0-128>128</a></span>
<span class=normal><a href=#__codelineno-0-129>129</a></span>
<span class=normal><a href=#__codelineno-0-130>130</a></span>
<span class=normal><a href=#__codelineno-0-131>131</a></span>
<span class=normal><a href=#__codelineno-0-132>132</a></span>
<span class=normal><a href=#__codelineno-0-133>133</a></span>
<span class=normal><a href=#__codelineno-0-134>134</a></span>
<span class=normal><a href=#__codelineno-0-135>135</a></span>
<span class=normal><a href=#__codelineno-0-136>136</a></span>
<span class=normal><a href=#__codelineno-0-137>137</a></span>
<span class=normal><a href=#__codelineno-0-138>138</a></span>
<span class=normal><a href=#__codelineno-0-139>139</a></span>
<span class=normal><a href=#__codelineno-0-140>140</a></span>
<span class=normal><a href=#__codelineno-0-141>141</a></span>
<span class=normal><a href=#__codelineno-0-142>142</a></span>
<span class=normal><a href=#__codelineno-0-143>143</a></span>
<span class=normal><a href=#__codelineno-0-144>144</a></span>
<span class=normal><a href=#__codelineno-0-145>145</a></span>
<span class=normal><a href=#__codelineno-0-146>146</a></span>
<span class=normal><a href=#__codelineno-0-147>147</a></span>
<span class=normal><a href=#__codelineno-0-148>148</a></span>
<span class=normal><a href=#__codelineno-0-149>149</a></span>
<span class=normal><a href=#__codelineno-0-150>150</a></span>
<span class=normal><a href=#__codelineno-0-151>151</a></span>
<span class=normal><a href=#__codelineno-0-152>152</a></span>
<span class=normal><a href=#__codelineno-0-153>153</a></span>
<span class=normal><a href=#__codelineno-0-154>154</a></span>
<span class=normal><a href=#__codelineno-0-155>155</a></span>
<span class=normal><a href=#__codelineno-0-156>156</a></span>
<span class=normal><a href=#__codelineno-0-157>157</a></span>
<span class=normal><a href=#__codelineno-0-158>158</a></span>
<span class=normal><a href=#__codelineno-0-159>159</a></span>
<span class=normal><a href=#__codelineno-0-160>160</a></span>
<span class=normal><a href=#__codelineno-0-161>161</a></span>
<span class=normal><a href=#__codelineno-0-162>162</a></span>
<span class=normal><a href=#__codelineno-0-163>163</a></span>
<span class=normal><a href=#__codelineno-0-164>164</a></span>
<span class=normal><a href=#__codelineno-0-165>165</a></span>
<span class=normal><a href=#__codelineno-0-166>166</a></span>
<span class=normal><a href=#__codelineno-0-167>167</a></span>
<span class=normal><a href=#__codelineno-0-168>168</a></span>
<span class=normal><a href=#__codelineno-0-169>169</a></span>
<span class=normal><a href=#__codelineno-0-170>170</a></span>
<span class=normal><a href=#__codelineno-0-171>171</a></span>
<span class=normal><a href=#__codelineno-0-172>172</a></span>
<span class=normal><a href=#__codelineno-0-173>173</a></span>
<span class=normal><a href=#__codelineno-0-174>174</a></span>
<span class=normal><a href=#__codelineno-0-175>175</a></span>
<span class=normal><a href=#__codelineno-0-176>176</a></span>
<span class=normal><a href=#__codelineno-0-177>177</a></span>
<span class=normal><a href=#__codelineno-0-178>178</a></span>
<span class=normal><a href=#__codelineno-0-179>179</a></span>
<span class=normal><a href=#__codelineno-0-180>180</a></span>
<span class=normal><a href=#__codelineno-0-181>181</a></span>
<span class=normal><a href=#__codelineno-0-182>182</a></span>
<span class=normal><a href=#__codelineno-0-183>183</a></span>
<span class=normal><a href=#__codelineno-0-184>184</a></span>
<span class=normal><a href=#__codelineno-0-185>185</a></span>
<span class=normal><a href=#__codelineno-0-186>186</a></span>
<span class=normal><a href=#__codelineno-0-187>187</a></span>
<span class=normal><a href=#__codelineno-0-188>188</a></span>
<span class=normal><a href=#__codelineno-0-189>189</a></span>
<span class=normal><a href=#__codelineno-0-190>190</a></span>
<span class=normal><a href=#__codelineno-0-191>191</a></span>
<span class=normal><a href=#__codelineno-0-192>192</a></span>
<span class=normal><a href=#__codelineno-0-193>193</a></span>
<span class=normal><a href=#__codelineno-0-194>194</a></span>
<span class=normal><a href=#__codelineno-0-195>195</a></span>
<span class=normal><a href=#__codelineno-0-196>196</a></span>
<span class=normal><a href=#__codelineno-0-197>197</a></span>
<span class=normal><a href=#__codelineno-0-198>198</a></span>
<span class=normal><a href=#__codelineno-0-199>199</a></span>
<span class=normal><a href=#__codelineno-0-200>200</a></span>
<span class=normal><a href=#__codelineno-0-201>201</a></span>
<span class=normal><a href=#__codelineno-0-202>202</a></span>
<span class=normal><a href=#__codelineno-0-203>203</a></span>
<span class=normal><a href=#__codelineno-0-204>204</a></span>
<span class=normal><a href=#__codelineno-0-205>205</a></span>
<span class=normal><a href=#__codelineno-0-206>206</a></span>
<span class=normal><a href=#__codelineno-0-207>207</a></span>
<span class=normal><a href=#__codelineno-0-208>208</a></span>
<span class=normal><a href=#__codelineno-0-209>209</a></span>
<span class=normal><a href=#__codelineno-0-210>210</a></span>
<span class=normal><a href=#__codelineno-0-211>211</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-106><a id=__codelineno-0-106 name=__codelineno-0-106></a><span class=k>class</span><span class=w> </span><span class=nc>SolverStrategy</span><span class=p>(</span><span class=n>ABC</span><span class=p>,</span> <span class=n>metaclass</span><span class=o>=</span><span class=n>SolverStrategyMeta</span><span class=p>):</span>
</span><span id=__span-0-107><a id=__codelineno-0-107 name=__codelineno-0-107></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Abstract class for solver strategies.&quot;&quot;&quot;</span>
</span><span id=__span-0-108><a id=__codelineno-0-108 name=__codelineno-0-108></a>
</span><span id=__span-0-109><a id=__codelineno-0-109 name=__codelineno-0-109></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>model</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>agent</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-110><a id=__codelineno-0-110 name=__codelineno-0-110></a>        <span class=n>CONFIG</span><span class=o>.</span><span class=n>confirm_commands</span> <span class=o>=</span> <span class=kc>False</span>
</span><span id=__span-0-111><a id=__codelineno-0-111 name=__codelineno-0-111></a>        <span class=bp>self</span><span class=o>.</span><span class=n>client_config</span> <span class=o>=</span> <span class=n>CONFIG</span><span class=o>.</span><span class=n>get_client_config</span><span class=p>()</span>
</span><span id=__span-0-112><a id=__codelineno-0-112 name=__codelineno-0-112></a>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span> <span class=o>=</span> <span class=n>InferenceClient</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>client_config</span><span class=p>)</span>
</span><span id=__span-0-113><a id=__codelineno-0-113 name=__codelineno-0-113></a>        <span class=k>assert</span> <span class=n>model</span> <span class=o>!=</span> <span class=s2>&quot;&quot;</span> <span class=ow>or</span> <span class=n>agent</span> <span class=o>!=</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-114><a id=__codelineno-0-114 name=__codelineno-0-114></a>        <span class=bp>self</span><span class=o>.</span><span class=n>dataset_evaluation_name</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-115><a id=__codelineno-0-115 name=__codelineno-0-115></a>
</span><span id=__span-0-116><a id=__codelineno-0-116 name=__codelineno-0-116></a>        <span class=bp>self</span><span class=o>.</span><span class=n>provider</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-117><a id=__codelineno-0-117 name=__codelineno-0-117></a>        <span class=bp>self</span><span class=o>.</span><span class=n>model_namespace</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-118><a id=__codelineno-0-118 name=__codelineno-0-118></a>        <span class=bp>self</span><span class=o>.</span><span class=n>model_full_path</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-119><a id=__codelineno-0-119 name=__codelineno-0-119></a>        <span class=bp>self</span><span class=o>.</span><span class=n>model_name</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-120><a id=__codelineno-0-120 name=__codelineno-0-120></a>        <span class=k>if</span> <span class=n>model</span> <span class=o>!=</span> <span class=s2>&quot;&quot;</span><span class=p>:</span>
</span><span id=__span-0-121><a id=__codelineno-0-121 name=__codelineno-0-121></a>            <span class=bp>self</span><span class=o>.</span><span class=n>provider</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>model_full_path</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>provider_models</span><span class=o>.</span><span class=n>match_provider_model</span><span class=p>(</span><span class=n>model</span><span class=p>)</span>
</span><span id=__span-0-122><a id=__codelineno-0-122 name=__codelineno-0-122></a>            <span class=bp>self</span><span class=o>.</span><span class=n>provider</span><span class=p>,</span> <span class=n>namespaced_model</span> <span class=o>=</span> <span class=n>get_provider_namespaced_model</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>model_full_path</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>provider</span><span class=p>)</span>
</span><span id=__span-0-123><a id=__codelineno-0-123 name=__codelineno-0-123></a>            <span class=bp>self</span><span class=o>.</span><span class=n>model_namespace</span> <span class=o>=</span> <span class=n>namespaced_model</span><span class=o>.</span><span class=n>namespace</span>
</span><span id=__span-0-124><a id=__codelineno-0-124 name=__codelineno-0-124></a>            <span class=bp>self</span><span class=o>.</span><span class=n>model_name</span> <span class=o>=</span> <span class=n>namespaced_model</span><span class=o>.</span><span class=n>name</span>
</span><span id=__span-0-125><a id=__codelineno-0-125 name=__codelineno-0-125></a>
</span><span id=__span-0-126><a id=__codelineno-0-126 name=__codelineno-0-126></a>        <span class=bp>self</span><span class=o>.</span><span class=n>agent</span> <span class=o>=</span> <span class=n>agent</span>
</span><span id=__span-0-127><a id=__codelineno-0-127 name=__codelineno-0-127></a>        <span class=bp>self</span><span class=o>.</span><span class=n>agent_params</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-128><a id=__codelineno-0-128 name=__codelineno-0-128></a>            <span class=s2>&quot;api_url&quot;</span><span class=p>:</span> <span class=n>CONFIG</span><span class=o>.</span><span class=n>api_url</span><span class=p>,</span>
</span><span id=__span-0-129><a id=__codelineno-0-129 name=__codelineno-0-129></a>            <span class=s2>&quot;data_source&quot;</span><span class=p>:</span> <span class=s2>&quot;local_files&quot;</span><span class=p>,</span>
</span><span id=__span-0-130><a id=__codelineno-0-130 name=__codelineno-0-130></a>            <span class=s2>&quot;temperature&quot;</span><span class=p>:</span> <span class=mf>0.0</span><span class=p>,</span>
</span><span id=__span-0-131><a id=__codelineno-0-131 name=__codelineno-0-131></a>            <span class=s2>&quot;record_run&quot;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-132><a id=__codelineno-0-132 name=__codelineno-0-132></a>            <span class=s2>&quot;verbose&quot;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-133><a id=__codelineno-0-133 name=__codelineno-0-133></a>            <span class=s2>&quot;change_to_agent_temp_dir&quot;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-0-134><a id=__codelineno-0-134 name=__codelineno-0-134></a>        <span class=p>}</span>
</span><span id=__span-0-135><a id=__codelineno-0-135 name=__codelineno-0-135></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>model_full_path</span><span class=p>:</span>
</span><span id=__span-0-136><a id=__codelineno-0-136 name=__codelineno-0-136></a>            <span class=bp>self</span><span class=o>.</span><span class=n>agent_params</span><span class=p>[</span><span class=s2>&quot;model&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>model_full_path</span>
</span><span id=__span-0-137><a id=__codelineno-0-137 name=__codelineno-0-137></a>
</span><span id=__span-0-138><a id=__codelineno-0-138 name=__codelineno-0-138></a>    <span class=nd>@property</span>
</span><span id=__span-0-139><a id=__codelineno-0-139 name=__codelineno-0-139></a>    <span class=k>def</span><span class=w> </span><span class=nf>name</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-0-140><a id=__codelineno-0-140 name=__codelineno-0-140></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns the name of the solver strategy.&quot;&quot;&quot;</span>
</span><span id=__span-0-141><a id=__codelineno-0-141 name=__codelineno-0-141></a>        <span class=k>return</span> <span class=nb>type</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span><span class=o>.</span><span class=vm>__name__</span>
</span><span id=__span-0-142><a id=__codelineno-0-142 name=__codelineno-0-142></a>
</span><span id=__span-0-143><a id=__codelineno-0-143 name=__codelineno-0-143></a>    <span class=nd>@SolverStrategyClassProperty</span>
</span><span id=__span-0-144><a id=__codelineno-0-144 name=__codelineno-0-144></a>    <span class=k>def</span><span class=w> </span><span class=nf>scoring_method</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>SolverScoringMethod</span><span class=p>:</span>
</span><span id=__span-0-145><a id=__codelineno-0-145 name=__codelineno-0-145></a>        <span class=k>return</span> <span class=n>SolverScoringMethod</span><span class=o>.</span><span class=n>TrueOrFalseList</span>
</span><span id=__span-0-146><a id=__codelineno-0-146 name=__codelineno-0-146></a>
</span><span id=__span-0-147><a id=__codelineno-0-147 name=__codelineno-0-147></a>    <span class=nd>@abstractmethod</span>
</span><span id=__span-0-148><a id=__codelineno-0-148 name=__codelineno-0-148></a>    <span class=k>def</span><span class=w> </span><span class=nf>evaluation_name</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-0-149><a id=__codelineno-0-149 name=__codelineno-0-149></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns a unique name for (benchmark, solver) tuple, e.g. &#39;mbpp&#39; or &#39;live_bench&#39; or &#39;mmlu-5-shot&#39;.&quot;&quot;&quot;</span>
</span><span id=__span-0-150><a id=__codelineno-0-150 name=__codelineno-0-150></a>        <span class=o>...</span>
</span><span id=__span-0-151><a id=__codelineno-0-151 name=__codelineno-0-151></a>
</span><span id=__span-0-152><a id=__codelineno-0-152 name=__codelineno-0-152></a>    <span class=nd>@abstractmethod</span>
</span><span id=__span-0-153><a id=__codelineno-0-153 name=__codelineno-0-153></a>    <span class=k>def</span><span class=w> </span><span class=nf>compatible_datasets</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
</span><span id=__span-0-154><a id=__codelineno-0-154 name=__codelineno-0-154></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns the list of datasets that the solver strategy is compatible with.&quot;&quot;&quot;</span>
</span><span id=__span-0-155><a id=__codelineno-0-155 name=__codelineno-0-155></a>        <span class=o>...</span>
</span><span id=__span-0-156><a id=__codelineno-0-156 name=__codelineno-0-156></a>
</span><span id=__span-0-157><a id=__codelineno-0-157 name=__codelineno-0-157></a>    <span class=k>def</span><span class=w> </span><span class=nf>agent_name</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-0-158><a id=__codelineno-0-158 name=__codelineno-0-158></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns agent name that is evaluated.&quot;&quot;&quot;</span>
</span><span id=__span-0-159><a id=__codelineno-0-159 name=__codelineno-0-159></a>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>agent</span><span class=p>:</span>
</span><span id=__span-0-160><a id=__codelineno-0-160 name=__codelineno-0-160></a>            <span class=k>return</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-161><a id=__codelineno-0-161 name=__codelineno-0-161></a>        <span class=n>path</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>agent</span><span class=p>)</span>
</span><span id=__span-0-162><a id=__codelineno-0-162 name=__codelineno-0-162></a>        <span class=k>return</span> <span class=n>path</span><span class=o>.</span><span class=n>parent</span><span class=o>.</span><span class=n>name</span>
</span><span id=__span-0-163><a id=__codelineno-0-163 name=__codelineno-0-163></a>
</span><span id=__span-0-164><a id=__codelineno-0-164 name=__codelineno-0-164></a>    <span class=k>def</span><span class=w> </span><span class=nf>agent_version</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-0-165><a id=__codelineno-0-165 name=__codelineno-0-165></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns agent name that is evaluated.&quot;&quot;&quot;</span>
</span><span id=__span-0-166><a id=__codelineno-0-166 name=__codelineno-0-166></a>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>agent</span><span class=p>:</span>
</span><span id=__span-0-167><a id=__codelineno-0-167 name=__codelineno-0-167></a>            <span class=k>return</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-168><a id=__codelineno-0-168 name=__codelineno-0-168></a>        <span class=n>path</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>agent</span><span class=p>)</span>
</span><span id=__span-0-169><a id=__codelineno-0-169 name=__codelineno-0-169></a>        <span class=k>return</span> <span class=n>path</span><span class=o>.</span><span class=n>name</span>
</span><span id=__span-0-170><a id=__codelineno-0-170 name=__codelineno-0-170></a>
</span><span id=__span-0-171><a id=__codelineno-0-171 name=__codelineno-0-171></a>    <span class=k>def</span><span class=w> </span><span class=nf>evaluated_entry_namespace</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-0-172><a id=__codelineno-0-172 name=__codelineno-0-172></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns namespace of a model or agent to be evaluated.&quot;&quot;&quot;</span>
</span><span id=__span-0-173><a id=__codelineno-0-173 name=__codelineno-0-173></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>agent</span><span class=p>:</span>
</span><span id=__span-0-174><a id=__codelineno-0-174 name=__codelineno-0-174></a>            <span class=n>path</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>agent</span><span class=p>)</span>
</span><span id=__span-0-175><a id=__codelineno-0-175 name=__codelineno-0-175></a>            <span class=k>return</span> <span class=n>path</span><span class=o>.</span><span class=n>parent</span><span class=o>.</span><span class=n>parent</span><span class=o>.</span><span class=n>name</span>
</span><span id=__span-0-176><a id=__codelineno-0-176 name=__codelineno-0-176></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>model_namespace</span>
</span><span id=__span-0-177><a id=__codelineno-0-177 name=__codelineno-0-177></a>
</span><span id=__span-0-178><a id=__codelineno-0-178 name=__codelineno-0-178></a>    <span class=k>def</span><span class=w> </span><span class=nf>model_provider</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-0-179><a id=__codelineno-0-179 name=__codelineno-0-179></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns model provider.&quot;&quot;&quot;</span>
</span><span id=__span-0-180><a id=__codelineno-0-180 name=__codelineno-0-180></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>provider</span> <span class=o>!=</span> <span class=s2>&quot;&quot;</span><span class=p>:</span>
</span><span id=__span-0-181><a id=__codelineno-0-181 name=__codelineno-0-181></a>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>provider</span>
</span><span id=__span-0-182><a id=__codelineno-0-182 name=__codelineno-0-182></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>agent</span> <span class=o>!=</span> <span class=s2>&quot;&quot;</span><span class=p>:</span>
</span><span id=__span-0-183><a id=__codelineno-0-183 name=__codelineno-0-183></a>            <span class=n>agent_obj</span> <span class=o>=</span> <span class=n>Agent</span><span class=o>.</span><span class=n>load_agent</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>agent</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>client_config</span><span class=p>)</span>
</span><span id=__span-0-184><a id=__codelineno-0-184 name=__codelineno-0-184></a>            <span class=k>return</span> <span class=n>agent_obj</span><span class=o>.</span><span class=n>model_provider</span>
</span><span id=__span-0-185><a id=__codelineno-0-185 name=__codelineno-0-185></a>        <span class=k>return</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-186><a id=__codelineno-0-186 name=__codelineno-0-186></a>
</span><span id=__span-0-187><a id=__codelineno-0-187 name=__codelineno-0-187></a>    <span class=nd>@abstractmethod</span>
</span><span id=__span-0-188><a id=__codelineno-0-188 name=__codelineno-0-188></a>    <span class=k>def</span><span class=w> </span><span class=nf>solve</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>datum</span><span class=p>:</span> <span class=nb>dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span><span class=nb>bool</span><span class=p>,</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>bool</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]:</span>
</span><span id=__span-0-189><a id=__codelineno-0-189 name=__codelineno-0-189></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Solves the task for the given datum.&quot;&quot;&quot;</span>
</span><span id=__span-0-190><a id=__codelineno-0-190 name=__codelineno-0-190></a>        <span class=o>...</span>
</span><span id=__span-0-191><a id=__codelineno-0-191 name=__codelineno-0-191></a>
</span><span id=__span-0-192><a id=__codelineno-0-192 name=__codelineno-0-192></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_custom_tasks</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>dict</span><span class=p>]:</span>
</span><span id=__span-0-193><a id=__codelineno-0-193 name=__codelineno-0-193></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Custom tasks for custom benchmark.&quot;&quot;&quot;</span>
</span><span id=__span-0-194><a id=__codelineno-0-194 name=__codelineno-0-194></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>scoring_method</span> <span class=o>==</span> <span class=n>SolverScoringMethod</span><span class=o>.</span><span class=n>Custom</span><span class=p>:</span>
</span><span id=__span-0-195><a id=__codelineno-0-195 name=__codelineno-0-195></a>            <span class=k>raise</span> <span class=ne>NotImplementedError</span><span class=p>(</span><span class=s2>&quot;get_custom_tasks must be implemented for Custom scoring method&quot;</span><span class=p>)</span>
</span><span id=__span-0-196><a id=__codelineno-0-196 name=__codelineno-0-196></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-197><a id=__codelineno-0-197 name=__codelineno-0-197></a>            <span class=k>raise</span> <span class=ne>AttributeError</span><span class=p>(</span><span class=s2>&quot;get_custom_tasks is only applicable for Custom scoring method&quot;</span><span class=p>)</span>
</span><span id=__span-0-198><a id=__codelineno-0-198 name=__codelineno-0-198></a>
</span><span id=__span-0-199><a id=__codelineno-0-199 name=__codelineno-0-199></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_evaluation_metrics</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>tasks_results</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Tuple</span><span class=p>[</span><span class=nb>bool</span><span class=p>,</span> <span class=n>Any</span><span class=p>]])</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span><span id=__span-0-200><a id=__codelineno-0-200 name=__codelineno-0-200></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Given results for all datums, returns evaluation metrics.</span>
</span><span id=__span-0-201><a id=__codelineno-0-201 name=__codelineno-0-201></a>
</span><span id=__span-0-202><a id=__codelineno-0-202 name=__codelineno-0-202></a><span class=sd>        Not used by TrueOrFalseList scoring method.</span>
</span><span id=__span-0-203><a id=__codelineno-0-203 name=__codelineno-0-203></a><span class=sd>        Do not prepend with evaluation_name. If hierarchical, use slashes /.</span>
</span><span id=__span-0-204><a id=__codelineno-0-204 name=__codelineno-0-204></a><span class=sd>        Expected metrics is a dict of scores, e.g.: {&quot;average&quot;: &lt;val&gt;, &quot;group/coding&quot;: &lt;val&gt;}.</span>
</span><span id=__span-0-205><a id=__codelineno-0-205 name=__codelineno-0-205></a><span class=sd>        &quot;&quot;&quot;</span>
</span><span id=__span-0-206><a id=__codelineno-0-206 name=__codelineno-0-206></a>        <span class=k>raise</span> <span class=ne>NotImplementedError</span><span class=p>(</span><span class=s2>&quot;get_evaluation_metrics not implemented&quot;</span><span class=p>)</span>
</span><span id=__span-0-207><a id=__codelineno-0-207 name=__codelineno-0-207></a>
</span><span id=__span-0-208><a id=__codelineno-0-208 name=__codelineno-0-208></a>    <span class=k>def</span><span class=w> </span><span class=nf>start_inference_session</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>task_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>SolverInferenceSession</span><span class=p>:</span>
</span><span id=__span-0-209><a id=__codelineno-0-209 name=__codelineno-0-209></a>        <span class=k>return</span> <span class=n>SolverInferenceSession</span><span class=p>(</span>
</span><span id=__span-0-210><a id=__codelineno-0-210 name=__codelineno-0-210></a>            <span class=bp>self</span><span class=o>.</span><span class=n>agent</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>agent_params</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>model_full_path</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>evaluation_name</span><span class=p>()</span>
</span><span id=__span-0-211><a id=__codelineno-0-211 name=__codelineno-0-211></a>        <span class=p>)</span><span class=o>.</span><span class=n>start_inference_session</span><span class=p>(</span><span class=n>task_id</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-attribute"> <h5 id=nearai.solvers.SolverStrategy.name class="doc doc-heading"> <span class="doc doc-object-name doc-attribute-name">name</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> <a href=#nearai.solvers.SolverStrategy.name class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=n>name</span><span class=p>:</span> <span class=n>str</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Returns the name of the solver strategy.</p> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.solvers.SolverStrategy.agent_name class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">agent_name</span> <a href=#nearai.solvers.SolverStrategy.agent_name class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>agent_name</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n>str</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Returns agent name that is evaluated.</p> <details class=quote> <summary>Source code in <code>nearai/solvers/__init__.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-157>157</a></span>
<span class=normal><a href=#__codelineno-0-158>158</a></span>
<span class=normal><a href=#__codelineno-0-159>159</a></span>
<span class=normal><a href=#__codelineno-0-160>160</a></span>
<span class=normal><a href=#__codelineno-0-161>161</a></span>
<span class=normal><a href=#__codelineno-0-162>162</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-157><a id=__codelineno-0-157 name=__codelineno-0-157></a><span class=k>def</span><span class=w> </span><span class=nf>agent_name</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-0-158><a id=__codelineno-0-158 name=__codelineno-0-158></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns agent name that is evaluated.&quot;&quot;&quot;</span>
</span><span id=__span-0-159><a id=__codelineno-0-159 name=__codelineno-0-159></a>    <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>agent</span><span class=p>:</span>
</span><span id=__span-0-160><a id=__codelineno-0-160 name=__codelineno-0-160></a>        <span class=k>return</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-161><a id=__codelineno-0-161 name=__codelineno-0-161></a>    <span class=n>path</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>agent</span><span class=p>)</span>
</span><span id=__span-0-162><a id=__codelineno-0-162 name=__codelineno-0-162></a>    <span class=k>return</span> <span class=n>path</span><span class=o>.</span><span class=n>parent</span><span class=o>.</span><span class=n>name</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.solvers.SolverStrategy.agent_version class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">agent_version</span> <a href=#nearai.solvers.SolverStrategy.agent_version class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>agent_version</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n>str</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Returns agent name that is evaluated.</p> <details class=quote> <summary>Source code in <code>nearai/solvers/__init__.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-164>164</a></span>
<span class=normal><a href=#__codelineno-0-165>165</a></span>
<span class=normal><a href=#__codelineno-0-166>166</a></span>
<span class=normal><a href=#__codelineno-0-167>167</a></span>
<span class=normal><a href=#__codelineno-0-168>168</a></span>
<span class=normal><a href=#__codelineno-0-169>169</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-164><a id=__codelineno-0-164 name=__codelineno-0-164></a><span class=k>def</span><span class=w> </span><span class=nf>agent_version</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-0-165><a id=__codelineno-0-165 name=__codelineno-0-165></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns agent name that is evaluated.&quot;&quot;&quot;</span>
</span><span id=__span-0-166><a id=__codelineno-0-166 name=__codelineno-0-166></a>    <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>agent</span><span class=p>:</span>
</span><span id=__span-0-167><a id=__codelineno-0-167 name=__codelineno-0-167></a>        <span class=k>return</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-168><a id=__codelineno-0-168 name=__codelineno-0-168></a>    <span class=n>path</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>agent</span><span class=p>)</span>
</span><span id=__span-0-169><a id=__codelineno-0-169 name=__codelineno-0-169></a>    <span class=k>return</span> <span class=n>path</span><span class=o>.</span><span class=n>name</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.solvers.SolverStrategy.compatible_datasets class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">compatible_datasets</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small> </span> <a href=#nearai.solvers.SolverStrategy.compatible_datasets class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>compatible_datasets</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n><span title=typing.List>List</span></span><span class=p>[</span><span class=n>str</span><span class=p>]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Returns the list of datasets that the solver strategy is compatible with.</p> <details class=quote> <summary>Source code in <code>nearai/solvers/__init__.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-152>152</a></span>
<span class=normal><a href=#__codelineno-0-153>153</a></span>
<span class=normal><a href=#__codelineno-0-154>154</a></span>
<span class=normal><a href=#__codelineno-0-155>155</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-152><a id=__codelineno-0-152 name=__codelineno-0-152></a><span class=nd>@abstractmethod</span>
</span><span id=__span-0-153><a id=__codelineno-0-153 name=__codelineno-0-153></a><span class=k>def</span><span class=w> </span><span class=nf>compatible_datasets</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
</span><span id=__span-0-154><a id=__codelineno-0-154 name=__codelineno-0-154></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns the list of datasets that the solver strategy is compatible with.&quot;&quot;&quot;</span>
</span><span id=__span-0-155><a id=__codelineno-0-155 name=__codelineno-0-155></a>    <span class=o>...</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.solvers.SolverStrategy.evaluated_entry_namespace class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">evaluated_entry_namespace</span> <a href=#nearai.solvers.SolverStrategy.evaluated_entry_namespace class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>evaluated_entry_namespace</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n>str</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Returns namespace of a model or agent to be evaluated.</p> <details class=quote> <summary>Source code in <code>nearai/solvers/__init__.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-171>171</a></span>
<span class=normal><a href=#__codelineno-0-172>172</a></span>
<span class=normal><a href=#__codelineno-0-173>173</a></span>
<span class=normal><a href=#__codelineno-0-174>174</a></span>
<span class=normal><a href=#__codelineno-0-175>175</a></span>
<span class=normal><a href=#__codelineno-0-176>176</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-171><a id=__codelineno-0-171 name=__codelineno-0-171></a><span class=k>def</span><span class=w> </span><span class=nf>evaluated_entry_namespace</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-0-172><a id=__codelineno-0-172 name=__codelineno-0-172></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns namespace of a model or agent to be evaluated.&quot;&quot;&quot;</span>
</span><span id=__span-0-173><a id=__codelineno-0-173 name=__codelineno-0-173></a>    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>agent</span><span class=p>:</span>
</span><span id=__span-0-174><a id=__codelineno-0-174 name=__codelineno-0-174></a>        <span class=n>path</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>agent</span><span class=p>)</span>
</span><span id=__span-0-175><a id=__codelineno-0-175 name=__codelineno-0-175></a>        <span class=k>return</span> <span class=n>path</span><span class=o>.</span><span class=n>parent</span><span class=o>.</span><span class=n>parent</span><span class=o>.</span><span class=n>name</span>
</span><span id=__span-0-176><a id=__codelineno-0-176 name=__codelineno-0-176></a>    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>model_namespace</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.solvers.SolverStrategy.evaluation_name class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">evaluation_name</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small> </span> <a href=#nearai.solvers.SolverStrategy.evaluation_name class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>evaluation_name</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n>str</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Returns a unique name for (benchmark, solver) tuple, e.g. 'mbpp' or 'live_bench' or 'mmlu-5-shot'.</p> <details class=quote> <summary>Source code in <code>nearai/solvers/__init__.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-147>147</a></span>
<span class=normal><a href=#__codelineno-0-148>148</a></span>
<span class=normal><a href=#__codelineno-0-149>149</a></span>
<span class=normal><a href=#__codelineno-0-150>150</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-147><a id=__codelineno-0-147 name=__codelineno-0-147></a><span class=nd>@abstractmethod</span>
</span><span id=__span-0-148><a id=__codelineno-0-148 name=__codelineno-0-148></a><span class=k>def</span><span class=w> </span><span class=nf>evaluation_name</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-0-149><a id=__codelineno-0-149 name=__codelineno-0-149></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns a unique name for (benchmark, solver) tuple, e.g. &#39;mbpp&#39; or &#39;live_bench&#39; or &#39;mmlu-5-shot&#39;.&quot;&quot;&quot;</span>
</span><span id=__span-0-150><a id=__codelineno-0-150 name=__codelineno-0-150></a>    <span class=o>...</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.solvers.SolverStrategy.get_custom_tasks class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_custom_tasks</span> <a href=#nearai.solvers.SolverStrategy.get_custom_tasks class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>get_custom_tasks</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n><span title=typing.List>List</span></span><span class=p>[</span><span class=n>dict</span><span class=p>]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Custom tasks for custom benchmark.</p> <details class=quote> <summary>Source code in <code>nearai/solvers/__init__.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-192>192</a></span>
<span class=normal><a href=#__codelineno-0-193>193</a></span>
<span class=normal><a href=#__codelineno-0-194>194</a></span>
<span class=normal><a href=#__codelineno-0-195>195</a></span>
<span class=normal><a href=#__codelineno-0-196>196</a></span>
<span class=normal><a href=#__codelineno-0-197>197</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-192><a id=__codelineno-0-192 name=__codelineno-0-192></a><span class=k>def</span><span class=w> </span><span class=nf>get_custom_tasks</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>dict</span><span class=p>]:</span>
</span><span id=__span-0-193><a id=__codelineno-0-193 name=__codelineno-0-193></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Custom tasks for custom benchmark.&quot;&quot;&quot;</span>
</span><span id=__span-0-194><a id=__codelineno-0-194 name=__codelineno-0-194></a>    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>scoring_method</span> <span class=o>==</span> <span class=n>SolverScoringMethod</span><span class=o>.</span><span class=n>Custom</span><span class=p>:</span>
</span><span id=__span-0-195><a id=__codelineno-0-195 name=__codelineno-0-195></a>        <span class=k>raise</span> <span class=ne>NotImplementedError</span><span class=p>(</span><span class=s2>&quot;get_custom_tasks must be implemented for Custom scoring method&quot;</span><span class=p>)</span>
</span><span id=__span-0-196><a id=__codelineno-0-196 name=__codelineno-0-196></a>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-197><a id=__codelineno-0-197 name=__codelineno-0-197></a>        <span class=k>raise</span> <span class=ne>AttributeError</span><span class=p>(</span><span class=s2>&quot;get_custom_tasks is only applicable for Custom scoring method&quot;</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.solvers.SolverStrategy.get_evaluation_metrics class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">get_evaluation_metrics</span> <a href=#nearai.solvers.SolverStrategy.get_evaluation_metrics class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>get_evaluation_metrics</span><span class=p>(</span><span class=n>tasks_results</span><span class=p>:</span> <span class=n><span title=typing.List>List</span></span><span class=p>[</span><span class=n><span title=typing.Tuple>Tuple</span></span><span class=p>[</span><span class=n>bool</span><span class=p>,</span> <span class=n><span title=typing.Any>Any</span></span><span class=p>]])</span> <span class=o>-&gt;</span> <span class=n><span title=typing.Dict>Dict</span></span><span class=p>[</span><span class=n>str</span><span class=p>,</span> <span class=n><span title=typing.Any>Any</span></span><span class=p>]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Given results for all datums, returns evaluation metrics.</p> <p>Not used by TrueOrFalseList scoring method. Do not prepend with evaluation_name. If hierarchical, use slashes /. Expected metrics is a dict of scores, e.g.: {"average": <val>, "group/coding": <val>}.</p> <details class=quote> <summary>Source code in <code>nearai/solvers/__init__.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-199>199</a></span>
<span class=normal><a href=#__codelineno-0-200>200</a></span>
<span class=normal><a href=#__codelineno-0-201>201</a></span>
<span class=normal><a href=#__codelineno-0-202>202</a></span>
<span class=normal><a href=#__codelineno-0-203>203</a></span>
<span class=normal><a href=#__codelineno-0-204>204</a></span>
<span class=normal><a href=#__codelineno-0-205>205</a></span>
<span class=normal><a href=#__codelineno-0-206>206</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-199><a id=__codelineno-0-199 name=__codelineno-0-199></a><span class=k>def</span><span class=w> </span><span class=nf>get_evaluation_metrics</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>tasks_results</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Tuple</span><span class=p>[</span><span class=nb>bool</span><span class=p>,</span> <span class=n>Any</span><span class=p>]])</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
</span><span id=__span-0-200><a id=__codelineno-0-200 name=__codelineno-0-200></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Given results for all datums, returns evaluation metrics.</span>
</span><span id=__span-0-201><a id=__codelineno-0-201 name=__codelineno-0-201></a>
</span><span id=__span-0-202><a id=__codelineno-0-202 name=__codelineno-0-202></a><span class=sd>    Not used by TrueOrFalseList scoring method.</span>
</span><span id=__span-0-203><a id=__codelineno-0-203 name=__codelineno-0-203></a><span class=sd>    Do not prepend with evaluation_name. If hierarchical, use slashes /.</span>
</span><span id=__span-0-204><a id=__codelineno-0-204 name=__codelineno-0-204></a><span class=sd>    Expected metrics is a dict of scores, e.g.: {&quot;average&quot;: &lt;val&gt;, &quot;group/coding&quot;: &lt;val&gt;}.</span>
</span><span id=__span-0-205><a id=__codelineno-0-205 name=__codelineno-0-205></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-206><a id=__codelineno-0-206 name=__codelineno-0-206></a>    <span class=k>raise</span> <span class=ne>NotImplementedError</span><span class=p>(</span><span class=s2>&quot;get_evaluation_metrics not implemented&quot;</span><span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.solvers.SolverStrategy.model_provider class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">model_provider</span> <a href=#nearai.solvers.SolverStrategy.model_provider class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>model_provider</span><span class=p>()</span> <span class=o>-&gt;</span> <span class=n>str</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Returns model provider.</p> <details class=quote> <summary>Source code in <code>nearai/solvers/__init__.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-178>178</a></span>
<span class=normal><a href=#__codelineno-0-179>179</a></span>
<span class=normal><a href=#__codelineno-0-180>180</a></span>
<span class=normal><a href=#__codelineno-0-181>181</a></span>
<span class=normal><a href=#__codelineno-0-182>182</a></span>
<span class=normal><a href=#__codelineno-0-183>183</a></span>
<span class=normal><a href=#__codelineno-0-184>184</a></span>
<span class=normal><a href=#__codelineno-0-185>185</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-178><a id=__codelineno-0-178 name=__codelineno-0-178></a><span class=k>def</span><span class=w> </span><span class=nf>model_provider</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-0-179><a id=__codelineno-0-179 name=__codelineno-0-179></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns model provider.&quot;&quot;&quot;</span>
</span><span id=__span-0-180><a id=__codelineno-0-180 name=__codelineno-0-180></a>    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>provider</span> <span class=o>!=</span> <span class=s2>&quot;&quot;</span><span class=p>:</span>
</span><span id=__span-0-181><a id=__codelineno-0-181 name=__codelineno-0-181></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>provider</span>
</span><span id=__span-0-182><a id=__codelineno-0-182 name=__codelineno-0-182></a>    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>agent</span> <span class=o>!=</span> <span class=s2>&quot;&quot;</span><span class=p>:</span>
</span><span id=__span-0-183><a id=__codelineno-0-183 name=__codelineno-0-183></a>        <span class=n>agent_obj</span> <span class=o>=</span> <span class=n>Agent</span><span class=o>.</span><span class=n>load_agent</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>agent</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>client_config</span><span class=p>)</span>
</span><span id=__span-0-184><a id=__codelineno-0-184 name=__codelineno-0-184></a>        <span class=k>return</span> <span class=n>agent_obj</span><span class=o>.</span><span class=n>model_provider</span>
</span><span id=__span-0-185><a id=__codelineno-0-185 name=__codelineno-0-185></a>    <span class=k>return</span> <span class=s2>&quot;&quot;</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.solvers.SolverStrategy.solve class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">solve</span> <span class="doc doc-labels"> <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small> </span> <a href=#nearai.solvers.SolverStrategy.solve class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>solve</span><span class=p>(</span><span class=n>datum</span><span class=p>:</span> <span class=n>dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=typing.Union>Union</span></span><span class=p>[</span><span class=n>bool</span><span class=p>,</span> <span class=n><span title=typing.Tuple>Tuple</span></span><span class=p>[</span><span class=n>bool</span><span class=p>,</span> <span class=n><span title=typing.Any>Any</span></span><span class=p>]]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Solves the task for the given datum.</p> <details class=quote> <summary>Source code in <code>nearai/solvers/__init__.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-187>187</a></span>
<span class=normal><a href=#__codelineno-0-188>188</a></span>
<span class=normal><a href=#__codelineno-0-189>189</a></span>
<span class=normal><a href=#__codelineno-0-190>190</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-187><a id=__codelineno-0-187 name=__codelineno-0-187></a><span class=nd>@abstractmethod</span>
</span><span id=__span-0-188><a id=__codelineno-0-188 name=__codelineno-0-188></a><span class=k>def</span><span class=w> </span><span class=nf>solve</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>datum</span><span class=p>:</span> <span class=nb>dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span><span class=nb>bool</span><span class=p>,</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>bool</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]:</span>
</span><span id=__span-0-189><a id=__codelineno-0-189 name=__codelineno-0-189></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Solves the task for the given datum.&quot;&quot;&quot;</span>
</span><span id=__span-0-190><a id=__codelineno-0-190 name=__codelineno-0-190></a>    <span class=o>...</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h4 id=nearai.solvers.SolverStrategyMeta class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">SolverStrategyMeta</span> <a href=#nearai.solvers.SolverStrategyMeta class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=abc.ABCMeta>ABCMeta</span></code></p> <p>Metaclass that automatically registers subclasses in the SolverStrategyRegistry.</p> <details class=quote> <summary>Source code in <code>nearai/solvers/__init__.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-31>31</a></span>
<span class=normal><a href=#__codelineno-0-32>32</a></span>
<span class=normal><a href=#__codelineno-0-33>33</a></span>
<span class=normal><a href=#__codelineno-0-34>34</a></span>
<span class=normal><a href=#__codelineno-0-35>35</a></span>
<span class=normal><a href=#__codelineno-0-36>36</a></span>
<span class=normal><a href=#__codelineno-0-37>37</a></span>
<span class=normal><a href=#__codelineno-0-38>38</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-31><a id=__codelineno-0-31 name=__codelineno-0-31></a><span class=k>class</span><span class=w> </span><span class=nc>SolverStrategyMeta</span><span class=p>(</span><span class=n>ABCMeta</span><span class=p>):</span>
</span><span id=__span-0-32><a id=__codelineno-0-32 name=__codelineno-0-32></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Metaclass that automatically registers subclasses in the SolverStrategyRegistry.&quot;&quot;&quot;</span>
</span><span id=__span-0-33><a id=__codelineno-0-33 name=__codelineno-0-33></a>
</span><span id=__span-0-34><a id=__codelineno-0-34 name=__codelineno-0-34></a>    <span class=k>def</span><span class=w> </span><span class=fm>__new__</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>bases</span><span class=p>:</span> <span class=nb>tuple</span><span class=p>,</span> <span class=n>namespace</span><span class=p>:</span> <span class=nb>dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Any</span><span class=p>:</span>
</span><span id=__span-0-35><a id=__codelineno-0-35 name=__codelineno-0-35></a>        <span class=n>new_class</span> <span class=o>=</span> <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__new__</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>bases</span><span class=p>,</span> <span class=n>namespace</span><span class=p>)</span>
</span><span id=__span-0-36><a id=__codelineno-0-36 name=__codelineno-0-36></a>        <span class=k>if</span> <span class=n>bases</span> <span class=o>!=</span> <span class=p>(</span><span class=n>ABC</span><span class=p>,):</span>  <span class=c1># Avoid registering the abstract base class itself</span>
</span><span id=__span-0-37><a id=__codelineno-0-37 name=__codelineno-0-37></a>            <span class=n>SolverStrategyRegistry</span><span class=p>[</span><span class=n>new_class</span><span class=o>.</span><span class=vm>__name__</span><span class=p>]</span> <span class=o>=</span> <span class=n>new_class</span>  <span class=c1># type: ignore</span>
</span><span id=__span-0-38><a id=__codelineno-0-38 name=__codelineno-0-38></a>        <span class=k>return</span> <span class=n>new_class</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-module"> <h4 id=nearai.solvers.ddot_v0_solver class="doc doc-heading"> <span class="doc doc-object-name doc-module-name">ddot_v0_solver</span> <a href=#nearai.solvers.ddot_v0_solver class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h5 id=nearai.solvers.ddot_v0_solver.DDOTSEnvironment class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">DDOTSEnvironment</span> <a href=#nearai.solvers.ddot_v0_solver.DDOTSEnvironment class=headerlink title="Permanent link">&para;</a></h5> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title=nearai.agents.environment.Environment href=#nearai.agents.environment.Environment>Environment</a></code></p> <details class=quote> <summary>Source code in <code>nearai/solvers/ddot_v0_solver.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-77> 77</a></span>
<span class=normal><a href=#__codelineno-0-78> 78</a></span>
<span class=normal><a href=#__codelineno-0-79> 79</a></span>
<span class=normal><a href=#__codelineno-0-80> 80</a></span>
<span class=normal><a href=#__codelineno-0-81> 81</a></span>
<span class=normal><a href=#__codelineno-0-82> 82</a></span>
<span class=normal><a href=#__codelineno-0-83> 83</a></span>
<span class=normal><a href=#__codelineno-0-84> 84</a></span>
<span class=normal><a href=#__codelineno-0-85> 85</a></span>
<span class=normal><a href=#__codelineno-0-86> 86</a></span>
<span class=normal><a href=#__codelineno-0-87> 87</a></span>
<span class=normal><a href=#__codelineno-0-88> 88</a></span>
<span class=normal><a href=#__codelineno-0-89> 89</a></span>
<span class=normal><a href=#__codelineno-0-90> 90</a></span>
<span class=normal><a href=#__codelineno-0-91> 91</a></span>
<span class=normal><a href=#__codelineno-0-92> 92</a></span>
<span class=normal><a href=#__codelineno-0-93> 93</a></span>
<span class=normal><a href=#__codelineno-0-94> 94</a></span>
<span class=normal><a href=#__codelineno-0-95> 95</a></span>
<span class=normal><a href=#__codelineno-0-96> 96</a></span>
<span class=normal><a href=#__codelineno-0-97> 97</a></span>
<span class=normal><a href=#__codelineno-0-98> 98</a></span>
<span class=normal><a href=#__codelineno-0-99> 99</a></span>
<span class=normal><a href=#__codelineno-0-100>100</a></span>
<span class=normal><a href=#__codelineno-0-101>101</a></span>
<span class=normal><a href=#__codelineno-0-102>102</a></span>
<span class=normal><a href=#__codelineno-0-103>103</a></span>
<span class=normal><a href=#__codelineno-0-104>104</a></span>
<span class=normal><a href=#__codelineno-0-105>105</a></span>
<span class=normal><a href=#__codelineno-0-106>106</a></span>
<span class=normal><a href=#__codelineno-0-107>107</a></span>
<span class=normal><a href=#__codelineno-0-108>108</a></span>
<span class=normal><a href=#__codelineno-0-109>109</a></span>
<span class=normal><a href=#__codelineno-0-110>110</a></span>
<span class=normal><a href=#__codelineno-0-111>111</a></span>
<span class=normal><a href=#__codelineno-0-112>112</a></span>
<span class=normal><a href=#__codelineno-0-113>113</a></span>
<span class=normal><a href=#__codelineno-0-114>114</a></span>
<span class=normal><a href=#__codelineno-0-115>115</a></span>
<span class=normal><a href=#__codelineno-0-116>116</a></span>
<span class=normal><a href=#__codelineno-0-117>117</a></span>
<span class=normal><a href=#__codelineno-0-118>118</a></span>
<span class=normal><a href=#__codelineno-0-119>119</a></span>
<span class=normal><a href=#__codelineno-0-120>120</a></span>
<span class=normal><a href=#__codelineno-0-121>121</a></span>
<span class=normal><a href=#__codelineno-0-122>122</a></span>
<span class=normal><a href=#__codelineno-0-123>123</a></span>
<span class=normal><a href=#__codelineno-0-124>124</a></span>
<span class=normal><a href=#__codelineno-0-125>125</a></span>
<span class=normal><a href=#__codelineno-0-126>126</a></span>
<span class=normal><a href=#__codelineno-0-127>127</a></span>
<span class=normal><a href=#__codelineno-0-128>128</a></span>
<span class=normal><a href=#__codelineno-0-129>129</a></span>
<span class=normal><a href=#__codelineno-0-130>130</a></span>
<span class=normal><a href=#__codelineno-0-131>131</a></span>
<span class=normal><a href=#__codelineno-0-132>132</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-77><a id=__codelineno-0-77 name=__codelineno-0-77></a><span class=k>class</span><span class=w> </span><span class=nc>DDOTSEnvironment</span><span class=p>(</span><span class=n>Environment</span><span class=p>):</span>
</span><span id=__span-0-78><a id=__codelineno-0-78 name=__codelineno-0-78></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>agents</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Agent</span><span class=p>],</span> <span class=n>problem_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>description</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>client</span><span class=p>):</span>  <span class=c1># noqa: D107</span>
</span><span id=__span-0-79><a id=__codelineno-0-79 name=__codelineno-0-79></a>        <span class=bp>self</span><span class=o>.</span><span class=n>tdir</span> <span class=o>=</span> <span class=n>TemporaryDirectory</span><span class=p>()</span>
</span><span id=__span-0-80><a id=__codelineno-0-80 name=__codelineno-0-80></a>        <span class=bp>self</span><span class=o>.</span><span class=n>hub_client</span> <span class=o>=</span> <span class=n>get_hub_client</span><span class=p>()</span>
</span><span id=__span-0-81><a id=__codelineno-0-81 name=__codelineno-0-81></a>        <span class=n>thread</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>hub_client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>create</span><span class=p>()</span>
</span><span id=__span-0-82><a id=__codelineno-0-82 name=__codelineno-0-82></a>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span>
</span><span id=__span-0-83><a id=__codelineno-0-83 name=__codelineno-0-83></a>            <span class=bp>self</span><span class=o>.</span><span class=n>tdir</span><span class=o>.</span><span class=n>name</span><span class=p>,</span>
</span><span id=__span-0-84><a id=__codelineno-0-84 name=__codelineno-0-84></a>            <span class=n>agents</span><span class=p>,</span>
</span><span id=__span-0-85><a id=__codelineno-0-85 name=__codelineno-0-85></a>            <span class=n>client</span><span class=p>,</span>
</span><span id=__span-0-86><a id=__codelineno-0-86 name=__codelineno-0-86></a>            <span class=bp>self</span><span class=o>.</span><span class=n>hub_client</span><span class=p>,</span>
</span><span id=__span-0-87><a id=__codelineno-0-87 name=__codelineno-0-87></a>            <span class=n>thread</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span><span id=__span-0-88><a id=__codelineno-0-88 name=__codelineno-0-88></a>            <span class=s2>&quot;todo&quot;</span><span class=p>,</span>
</span><span id=__span-0-89><a id=__codelineno-0-89 name=__codelineno-0-89></a>            <span class=n>approvals</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;confirm_execution&quot;</span><span class=p>:</span> <span class=k>lambda</span> <span class=n>_</span><span class=p>:</span> <span class=kc>False</span><span class=p>},</span>
</span><span id=__span-0-90><a id=__codelineno-0-90 name=__codelineno-0-90></a>        <span class=p>)</span>
</span><span id=__span-0-91><a id=__codelineno-0-91 name=__codelineno-0-91></a>
</span><span id=__span-0-92><a id=__codelineno-0-92 name=__codelineno-0-92></a>        <span class=bp>self</span><span class=o>.</span><span class=n>problem_id</span> <span class=o>=</span> <span class=n>problem_id</span>
</span><span id=__span-0-93><a id=__codelineno-0-93 name=__codelineno-0-93></a>        <span class=bp>self</span><span class=o>.</span><span class=n>solved</span> <span class=o>=</span> <span class=kc>False</span>
</span><span id=__span-0-94><a id=__codelineno-0-94 name=__codelineno-0-94></a>
</span><span id=__span-0-95><a id=__codelineno-0-95 name=__codelineno-0-95></a>        <span class=n>files</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-96><a id=__codelineno-0-96 name=__codelineno-0-96></a>            <span class=s2>&quot;.id&quot;</span><span class=p>:</span> <span class=n>problem_id</span><span class=p>,</span>
</span><span id=__span-0-97><a id=__codelineno-0-97 name=__codelineno-0-97></a>            <span class=s2>&quot;PROBLEM.txt&quot;</span><span class=p>:</span> <span class=n>description</span><span class=p>,</span>
</span><span id=__span-0-98><a id=__codelineno-0-98 name=__codelineno-0-98></a>            <span class=s2>&quot;solution.py&quot;</span><span class=p>:</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-99><a id=__codelineno-0-99 name=__codelineno-0-99></a>            <span class=s2>&quot;test.in&quot;</span><span class=p>:</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-0-100><a id=__codelineno-0-100 name=__codelineno-0-100></a>            <span class=s2>&quot;test.sh&quot;</span><span class=p>:</span> <span class=s2>&quot;#!/bin/bash</span><span class=se>\n</span><span class=s2>python3 solution.py &lt; test.in&quot;</span><span class=p>,</span>
</span><span id=__span-0-101><a id=__codelineno-0-101 name=__codelineno-0-101></a>        <span class=p>}</span>
</span><span id=__span-0-102><a id=__codelineno-0-102 name=__codelineno-0-102></a>        <span class=k>for</span> <span class=n>fname</span><span class=p>,</span> <span class=n>content</span> <span class=ow>in</span> <span class=n>files</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span><span id=__span-0-103><a id=__codelineno-0-103 name=__codelineno-0-103></a>            <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>tdir</span><span class=o>.</span><span class=n>name</span> <span class=o>+</span> <span class=s2>&quot;/&quot;</span> <span class=o>+</span> <span class=n>fname</span><span class=p>,</span> <span class=s2>&quot;w&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-104><a id=__codelineno-0-104 name=__codelineno-0-104></a>                <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>
</span><span id=__span-0-105><a id=__codelineno-0-105 name=__codelineno-0-105></a>
</span><span id=__span-0-106><a id=__codelineno-0-106 name=__codelineno-0-106></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>async_submit</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>code</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>bool</span><span class=p>,</span> <span class=nb>str</span><span class=p>]:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-107><a id=__codelineno-0-107 name=__codelineno-0-107></a>        <span class=n>submission_id</span> <span class=o>=</span> <span class=k>await</span> <span class=n>submit_problem</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>problem_id</span><span class=p>,</span> <span class=n>code</span><span class=p>,</span> <span class=n>Extensions</span><span class=o>.</span><span class=n>PYTHON</span><span class=p>)</span>
</span><span id=__span-0-108><a id=__codelineno-0-108 name=__codelineno-0-108></a>
</span><span id=__span-0-109><a id=__codelineno-0-109 name=__codelineno-0-109></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-110><a id=__codelineno-0-110 name=__codelineno-0-110></a>            <span class=k>await</span> <span class=n>is_output_ready</span><span class=p>(</span><span class=n>submission_id</span><span class=p>)</span>
</span><span id=__span-0-111><a id=__codelineno-0-111 name=__codelineno-0-111></a>        <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
</span><span id=__span-0-112><a id=__codelineno-0-112 name=__codelineno-0-112></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;WARNING: Submission took too long to execute on DDOTS&quot;</span><span class=p>)</span>
</span><span id=__span-0-113><a id=__codelineno-0-113 name=__codelineno-0-113></a>            <span class=bp>self</span><span class=o>.</span><span class=n>mark_done</span><span class=p>()</span>
</span><span id=__span-0-114><a id=__codelineno-0-114 name=__codelineno-0-114></a>            <span class=k>return</span> <span class=kc>False</span><span class=p>,</span> <span class=s2>&quot;Submission took too long to execute on the platform&quot;</span>
</span><span id=__span-0-115><a id=__codelineno-0-115 name=__codelineno-0-115></a>
</span><span id=__span-0-116><a id=__codelineno-0-116 name=__codelineno-0-116></a>        <span class=n>ok</span> <span class=o>=</span> <span class=k>await</span> <span class=n>submission_accepted</span><span class=p>(</span><span class=n>submission_id</span><span class=p>)</span>
</span><span id=__span-0-117><a id=__codelineno-0-117 name=__codelineno-0-117></a>
</span><span id=__span-0-118><a id=__codelineno-0-118 name=__codelineno-0-118></a>        <span class=k>if</span> <span class=n>ok</span><span class=p>:</span>
</span><span id=__span-0-119><a id=__codelineno-0-119 name=__codelineno-0-119></a>            <span class=bp>self</span><span class=o>.</span><span class=n>solved</span> <span class=o>=</span> <span class=kc>True</span>
</span><span id=__span-0-120><a id=__codelineno-0-120 name=__codelineno-0-120></a>            <span class=bp>self</span><span class=o>.</span><span class=n>mark_done</span><span class=p>()</span>
</span><span id=__span-0-121><a id=__codelineno-0-121 name=__codelineno-0-121></a>            <span class=k>return</span> <span class=kc>True</span><span class=p>,</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-122><a id=__codelineno-0-122 name=__codelineno-0-122></a>
</span><span id=__span-0-123><a id=__codelineno-0-123 name=__codelineno-0-123></a>        <span class=n>output</span> <span class=o>=</span> <span class=k>await</span> <span class=n>get_output</span><span class=p>(</span><span class=n>submission_id</span><span class=p>)</span>
</span><span id=__span-0-124><a id=__codelineno-0-124 name=__codelineno-0-124></a>
</span><span id=__span-0-125><a id=__codelineno-0-125 name=__codelineno-0-125></a>        <span class=k>return</span> <span class=kc>False</span><span class=p>,</span> <span class=n>output</span>
</span><span id=__span-0-126><a id=__codelineno-0-126 name=__codelineno-0-126></a>
</span><span id=__span-0-127><a id=__codelineno-0-127 name=__codelineno-0-127></a>    <span class=k>def</span><span class=w> </span><span class=nf>submit_python</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>code</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>bool</span><span class=p>,</span> <span class=nb>str</span><span class=p>]:</span>
</span><span id=__span-0-128><a id=__codelineno-0-128 name=__codelineno-0-128></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Returns True if the submission was accepted, False otherwise.</span>
</span><span id=__span-0-129><a id=__codelineno-0-129 name=__codelineno-0-129></a>
</span><span id=__span-0-130><a id=__codelineno-0-130 name=__codelineno-0-130></a><span class=sd>        The second element of the tuple is the output of the checker if the submission was rejected.</span>
</span><span id=__span-0-131><a id=__codelineno-0-131 name=__codelineno-0-131></a><span class=sd>        &quot;&quot;&quot;</span>
</span><span id=__span-0-132><a id=__codelineno-0-132 name=__codelineno-0-132></a>        <span class=k>return</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>async_submit</span><span class=p>(</span><span class=n>code</span><span class=p>))</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h6 id=nearai.solvers.ddot_v0_solver.DDOTSEnvironment.submit_python class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">submit_python</span> <a href=#nearai.solvers.ddot_v0_solver.DDOTSEnvironment.submit_python class=headerlink title="Permanent link">&para;</a></h6> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>submit_python</span><span class=p>(</span><span class=n>code</span><span class=p>:</span> <span class=n>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n><span title=typing.Tuple>Tuple</span></span><span class=p>[</span><span class=n>bool</span><span class=p>,</span> <span class=n>str</span><span class=p>]</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Returns True if the submission was accepted, False otherwise.</p> <p>The second element of the tuple is the output of the checker if the submission was rejected.</p> <details class=quote> <summary>Source code in <code>nearai/solvers/ddot_v0_solver.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-127>127</a></span>
<span class=normal><a href=#__codelineno-0-128>128</a></span>
<span class=normal><a href=#__codelineno-0-129>129</a></span>
<span class=normal><a href=#__codelineno-0-130>130</a></span>
<span class=normal><a href=#__codelineno-0-131>131</a></span>
<span class=normal><a href=#__codelineno-0-132>132</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-127><a id=__codelineno-0-127 name=__codelineno-0-127></a><span class=k>def</span><span class=w> </span><span class=nf>submit_python</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>code</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>bool</span><span class=p>,</span> <span class=nb>str</span><span class=p>]:</span>
</span><span id=__span-0-128><a id=__codelineno-0-128 name=__codelineno-0-128></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Returns True if the submission was accepted, False otherwise.</span>
</span><span id=__span-0-129><a id=__codelineno-0-129 name=__codelineno-0-129></a>
</span><span id=__span-0-130><a id=__codelineno-0-130 name=__codelineno-0-130></a><span class=sd>    The second element of the tuple is the output of the checker if the submission was rejected.</span>
</span><span id=__span-0-131><a id=__codelineno-0-131 name=__codelineno-0-131></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-132><a id=__codelineno-0-132 name=__codelineno-0-132></a>    <span class=k>return</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>async_submit</span><span class=p>(</span><span class=n>code</span><span class=p>))</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h5 id=nearai.solvers.ddot_v0_solver.DDOTSV0Solver class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">DDOTSV0Solver</span> <a href=#nearai.solvers.ddot_v0_solver.DDOTSV0Solver class=headerlink title="Permanent link">&para;</a></h5> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title=nearai.solvers.SolverStrategy href=#nearai.solvers.SolverStrategy>SolverStrategy</a></code></p> <p>Solver strategy for competitive programming problems live on DDOTS.</p> <p>This dataset will run agents in an Agent environment previously prepared.</p> <p>workspace/ .id -- Id of the problem PROBLEM.txt -- Description of the problem</p> <p>The agent should call env.submit_python(code) to submit the code to the DDOTS server.</p> <details class=quote> <summary>Source code in <code>nearai/solvers/ddot_v0_solver.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-135>135</a></span>
<span class=normal><a href=#__codelineno-0-136>136</a></span>
<span class=normal><a href=#__codelineno-0-137>137</a></span>
<span class=normal><a href=#__codelineno-0-138>138</a></span>
<span class=normal><a href=#__codelineno-0-139>139</a></span>
<span class=normal><a href=#__codelineno-0-140>140</a></span>
<span class=normal><a href=#__codelineno-0-141>141</a></span>
<span class=normal><a href=#__codelineno-0-142>142</a></span>
<span class=normal><a href=#__codelineno-0-143>143</a></span>
<span class=normal><a href=#__codelineno-0-144>144</a></span>
<span class=normal><a href=#__codelineno-0-145>145</a></span>
<span class=normal><a href=#__codelineno-0-146>146</a></span>
<span class=normal><a href=#__codelineno-0-147>147</a></span>
<span class=normal><a href=#__codelineno-0-148>148</a></span>
<span class=normal><a href=#__codelineno-0-149>149</a></span>
<span class=normal><a href=#__codelineno-0-150>150</a></span>
<span class=normal><a href=#__codelineno-0-151>151</a></span>
<span class=normal><a href=#__codelineno-0-152>152</a></span>
<span class=normal><a href=#__codelineno-0-153>153</a></span>
<span class=normal><a href=#__codelineno-0-154>154</a></span>
<span class=normal><a href=#__codelineno-0-155>155</a></span>
<span class=normal><a href=#__codelineno-0-156>156</a></span>
<span class=normal><a href=#__codelineno-0-157>157</a></span>
<span class=normal><a href=#__codelineno-0-158>158</a></span>
<span class=normal><a href=#__codelineno-0-159>159</a></span>
<span class=normal><a href=#__codelineno-0-160>160</a></span>
<span class=normal><a href=#__codelineno-0-161>161</a></span>
<span class=normal><a href=#__codelineno-0-162>162</a></span>
<span class=normal><a href=#__codelineno-0-163>163</a></span>
<span class=normal><a href=#__codelineno-0-164>164</a></span>
<span class=normal><a href=#__codelineno-0-165>165</a></span>
<span class=normal><a href=#__codelineno-0-166>166</a></span>
<span class=normal><a href=#__codelineno-0-167>167</a></span>
<span class=normal><a href=#__codelineno-0-168>168</a></span>
<span class=normal><a href=#__codelineno-0-169>169</a></span>
<span class=normal><a href=#__codelineno-0-170>170</a></span>
<span class=normal><a href=#__codelineno-0-171>171</a></span>
<span class=normal><a href=#__codelineno-0-172>172</a></span>
<span class=normal><a href=#__codelineno-0-173>173</a></span>
<span class=normal><a href=#__codelineno-0-174>174</a></span>
<span class=normal><a href=#__codelineno-0-175>175</a></span>
<span class=normal><a href=#__codelineno-0-176>176</a></span>
<span class=normal><a href=#__codelineno-0-177>177</a></span>
<span class=normal><a href=#__codelineno-0-178>178</a></span>
<span class=normal><a href=#__codelineno-0-179>179</a></span>
<span class=normal><a href=#__codelineno-0-180>180</a></span>
<span class=normal><a href=#__codelineno-0-181>181</a></span>
<span class=normal><a href=#__codelineno-0-182>182</a></span>
<span class=normal><a href=#__codelineno-0-183>183</a></span>
<span class=normal><a href=#__codelineno-0-184>184</a></span>
<span class=normal><a href=#__codelineno-0-185>185</a></span>
<span class=normal><a href=#__codelineno-0-186>186</a></span>
<span class=normal><a href=#__codelineno-0-187>187</a></span>
<span class=normal><a href=#__codelineno-0-188>188</a></span>
<span class=normal><a href=#__codelineno-0-189>189</a></span>
<span class=normal><a href=#__codelineno-0-190>190</a></span>
<span class=normal><a href=#__codelineno-0-191>191</a></span>
<span class=normal><a href=#__codelineno-0-192>192</a></span>
<span class=normal><a href=#__codelineno-0-193>193</a></span>
<span class=normal><a href=#__codelineno-0-194>194</a></span>
<span class=normal><a href=#__codelineno-0-195>195</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-135><a id=__codelineno-0-135 name=__codelineno-0-135></a><span class=k>class</span><span class=w> </span><span class=nc>DDOTSV0Solver</span><span class=p>(</span><span class=n>SolverStrategy</span><span class=p>):</span>
</span><span id=__span-0-136><a id=__codelineno-0-136 name=__codelineno-0-136></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Solver strategy for competitive programming problems live on DDOTS.</span>
</span><span id=__span-0-137><a id=__codelineno-0-137 name=__codelineno-0-137></a>
</span><span id=__span-0-138><a id=__codelineno-0-138 name=__codelineno-0-138></a><span class=sd>    This dataset will run agents in an Agent environment previously prepared.</span>
</span><span id=__span-0-139><a id=__codelineno-0-139 name=__codelineno-0-139></a>
</span><span id=__span-0-140><a id=__codelineno-0-140 name=__codelineno-0-140></a><span class=sd>    workspace/</span>
</span><span id=__span-0-141><a id=__codelineno-0-141 name=__codelineno-0-141></a><span class=sd>        .id             -- Id of the problem</span>
</span><span id=__span-0-142><a id=__codelineno-0-142 name=__codelineno-0-142></a><span class=sd>        PROBLEM.txt     -- Description of the problem</span>
</span><span id=__span-0-143><a id=__codelineno-0-143 name=__codelineno-0-143></a>
</span><span id=__span-0-144><a id=__codelineno-0-144 name=__codelineno-0-144></a><span class=sd>    The agent should call env.submit_python(code) to submit the code to the DDOTS server.</span>
</span><span id=__span-0-145><a id=__codelineno-0-145 name=__codelineno-0-145></a>
</span><span id=__span-0-146><a id=__codelineno-0-146 name=__codelineno-0-146></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-0-147><a id=__codelineno-0-147 name=__codelineno-0-147></a>
</span><span id=__span-0-148><a id=__codelineno-0-148 name=__codelineno-0-148></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>dataset_ref</span><span class=p>:</span> <span class=n>Dataset</span><span class=p>,</span> <span class=n>agents</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>max_iterations</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>save_snapshots</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>):</span>  <span class=c1># noqa: D107</span>
</span><span id=__span-0-149><a id=__codelineno-0-149 name=__codelineno-0-149></a>        <span class=n>client_config</span> <span class=o>=</span> <span class=n>ClientConfig</span><span class=p>(</span>
</span><span id=__span-0-150><a id=__codelineno-0-150 name=__codelineno-0-150></a>            <span class=n>base_url</span><span class=o>=</span><span class=n>CONFIG</span><span class=o>.</span><span class=n>nearai_hub</span><span class=o>.</span><span class=n>base_url</span><span class=p>,</span>
</span><span id=__span-0-151><a id=__codelineno-0-151 name=__codelineno-0-151></a>            <span class=n>auth</span><span class=o>=</span><span class=n>CONFIG</span><span class=o>.</span><span class=n>auth</span><span class=p>,</span>
</span><span id=__span-0-152><a id=__codelineno-0-152 name=__codelineno-0-152></a>        <span class=p>)</span>
</span><span id=__span-0-153><a id=__codelineno-0-153 name=__codelineno-0-153></a>        <span class=bp>self</span><span class=o>.</span><span class=n>agents</span> <span class=o>=</span> <span class=p>[</span><span class=n>Agent</span><span class=o>.</span><span class=n>load_agent</span><span class=p>(</span><span class=n>agent</span><span class=p>,</span> <span class=n>client_config</span><span class=p>)</span> <span class=k>for</span> <span class=n>agent</span> <span class=ow>in</span> <span class=n>agents</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;,&quot;</span><span class=p>)]</span>
</span><span id=__span-0-154><a id=__codelineno-0-154 name=__codelineno-0-154></a>        <span class=bp>self</span><span class=o>.</span><span class=n>max_iterations</span> <span class=o>=</span> <span class=n>max_iterations</span>
</span><span id=__span-0-155><a id=__codelineno-0-155 name=__codelineno-0-155></a>
</span><span id=__span-0-156><a id=__codelineno-0-156 name=__codelineno-0-156></a>        <span class=n>date</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s2>&quot;%Y-%m-</span><span class=si>%d</span><span class=s2>_%H-%M-%S&quot;</span><span class=p>)</span>
</span><span id=__span-0-157><a id=__codelineno-0-157 name=__codelineno-0-157></a>        <span class=n>rnd_id</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>10</span><span class=o>**</span><span class=mi>8</span><span class=p>,</span> <span class=mi>10</span><span class=o>**</span><span class=mi>9</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span>
</span><span id=__span-0-158><a id=__codelineno-0-158 name=__codelineno-0-158></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_saved_trajectories</span> <span class=o>=</span> <span class=n>DATA_FOLDER</span> <span class=o>/</span> <span class=s2>&quot;data&quot;</span> <span class=o>/</span> <span class=s2>&quot;ddots_v0_trajectories&quot;</span> <span class=o>/</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>date</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>rnd_id</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-159><a id=__codelineno-0-159 name=__codelineno-0-159></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_saved_trajectories</span><span class=o>.</span><span class=n>mkdir</span><span class=p>(</span><span class=n>parents</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-160><a id=__codelineno-0-160 name=__codelineno-0-160></a>
</span><span id=__span-0-161><a id=__codelineno-0-161 name=__codelineno-0-161></a>        <span class=bp>self</span><span class=o>.</span><span class=n>save_snapshots</span> <span class=o>=</span> <span class=n>save_snapshots</span>
</span><span id=__span-0-162><a id=__codelineno-0-162 name=__codelineno-0-162></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Saving trajectories to&quot;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>_saved_trajectories</span><span class=p>)</span>
</span><span id=__span-0-163><a id=__codelineno-0-163 name=__codelineno-0-163></a>
</span><span id=__span-0-164><a id=__codelineno-0-164 name=__codelineno-0-164></a>    <span class=k>def</span><span class=w> </span><span class=nf>evaluation_name</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-165><a id=__codelineno-0-165 name=__codelineno-0-165></a>        <span class=k>return</span> <span class=s2>&quot;ddots&quot;</span>
</span><span id=__span-0-166><a id=__codelineno-0-166 name=__codelineno-0-166></a>
</span><span id=__span-0-167><a id=__codelineno-0-167 name=__codelineno-0-167></a>    <span class=k>def</span><span class=w> </span><span class=nf>compatible_datasets</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-168><a id=__codelineno-0-168 name=__codelineno-0-168></a>        <span class=k>return</span> <span class=p>[</span><span class=s2>&quot;ddots_codeforces_small/v0&quot;</span><span class=p>,</span> <span class=s2>&quot;datasets/ddots_codeforces_medium_A_B/v0&quot;</span><span class=p>]</span>
</span><span id=__span-0-169><a id=__codelineno-0-169 name=__codelineno-0-169></a>
</span><span id=__span-0-170><a id=__codelineno-0-170 name=__codelineno-0-170></a>    <span class=k>def</span><span class=w> </span><span class=nf>solve</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>datum</span><span class=p>:</span> <span class=nb>dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-171><a id=__codelineno-0-171 name=__codelineno-0-171></a>        <span class=n>problem_id</span> <span class=o>=</span> <span class=n>datum</span><span class=p>[</span><span class=s2>&quot;problem_id&quot;</span><span class=p>]</span>
</span><span id=__span-0-172><a id=__codelineno-0-172 name=__codelineno-0-172></a>        <span class=n>description</span> <span class=o>=</span> <span class=n>datum</span><span class=p>[</span><span class=s2>&quot;description&quot;</span><span class=p>]</span>
</span><span id=__span-0-173><a id=__codelineno-0-173 name=__codelineno-0-173></a>
</span><span id=__span-0-174><a id=__codelineno-0-174 name=__codelineno-0-174></a>        <span class=n>client_config</span> <span class=o>=</span> <span class=n>ClientConfig</span><span class=p>(</span>
</span><span id=__span-0-175><a id=__codelineno-0-175 name=__codelineno-0-175></a>            <span class=n>base_url</span><span class=o>=</span><span class=n>CONFIG</span><span class=o>.</span><span class=n>nearai_hub</span><span class=o>.</span><span class=n>base_url</span><span class=p>,</span>
</span><span id=__span-0-176><a id=__codelineno-0-176 name=__codelineno-0-176></a>            <span class=n>auth</span><span class=o>=</span><span class=n>CONFIG</span><span class=o>.</span><span class=n>auth</span><span class=p>,</span>
</span><span id=__span-0-177><a id=__codelineno-0-177 name=__codelineno-0-177></a>        <span class=p>)</span>
</span><span id=__span-0-178><a id=__codelineno-0-178 name=__codelineno-0-178></a>        <span class=n>client</span> <span class=o>=</span> <span class=n>InferenceClient</span><span class=p>(</span><span class=n>client_config</span><span class=p>)</span>
</span><span id=__span-0-179><a id=__codelineno-0-179 name=__codelineno-0-179></a>        <span class=n>env</span> <span class=o>=</span> <span class=n>DDOTSEnvironment</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>agents</span><span class=p>,</span> <span class=n>problem_id</span><span class=p>,</span> <span class=n>description</span><span class=p>,</span> <span class=n>client</span><span class=p>)</span>
</span><span id=__span-0-180><a id=__codelineno-0-180 name=__codelineno-0-180></a>        <span class=n>env</span><span class=o>.</span><span class=n>write_file</span><span class=p>(</span><span class=s2>&quot;.solved&quot;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=kc>False</span><span class=p>))</span>
</span><span id=__span-0-181><a id=__codelineno-0-181 name=__codelineno-0-181></a>
</span><span id=__span-0-182><a id=__codelineno-0-182 name=__codelineno-0-182></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-183><a id=__codelineno-0-183 name=__codelineno-0-183></a>            <span class=n>env</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>description</span><span class=p>,</span> <span class=n>max_iterations</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>max_iterations</span><span class=p>)</span>
</span><span id=__span-0-184><a id=__codelineno-0-184 name=__codelineno-0-184></a>            <span class=n>env</span><span class=o>.</span><span class=n>write_file</span><span class=p>(</span><span class=s2>&quot;.solved&quot;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>env</span><span class=o>.</span><span class=n>solved</span><span class=p>))</span>
</span><span id=__span-0-185><a id=__codelineno-0-185 name=__codelineno-0-185></a>
</span><span id=__span-0-186><a id=__codelineno-0-186 name=__codelineno-0-186></a>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-187><a id=__codelineno-0-187 name=__codelineno-0-187></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Error running task: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-188><a id=__codelineno-0-188 name=__codelineno-0-188></a>
</span><span id=__span-0-189><a id=__codelineno-0-189 name=__codelineno-0-189></a>        <span class=k>finally</span><span class=p>:</span>
</span><span id=__span-0-190><a id=__codelineno-0-190 name=__codelineno-0-190></a>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>save_snapshots</span><span class=p>:</span>
</span><span id=__span-0-191><a id=__codelineno-0-191 name=__codelineno-0-191></a>                <span class=n>snapshot</span> <span class=o>=</span> <span class=n>env</span><span class=o>.</span><span class=n>create_snapshot</span><span class=p>()</span>
</span><span id=__span-0-192><a id=__codelineno-0-192 name=__codelineno-0-192></a>                <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_saved_trajectories</span> <span class=o>/</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>problem_id</span><span class=si>}</span><span class=s2>.tar.gz&quot;</span><span class=p>,</span> <span class=s2>&quot;wb&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-193><a id=__codelineno-0-193 name=__codelineno-0-193></a>                    <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>snapshot</span><span class=p>)</span>
</span><span id=__span-0-194><a id=__codelineno-0-194 name=__codelineno-0-194></a>
</span><span id=__span-0-195><a id=__codelineno-0-195 name=__codelineno-0-195></a>        <span class=k>return</span> <span class=n>env</span><span class=o>.</span><span class=n>solved</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> </div> </div> </div> <div class="doc doc-object doc-module"> <h4 id=nearai.solvers.gsm8k_solver class="doc doc-heading"> <span class="doc doc-object-name doc-module-name">gsm8k_solver</span> <a href=#nearai.solvers.gsm8k_solver class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h5 id=nearai.solvers.gsm8k_solver.GSM8KSolverStrategy class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">GSM8KSolverStrategy</span> <a href=#nearai.solvers.gsm8k_solver.GSM8KSolverStrategy class=headerlink title="Permanent link">&para;</a></h5> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title=nearai.solvers.SolverStrategy href=#nearai.solvers.SolverStrategy>SolverStrategy</a></code></p> <p>Solver strategy for the GSM8K dataset.</p> <details class=quote> <summary>Source code in <code>nearai/solvers/gsm8k_solver.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-15>15</a></span>
<span class=normal><a href=#__codelineno-0-16>16</a></span>
<span class=normal><a href=#__codelineno-0-17>17</a></span>
<span class=normal><a href=#__codelineno-0-18>18</a></span>
<span class=normal><a href=#__codelineno-0-19>19</a></span>
<span class=normal><a href=#__codelineno-0-20>20</a></span>
<span class=normal><a href=#__codelineno-0-21>21</a></span>
<span class=normal><a href=#__codelineno-0-22>22</a></span>
<span class=normal><a href=#__codelineno-0-23>23</a></span>
<span class=normal><a href=#__codelineno-0-24>24</a></span>
<span class=normal><a href=#__codelineno-0-25>25</a></span>
<span class=normal><a href=#__codelineno-0-26>26</a></span>
<span class=normal><a href=#__codelineno-0-27>27</a></span>
<span class=normal><a href=#__codelineno-0-28>28</a></span>
<span class=normal><a href=#__codelineno-0-29>29</a></span>
<span class=normal><a href=#__codelineno-0-30>30</a></span>
<span class=normal><a href=#__codelineno-0-31>31</a></span>
<span class=normal><a href=#__codelineno-0-32>32</a></span>
<span class=normal><a href=#__codelineno-0-33>33</a></span>
<span class=normal><a href=#__codelineno-0-34>34</a></span>
<span class=normal><a href=#__codelineno-0-35>35</a></span>
<span class=normal><a href=#__codelineno-0-36>36</a></span>
<span class=normal><a href=#__codelineno-0-37>37</a></span>
<span class=normal><a href=#__codelineno-0-38>38</a></span>
<span class=normal><a href=#__codelineno-0-39>39</a></span>
<span class=normal><a href=#__codelineno-0-40>40</a></span>
<span class=normal><a href=#__codelineno-0-41>41</a></span>
<span class=normal><a href=#__codelineno-0-42>42</a></span>
<span class=normal><a href=#__codelineno-0-43>43</a></span>
<span class=normal><a href=#__codelineno-0-44>44</a></span>
<span class=normal><a href=#__codelineno-0-45>45</a></span>
<span class=normal><a href=#__codelineno-0-46>46</a></span>
<span class=normal><a href=#__codelineno-0-47>47</a></span>
<span class=normal><a href=#__codelineno-0-48>48</a></span>
<span class=normal><a href=#__codelineno-0-49>49</a></span>
<span class=normal><a href=#__codelineno-0-50>50</a></span>
<span class=normal><a href=#__codelineno-0-51>51</a></span>
<span class=normal><a href=#__codelineno-0-52>52</a></span>
<span class=normal><a href=#__codelineno-0-53>53</a></span>
<span class=normal><a href=#__codelineno-0-54>54</a></span>
<span class=normal><a href=#__codelineno-0-55>55</a></span>
<span class=normal><a href=#__codelineno-0-56>56</a></span>
<span class=normal><a href=#__codelineno-0-57>57</a></span>
<span class=normal><a href=#__codelineno-0-58>58</a></span>
<span class=normal><a href=#__codelineno-0-59>59</a></span>
<span class=normal><a href=#__codelineno-0-60>60</a></span>
<span class=normal><a href=#__codelineno-0-61>61</a></span>
<span class=normal><a href=#__codelineno-0-62>62</a></span>
<span class=normal><a href=#__codelineno-0-63>63</a></span>
<span class=normal><a href=#__codelineno-0-64>64</a></span>
<span class=normal><a href=#__codelineno-0-65>65</a></span>
<span class=normal><a href=#__codelineno-0-66>66</a></span>
<span class=normal><a href=#__codelineno-0-67>67</a></span>
<span class=normal><a href=#__codelineno-0-68>68</a></span>
<span class=normal><a href=#__codelineno-0-69>69</a></span>
<span class=normal><a href=#__codelineno-0-70>70</a></span>
<span class=normal><a href=#__codelineno-0-71>71</a></span>
<span class=normal><a href=#__codelineno-0-72>72</a></span>
<span class=normal><a href=#__codelineno-0-73>73</a></span>
<span class=normal><a href=#__codelineno-0-74>74</a></span>
<span class=normal><a href=#__codelineno-0-75>75</a></span>
<span class=normal><a href=#__codelineno-0-76>76</a></span>
<span class=normal><a href=#__codelineno-0-77>77</a></span>
<span class=normal><a href=#__codelineno-0-78>78</a></span>
<span class=normal><a href=#__codelineno-0-79>79</a></span>
<span class=normal><a href=#__codelineno-0-80>80</a></span>
<span class=normal><a href=#__codelineno-0-81>81</a></span>
<span class=normal><a href=#__codelineno-0-82>82</a></span>
<span class=normal><a href=#__codelineno-0-83>83</a></span>
<span class=normal><a href=#__codelineno-0-84>84</a></span>
<span class=normal><a href=#__codelineno-0-85>85</a></span>
<span class=normal><a href=#__codelineno-0-86>86</a></span>
<span class=normal><a href=#__codelineno-0-87>87</a></span>
<span class=normal><a href=#__codelineno-0-88>88</a></span>
<span class=normal><a href=#__codelineno-0-89>89</a></span>
<span class=normal><a href=#__codelineno-0-90>90</a></span>
<span class=normal><a href=#__codelineno-0-91>91</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15></a><span class=k>class</span><span class=w> </span><span class=nc>GSM8KSolverStrategy</span><span class=p>(</span><span class=n>SolverStrategy</span><span class=p>):</span>
</span><span id=__span-0-16><a id=__codelineno-0-16 name=__codelineno-0-16></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Solver strategy for the GSM8K dataset.&quot;&quot;&quot;</span>
</span><span id=__span-0-17><a id=__codelineno-0-17 name=__codelineno-0-17></a>
</span><span id=__span-0-18><a id=__codelineno-0-18 name=__codelineno-0-18></a>    <span class=n>SHOTS</span> <span class=o>=</span> <span class=mi>8</span>
</span><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19></a>
</span><span id=__span-0-20><a id=__codelineno-0-20 name=__codelineno-0-20></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>dataset_ref</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Dataset</span><span class=p>,</span> <span class=n>DatasetDict</span><span class=p>],</span> <span class=n>model</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>agent</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>  <span class=c1># noqa: D107</span>
</span><span id=__span-0-21><a id=__codelineno-0-21 name=__codelineno-0-21></a>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>agent</span><span class=p>)</span>
</span><span id=__span-0-22><a id=__codelineno-0-22 name=__codelineno-0-22></a>        <span class=bp>self</span><span class=o>.</span><span class=n>dataset_ref</span> <span class=o>=</span> <span class=n>dataset_ref</span>
</span><span id=__span-0-23><a id=__codelineno-0-23 name=__codelineno-0-23></a>
</span><span id=__span-0-24><a id=__codelineno-0-24 name=__codelineno-0-24></a>    <span class=k>def</span><span class=w> </span><span class=nf>evaluation_name</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-25><a id=__codelineno-0-25 name=__codelineno-0-25></a>        <span class=k>return</span> <span class=s2>&quot;gsm8k&quot;</span>
</span><span id=__span-0-26><a id=__codelineno-0-26 name=__codelineno-0-26></a>
</span><span id=__span-0-27><a id=__codelineno-0-27 name=__codelineno-0-27></a>    <span class=k>def</span><span class=w> </span><span class=nf>compatible_datasets</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-28><a id=__codelineno-0-28 name=__codelineno-0-28></a>        <span class=k>return</span> <span class=p>[</span><span class=s2>&quot;gsm8k&quot;</span><span class=p>]</span>
</span><span id=__span-0-29><a id=__codelineno-0-29 name=__codelineno-0-29></a>
</span><span id=__span-0-30><a id=__codelineno-0-30 name=__codelineno-0-30></a>    <span class=k>def</span><span class=w> </span><span class=nf>solve</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>datum</span><span class=p>:</span> <span class=nb>dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-31><a id=__codelineno-0-31 name=__codelineno-0-31></a>        <span class=n>parsed_datum</span><span class=p>:</span> <span class=n>GSM8KDatum</span> <span class=o>=</span> <span class=n>GSM8KDatum</span><span class=p>(</span><span class=o>**</span><span class=n>datum</span><span class=p>)</span>
</span><span id=__span-0-32><a id=__codelineno-0-32 name=__codelineno-0-32></a>
</span><span id=__span-0-33><a id=__codelineno-0-33 name=__codelineno-0-33></a>        <span class=n>problem_shots_indices</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>SHOTS</span><span class=p>))</span>
</span><span id=__span-0-34><a id=__codelineno-0-34 name=__codelineno-0-34></a>        <span class=n>problem_shots</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span>
</span><span id=__span-0-35><a id=__codelineno-0-35 name=__codelineno-0-35></a>            <span class=nb>map</span><span class=p>(</span>
</span><span id=__span-0-36><a id=__codelineno-0-36 name=__codelineno-0-36></a>                <span class=k>lambda</span> <span class=n>i</span><span class=p>:</span> <span class=n>GSM8KDatum</span><span class=p>(</span><span class=o>**</span><span class=bp>self</span><span class=o>.</span><span class=n>dataset_ref</span><span class=p>[</span><span class=s2>&quot;train&quot;</span><span class=p>][</span><span class=n>i</span><span class=p>])</span><span class=o>.</span><span class=n>model_dump</span><span class=p>(),</span>
</span><span id=__span-0-37><a id=__codelineno-0-37 name=__codelineno-0-37></a>                <span class=n>problem_shots_indices</span><span class=p>,</span>
</span><span id=__span-0-38><a id=__codelineno-0-38 name=__codelineno-0-38></a>            <span class=p>)</span>
</span><span id=__span-0-39><a id=__codelineno-0-39 name=__codelineno-0-39></a>        <span class=p>)</span>
</span><span id=__span-0-40><a id=__codelineno-0-40 name=__codelineno-0-40></a>
</span><span id=__span-0-41><a id=__codelineno-0-41 name=__codelineno-0-41></a>        <span class=n>session</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>start_inference_session</span><span class=p>(</span><span class=s2>&quot;&quot;</span><span class=p>)</span>
</span><span id=__span-0-42><a id=__codelineno-0-42 name=__codelineno-0-42></a>        <span class=n>session</span><span class=o>.</span><span class=n>add_system_message</span><span class=p>(</span>
</span><span id=__span-0-43><a id=__codelineno-0-43 name=__codelineno-0-43></a>            <span class=n>dedent</span><span class=p>(</span>
</span><span id=__span-0-44><a id=__codelineno-0-44 name=__codelineno-0-44></a><span class=w>                </span><span class=sd>&quot;&quot;&quot;</span>
</span><span id=__span-0-45><a id=__codelineno-0-45 name=__codelineno-0-45></a><span class=sd>                    You are a helpful assistant. You&#39;re goal is to answer word based math questions.</span>
</span><span id=__span-0-46><a id=__codelineno-0-46 name=__codelineno-0-46></a><span class=sd>                    &quot;&quot;&quot;</span>
</span><span id=__span-0-47><a id=__codelineno-0-47 name=__codelineno-0-47></a>                <span class=o>+</span> <span class=s2>&quot;</span><span class=se>\n\n</span><span class=s2>&quot;</span>
</span><span id=__span-0-48><a id=__codelineno-0-48 name=__codelineno-0-48></a>                <span class=o>+</span> <span class=s2>&quot;Here are some examples of math questions and their answers:&quot;</span>
</span><span id=__span-0-49><a id=__codelineno-0-49 name=__codelineno-0-49></a>                <span class=o>+</span> <span class=s2>&quot;</span><span class=se>\n\n</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=sa>f</span><span class=s2>&quot;Question: </span><span class=si>{</span><span class=n>shot</span><span class=p>[</span><span class=s1>&#39;question&#39;</span><span class=p>]</span><span class=si>}</span><span class=se>\n</span><span class=s2>Answer: </span><span class=si>{</span><span class=n>shot</span><span class=p>[</span><span class=s1>&#39;answer&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span> <span class=k>for</span> <span class=n>shot</span> <span class=ow>in</span> <span class=n>problem_shots</span><span class=p>])</span>
</span><span id=__span-0-50><a id=__codelineno-0-50 name=__codelineno-0-50></a>                <span class=o>+</span> <span class=s2>&quot;</span><span class=se>\n\n</span><span class=s2>&quot;</span>
</span><span id=__span-0-51><a id=__codelineno-0-51 name=__codelineno-0-51></a>                <span class=o>+</span> <span class=s2>&quot;Now, answer the next question provided in the user prompt. &quot;</span>
</span><span id=__span-0-52><a id=__codelineno-0-52 name=__codelineno-0-52></a>                <span class=o>+</span> <span class=s2>&quot;Think step by step about how to solve the problem. &quot;</span>
</span><span id=__span-0-53><a id=__codelineno-0-53 name=__codelineno-0-53></a>                <span class=o>+</span> <span class=s2>&quot;Then, provide the answer.&quot;</span>
</span><span id=__span-0-54><a id=__codelineno-0-54 name=__codelineno-0-54></a>            <span class=p>)</span>
</span><span id=__span-0-55><a id=__codelineno-0-55 name=__codelineno-0-55></a>        <span class=p>)</span>
</span><span id=__span-0-56><a id=__codelineno-0-56 name=__codelineno-0-56></a>        <span class=n>res_output</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>run_task</span><span class=p>(</span><span class=n>parsed_datum</span><span class=o>.</span><span class=n>question</span><span class=p>)</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span><span id=__span-0-57><a id=__codelineno-0-57 name=__codelineno-0-57></a>
</span><span id=__span-0-58><a id=__codelineno-0-58 name=__codelineno-0-58></a>        <span class=c1>## cleanup the output</span>
</span><span id=__span-0-59><a id=__codelineno-0-59 name=__codelineno-0-59></a>        <span class=n>session</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>start_inference_session</span><span class=p>(</span><span class=s2>&quot;&quot;</span><span class=p>)</span>
</span><span id=__span-0-60><a id=__codelineno-0-60 name=__codelineno-0-60></a>        <span class=n>res_refined_output</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>run_task</span><span class=p>(</span>
</span><span id=__span-0-61><a id=__codelineno-0-61 name=__codelineno-0-61></a>            <span class=n>dedent</span><span class=p>(</span>
</span><span id=__span-0-62><a id=__codelineno-0-62 name=__codelineno-0-62></a>                <span class=sa>f</span><span class=s2>&quot;&quot;&quot;</span>
</span><span id=__span-0-63><a id=__codelineno-0-63 name=__codelineno-0-63></a><span class=s2>                    You are a helpful assistant. You&#39;re goal is to answer math questions.</span>
</span><span id=__span-0-64><a id=__codelineno-0-64 name=__codelineno-0-64></a>
</span><span id=__span-0-65><a id=__codelineno-0-65 name=__codelineno-0-65></a><span class=s2>                    You have just answered a math question with the following response:</span>
</span><span id=__span-0-66><a id=__codelineno-0-66 name=__codelineno-0-66></a>
</span><span id=__span-0-67><a id=__codelineno-0-67 name=__codelineno-0-67></a><span class=s2>                    --- BEGIN RESPONSE ---</span>
</span><span id=__span-0-68><a id=__codelineno-0-68 name=__codelineno-0-68></a><span class=s2>                    </span><span class=si>{</span><span class=n>res_output</span><span class=si>}</span>
</span><span id=__span-0-69><a id=__codelineno-0-69 name=__codelineno-0-69></a><span class=s2>                    --- END RESPONSE ---</span>
</span><span id=__span-0-70><a id=__codelineno-0-70 name=__codelineno-0-70></a>
</span><span id=__span-0-71><a id=__codelineno-0-71 name=__codelineno-0-71></a><span class=s2>                    Please refine your answer.</span>
</span><span id=__span-0-72><a id=__codelineno-0-72 name=__codelineno-0-72></a>
</span><span id=__span-0-73><a id=__codelineno-0-73 name=__codelineno-0-73></a><span class=s2>                    Only output the final number *without units* as your answer. Nothing else.</span>
</span><span id=__span-0-74><a id=__codelineno-0-74 name=__codelineno-0-74></a><span class=s2>                    &quot;&quot;&quot;</span>
</span><span id=__span-0-75><a id=__codelineno-0-75 name=__codelineno-0-75></a>            <span class=p>)</span>
</span><span id=__span-0-76><a id=__codelineno-0-76 name=__codelineno-0-76></a>        <span class=p>)</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span><span id=__span-0-77><a id=__codelineno-0-77 name=__codelineno-0-77></a>        <span class=n>res_refined_output</span> <span class=o>=</span> <span class=n>res_refined_output</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;$&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;,&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span>
</span><span id=__span-0-78><a id=__codelineno-0-78 name=__codelineno-0-78></a>        <span class=k>if</span> <span class=s2>&quot; &quot;</span> <span class=ow>in</span> <span class=n>res_refined_output</span><span class=p>:</span>
</span><span id=__span-0-79><a id=__codelineno-0-79 name=__codelineno-0-79></a>            <span class=n>res_refined_output</span> <span class=o>=</span> <span class=n>res_refined_output</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot; &quot;</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span><span id=__span-0-80><a id=__codelineno-0-80 name=__codelineno-0-80></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-81><a id=__codelineno-0-81 name=__codelineno-0-81></a>            <span class=n>res_refined_output</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>res_refined_output</span><span class=p>))</span>
</span><span id=__span-0-82><a id=__codelineno-0-82 name=__codelineno-0-82></a>        <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
</span><span id=__span-0-83><a id=__codelineno-0-83 name=__codelineno-0-83></a>            <span class=k>pass</span>
</span><span id=__span-0-84><a id=__codelineno-0-84 name=__codelineno-0-84></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-85><a id=__codelineno-0-85 name=__codelineno-0-85></a>            <span class=n>res_refined_output</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=nb>float</span><span class=p>(</span><span class=n>res_refined_output</span><span class=p>)))</span>
</span><span id=__span-0-86><a id=__codelineno-0-86 name=__codelineno-0-86></a>        <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
</span><span id=__span-0-87><a id=__codelineno-0-87 name=__codelineno-0-87></a>            <span class=k>pass</span>
</span><span id=__span-0-88><a id=__codelineno-0-88 name=__codelineno-0-88></a>
</span><span id=__span-0-89><a id=__codelineno-0-89 name=__codelineno-0-89></a>        <span class=n>refined_answer</span> <span class=o>=</span> <span class=n>parsed_datum</span><span class=o>.</span><span class=n>answer</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;$&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;,&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>)</span>
</span><span id=__span-0-90><a id=__codelineno-0-90 name=__codelineno-0-90></a>        <span class=nb>print</span><span class=p>(</span><span class=n>res_refined_output</span><span class=p>,</span> <span class=n>refined_answer</span><span class=p>)</span>
</span><span id=__span-0-91><a id=__codelineno-0-91 name=__codelineno-0-91></a>        <span class=k>return</span> <span class=n>res_refined_output</span> <span class=o>==</span> <span class=n>refined_answer</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> </div> </div> </div> <div class="doc doc-object doc-module"> <h4 id=nearai.solvers.hellaswag_solver class="doc doc-heading"> <span class="doc doc-object-name doc-module-name">hellaswag_solver</span> <a href=#nearai.solvers.hellaswag_solver class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h5 id=nearai.solvers.hellaswag_solver.HellaswagSolverStrategy class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">HellaswagSolverStrategy</span> <a href=#nearai.solvers.hellaswag_solver.HellaswagSolverStrategy class=headerlink title="Permanent link">&para;</a></h5> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title=nearai.solvers.SolverStrategy href=#nearai.solvers.SolverStrategy>SolverStrategy</a></code></p> <p>Solver strategy for the MMLU dataset.</p> <details class=quote> <summary>Source code in <code>nearai/solvers/hellaswag_solver.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-24>24</a></span>
<span class=normal><a href=#__codelineno-0-25>25</a></span>
<span class=normal><a href=#__codelineno-0-26>26</a></span>
<span class=normal><a href=#__codelineno-0-27>27</a></span>
<span class=normal><a href=#__codelineno-0-28>28</a></span>
<span class=normal><a href=#__codelineno-0-29>29</a></span>
<span class=normal><a href=#__codelineno-0-30>30</a></span>
<span class=normal><a href=#__codelineno-0-31>31</a></span>
<span class=normal><a href=#__codelineno-0-32>32</a></span>
<span class=normal><a href=#__codelineno-0-33>33</a></span>
<span class=normal><a href=#__codelineno-0-34>34</a></span>
<span class=normal><a href=#__codelineno-0-35>35</a></span>
<span class=normal><a href=#__codelineno-0-36>36</a></span>
<span class=normal><a href=#__codelineno-0-37>37</a></span>
<span class=normal><a href=#__codelineno-0-38>38</a></span>
<span class=normal><a href=#__codelineno-0-39>39</a></span>
<span class=normal><a href=#__codelineno-0-40>40</a></span>
<span class=normal><a href=#__codelineno-0-41>41</a></span>
<span class=normal><a href=#__codelineno-0-42>42</a></span>
<span class=normal><a href=#__codelineno-0-43>43</a></span>
<span class=normal><a href=#__codelineno-0-44>44</a></span>
<span class=normal><a href=#__codelineno-0-45>45</a></span>
<span class=normal><a href=#__codelineno-0-46>46</a></span>
<span class=normal><a href=#__codelineno-0-47>47</a></span>
<span class=normal><a href=#__codelineno-0-48>48</a></span>
<span class=normal><a href=#__codelineno-0-49>49</a></span>
<span class=normal><a href=#__codelineno-0-50>50</a></span>
<span class=normal><a href=#__codelineno-0-51>51</a></span>
<span class=normal><a href=#__codelineno-0-52>52</a></span>
<span class=normal><a href=#__codelineno-0-53>53</a></span>
<span class=normal><a href=#__codelineno-0-54>54</a></span>
<span class=normal><a href=#__codelineno-0-55>55</a></span>
<span class=normal><a href=#__codelineno-0-56>56</a></span>
<span class=normal><a href=#__codelineno-0-57>57</a></span>
<span class=normal><a href=#__codelineno-0-58>58</a></span>
<span class=normal><a href=#__codelineno-0-59>59</a></span>
<span class=normal><a href=#__codelineno-0-60>60</a></span>
<span class=normal><a href=#__codelineno-0-61>61</a></span>
<span class=normal><a href=#__codelineno-0-62>62</a></span>
<span class=normal><a href=#__codelineno-0-63>63</a></span>
<span class=normal><a href=#__codelineno-0-64>64</a></span>
<span class=normal><a href=#__codelineno-0-65>65</a></span>
<span class=normal><a href=#__codelineno-0-66>66</a></span>
<span class=normal><a href=#__codelineno-0-67>67</a></span>
<span class=normal><a href=#__codelineno-0-68>68</a></span>
<span class=normal><a href=#__codelineno-0-69>69</a></span>
<span class=normal><a href=#__codelineno-0-70>70</a></span>
<span class=normal><a href=#__codelineno-0-71>71</a></span>
<span class=normal><a href=#__codelineno-0-72>72</a></span>
<span class=normal><a href=#__codelineno-0-73>73</a></span>
<span class=normal><a href=#__codelineno-0-74>74</a></span>
<span class=normal><a href=#__codelineno-0-75>75</a></span>
<span class=normal><a href=#__codelineno-0-76>76</a></span>
<span class=normal><a href=#__codelineno-0-77>77</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-24><a id=__codelineno-0-24 name=__codelineno-0-24></a><span class=k>class</span><span class=w> </span><span class=nc>HellaswagSolverStrategy</span><span class=p>(</span><span class=n>SolverStrategy</span><span class=p>):</span>
</span><span id=__span-0-25><a id=__codelineno-0-25 name=__codelineno-0-25></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Solver strategy for the MMLU dataset.&quot;&quot;&quot;</span>
</span><span id=__span-0-26><a id=__codelineno-0-26 name=__codelineno-0-26></a>
</span><span id=__span-0-27><a id=__codelineno-0-27 name=__codelineno-0-27></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span>  <span class=c1># noqa: D107</span>
</span><span id=__span-0-28><a id=__codelineno-0-28 name=__codelineno-0-28></a>        <span class=bp>self</span><span class=p>,</span> <span class=n>dataset_ref</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Dataset</span><span class=p>,</span> <span class=n>DatasetDict</span><span class=p>],</span> <span class=n>model</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>agent</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>shots</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>8</span>
</span><span id=__span-0-29><a id=__codelineno-0-29 name=__codelineno-0-29></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-30><a id=__codelineno-0-30 name=__codelineno-0-30></a>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>agent</span><span class=p>)</span>
</span><span id=__span-0-31><a id=__codelineno-0-31 name=__codelineno-0-31></a>        <span class=bp>self</span><span class=o>.</span><span class=n>dataset_ref</span> <span class=o>=</span> <span class=n>dataset_ref</span>
</span><span id=__span-0-32><a id=__codelineno-0-32 name=__codelineno-0-32></a>        <span class=bp>self</span><span class=o>.</span><span class=n>shots</span> <span class=o>=</span> <span class=n>shots</span>
</span><span id=__span-0-33><a id=__codelineno-0-33 name=__codelineno-0-33></a>
</span><span id=__span-0-34><a id=__codelineno-0-34 name=__codelineno-0-34></a>    <span class=k>def</span><span class=w> </span><span class=nf>evaluation_name</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-35><a id=__codelineno-0-35 name=__codelineno-0-35></a>        <span class=k>return</span> <span class=sa>f</span><span class=s2>&quot;hellaswag_</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>shots</span><span class=si>}</span><span class=s2>shots&quot;</span>
</span><span id=__span-0-36><a id=__codelineno-0-36 name=__codelineno-0-36></a>
</span><span id=__span-0-37><a id=__codelineno-0-37 name=__codelineno-0-37></a>    <span class=k>def</span><span class=w> </span><span class=nf>compatible_datasets</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-38><a id=__codelineno-0-38 name=__codelineno-0-38></a>        <span class=k>return</span> <span class=p>[</span><span class=s2>&quot;hellaswag&quot;</span><span class=p>]</span>
</span><span id=__span-0-39><a id=__codelineno-0-39 name=__codelineno-0-39></a>
</span><span id=__span-0-40><a id=__codelineno-0-40 name=__codelineno-0-40></a>    <span class=k>def</span><span class=w> </span><span class=nf>solve</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>datum</span><span class=p>:</span> <span class=nb>dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-41><a id=__codelineno-0-41 name=__codelineno-0-41></a>        <span class=n>datum</span> <span class=o>=</span> <span class=n>HellaswagDatum</span><span class=p>(</span><span class=o>**</span><span class=n>datum</span><span class=p>)</span><span class=o>.</span><span class=n>model_dump</span><span class=p>()</span>
</span><span id=__span-0-42><a id=__codelineno-0-42 name=__codelineno-0-42></a>
</span><span id=__span-0-43><a id=__codelineno-0-43 name=__codelineno-0-43></a>        <span class=n>choices</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;A&quot;</span><span class=p>,</span> <span class=s2>&quot;B&quot;</span><span class=p>,</span> <span class=s2>&quot;C&quot;</span><span class=p>,</span> <span class=s2>&quot;D&quot;</span><span class=p>]</span>
</span><span id=__span-0-44><a id=__codelineno-0-44 name=__codelineno-0-44></a>        <span class=n>example_problems_indices</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>5</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>shots</span><span class=p>,</span> <span class=mi>5</span><span class=p>))</span>
</span><span id=__span-0-45><a id=__codelineno-0-45 name=__codelineno-0-45></a>        <span class=n>example_problems</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span>
</span><span id=__span-0-46><a id=__codelineno-0-46 name=__codelineno-0-46></a>            <span class=nb>map</span><span class=p>(</span>
</span><span id=__span-0-47><a id=__codelineno-0-47 name=__codelineno-0-47></a>                <span class=k>lambda</span> <span class=n>d</span><span class=p>:</span> <span class=n>HellaswagDatum</span><span class=p>(</span><span class=o>**</span><span class=n>d</span><span class=p>)</span><span class=o>.</span><span class=n>model_dump</span><span class=p>(),</span>
</span><span id=__span-0-48><a id=__codelineno-0-48 name=__codelineno-0-48></a>                <span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>dataset_ref</span><span class=p>[</span><span class=s2>&quot;validation&quot;</span><span class=p>][</span><span class=n>i</span><span class=p>]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>example_problems_indices</span><span class=p>],</span>
</span><span id=__span-0-49><a id=__codelineno-0-49 name=__codelineno-0-49></a>            <span class=p>)</span>
</span><span id=__span-0-50><a id=__codelineno-0-50 name=__codelineno-0-50></a>        <span class=p>)</span>
</span><span id=__span-0-51><a id=__codelineno-0-51 name=__codelineno-0-51></a>        <span class=n>base_prompt</span> <span class=o>=</span> <span class=n>Template</span><span class=p>(</span>
</span><span id=__span-0-52><a id=__codelineno-0-52 name=__codelineno-0-52></a>            <span class=nb>open</span><span class=p>(</span><span class=n>PROMPTS_FOLDER</span> <span class=o>/</span> <span class=s2>&quot;hellaswag_verbose_answer.j2&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>(),</span>
</span><span id=__span-0-53><a id=__codelineno-0-53 name=__codelineno-0-53></a>            <span class=n>trim_blocks</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-54><a id=__codelineno-0-54 name=__codelineno-0-54></a>        <span class=p>)</span><span class=o>.</span><span class=n>render</span><span class=p>(</span>
</span><span id=__span-0-55><a id=__codelineno-0-55 name=__codelineno-0-55></a>            <span class=n>example_problems</span><span class=o>=</span><span class=n>example_problems</span><span class=p>,</span>
</span><span id=__span-0-56><a id=__codelineno-0-56 name=__codelineno-0-56></a>            <span class=n>challenge_problem</span><span class=o>=</span><span class=n>datum</span><span class=p>,</span>
</span><span id=__span-0-57><a id=__codelineno-0-57 name=__codelineno-0-57></a>            <span class=n>choices</span><span class=o>=</span><span class=n>choices</span><span class=p>,</span>
</span><span id=__span-0-58><a id=__codelineno-0-58 name=__codelineno-0-58></a>        <span class=p>)</span>
</span><span id=__span-0-59><a id=__codelineno-0-59 name=__codelineno-0-59></a>        <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>start_inference_session</span><span class=p>(</span><span class=s2>&quot;&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>run_task</span><span class=p>(</span><span class=n>base_prompt</span><span class=p>)</span>
</span><span id=__span-0-60><a id=__codelineno-0-60 name=__codelineno-0-60></a>
</span><span id=__span-0-61><a id=__codelineno-0-61 name=__codelineno-0-61></a>        <span class=c1>## Extract the answer from the response</span>
</span><span id=__span-0-62><a id=__codelineno-0-62 name=__codelineno-0-62></a>        <span class=n>extract_answer_prompt</span> <span class=o>=</span> <span class=n>Template</span><span class=p>(</span>
</span><span id=__span-0-63><a id=__codelineno-0-63 name=__codelineno-0-63></a>            <span class=nb>open</span><span class=p>(</span><span class=n>PROMPTS_FOLDER</span> <span class=o>/</span> <span class=s2>&quot;hellaswag_extract_answer.j2&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>(),</span>
</span><span id=__span-0-64><a id=__codelineno-0-64 name=__codelineno-0-64></a>            <span class=n>trim_blocks</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-0-65><a id=__codelineno-0-65 name=__codelineno-0-65></a>        <span class=p>)</span><span class=o>.</span><span class=n>render</span><span class=p>(</span>
</span><span id=__span-0-66><a id=__codelineno-0-66 name=__codelineno-0-66></a>            <span class=n>challenge_problem</span><span class=o>=</span><span class=n>datum</span><span class=p>,</span>
</span><span id=__span-0-67><a id=__codelineno-0-67 name=__codelineno-0-67></a>            <span class=n>answer_text</span><span class=o>=</span><span class=n>response</span><span class=p>,</span>
</span><span id=__span-0-68><a id=__codelineno-0-68 name=__codelineno-0-68></a>            <span class=n>choices</span><span class=o>=</span><span class=n>choices</span><span class=p>,</span>
</span><span id=__span-0-69><a id=__codelineno-0-69 name=__codelineno-0-69></a>        <span class=p>)</span>
</span><span id=__span-0-70><a id=__codelineno-0-70 name=__codelineno-0-70></a>        <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>start_inference_session</span><span class=p>(</span><span class=s2>&quot;&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>run_task</span><span class=p>(</span><span class=n>extract_answer_prompt</span><span class=p>)</span>
</span><span id=__span-0-71><a id=__codelineno-0-71 name=__codelineno-0-71></a>
</span><span id=__span-0-72><a id=__codelineno-0-72 name=__codelineno-0-72></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-73><a id=__codelineno-0-73 name=__codelineno-0-73></a>            <span class=n>answer</span> <span class=o>=</span> <span class=n>choices</span><span class=o>.</span><span class=n>index</span><span class=p>(</span><span class=n>response</span><span class=p>)</span>
</span><span id=__span-0-74><a id=__codelineno-0-74 name=__codelineno-0-74></a>            <span class=k>return</span> <span class=nb>bool</span><span class=p>(</span><span class=n>answer</span> <span class=o>==</span> <span class=nb>int</span><span class=p>(</span><span class=n>datum</span><span class=p>[</span><span class=s2>&quot;label&quot;</span><span class=p>]))</span>
</span><span id=__span-0-75><a id=__codelineno-0-75 name=__codelineno-0-75></a>        <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
</span><span id=__span-0-76><a id=__codelineno-0-76 name=__codelineno-0-76></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Failed to parse answer&quot;</span><span class=p>)</span>
</span><span id=__span-0-77><a id=__codelineno-0-77 name=__codelineno-0-77></a>            <span class=k>return</span> <span class=kc>False</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> </div> </div> </div> <div class="doc doc-object doc-module"> <h4 id=nearai.solvers.lean_solver class="doc doc-heading"> <span class="doc doc-object-name doc-module-name">lean_solver</span> <a href=#nearai.solvers.lean_solver class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h5 id=nearai.solvers.lean_solver.LeanSolverStrategy class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">LeanSolverStrategy</span> <a href=#nearai.solvers.lean_solver.LeanSolverStrategy class=headerlink title="Permanent link">&para;</a></h5> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title=nearai.solvers.SolverStrategy href=#nearai.solvers.SolverStrategy>SolverStrategy</a></code></p> <p>Solver strategy to evaluate against Lean problems.</p> <details class=quote> <summary>Source code in <code>nearai/solvers/lean_solver.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-123>123</a></span>
<span class=normal><a href=#__codelineno-0-124>124</a></span>
<span class=normal><a href=#__codelineno-0-125>125</a></span>
<span class=normal><a href=#__codelineno-0-126>126</a></span>
<span class=normal><a href=#__codelineno-0-127>127</a></span>
<span class=normal><a href=#__codelineno-0-128>128</a></span>
<span class=normal><a href=#__codelineno-0-129>129</a></span>
<span class=normal><a href=#__codelineno-0-130>130</a></span>
<span class=normal><a href=#__codelineno-0-131>131</a></span>
<span class=normal><a href=#__codelineno-0-132>132</a></span>
<span class=normal><a href=#__codelineno-0-133>133</a></span>
<span class=normal><a href=#__codelineno-0-134>134</a></span>
<span class=normal><a href=#__codelineno-0-135>135</a></span>
<span class=normal><a href=#__codelineno-0-136>136</a></span>
<span class=normal><a href=#__codelineno-0-137>137</a></span>
<span class=normal><a href=#__codelineno-0-138>138</a></span>
<span class=normal><a href=#__codelineno-0-139>139</a></span>
<span class=normal><a href=#__codelineno-0-140>140</a></span>
<span class=normal><a href=#__codelineno-0-141>141</a></span>
<span class=normal><a href=#__codelineno-0-142>142</a></span>
<span class=normal><a href=#__codelineno-0-143>143</a></span>
<span class=normal><a href=#__codelineno-0-144>144</a></span>
<span class=normal><a href=#__codelineno-0-145>145</a></span>
<span class=normal><a href=#__codelineno-0-146>146</a></span>
<span class=normal><a href=#__codelineno-0-147>147</a></span>
<span class=normal><a href=#__codelineno-0-148>148</a></span>
<span class=normal><a href=#__codelineno-0-149>149</a></span>
<span class=normal><a href=#__codelineno-0-150>150</a></span>
<span class=normal><a href=#__codelineno-0-151>151</a></span>
<span class=normal><a href=#__codelineno-0-152>152</a></span>
<span class=normal><a href=#__codelineno-0-153>153</a></span>
<span class=normal><a href=#__codelineno-0-154>154</a></span>
<span class=normal><a href=#__codelineno-0-155>155</a></span>
<span class=normal><a href=#__codelineno-0-156>156</a></span>
<span class=normal><a href=#__codelineno-0-157>157</a></span>
<span class=normal><a href=#__codelineno-0-158>158</a></span>
<span class=normal><a href=#__codelineno-0-159>159</a></span>
<span class=normal><a href=#__codelineno-0-160>160</a></span>
<span class=normal><a href=#__codelineno-0-161>161</a></span>
<span class=normal><a href=#__codelineno-0-162>162</a></span>
<span class=normal><a href=#__codelineno-0-163>163</a></span>
<span class=normal><a href=#__codelineno-0-164>164</a></span>
<span class=normal><a href=#__codelineno-0-165>165</a></span>
<span class=normal><a href=#__codelineno-0-166>166</a></span>
<span class=normal><a href=#__codelineno-0-167>167</a></span>
<span class=normal><a href=#__codelineno-0-168>168</a></span>
<span class=normal><a href=#__codelineno-0-169>169</a></span>
<span class=normal><a href=#__codelineno-0-170>170</a></span>
<span class=normal><a href=#__codelineno-0-171>171</a></span>
<span class=normal><a href=#__codelineno-0-172>172</a></span>
<span class=normal><a href=#__codelineno-0-173>173</a></span>
<span class=normal><a href=#__codelineno-0-174>174</a></span>
<span class=normal><a href=#__codelineno-0-175>175</a></span>
<span class=normal><a href=#__codelineno-0-176>176</a></span>
<span class=normal><a href=#__codelineno-0-177>177</a></span>
<span class=normal><a href=#__codelineno-0-178>178</a></span>
<span class=normal><a href=#__codelineno-0-179>179</a></span>
<span class=normal><a href=#__codelineno-0-180>180</a></span>
<span class=normal><a href=#__codelineno-0-181>181</a></span>
<span class=normal><a href=#__codelineno-0-182>182</a></span>
<span class=normal><a href=#__codelineno-0-183>183</a></span>
<span class=normal><a href=#__codelineno-0-184>184</a></span>
<span class=normal><a href=#__codelineno-0-185>185</a></span>
<span class=normal><a href=#__codelineno-0-186>186</a></span>
<span class=normal><a href=#__codelineno-0-187>187</a></span>
<span class=normal><a href=#__codelineno-0-188>188</a></span>
<span class=normal><a href=#__codelineno-0-189>189</a></span>
<span class=normal><a href=#__codelineno-0-190>190</a></span>
<span class=normal><a href=#__codelineno-0-191>191</a></span>
<span class=normal><a href=#__codelineno-0-192>192</a></span>
<span class=normal><a href=#__codelineno-0-193>193</a></span>
<span class=normal><a href=#__codelineno-0-194>194</a></span>
<span class=normal><a href=#__codelineno-0-195>195</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-123><a id=__codelineno-0-123 name=__codelineno-0-123></a><span class=k>class</span><span class=w> </span><span class=nc>LeanSolverStrategy</span><span class=p>(</span><span class=n>SolverStrategy</span><span class=p>):</span>
</span><span id=__span-0-124><a id=__codelineno-0-124 name=__codelineno-0-124></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Solver strategy to evaluate against Lean problems.&quot;&quot;&quot;</span>
</span><span id=__span-0-125><a id=__codelineno-0-125 name=__codelineno-0-125></a>
</span><span id=__span-0-126><a id=__codelineno-0-126 name=__codelineno-0-126></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span>  <span class=c1># noqa: D107</span>
</span><span id=__span-0-127><a id=__codelineno-0-127 name=__codelineno-0-127></a>        <span class=bp>self</span><span class=p>,</span> <span class=n>dataset_ref</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Dataset</span><span class=p>,</span> <span class=n>DatasetDict</span><span class=p>],</span> <span class=n>model</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>agent</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-128><a id=__codelineno-0-128 name=__codelineno-0-128></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-129><a id=__codelineno-0-129 name=__codelineno-0-129></a>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>agent</span><span class=p>)</span>
</span><span id=__span-0-130><a id=__codelineno-0-130 name=__codelineno-0-130></a>
</span><span id=__span-0-131><a id=__codelineno-0-131 name=__codelineno-0-131></a>    <span class=k>def</span><span class=w> </span><span class=nf>evaluation_name</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-132><a id=__codelineno-0-132 name=__codelineno-0-132></a>        <span class=k>assert</span> <span class=bp>self</span><span class=o>.</span><span class=n>dataset_evaluation_name</span>
</span><span id=__span-0-133><a id=__codelineno-0-133 name=__codelineno-0-133></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>dataset_evaluation_name</span>
</span><span id=__span-0-134><a id=__codelineno-0-134 name=__codelineno-0-134></a>
</span><span id=__span-0-135><a id=__codelineno-0-135 name=__codelineno-0-135></a>    <span class=k>def</span><span class=w> </span><span class=nf>compatible_datasets</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-136><a id=__codelineno-0-136 name=__codelineno-0-136></a>        <span class=k>return</span> <span class=p>[</span><span class=s2>&quot;lean&quot;</span><span class=p>]</span>
</span><span id=__span-0-137><a id=__codelineno-0-137 name=__codelineno-0-137></a>
</span><span id=__span-0-138><a id=__codelineno-0-138 name=__codelineno-0-138></a>    <span class=k>def</span><span class=w> </span><span class=nf>solve</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>datum</span><span class=p>:</span> <span class=nb>dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>bool</span><span class=p>,</span> <span class=nb>dict</span><span class=p>]:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-139><a id=__codelineno-0-139 name=__codelineno-0-139></a>        <span class=n>lean_datum</span> <span class=o>=</span> <span class=n>LeanDatum</span><span class=o>.</span><span class=n>model_validate</span><span class=p>(</span><span class=n>datum</span><span class=p>)</span>
</span><span id=__span-0-140><a id=__codelineno-0-140 name=__codelineno-0-140></a>        <span class=n>lean_datum</span><span class=o>.</span><span class=n>url</span> <span class=o>=</span> <span class=n>load_repository</span><span class=p>(</span><span class=n>lean_datum</span><span class=o>.</span><span class=n>url</span><span class=p>)</span>
</span><span id=__span-0-141><a id=__codelineno-0-141 name=__codelineno-0-141></a>
</span><span id=__span-0-142><a id=__codelineno-0-142 name=__codelineno-0-142></a>        <span class=n>info</span><span class=p>:</span> <span class=nb>dict</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-0-143><a id=__codelineno-0-143 name=__codelineno-0-143></a>        <span class=n>info</span><span class=p>[</span><span class=s2>&quot;verbose&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-0-144><a id=__codelineno-0-144 name=__codelineno-0-144></a>
</span><span id=__span-0-145><a id=__codelineno-0-145 name=__codelineno-0-145></a>        <span class=n>lean_task</span> <span class=o>=</span> <span class=n>LeanTaskInfo</span><span class=p>(</span>
</span><span id=__span-0-146><a id=__codelineno-0-146 name=__codelineno-0-146></a>            <span class=n>lean_datum</span><span class=o>.</span><span class=n>url</span><span class=p>,</span>
</span><span id=__span-0-147><a id=__codelineno-0-147 name=__codelineno-0-147></a>            <span class=n>lean_datum</span><span class=o>.</span><span class=n>commit</span><span class=p>,</span>
</span><span id=__span-0-148><a id=__codelineno-0-148 name=__codelineno-0-148></a>            <span class=n>lean_datum</span><span class=o>.</span><span class=n>filename</span><span class=p>,</span>
</span><span id=__span-0-149><a id=__codelineno-0-149 name=__codelineno-0-149></a>            <span class=n>lean_datum</span><span class=o>.</span><span class=n>theorem</span><span class=p>,</span>
</span><span id=__span-0-150><a id=__codelineno-0-150 name=__codelineno-0-150></a>            <span class=n>load_theorem</span><span class=p>(</span><span class=n>lean_datum</span><span class=p>),</span>
</span><span id=__span-0-151><a id=__codelineno-0-151 name=__codelineno-0-151></a>        <span class=p>)</span>
</span><span id=__span-0-152><a id=__codelineno-0-152 name=__codelineno-0-152></a>        <span class=n>info</span><span class=p>[</span><span class=s2>&quot;verbose&quot;</span><span class=p>][</span><span class=s2>&quot;theorem_raw&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>lean_task</span><span class=o>.</span><span class=n>theorem_raw</span>
</span><span id=__span-0-153><a id=__codelineno-0-153 name=__codelineno-0-153></a>
</span><span id=__span-0-154><a id=__codelineno-0-154 name=__codelineno-0-154></a>        <span class=n>base_prompt</span> <span class=o>=</span> <span class=n>Template</span><span class=p>(</span><span class=nb>open</span><span class=p>(</span><span class=n>PROMPTS_FOLDER</span> <span class=o>/</span> <span class=s2>&quot;lean_answer.j2&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>(),</span> <span class=n>trim_blocks</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span><span class=o>.</span><span class=n>render</span><span class=p>(</span>
</span><span id=__span-0-155><a id=__codelineno-0-155 name=__codelineno-0-155></a>            <span class=n>url</span><span class=o>=</span><span class=n>lean_task</span><span class=o>.</span><span class=n>url</span><span class=p>,</span>
</span><span id=__span-0-156><a id=__codelineno-0-156 name=__codelineno-0-156></a>            <span class=n>commit</span><span class=o>=</span><span class=n>lean_task</span><span class=o>.</span><span class=n>commit</span><span class=p>,</span>
</span><span id=__span-0-157><a id=__codelineno-0-157 name=__codelineno-0-157></a>            <span class=n>filepath</span><span class=o>=</span><span class=n>lean_task</span><span class=o>.</span><span class=n>filename</span><span class=p>,</span>
</span><span id=__span-0-158><a id=__codelineno-0-158 name=__codelineno-0-158></a>            <span class=n>theorem_name</span><span class=o>=</span><span class=n>lean_task</span><span class=o>.</span><span class=n>theorem</span><span class=p>,</span>
</span><span id=__span-0-159><a id=__codelineno-0-159 name=__codelineno-0-159></a>            <span class=n>theorem_raw</span><span class=o>=</span><span class=n>lean_task</span><span class=o>.</span><span class=n>theorem_raw</span><span class=p>,</span>
</span><span id=__span-0-160><a id=__codelineno-0-160 name=__codelineno-0-160></a>            <span class=n>begin_marker</span><span class=o>=</span><span class=n>BEGIN_MARKER</span><span class=p>,</span>
</span><span id=__span-0-161><a id=__codelineno-0-161 name=__codelineno-0-161></a>            <span class=n>end_marker</span><span class=o>=</span><span class=n>END_MARKER</span><span class=p>,</span>
</span><span id=__span-0-162><a id=__codelineno-0-162 name=__codelineno-0-162></a>        <span class=p>)</span>
</span><span id=__span-0-163><a id=__codelineno-0-163 name=__codelineno-0-163></a>        <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>start_inference_session</span><span class=p>(</span><span class=s2>&quot;&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>run_task</span><span class=p>(</span><span class=n>base_prompt</span><span class=p>)</span>
</span><span id=__span-0-164><a id=__codelineno-0-164 name=__codelineno-0-164></a>
</span><span id=__span-0-165><a id=__codelineno-0-165 name=__codelineno-0-165></a>        <span class=n>json_response</span> <span class=o>=</span> <span class=n>extract_between_markers</span><span class=p>(</span><span class=n>response</span><span class=p>)</span>
</span><span id=__span-0-166><a id=__codelineno-0-166 name=__codelineno-0-166></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>json_response</span><span class=p>:</span>
</span><span id=__span-0-167><a id=__codelineno-0-167 name=__codelineno-0-167></a>            <span class=n>info</span><span class=p>[</span><span class=s2>&quot;error&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;Failed to extract between markers.&quot;</span>
</span><span id=__span-0-168><a id=__codelineno-0-168 name=__codelineno-0-168></a>            <span class=n>info</span><span class=p>[</span><span class=s2>&quot;verbose&quot;</span><span class=p>][</span><span class=s2>&quot;response&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>response</span>
</span><span id=__span-0-169><a id=__codelineno-0-169 name=__codelineno-0-169></a>            <span class=k>return</span> <span class=kc>False</span><span class=p>,</span> <span class=n>info</span>
</span><span id=__span-0-170><a id=__codelineno-0-170 name=__codelineno-0-170></a>
</span><span id=__span-0-171><a id=__codelineno-0-171 name=__codelineno-0-171></a>        <span class=n>tactics</span> <span class=o>=</span> <span class=n>parse_tactics</span><span class=p>(</span><span class=n>json_response</span><span class=p>)</span>
</span><span id=__span-0-172><a id=__codelineno-0-172 name=__codelineno-0-172></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>tactics</span><span class=p>:</span>
</span><span id=__span-0-173><a id=__codelineno-0-173 name=__codelineno-0-173></a>            <span class=n>info</span><span class=p>[</span><span class=s2>&quot;error&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;Failed to parse tactics.&quot;</span>
</span><span id=__span-0-174><a id=__codelineno-0-174 name=__codelineno-0-174></a>            <span class=n>info</span><span class=p>[</span><span class=s2>&quot;verbose&quot;</span><span class=p>][</span><span class=s2>&quot;response&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>json_response</span>
</span><span id=__span-0-175><a id=__codelineno-0-175 name=__codelineno-0-175></a>            <span class=k>return</span> <span class=kc>False</span><span class=p>,</span> <span class=n>info</span>
</span><span id=__span-0-176><a id=__codelineno-0-176 name=__codelineno-0-176></a>
</span><span id=__span-0-177><a id=__codelineno-0-177 name=__codelineno-0-177></a>        <span class=c1># Sometimes, there are timeout errors.</span>
</span><span id=__span-0-178><a id=__codelineno-0-178 name=__codelineno-0-178></a>        <span class=n>num_attempts</span> <span class=o>=</span> <span class=mi>3</span>
</span><span id=__span-0-179><a id=__codelineno-0-179 name=__codelineno-0-179></a>        <span class=n>info</span><span class=p>[</span><span class=s2>&quot;tactics&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>tactics</span>
</span><span id=__span-0-180><a id=__codelineno-0-180 name=__codelineno-0-180></a>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>num_attempts</span><span class=p>):</span>
</span><span id=__span-0-181><a id=__codelineno-0-181 name=__codelineno-0-181></a>            <span class=k>if</span> <span class=n>i</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
</span><span id=__span-0-182><a id=__codelineno-0-182 name=__codelineno-0-182></a>                <span class=n>info</span><span class=p>[</span><span class=s2>&quot;check_solution_attempts&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=si>}</span><span class=s2> (max: </span><span class=si>{</span><span class=n>num_attempts</span><span class=si>}</span><span class=s2>)&quot;</span>
</span><span id=__span-0-183><a id=__codelineno-0-183 name=__codelineno-0-183></a>            <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-184><a id=__codelineno-0-184 name=__codelineno-0-184></a>                <span class=n>r</span><span class=p>,</span> <span class=n>m</span> <span class=o>=</span> <span class=n>check_solution</span><span class=p>(</span><span class=n>lean_datum</span><span class=p>,</span> <span class=n>tactics</span><span class=p>)</span>
</span><span id=__span-0-185><a id=__codelineno-0-185 name=__codelineno-0-185></a>                <span class=k>if</span> <span class=n>r</span><span class=p>:</span>
</span><span id=__span-0-186><a id=__codelineno-0-186 name=__codelineno-0-186></a>                    <span class=n>info</span><span class=p>[</span><span class=s2>&quot;verbose&quot;</span><span class=p>][</span><span class=s2>&quot;check_solution_message&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>m</span>
</span><span id=__span-0-187><a id=__codelineno-0-187 name=__codelineno-0-187></a>                <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-188><a id=__codelineno-0-188 name=__codelineno-0-188></a>                    <span class=n>info</span><span class=p>[</span><span class=s2>&quot;check_solution_message&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>m</span>
</span><span id=__span-0-189><a id=__codelineno-0-189 name=__codelineno-0-189></a>                <span class=k>return</span> <span class=n>r</span><span class=p>,</span> <span class=n>info</span>
</span><span id=__span-0-190><a id=__codelineno-0-190 name=__codelineno-0-190></a>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-191><a id=__codelineno-0-191 name=__codelineno-0-191></a>                <span class=k>if</span> <span class=n>i</span> <span class=o>==</span> <span class=n>num_attempts</span> <span class=o>-</span> <span class=mi>1</span><span class=p>:</span>
</span><span id=__span-0-192><a id=__codelineno-0-192 name=__codelineno-0-192></a>                    <span class=n>error_message</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;Exception while checking solution: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>.&quot;</span>
</span><span id=__span-0-193><a id=__codelineno-0-193 name=__codelineno-0-193></a>                    <span class=nb>print</span><span class=p>(</span><span class=n>error_message</span><span class=p>)</span>
</span><span id=__span-0-194><a id=__codelineno-0-194 name=__codelineno-0-194></a>                    <span class=n>info</span><span class=p>[</span><span class=s2>&quot;error&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>error_message</span>
</span><span id=__span-0-195><a id=__codelineno-0-195 name=__codelineno-0-195></a>        <span class=k>return</span> <span class=kc>False</span><span class=p>,</span> <span class=n>info</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-function"> <h5 id=nearai.solvers.lean_solver.load_theorem class="doc doc-heading"> <span class="doc doc-object-name doc-function-name">load_theorem</span> <a href=#nearai.solvers.lean_solver.load_theorem class=headerlink title="Permanent link">&para;</a></h5> <div class="language-python doc-signature highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nf>load_theorem</span><span class=p>(</span><span class=n>task</span><span class=p>:</span> <span class=n><span title=nearai.solvers.lean_solver.LeanDatum>LeanDatum</span></span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>str</span>
</span></code></pre></div> <div class="doc doc-contents "> <p>Use local copy of the repository.</p> <details class=quote> <summary>Source code in <code>nearai/solvers/lean_solver.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-79>79</a></span>
<span class=normal><a href=#__codelineno-0-80>80</a></span>
<span class=normal><a href=#__codelineno-0-81>81</a></span>
<span class=normal><a href=#__codelineno-0-82>82</a></span>
<span class=normal><a href=#__codelineno-0-83>83</a></span>
<span class=normal><a href=#__codelineno-0-84>84</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-79><a id=__codelineno-0-79 name=__codelineno-0-79></a><span class=k>def</span><span class=w> </span><span class=nf>load_theorem</span><span class=p>(</span><span class=n>task</span><span class=p>:</span> <span class=n>LeanDatum</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-0-80><a id=__codelineno-0-80 name=__codelineno-0-80></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Use local copy of the repository.&quot;&quot;&quot;</span>
</span><span id=__span-0-81><a id=__codelineno-0-81 name=__codelineno-0-81></a>    <span class=n>repo</span> <span class=o>=</span> <span class=n>LeanGitRepo</span><span class=p>(</span><span class=n>task</span><span class=o>.</span><span class=n>url</span><span class=p>,</span> <span class=n>task</span><span class=o>.</span><span class=n>commit</span><span class=p>)</span>
</span><span id=__span-0-82><a id=__codelineno-0-82 name=__codelineno-0-82></a>    <span class=n>theorem</span> <span class=o>=</span> <span class=n>Theorem</span><span class=p>(</span><span class=n>repo</span><span class=p>,</span> <span class=n>task</span><span class=o>.</span><span class=n>filename</span><span class=p>,</span> <span class=n>task</span><span class=o>.</span><span class=n>theorem</span><span class=p>)</span>
</span><span id=__span-0-83><a id=__codelineno-0-83 name=__codelineno-0-83></a>    <span class=k>with</span> <span class=n>Dojo</span><span class=p>(</span><span class=n>theorem</span><span class=p>)</span> <span class=k>as</span> <span class=p>(</span><span class=n>_</span><span class=p>,</span> <span class=n>state</span><span class=p>):</span>
</span><span id=__span-0-84><a id=__codelineno-0-84 name=__codelineno-0-84></a>        <span class=k>return</span> <span class=n>state</span><span class=o>.</span><span class=n>pp</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-module"> <h4 id=nearai.solvers.livebench_solver class="doc doc-heading"> <span class="doc doc-object-name doc-module-name">livebench_solver</span> <a href=#nearai.solvers.livebench_solver class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h5 id=nearai.solvers.livebench_solver.LiveBenchSolverStrategy class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">LiveBenchSolverStrategy</span> <a href=#nearai.solvers.livebench_solver.LiveBenchSolverStrategy class=headerlink title="Permanent link">&para;</a></h5> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title=nearai.solvers.SolverStrategy href=#nearai.solvers.SolverStrategy>SolverStrategy</a></code></p> <p>Solver strategy for the live bench dataset.</p> <details class=quote> <summary>Source code in <code>nearai/solvers/livebench_solver.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-66> 66</a></span>
<span class=normal><a href=#__codelineno-0-67> 67</a></span>
<span class=normal><a href=#__codelineno-0-68> 68</a></span>
<span class=normal><a href=#__codelineno-0-69> 69</a></span>
<span class=normal><a href=#__codelineno-0-70> 70</a></span>
<span class=normal><a href=#__codelineno-0-71> 71</a></span>
<span class=normal><a href=#__codelineno-0-72> 72</a></span>
<span class=normal><a href=#__codelineno-0-73> 73</a></span>
<span class=normal><a href=#__codelineno-0-74> 74</a></span>
<span class=normal><a href=#__codelineno-0-75> 75</a></span>
<span class=normal><a href=#__codelineno-0-76> 76</a></span>
<span class=normal><a href=#__codelineno-0-77> 77</a></span>
<span class=normal><a href=#__codelineno-0-78> 78</a></span>
<span class=normal><a href=#__codelineno-0-79> 79</a></span>
<span class=normal><a href=#__codelineno-0-80> 80</a></span>
<span class=normal><a href=#__codelineno-0-81> 81</a></span>
<span class=normal><a href=#__codelineno-0-82> 82</a></span>
<span class=normal><a href=#__codelineno-0-83> 83</a></span>
<span class=normal><a href=#__codelineno-0-84> 84</a></span>
<span class=normal><a href=#__codelineno-0-85> 85</a></span>
<span class=normal><a href=#__codelineno-0-86> 86</a></span>
<span class=normal><a href=#__codelineno-0-87> 87</a></span>
<span class=normal><a href=#__codelineno-0-88> 88</a></span>
<span class=normal><a href=#__codelineno-0-89> 89</a></span>
<span class=normal><a href=#__codelineno-0-90> 90</a></span>
<span class=normal><a href=#__codelineno-0-91> 91</a></span>
<span class=normal><a href=#__codelineno-0-92> 92</a></span>
<span class=normal><a href=#__codelineno-0-93> 93</a></span>
<span class=normal><a href=#__codelineno-0-94> 94</a></span>
<span class=normal><a href=#__codelineno-0-95> 95</a></span>
<span class=normal><a href=#__codelineno-0-96> 96</a></span>
<span class=normal><a href=#__codelineno-0-97> 97</a></span>
<span class=normal><a href=#__codelineno-0-98> 98</a></span>
<span class=normal><a href=#__codelineno-0-99> 99</a></span>
<span class=normal><a href=#__codelineno-0-100>100</a></span>
<span class=normal><a href=#__codelineno-0-101>101</a></span>
<span class=normal><a href=#__codelineno-0-102>102</a></span>
<span class=normal><a href=#__codelineno-0-103>103</a></span>
<span class=normal><a href=#__codelineno-0-104>104</a></span>
<span class=normal><a href=#__codelineno-0-105>105</a></span>
<span class=normal><a href=#__codelineno-0-106>106</a></span>
<span class=normal><a href=#__codelineno-0-107>107</a></span>
<span class=normal><a href=#__codelineno-0-108>108</a></span>
<span class=normal><a href=#__codelineno-0-109>109</a></span>
<span class=normal><a href=#__codelineno-0-110>110</a></span>
<span class=normal><a href=#__codelineno-0-111>111</a></span>
<span class=normal><a href=#__codelineno-0-112>112</a></span>
<span class=normal><a href=#__codelineno-0-113>113</a></span>
<span class=normal><a href=#__codelineno-0-114>114</a></span>
<span class=normal><a href=#__codelineno-0-115>115</a></span>
<span class=normal><a href=#__codelineno-0-116>116</a></span>
<span class=normal><a href=#__codelineno-0-117>117</a></span>
<span class=normal><a href=#__codelineno-0-118>118</a></span>
<span class=normal><a href=#__codelineno-0-119>119</a></span>
<span class=normal><a href=#__codelineno-0-120>120</a></span>
<span class=normal><a href=#__codelineno-0-121>121</a></span>
<span class=normal><a href=#__codelineno-0-122>122</a></span>
<span class=normal><a href=#__codelineno-0-123>123</a></span>
<span class=normal><a href=#__codelineno-0-124>124</a></span>
<span class=normal><a href=#__codelineno-0-125>125</a></span>
<span class=normal><a href=#__codelineno-0-126>126</a></span>
<span class=normal><a href=#__codelineno-0-127>127</a></span>
<span class=normal><a href=#__codelineno-0-128>128</a></span>
<span class=normal><a href=#__codelineno-0-129>129</a></span>
<span class=normal><a href=#__codelineno-0-130>130</a></span>
<span class=normal><a href=#__codelineno-0-131>131</a></span>
<span class=normal><a href=#__codelineno-0-132>132</a></span>
<span class=normal><a href=#__codelineno-0-133>133</a></span>
<span class=normal><a href=#__codelineno-0-134>134</a></span>
<span class=normal><a href=#__codelineno-0-135>135</a></span>
<span class=normal><a href=#__codelineno-0-136>136</a></span>
<span class=normal><a href=#__codelineno-0-137>137</a></span>
<span class=normal><a href=#__codelineno-0-138>138</a></span>
<span class=normal><a href=#__codelineno-0-139>139</a></span>
<span class=normal><a href=#__codelineno-0-140>140</a></span>
<span class=normal><a href=#__codelineno-0-141>141</a></span>
<span class=normal><a href=#__codelineno-0-142>142</a></span>
<span class=normal><a href=#__codelineno-0-143>143</a></span>
<span class=normal><a href=#__codelineno-0-144>144</a></span>
<span class=normal><a href=#__codelineno-0-145>145</a></span>
<span class=normal><a href=#__codelineno-0-146>146</a></span>
<span class=normal><a href=#__codelineno-0-147>147</a></span>
<span class=normal><a href=#__codelineno-0-148>148</a></span>
<span class=normal><a href=#__codelineno-0-149>149</a></span>
<span class=normal><a href=#__codelineno-0-150>150</a></span>
<span class=normal><a href=#__codelineno-0-151>151</a></span>
<span class=normal><a href=#__codelineno-0-152>152</a></span>
<span class=normal><a href=#__codelineno-0-153>153</a></span>
<span class=normal><a href=#__codelineno-0-154>154</a></span>
<span class=normal><a href=#__codelineno-0-155>155</a></span>
<span class=normal><a href=#__codelineno-0-156>156</a></span>
<span class=normal><a href=#__codelineno-0-157>157</a></span>
<span class=normal><a href=#__codelineno-0-158>158</a></span>
<span class=normal><a href=#__codelineno-0-159>159</a></span>
<span class=normal><a href=#__codelineno-0-160>160</a></span>
<span class=normal><a href=#__codelineno-0-161>161</a></span>
<span class=normal><a href=#__codelineno-0-162>162</a></span>
<span class=normal><a href=#__codelineno-0-163>163</a></span>
<span class=normal><a href=#__codelineno-0-164>164</a></span>
<span class=normal><a href=#__codelineno-0-165>165</a></span>
<span class=normal><a href=#__codelineno-0-166>166</a></span>
<span class=normal><a href=#__codelineno-0-167>167</a></span>
<span class=normal><a href=#__codelineno-0-168>168</a></span>
<span class=normal><a href=#__codelineno-0-169>169</a></span>
<span class=normal><a href=#__codelineno-0-170>170</a></span>
<span class=normal><a href=#__codelineno-0-171>171</a></span>
<span class=normal><a href=#__codelineno-0-172>172</a></span>
<span class=normal><a href=#__codelineno-0-173>173</a></span>
<span class=normal><a href=#__codelineno-0-174>174</a></span>
<span class=normal><a href=#__codelineno-0-175>175</a></span>
<span class=normal><a href=#__codelineno-0-176>176</a></span>
<span class=normal><a href=#__codelineno-0-177>177</a></span>
<span class=normal><a href=#__codelineno-0-178>178</a></span>
<span class=normal><a href=#__codelineno-0-179>179</a></span>
<span class=normal><a href=#__codelineno-0-180>180</a></span>
<span class=normal><a href=#__codelineno-0-181>181</a></span>
<span class=normal><a href=#__codelineno-0-182>182</a></span>
<span class=normal><a href=#__codelineno-0-183>183</a></span>
<span class=normal><a href=#__codelineno-0-184>184</a></span>
<span class=normal><a href=#__codelineno-0-185>185</a></span>
<span class=normal><a href=#__codelineno-0-186>186</a></span>
<span class=normal><a href=#__codelineno-0-187>187</a></span>
<span class=normal><a href=#__codelineno-0-188>188</a></span>
<span class=normal><a href=#__codelineno-0-189>189</a></span>
<span class=normal><a href=#__codelineno-0-190>190</a></span>
<span class=normal><a href=#__codelineno-0-191>191</a></span>
<span class=normal><a href=#__codelineno-0-192>192</a></span>
<span class=normal><a href=#__codelineno-0-193>193</a></span>
<span class=normal><a href=#__codelineno-0-194>194</a></span>
<span class=normal><a href=#__codelineno-0-195>195</a></span>
<span class=normal><a href=#__codelineno-0-196>196</a></span>
<span class=normal><a href=#__codelineno-0-197>197</a></span>
<span class=normal><a href=#__codelineno-0-198>198</a></span>
<span class=normal><a href=#__codelineno-0-199>199</a></span>
<span class=normal><a href=#__codelineno-0-200>200</a></span>
<span class=normal><a href=#__codelineno-0-201>201</a></span>
<span class=normal><a href=#__codelineno-0-202>202</a></span>
<span class=normal><a href=#__codelineno-0-203>203</a></span>
<span class=normal><a href=#__codelineno-0-204>204</a></span>
<span class=normal><a href=#__codelineno-0-205>205</a></span>
<span class=normal><a href=#__codelineno-0-206>206</a></span>
<span class=normal><a href=#__codelineno-0-207>207</a></span>
<span class=normal><a href=#__codelineno-0-208>208</a></span>
<span class=normal><a href=#__codelineno-0-209>209</a></span>
<span class=normal><a href=#__codelineno-0-210>210</a></span>
<span class=normal><a href=#__codelineno-0-211>211</a></span>
<span class=normal><a href=#__codelineno-0-212>212</a></span>
<span class=normal><a href=#__codelineno-0-213>213</a></span>
<span class=normal><a href=#__codelineno-0-214>214</a></span>
<span class=normal><a href=#__codelineno-0-215>215</a></span>
<span class=normal><a href=#__codelineno-0-216>216</a></span>
<span class=normal><a href=#__codelineno-0-217>217</a></span>
<span class=normal><a href=#__codelineno-0-218>218</a></span>
<span class=normal><a href=#__codelineno-0-219>219</a></span>
<span class=normal><a href=#__codelineno-0-220>220</a></span>
<span class=normal><a href=#__codelineno-0-221>221</a></span>
<span class=normal><a href=#__codelineno-0-222>222</a></span>
<span class=normal><a href=#__codelineno-0-223>223</a></span>
<span class=normal><a href=#__codelineno-0-224>224</a></span>
<span class=normal><a href=#__codelineno-0-225>225</a></span>
<span class=normal><a href=#__codelineno-0-226>226</a></span>
<span class=normal><a href=#__codelineno-0-227>227</a></span>
<span class=normal><a href=#__codelineno-0-228>228</a></span>
<span class=normal><a href=#__codelineno-0-229>229</a></span>
<span class=normal><a href=#__codelineno-0-230>230</a></span>
<span class=normal><a href=#__codelineno-0-231>231</a></span>
<span class=normal><a href=#__codelineno-0-232>232</a></span>
<span class=normal><a href=#__codelineno-0-233>233</a></span>
<span class=normal><a href=#__codelineno-0-234>234</a></span>
<span class=normal><a href=#__codelineno-0-235>235</a></span>
<span class=normal><a href=#__codelineno-0-236>236</a></span>
<span class=normal><a href=#__codelineno-0-237>237</a></span>
<span class=normal><a href=#__codelineno-0-238>238</a></span>
<span class=normal><a href=#__codelineno-0-239>239</a></span>
<span class=normal><a href=#__codelineno-0-240>240</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-66><a id=__codelineno-0-66 name=__codelineno-0-66></a><span class=k>class</span><span class=w> </span><span class=nc>LiveBenchSolverStrategy</span><span class=p>(</span><span class=n>SolverStrategy</span><span class=p>):</span>
</span><span id=__span-0-67><a id=__codelineno-0-67 name=__codelineno-0-67></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Solver strategy for the live bench dataset.&quot;&quot;&quot;</span>
</span><span id=__span-0-68><a id=__codelineno-0-68 name=__codelineno-0-68></a>
</span><span id=__span-0-69><a id=__codelineno-0-69 name=__codelineno-0-69></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span>  <span class=c1># noqa: D107</span>
</span><span id=__span-0-70><a id=__codelineno-0-70 name=__codelineno-0-70></a>        <span class=bp>self</span><span class=p>,</span> <span class=n>dataset_ref</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>model</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>agent</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>step</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;all&quot;</span>
</span><span id=__span-0-71><a id=__codelineno-0-71 name=__codelineno-0-71></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-72><a id=__codelineno-0-72 name=__codelineno-0-72></a>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>agent</span><span class=p>)</span>
</span><span id=__span-0-73><a id=__codelineno-0-73 name=__codelineno-0-73></a>        <span class=bp>self</span><span class=o>.</span><span class=n>dataset_ref</span> <span class=o>=</span> <span class=n>dataset_ref</span>
</span><span id=__span-0-74><a id=__codelineno-0-74 name=__codelineno-0-74></a>        <span class=bp>self</span><span class=o>.</span><span class=n>step</span> <span class=o>=</span> <span class=n>step</span>
</span><span id=__span-0-75><a id=__codelineno-0-75 name=__codelineno-0-75></a>
</span><span id=__span-0-76><a id=__codelineno-0-76 name=__codelineno-0-76></a>    <span class=k>def</span><span class=w> </span><span class=nf>evaluation_name</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-77><a id=__codelineno-0-77 name=__codelineno-0-77></a>        <span class=k>return</span> <span class=s2>&quot;live_bench&quot;</span>
</span><span id=__span-0-78><a id=__codelineno-0-78 name=__codelineno-0-78></a>
</span><span id=__span-0-79><a id=__codelineno-0-79 name=__codelineno-0-79></a>    <span class=k>def</span><span class=w> </span><span class=nf>compatible_datasets</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-80><a id=__codelineno-0-80 name=__codelineno-0-80></a>        <span class=k>return</span> <span class=p>[</span><span class=s2>&quot;live_bench&quot;</span><span class=p>]</span>
</span><span id=__span-0-81><a id=__codelineno-0-81 name=__codelineno-0-81></a>
</span><span id=__span-0-82><a id=__codelineno-0-82 name=__codelineno-0-82></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_custom_tasks</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>dict</span><span class=p>]:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-83><a id=__codelineno-0-83 name=__codelineno-0-83></a>        <span class=k>return</span> <span class=p>[{</span><span class=s2>&quot;summary&quot;</span><span class=p>:</span> <span class=s2>&quot;all&quot;</span><span class=p>}]</span>
</span><span id=__span-0-84><a id=__codelineno-0-84 name=__codelineno-0-84></a>
</span><span id=__span-0-85><a id=__codelineno-0-85 name=__codelineno-0-85></a>    <span class=nd>@property</span>
</span><span id=__span-0-86><a id=__codelineno-0-86 name=__codelineno-0-86></a>    <span class=k>def</span><span class=w> </span><span class=nf>evaluated_entry_name</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-87><a id=__codelineno-0-87 name=__codelineno-0-87></a>        <span class=n>name</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-88><a id=__codelineno-0-88 name=__codelineno-0-88></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>agent</span><span class=p>:</span>
</span><span id=__span-0-89><a id=__codelineno-0-89 name=__codelineno-0-89></a>            <span class=n>name</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>agent_name</span><span class=p>()</span>
</span><span id=__span-0-90><a id=__codelineno-0-90 name=__codelineno-0-90></a>            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>model_name</span> <span class=o>!=</span> <span class=s2>&quot;&quot;</span><span class=p>:</span>
</span><span id=__span-0-91><a id=__codelineno-0-91 name=__codelineno-0-91></a>                <span class=n>name</span> <span class=o>+=</span> <span class=sa>f</span><span class=s2>&quot;_with_model_</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>model_name</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-0-92><a id=__codelineno-0-92 name=__codelineno-0-92></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-93><a id=__codelineno-0-93 name=__codelineno-0-93></a>            <span class=n>name</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>model_name</span>
</span><span id=__span-0-94><a id=__codelineno-0-94 name=__codelineno-0-94></a>        <span class=k>assert</span> <span class=s2>&quot;/&quot;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>name</span>
</span><span id=__span-0-95><a id=__codelineno-0-95 name=__codelineno-0-95></a>        <span class=k>return</span> <span class=n>name</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
</span><span id=__span-0-96><a id=__codelineno-0-96 name=__codelineno-0-96></a>
</span><span id=__span-0-97><a id=__codelineno-0-97 name=__codelineno-0-97></a>    <span class=nd>@SolverStrategyClassProperty</span>
</span><span id=__span-0-98><a id=__codelineno-0-98 name=__codelineno-0-98></a>    <span class=k>def</span><span class=w> </span><span class=nf>scoring_method</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>SolverScoringMethod</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-99><a id=__codelineno-0-99 name=__codelineno-0-99></a>        <span class=k>return</span> <span class=n>SolverScoringMethod</span><span class=o>.</span><span class=n>Custom</span>
</span><span id=__span-0-100><a id=__codelineno-0-100 name=__codelineno-0-100></a>
</span><span id=__span-0-101><a id=__codelineno-0-101 name=__codelineno-0-101></a>    <span class=k>def</span><span class=w> </span><span class=nf>solve</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>_datum</span><span class=p>:</span> <span class=nb>dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>bool</span><span class=p>,</span> <span class=nb>dict</span><span class=p>]:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-102><a id=__codelineno-0-102 name=__codelineno-0-102></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>step</span> <span class=o>==</span> <span class=s2>&quot;gen_model_answer&quot;</span><span class=p>:</span>
</span><span id=__span-0-103><a id=__codelineno-0-103 name=__codelineno-0-103></a>            <span class=bp>self</span><span class=o>.</span><span class=n>gen_model_answer</span><span class=p>()</span>
</span><span id=__span-0-104><a id=__codelineno-0-104 name=__codelineno-0-104></a>            <span class=k>return</span> <span class=kc>True</span><span class=p>,</span> <span class=p>{}</span>
</span><span id=__span-0-105><a id=__codelineno-0-105 name=__codelineno-0-105></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>step</span> <span class=o>==</span> <span class=s2>&quot;gen_ground_truth_judgement&quot;</span><span class=p>:</span>
</span><span id=__span-0-106><a id=__codelineno-0-106 name=__codelineno-0-106></a>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>gen_ground_truth_judgement</span><span class=p>(),</span> <span class=p>{}</span>
</span><span id=__span-0-107><a id=__codelineno-0-107 name=__codelineno-0-107></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>step</span> <span class=o>==</span> <span class=s2>&quot;show_livebench_results&quot;</span><span class=p>:</span>
</span><span id=__span-0-108><a id=__codelineno-0-108 name=__codelineno-0-108></a>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>show_livebench_results</span><span class=p>()</span>
</span><span id=__span-0-109><a id=__codelineno-0-109 name=__codelineno-0-109></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>step</span> <span class=o>==</span> <span class=s2>&quot;all&quot;</span><span class=p>:</span>
</span><span id=__span-0-110><a id=__codelineno-0-110 name=__codelineno-0-110></a>            <span class=bp>self</span><span class=o>.</span><span class=n>gen_model_answer</span><span class=p>()</span>
</span><span id=__span-0-111><a id=__codelineno-0-111 name=__codelineno-0-111></a>            <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>gen_ground_truth_judgement</span><span class=p>():</span>
</span><span id=__span-0-112><a id=__codelineno-0-112 name=__codelineno-0-112></a>                <span class=k>return</span> <span class=kc>False</span><span class=p>,</span> <span class=p>{}</span>
</span><span id=__span-0-113><a id=__codelineno-0-113 name=__codelineno-0-113></a>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>show_livebench_results</span><span class=p>()</span>
</span><span id=__span-0-114><a id=__codelineno-0-114 name=__codelineno-0-114></a>        <span class=k>return</span> <span class=kc>False</span><span class=p>,</span> <span class=p>{}</span>
</span><span id=__span-0-115><a id=__codelineno-0-115 name=__codelineno-0-115></a>
</span><span id=__span-0-116><a id=__codelineno-0-116 name=__codelineno-0-116></a>    <span class=k>def</span><span class=w> </span><span class=nf>gen_model_answer</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-117><a id=__codelineno-0-117 name=__codelineno-0-117></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;&quot;</span><span class=p>)</span>
</span><span id=__span-0-118><a id=__codelineno-0-118 name=__codelineno-0-118></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;----------- Step gen_model_answer -----------&quot;</span><span class=p>)</span>
</span><span id=__span-0-119><a id=__codelineno-0-119 name=__codelineno-0-119></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;&quot;</span><span class=p>)</span>
</span><span id=__span-0-120><a id=__codelineno-0-120 name=__codelineno-0-120></a>        <span class=n>list_of_question_files</span> <span class=o>=</span> <span class=n>glob</span><span class=o>.</span><span class=n>glob</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>dataset_ref</span><span class=si>}</span><span class=s2>/**/question.jsonl&quot;</span><span class=p>,</span> <span class=n>recursive</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-121><a id=__codelineno-0-121 name=__codelineno-0-121></a>        <span class=k>for</span> <span class=n>question_file</span> <span class=ow>in</span> <span class=n>list_of_question_files</span><span class=p>:</span>
</span><span id=__span-0-122><a id=__codelineno-0-122 name=__codelineno-0-122></a>            <span class=n>questions</span> <span class=o>=</span> <span class=n>load_questions_jsonl</span><span class=p>(</span><span class=n>question_file</span><span class=p>)</span>
</span><span id=__span-0-123><a id=__codelineno-0-123 name=__codelineno-0-123></a>            <span class=n>bench_name</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=n>question_file</span><span class=p>)</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>dataset_ref</span><span class=p>))[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span><span id=__span-0-124><a id=__codelineno-0-124 name=__codelineno-0-124></a>            <span class=n>answer_file</span> <span class=o>=</span> <span class=n>_get_answer_file_path</span><span class=p>(</span><span class=n>bench_name</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>evaluated_entry_name</span><span class=p>)</span>
</span><span id=__span-0-125><a id=__codelineno-0-125 name=__codelineno-0-125></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Questions from </span><span class=si>{</span><span class=n>question_file</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-126><a id=__codelineno-0-126 name=__codelineno-0-126></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Output to </span><span class=si>{</span><span class=n>answer_file</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-127><a id=__codelineno-0-127 name=__codelineno-0-127></a>            <span class=bp>self</span><span class=o>.</span><span class=n>run_eval</span><span class=p>(</span><span class=n>questions</span><span class=p>,</span> <span class=n>answer_file</span><span class=p>)</span>
</span><span id=__span-0-128><a id=__codelineno-0-128 name=__codelineno-0-128></a>
</span><span id=__span-0-129><a id=__codelineno-0-129 name=__codelineno-0-129></a>    <span class=k>def</span><span class=w> </span><span class=nf>run_eval</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>questions</span><span class=p>,</span> <span class=n>answer_file</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-130><a id=__codelineno-0-130 name=__codelineno-0-130></a>        <span class=n>answer_file</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>expanduser</span><span class=p>(</span><span class=n>answer_file</span><span class=p>)</span>
</span><span id=__span-0-131><a id=__codelineno-0-131 name=__codelineno-0-131></a>
</span><span id=__span-0-132><a id=__codelineno-0-132 name=__codelineno-0-132></a>        <span class=c1># Load existing answers</span>
</span><span id=__span-0-133><a id=__codelineno-0-133 name=__codelineno-0-133></a>        <span class=n>existing_answers</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
</span><span id=__span-0-134><a id=__codelineno-0-134 name=__codelineno-0-134></a>        <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>answer_file</span><span class=p>):</span>
</span><span id=__span-0-135><a id=__codelineno-0-135 name=__codelineno-0-135></a>            <span class=nb>print</span><span class=p>(</span>
</span><span id=__span-0-136><a id=__codelineno-0-136 name=__codelineno-0-136></a>                <span class=sa>f</span><span class=s2>&quot;Answer file </span><span class=si>{</span><span class=n>answer_file</span><span class=si>}</span><span class=s2> exists. Will skip already answered questions. Delete this file if that is not intended.&quot;</span>  <span class=c1># noqa: E501</span>
</span><span id=__span-0-137><a id=__codelineno-0-137 name=__codelineno-0-137></a>            <span class=p>)</span>
</span><span id=__span-0-138><a id=__codelineno-0-138 name=__codelineno-0-138></a>            <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>answer_file</span><span class=p>,</span> <span class=s2>&quot;r&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>fin</span><span class=p>:</span>
</span><span id=__span-0-139><a id=__codelineno-0-139 name=__codelineno-0-139></a>                <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>fin</span><span class=p>:</span>
</span><span id=__span-0-140><a id=__codelineno-0-140 name=__codelineno-0-140></a>                    <span class=n>answer</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>line</span><span class=p>)</span>
</span><span id=__span-0-141><a id=__codelineno-0-141 name=__codelineno-0-141></a>                    <span class=n>existing_answers</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>answer</span><span class=p>[</span><span class=s2>&quot;question_id&quot;</span><span class=p>])</span>
</span><span id=__span-0-142><a id=__codelineno-0-142 name=__codelineno-0-142></a>
</span><span id=__span-0-143><a id=__codelineno-0-143 name=__codelineno-0-143></a>        <span class=k>for</span> <span class=n>question</span> <span class=ow>in</span> <span class=n>tqdm</span><span class=p>(</span><span class=n>questions</span><span class=p>):</span>
</span><span id=__span-0-144><a id=__codelineno-0-144 name=__codelineno-0-144></a>            <span class=k>if</span> <span class=n>question</span><span class=p>[</span><span class=s2>&quot;question_id&quot;</span><span class=p>]</span> <span class=ow>in</span> <span class=n>existing_answers</span><span class=p>:</span>
</span><span id=__span-0-145><a id=__codelineno-0-145 name=__codelineno-0-145></a>                <span class=k>continue</span>
</span><span id=__span-0-146><a id=__codelineno-0-146 name=__codelineno-0-146></a>            <span class=n>choices</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>answer_question</span><span class=p>(</span><span class=n>question</span><span class=p>)</span>
</span><span id=__span-0-147><a id=__codelineno-0-147 name=__codelineno-0-147></a>
</span><span id=__span-0-148><a id=__codelineno-0-148 name=__codelineno-0-148></a>            <span class=n>ans_json</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-0-149><a id=__codelineno-0-149 name=__codelineno-0-149></a>                <span class=s2>&quot;question_id&quot;</span><span class=p>:</span> <span class=n>question</span><span class=p>[</span><span class=s2>&quot;question_id&quot;</span><span class=p>],</span>
</span><span id=__span-0-150><a id=__codelineno-0-150 name=__codelineno-0-150></a>                <span class=s2>&quot;answer_id&quot;</span><span class=p>:</span> <span class=n>shortuuid</span><span class=o>.</span><span class=n>uuid</span><span class=p>(),</span>
</span><span id=__span-0-151><a id=__codelineno-0-151 name=__codelineno-0-151></a>                <span class=s2>&quot;model_id&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>evaluated_entry_name</span><span class=p>,</span>
</span><span id=__span-0-152><a id=__codelineno-0-152 name=__codelineno-0-152></a>                <span class=s2>&quot;choices&quot;</span><span class=p>:</span> <span class=n>choices</span><span class=p>,</span>
</span><span id=__span-0-153><a id=__codelineno-0-153 name=__codelineno-0-153></a>                <span class=s2>&quot;tstamp&quot;</span><span class=p>:</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>(),</span>
</span><span id=__span-0-154><a id=__codelineno-0-154 name=__codelineno-0-154></a>            <span class=p>}</span>
</span><span id=__span-0-155><a id=__codelineno-0-155 name=__codelineno-0-155></a>
</span><span id=__span-0-156><a id=__codelineno-0-156 name=__codelineno-0-156></a>            <span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=n>answer_file</span><span class=p>),</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-157><a id=__codelineno-0-157 name=__codelineno-0-157></a>            <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>answer_file</span><span class=p>,</span> <span class=s2>&quot;a&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>fout</span><span class=p>:</span>
</span><span id=__span-0-158><a id=__codelineno-0-158 name=__codelineno-0-158></a>                <span class=n>fout</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>ans_json</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-159><a id=__codelineno-0-159 name=__codelineno-0-159></a>
</span><span id=__span-0-160><a id=__codelineno-0-160 name=__codelineno-0-160></a>    <span class=k>def</span><span class=w> </span><span class=nf>answer_question</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>question</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>dict</span><span class=p>]:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-161><a id=__codelineno-0-161 name=__codelineno-0-161></a>        <span class=n>turns</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-0-162><a id=__codelineno-0-162 name=__codelineno-0-162></a>        <span class=n>session</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>start_inference_session</span><span class=p>(</span><span class=n>question</span><span class=p>[</span><span class=s2>&quot;question_id&quot;</span><span class=p>])</span>
</span><span id=__span-0-163><a id=__codelineno-0-163 name=__codelineno-0-163></a>        <span class=k>for</span> <span class=n>qs</span> <span class=ow>in</span> <span class=n>question</span><span class=p>[</span><span class=s2>&quot;turns&quot;</span><span class=p>]:</span>
</span><span id=__span-0-164><a id=__codelineno-0-164 name=__codelineno-0-164></a>            <span class=n>output</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>run_task</span><span class=p>(</span><span class=n>qs</span><span class=p>)</span>
</span><span id=__span-0-165><a id=__codelineno-0-165 name=__codelineno-0-165></a>            <span class=n>turns</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>output</span><span class=p>)</span>
</span><span id=__span-0-166><a id=__codelineno-0-166 name=__codelineno-0-166></a>
</span><span id=__span-0-167><a id=__codelineno-0-167 name=__codelineno-0-167></a>        <span class=k>return</span> <span class=p>[{</span><span class=s2>&quot;index&quot;</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=s2>&quot;turns&quot;</span><span class=p>:</span> <span class=n>turns</span><span class=p>}]</span>
</span><span id=__span-0-168><a id=__codelineno-0-168 name=__codelineno-0-168></a>
</span><span id=__span-0-169><a id=__codelineno-0-169 name=__codelineno-0-169></a>    <span class=k>def</span><span class=w> </span><span class=nf>gen_ground_truth_judgement</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-170><a id=__codelineno-0-170 name=__codelineno-0-170></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;&quot;</span><span class=p>)</span>
</span><span id=__span-0-171><a id=__codelineno-0-171 name=__codelineno-0-171></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;----------- Step gen_ground_truth_judgement -----------&quot;</span><span class=p>)</span>
</span><span id=__span-0-172><a id=__codelineno-0-172 name=__codelineno-0-172></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;&quot;</span><span class=p>)</span>
</span><span id=__span-0-173><a id=__codelineno-0-173 name=__codelineno-0-173></a>        <span class=n>script_path</span> <span class=o>=</span> <span class=s2>&quot;nearai/projects/live_bench/gen_ground_truth_judgement.sh&quot;</span>
</span><span id=__span-0-174><a id=__codelineno-0-174 name=__codelineno-0-174></a>
</span><span id=__span-0-175><a id=__codelineno-0-175 name=__codelineno-0-175></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-176><a id=__codelineno-0-176 name=__codelineno-0-176></a>            <span class=c1># Run the script without capturing output</span>
</span><span id=__span-0-177><a id=__codelineno-0-177 name=__codelineno-0-177></a>            <span class=n>subprocess</span><span class=o>.</span><span class=n>run</span><span class=p>([</span><span class=s2>&quot;/bin/bash&quot;</span><span class=p>,</span> <span class=n>script_path</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>evaluated_entry_name</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>dataset_ref</span><span class=p>],</span> <span class=n>check</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-178><a id=__codelineno-0-178 name=__codelineno-0-178></a>            <span class=k>return</span> <span class=kc>True</span>
</span><span id=__span-0-179><a id=__codelineno-0-179 name=__codelineno-0-179></a>
</span><span id=__span-0-180><a id=__codelineno-0-180 name=__codelineno-0-180></a>        <span class=k>except</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>CalledProcessError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-181><a id=__codelineno-0-181 name=__codelineno-0-181></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;An error occurred while running the script: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-182><a id=__codelineno-0-182 name=__codelineno-0-182></a>            <span class=k>return</span> <span class=kc>False</span>
</span><span id=__span-0-183><a id=__codelineno-0-183 name=__codelineno-0-183></a>
</span><span id=__span-0-184><a id=__codelineno-0-184 name=__codelineno-0-184></a>    <span class=k>def</span><span class=w> </span><span class=nf>show_livebench_results</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>bool</span><span class=p>,</span> <span class=nb>dict</span><span class=p>]:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-185><a id=__codelineno-0-185 name=__codelineno-0-185></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;&quot;</span><span class=p>)</span>
</span><span id=__span-0-186><a id=__codelineno-0-186 name=__codelineno-0-186></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;----------- Step show_livebench_results -----------&quot;</span><span class=p>)</span>
</span><span id=__span-0-187><a id=__codelineno-0-187 name=__codelineno-0-187></a>        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;&quot;</span><span class=p>)</span>
</span><span id=__span-0-188><a id=__codelineno-0-188 name=__codelineno-0-188></a>        <span class=n>script_path</span> <span class=o>=</span> <span class=s2>&quot;nearai/projects/live_bench/show_livebench_results.sh&quot;</span>
</span><span id=__span-0-189><a id=__codelineno-0-189 name=__codelineno-0-189></a>
</span><span id=__span-0-190><a id=__codelineno-0-190 name=__codelineno-0-190></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-191><a id=__codelineno-0-191 name=__codelineno-0-191></a>            <span class=c1># Run the script without capturing output</span>
</span><span id=__span-0-192><a id=__codelineno-0-192 name=__codelineno-0-192></a>            <span class=n>subprocess</span><span class=o>.</span><span class=n>run</span><span class=p>([</span><span class=s2>&quot;/bin/bash&quot;</span><span class=p>,</span> <span class=n>script_path</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>evaluated_entry_name</span><span class=p>],</span> <span class=n>check</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-193><a id=__codelineno-0-193 name=__codelineno-0-193></a>
</span><span id=__span-0-194><a id=__codelineno-0-194 name=__codelineno-0-194></a>        <span class=k>except</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>CalledProcessError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-195><a id=__codelineno-0-195 name=__codelineno-0-195></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;An error occurred while running the script: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-196><a id=__codelineno-0-196 name=__codelineno-0-196></a>            <span class=k>return</span> <span class=kc>False</span><span class=p>,</span> <span class=p>{}</span>
</span><span id=__span-0-197><a id=__codelineno-0-197 name=__codelineno-0-197></a>
</span><span id=__span-0-198><a id=__codelineno-0-198 name=__codelineno-0-198></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>create_result_dict</span><span class=p>()</span>
</span><span id=__span-0-199><a id=__codelineno-0-199 name=__codelineno-0-199></a>
</span><span id=__span-0-200><a id=__codelineno-0-200 name=__codelineno-0-200></a>    <span class=k>def</span><span class=w> </span><span class=nf>read_csv_to_dict</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>file_path</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-201><a id=__codelineno-0-201 name=__codelineno-0-201></a>        <span class=n>file_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>expanduser</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
</span><span id=__span-0-202><a id=__codelineno-0-202 name=__codelineno-0-202></a>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=s2>&quot;r&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-203><a id=__codelineno-0-203 name=__codelineno-0-203></a>            <span class=n>reader</span> <span class=o>=</span> <span class=n>csv</span><span class=o>.</span><span class=n>DictReader</span><span class=p>(</span><span class=n>f</span><span class=p>)</span>
</span><span id=__span-0-204><a id=__codelineno-0-204 name=__codelineno-0-204></a>            <span class=n>matching_rows</span> <span class=o>=</span> <span class=p>[</span><span class=n>row</span> <span class=k>for</span> <span class=n>row</span> <span class=ow>in</span> <span class=n>reader</span> <span class=k>if</span> <span class=n>row</span><span class=p>[</span><span class=s2>&quot;model&quot;</span><span class=p>]</span> <span class=o>==</span> <span class=bp>self</span><span class=o>.</span><span class=n>evaluated_entry_name</span><span class=p>]</span>
</span><span id=__span-0-205><a id=__codelineno-0-205 name=__codelineno-0-205></a>            <span class=k>return</span> <span class=n>matching_rows</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=k>if</span> <span class=n>matching_rows</span> <span class=k>else</span> <span class=p>{}</span>  <span class=c1># Get the last matching row</span>
</span><span id=__span-0-206><a id=__codelineno-0-206 name=__codelineno-0-206></a>
</span><span id=__span-0-207><a id=__codelineno-0-207 name=__codelineno-0-207></a>    <span class=k>def</span><span class=w> </span><span class=nf>create_result_dict</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>bool</span><span class=p>,</span> <span class=nb>dict</span><span class=p>]:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-208><a id=__codelineno-0-208 name=__codelineno-0-208></a>        <span class=n>tasks_data</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>read_csv_to_dict</span><span class=p>(</span><span class=n>_get_all_tasks_csv_file</span><span class=p>())</span>
</span><span id=__span-0-209><a id=__codelineno-0-209 name=__codelineno-0-209></a>        <span class=n>groups_data</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>read_csv_to_dict</span><span class=p>(</span><span class=n>_get_all_groups_csv_file</span><span class=p>())</span>
</span><span id=__span-0-210><a id=__codelineno-0-210 name=__codelineno-0-210></a>
</span><span id=__span-0-211><a id=__codelineno-0-211 name=__codelineno-0-211></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>tasks_data</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>groups_data</span><span class=p>:</span>
</span><span id=__span-0-212><a id=__codelineno-0-212 name=__codelineno-0-212></a>            <span class=k>return</span> <span class=kc>False</span><span class=p>,</span> <span class=p>{}</span>  <span class=c1># Return None if the model is not found in either file</span>
</span><span id=__span-0-213><a id=__codelineno-0-213 name=__codelineno-0-213></a>
</span><span id=__span-0-214><a id=__codelineno-0-214 name=__codelineno-0-214></a>        <span class=n>result</span><span class=p>:</span> <span class=nb>dict</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;tasks&quot;</span><span class=p>:</span> <span class=p>{},</span> <span class=s2>&quot;groups&quot;</span><span class=p>:</span> <span class=p>{}}</span>
</span><span id=__span-0-215><a id=__codelineno-0-215 name=__codelineno-0-215></a>
</span><span id=__span-0-216><a id=__codelineno-0-216 name=__codelineno-0-216></a>        <span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>tasks_data</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span><span id=__span-0-217><a id=__codelineno-0-217 name=__codelineno-0-217></a>            <span class=k>if</span> <span class=n>key</span> <span class=o>!=</span> <span class=s2>&quot;model&quot;</span><span class=p>:</span>
</span><span id=__span-0-218><a id=__codelineno-0-218 name=__codelineno-0-218></a>                <span class=n>result</span><span class=p>[</span><span class=s2>&quot;tasks&quot;</span><span class=p>][</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=nb>float</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
</span><span id=__span-0-219><a id=__codelineno-0-219 name=__codelineno-0-219></a>
</span><span id=__span-0-220><a id=__codelineno-0-220 name=__codelineno-0-220></a>        <span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>groups_data</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span><span id=__span-0-221><a id=__codelineno-0-221 name=__codelineno-0-221></a>            <span class=k>if</span> <span class=n>key</span> <span class=o>!=</span> <span class=s2>&quot;model&quot;</span><span class=p>:</span>
</span><span id=__span-0-222><a id=__codelineno-0-222 name=__codelineno-0-222></a>                <span class=n>result</span><span class=p>[</span><span class=s2>&quot;groups&quot;</span><span class=p>][</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=nb>float</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
</span><span id=__span-0-223><a id=__codelineno-0-223 name=__codelineno-0-223></a>
</span><span id=__span-0-224><a id=__codelineno-0-224 name=__codelineno-0-224></a>        <span class=k>return</span> <span class=kc>True</span><span class=p>,</span> <span class=n>result</span>
</span><span id=__span-0-225><a id=__codelineno-0-225 name=__codelineno-0-225></a>
</span><span id=__span-0-226><a id=__codelineno-0-226 name=__codelineno-0-226></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_evaluation_metrics</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>tasks_results</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Tuple</span><span class=p>[</span><span class=nb>bool</span><span class=p>,</span> <span class=n>Any</span><span class=p>]])</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-227><a id=__codelineno-0-227 name=__codelineno-0-227></a>        <span class=n>results</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=n>tasks_results</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span>
</span><span id=__span-0-228><a id=__codelineno-0-228 name=__codelineno-0-228></a>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>results</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span><span id=__span-0-229><a id=__codelineno-0-229 name=__codelineno-0-229></a>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Cache empty. Rerun the job with --force. Use --step arg to specify a step.&quot;</span><span class=p>)</span>
</span><span id=__span-0-230><a id=__codelineno-0-230 name=__codelineno-0-230></a>        <span class=n>metrics</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;average&quot;</span><span class=p>:</span> <span class=n>results</span><span class=p>[</span><span class=s2>&quot;groups&quot;</span><span class=p>][</span><span class=s2>&quot;average&quot;</span><span class=p>]}</span>
</span><span id=__span-0-231><a id=__codelineno-0-231 name=__codelineno-0-231></a>
</span><span id=__span-0-232><a id=__codelineno-0-232 name=__codelineno-0-232></a>        <span class=k>for</span> <span class=n>group</span><span class=p>,</span> <span class=n>score</span> <span class=ow>in</span> <span class=n>results</span><span class=p>[</span><span class=s2>&quot;groups&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span><span id=__span-0-233><a id=__codelineno-0-233 name=__codelineno-0-233></a>            <span class=k>if</span> <span class=n>group</span> <span class=o>==</span> <span class=s2>&quot;average&quot;</span><span class=p>:</span>
</span><span id=__span-0-234><a id=__codelineno-0-234 name=__codelineno-0-234></a>                <span class=k>continue</span>
</span><span id=__span-0-235><a id=__codelineno-0-235 name=__codelineno-0-235></a>            <span class=n>metrics</span><span class=p>[</span><span class=sa>f</span><span class=s2>&quot;group/</span><span class=si>{</span><span class=n>group</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>score</span>
</span><span id=__span-0-236><a id=__codelineno-0-236 name=__codelineno-0-236></a>
</span><span id=__span-0-237><a id=__codelineno-0-237 name=__codelineno-0-237></a>        <span class=k>for</span> <span class=n>task</span><span class=p>,</span> <span class=n>score</span> <span class=ow>in</span> <span class=n>results</span><span class=p>[</span><span class=s2>&quot;tasks&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span><span id=__span-0-238><a id=__codelineno-0-238 name=__codelineno-0-238></a>            <span class=n>metrics</span><span class=p>[</span><span class=sa>f</span><span class=s2>&quot;task/</span><span class=si>{</span><span class=n>task</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>score</span>
</span><span id=__span-0-239><a id=__codelineno-0-239 name=__codelineno-0-239></a>
</span><span id=__span-0-240><a id=__codelineno-0-240 name=__codelineno-0-240></a>        <span class=k>return</span> <span class=n>metrics</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> </div> </div> </div> <div class="doc doc-object doc-module"> <h4 id=nearai.solvers.mbpp_solver class="doc doc-heading"> <span class="doc doc-object-name doc-module-name">mbpp_solver</span> <a href=#nearai.solvers.mbpp_solver class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h5 id=nearai.solvers.mbpp_solver.MBPPSolverStrategy class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">MBPPSolverStrategy</span> <a href=#nearai.solvers.mbpp_solver.MBPPSolverStrategy class=headerlink title="Permanent link">&para;</a></h5> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title=nearai.solvers.SolverStrategy href=#nearai.solvers.SolverStrategy>SolverStrategy</a></code></p> <p>Solver strategy for the MBPP dataset.</p> <details class=quote> <summary>Source code in <code>nearai/solvers/mbpp_solver.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-68> 68</a></span>
<span class=normal><a href=#__codelineno-0-69> 69</a></span>
<span class=normal><a href=#__codelineno-0-70> 70</a></span>
<span class=normal><a href=#__codelineno-0-71> 71</a></span>
<span class=normal><a href=#__codelineno-0-72> 72</a></span>
<span class=normal><a href=#__codelineno-0-73> 73</a></span>
<span class=normal><a href=#__codelineno-0-74> 74</a></span>
<span class=normal><a href=#__codelineno-0-75> 75</a></span>
<span class=normal><a href=#__codelineno-0-76> 76</a></span>
<span class=normal><a href=#__codelineno-0-77> 77</a></span>
<span class=normal><a href=#__codelineno-0-78> 78</a></span>
<span class=normal><a href=#__codelineno-0-79> 79</a></span>
<span class=normal><a href=#__codelineno-0-80> 80</a></span>
<span class=normal><a href=#__codelineno-0-81> 81</a></span>
<span class=normal><a href=#__codelineno-0-82> 82</a></span>
<span class=normal><a href=#__codelineno-0-83> 83</a></span>
<span class=normal><a href=#__codelineno-0-84> 84</a></span>
<span class=normal><a href=#__codelineno-0-85> 85</a></span>
<span class=normal><a href=#__codelineno-0-86> 86</a></span>
<span class=normal><a href=#__codelineno-0-87> 87</a></span>
<span class=normal><a href=#__codelineno-0-88> 88</a></span>
<span class=normal><a href=#__codelineno-0-89> 89</a></span>
<span class=normal><a href=#__codelineno-0-90> 90</a></span>
<span class=normal><a href=#__codelineno-0-91> 91</a></span>
<span class=normal><a href=#__codelineno-0-92> 92</a></span>
<span class=normal><a href=#__codelineno-0-93> 93</a></span>
<span class=normal><a href=#__codelineno-0-94> 94</a></span>
<span class=normal><a href=#__codelineno-0-95> 95</a></span>
<span class=normal><a href=#__codelineno-0-96> 96</a></span>
<span class=normal><a href=#__codelineno-0-97> 97</a></span>
<span class=normal><a href=#__codelineno-0-98> 98</a></span>
<span class=normal><a href=#__codelineno-0-99> 99</a></span>
<span class=normal><a href=#__codelineno-0-100>100</a></span>
<span class=normal><a href=#__codelineno-0-101>101</a></span>
<span class=normal><a href=#__codelineno-0-102>102</a></span>
<span class=normal><a href=#__codelineno-0-103>103</a></span>
<span class=normal><a href=#__codelineno-0-104>104</a></span>
<span class=normal><a href=#__codelineno-0-105>105</a></span>
<span class=normal><a href=#__codelineno-0-106>106</a></span>
<span class=normal><a href=#__codelineno-0-107>107</a></span>
<span class=normal><a href=#__codelineno-0-108>108</a></span>
<span class=normal><a href=#__codelineno-0-109>109</a></span>
<span class=normal><a href=#__codelineno-0-110>110</a></span>
<span class=normal><a href=#__codelineno-0-111>111</a></span>
<span class=normal><a href=#__codelineno-0-112>112</a></span>
<span class=normal><a href=#__codelineno-0-113>113</a></span>
<span class=normal><a href=#__codelineno-0-114>114</a></span>
<span class=normal><a href=#__codelineno-0-115>115</a></span>
<span class=normal><a href=#__codelineno-0-116>116</a></span>
<span class=normal><a href=#__codelineno-0-117>117</a></span>
<span class=normal><a href=#__codelineno-0-118>118</a></span>
<span class=normal><a href=#__codelineno-0-119>119</a></span>
<span class=normal><a href=#__codelineno-0-120>120</a></span>
<span class=normal><a href=#__codelineno-0-121>121</a></span>
<span class=normal><a href=#__codelineno-0-122>122</a></span>
<span class=normal><a href=#__codelineno-0-123>123</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-68><a id=__codelineno-0-68 name=__codelineno-0-68></a><span class=k>class</span><span class=w> </span><span class=nc>MBPPSolverStrategy</span><span class=p>(</span><span class=n>SolverStrategy</span><span class=p>):</span>
</span><span id=__span-0-69><a id=__codelineno-0-69 name=__codelineno-0-69></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Solver strategy for the MBPP dataset.&quot;&quot;&quot;</span>
</span><span id=__span-0-70><a id=__codelineno-0-70 name=__codelineno-0-70></a>
</span><span id=__span-0-71><a id=__codelineno-0-71 name=__codelineno-0-71></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span>  <span class=c1># noqa: D107</span>
</span><span id=__span-0-72><a id=__codelineno-0-72 name=__codelineno-0-72></a>        <span class=bp>self</span><span class=p>,</span> <span class=n>dataset_ref</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Dataset</span><span class=p>,</span> <span class=n>DatasetDict</span><span class=p>],</span> <span class=n>model</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>agent</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>shots</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>3</span>
</span><span id=__span-0-73><a id=__codelineno-0-73 name=__codelineno-0-73></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-74><a id=__codelineno-0-74 name=__codelineno-0-74></a>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>agent</span><span class=p>)</span>
</span><span id=__span-0-75><a id=__codelineno-0-75 name=__codelineno-0-75></a>        <span class=bp>self</span><span class=o>.</span><span class=n>dataset_ref</span> <span class=o>=</span> <span class=n>dataset_ref</span>
</span><span id=__span-0-76><a id=__codelineno-0-76 name=__codelineno-0-76></a>        <span class=bp>self</span><span class=o>.</span><span class=n>shots</span> <span class=o>=</span> <span class=n>shots</span>
</span><span id=__span-0-77><a id=__codelineno-0-77 name=__codelineno-0-77></a>
</span><span id=__span-0-78><a id=__codelineno-0-78 name=__codelineno-0-78></a>    <span class=k>def</span><span class=w> </span><span class=nf>evaluation_name</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-79><a id=__codelineno-0-79 name=__codelineno-0-79></a>        <span class=n>prefix</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>dataset_evaluation_name</span> <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>dataset_evaluation_name</span> <span class=k>else</span> <span class=s2>&quot;mbpp&quot;</span>
</span><span id=__span-0-80><a id=__codelineno-0-80 name=__codelineno-0-80></a>        <span class=k>return</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>prefix</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>shots</span><span class=si>}</span><span class=s2>shots&quot;</span>
</span><span id=__span-0-81><a id=__codelineno-0-81 name=__codelineno-0-81></a>
</span><span id=__span-0-82><a id=__codelineno-0-82 name=__codelineno-0-82></a>    <span class=k>def</span><span class=w> </span><span class=nf>compatible_datasets</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-83><a id=__codelineno-0-83 name=__codelineno-0-83></a>        <span class=k>return</span> <span class=p>[</span><span class=s2>&quot;mbpp&quot;</span><span class=p>]</span>
</span><span id=__span-0-84><a id=__codelineno-0-84 name=__codelineno-0-84></a>
</span><span id=__span-0-85><a id=__codelineno-0-85 name=__codelineno-0-85></a>    <span class=k>def</span><span class=w> </span><span class=nf>solve</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>datum</span><span class=p>:</span> <span class=nb>dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-86><a id=__codelineno-0-86 name=__codelineno-0-86></a>        <span class=n>datum</span> <span class=o>=</span> <span class=n>MBPPDatum</span><span class=p>(</span><span class=o>**</span><span class=n>datum</span><span class=p>)</span><span class=o>.</span><span class=n>model_dump</span><span class=p>()</span>
</span><span id=__span-0-87><a id=__codelineno-0-87 name=__codelineno-0-87></a>
</span><span id=__span-0-88><a id=__codelineno-0-88 name=__codelineno-0-88></a>        <span class=c1>## Allow LLM to think &quot;out loud&quot; for it&#39;s answer</span>
</span><span id=__span-0-89><a id=__codelineno-0-89 name=__codelineno-0-89></a>        <span class=n>function_name</span> <span class=o>=</span> <span class=n>get_function_name</span><span class=p>(</span><span class=n>datum</span><span class=p>[</span><span class=s2>&quot;code&quot;</span><span class=p>])</span>
</span><span id=__span-0-90><a id=__codelineno-0-90 name=__codelineno-0-90></a>        <span class=n>example_problems</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>islice</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>dataset_ref</span><span class=p>[</span><span class=s2>&quot;prompt&quot;</span><span class=p>],</span> <span class=bp>self</span><span class=o>.</span><span class=n>shots</span><span class=p>))</span>
</span><span id=__span-0-91><a id=__codelineno-0-91 name=__codelineno-0-91></a>        <span class=n>base_prompt</span> <span class=o>=</span> <span class=n>Template</span><span class=p>(</span><span class=nb>open</span><span class=p>(</span><span class=n>PROMPTS_FOLDER</span> <span class=o>/</span> <span class=s2>&quot;mbpp_verbose_answer.j2&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>(),</span> <span class=n>trim_blocks</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span><span class=o>.</span><span class=n>render</span><span class=p>(</span>
</span><span id=__span-0-92><a id=__codelineno-0-92 name=__codelineno-0-92></a>            <span class=n>function_name</span><span class=o>=</span><span class=n>function_name</span><span class=p>,</span>
</span><span id=__span-0-93><a id=__codelineno-0-93 name=__codelineno-0-93></a>            <span class=n>example_problems</span><span class=o>=</span><span class=n>example_problems</span><span class=p>,</span>
</span><span id=__span-0-94><a id=__codelineno-0-94 name=__codelineno-0-94></a>            <span class=n>challenge_problem</span><span class=o>=</span><span class=n>datum</span><span class=p>,</span>
</span><span id=__span-0-95><a id=__codelineno-0-95 name=__codelineno-0-95></a>        <span class=p>)</span>
</span><span id=__span-0-96><a id=__codelineno-0-96 name=__codelineno-0-96></a>        <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>start_inference_session</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>datum</span><span class=p>[</span><span class=s2>&quot;task_id&quot;</span><span class=p>]))</span><span class=o>.</span><span class=n>run_task</span><span class=p>(</span><span class=n>base_prompt</span><span class=p>)</span>
</span><span id=__span-0-97><a id=__codelineno-0-97 name=__codelineno-0-97></a>
</span><span id=__span-0-98><a id=__codelineno-0-98 name=__codelineno-0-98></a>        <span class=c1>## Extract the answer from the response</span>
</span><span id=__span-0-99><a id=__codelineno-0-99 name=__codelineno-0-99></a>        <span class=n>extract_answer_prompt</span> <span class=o>=</span> <span class=n>Template</span><span class=p>(</span>
</span><span id=__span-0-100><a id=__codelineno-0-100 name=__codelineno-0-100></a>            <span class=nb>open</span><span class=p>(</span><span class=n>PROMPTS_FOLDER</span> <span class=o>/</span> <span class=s2>&quot;mbpp_extract_answer.j2&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>(),</span> <span class=n>trim_blocks</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-0-101><a id=__codelineno-0-101 name=__codelineno-0-101></a>        <span class=p>)</span><span class=o>.</span><span class=n>render</span><span class=p>(</span>
</span><span id=__span-0-102><a id=__codelineno-0-102 name=__codelineno-0-102></a>            <span class=n>function_name</span><span class=o>=</span><span class=n>function_name</span><span class=p>,</span>
</span><span id=__span-0-103><a id=__codelineno-0-103 name=__codelineno-0-103></a>            <span class=n>answer_text</span><span class=o>=</span><span class=n>response</span><span class=p>,</span>
</span><span id=__span-0-104><a id=__codelineno-0-104 name=__codelineno-0-104></a>        <span class=p>)</span>
</span><span id=__span-0-105><a id=__codelineno-0-105 name=__codelineno-0-105></a>        <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>start_inference_session</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>datum</span><span class=p>[</span><span class=s2>&quot;task_id&quot;</span><span class=p>]))</span><span class=o>.</span><span class=n>run_task</span><span class=p>(</span><span class=n>extract_answer_prompt</span><span class=p>)</span>
</span><span id=__span-0-106><a id=__codelineno-0-106 name=__codelineno-0-106></a>
</span><span id=__span-0-107><a id=__codelineno-0-107 name=__codelineno-0-107></a>        <span class=c1>## Parse the python code</span>
</span><span id=__span-0-108><a id=__codelineno-0-108 name=__codelineno-0-108></a>        <span class=n>python_code_blocks</span> <span class=o>=</span> <span class=n>parse_python_code_block</span><span class=p>(</span><span class=n>response</span><span class=p>)</span> <span class=o>+</span> <span class=n>parse_code_block</span><span class=p>(</span><span class=n>response</span><span class=p>)</span>
</span><span id=__span-0-109><a id=__codelineno-0-109 name=__codelineno-0-109></a>        <span class=n>code</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span>
</span><span id=__span-0-110><a id=__codelineno-0-110 name=__codelineno-0-110></a>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>python_code_blocks</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span><span id=__span-0-111><a id=__codelineno-0-111 name=__codelineno-0-111></a>            <span class=n>code</span> <span class=o>=</span> <span class=n>response</span>
</span><span id=__span-0-112><a id=__codelineno-0-112 name=__codelineno-0-112></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-0-113><a id=__codelineno-0-113 name=__codelineno-0-113></a>            <span class=n>code</span> <span class=o>=</span> <span class=n>python_code_blocks</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span><span id=__span-0-114><a id=__codelineno-0-114 name=__codelineno-0-114></a>
</span><span id=__span-0-115><a id=__codelineno-0-115 name=__codelineno-0-115></a>        <span class=c1>## Evaluate the code</span>
</span><span id=__span-0-116><a id=__codelineno-0-116 name=__codelineno-0-116></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-117><a id=__codelineno-0-117 name=__codelineno-0-117></a>            <span class=k>for</span> <span class=n>test</span> <span class=ow>in</span> <span class=n>datum</span><span class=p>[</span><span class=s2>&quot;test_list&quot;</span><span class=p>]</span> <span class=o>+</span> <span class=n>datum</span><span class=p>[</span><span class=s2>&quot;challenge_test_list&quot;</span><span class=p>]:</span>
</span><span id=__span-0-118><a id=__codelineno-0-118 name=__codelineno-0-118></a>                <span class=n>test_code</span> <span class=o>=</span> <span class=n>code</span> <span class=o>+</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span> <span class=o>+</span> <span class=n>test</span>
</span><span id=__span-0-119><a id=__codelineno-0-119 name=__codelineno-0-119></a>                <span class=k>if</span> <span class=ow>not</span> <span class=n>run_with_timeout</span><span class=p>(</span><span class=n>test_code</span><span class=p>):</span>
</span><span id=__span-0-120><a id=__codelineno-0-120 name=__codelineno-0-120></a>                    <span class=k>return</span> <span class=kc>False</span>
</span><span id=__span-0-121><a id=__codelineno-0-121 name=__codelineno-0-121></a>            <span class=k>return</span> <span class=kc>True</span>
</span><span id=__span-0-122><a id=__codelineno-0-122 name=__codelineno-0-122></a>        <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
</span><span id=__span-0-123><a id=__codelineno-0-123 name=__codelineno-0-123></a>            <span class=k>return</span> <span class=kc>False</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> </div> </div> </div> <div class="doc doc-object doc-module"> <h4 id=nearai.solvers.mmlu_solver class="doc doc-heading"> <span class="doc doc-object-name doc-module-name">mmlu_solver</span> <a href=#nearai.solvers.mmlu_solver class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h5 id=nearai.solvers.mmlu_solver.MMLUSolverStrategy class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">MMLUSolverStrategy</span> <a href=#nearai.solvers.mmlu_solver.MMLUSolverStrategy class=headerlink title="Permanent link">&para;</a></h5> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title=nearai.solvers.SolverStrategy href=#nearai.solvers.SolverStrategy>SolverStrategy</a></code></p> <p>Solver strategy for the MMLU dataset.</p> <details class=quote> <summary>Source code in <code>nearai/solvers/mmlu_solver.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-18>18</a></span>
<span class=normal><a href=#__codelineno-0-19>19</a></span>
<span class=normal><a href=#__codelineno-0-20>20</a></span>
<span class=normal><a href=#__codelineno-0-21>21</a></span>
<span class=normal><a href=#__codelineno-0-22>22</a></span>
<span class=normal><a href=#__codelineno-0-23>23</a></span>
<span class=normal><a href=#__codelineno-0-24>24</a></span>
<span class=normal><a href=#__codelineno-0-25>25</a></span>
<span class=normal><a href=#__codelineno-0-26>26</a></span>
<span class=normal><a href=#__codelineno-0-27>27</a></span>
<span class=normal><a href=#__codelineno-0-28>28</a></span>
<span class=normal><a href=#__codelineno-0-29>29</a></span>
<span class=normal><a href=#__codelineno-0-30>30</a></span>
<span class=normal><a href=#__codelineno-0-31>31</a></span>
<span class=normal><a href=#__codelineno-0-32>32</a></span>
<span class=normal><a href=#__codelineno-0-33>33</a></span>
<span class=normal><a href=#__codelineno-0-34>34</a></span>
<span class=normal><a href=#__codelineno-0-35>35</a></span>
<span class=normal><a href=#__codelineno-0-36>36</a></span>
<span class=normal><a href=#__codelineno-0-37>37</a></span>
<span class=normal><a href=#__codelineno-0-38>38</a></span>
<span class=normal><a href=#__codelineno-0-39>39</a></span>
<span class=normal><a href=#__codelineno-0-40>40</a></span>
<span class=normal><a href=#__codelineno-0-41>41</a></span>
<span class=normal><a href=#__codelineno-0-42>42</a></span>
<span class=normal><a href=#__codelineno-0-43>43</a></span>
<span class=normal><a href=#__codelineno-0-44>44</a></span>
<span class=normal><a href=#__codelineno-0-45>45</a></span>
<span class=normal><a href=#__codelineno-0-46>46</a></span>
<span class=normal><a href=#__codelineno-0-47>47</a></span>
<span class=normal><a href=#__codelineno-0-48>48</a></span>
<span class=normal><a href=#__codelineno-0-49>49</a></span>
<span class=normal><a href=#__codelineno-0-50>50</a></span>
<span class=normal><a href=#__codelineno-0-51>51</a></span>
<span class=normal><a href=#__codelineno-0-52>52</a></span>
<span class=normal><a href=#__codelineno-0-53>53</a></span>
<span class=normal><a href=#__codelineno-0-54>54</a></span>
<span class=normal><a href=#__codelineno-0-55>55</a></span>
<span class=normal><a href=#__codelineno-0-56>56</a></span>
<span class=normal><a href=#__codelineno-0-57>57</a></span>
<span class=normal><a href=#__codelineno-0-58>58</a></span>
<span class=normal><a href=#__codelineno-0-59>59</a></span>
<span class=normal><a href=#__codelineno-0-60>60</a></span>
<span class=normal><a href=#__codelineno-0-61>61</a></span>
<span class=normal><a href=#__codelineno-0-62>62</a></span>
<span class=normal><a href=#__codelineno-0-63>63</a></span>
<span class=normal><a href=#__codelineno-0-64>64</a></span>
<span class=normal><a href=#__codelineno-0-65>65</a></span>
<span class=normal><a href=#__codelineno-0-66>66</a></span>
<span class=normal><a href=#__codelineno-0-67>67</a></span>
<span class=normal><a href=#__codelineno-0-68>68</a></span>
<span class=normal><a href=#__codelineno-0-69>69</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-18><a id=__codelineno-0-18 name=__codelineno-0-18></a><span class=k>class</span><span class=w> </span><span class=nc>MMLUSolverStrategy</span><span class=p>(</span><span class=n>SolverStrategy</span><span class=p>):</span>
</span><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Solver strategy for the MMLU dataset.&quot;&quot;&quot;</span>
</span><span id=__span-0-20><a id=__codelineno-0-20 name=__codelineno-0-20></a>
</span><span id=__span-0-21><a id=__codelineno-0-21 name=__codelineno-0-21></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span>  <span class=c1># noqa: D107</span>
</span><span id=__span-0-22><a id=__codelineno-0-22 name=__codelineno-0-22></a>        <span class=bp>self</span><span class=p>,</span> <span class=n>dataset_ref</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Dataset</span><span class=p>,</span> <span class=n>DatasetDict</span><span class=p>],</span> <span class=n>model</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>agent</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>shots</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>8</span>
</span><span id=__span-0-23><a id=__codelineno-0-23 name=__codelineno-0-23></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-0-24><a id=__codelineno-0-24 name=__codelineno-0-24></a>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>agent</span><span class=p>)</span>
</span><span id=__span-0-25><a id=__codelineno-0-25 name=__codelineno-0-25></a>        <span class=bp>self</span><span class=o>.</span><span class=n>dataset_ref</span> <span class=o>=</span> <span class=n>dataset_ref</span>
</span><span id=__span-0-26><a id=__codelineno-0-26 name=__codelineno-0-26></a>        <span class=bp>self</span><span class=o>.</span><span class=n>shots</span> <span class=o>=</span> <span class=n>shots</span>
</span><span id=__span-0-27><a id=__codelineno-0-27 name=__codelineno-0-27></a>
</span><span id=__span-0-28><a id=__codelineno-0-28 name=__codelineno-0-28></a>    <span class=k>def</span><span class=w> </span><span class=nf>evaluation_name</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-29><a id=__codelineno-0-29 name=__codelineno-0-29></a>        <span class=n>prefix</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>dataset_evaluation_name</span> <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>dataset_evaluation_name</span> <span class=k>else</span> <span class=s2>&quot;mmlu&quot;</span>
</span><span id=__span-0-30><a id=__codelineno-0-30 name=__codelineno-0-30></a>        <span class=k>return</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>prefix</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>shots</span><span class=si>}</span><span class=s2>shots&quot;</span>
</span><span id=__span-0-31><a id=__codelineno-0-31 name=__codelineno-0-31></a>
</span><span id=__span-0-32><a id=__codelineno-0-32 name=__codelineno-0-32></a>    <span class=k>def</span><span class=w> </span><span class=nf>compatible_datasets</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-33><a id=__codelineno-0-33 name=__codelineno-0-33></a>        <span class=k>return</span> <span class=p>[</span><span class=s2>&quot;mmlu&quot;</span><span class=p>]</span>
</span><span id=__span-0-34><a id=__codelineno-0-34 name=__codelineno-0-34></a>
</span><span id=__span-0-35><a id=__codelineno-0-35 name=__codelineno-0-35></a>    <span class=k>def</span><span class=w> </span><span class=nf>solve</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>datum</span><span class=p>:</span> <span class=nb>dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-36><a id=__codelineno-0-36 name=__codelineno-0-36></a>        <span class=n>datum</span> <span class=o>=</span> <span class=n>MMLUDatum</span><span class=p>(</span><span class=o>**</span><span class=n>datum</span><span class=p>)</span><span class=o>.</span><span class=n>model_dump</span><span class=p>()</span>
</span><span id=__span-0-37><a id=__codelineno-0-37 name=__codelineno-0-37></a>
</span><span id=__span-0-38><a id=__codelineno-0-38 name=__codelineno-0-38></a>        <span class=n>choices</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;A&quot;</span><span class=p>,</span> <span class=s2>&quot;B&quot;</span><span class=p>,</span> <span class=s2>&quot;C&quot;</span><span class=p>,</span> <span class=s2>&quot;D&quot;</span><span class=p>]</span>
</span><span id=__span-0-39><a id=__codelineno-0-39 name=__codelineno-0-39></a>        <span class=n>example_problems_indices</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>5</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>shots</span><span class=p>,</span> <span class=mi>5</span><span class=p>))</span>
</span><span id=__span-0-40><a id=__codelineno-0-40 name=__codelineno-0-40></a>        <span class=n>example_problems</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span>
</span><span id=__span-0-41><a id=__codelineno-0-41 name=__codelineno-0-41></a>            <span class=nb>map</span><span class=p>(</span>
</span><span id=__span-0-42><a id=__codelineno-0-42 name=__codelineno-0-42></a>                <span class=k>lambda</span> <span class=n>d</span><span class=p>:</span> <span class=n>MMLUDatum</span><span class=p>(</span><span class=o>**</span><span class=n>d</span><span class=p>)</span><span class=o>.</span><span class=n>model_dump</span><span class=p>(),</span>
</span><span id=__span-0-43><a id=__codelineno-0-43 name=__codelineno-0-43></a>                <span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>dataset_ref</span><span class=p>[</span><span class=s2>&quot;dev&quot;</span><span class=p>][</span><span class=n>i</span><span class=p>]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>example_problems_indices</span><span class=p>],</span>
</span><span id=__span-0-44><a id=__codelineno-0-44 name=__codelineno-0-44></a>            <span class=p>)</span>
</span><span id=__span-0-45><a id=__codelineno-0-45 name=__codelineno-0-45></a>        <span class=p>)</span>
</span><span id=__span-0-46><a id=__codelineno-0-46 name=__codelineno-0-46></a>        <span class=n>base_prompt</span> <span class=o>=</span> <span class=n>Template</span><span class=p>(</span><span class=nb>open</span><span class=p>(</span><span class=n>PROMPTS_FOLDER</span> <span class=o>/</span> <span class=s2>&quot;mmlu_verbose_answer.j2&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>(),</span> <span class=n>trim_blocks</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span><span class=o>.</span><span class=n>render</span><span class=p>(</span>
</span><span id=__span-0-47><a id=__codelineno-0-47 name=__codelineno-0-47></a>            <span class=n>example_problems</span><span class=o>=</span><span class=n>example_problems</span><span class=p>,</span>
</span><span id=__span-0-48><a id=__codelineno-0-48 name=__codelineno-0-48></a>            <span class=n>challenge_problem</span><span class=o>=</span><span class=n>datum</span><span class=p>,</span>
</span><span id=__span-0-49><a id=__codelineno-0-49 name=__codelineno-0-49></a>            <span class=n>choices</span><span class=o>=</span><span class=n>choices</span><span class=p>,</span>
</span><span id=__span-0-50><a id=__codelineno-0-50 name=__codelineno-0-50></a>        <span class=p>)</span>
</span><span id=__span-0-51><a id=__codelineno-0-51 name=__codelineno-0-51></a>
</span><span id=__span-0-52><a id=__codelineno-0-52 name=__codelineno-0-52></a>        <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>start_inference_session</span><span class=p>(</span><span class=s2>&quot;&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>run_task</span><span class=p>(</span><span class=n>base_prompt</span><span class=p>)</span>
</span><span id=__span-0-53><a id=__codelineno-0-53 name=__codelineno-0-53></a>
</span><span id=__span-0-54><a id=__codelineno-0-54 name=__codelineno-0-54></a>        <span class=c1>## Extract the answer from the response</span>
</span><span id=__span-0-55><a id=__codelineno-0-55 name=__codelineno-0-55></a>        <span class=n>extract_answer_prompt</span> <span class=o>=</span> <span class=n>Template</span><span class=p>(</span>
</span><span id=__span-0-56><a id=__codelineno-0-56 name=__codelineno-0-56></a>            <span class=nb>open</span><span class=p>(</span><span class=n>PROMPTS_FOLDER</span> <span class=o>/</span> <span class=s2>&quot;mmlu_extract_answer.j2&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>(),</span> <span class=n>trim_blocks</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-0-57><a id=__codelineno-0-57 name=__codelineno-0-57></a>        <span class=p>)</span><span class=o>.</span><span class=n>render</span><span class=p>(</span>
</span><span id=__span-0-58><a id=__codelineno-0-58 name=__codelineno-0-58></a>            <span class=n>challenge_problem</span><span class=o>=</span><span class=n>datum</span><span class=p>,</span>
</span><span id=__span-0-59><a id=__codelineno-0-59 name=__codelineno-0-59></a>            <span class=n>answer_text</span><span class=o>=</span><span class=n>response</span><span class=p>,</span>
</span><span id=__span-0-60><a id=__codelineno-0-60 name=__codelineno-0-60></a>            <span class=n>choices</span><span class=o>=</span><span class=n>choices</span><span class=p>,</span>
</span><span id=__span-0-61><a id=__codelineno-0-61 name=__codelineno-0-61></a>        <span class=p>)</span>
</span><span id=__span-0-62><a id=__codelineno-0-62 name=__codelineno-0-62></a>        <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>start_inference_session</span><span class=p>(</span><span class=s2>&quot;&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>run_task</span><span class=p>(</span><span class=n>extract_answer_prompt</span><span class=p>)</span>
</span><span id=__span-0-63><a id=__codelineno-0-63 name=__codelineno-0-63></a>
</span><span id=__span-0-64><a id=__codelineno-0-64 name=__codelineno-0-64></a>        <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-65><a id=__codelineno-0-65 name=__codelineno-0-65></a>            <span class=n>answer</span> <span class=o>=</span> <span class=n>choices</span><span class=o>.</span><span class=n>index</span><span class=p>(</span><span class=n>response</span><span class=p>)</span>
</span><span id=__span-0-66><a id=__codelineno-0-66 name=__codelineno-0-66></a>            <span class=k>return</span> <span class=nb>bool</span><span class=p>(</span><span class=n>answer</span> <span class=o>==</span> <span class=n>datum</span><span class=p>[</span><span class=s2>&quot;answer&quot;</span><span class=p>])</span>
</span><span id=__span-0-67><a id=__codelineno-0-67 name=__codelineno-0-67></a>        <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
</span><span id=__span-0-68><a id=__codelineno-0-68 name=__codelineno-0-68></a>            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Failed to parse answer&quot;</span><span class=p>)</span>
</span><span id=__span-0-69><a id=__codelineno-0-69 name=__codelineno-0-69></a>            <span class=k>return</span> <span class=kc>False</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> </div> </div> </div> </div> </div> </div> <div class="doc doc-object doc-module"> <h3 id=nearai.tests class="doc doc-heading"> <span class="doc doc-object-name doc-module-name">tests</span> <a href=#nearai.tests class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <div class="doc doc-children"> <div class="doc doc-object doc-module"> <h4 id=nearai.tests.test_provider_models class="doc doc-heading"> <span class="doc doc-object-name doc-module-name">test_provider_models</span> <a href=#nearai.tests.test_provider_models class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h5 id=nearai.tests.test_provider_models.TestMatchProviderModel class="doc doc-heading"> <span class="doc doc-object-name doc-class-name">TestMatchProviderModel</span> <a href=#nearai.tests.test_provider_models.TestMatchProviderModel class=headerlink title="Permanent link">&para;</a></h5> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=unittest.TestCase>TestCase</span></code></p> <p>Unit tests for get_provider_namespaced_model.</p> <details class=quote> <summary>Source code in <code>nearai/tests/test_provider_models.py</code></summary> <div class="language-python highlight"><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-7> 7</a></span>
<span class=normal><a href=#__codelineno-0-8> 8</a></span>
<span class=normal><a href=#__codelineno-0-9> 9</a></span>
<span class=normal><a href=#__codelineno-0-10>10</a></span>
<span class=normal><a href=#__codelineno-0-11>11</a></span>
<span class=normal><a href=#__codelineno-0-12>12</a></span>
<span class=normal><a href=#__codelineno-0-13>13</a></span>
<span class=normal><a href=#__codelineno-0-14>14</a></span>
<span class=normal><a href=#__codelineno-0-15>15</a></span>
<span class=normal><a href=#__codelineno-0-16>16</a></span>
<span class=normal><a href=#__codelineno-0-17>17</a></span>
<span class=normal><a href=#__codelineno-0-18>18</a></span>
<span class=normal><a href=#__codelineno-0-19>19</a></span>
<span class=normal><a href=#__codelineno-0-20>20</a></span>
<span class=normal><a href=#__codelineno-0-21>21</a></span>
<span class=normal><a href=#__codelineno-0-22>22</a></span>
<span class=normal><a href=#__codelineno-0-23>23</a></span>
<span class=normal><a href=#__codelineno-0-24>24</a></span>
<span class=normal><a href=#__codelineno-0-25>25</a></span>
<span class=normal><a href=#__codelineno-0-26>26</a></span>
<span class=normal><a href=#__codelineno-0-27>27</a></span>
<span class=normal><a href=#__codelineno-0-28>28</a></span>
<span class=normal><a href=#__codelineno-0-29>29</a></span>
<span class=normal><a href=#__codelineno-0-30>30</a></span>
<span class=normal><a href=#__codelineno-0-31>31</a></span>
<span class=normal><a href=#__codelineno-0-32>32</a></span>
<span class=normal><a href=#__codelineno-0-33>33</a></span>
<span class=normal><a href=#__codelineno-0-34>34</a></span>
<span class=normal><a href=#__codelineno-0-35>35</a></span>
<span class=normal><a href=#__codelineno-0-36>36</a></span>
<span class=normal><a href=#__codelineno-0-37>37</a></span>
<span class=normal><a href=#__codelineno-0-38>38</a></span>
<span class=normal><a href=#__codelineno-0-39>39</a></span>
<span class=normal><a href=#__codelineno-0-40>40</a></span>
<span class=normal><a href=#__codelineno-0-41>41</a></span>
<span class=normal><a href=#__codelineno-0-42>42</a></span>
<span class=normal><a href=#__codelineno-0-43>43</a></span>
<span class=normal><a href=#__codelineno-0-44>44</a></span>
<span class=normal><a href=#__codelineno-0-45>45</a></span>
<span class=normal><a href=#__codelineno-0-46>46</a></span>
<span class=normal><a href=#__codelineno-0-47>47</a></span>
<span class=normal><a href=#__codelineno-0-48>48</a></span>
<span class=normal><a href=#__codelineno-0-49>49</a></span>
<span class=normal><a href=#__codelineno-0-50>50</a></span>
<span class=normal><a href=#__codelineno-0-51>51</a></span>
<span class=normal><a href=#__codelineno-0-52>52</a></span>
<span class=normal><a href=#__codelineno-0-53>53</a></span>
<span class=normal><a href=#__codelineno-0-54>54</a></span>
<span class=normal><a href=#__codelineno-0-55>55</a></span>
<span class=normal><a href=#__codelineno-0-56>56</a></span>
<span class=normal><a href=#__codelineno-0-57>57</a></span>
<span class=normal><a href=#__codelineno-0-58>58</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7></a><span class=k>class</span><span class=w> </span><span class=nc>TestMatchProviderModel</span><span class=p>(</span><span class=n>unittest</span><span class=o>.</span><span class=n>TestCase</span><span class=p>):</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Unit tests for get_provider_namespaced_model.&quot;&quot;&quot;</span>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9></a>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>method_name</span><span class=o>=</span><span class=s2>&quot;runTest&quot;</span><span class=p>):</span>  <span class=c1># noqa: D107</span>
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11></a>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>method_name</span><span class=p>)</span>
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12></a>        <span class=bp>self</span><span class=o>.</span><span class=n>provider_models</span> <span class=o>=</span> <span class=n>ProviderModels</span><span class=p>(</span><span class=n>CONFIG</span><span class=o>.</span><span class=n>get_client_config</span><span class=p>())</span>
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13></a>
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14></a>    <span class=k>def</span><span class=w> </span><span class=nf>test_fireworks</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15></a>        <span class=bp>self</span><span class=o>.</span><span class=n>assertEqual</span><span class=p>(</span>
</span><span id=__span-0-16><a id=__codelineno-0-16 name=__codelineno-0-16></a>            <span class=bp>self</span><span class=o>.</span><span class=n>provider_models</span><span class=o>.</span><span class=n>match_provider_model</span><span class=p>(</span><span class=s2>&quot;fireworks::accounts/yi-01-ai/models/yi-large&quot;</span><span class=p>),</span>
</span><span id=__span-0-17><a id=__codelineno-0-17 name=__codelineno-0-17></a>            <span class=p>(</span><span class=s2>&quot;fireworks&quot;</span><span class=p>,</span> <span class=s2>&quot;fireworks::accounts/yi-01-ai/models/yi-large&quot;</span><span class=p>),</span>
</span><span id=__span-0-18><a id=__codelineno-0-18 name=__codelineno-0-18></a>        <span class=p>)</span>
</span><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19></a>        <span class=bp>self</span><span class=o>.</span><span class=n>assertEqual</span><span class=p>(</span>
</span><span id=__span-0-20><a id=__codelineno-0-20 name=__codelineno-0-20></a>            <span class=bp>self</span><span class=o>.</span><span class=n>provider_models</span><span class=o>.</span><span class=n>match_provider_model</span><span class=p>(</span><span class=s2>&quot;accounts/yi-01-ai/models/yi-large&quot;</span><span class=p>),</span>
</span><span id=__span-0-21><a id=__codelineno-0-21 name=__codelineno-0-21></a>            <span class=p>(</span><span class=s2>&quot;fireworks&quot;</span><span class=p>,</span> <span class=s2>&quot;fireworks::accounts/yi-01-ai/models/yi-large&quot;</span><span class=p>),</span>
</span><span id=__span-0-22><a id=__codelineno-0-22 name=__codelineno-0-22></a>        <span class=p>)</span>
</span><span id=__span-0-23><a id=__codelineno-0-23 name=__codelineno-0-23></a>        <span class=bp>self</span><span class=o>.</span><span class=n>assertEqual</span><span class=p>(</span>
</span><span id=__span-0-24><a id=__codelineno-0-24 name=__codelineno-0-24></a>            <span class=bp>self</span><span class=o>.</span><span class=n>provider_models</span><span class=o>.</span><span class=n>match_provider_model</span><span class=p>(</span><span class=s2>&quot;llama-v3-70b-instruct&quot;</span><span class=p>),</span>
</span><span id=__span-0-25><a id=__codelineno-0-25 name=__codelineno-0-25></a>            <span class=p>(</span><span class=s2>&quot;fireworks&quot;</span><span class=p>,</span> <span class=s2>&quot;fireworks::accounts/fireworks/models/llama-v3-70b-instruct&quot;</span><span class=p>),</span>
</span><span id=__span-0-26><a id=__codelineno-0-26 name=__codelineno-0-26></a>        <span class=p>)</span>
</span><span id=__span-0-27><a id=__codelineno-0-27 name=__codelineno-0-27></a>        <span class=bp>self</span><span class=o>.</span><span class=n>assertEqual</span><span class=p>(</span>
</span><span id=__span-0-28><a id=__codelineno-0-28 name=__codelineno-0-28></a>            <span class=bp>self</span><span class=o>.</span><span class=n>provider_models</span><span class=o>.</span><span class=n>match_provider_model</span><span class=p>(</span><span class=s2>&quot;yi-01-ai/yi-large&quot;</span><span class=p>),</span>
</span><span id=__span-0-29><a id=__codelineno-0-29 name=__codelineno-0-29></a>            <span class=p>(</span><span class=s2>&quot;fireworks&quot;</span><span class=p>,</span> <span class=s2>&quot;fireworks::accounts/yi-01-ai/models/yi-large&quot;</span><span class=p>),</span>
</span><span id=__span-0-30><a id=__codelineno-0-30 name=__codelineno-0-30></a>        <span class=p>)</span>
</span><span id=__span-0-31><a id=__codelineno-0-31 name=__codelineno-0-31></a>
</span><span id=__span-0-32><a id=__codelineno-0-32 name=__codelineno-0-32></a>    <span class=k>def</span><span class=w> </span><span class=nf>test_hyperbolic</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-33><a id=__codelineno-0-33 name=__codelineno-0-33></a>        <span class=bp>self</span><span class=o>.</span><span class=n>assertEqual</span><span class=p>(</span>
</span><span id=__span-0-34><a id=__codelineno-0-34 name=__codelineno-0-34></a>            <span class=bp>self</span><span class=o>.</span><span class=n>provider_models</span><span class=o>.</span><span class=n>match_provider_model</span><span class=p>(</span><span class=s2>&quot;hyperbolic::StableDiffusion&quot;</span><span class=p>),</span>
</span><span id=__span-0-35><a id=__codelineno-0-35 name=__codelineno-0-35></a>            <span class=p>(</span><span class=s2>&quot;hyperbolic&quot;</span><span class=p>,</span> <span class=s2>&quot;hyperbolic::StableDiffusion&quot;</span><span class=p>),</span>
</span><span id=__span-0-36><a id=__codelineno-0-36 name=__codelineno-0-36></a>        <span class=p>)</span>
</span><span id=__span-0-37><a id=__codelineno-0-37 name=__codelineno-0-37></a>        <span class=bp>self</span><span class=o>.</span><span class=n>assertEqual</span><span class=p>(</span>
</span><span id=__span-0-38><a id=__codelineno-0-38 name=__codelineno-0-38></a>            <span class=bp>self</span><span class=o>.</span><span class=n>provider_models</span><span class=o>.</span><span class=n>match_provider_model</span><span class=p>(</span><span class=s2>&quot;hyperbolic::meta-llama/Meta-Llama-3.1-70B-Instruct&quot;</span><span class=p>),</span>
</span><span id=__span-0-39><a id=__codelineno-0-39 name=__codelineno-0-39></a>            <span class=p>(</span><span class=s2>&quot;hyperbolic&quot;</span><span class=p>,</span> <span class=s2>&quot;hyperbolic::meta-llama/Meta-Llama-3.1-70B-Instruct&quot;</span><span class=p>),</span>
</span><span id=__span-0-40><a id=__codelineno-0-40 name=__codelineno-0-40></a>        <span class=p>)</span>
</span><span id=__span-0-41><a id=__codelineno-0-41 name=__codelineno-0-41></a>        <span class=bp>self</span><span class=o>.</span><span class=n>assertEqual</span><span class=p>(</span>
</span><span id=__span-0-42><a id=__codelineno-0-42 name=__codelineno-0-42></a>            <span class=bp>self</span><span class=o>.</span><span class=n>provider_models</span><span class=o>.</span><span class=n>match_provider_model</span><span class=p>(</span><span class=s2>&quot;hyperbolic::Meta-Llama-3.1-70B-Instruct&quot;</span><span class=p>),</span>
</span><span id=__span-0-43><a id=__codelineno-0-43 name=__codelineno-0-43></a>            <span class=p>(</span><span class=s2>&quot;hyperbolic&quot;</span><span class=p>,</span> <span class=s2>&quot;hyperbolic::meta-llama/Meta-Llama-3.1-70B-Instruct&quot;</span><span class=p>),</span>
</span><span id=__span-0-44><a id=__codelineno-0-44 name=__codelineno-0-44></a>        <span class=p>)</span>
</span><span id=__span-0-45><a id=__codelineno-0-45 name=__codelineno-0-45></a>
</span><span id=__span-0-46><a id=__codelineno-0-46 name=__codelineno-0-46></a>    <span class=k>def</span><span class=w> </span><span class=nf>test_registry_with_multiple_providers</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>  <span class=c1># noqa: D102</span>
</span><span id=__span-0-47><a id=__codelineno-0-47 name=__codelineno-0-47></a>        <span class=bp>self</span><span class=o>.</span><span class=n>assertEqual</span><span class=p>(</span>
</span><span id=__span-0-48><a id=__codelineno-0-48 name=__codelineno-0-48></a>            <span class=bp>self</span><span class=o>.</span><span class=n>provider_models</span><span class=o>.</span><span class=n>match_provider_model</span><span class=p>(</span><span class=s2>&quot;llama-3.1-70b-instruct&quot;</span><span class=p>),</span>
</span><span id=__span-0-49><a id=__codelineno-0-49 name=__codelineno-0-49></a>            <span class=p>(</span><span class=s2>&quot;fireworks&quot;</span><span class=p>,</span> <span class=s2>&quot;fireworks::accounts/fireworks/models/llama-v3p1-70b-instruct&quot;</span><span class=p>),</span>
</span><span id=__span-0-50><a id=__codelineno-0-50 name=__codelineno-0-50></a>        <span class=p>)</span>
</span><span id=__span-0-51><a id=__codelineno-0-51 name=__codelineno-0-51></a>        <span class=bp>self</span><span class=o>.</span><span class=n>assertEqual</span><span class=p>(</span>
</span><span id=__span-0-52><a id=__codelineno-0-52 name=__codelineno-0-52></a>            <span class=bp>self</span><span class=o>.</span><span class=n>provider_models</span><span class=o>.</span><span class=n>match_provider_model</span><span class=p>(</span><span class=s2>&quot;llama-3.1-70b-instruct&quot;</span><span class=p>,</span> <span class=n>provider</span><span class=o>=</span><span class=s2>&quot;hyperbolic&quot;</span><span class=p>),</span>
</span><span id=__span-0-53><a id=__codelineno-0-53 name=__codelineno-0-53></a>            <span class=p>(</span><span class=s2>&quot;hyperbolic&quot;</span><span class=p>,</span> <span class=s2>&quot;hyperbolic::meta-llama/Meta-Llama-3.1-70B-Instruct&quot;</span><span class=p>),</span>
</span><span id=__span-0-54><a id=__codelineno-0-54 name=__codelineno-0-54></a>        <span class=p>)</span>
</span><span id=__span-0-55><a id=__codelineno-0-55 name=__codelineno-0-55></a>        <span class=bp>self</span><span class=o>.</span><span class=n>assertEqual</span><span class=p>(</span>
</span><span id=__span-0-56><a id=__codelineno-0-56 name=__codelineno-0-56></a>            <span class=bp>self</span><span class=o>.</span><span class=n>provider_models</span><span class=o>.</span><span class=n>match_provider_model</span><span class=p>(</span><span class=s2>&quot;near.ai/llama-3.1-70b-instruct&quot;</span><span class=p>,</span> <span class=n>provider</span><span class=o>=</span><span class=s2>&quot;hyperbolic&quot;</span><span class=p>),</span>
</span><span id=__span-0-57><a id=__codelineno-0-57 name=__codelineno-0-57></a>            <span class=p>(</span><span class=s2>&quot;hyperbolic&quot;</span><span class=p>,</span> <span class=s2>&quot;hyperbolic::meta-llama/Meta-Llama-3.1-70B-Instruct&quot;</span><span class=p>),</span>
</span><span id=__span-0-58><a id=__codelineno-0-58 name=__codelineno-0-58></a>        <span class=p>)</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> </div> </div> </div> </div> </div> </div> </div> </div> </div> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../assistants/integrate/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Integrate"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Integrate </div> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"base": "..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.code.select", "content.tabs.link", "content.tooltips", "header.autohide", "navigation.expand", "navigation.footer", "navigation.indexes", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.prune", "navigation.expand", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../assets/javascripts/bundle.f1b6f286.min.js></script> <script src=../javascripts/katex.js></script> <script src=https://unpkg.com/katex@0/dist/katex.min.js></script> <script src=https://unpkg.com/katex@0/dist/contrib/auto-render.min.js></script> </body> </html>